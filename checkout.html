<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>å¡«å¯«ä»˜æ¬¾è³‡è¨Šï½œReelMind</title>
<meta name="description" content="å¡«å¯«ä»˜æ¬¾è³‡è¨Šï¼Œå®Œæˆ ReelMind è¨‚é–±">
<meta name="theme-color" content="#2563EB" />
<style>
:root{
  --bg:#F8FAFC; --ink:#0F172A; --sub:#475569; --line:#E2E8F0; --card:#FFFFFF;
  --blue:#2563EB; --blue-deep:#1D4ED8; --ok:#16A34A; --warn:#F59E0B; --red:#DC2626;
  --shadow:0 16px 40px rgba(2,6,23,.08); --r:16px;
}
*{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--ink);-webkit-font-smoothing:antialiased}
body{font-family:ui-sans-serif,system-ui,-apple-system,"Noto Sans TC","PingFang TC",Segoe UI,Roboto,Arial}
a{text-decoration:none;color:inherit}
.wrap{width:100%} .safe{max-width:1120px;margin:0 auto;padding:0 16px}
.hero{padding:40px 0 24px;background:
  radial-gradient(900px 320px at 90% -10%, rgba(37,99,235,.12), transparent 60%),
  radial-gradient(600px 260px at 8% -10%, rgba(59,130,246,.10), transparent 60%);
  border-bottom:1px solid var(--line)}
.h1{font-size:28px;line-height:1.2;margin:0 0 6px}
.lead{color:var(--sub);margin:0;font-size:16px}
.badge{display:inline-flex;gap:8px;align-items:center;background:#E0F2FE;color:#075985;padding:8px 12px;border-radius:999px;font-weight:800;font-size:12px;margin-bottom:10px}
.grid{display:grid;gap:16px}
@media(min-width:980px){.cols-2{grid-template-columns:1.1fr 1fr}}
.card{background:var(--card);border-radius:var(--r);box-shadow:var(--shadow);border:1px solid var(--line)}
.card .body{padding:24px}
.h2{font-size:22px;font-weight:900;margin:0 0 8px}
.h3{font-size:18px;font-weight:900;margin:0 0 6px}
.hr{height:1px;background:linear-gradient(90deg,transparent,var(--line),transparent);margin:12px 0}
.sub{color:var(--sub)}
.list{padding-left:18px;margin:8px 0} .list li{margin:6px 0;color:var(--sub)}
.row{display:flex;gap:10px;flex-wrap:wrap}
.input{width:100%;height:44px;border:1px solid #CBD5E1;border-radius:10px;padding:10px 12px;font-size:14px}
.select{width:100%;height:44px;border:1px solid #CBD5E1;border-radius:10px;padding:10px 12px;background:#fff}
.textarea{width:100%;min-height:88px;border:1px solid #CBD5E1;border-radius:12px;padding:12px}
.btn{display:inline-flex;align-items:center;justify-content:center;height:48px;padding:0 18px;border-radius:999px;font-weight:900;cursor:pointer;border:none}
.btn.blue{background:var(--blue);color:#fff}.btn.blue:hover{background:var(--blue-deep)}
.btn.ghost{border:1px solid #CBD5E1;background:#fff;color:#334155}
.payrow{display:grid;gap:10px}
.paybtn{width:100%;height:48px;border:1px solid #CBD5E1;border-radius:12px;background:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;gap:8px;cursor:pointer}
.sum{background:#0B1220;color:#E5E7EB;border-radius:14px;padding:16px}
.sum .line{display:flex;justify-content:space-between;margin:8px 0}
.ft{padding:24px 0;color:#64748B;text-align:center;border-top:1px solid var(--line);font-size:14px}
.small{font-size:12px;color:#64748B}
.plan-summary{background:#F1F5F9;border-radius:12px;padding:16px;margin-bottom:16px}
.plan-summary .plan-name{font-size:18px;font-weight:900;margin-bottom:8px}
.plan-summary .plan-price{font-size:24px;font-weight:900;color:var(--blue)}
.plan-summary .plan-desc{color:var(--sub);font-size:14px;margin-top:4px}

/* å‹•ç•«æ•ˆæœ */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes slideInLeft {
  from {
    opacity: 0;
    transform: translateX(-30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Hero å€å¡Šå‹•ç•« */
.hero {
  animation: fadeInUp 0.8s ease-out;
}

.hero .badge {
  animation: fadeIn 0.6s ease-out 0.2s both;
}

.hero .h1 {
  animation: fadeInUp 0.8s ease-out 0.3s both;
}

.hero .lead {
  animation: fadeInUp 0.8s ease-out 0.4s both;
}

/* å¡ç‰‡å‹•ç•« */
.card {
  animation: fadeInUp 0.8s ease-out both;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 20px 50px rgba(2,6,23,.12);
}

/* å·¦å³å¡ç‰‡åˆ†åˆ¥å‹•ç•« */
.card:nth-child(1) {
  animation: slideInLeft 0.8s ease-out 0.2s both;
}

.card:nth-child(2) {
  animation: slideInRight 0.8s ease-out 0.4s both;
}

/* æ–¹æ¡ˆæ‘˜è¦å‹•ç•« */
.plan-summary {
  animation: fadeInUp 0.6s ease-out 0.6s both;
  transition: transform 0.3s ease;
}

.plan-summary:hover {
  transform: scale(1.02);
}

/* è¼¸å…¥æ¡†å‹•ç•« */
.input, .select, .textarea {
  transition: all 0.3s ease;
  animation: fadeInUp 0.5s ease-out both;
}

.input:nth-of-type(1) { animation-delay: 0.7s; }
.input:nth-of-type(2) { animation-delay: 0.8s; }
.input:nth-of-type(3) { animation-delay: 0.9s; }
.select { animation-delay: 1s; }
.textarea { animation-delay: 1.1s; }

.input:focus, .select:focus, .textarea:focus {
  transform: scale(1.02);
  border-color: var(--blue);
  box-shadow: 0 0 0 3px rgba(37,99,235,.1);
}

/* æŒ‰éˆ•å‹•ç•« */
.btn {
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
  animation: fadeInUp 0.6s ease-out 1.2s both;
}

.btn::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

.btn:hover::before {
  width: 300px;
  height: 300px;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(37,99,235,.3);
}

.btn:active {
  transform: translateY(0);
}

/* è¨‚å–®æ‘˜è¦å‹•ç•« */
.sum {
  animation: fadeInUp 0.6s ease-out 1s both;
}

.sum .line {
  animation: fadeIn 0.4s ease-out both;
}

.sum .line:nth-child(1) { animation-delay: 1.1s; }
.sum .line:nth-child(2) { animation-delay: 1.2s; }
.sum .line:nth-child(3) { animation-delay: 1.3s; }

/* åˆ—è¡¨é …ç›®å‹•ç•« */
.list li {
  opacity: 0;
  animation: fadeInUp 0.5s ease-out both;
}

.list li:nth-child(1) { animation-delay: 1.1s; }
.list li:nth-child(2) { animation-delay: 1.2s; }
.list li:nth-child(3) { animation-delay: 1.3s; }
.list li:nth-child(4) { animation-delay: 1.4s; }
.list li:nth-child(5) { animation-delay: 1.5s; }

/* Footer å‹•ç•« */
.ft {
  animation: fadeIn 0.6s ease-out 1.6s both;
}

/* éŸ¿æ‡‰å¼ï¼šæ‰‹æ©Ÿç‰ˆæ¸›å°‘å‹•ç•«å»¶é² */
@media (max-width: 768px) {
  .card {
    animation-delay: 0s !important;
  }
  
  .input, .select, .textarea {
    animation-delay: 0s !important;
  }
  
  .list li {
    animation-delay: 0s !important;
  }
}

/* è¼‰å…¥å‹•ç•« */
@keyframes loading {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

.btn:disabled::after {
  content: '';
  position: absolute;
  width: 20px;
  height: 20px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: loading 0.8s linear infinite;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}
</style>
</head>
<body>

<!-- HERO -->
<header class="hero wrap">
  <div class="safe">
    <span class="badge">ä¸€æ¬¡ä»˜æ¬¾ Â· è‡ªå‹•çºŒç´„ Â· å¯éš¨æ™‚å–æ¶ˆ</span>
    <h1 class="h1">å¡«å¯«ä»˜æ¬¾è³‡è¨Š</h1>
    <p class="lead">å®Œæˆä»¥ä¸‹è³‡è¨Šå³å¯é–‹å§‹ä½¿ç”¨ ReelMind</p>
  </div>
</header>

<main class="wrap" style="padding:28px 0">
  <div class="safe grid cols-2">

    <!-- å·¦ï¼šå¸³å‹™è³‡è¨Š -->
    <section class="card">
      <div class="body">
        <h2 class="h2">å¸³å‹™è³‡è¨Š</h2>
        
        <!-- æ–¹æ¡ˆæ‘˜è¦ -->
        <div class="plan-summary" id="planSummary">
          <div class="plan-name" id="summaryPlanName">æœˆè²»æ–¹æ¡ˆ</div>
          <div class="plan-price" id="summaryPlanPrice">NT$2,480</div>
          <div class="plan-desc" id="summaryPlanDesc">å½ˆæ€§æ–¹æ¡ˆï¼Œé©åˆçŸ­æœŸä½¿ç”¨è€…</div>
        </div>

        <div class="row">
          <input class="input" placeholder="å§“åï¼ˆæˆ–å…¬å¸æŠ¬é ­ï¼‰" id="name" required />
          <input class="input" placeholder="é›»å­ä¿¡ç®±ï¼ˆæ”¶æ“šèˆ‡é€šçŸ¥ï¼‰" id="email" type="email" required />
          <input class="input" placeholder="æ‰‹æ©Ÿï¼ˆé¸å¡«ï¼‰" id="phone" />
        </div>

        <div class="row" style="margin-top:8px">
          <select class="select" id="invoiceType">
            <option value="personal">ç™¼ç¥¨ï¼šå€‹äºº</option>
            <option value="company">ç™¼ç¥¨ï¼šå…¬å¸ï¼ˆçµ±ç·¨ï¼‰</option>
          </select>
          <input class="input" placeholder="çµ±ä¸€ç·¨è™Ÿï¼ˆé¸æ“‡å…¬å¸æ™‚å¡«å¯«ï¼‰" id="vat" />
        </div>

        <textarea class="textarea" id="note" placeholder="å‚™è¨»ï¼ˆé¸å¡«ï¼‰" style="margin-top:8px"></textarea>

        <div class="hr"></div>

        <div class="h3">ä»˜æ¬¾æ–¹å¼</div>
        <div class="payrow" style="margin-top:8px">
          <a class="paybtn" href="#" onclick="pay('card'); return false;">
            ğŸ’³ ä¿¡ç”¨å¡
            <span style="font-size: 0.85em; color: #64748b; margin-left: 8px;">ï¼ˆæ”¯æ´ LINE Payã€Apple Payã€ATMã€è¶…å•†ç­‰ï¼‰</span>
          </a>
        </div>

        <div class="row" style="margin-top:16px">
          <button class="btn blue" onclick="checkout()" style="width: 100%;">å‰å¾€ä»˜æ¬¾</button>
        </div>
        <div class="small" style="margin-top:10px; text-align: center;">ä»˜æ¬¾å³ä»£è¡¨åŒæ„<a href="#terms" class="link">æœå‹™æ¢æ¬¾èˆ‡é€€è²»æ”¿ç­–</a>ã€‚</div>
      </div>
    </section>

    <!-- å³ï¼šè¨‚å–®æ‘˜è¦ -->
    <section class="card">
      <div class="body">
        <h2 class="h2">è¨‚å–®æ‘˜è¦</h2>
        <div class="sum" aria-live="polite">
          <div class="line"><span id="sumPlan">æœˆè²»æ–¹æ¡ˆ</span><b id="sumPrice">NT$2,480</b></div>
          <div class="line"><span>æ‰‹çºŒè²»</span><b id="fee">NT$0</b></div>
          <div class="line" style="border-top:1px dashed #334155;margin-top:8px;padding-top:8px">
            <span><b>æ‡‰ä»˜é‡‘é¡</b></span><b id="total">NT$2,480</b>
          </div>
        </div>

        <div class="hr"></div>

        <h3 class="h3">æ–¹æ¡ˆå…§å®¹</h3>
        <ul class="list">
          <li>AI é¡§å•å°è©±ï¼šå®šä½ / ç¯€å¥ / è®Šç¾ Q&A</li>
          <li>AI ä¸€éµç”Ÿæˆï¼šHookã€å£æ’­ã€åˆ†é¡ã€CTA</li>
          <li>IP äººè¨­è¦åŠƒï¼šProfile + 14 å¤©å…§å®¹è¦åŠƒ</li>
          <li>å‰µä½œè€…è³‡æ–™åº«ï¼šPDF / CSV ä¸‹è¼‰ã€ç‰ˆæœ¬é‡ç”Ÿ</li>
          <li id="extraFeature" style="display:none;">å„ªå…ˆå®¢æœæ”¯æ´</li>
        </ul>

        <div class="hr"></div>

        <div class="small" style="line-height:1.6;">
          <strong>â€» æ‰€æœ‰æ–¹æ¡ˆçš†ç‚ºä¸€æ¬¡æ€§ä»˜æ¬¾ä¸¦è‡ªå‹•çºŒç´„ï¼Œå¯æ–¼ä¸‹æœŸå‰éš¨æ™‚å–æ¶ˆï¼Œä¸å¦æ”¶çºŒç´„æ‰‹çºŒè²»ã€‚</strong>
        </div>

        <div class="row" style="margin-top:16px">
          <a class="btn ghost" href="subscription.html" style="width: 100%; text-align: center;">â† è¿”å›é¸æ“‡æ–¹æ¡ˆ</a>
        </div>
      </div>
    </section>

  </div>
</main>

<footer class="ft">Â© 2025 ReelMind Â· AI çŸ­å½±éŸ³ï½œAI è…³æœ¬ç”Ÿæˆï½œAI é¡§å•ï½œIP äººè¨­è¦åŠƒ Â· å°ç£</footer>

<script>
  // åƒ¹æ ¼è¨­å®š
  const price = { monthly: 2480, yearly: 23760 };
  let currentPlan = 'monthly';

  function format(n){ return 'NT$' + n.toLocaleString('zh-Hant-TW'); }

  // å¾ URL åƒæ•¸è®€å–æ–¹æ¡ˆ
  function getUrlParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  // åˆå§‹åŒ–ï¼šæ ¹æ“š URL åƒæ•¸è¨­å®šæ–¹æ¡ˆ
  function initPlan() {
    const plan = getUrlParam('plan');
    if (plan === 'yearly' || plan === 'monthly') {
      currentPlan = plan;
      updatePlanDisplay();
    } else {
      // å¦‚æœæ²’æœ‰æ–¹æ¡ˆåƒæ•¸ï¼Œè·³è½‰å›é¸æ“‡é é¢
      window.location.href = 'subscription.html';
    }
  }

  // æ›´æ–°æ–¹æ¡ˆé¡¯ç¤º
  function updatePlanDisplay() {
    const isYearly = currentPlan === 'yearly';
    
    // æ›´æ–°æ–¹æ¡ˆæ‘˜è¦
    document.getElementById('summaryPlanName').textContent = isYearly ? 'å¹´è²»æ–¹æ¡ˆ ğŸ”¥' : 'æœˆè²»æ–¹æ¡ˆ';
    document.getElementById('summaryPlanPrice').textContent = format(price[currentPlan]);
    document.getElementById('summaryPlanDesc').textContent = isYearly 
      ? 'æœ€åˆ’ç®—ï¼Œç¯€çœ NT$5,000ï¼ˆ20% OFFï¼‰' 
      : 'å½ˆæ€§æ–¹æ¡ˆï¼Œé©åˆçŸ­æœŸä½¿ç”¨è€…';

    // æ›´æ–°è¨‚å–®æ‘˜è¦
    const planName = isYearly ? 'å¹´è²»æ–¹æ¡ˆï¼ˆçœ NT$5,000ï¼‰' : 'æœˆè²»æ–¹æ¡ˆ';
    document.getElementById('sumPlan').textContent = planName;
    document.getElementById('sumPrice').textContent = format(price[currentPlan]);
    document.getElementById('total').textContent = format(price[currentPlan]);

    // å¹´è²»æ–¹æ¡ˆé¡¯ç¤ºé¡å¤–åŠŸèƒ½
    const extraFeature = document.getElementById('extraFeature');
    if (extraFeature) {
      extraFeature.style.display = isYearly ? 'list-item' : 'none';
    }
  }

  async function checkout(){
    // ç™»å…¥æª¢æŸ¥
    try {
      var token = localStorage.getItem('ipPlanningToken') || '';
      if (!token) {
        alert('è«‹å…ˆç™»å…¥å¾Œå†è¨‚é–±');
        try { window.location.href = '/' + '#login'; } catch(_) {}
        return;
      }
    } catch(_) {}

    // æ”¶é›†è¨‚å–®è³‡æ–™
    const payload = {
      plan: currentPlan,
      amount: price[currentPlan],
      name: document.getElementById('name').value.trim(),
      email: document.getElementById('email').value.trim(),
      phone: document.getElementById('phone').value.trim(),
      invoiceType: document.getElementById('invoiceType').value,
      vat: document.getElementById('vat').value.trim(),
      note: document.getElementById('note').value.trim()
    };
    
    // å‰ç«¯é©—è­‰
    if(!payload.name || !payload.email){
      alert('è«‹å¡«å¯«å§“åèˆ‡é›»å­ä¿¡ç®±');
      return;
    }
    
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(payload.email)) {
      alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­ä¿¡ç®±');
      return;
    }
    
    if (payload.invoiceType === 'company' && !payload.vat) {
      alert('é¸æ“‡å…¬å¸ç™¼ç¥¨æ™‚ï¼Œè«‹å¡«å¯«çµ±ä¸€ç·¨è™Ÿ');
      return;
    }
    
    // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
    const checkoutBtn = document.querySelector('.btn.blue');
    const originalText = checkoutBtn.textContent;
    checkoutBtn.disabled = true;
    checkoutBtn.textContent = 'è™•ç†ä¸­...';
    
    try {
      const response = await fetch('https://aivideobackend.zeabur.app/api/payment/checkout', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      });
      
      if (response.ok) {
        const html = await response.text();
        document.body.innerHTML = html;
      } else {
        const errorData = await response.json().catch(() => ({ error: 'å»ºç«‹è¨‚å–®å¤±æ•—' }));
        alert(errorData.error || 'å»ºç«‹è¨‚å–®å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
        checkoutBtn.disabled = false;
        checkoutBtn.textContent = originalText;
      }
    } catch (error) {
      console.error('ä»˜æ¬¾éŒ¯èª¤:', error);
      alert('ä»˜æ¬¾è™•ç†å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
      checkoutBtn.disabled = false;
      checkoutBtn.textContent = originalText;
    }
  }

  function pay(kind){
    checkout();
  }

  // è™•ç†ä»˜æ¬¾çµæœé é¢
  window.addEventListener('DOMContentLoaded', async function() {
    initPlan();
    
    const urlParams = new URLSearchParams(window.location.search);
    const status = urlParams.get('status');
    const orderId = urlParams.get('order_id');
    const message = urlParams.get('message');
    
    if (status === 'success') {
      showPaymentSuccess(orderId);
    } else if (status === 'pending') {
      await showPaymentPending(orderId);
    } else if (status === 'failed' || status === 'error') {
      showPaymentError(message || 'ä»˜æ¬¾å¤±æ•—');
    }
  });
  
  async function showPaymentPending(orderId) {
    if (!orderId) {
      showPaymentError('è¨‚å–®ç·¨è™Ÿä¸å­˜åœ¨');
      return;
    }
    
    try {
      const token = localStorage.getItem('ipPlanningToken') || '';
      const response = await fetch(`https://aivideobackend.zeabur.app/api/user/orders`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      
      if (response.ok) {
        const data = await response.json();
        const order = data.orders?.find(o => o.order_id === orderId);
        
        if (order) {
          const paymentMethod = order.payment_method || '';
          const paymentCode = order.payment_code || '';
          const bankCode = order.bank_code || '';
          const expireDate = order.expire_date || '';
          
          const mainContent = document.querySelector('.safe.grid');
          if (mainContent) {
            mainContent.style.display = 'none';
          }
          
          let paymentInfoHTML = '';
          if (paymentMethod === 'ATM') {
            paymentInfoHTML = `
              <div style="background: #f8f9fa; padding: 24px; border-radius: 8px; margin: 24px 0;">
                <h3 class="h3" style="margin-bottom: 16px;">ATM è½‰å¸³è³‡è¨Š</h3>
                ${bankCode ? `<p class="sub" style="margin-bottom: 8px;"><strong>éŠ€è¡Œä»£ç¢¼ï¼š</strong>${bankCode}</p>` : ''}
                ${paymentCode ? `<p class="sub" style="margin-bottom: 8px;"><strong>è™›æ“¬å¸³è™Ÿï¼š</strong><code style="background: white; padding: 4px 8px; border-radius: 4px; font-size: 1.1em;">${paymentCode}</code></p>` : ''}
                ${expireDate ? `<p class="small" style="color: var(--red); margin-top: 16px;">âš ï¸ è«‹æ–¼ ${expireDate} å‰å®Œæˆè½‰å¸³</p>` : ''}
              </div>
            `;
          } else if (paymentMethod === 'CVS' || paymentMethod === 'BARCODE') {
            paymentInfoHTML = `
              <div style="background: #f8f9fa; padding: 24px; border-radius: 8px; margin: 24px 0;">
                <h3 class="h3" style="margin-bottom: 16px;">è¶…å•†ä»£ç¢¼</h3>
                ${paymentCode ? `<p class="sub" style="margin-bottom: 8px;"><strong>ä»˜æ¬¾ä»£ç¢¼ï¼š</strong><code style="background: white; padding: 4px 8px; border-radius: 4px; font-size: 1.1em;">${paymentCode}</code></p>` : ''}
                ${expireDate ? `<p class="small" style="color: var(--red); margin-top: 16px;">âš ï¸ è«‹æ–¼ ${expireDate} å‰è‡³è¶…å•†å®Œæˆä»˜æ¬¾</p>` : ''}
                <p class="small" style="margin-top: 16px;">è«‹è‡³ 7-11ã€å…¨å®¶ã€èŠçˆ¾å¯Œã€OK è¶…å•†ç­‰é–€å¸‚ï¼Œä½¿ç”¨å¤šåª’é«”æ©Ÿå°è¼¸å…¥ä»£ç¢¼å®Œæˆä»˜æ¬¾</p>
              </div>
            `;
          }
          
          const pendingHTML = `
            <div class="safe" style="margin-top: 40px;">
              <section class="card">
                <div class="body" style="text-align: center; padding: 40px 20px;">
                  <div style="font-size: 64px; margin-bottom: 20px;">â³</div>
                  <h2 class="h2" style="color: var(--warn); margin-bottom: 12px;">å–è™ŸæˆåŠŸï¼Œå¾…ä»˜æ¬¾</h2>
                  <p class="sub" style="margin-bottom: 24px;">è«‹ä¾ç…§ä¸‹æ–¹è³‡è¨Šå®Œæˆä»˜æ¬¾ï¼Œä»˜æ¬¾å®Œæˆå¾Œç³»çµ±å°‡è‡ªå‹•é–‹é€šæ‚¨çš„å¸³è™Ÿ</p>
                  ${orderId ? `<p class="small" style="margin-bottom: 24px;">è¨‚å–®ç·¨è™Ÿï¼š${orderId}</p>` : ''}
                  ${paymentInfoHTML}
                  <div class="row" style="justify-content: center; gap: 12px; margin-top: 24px;">
                    <button class="btn blue" onclick="window.location.href='/'">è¿”å›é¦–é </button>
                    <button class="btn ghost" onclick="checkOrderStatus('${orderId}')">æª¢æŸ¥ä»˜æ¬¾ç‹€æ…‹</button>
                  </div>
                </div>
              </section>
            </div>
          `;
          
          const container = document.querySelector('.wrap');
          if (container) {
            container.insertAdjacentHTML('beforeend', pendingHTML);
          }
        } else {
          showPaymentError('æ‰¾ä¸åˆ°è¨‚å–®è³‡è¨Š');
        }
      } else {
        showPaymentError('ç„¡æ³•æŸ¥è©¢è¨‚å–®è³‡è¨Š');
      }
    } catch (error) {
      console.error('æŸ¥è©¢è¨‚å–®å¤±æ•—:', error);
      showPaymentError('æŸ¥è©¢è¨‚å–®å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
    }
  }
  
  async function checkOrderStatus(orderId) {
    try {
      const token = localStorage.getItem('ipPlanningToken') || '';
      const response = await fetch(`https://aivideobackend.zeabur.app/api/user/orders`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      
      if (response.ok) {
        const data = await response.json();
        const order = data.orders?.find(o => o.order_id === orderId);
        
        if (order) {
          if (order.payment_status === 'paid') {
            alert('ä»˜æ¬¾æˆåŠŸï¼æ‚¨çš„å¸³è™Ÿå·²é–‹é€š');
            window.location.href = '/';
          } else {
            alert('å°šæœªå®Œæˆä»˜æ¬¾ï¼Œè«‹å®Œæˆä»˜æ¬¾å¾Œå†è©¦');
          }
        } else {
          alert('æ‰¾ä¸åˆ°è¨‚å–®è³‡è¨Š');
        }
      } else {
        alert('ç„¡æ³•æŸ¥è©¢è¨‚å–®ç‹€æ…‹');
      }
    } catch (error) {
      console.error('æª¢æŸ¥è¨‚å–®ç‹€æ…‹å¤±æ•—:', error);
      alert('æª¢æŸ¥è¨‚å–®ç‹€æ…‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
    }
  }
  
  function showPaymentSuccess(orderId) {
    const mainContent = document.querySelector('.safe.grid');
    if (mainContent) {
      mainContent.style.display = 'none';
    }
    
    const successHTML = `
      <div class="safe" style="margin-top: 40px;">
        <section class="card">
          <div class="body" style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 64px; margin-bottom: 20px;">âœ…</div>
            <h2 class="h2" style="color: var(--ok); margin-bottom: 12px;">ä»˜æ¬¾æˆåŠŸï¼</h2>
            <p class="sub" style="margin-bottom: 24px;">æ„Ÿè¬æ‚¨çš„è¨‚é–±ï¼Œæ‚¨çš„å¸³è™Ÿå·²é–‹é€šä½¿ç”¨æ¬Šé™</p>
            ${orderId ? `<p class="small" style="margin-bottom: 24px;">è¨‚å–®ç·¨è™Ÿï¼š${orderId}</p>` : ''}
            <div class="row" style="justify-content: center; gap: 12px;">
              <button class="btn blue" onclick="window.location.href='/'">é–‹å§‹ä½¿ç”¨</button>
              <button class="btn ghost" onclick="window.location.href='subscription.html'">æŸ¥çœ‹è¨‚å–®</button>
            </div>
          </div>
        </section>
      </div>
    `;
    
    const container = document.querySelector('.wrap');
    if (container) {
      container.insertAdjacentHTML('beforeend', successHTML);
    }
  }
  
  function showPaymentError(message) {
    const mainContent = document.querySelector('.safe.grid');
    if (mainContent) {
      mainContent.style.display = 'none';
    }
    
    const errorHTML = `
      <div class="safe" style="margin-top: 40px;">
        <section class="card">
          <div class="body" style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 64px; margin-bottom: 20px;">âŒ</div>
            <h2 class="h2" style="color: var(--red); margin-bottom: 12px;">ä»˜æ¬¾å¤±æ•—</h2>
            <p class="sub" style="margin-bottom: 24px;">${message}</p>
            <div class="row" style="justify-content: center; gap: 12px;">
              <button class="btn blue" onclick="window.location.href='checkout.html?plan=' + '${currentPlan}'">é‡æ–°ä»˜æ¬¾</button>
              <button class="btn ghost" onclick="window.location.href='subscription.html'">è¿”å›é¸æ“‡æ–¹æ¡ˆ</button>
            </div>
          </div>
        </section>
      </div>
    `;
    
    const container = document.querySelector('.wrap');
    if (container) {
      container.insertAdjacentHTML('beforeend', errorHTML);
    }
  }
</script>

</body>
</html>

