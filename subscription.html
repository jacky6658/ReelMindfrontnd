<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>ReelMind 訂閱方案</title>
    <style>
      body { font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; margin:0; background:#f8fafc; color:#0f172a; }
      .container { max-width: 920px; margin: 0 auto; padding: 24px; }
      .hero { background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 24px; margin-top: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
      .plans { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 16px; }
      .plan { background:white; border:1px solid #e2e8f0; border-radius:12px; padding:16px; }
      .plan h3 { margin: 0 0 6px 0; font-size: 18px; }
      .price { font-size: 28px; font-weight: 700; margin: 8px 0 12px 0; }
      .btn { display:inline-block; padding:10px 16px; background:#3b82f6; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:600; }
      .btn.secondary { background:#0ea5e9; }
      .btn:disabled { opacity:.6; cursor:not-allowed; }
      .features { margin: 8px 0 12px 0; color:#334155; font-size: 14px; }
      .notice { margin-top: 10px; color:#64748b; font-size: 13px; }
      @media (max-width: 768px) { .plans { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <link rel="stylesheet" href="/assets/css/main.css" />
    <script defer src="/assets/js/config.js"></script>
    <script defer src="/assets/js/auth.js"></script>
    <script defer src="/assets/js/api.js"></script>
    <script defer src="/assets/js/ui.js"></script>
    <script defer src="/assets/js/bootstrap.js"></script>
    <div class="container">
      <h1>加入 ReelMind 會員</h1>
      <div class="hero">
        <p>訂閱後即可無限使用「一鍵生成」「AI顧問」「IP 人設規劃」三大模式。</p>
        <div class="plans">
          <div class="plan" id="plan-monthly">
            <h3>月方案</h3>
            <div class="price">NT$ 3,980 / 月</div>
            <div class="features">
              - 三大模式無限次使用<br />
              - 創作者資料庫完整功能<br />
              - 基礎客服支援
            </div>
            <button class="btn" onclick="mockPurchase('monthly')">立即加入</button>
          </div>
          <div class="plan" id="plan-yearly">
            <h3>年方案</h3>
            <div class="price">NT$ 39,800 / 年</div>
            <div class="features">
              - 方案內容同上（年繳更划算）<br />
              - 優先客服支援
            </div>
            <button class="btn secondary" onclick="mockPurchase('yearly')">立即加入</button>
          </div>
        </div>
        <div class="notice">本頁為金流導購頁面。之後串接金流時，點擊「立即加入」改為導向金流，支付完成回調更新會員資格與到期日。</div>
      </div>
    </div>

    <script>
      (function initFromQuery(){
        const params = new URLSearchParams(location.search);
        const plan = params.get('plan');
        if (plan === 'yearly') {
          document.getElementById('plan-yearly').scrollIntoView({behavior:'smooth'});
        } else if (plan === 'monthly') {
          document.getElementById('plan-monthly').scrollIntoView({behavior:'smooth'});
        }
      })();

      async function mockPurchase(plan) {
        // TODO: 串接金流後改為導向第三方支付，支付成功再回到 callback
        try {
          const userStr = localStorage.getItem('ipPlanningUser');
          if (!userStr) {
            alert('請先登入後再訂閱');
            return;
          }
          const user = JSON.parse(userStr);
          // 通知後端（準備用回調端點）
          try {
            await fetch('https://aivideobackend.zeabur.app/api/payment/callback', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                user_id: user.user_id,
                plan,
                transaction_id: 'TEST-' + Date.now(),
                amount: plan === 'yearly' ? 39800 : 3980,
                paid_at: new Date().toISOString()
              })
            }).catch(() => {});
          } catch (_) {}
          user.is_subscribed = true;
          // 設置到期日（月/年）供前端顯示（實際以後端為準）
          const now = new Date();
          if (plan === 'yearly') {
            now.setFullYear(now.getFullYear() + 1);
          } else {
            now.setMonth(now.getMonth() + 1);
          }
          user.subscription = { plan, expires_at: now.toISOString() };
          localStorage.setItem('ipPlanningUser', JSON.stringify(user));
          localStorage.setItem('ipPlanningTokenUpdated', Date.now().toString());
          alert('感謝加入！您的訂閱已啟用（測試模式）');
          // 回首頁
          window.location.href = '/';
        } catch (e) {
          console.warn('mockPurchase error:', e);
        }
      }
    </script>
  </body>
</html>

<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>訂閱 ReelMind｜付費即使用，無免費體驗</title>
<meta name="description" content="ReelMind 單一訂閱制：AI 顧問、AI 一鍵生成、IP 人設規劃與創作者資料庫。付費即使用，無免費體驗。支援綠界 ECPay。">
<meta name="theme-color" content="#2563EB" />
<style>
:root{
  --bg:#F8FAFC; --ink:#0F172A; --sub:#475569; --line:#E2E8F0; --card:#FFFFFF;
  --blue:#2563EB; --blue-deep:#1D4ED8; --ok:#16A34A; --warn:#F59E0B; --red:#DC2626;
  --shadow:0 16px 40px rgba(2,6,23,.08); --r:16px;
}
*{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--ink);-webkit-font-smoothing:antialiased}
body{font-family:ui-sans-serif,system-ui,-apple-system,"Noto Sans TC","PingFang TC",Segoe UI,Roboto,Arial}
a{text-decoration:none;color:inherit}
.wrap{width:100%} .safe{max-width:1120px;margin:0 auto;padding:0 16px}
.hero{padding:56px 0 24px;background:
  radial-gradient(900px 320px at 90% -10%, rgba(37,99,235,.12), transparent 60%),
  radial-gradient(600px 260px at 8% -10%, rgba(59,130,246,.10), transparent 60%);
  border-bottom:1px solid var(--line)}
.h1{font-size:32px;line-height:1.2;margin:0 0 6px}
.lead{color:var(--sub);margin:0}
.badge{display:inline-flex;gap:8px;align-items:center;background:#E0F2FE;color:#075985;padding:8px 12px;border-radius:999px;font-weight:800;font-size:12px;margin-bottom:10px}
.notice{display:flex;gap:8px;align-items:center;color:#0F172A;background:#FEF3C7;border:1px solid #FDE68A;border-radius:12px;padding:8px 12px;margin-top:12px;font-weight:700}
.grid{display:grid;gap:16px}
@media(min-width:980px){.cols-2{grid-template-columns:1.1fr 1fr}}
.card{background:var(--card);border-radius:var(--r);box-shadow:var(--shadow);border:1px solid var(--line)}
.card .body{padding:18px}
.h2{font-size:22px;font-weight:900;margin:0 0 8px}
.h3{font-size:18px;font-weight:900;margin:0 0 6px}
.hr{height:1px;background:linear-gradient(90deg,transparent,var(--line),transparent);margin:12px 0}
.sub{color:var(--sub)}
.list{padding-left:18px;margin:8px 0} .list li{margin:6px 0;color:var(--sub)}
.kv{display:flex;align-items:center;gap:8px}
.price{font-size:34px;font-weight:900}
.switch{display:flex;gap:8px;background:#F1F5F9;border:1px solid #E2E8F0;border-radius:999px;padding:6px}
.switch button{height:40px;padding:0 14px;border-radius:999px;border:none;font-weight:800;color:#334155;background:transparent;cursor:pointer}
.switch button.active{background:var(--card);box-shadow:0 6px 16px rgba(2,6,23,.08)}
.row{display:flex;gap:10px;flex-wrap:wrap}
.input{width:100%;height:44px;border:1px solid #CBD5E1;border-radius:10px;padding:10px 12px;font-size:14px}
.select{width:100%;height:44px;border:1px solid #CBD5E1;border-radius:10px;padding:10px 12px;background:#fff}
.textarea{width:100%;min-height:88px;border:1px solid #CBD5E1;border-radius:12px;padding:12px}
.btn{display:inline-flex;align-items:center;justify-content:center;height:48px;padding:0 18px;border-radius:999px;font-weight:900;cursor:pointer}
.btn.blue{background:var(--blue);color:#fff}.btn.blue:hover{background:var(--blue-deep)}
.btn.ghost{border:1px solid #CBD5E1;background:#fff;color:#334155}
.payrow{display:grid;gap:10px}
.paybtn{width:100%;height:48px;border:1px solid #CBD5E1;border-radius:12px;background:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;gap:8px;cursor:pointer}
.sum{background:#0B1220;color:#E5E7EB;border-radius:14px;padding:12px}
.sum .line{display:flex;justify-content:space-between;margin:6px 0}
.faq{background:#FFF;border:1px solid var(--line);border-radius:16px;padding:14px}
.ft{padding:24px 0;color:#64748B;text-align:center;border-top:1px solid var(--line);font-size:14px}
.small{font-size:12px;color:#64748B}
</style>
</head>
<body>

<!-- HERO -->
<header class="hero wrap">
  <div class="safe">
    <span class="badge">單一訂閱制 · 不分等級 · 付費即使用</span>
    <h1 class="h1">訂閱 ReelMind，解鎖你的 AI 創作系統</h1>
    <p class="lead">包含 AI 顧問、AI 一鍵生成、IP 人設規劃與創作者資料庫。支援 ECPay（綠界）付款。</p>
    <div class="notice">⚠️ 無免費體驗｜成功付款即開通使用權</div>
  </div>
</header>

<main class="wrap" style="padding:28px 0">
  <div class="safe grid cols-2">

    <!-- 左：方案與付款 -->
    <section class="card">
      <div class="body">
        <div class="kv" style="justify-content:space-between">
          <h2 class="h2">選擇方案</h2>
          <div class="switch" role="tablist" aria-label="plan switch">
            <button id="mPlan" class="active" onclick="setPlan('monthly')" aria-selected="true">月費方案</button>
            <button id="yPlan" onclick="setPlan('yearly')" aria-selected="false">年費方案</button>
          </div>
        </div>

        <div id="planBox" style="margin-top:10px">
          <div class="h3" id="planName">月費方案</div>
          <div class="price" id="planPrice">NT$3,980</div>
          <div class="sub" id="planDesc">每月訂閱，可隨時續訂；不分等級、功能完整。</div>
          <div class="hr"></div>
          <ul class="list">
            <li>AI 顧問對話：定位 / 節奏 / 變現 Q&A</li>
            <li>AI 一鍵生成：Hook、口播、分鏡、CTA</li>
            <li>IP 人設規劃：Profile + 14 天內容規劃</li>
            <li>創作者資料庫：PDF / CSV 下載、版本重生</li>
          </ul>
        </div>

        <div class="hr"></div>

        <div class="h3">付款方式</div>
        <div class="payrow" style="margin-top:8px">
          <!-- 把這些改成你實際的付款連結或觸發 JS -->
          <a class="paybtn" href="#" onclick="pay('ecpay')">
            <img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/72/Ecpay_logo.svg/120px-Ecpay_logo.svg.png" style="height:18px" />
            綠界 ECPay（信用卡）
          </a>
          <a class="paybtn" href="#" onclick="pay('card')">信用卡（備用）</a>
          <a class="paybtn" href="#" onclick="pay('redeem')">兌換序號</a>
        </div>

        <div class="small" style="margin-top:10px">付款即代表同意<a href="#terms" class="link">服務條款與退費政策</a>。</div>
      </div>
    </section>

    <!-- 右：帳務資訊 / 訂單摘要 -->
    <section class="card">
      <div class="body">
        <h2 class="h2">帳務資訊</h2>
        <div class="row">
          <input class="input" placeholder="姓名（或公司抬頭）" id="name" />
          <input class="input" placeholder="電子信箱（收據與通知）" id="email" type="email" />
          <input class="input" placeholder="手機（選填）" id="phone" />
        </div>

        <div class="row" style="margin-top:8px">
          <select class="select" id="invoiceType">
            <option value="personal">發票：個人</option>
            <option value="company">發票：公司（統編）</option>
          </select>
          <input class="input" placeholder="統一編號（選擇公司時填寫）" id="vat" />
        </div>

        <textarea class="textarea" id="note" placeholder="備註（選填）" style="margin-top:8px"></textarea>

        <div class="hr"></div>

        <div class="h3">訂單摘要</div>
        <div class="sum" aria-live="polite">
          <div class="line"><span id="sumPlan">月費方案</span><b id="sumPrice">NT$3,980</b></div>
          <div class="line"><span>手續費</span><b id="fee">NT$0</b></div>
          <div class="line" style="border-top:1px dashed #334155;margin-top:8px;padding-top:8px">
            <span><b>應付金額</b></span><b id="total">NT$3,980</b>
          </div>
        </div>

        <div class="row" style="margin-top:12px">
          <button class="btn blue" onclick="checkout()">前往付款</button>
          <a class="btn ghost" href="/#login" onclick="(function(){ try{ window.location.href='/' + '#login'; }catch(_){ } return false; })();">已訂閱？登入使用</a>
        </div>
      </div>
    </section>

  </div>

  <!-- FAQ / 條款 -->
  <div class="safe" style="margin-top:18px">
    <section class="faq" id="terms">
      <h2 class="h2">常見問題與條款</h2>
      <p><b>Q：是否有免費試用？</b><br/>A：沒有。付費即使用，無免費體驗。</p>
      <p><b>Q：訂閱包含哪些功能？</b><br/>A：AI 顧問、AI 一鍵生成、IP 人設規劃與創作者資料庫；不分等級、功能完整。</p>
      <p><b>Q：如何開立發票？</b><br/>A：付款後將於 3–5 個工作日寄送電子發票至你的信箱。</p>
      <p class="small">退費政策：數位服務一經啟用恕不退款（法規另有規定者除外）。若扣款或開通發生問題，請來信 <a href="mailto:hello@aijob.com.tw">hello@aijob.com.tw</a>。</p>
    </section>
  </div>
</main>

<footer class="ft">© 2025 ReelMind · AI 短影音｜AI 腳本生成｜AI 顧問｜IP 人設規劃 · 台灣</footer>

<script>
  // 價格設定（如未來調整，改這裡即可）
  const price = { monthly: 3980, yearly: 39800 };
  let current = 'monthly';

  function format(n){ return 'NT$' + n.toLocaleString('zh-Hant-TW'); }

  function setPlan(p){
    current = p;
    document.getElementById('mPlan').classList.toggle('active', p==='monthly');
    document.getElementById('yPlan').classList.toggle('active', p==='yearly');

    const name = p==='monthly' ? '月費方案' : '年費方案（省 NT$7,960）';
    const desc = p==='monthly'
      ? '每月訂閱，可隨時續訂；不分等級、功能完整。'
      : '一次結清 12 個月；不分等級、功能完整。';
    document.getElementById('planName').textContent = name;
    document.getElementById('planPrice').textContent = format(price[p]);
    document.getElementById('planDesc').textContent = desc;
    document.getElementById('sumPlan').textContent = name;
    document.getElementById('sumPrice').textContent = format(price[p]);
    document.getElementById('total').textContent = format(price[p]);
  }

  // 從 URL 參數讀取方案
  function getUrlParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  async function checkout(){
    // 登入檢查：未登入先導回登入畫面
    try {
      var token = localStorage.getItem('ipPlanningToken') || '';
      if (!token) {
        alert('請先登入後再訂閱');
        try { window.location.href = '/' + '#login'; } catch(_) {}
        return;
      }
    } catch(_) {}

    // 收集訂單資料
    const plan = current;
    const payload = {
      plan,
      amount: price[plan],
      name: document.getElementById('name').value.trim(),
      email: document.getElementById('email').value.trim(),
      phone: document.getElementById('phone').value.trim(),
      invoiceType: document.getElementById('invoiceType').value,
      vat: document.getElementById('vat').value.trim(),
      note: document.getElementById('note').value.trim()
    };
    
    // 前端簡單檢查
    if(!payload.name || !payload.email){
      alert('請填寫姓名與電子信箱');
      return;
    }
    
    // 驗證 Email 格式
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(payload.email)) {
      alert('請輸入有效的電子信箱');
      return;
    }
    
    // 如果選擇公司發票，檢查統編
    if (payload.invoiceType === 'company' && !payload.vat) {
      alert('選擇公司發票時，請填寫統一編號');
      return;
    }
    
    // 顯示載入狀態
    const checkoutBtn = document.querySelector('.btn.blue');
    const originalText = checkoutBtn.textContent;
    checkoutBtn.disabled = true;
    checkoutBtn.textContent = '處理中...';
    
    try {
      // 調用後端 API 建立訂單
      const response = await fetch('https://aivideobackend.zeabur.app/api/payment/checkout', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      });
      
      if (response.ok) {
        // 後端返回 HTML 表單，直接顯示（會自動提交到 ECPay）
        const html = await response.text();
        document.body.innerHTML = html;
      } else {
        const errorData = await response.json().catch(() => ({ error: '建立訂單失敗' }));
        alert(errorData.error || '建立訂單失敗，請稍後再試');
        checkoutBtn.disabled = false;
        checkoutBtn.textContent = originalText;
      }
    } catch (error) {
      console.error('付款錯誤:', error);
      alert('付款處理失敗，請稍後再試');
      checkoutBtn.disabled = false;
      checkoutBtn.textContent = originalText;
    }
  }

  function pay(kind){
    if(kind==='redeem'){
      const code = prompt('請輸入序號進行兌換：');
      if(!code) return;
      // TODO: 呼叫你的後端兌換 API
      alert('已送出序號：' + code + '（請接上後端驗證與開通邏輯）');
      return;
    }
    // 其他支付方式可以共用 checkout()
    checkout();
  }

  // 初始化：從 URL 參數讀取方案，如果沒有則預設為月費
  const urlPlan = getUrlParam('plan');
  const initialPlan = urlPlan === 'yearly' ? 'yearly' : 'monthly';
  setPlan(initialPlan);
  
  // 處理付款結果頁面
  window.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const status = urlParams.get('status');
    const orderId = urlParams.get('order_id');
    const message = urlParams.get('message');
    
    if (status === 'success') {
      showPaymentSuccess(orderId);
    } else if (status === 'failed' || status === 'error') {
      showPaymentError(message || '付款失敗');
    }
  });
  
  function showPaymentSuccess(orderId) {
    // 隱藏原有內容
    const mainContent = document.querySelector('.safe.grid');
    if (mainContent) {
      mainContent.style.display = 'none';
    }
    
    // 顯示成功訊息
    const successHTML = `
      <div class="safe" style="margin-top: 40px;">
        <section class="card">
          <div class="body" style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 64px; margin-bottom: 20px;">✅</div>
            <h2 class="h2" style="color: var(--ok); margin-bottom: 12px;">付款成功！</h2>
            <p class="sub" style="margin-bottom: 24px;">感謝您的訂閱，您的帳號已開通使用權限</p>
            ${orderId ? `<p class="small" style="margin-bottom: 24px;">訂單編號：${orderId}</p>` : ''}
            <div class="row" style="justify-content: center; gap: 12px;">
              <button class="btn blue" onclick="window.location.href='/'">開始使用</button>
              <button class="btn ghost" onclick="window.location.href='/subscription.html'">查看訂單</button>
            </div>
          </div>
        </section>
      </div>
    `;
    
    const container = document.querySelector('.wrap');
    if (container) {
      container.insertAdjacentHTML('beforeend', successHTML);
    }
  }
  
  function showPaymentError(message) {
    // 隱藏原有內容
    const mainContent = document.querySelector('.safe.grid');
    if (mainContent) {
      mainContent.style.display = 'none';
    }
    
    // 顯示錯誤訊息
    const errorHTML = `
      <div class="safe" style="margin-top: 40px;">
        <section class="card">
          <div class="body" style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 64px; margin-bottom: 20px;">❌</div>
            <h2 class="h2" style="color: var(--red); margin-bottom: 12px;">付款失敗</h2>
            <p class="sub" style="margin-bottom: 24px;">${message}</p>
            <div class="row" style="justify-content: center; gap: 12px;">
              <button class="btn blue" onclick="window.location.href='/subscription.html'">重新付款</button>
              <button class="btn ghost" onclick="window.location.href='/'">返回首頁</button>
            </div>
            <p class="small" style="margin-top: 24px;">
              如有問題，請聯繫客服：<a href="mailto:hello@aijob.com.tw">hello@aijob.com.tw</a>
            </p>
          </div>
        </section>
      </div>
    `;
    
    const container = document.querySelector('.wrap');
    if (container) {
      container.insertAdjacentHTML('beforeend', errorHTML);
    }
  }
</script>

</body>
</html>
