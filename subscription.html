<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>ReelMind è¨‚é–±æ–¹æ¡ˆ</title>
    <style>
      body { font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; margin:0; background:#f8fafc; color:#0f172a; }
      .container { max-width: 920px; margin: 0 auto; padding: 24px; }
      .hero { background: white; border: 1px solid #e2e8f0; border-radius: 12px; padding: 24px; margin-top: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
      .plans { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 16px; }
      .plan { background:white; border:1px solid #e2e8f0; border-radius:12px; padding:16px; }
      .plan h3 { margin: 0 0 6px 0; font-size: 18px; }
      .price { font-size: 28px; font-weight: 700; margin: 8px 0 12px 0; }
      .btn { display:inline-block; padding:10px 16px; background:#3b82f6; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:600; }
      .btn.secondary { background:#0ea5e9; }
      .btn:disabled { opacity:.6; cursor:not-allowed; }
      .features { margin: 8px 0 12px 0; color:#334155; font-size: 14px; }
      .notice { margin-top: 10px; color:#64748b; font-size: 13px; }
      @media (max-width: 768px) { .plans { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <link rel="stylesheet" href="/assets/css/main.css" />
    <script defer src="/assets/js/config.js"></script>
    <script defer src="/assets/js/auth.js"></script>
    <script defer src="/assets/js/api.js"></script>
    <script defer src="/assets/js/ui.js"></script>
    <script defer src="/assets/js/bootstrap.js"></script>
    <div class="container">
      <h1>åŠ å…¥ ReelMind æœƒå“¡</h1>
      <div class="hero">
        <p>è¨‚é–±å¾Œå³å¯ç„¡é™ä½¿ç”¨ã€Œä¸€éµç”Ÿæˆã€ã€ŒAIé¡§å•ã€ã€ŒIP äººè¨­è¦åŠƒã€ä¸‰å¤§æ¨¡å¼ã€‚</p>
        <div class="plans">
          <div class="plan" id="plan-monthly">
            <h3>æœˆæ–¹æ¡ˆ</h3>
            <div class="price">NT$ 3,980 / æœˆ</div>
            <div class="features">
              - ä¸‰å¤§æ¨¡å¼ç„¡é™æ¬¡ä½¿ç”¨<br />
              - å‰µä½œè€…è³‡æ–™åº«å®Œæ•´åŠŸèƒ½<br />
              - åŸºç¤å®¢æœæ”¯æ´
            </div>
            <button class="btn" onclick="scrollToSubscription()">ç«‹å³åŠ å…¥</button>
          </div>
          <div class="plan" id="plan-yearly">
            <h3>å¹´æ–¹æ¡ˆ</h3>
            <div class="price">NT$ 39,800 / å¹´</div>
            <div class="features">
              - æ–¹æ¡ˆå…§å®¹åŒä¸Šï¼ˆå¹´ç¹³æ›´åˆ’ç®—ï¼‰<br />
              - å„ªå…ˆå®¢æœæ”¯æ´
            </div>
            <button class="btn secondary" onclick="scrollToSubscription()">ç«‹å³åŠ å…¥</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      (function initFromQuery(){
        const params = new URLSearchParams(location.search);
        const plan = params.get('plan');
        if (plan === 'yearly') {
          document.getElementById('plan-yearly').scrollIntoView({behavior:'smooth'});
        } else if (plan === 'monthly') {
          document.getElementById('plan-monthly').scrollIntoView({behavior:'smooth'});
        }
      })();

      function scrollToSubscription() {
        const subscriptionSection = document.getElementById('subscription-section');
        if (subscriptionSection) {
          subscriptionSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }

      async function mockPurchase(plan) {
        // TODO: ä¸²æ¥é‡‘æµå¾Œæ”¹ç‚ºå°å‘ç¬¬ä¸‰æ–¹æ”¯ä»˜ï¼Œæ”¯ä»˜æˆåŠŸå†å›åˆ° callback
        try {
          const userStr = localStorage.getItem('ipPlanningUser');
          if (!userStr) {
            alert('è«‹å…ˆç™»å…¥å¾Œå†è¨‚é–±');
            return;
          }
          const user = JSON.parse(userStr);
          // é€šçŸ¥å¾Œç«¯ï¼ˆæº–å‚™ç”¨å›èª¿ç«¯é»ï¼‰
          try {
            await fetch('https://aivideobackend.zeabur.app/api/payment/callback', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                user_id: user.user_id,
                plan,
                transaction_id: 'TEST-' + Date.now(),
                amount: plan === 'yearly' ? 39800 : 3980,
                paid_at: new Date().toISOString()
              })
            }).catch(() => {});
          } catch (_) {}
          user.is_subscribed = true;
          // è¨­ç½®åˆ°æœŸæ—¥ï¼ˆæœˆ/å¹´ï¼‰ä¾›å‰ç«¯é¡¯ç¤ºï¼ˆå¯¦éš›ä»¥å¾Œç«¯ç‚ºæº–ï¼‰
          const now = new Date();
          if (plan === 'yearly') {
            now.setFullYear(now.getFullYear() + 1);
          } else {
            now.setMonth(now.getMonth() + 1);
          }
          user.subscription = { plan, expires_at: now.toISOString() };
          localStorage.setItem('ipPlanningUser', JSON.stringify(user));
          localStorage.setItem('ipPlanningTokenUpdated', Date.now().toString());
          alert('æ„Ÿè¬åŠ å…¥ï¼æ‚¨çš„è¨‚é–±å·²å•Ÿç”¨ï¼ˆæ¸¬è©¦æ¨¡å¼ï¼‰');
          // å›é¦–é 
          window.location.href = '/';
        } catch (e) {
          console.warn('mockPurchase error:', e);
        }
      }
    </script>
  </body>
</html>

<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>è¨‚é–± ReelMindï½œä»˜è²»å³ä½¿ç”¨ï¼Œç„¡å…è²»é«”é©—</title>
<meta name="description" content="ReelMind å–®ä¸€è¨‚é–±åˆ¶ï¼šAI é¡§å•ã€AI ä¸€éµç”Ÿæˆã€IP äººè¨­è¦åŠƒèˆ‡å‰µä½œè€…è³‡æ–™åº«ã€‚ä»˜è²»å³ä½¿ç”¨ï¼Œç„¡å…è²»é«”é©—ã€‚æ”¯æ´ä¿¡ç”¨å¡ã€LINE Payã€Apple Pay ç­‰å¤šç¨®æ”¯ä»˜æ–¹å¼ã€‚">
<meta name="theme-color" content="#2563EB" />
<style>
:root{
  --bg:#F8FAFC; --ink:#0F172A; --sub:#475569; --line:#E2E8F0; --card:#FFFFFF;
  --blue:#2563EB; --blue-deep:#1D4ED8; --ok:#16A34A; --warn:#F59E0B; --red:#DC2626;
  --shadow:0 16px 40px rgba(2,6,23,.08); --r:16px;
}
*{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--ink);-webkit-font-smoothing:antialiased}
body{font-family:ui-sans-serif,system-ui,-apple-system,"Noto Sans TC","PingFang TC",Segoe UI,Roboto,Arial}
a{text-decoration:none;color:inherit}
.wrap{width:100%} .safe{max-width:1120px;margin:0 auto;padding:0 16px}
.hero{padding:56px 0 24px;background:
  radial-gradient(900px 320px at 90% -10%, rgba(37,99,235,.12), transparent 60%),
  radial-gradient(600px 260px at 8% -10%, rgba(59,130,246,.10), transparent 60%);
  border-bottom:1px solid var(--line)}
.h1{font-size:32px;line-height:1.2;margin:0 0 6px}
.lead{color:var(--sub);margin:0}
.badge{display:inline-flex;gap:8px;align-items:center;background:#E0F2FE;color:#075985;padding:8px 12px;border-radius:999px;font-weight:800;font-size:12px;margin-bottom:10px}
.notice{display:flex;gap:8px;align-items:center;color:#0F172A;background:#FEF3C7;border:1px solid #FDE68A;border-radius:12px;padding:8px 12px;margin-top:12px;font-weight:700}
.grid{display:grid;gap:16px}
@media(min-width:980px){.cols-2{grid-template-columns:1.1fr 1fr}}
.card{background:var(--card);border-radius:var(--r);box-shadow:var(--shadow);border:1px solid var(--line)}
.card .body{padding:18px}
.h2{font-size:22px;font-weight:900;margin:0 0 8px}
.h3{font-size:18px;font-weight:900;margin:0 0 6px}
.hr{height:1px;background:linear-gradient(90deg,transparent,var(--line),transparent);margin:12px 0}
.sub{color:var(--sub)}
.list{padding-left:18px;margin:8px 0} .list li{margin:6px 0;color:var(--sub)}
.kv{display:flex;align-items:center;gap:8px}
.price{font-size:34px;font-weight:900}
.switch{display:flex;gap:8px;background:#F1F5F9;border:1px solid #E2E8F0;border-radius:999px;padding:6px}
.switch button{height:40px;padding:0 14px;border-radius:999px;border:none;font-weight:800;color:#334155;background:transparent;cursor:pointer}
.switch button.active{background:var(--card);box-shadow:0 6px 16px rgba(2,6,23,.08)}
.row{display:flex;gap:10px;flex-wrap:wrap}
.input{width:100%;height:44px;border:1px solid #CBD5E1;border-radius:10px;padding:10px 12px;font-size:14px}
.select{width:100%;height:44px;border:1px solid #CBD5E1;border-radius:10px;padding:10px 12px;background:#fff}
.textarea{width:100%;min-height:88px;border:1px solid #CBD5E1;border-radius:12px;padding:12px}
.btn{display:inline-flex;align-items:center;justify-content:center;height:48px;padding:0 18px;border-radius:999px;font-weight:900;cursor:pointer}
.btn.blue{background:var(--blue);color:#fff}.btn.blue:hover{background:var(--blue-deep)}
.btn.ghost{border:1px solid #CBD5E1;background:#fff;color:#334155}
.payrow{display:grid;gap:10px}
.paybtn{width:100%;height:48px;border:1px solid #CBD5E1;border-radius:12px;background:#fff;display:flex;align-items:center;justify-content:center;font-weight:800;gap:8px;cursor:pointer}
.sum{background:#0B1220;color:#E5E7EB;border-radius:14px;padding:12px}
.sum .line{display:flex;justify-content:space-between;margin:6px 0}
.faq{background:#FFF;border:1px solid var(--line);border-radius:16px;padding:14px}
.ft{padding:24px 0;color:#64748B;text-align:center;border-top:1px solid var(--line);font-size:14px}
.small{font-size:12px;color:#64748B}
</style>
</head>
<body>

<!-- HERO -->
<header class="hero wrap" id="subscription-section">
  <div class="safe">
    <span class="badge">å–®ä¸€è¨‚é–±åˆ¶ Â· ä¸åˆ†ç­‰ç´š Â· ä»˜è²»å³ä½¿ç”¨</span>
    <h1 class="h1">è¨‚é–± ReelMindï¼Œè§£é–ä½ çš„ AI å‰µä½œç³»çµ±</h1>
    <p class="lead">åŒ…å« AI é¡§å•ã€AI ä¸€éµç”Ÿæˆã€IP äººè¨­è¦åŠƒèˆ‡å‰µä½œè€…è³‡æ–™åº«ã€‚æ”¯æ´ä¿¡ç”¨å¡ã€LINE Payã€Apple Pay ç­‰å¤šç¨®æ”¯ä»˜æ–¹å¼ã€‚</p>
  </div>
</header>

<main class="wrap" style="padding:28px 0">
  <div class="safe grid cols-2">

    <!-- å·¦ï¼šæ–¹æ¡ˆèˆ‡ä»˜æ¬¾ -->
    <section class="card">
      <div class="body">
        <div class="kv" style="justify-content:space-between">
          <h2 class="h2">é¸æ“‡æ–¹æ¡ˆ</h2>
          <div class="switch" role="tablist" aria-label="plan switch">
            <button id="mPlan" class="active" onclick="setPlan('monthly')" aria-selected="true">æœˆè²»æ–¹æ¡ˆ</button>
            <button id="yPlan" onclick="setPlan('yearly')" aria-selected="false">å¹´è²»æ–¹æ¡ˆ</button>
          </div>
        </div>

        <div id="planBox" style="margin-top:10px">
          <div class="h3" id="planName">æœˆè²»æ–¹æ¡ˆ</div>
          <div class="price" id="planPrice">NT$3,980</div>
          <div class="sub" id="planDesc">æ¯æœˆè¨‚é–±ï¼Œå¯éš¨æ™‚çºŒè¨‚ï¼›ä¸åˆ†ç­‰ç´šã€åŠŸèƒ½å®Œæ•´ã€‚</div>
          <div class="hr"></div>
          <ul class="list">
            <li>AI é¡§å•å°è©±ï¼šå®šä½ / ç¯€å¥ / è®Šç¾ Q&A</li>
            <li>AI ä¸€éµç”Ÿæˆï¼šHookã€å£æ’­ã€åˆ†é¡ã€CTA</li>
            <li>IP äººè¨­è¦åŠƒï¼šProfile + 14 å¤©å…§å®¹è¦åŠƒ</li>
            <li>å‰µä½œè€…è³‡æ–™åº«ï¼šPDF / CSV ä¸‹è¼‰ã€ç‰ˆæœ¬é‡ç”Ÿ</li>
          </ul>
        </div>

        <div class="hr"></div>

        <div class="h3">ä»˜æ¬¾æ–¹å¼</div>
        <div class="payrow" style="margin-top:8px">
          <a class="paybtn" href="#" onclick="pay('card')">
            ğŸ’³ ä¿¡ç”¨å¡
            <span style="font-size: 0.85em; color: #64748b; margin-left: 8px;">ï¼ˆæ”¯æ´ LINE Payã€Apple Payã€ATMã€è¶…å•†ç­‰ï¼‰</span>
          </a>
        </div>

        <div class="small" style="margin-top:10px">ä»˜æ¬¾å³ä»£è¡¨åŒæ„<a href="#terms" class="link">æœå‹™æ¢æ¬¾èˆ‡é€€è²»æ”¿ç­–</a>ã€‚</div>
      </div>
    </section>

    <!-- å³ï¼šå¸³å‹™è³‡è¨Š / è¨‚å–®æ‘˜è¦ -->
    <section class="card">
      <div class="body">
        <h2 class="h2">å¸³å‹™è³‡è¨Š</h2>
        <div class="row">
          <input class="input" placeholder="å§“åï¼ˆæˆ–å…¬å¸æŠ¬é ­ï¼‰" id="name" />
          <input class="input" placeholder="é›»å­ä¿¡ç®±ï¼ˆæ”¶æ“šèˆ‡é€šçŸ¥ï¼‰" id="email" type="email" />
          <input class="input" placeholder="æ‰‹æ©Ÿï¼ˆé¸å¡«ï¼‰" id="phone" />
        </div>

        <div class="row" style="margin-top:8px">
          <select class="select" id="invoiceType">
            <option value="personal">ç™¼ç¥¨ï¼šå€‹äºº</option>
            <option value="company">ç™¼ç¥¨ï¼šå…¬å¸ï¼ˆçµ±ç·¨ï¼‰</option>
          </select>
          <input class="input" placeholder="çµ±ä¸€ç·¨è™Ÿï¼ˆé¸æ“‡å…¬å¸æ™‚å¡«å¯«ï¼‰" id="vat" />
        </div>

        <textarea class="textarea" id="note" placeholder="å‚™è¨»ï¼ˆé¸å¡«ï¼‰" style="margin-top:8px"></textarea>

        <div class="hr"></div>

        <div class="h3">è¨‚å–®æ‘˜è¦</div>
        <div class="sum" aria-live="polite">
          <div class="line"><span id="sumPlan">æœˆè²»æ–¹æ¡ˆ</span><b id="sumPrice">NT$3,980</b></div>
          <div class="line"><span>æ‰‹çºŒè²»</span><b id="fee">NT$0</b></div>
          <div class="line" style="border-top:1px dashed #334155;margin-top:8px;padding-top:8px">
            <span><b>æ‡‰ä»˜é‡‘é¡</b></span><b id="total">NT$3,980</b>
          </div>
        </div>

        <div class="row" style="margin-top:12px">
          <button class="btn blue" onclick="checkout()">å‰å¾€ä»˜æ¬¾</button>
          <a class="btn ghost" href="/#login" onclick="(function(){ try{ window.location.href='/' + '#login'; }catch(_){ } return false; })();">å·²è¨‚é–±ï¼Ÿç™»å…¥ä½¿ç”¨</a>
        </div>
      </div>
    </section>

  </div>

  <!-- FAQ / æ¢æ¬¾ -->
  <div class="safe" style="margin-top:18px">
    <section class="faq" id="terms">
      <h2 class="h2">å¸¸è¦‹å•é¡Œèˆ‡æ¢æ¬¾</h2>
      <p><b>Qï¼šæ˜¯å¦æœ‰å…è²»è©¦ç”¨ï¼Ÿ</b><br/>Aï¼šæ²’æœ‰ã€‚ä»˜è²»å³ä½¿ç”¨ï¼Œç„¡å…è²»é«”é©—ã€‚</p>
      <p><b>Qï¼šè¨‚é–±åŒ…å«å“ªäº›åŠŸèƒ½ï¼Ÿ</b><br/>Aï¼šAI é¡§å•ã€AI ä¸€éµç”Ÿæˆã€IP äººè¨­è¦åŠƒèˆ‡å‰µä½œè€…è³‡æ–™åº«ï¼›ä¸åˆ†ç­‰ç´šã€åŠŸèƒ½å®Œæ•´ã€‚</p>
      <p><b>Qï¼šå¦‚ä½•é–‹ç«‹ç™¼ç¥¨ï¼Ÿ</b><br/>Aï¼šä»˜æ¬¾å¾Œå°‡æ–¼ 3â€“5 å€‹å·¥ä½œæ—¥å¯„é€é›»å­ç™¼ç¥¨è‡³ä½ çš„ä¿¡ç®±ã€‚</p>
      <p class="small">é€€è²»æ”¿ç­–ï¼šæ•¸ä½æœå‹™ä¸€ç¶“å•Ÿç”¨æ•ä¸é€€æ¬¾ï¼ˆæ³•è¦å¦æœ‰è¦å®šè€…é™¤å¤–ï¼‰ã€‚è‹¥æ‰£æ¬¾æˆ–é–‹é€šç™¼ç”Ÿå•é¡Œï¼Œè«‹ä¾†ä¿¡ <a href="mailto:hello@aijob.com.tw">hello@aijob.com.tw</a>ã€‚</p>
    </section>
  </div>
</main>

<footer class="ft">Â© 2025 ReelMind Â· AI çŸ­å½±éŸ³ï½œAI è…³æœ¬ç”Ÿæˆï½œAI é¡§å•ï½œIP äººè¨­è¦åŠƒ Â· å°ç£</footer>

<script>
  // åƒ¹æ ¼è¨­å®šï¼ˆå¦‚æœªä¾†èª¿æ•´ï¼Œæ”¹é€™è£¡å³å¯ï¼‰
  const price = { monthly: 3980, yearly: 39800 };
  let current = 'monthly';

  function format(n){ return 'NT$' + n.toLocaleString('zh-Hant-TW'); }

  function setPlan(p){
    current = p;
    document.getElementById('mPlan').classList.toggle('active', p==='monthly');
    document.getElementById('yPlan').classList.toggle('active', p==='yearly');

    const name = p==='monthly' ? 'æœˆè²»æ–¹æ¡ˆ' : 'å¹´è²»æ–¹æ¡ˆï¼ˆçœ NT$7,960ï¼‰';
    const desc = p==='monthly'
      ? 'æ¯æœˆè¨‚é–±ï¼Œå¯éš¨æ™‚çºŒè¨‚ï¼›ä¸åˆ†ç­‰ç´šã€åŠŸèƒ½å®Œæ•´ã€‚'
      : 'ä¸€æ¬¡çµæ¸… 12 å€‹æœˆï¼›ä¸åˆ†ç­‰ç´šã€åŠŸèƒ½å®Œæ•´ã€‚';
    document.getElementById('planName').textContent = name;
    document.getElementById('planPrice').textContent = format(price[p]);
    document.getElementById('planDesc').textContent = desc;
    document.getElementById('sumPlan').textContent = name;
    document.getElementById('sumPrice').textContent = format(price[p]);
    document.getElementById('total').textContent = format(price[p]);
  }

  // å¾ URL åƒæ•¸è®€å–æ–¹æ¡ˆ
  function getUrlParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  async function checkout(){
    // ç™»å…¥æª¢æŸ¥ï¼šæœªç™»å…¥å…ˆå°å›ç™»å…¥ç•«é¢
    try {
      var token = localStorage.getItem('ipPlanningToken') || '';
      if (!token) {
        alert('è«‹å…ˆç™»å…¥å¾Œå†è¨‚é–±');
        try { window.location.href = '/' + '#login'; } catch(_) {}
        return;
      }
    } catch(_) {}

    // æ”¶é›†è¨‚å–®è³‡æ–™
    const plan = current;
    const payload = {
      plan,
      amount: price[plan],
      name: document.getElementById('name').value.trim(),
      email: document.getElementById('email').value.trim(),
      phone: document.getElementById('phone').value.trim(),
      invoiceType: document.getElementById('invoiceType').value,
      vat: document.getElementById('vat').value.trim(),
      note: document.getElementById('note').value.trim()
    };
    
    // å‰ç«¯ç°¡å–®æª¢æŸ¥
    if(!payload.name || !payload.email){
      alert('è«‹å¡«å¯«å§“åèˆ‡é›»å­ä¿¡ç®±');
      return;
    }
    
    // é©—è­‰ Email æ ¼å¼
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(payload.email)) {
      alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­ä¿¡ç®±');
      return;
    }
    
    // å¦‚æœé¸æ“‡å…¬å¸ç™¼ç¥¨ï¼Œæª¢æŸ¥çµ±ç·¨
    if (payload.invoiceType === 'company' && !payload.vat) {
      alert('é¸æ“‡å…¬å¸ç™¼ç¥¨æ™‚ï¼Œè«‹å¡«å¯«çµ±ä¸€ç·¨è™Ÿ');
      return;
    }
    
    // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
    const checkoutBtn = document.querySelector('.btn.blue');
    const originalText = checkoutBtn.textContent;
    checkoutBtn.disabled = true;
    checkoutBtn.textContent = 'è™•ç†ä¸­...';
    
    try {
      // èª¿ç”¨å¾Œç«¯ API å»ºç«‹è¨‚å–®
      const response = await fetch('https://aivideobackend.zeabur.app/api/payment/checkout', {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      });
      
      if (response.ok) {
        // å¾Œç«¯è¿”å› HTML è¡¨å–®ï¼Œç›´æ¥é¡¯ç¤ºï¼ˆæœƒè‡ªå‹•æäº¤åˆ° ECPayï¼‰
        const html = await response.text();
        document.body.innerHTML = html;
      } else {
        const errorData = await response.json().catch(() => ({ error: 'å»ºç«‹è¨‚å–®å¤±æ•—' }));
        alert(errorData.error || 'å»ºç«‹è¨‚å–®å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
        checkoutBtn.disabled = false;
        checkoutBtn.textContent = originalText;
      }
    } catch (error) {
      console.error('ä»˜æ¬¾éŒ¯èª¤:', error);
      alert('ä»˜æ¬¾è™•ç†å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
      checkoutBtn.disabled = false;
      checkoutBtn.textContent = originalText;
    }
  }

  function pay(kind){
    // æ‰€æœ‰æ”¯ä»˜æ–¹å¼éƒ½ä½¿ç”¨ checkout()ï¼ŒECPay æœƒè®“ç”¨æˆ¶è‡ªè¡Œé¸æ“‡ä»˜æ¬¾æ–¹å¼
    checkout();
  }

  // åˆå§‹åŒ–ï¼šå¾ URL åƒæ•¸è®€å–æ–¹æ¡ˆï¼Œå¦‚æœæ²’æœ‰å‰‡é è¨­ç‚ºæœˆè²»
  const urlPlan = getUrlParam('plan');
  const initialPlan = urlPlan === 'yearly' ? 'yearly' : 'monthly';
  setPlan(initialPlan);
  
  // è™•ç†ä»˜æ¬¾çµæœé é¢
  window.addEventListener('DOMContentLoaded', async function() {
    const urlParams = new URLSearchParams(window.location.search);
    const status = urlParams.get('status');
    const orderId = urlParams.get('order_id');
    const message = urlParams.get('message');
    
    if (status === 'success') {
      showPaymentSuccess(orderId);
    } else if (status === 'pending') {
      // å–è™ŸæˆåŠŸå¾…ä»˜æ¬¾ï¼ˆATM/è¶…å•†ï¼‰
      await showPaymentPending(orderId);
    } else if (status === 'failed' || status === 'error') {
      showPaymentError(message || 'ä»˜æ¬¾å¤±æ•—');
    }
  });
  
  // é¡¯ç¤ºå–è™ŸæˆåŠŸå¾…ä»˜æ¬¾é é¢
  async function showPaymentPending(orderId) {
    if (!orderId) {
      showPaymentError('è¨‚å–®ç·¨è™Ÿä¸å­˜åœ¨');
      return;
    }
    
    try {
      // æŸ¥è©¢è¨‚å–®è©³æƒ…
      const token = localStorage.getItem('ipPlanningToken') || '';
      const response = await fetch(`https://aivideobackend.zeabur.app/api/user/orders`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      
      if (response.ok) {
        const data = await response.json();
        const order = data.orders?.find(o => o.order_id === orderId);
        
        if (order) {
          const paymentMethod = order.payment_method || '';
          const paymentCode = order.payment_code || '';
          const bankCode = order.bank_code || '';
          const expireDate = order.expire_date || '';
          
          // éš±è—åŸæœ‰å…§å®¹
          const mainContent = document.querySelector('.safe.grid');
          if (mainContent) {
            mainContent.style.display = 'none';
          }
          
          // é¡¯ç¤ºå–è™ŸæˆåŠŸè¨Šæ¯
          let paymentInfoHTML = '';
          if (paymentMethod === 'ATM') {
            paymentInfoHTML = `
              <div style="background: #f8f9fa; padding: 24px; border-radius: 8px; margin: 24px 0;">
                <h3 class="h3" style="margin-bottom: 16px;">ATM è½‰å¸³è³‡è¨Š</h3>
                ${bankCode ? `<p class="sub" style="margin-bottom: 8px;"><strong>éŠ€è¡Œä»£ç¢¼ï¼š</strong>${bankCode}</p>` : ''}
                ${paymentCode ? `<p class="sub" style="margin-bottom: 8px;"><strong>è™›æ“¬å¸³è™Ÿï¼š</strong><code style="background: white; padding: 4px 8px; border-radius: 4px; font-size: 1.1em;">${paymentCode}</code></p>` : ''}
                ${expireDate ? `<p class="small" style="color: var(--red); margin-top: 16px;">âš ï¸ è«‹æ–¼ ${expireDate} å‰å®Œæˆè½‰å¸³</p>` : ''}
              </div>
            `;
          } else if (paymentMethod === 'CVS' || paymentMethod === 'BARCODE') {
            paymentInfoHTML = `
              <div style="background: #f8f9fa; padding: 24px; border-radius: 8px; margin: 24px 0;">
                <h3 class="h3" style="margin-bottom: 16px;">è¶…å•†ä»£ç¢¼</h3>
                ${paymentCode ? `<p class="sub" style="margin-bottom: 8px;"><strong>ä»˜æ¬¾ä»£ç¢¼ï¼š</strong><code style="background: white; padding: 4px 8px; border-radius: 4px; font-size: 1.1em;">${paymentCode}</code></p>` : ''}
                ${expireDate ? `<p class="small" style="color: var(--red); margin-top: 16px;">âš ï¸ è«‹æ–¼ ${expireDate} å‰è‡³è¶…å•†å®Œæˆä»˜æ¬¾</p>` : ''}
                <p class="small" style="margin-top: 16px;">è«‹è‡³ 7-11ã€å…¨å®¶ã€èŠçˆ¾å¯Œã€OK è¶…å•†ç­‰é–€å¸‚ï¼Œä½¿ç”¨å¤šåª’é«”æ©Ÿå°è¼¸å…¥ä»£ç¢¼å®Œæˆä»˜æ¬¾</p>
              </div>
            `;
          }
          
          const pendingHTML = `
            <div class="safe" style="margin-top: 40px;">
              <section class="card">
                <div class="body" style="text-align: center; padding: 40px 20px;">
                  <div style="font-size: 64px; margin-bottom: 20px;">â³</div>
                  <h2 class="h2" style="color: var(--warning); margin-bottom: 12px;">å–è™ŸæˆåŠŸï¼Œå¾…ä»˜æ¬¾</h2>
                  <p class="sub" style="margin-bottom: 24px;">è«‹ä¾ç…§ä¸‹æ–¹è³‡è¨Šå®Œæˆä»˜æ¬¾ï¼Œä»˜æ¬¾å®Œæˆå¾Œç³»çµ±å°‡è‡ªå‹•é–‹é€šæ‚¨çš„å¸³è™Ÿ</p>
                  ${orderId ? `<p class="small" style="margin-bottom: 24px;">è¨‚å–®ç·¨è™Ÿï¼š${orderId}</p>` : ''}
                  ${paymentInfoHTML}
                  <div class="row" style="justify-content: center; gap: 12px; margin-top: 24px;">
                    <button class="btn blue" onclick="window.location.href='/'">è¿”å›é¦–é </button>
                    <button class="btn ghost" onclick="checkOrderStatus('${orderId}')">æª¢æŸ¥ä»˜æ¬¾ç‹€æ…‹</button>
                  </div>
                  <p class="small" style="margin-top: 24px;">
                    å¦‚æœ‰å•é¡Œï¼Œè«‹è¯ç¹«å®¢æœï¼š<a href="mailto:hello@aijob.com.tw">hello@aijob.com.tw</a>
                  </p>
                </div>
              </section>
            </div>
          `;
          
          const container = document.querySelector('.wrap');
          if (container) {
            container.insertAdjacentHTML('beforeend', pendingHTML);
          }
        } else {
          showPaymentError('æ‰¾ä¸åˆ°è¨‚å–®è³‡è¨Š');
        }
      } else {
        showPaymentError('ç„¡æ³•æŸ¥è©¢è¨‚å–®è³‡è¨Š');
      }
    } catch (error) {
      console.error('æŸ¥è©¢è¨‚å–®å¤±æ•—:', error);
      showPaymentError('æŸ¥è©¢è¨‚å–®å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
    }
  }
  
  // æª¢æŸ¥è¨‚å–®ä»˜æ¬¾ç‹€æ…‹
  async function checkOrderStatus(orderId) {
    try {
      const token = localStorage.getItem('ipPlanningToken') || '';
      const response = await fetch(`https://aivideobackend.zeabur.app/api/user/orders`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      
      if (response.ok) {
        const data = await response.json();
        const order = data.orders?.find(o => o.order_id === orderId);
        
        if (order) {
          if (order.payment_status === 'paid') {
            alert('ä»˜æ¬¾æˆåŠŸï¼æ‚¨çš„å¸³è™Ÿå·²é–‹é€š');
            window.location.href = '/';
          } else {
            alert('å°šæœªå®Œæˆä»˜æ¬¾ï¼Œè«‹å®Œæˆä»˜æ¬¾å¾Œå†è©¦');
          }
        } else {
          alert('æ‰¾ä¸åˆ°è¨‚å–®è³‡è¨Š');
        }
      } else {
        alert('ç„¡æ³•æŸ¥è©¢è¨‚å–®ç‹€æ…‹');
      }
    } catch (error) {
      console.error('æª¢æŸ¥è¨‚å–®ç‹€æ…‹å¤±æ•—:', error);
      alert('æª¢æŸ¥è¨‚å–®ç‹€æ…‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
    }
  }
  
  function showPaymentSuccess(orderId) {
    // éš±è—åŸæœ‰å…§å®¹
    const mainContent = document.querySelector('.safe.grid');
    if (mainContent) {
      mainContent.style.display = 'none';
    }
    
    // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
    const successHTML = `
      <div class="safe" style="margin-top: 40px;">
        <section class="card">
          <div class="body" style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 64px; margin-bottom: 20px;">âœ…</div>
            <h2 class="h2" style="color: var(--ok); margin-bottom: 12px;">ä»˜æ¬¾æˆåŠŸï¼</h2>
            <p class="sub" style="margin-bottom: 24px;">æ„Ÿè¬æ‚¨çš„è¨‚é–±ï¼Œæ‚¨çš„å¸³è™Ÿå·²é–‹é€šä½¿ç”¨æ¬Šé™</p>
            ${orderId ? `<p class="small" style="margin-bottom: 24px;">è¨‚å–®ç·¨è™Ÿï¼š${orderId}</p>` : ''}
            <div class="row" style="justify-content: center; gap: 12px;">
              <button class="btn blue" onclick="window.location.href='/'">é–‹å§‹ä½¿ç”¨</button>
              <button class="btn ghost" onclick="window.location.href='/subscription.html'">æŸ¥çœ‹è¨‚å–®</button>
            </div>
          </div>
        </section>
      </div>
    `;
    
    const container = document.querySelector('.wrap');
    if (container) {
      container.insertAdjacentHTML('beforeend', successHTML);
    }
  }
  
  function showPaymentError(message) {
    // éš±è—åŸæœ‰å…§å®¹
    const mainContent = document.querySelector('.safe.grid');
    if (mainContent) {
      mainContent.style.display = 'none';
    }
    
    // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
    const errorHTML = `
      <div class="safe" style="margin-top: 40px;">
        <section class="card">
          <div class="body" style="text-align: center; padding: 40px 20px;">
            <div style="font-size: 64px; margin-bottom: 20px;">âŒ</div>
            <h2 class="h2" style="color: var(--red); margin-bottom: 12px;">ä»˜æ¬¾å¤±æ•—</h2>
            <p class="sub" style="margin-bottom: 24px;">${message}</p>
            <div class="row" style="justify-content: center; gap: 12px;">
              <button class="btn blue" onclick="window.location.href='/subscription.html'">é‡æ–°ä»˜æ¬¾</button>
              <button class="btn ghost" onclick="window.location.href='/'">è¿”å›é¦–é </button>
            </div>
            <p class="small" style="margin-top: 24px;">
              å¦‚æœ‰å•é¡Œï¼Œè«‹è¯ç¹«å®¢æœï¼š<a href="mailto:hello@aijob.com.tw">hello@aijob.com.tw</a>
            </p>
          </div>
        </section>
      </div>
    `;
    
    const container = document.querySelector('.wrap');
    if (container) {
      container.insertAdjacentHTML('beforeend', errorHTML);
    }
  }
</script>

</body>
</html>
