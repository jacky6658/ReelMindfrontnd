<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    
    <!-- Primary SEO Meta Tags -->
    <title>創作者資料庫 - ReelMind AI 短影音智能體 | 個人資料 × 我的腳本 × 帳號定位 × 訂單管理</title>
    <meta name="title" content="創作者資料庫 - ReelMind AI 短影音智能體 | 個人資料 × 我的腳本 × 帳號定位 × 訂單管理" />
    <meta name="description" content="ReelMind 創作者資料庫：管理您的個人資料、腳本記錄、帳號定位、選題內容、IP人設規劃、訂單記錄和系統設定。" />
    <meta name="keywords" content="創作者資料庫,個人資料,腳本管理,帳號定位,IP人設規劃,短影音工具" />
    <meta name="author" content="ReelMind AI" />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="zh-Hant" />
    <link rel="canonical" href="https://reelmind.aijob.com.tw/userDB.html" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://reelmind.aijob.com.tw/userDB.html" />
    <meta property="og:title" content="創作者資料庫 - ReelMind AI 短影音智能體" />
    <meta property="og:description" content="管理您的個人資料、腳本記錄、帳號定位、選題內容和訂單記錄。" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="創作者資料庫 - ReelMind AI 短影音智能體" />
    <meta name="twitter:description" content="管理您的個人資料、腳本記錄、帳號定位、選題內容和訂單記錄。" />
    
    <!-- HTTP 快取標頭 -->
    <meta http-equiv="Cache-Control" content="public, max-age=3600">
    <meta http-equiv="Expires" content="3600">
    
    <!-- Favicon -->
    <!-- Favicon: ReelMind Logo -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/android-chrome-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="assets/images/android-chrome-512x512.png" />
    <link rel="shortcut icon" href="assets/images/favicon.ico" />
    
    <!-- Font Awesome 圖標庫 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- CSS 文件 -->
    <link rel="stylesheet" href="assets/css/variables.css" />
    <link rel="stylesheet" href="assets/css/animations.css" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
    
    <!-- UserDB 專用樣式（從 index.html 提取） -->
    <style>
      /* ===== 導航欄樣式（電腦版和手機版） ===== */
      .top-navbar {
        background: var(--navbar-bg);
        border-bottom: 1px solid var(--border-color);
        padding: 16px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 1px 3px var(--shadow);
        padding-top: calc(16px + env(safe-area-inset-top, 0px)); /* iOS 安全區域 */
        padding-left: calc(24px + env(safe-area-inset-left, 0px)); /* iOS 安全區域 */
        padding-right: calc(24px + env(safe-area-inset-right, 0px)); /* iOS 安全區域 */
        min-height: 60px;
        position: sticky;
        top: 0;
        z-index: 100;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }
      
      .navbar-left {
        display: flex;
        align-items: center;
        gap: 24px;
        justify-content: flex-start;
      }
      
      .navbar-title {
        font-size: 30px;
        font-weight: 600;
        color: var(--text-primary);
        text-align: center;
        transition: color 0.3s ease;
        justify-self: center;
      }
      
      .clickable-title {
        cursor: pointer;
        transition: color 0.2s ease;
      }
      
      .clickable-title:hover {
        color: #3b82f6;
      }
      
      .navbar-tabs {
        display: flex;
        gap: 8px;
      }
      
      .navbar-tab {
        padding: 8px 16px;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
        text-decoration: none;
      }
      
      .navbar-tab.active {
        background: var(--button-bg);
        color: var(--button-text);
      }
      
      .navbar-tab:hover:not(.active) {
        background: var(--bg-tertiary);
      }
      
      .navbar-right {
        display: flex;
        align-items: center;
        gap: 16px;
        justify-content: flex-end;
      }
      
      .user-info {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        font-size: 14px;
        transition: color 0.3s ease;
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 8px;
        transition: background 0.2s;
      }
      
      .user-info:hover {
        background: #f3f4f6;
      }
      
      .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        border: 2px solid #e5ecef;
        object-fit: cover;
        object-position: center;
      }
      
      .user-name {
        font-size: 14px;
        font-weight: 500;
        color: #374151;
      }
      
      .auth-buttons {
        display: flex;
        gap: 8px;
      }
      
      .login-btn, .logout-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .login-btn {
        background: #3b82f6;
        color: white;
      }
      
      .login-btn:hover {
        background: #2563eb;
      }
      
      .logout-btn {
        background: #ef4444;
        color: white;
      }
      
      .logout-btn:hover {
        background: #dc2626;
      }
      
      /* 手機版抽屜按鈕 */
      .mobile-drawer-toggle {
        display: none;
        background: none;
        border: none;
        font-size: 24px;
        color: var(--text-primary);
        cursor: pointer;
        padding: 8px;
        min-width: 44px; /* iOS 最小觸控目標 */
        min-height: 44px;
        margin-right: 12px;
        border-radius: 4px;
        transition: background-color 0.2s;
        -webkit-tap-highlight-color: transparent; /* 移除 iOS 點擊高亮 */
        touch-action: manipulation; /* 優化觸控響應 */
      }
      
      .mobile-drawer-toggle:hover {
        background-color: #f3f4f6;
      }
      
      .hamburger-icon {
        display: block;
      }
      
      .mobile-drawer-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none;
      }
      
      .mobile-drawer {
        position: fixed;
        top: 0;
        left: -300px;
        width: 280px;
        height: 100%;
        height: 100dvh; /* 使用動態視窗高度（支援 iOS Safari） */
        background: white;
        z-index: 1000;
        transition: left 0.3s ease;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        padding-top: env(safe-area-inset-top, 0px); /* iOS 安全區域 */
        padding-bottom: env(safe-area-inset-bottom, 0px); /* iOS 安全區域 */
        overflow-y: auto;
        -webkit-overflow-scrolling: touch; /* iOS 平滑滾動 */
      }
      
      .mobile-drawer.open {
        left: 0;
      }
      
      .mobile-drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
      }
      
      .mobile-drawer-header h3 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
      }
      
      .mobile-drawer-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #6b7280;
        cursor: pointer;
        padding: 4px;
        min-width: 44px; /* iOS 最小觸控目標 */
        min-height: 44px;
        border-radius: 4px;
        transition: background-color 0.2s;
        -webkit-tap-highlight-color: transparent; /* 移除 iOS 點擊高亮 */
        touch-action: manipulation; /* 優化觸控響應 */
      }
      
      .mobile-drawer-close:hover {
        background-color: #e5e7eb;
      }
      
      .mobile-drawer-content {
        padding: 20px 0;
      }
      
      .mobile-drawer-item {
        display: flex;
        align-items: center;
        padding: 16px 20px;
        min-height: 44px; /* iOS 最小觸控目標 */
        color: #374151;
        text-decoration: none;
        transition: background-color 0.2s;
        border-left: 3px solid transparent;
        -webkit-tap-highlight-color: transparent; /* 移除 iOS 點擊高亮 */
        touch-action: manipulation; /* 優化觸控響應 */
      }
      
      .mobile-drawer-item:hover {
        background-color: #f8fafc;
        color: #1f2937;
      }
      
      .mobile-drawer-item.active {
        background-color: #eff6ff;
        color: #3b82f6;
        border-left-color: #3b82f6;
      }
      
      .mobile-drawer-icon {
        font-size: 20px;
        margin-right: 12px;
        width: 24px;
        text-align: center;
      }
      
      .mobile-drawer-text {
        font-size: 16px;
        font-weight: 500;
      }
      
      /* 桌面版樣式 - 隱藏手機版抽屜 */
      @media (min-width: 769px) {
        .mobile-drawer-toggle {
          display: none !important;
        }
        
        .mobile-drawer {
          display: none !important;
        }
        
        .mobile-drawer-overlay {
          display: none !important;
        }
      }
      
      /* 響應式設計 - 手機版 */
      @media (max-width: 768px) {
        .top-navbar {
          padding: 12px 16px;
          padding-top: calc(12px + env(safe-area-inset-top, 0px)); /* iOS 安全區域 */
          padding-left: calc(16px + env(safe-area-inset-left, 0px)); /* iOS 安全區域 */
          padding-right: calc(16px + env(safe-area-inset-right, 0px)); /* iOS 安全區域 */
          flex-wrap: wrap;
          gap: 12px;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1000;
        }
        
        .navbar-left {
          gap: 16px;
          flex: 1;
          min-width: 0;
          position: relative; /* 添加相對定位 */
        }
        
        .navbar-title {
          font-size: 25px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
          text-align: center;
          position: absolute; /* 絕對定位 */
          left: 50%; /* 水平置中 */
          transform: translateX(-50%); /* 精確置中 */
          max-width: calc(100% - 80px); /* 考慮左右按鈕留出空間 */
          z-index: 1; /* 確保在按鈕之上 */
        }
        
        .navbar-tabs {
          display: none;
        }
        
        .navbar-right {
          gap: 8px;
        }
        
        .user-info {
          padding: 6px 12px;
          font-size: 14px;
        }
        
        .user-avatar {
          width: 28px !important;
          height: 28px !important;
        }
        
        .user-name {
          display: none; /* 在手機版隱藏使用者暱稱 */
        }
        
        .login-btn, .logout-btn {
          padding: 10px 16px;
          min-height: 44px; /* iOS 最小觸控目標 */
          font-size: 14px;
          -webkit-tap-highlight-color: transparent; /* 移除 iOS 點擊高亮 */
          touch-action: manipulation; /* 優化觸控響應 */
        }
        
        .mobile-drawer-toggle {
          display: block !important;
        }
        
        .user-db-page {
          padding-top: calc(80px + env(safe-area-inset-top, 0px)); /* iOS 安全區域 */
          padding-bottom: env(safe-area-inset-bottom, 0px); /* iOS 安全區域 */
        }
      }
      
      /* ===== 創作者資料庫樣式 ===== */
      .user-db-page {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
      }
      
      .page-title {
        font-size: 24px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 24px;
        text-align: center;
      }
      
      .user-db-container {
        display: flex;
        gap: 24px;
        min-height: 600px;
      }
      
      .user-db-sidebar {
        width: 280px;
        background: var(--bg-secondary);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 1px 3px var(--shadow);
        transition: background-color 0.3s ease;
      }
      
      .sidebar-header {
        margin-bottom: 24px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--border-color);
        transition: border-color 0.3s ease;
      }
      
      .user-profile {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .profile-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: 2px solid var(--border-color);
        transition: border-color 0.3s ease;
      }
      
      .profile-info h3 {
        margin: 0 0 4px 0;
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        transition: color 0.3s ease;
      }
      
      .profile-info p {
        margin: 0;
        font-size: 14px;
        color: var(--text-secondary);
        transition: color 0.3s ease;
      }
      
      .sidebar-menu {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      
      .menu-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        min-height: 44px; /* iOS 最小觸控目標 */
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        background: none;
        text-align: left;
        font-size: 14px;
        color: var(--text-secondary);
        -webkit-tap-highlight-color: transparent; /* 移除 iOS 點擊高亮 */
        touch-action: manipulation; /* 優化觸控響應 */
      }
      
      .menu-item:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
      }
      
      .menu-item.active {
        background: var(--button-bg);
        color: var(--button-text);
      }
      
      .menu-icon {
        font-size: 16px;
      }
      
      .menu-text {
        font-weight: 500;
      }
      
      .menu-divider {
        height: 1px;
        background: var(--border-color);
        margin: 12px 0;
        transition: background-color 0.3s ease;
      }
      
      .logout-item {
        color: #dc2626;
      }
      
      .logout-item:hover {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
      }
      
      .user-db-content {
        flex: 1;
        background: var(--card-bg);
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 3px var(--shadow);
        transition: background-color 0.3s ease;
        display: flex; /* 桌面版顯示 */
        flex-direction: column;
      }
      
      .db-section {
        display: none;
      }
      
      .db-section.active {
        display: block;
      }
      
      /* 桌面版隱藏彈跳視窗 */
      @media (min-width: 769px) {
        .userdb-modal-overlay {
          display: none !important;
        }
      }
      
      .section-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 16px;
        transition: color 0.3s ease;
      }
      
      .section-content {
        color: var(--text-secondary);
        line-height: 1.6;
        transition: color 0.3s ease;
      }
      
      .profile-details {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      
      .detail-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: var(--bg-secondary);
        border-radius: 8px;
        transition: background-color 0.3s ease;
      }
      
      .detail-item label {
        font-weight: 600;
        color: var(--text-primary);
        min-width: 80px;
        transition: color 0.3s ease;
      }
      
      .detail-item span {
        color: var(--text-secondary);
        transition: color 0.3s ease;
      }
      
      .loading-text {
        text-align: center;
        padding: 40px;
        color: #6b7280;
        font-size: 14px;
      }
      
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      
      .spinner {
        width: 24px;
        height: 24px;
        border: 3px solid #e5e7eb;
        border-top: 3px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      
      /* ===== 腳本項目樣式 ===== */
      .script-item {
        background: #f8f9fa;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        margin-bottom: 12px;
        overflow: hidden;
      }
      
      .script-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px;
        cursor: pointer;
        background: #fff;
        border-bottom: 1px solid #e5e7eb;
        transition: background-color 0.2s;
      }
      
      .script-header:hover {
        background: #f9fafb;
      }
      
      .script-info {
        display: flex;
        align-items: center;
        gap: 16px;
        flex: 1;
      }
      
      .script-number {
        background: #3b82f6;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        width: 60px;
        min-width: 60px;
        max-width: 60px;
        text-align: center;
        white-space: nowrap;
        display: inline-block;
        box-sizing: border-box;
      }
      
      .script-name {
        font-weight: 500;
        color: #1f2937;
        cursor: pointer;
        padding: 4px 8px;
        border-radius: 4px;
        transition: background-color 0.2s;
      }
      
      .script-name:hover {
        background: #e5e7eb;
      }
      
      .script-date {
        color: #6b7280;
        font-size: 14px;
      }
      
      .script-toggle {
        color: #6b7280;
        font-size: 14px;
      }
      
      .toggle-icon {
        transition: transform 0.2s;
      }
      
      .script-item.active .toggle-icon {
        transform: rotate(180deg);
      }
      
      .script-content {
        padding: 16px;
        background: #fff;
        border-top: 1px solid #e5e7eb;
      }
      
      .script-details {
        margin-bottom: 16px;
      }
      
      /* ===== 表格樣式 ===== */
      .script-table {
        overflow-x: auto;
        margin: 16px 0;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
      }
      
      .script-table table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
        min-width: 800px;
      }
      
      .script-table th,
      .script-table td {
        border: 1px solid #e5e7eb;
        padding: 12px;
        text-align: left;
        white-space: normal;
        word-break: break-word;
        vertical-align: top;
      }
      
      .script-table th {
        background: #f8fafc;
        font-weight: 600;
        color: #374151;
        position: sticky;
        top: 0;
        z-index: 1;
      }
      
      .script-table td {
        color: #4b5563;
      }
      
      .script-table tbody tr:nth-child(even) {
        background: #f9fafb;
      }
      
      .script-table tbody tr:hover {
        background: #f3f4f6;
      }
      
      /* ===== 操作按鈕樣式 ===== */
      .script-actions {
        display: flex;
        gap: 8px;
        padding: 16px;
        background: #f8f9fa;
        border-top: 1px solid #e5e7eb;
        flex-wrap: wrap;
      }
      
      .action-btn {
        padding: 10px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
        min-height: 40px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        white-space: nowrap;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        user-select: none;
      }
      
      .action-btn:active {
        transform: scale(0.98);
      }
      
      .view-btn {
        background: #3b82f6;
        color: white;
      }
      
      .view-btn:hover {
        background: #2563eb;
      }
      
      .download-pdf-btn {
        background: #10b981;
        color: white;
      }
      
      .download-pdf-btn:hover {
        background: #059669;
      }
      
      .download-csv-btn {
        background: #06b6d4;
        color: white;
      }
      
      .download-csv-btn:hover {
        background: #0891b2;
      }
      
      .delete-btn {
        background: #ef4444;
        color: white;
      }
      
      .delete-btn:hover {
        background: #dc2626;
      }
      
      /* ===== 帳號定位項目樣式 ===== */
      .positioning-record-item {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      
      .record-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        padding-bottom: 12px;
        border-bottom: 2px solid #e5e7eb;
      }
      
      .record-number {
        font-weight: 600;
        color: #1f2937;
        font-size: 16px;
      }
      
      .record-date {
        color: #6b7280;
        font-size: 14px;
      }
      
      .record-preview {
        color: #4b5563;
        line-height: 1.6;
        margin-bottom: 12px;
      }
      
      .record-actions {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }
      
      /* ===== 選題項目樣式 ===== */
      .topic-item {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      
      .topic-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        padding-bottom: 12px;
        border-bottom: 2px solid #e5e7eb;
      }
      
      .topic-title {
        font-weight: 600;
        color: #1f2937;
        font-size: 16px;
      }
      
      .topic-date {
        color: #6b7280;
        font-size: 14px;
      }
      
      .topic-content {
        color: #4b5563;
        line-height: 1.6;
        margin-bottom: 12px;
      }
      
      .topic-actions {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }
      
      /* ===== IP人設規劃項目樣式 ===== */
      .ip-planning-item {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      
      .ip-planning-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        padding-bottom: 12px;
        border-bottom: 2px solid #e5e7eb;
      }
      
      .ip-planning-title {
        font-weight: 600;
        color: #1f2937;
        font-size: 16px;
      }
      
      .ip-planning-date {
        color: #6b7280;
        font-size: 14px;
      }
      
      .ip-planning-content {
        color: #4b5563;
        line-height: 1.6;
        margin-bottom: 12px;
      }
      
      /* IP 規劃結果中的 Markdown 表格樣式 */
      .ip-planning-content-item table {
        width: 100%;
        border-collapse: collapse;
        margin: 16px 0;
        font-size: 14px;
        background: #ffffff;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        overflow: hidden;
      }
      
      .ip-planning-content-item table thead {
        background: #f8fafc;
        border-bottom: 2px solid #e5e7eb;
      }
      
      .ip-planning-content-item table th {
        padding: 12px 16px;
        text-align: left;
        font-weight: 600;
        color: #374151;
        white-space: nowrap;
        border-right: 1px solid #e5e7eb;
      }
      
      .ip-planning-content-item table th:last-child {
        border-right: none;
      }
      
      .ip-planning-content-item table tbody tr {
        border-bottom: 1px solid #e5e7eb;
        transition: background-color 0.2s ease;
      }
      
      .ip-planning-content-item table tbody tr:hover {
        background-color: #f9fafb;
      }
      
      .ip-planning-content-item table tbody tr:last-child {
        border-bottom: none;
      }
      
      .ip-planning-content-item table td {
        padding: 12px 16px;
        color: #4b5563;
        border-right: 1px solid #e5e7eb;
        vertical-align: top;
      }
      
      .ip-planning-content-item table td:last-child {
        border-right: none;
      }
      
      .ip-planning-content-item table tbody tr:nth-child(even) {
        background-color: #f9fafb;
      }
      
      .ip-planning-content-item table tbody tr:nth-child(even):hover {
        background-color: #f3f4f6;
      }
      
      /* 響應式表格 */
      @media (max-width: 768px) {
        .ip-planning-content-item table {
          font-size: 12px;
          display: block;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }
        
        .ip-planning-content-item table th,
        .ip-planning-content-item table td {
          padding: 8px 12px;
        }
      }
      
      .ip-planning-actions {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }
      
      /* iOS Safari 輸入框優化 */
      input[type="text"],
      input[type="password"],
      input[type="email"],
      input[type="number"],
      textarea,
      select {
        font-size: 16px !important; /* iOS Safari 建議至少 16px 避免自動縮放 */
        -webkit-appearance: none;
        appearance: none;
        -webkit-tap-highlight-color: transparent;
      }
      
      /* 手機版適配 - RWD 響應式設計 */
      @media (max-width: 768px) {
        .user-db-page {
          padding: 16px;
          padding-top: calc(80px + env(safe-area-inset-top, 0px)); /* iOS 安全區域 */
          padding-left: calc(16px + env(safe-area-inset-left, 0px)); /* iOS 安全區域 */
          padding-right: calc(16px + env(safe-area-inset-right, 0px)); /* iOS 安全區域 */
          padding-bottom: calc(16px + env(safe-area-inset-bottom, 0px)); /* iOS 安全區域 */
          max-width: 100%;
          overflow-x: hidden;
          box-sizing: border-box;
        }
        
        .user-db-container {
          flex-direction: column;
          max-width: 100%;
          overflow-x: hidden;
          gap: 16px; /* 減少間距 */
        }
        
        .user-db-sidebar {
          width: 100% !important;
          max-width: 100% !important;
          margin-bottom: 20px;
          border-radius: 12px;
          padding: 16px !important; /* 減少 padding */
          display: block !important; /* 確保手機版顯示 */
          box-sizing: border-box;
        }
        
        .user-db-content {
          display: none !important; /* 手機版隱藏內容區域 */
        }
        
        /* 手機版選單項目優化 */
        .menu-item {
          padding: 14px 16px !important; /* 增加觸控目標 */
          min-height: 48px !important; /* 確保觸控目標足夠大 */
          font-size: 15px !important; /* 稍微增大字體 */
        }
        
        .menu-icon {
          font-size: 18px !important; /* 增大圖標 */
        }
        
        /* 手機版側邊欄標題優化 */
        .sidebar-header {
          padding-bottom: 16px !important;
          margin-bottom: 16px !important;
        }
        
        .profile-avatar {
          width: 40px !important;
          height: 40px !important;
        }
        
        .profile-info h3 {
          font-size: 15px !important;
        }
        
        .profile-info p {
          font-size: 13px !important;
        }
        
        .db-section {
          max-width: 100%;
          overflow-x: hidden;
          overflow-y: auto;
          -webkit-overflow-scrolling: touch; /* iOS 平滑滾動 */
        }
        
        /* 手機版彈跳視窗樣式 */
        .userdb-modal-overlay {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          width: 100% !important;
          height: 100% !important;
          height: 100dvh !important; /* iOS Safari 動態視窗高度 */
          background: rgba(0, 0, 0, 0.5) !important;
          display: none !important;
          justify-content: center !important;
          align-items: center !important;
          z-index: 99999 !important; /* 提高 z-index 確保在最上層 */
          padding: 20px !important;
          box-sizing: border-box !important;
          -webkit-overflow-scrolling: touch !important;
          margin: 0 !important;
        }
        
        .userdb-modal-overlay.show {
          display: flex !important;
          visibility: visible !important;
          opacity: 1 !important;
        }
        
        .userdb-modal-content {
          background: white;
          border-radius: 12px;
          max-width: 95%;
          max-height: 90vh;
          overflow-y: auto;
          box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
          position: relative;
          width: 100%;
          -webkit-overflow-scrolling: touch;
        }
        
        .userdb-modal-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 20px 24px;
          border-bottom: 1px solid #e5e7eb;
          position: sticky;
          top: 0;
          background: white;
          z-index: 1;
          border-radius: 12px 12px 0 0;
        }
        
        .userdb-modal-title {
          margin: 0;
          color: #1f2937;
          font-size: 20px;
          font-weight: 600;
        }
        
        .userdb-modal-close {
          background: none;
          border: none;
          font-size: 28px;
          cursor: pointer;
          color: #6b7280;
          width: 32px;
          height: 32px;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 4px;
          transition: background 0.2s;
          -webkit-tap-highlight-color: transparent;
          touch-action: manipulation;
        }
        
        .userdb-modal-close:hover {
          background: #f3f4f6;
        }
        
        .userdb-modal-body {
          padding: 16px !important; /* 手機版減少 padding */
          overflow-y: auto;
          max-height: calc(90vh - 80px);
          -webkit-overflow-scrolling: touch;
          font-size: 14px; /* 基礎字體大小 */
        }
        
        .section-content {
          max-width: 100%;
          overflow-x: hidden;
          word-wrap: break-word;
          overflow-wrap: break-word; /* 優化文字換行 */
          -webkit-hyphens: auto; /* iOS 自動斷字 */
          hyphens: auto;
          font-size: 14px; /* 確保基礎字體大小 */
        }
        
        /* 手機版標題和文字大小調整 */
        .userdb-modal-body h2,
        .userdb-modal-body h3,
        .userdb-modal-body h4 {
          font-size: 18px !important;
          margin: 12px 0 8px 0 !important;
          line-height: 1.4 !important;
        }
        
        .userdb-modal-body h2 {
          font-size: 20px !important;
        }
        
        .userdb-modal-body p {
          font-size: 14px !important;
          line-height: 1.6 !important;
          margin: 8px 0 !important;
        }
        
        /* 個人資料樣式調整 */
        .userdb-modal-body .profile-details {
          gap: 12px !important;
        }
        
        .userdb-modal-body .detail-item {
          padding: 12px !important;
          gap: 8px !important;
          flex-direction: column !important;
          align-items: flex-start !important;
        }
        
        .userdb-modal-body .detail-item label {
          font-size: 13px !important;
          font-weight: 600 !important;
          margin-bottom: 4px !important;
          min-width: auto !important;
        }
        
        .userdb-modal-body .detail-item span {
          font-size: 14px !important;
          word-break: break-word !important;
          width: 100% !important;
        }
        
        /* 設定區域樣式調整 */
        .userdb-modal-body .setting-group {
          margin-top: 20px !important;
        }
        
        .userdb-modal-body .setting-item {
          margin-bottom: 16px !important;
        }
        
        .userdb-modal-body .setting-desc {
          font-size: 12px !important;
          line-height: 1.5 !important;
          margin-top: 6px !important;
        }
        
        /* 統計數字樣式調整 */
        .userdb-modal-body .stat-number {
          font-size: 28px !important;
          margin-bottom: 6px !important;
        }
        
        .userdb-modal-body .stat-label {
          font-size: 13px !important;
        }
        
        /* 腳本項目樣式調整 */
        .userdb-modal-body .script-item {
          font-size: 14px !important;
        }
        
        .userdb-modal-body .script-name {
          font-size: 14px !important;
        }
        
        .userdb-modal-body .script-date {
          font-size: 12px !important;
        }
        
        /* 按鈕樣式調整 */
        .userdb-modal-body button {
          font-size: 14px !important;
          padding: 10px 16px !important;
        }
        
        /* 列表樣式調整 */
        .userdb-modal-body ul,
        .userdb-modal-body ol {
          padding-left: 20px !important;
          margin: 8px 0 !important;
        }
        
        .userdb-modal-body li {
          font-size: 14px !important;
          line-height: 1.6 !important;
          margin: 6px 0 !important;
        }
        
        /* 表格內容調整 */
        .userdb-modal-body table {
          font-size: 12px !important;
        }
        
        .userdb-modal-body table th,
        .userdb-modal-body table td {
          padding: 8px 6px !important;
          font-size: 12px !important;
        }
        
        /* 幫助中心樣式調整 */
        .userdb-modal-body .help-section {
          margin-bottom: 20px !important;
        }
        
        .userdb-modal-body .help-section h4 {
          font-size: 16px !important;
          margin-bottom: 8px !important;
        }
        
        .userdb-modal-body .help-section p {
          font-size: 13px !important;
          margin-bottom: 6px !important;
        }
        
        /* 手機版表格樣式 */
        .script-table {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
          margin: 12px 0;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        }
        
        .script-table table {
          min-width: 800px;
          font-size: 11px;
          margin: 0;
        }
        
        .script-table th,
        .script-table td {
          padding: 10px 8px;
          white-space: normal;
          word-break: break-word;
          vertical-align: top;
        }
        
        .script-table th {
          font-size: 11px;
          font-weight: 600;
          background: #f8fafc;
          position: sticky;
          left: 0;
          z-index: 1;
        }
        
        .script-table td:first-child {
          position: sticky;
          left: 0;
          background: white;
          z-index: 1;
          font-weight: 500;
        }
        
        .script-table tbody tr:nth-child(even) td:first-child {
          background: #f9fafb;
        }
        
        .script-actions {
          flex-direction: column;
          gap: 10px;
          padding: 12px;
          background: #f8fafc;
          border-top: 1px solid #e5e7eb;
        }
        
        .action-btn {
          padding: 12px 16px;
          min-height: 44px; /* iOS 最小觸控目標 */
          font-size: 14px;
          width: 100%;
          -webkit-tap-highlight-color: transparent; /* 移除 iOS 點擊高亮 */
          touch-action: manipulation; /* 優化觸控響應 */
        }
        
        .script-item {
          margin-bottom: 16px;
          border-radius: 12px;
        }
        
        .script-header {
          padding: 12px 16px;
          flex-wrap: wrap;
          gap: 8px;
        }
        
        .script-info {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
          width: 100%;
        }
        
        .positioning-record-item,
        .topic-item,
        .ip-planning-item {
          padding: 12px !important;
          margin-bottom: 16px !important;
          font-size: 14px !important;
        }
        
        .userdb-modal-body .positioning-record-item h4,
        .userdb-modal-body .topic-item h4,
        .userdb-modal-body .ip-planning-item h4 {
          font-size: 16px !important;
          margin: 0 0 8px 0 !important;
          font-weight: 600 !important;
        }
        
        .userdb-modal-body .positioning-record-item p,
        .userdb-modal-body .topic-item p,
        .userdb-modal-body .ip-planning-item p {
          font-size: 13px !important;
          line-height: 1.6 !important;
          margin: 6px 0 !important;
        }
        
        .userdb-modal-body .positioning-record-item .record-meta,
        .userdb-modal-body .topic-item .topic-meta,
        .userdb-modal-body .ip-planning-item .ip-planning-meta {
          font-size: 12px !important;
          color: #6b7280 !important;
          margin-top: 8px !important;
        }
        
        .record-actions,
        .topic-item-actions,
        .ip-planning-actions {
          flex-direction: column !important;
          gap: 8px !important;
          margin-top: 12px !important;
        }
        
        .record-actions .action-btn,
        .topic-item-actions .action-btn,
        .ip-planning-actions .action-btn {
          width: 100% !important;
          padding: 12px 16px !important;
          min-height: 44px !important; /* iOS 最小觸控目標 */
          font-size: 14px !important;
          -webkit-tap-highlight-color: transparent !important; /* 移除 iOS 點擊高亮 */
          touch-action: manipulation !important; /* 優化觸控響應 */
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
          gap: 6px !important;
          user-select: none !important;
        }
        
        .record-actions .action-btn:active,
        .topic-item-actions .action-btn:active,
        .ip-planning-actions .action-btn:active {
          transform: scale(0.97) !important;
          opacity: 0.9 !important;
        }
        
        /* IP人設規劃列表項目手機版布局切換 */
        .ip-planning-header-mobile {
          display: flex !important;
        }
        
        .ip-planning-header-desktop {
          display: none !important;
        }
        
        .ip-planning-actions-mobile {
          display: flex !important;
        }
        
        .ip-planning-actions-desktop {
          display: none !important;
        }
        
        /* 確保 IP人設規劃列表項目不水平溢出 */
        .ip-planning-item {
          width: 100% !important;
          max-width: 100% !important;
          padding: 16px !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
          box-sizing: border-box !important;
          overflow-x: hidden !important;
        }
        
        .ip-planning-header-mobile,
        .ip-planning-header-desktop {
          width: 100% !important;
          max-width: 100% !important;
          overflow-x: hidden !important;
          box-sizing: border-box !important;
          flex-wrap: wrap !important;
        }
        
        .ip-planning-item-title {
          max-width: 100% !important;
          word-break: break-word !important;
          overflow-wrap: break-word !important;
          white-space: normal !important;
        }
        
        .ip-planning-content-item {
          width: 100% !important;
          max-width: 100% !important;
          overflow-x: hidden !important;
          overflow-y: auto !important;
          box-sizing: border-box !important;
          word-wrap: break-word !important;
          overflow-wrap: break-word !important;
        }
        
        .ip-planning-actions-mobile {
          width: 100% !important;
          max-width: 100% !important;
          overflow-x: hidden !important;
          box-sizing: border-box !important;
          flex-wrap: wrap !important;
          gap: 8px !important;
        }
        
        .ip-planning-actions-mobile .action-btn {
          box-sizing: border-box !important;
          max-width: 100% !important;
          white-space: nowrap !important;
          overflow: hidden !important;
          text-overflow: ellipsis !important;
        }
        
        /* IP人設規劃彈跳視窗手機版優化 */
        .ip-planning-detail-modal-overlay {
          padding: 0 !important;
          align-items: flex-end !important;
        }
        
        .ip-planning-detail-modal-overlay > div {
          max-width: 100% !important;
          width: 100% !important;
          max-height: 90vh !important;
          border-radius: 16px 16px 0 0 !important;
          margin: 0 !important;
        }
        
        /* 彈跳視窗內容區域：不水平溢出（除了表格） */
        .ip-planning-detail-modal-overlay > div > div:nth-child(2) {
          padding: 16px !important;
          font-size: 14px !important;
          overflow-x: hidden !important;
          overflow-y: auto !important;
          width: 100% !important;
          max-width: 100% !important;
          box-sizing: border-box !important;
          word-wrap: break-word !important;
          overflow-wrap: break-word !important;
        }
        
        .ip-planning-detail-modal-overlay > div > div:nth-child(2) > div:last-child {
          font-size: 14px !important;
          line-height: 1.6 !important;
          word-break: break-word !important;
          overflow-wrap: break-word !important;
        }
        
        /* 列表項目中的表格：可以水平滾動（預覽用） */
        .ip-planning-content-item table {
          font-size: 12px !important;
          display: block !important;
          overflow-x: auto !important;
          -webkit-overflow-scrolling: touch !important;
          width: 100% !important;
          max-width: 100% !important;
          margin: 0 !important;
        }
        
        /* 彈跳視窗中的表格：可以水平滾動（這是唯一允許水平滾動的地方） */
        .ip-planning-detail-modal-overlay table,
        .userdb-modal-body table {
          font-size: 12px !important;
          display: block !important;
          overflow-x: auto !important;
          -webkit-overflow-scrolling: touch !important;
          width: 100% !important;
          max-width: 100% !important;
          margin: 12px 0 !important;
        }
        
        /* 確保所有文字內容正確換行 */
        .ip-planning-item *,
        .ip-planning-content-item * {
          max-width: 100% !important;
          word-wrap: break-word !important;
          overflow-wrap: break-word !important;
        }
        
        /* 除了表格，其他元素都不允許水平滾動 */
        .ip-planning-item *:not(table),
        .ip-planning-content-item *:not(table) {
          overflow-x: hidden !important;
        }
        
        /* 桌面版保持原樣 */
        @media (min-width: 769px) {
          .ip-planning-header-mobile {
            display: none !important;
          }
          
          .ip-planning-header-desktop {
            display: flex !important;
          }
          
          .ip-planning-actions-mobile {
            display: none !important;
          }
          
          .ip-planning-actions-desktop {
            display: flex !important;
          }
        }
        
        /* 訂單項目樣式調整 */
        .userdb-modal-body .order-item {
          padding: 12px !important;
          margin-bottom: 12px !important;
          font-size: 14px !important;
        }
        
        .userdb-modal-body .order-item .order-id {
          font-size: 13px !important;
          font-weight: 600 !important;
        }
        
        .userdb-modal-body .order-item .order-date,
        .userdb-modal-body .order-item .order-amount {
          font-size: 12px !important;
          color: #6b7280 !important;
        }
        
        /* 對話記錄樣式調整 */
        .userdb-modal-body .conversation-item {
          padding: 12px !important;
          margin-bottom: 12px !important;
          font-size: 14px !important;
        }
        
        .userdb-modal-body .conversation-item .conversation-preview {
          font-size: 13px !important;
          line-height: 1.5 !important;
        }
        
        /* 通用文字樣式調整 */
        .userdb-modal-body .text-sm {
          font-size: 12px !important;
        }
        
        .userdb-modal-body .text-base {
          font-size: 14px !important;
        }
        
        .userdb-modal-body .text-lg {
          font-size: 16px !important;
        }
        
        /* 標籤和徽章樣式調整 */
        .userdb-modal-body .badge,
        .userdb-modal-body .tag {
          font-size: 11px !important;
          padding: 4px 8px !important;
        }
        
        /* 分隔線樣式 */
        .userdb-modal-body hr {
          margin: 12px 0 !important;
        }
        
        /* 卡片樣式調整 */
        .userdb-modal-body .card {
          padding: 12px !important;
          margin-bottom: 12px !important;
        }
        
        /* 確保所有文字都能正確換行 */
        .userdb-modal-body * {
          max-width: 100% !important;
          box-sizing: border-box !important;
        }
        
        /* 手機版輸入框和選擇框優化 */
        input[type="text"],
        input[type="password"],
        input[type="email"],
        input[type="number"],
        textarea,
        select {
          min-height: 44px; /* iOS 最小觸控目標 */
          padding: 12px 16px !important;
          font-size: 16px !important; /* iOS Safari 建議至少 16px */
          border-radius: 8px;
          -webkit-appearance: none;
          appearance: none;
        }
        
        /* 手機版按鈕優化 */
        button {
          min-height: 44px; /* iOS 最小觸控目標 */
          -webkit-tap-highlight-color: transparent;
          touch-action: manipulation;
        }
        
        /* 手機版連結優化 */
        a {
          -webkit-tap-highlight-color: transparent;
          touch-action: manipulation;
        }
      }
    </style>
  </head>
  <body>
    <!-- 導航欄 -->
    <div class="top-navbar">
      <div class="navbar-left">
        <!-- 手機版抽屜按鈕 -->
        <button class="mobile-drawer-toggle" onclick="toggleMobileDrawer()">
          <span class="hamburger-icon">☰</span>
        </button>
        <div class="navbar-title clickable-title" onclick="window.location.href='index.html'">ReelMind</div>
        <div class="navbar-tabs">
          <a href="index.html" class="navbar-tab">首頁</a>
          <a href="mode1.html" class="navbar-tab">IP人設規劃</a>
          <a href="mode3.html" class="navbar-tab">一鍵生成</a>
          <a href="index.html#forum" class="navbar-tab" onclick="event.preventDefault(); window.location.href='index.html#forum'; return false;">論壇介紹</a>
          <a href="guide.html" class="navbar-tab">實戰指南</a>
          <a href="userDB.html" class="navbar-tab active">創作者資料庫</a>
        </div>
      </div>
      <div class="navbar-right">
        <div class="user-info" id="userInfo" style="display: none;" onclick="window.location.href='userDB.html'">
          <img id="userAvatar" class="user-avatar" src="" alt="用戶頭像" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; object-position: center;">
          <span id="userName" class="user-name"></span>
        </div>
        <div class="auth-buttons" id="authButtons" style="display: none;">
          <button id="loginBtn" class="login-btn" onclick="goToLogin()" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">🔐 登入</button>
        </div>
      </div>
    </div>

    <!-- 手機版抽屜 -->
    <div class="mobile-drawer-overlay" id="mobileDrawerOverlay" onclick="closeMobileDrawer()"></div>
    <div class="mobile-drawer" id="mobileDrawer">
      <div class="mobile-drawer-header">
        <h3>選單</h3>
        <button class="mobile-drawer-close" onclick="closeMobileDrawer()">✕</button>
      </div>
      <div class="mobile-drawer-content">
        <a href="index.html" class="mobile-drawer-item">
          <span class="mobile-drawer-icon"><i class="fas fa-home"></i></span>
          <span class="mobile-drawer-text">首頁</span>
        </a>
        <a href="mode1.html" class="mobile-drawer-item">
          <span class="mobile-drawer-icon"><i class="fas fa-user-tie"></i></span>
          <span class="mobile-drawer-text">IP人設規劃</span>
        </a>
        <a href="mode3.html" class="mobile-drawer-item">
          <span class="mobile-drawer-icon"><i class="fas fa-magic"></i></span>
          <span class="mobile-drawer-text">一鍵生成</span>
        </a>
        <a href="index.html#forum" class="mobile-drawer-item" onclick="window.location.href='index.html#forum'; closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon"><i class="fas fa-comments"></i></span>
          <span class="mobile-drawer-text">論壇介紹</span>
        </a>
        <a href="guide.html" class="mobile-drawer-item" onclick="window.location.href='guide.html'; closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon"><i class="fas fa-book-open"></i></span>
          <span class="mobile-drawer-text">實戰指南</span>
        </a>
        <a href="userDB.html" class="mobile-drawer-item active">
          <span class="mobile-drawer-icon"><i class="fas fa-database"></i></span>
          <span class="mobile-drawer-text">創作者資料庫</span>
        </a>
      </div>
    </div>

    <!-- 創作者資料庫頁面 -->
    <div class="user-db-page">
      <h2 class="page-title"><i class="fas fa-database" style="margin-right: 8px;"></i>創作者資料庫</h2>
      <div class="user-db-container">
        <!-- 左側功能選單 -->
        <div class="user-db-sidebar">
          <div class="sidebar-header">
            <div class="user-profile">
              <img id="dbUserAvatar" class="profile-avatar" src="" alt="用戶頭像">
              <div class="profile-info">
                <h3 id="dbUserName">用戶名稱</h3>
                <p id="dbUserEmail">user@example.com</p>
              </div>
            </div>
          </div>
          <nav class="sidebar-menu">
            <div class="menu-item active" onclick="handleMenuClick('personalInfo')">
              <span class="menu-icon"><i class="fas fa-user"></i></span>
              <span class="menu-text">個人資料</span>
            </div>
            <div class="menu-item" id="menu-ipPlanning" onclick="handleMenuClick('ipPlanning')" style="display: none;">
              <span class="menu-icon"><i class="fas fa-user-tie"></i></span>
              <span class="menu-text">IP人設規劃</span>
            </div>
            <div class="menu-item" onclick="handleMenuClick('oneClickGeneration')">
              <span class="menu-icon"><i class="fas fa-bolt"></i></span>
              <span class="menu-text">一鍵生成</span>
            </div>
            <div class="menu-item" onclick="handleMenuClick('myOrders')">
              <span class="menu-icon"><i class="fas fa-credit-card"></i></span>
              <span class="menu-text">我的訂單</span>
            </div>
            <div class="menu-item" onclick="handleMenuClick('settings')">
              <span class="menu-icon"><i class="fas fa-cog"></i></span>
              <span class="menu-text">設定</span>
            </div>
            <div class="menu-item" onclick="handleMenuClick('usageStats')">
              <span class="menu-icon"><i class="fas fa-chart-bar"></i></span>
              <span class="menu-text">使用統計</span>
            </div>
            <div class="menu-item" onclick="handleMenuClick('helpCenter')">
              <span class="menu-icon"><i class="fas fa-question-circle"></i></span>
              <span class="menu-text">幫助中心</span>
            </div>
            <div class="menu-divider"></div>
            <div class="menu-item logout-item" onclick="logout()">
              <span class="menu-icon"><i class="fas fa-sign-out-alt"></i></span>
              <span class="menu-text">登出</span>
            </div>
          </nav>
        </div>
        <!-- 手機版彈跳視窗 -->
        <div class="userdb-modal-overlay" id="userdbModalOverlay">
          <div class="userdb-modal-content" onclick="event.stopPropagation();">
            <div class="userdb-modal-header">
              <h3 class="userdb-modal-title" id="userdbModalTitle">標題</h3>
              <button class="userdb-modal-close" onclick="closeUserDbModal()">×</button>
            </div>
            <div class="userdb-modal-body" id="userdbModalBody">
              <p>載入中...</p>
            </div>
          </div>
        </div>
        
        <!-- 右側內容區域 -->
        <div class="user-db-content">
          <!-- 個人資料 -->
          <div id="db-personalInfo" class="db-section active">
            <h3 class="section-title"><i class="fas fa-user" style="margin-right: 8px;"></i>個人資料</h3>
            <div class="section-content">
              <p>載入中...</p>
            </div>
          </div>
          <!-- IP人設規劃 -->
          <div id="db-ipPlanning" class="db-section" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 12px;">
              <h3 class="section-title"><i class="fas fa-user-tie" style="margin-right: 8px;"></i>IP人設規劃</h3>
              <button onclick="exportIpPlanningResults()" style="padding: 10px 16px; min-height: 44px; background: #3B82F6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 500; -webkit-tap-highlight-color: transparent; touch-action: manipulation;"><i class="fas fa-download" style="margin-right: 4px;"></i>匯出</button>
            </div>
            <div class="section-content">
              <div class="ip-planning-tabs" style="display: flex; gap: 8px; margin-bottom: 20px; border-bottom: 2px solid #E5E7EB;">
                <button class="ip-planning-tab active" onclick="showIpPlanningType('profile')" style="padding: 10px 16px; min-height: 44px; border: none; background: transparent; cursor: pointer; border-bottom: 2px solid #3B82F6; color: #3B82F6; font-weight: 600; -webkit-tap-highlight-color: transparent; touch-action: manipulation;">帳號定位</button>
                <button class="ip-planning-tab" onclick="showIpPlanningType('plan')" style="padding: 10px 16px; min-height: 44px; border: none; background: transparent; cursor: pointer; color: #6B7280; -webkit-tap-highlight-color: transparent; touch-action: manipulation;">選題方向（影片類型配比）</button>
                <button class="ip-planning-tab" onclick="showIpPlanningType('scripts')" style="padding: 10px 16px; min-height: 44px; border: none; background: transparent; cursor: pointer; color: #6B7280; -webkit-tap-highlight-color: transparent; touch-action: manipulation;">一週腳本</button>
              </div>
              <div id="ip-planning-content" class="ip-planning-content">
                <div class="loading-text">載入中...</div>
              </div>
            </div>
          </div>
          <!-- 一鍵生成 -->
          <div id="db-oneClickGeneration" class="db-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 12px;">
              <h3 class="section-title"><i class="fas fa-bolt" style="margin-right: 8px;"></i>一鍵生成</h3>
              <button onclick="exportOneClickGenerationResults()" style="padding: 10px 16px; min-height: 44px; background: #3B82F6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 500; -webkit-tap-highlight-color: transparent; touch-action: manipulation;"><i class="fas fa-download" style="margin-right: 4px;"></i>匯出</button>
            </div>
            <div class="section-content">
              <div class="one-click-tabs" style="display: flex; gap: 8px; margin-bottom: 20px; border-bottom: 2px solid #E5E7EB;">
                <button class="one-click-tab active" onclick="showOneClickType('profile')" style="padding: 10px 16px; min-height: 44px; border: none; background: transparent; cursor: pointer; border-bottom: 2px solid #3B82F6; color: #3B82F6; font-weight: 600; -webkit-tap-highlight-color: transparent; touch-action: manipulation;">帳號定位</button>
                <button class="one-click-tab" onclick="showOneClickType('plan')" style="padding: 10px 16px; min-height: 44px; border: none; background: transparent; cursor: pointer; color: #6B7280; -webkit-tap-highlight-color: transparent; touch-action: manipulation;">選題方向</button>
                <button class="one-click-tab" onclick="showOneClickType('scripts')" style="padding: 10px 16px; min-height: 44px; border: none; background: transparent; cursor: pointer; color: #6B7280; -webkit-tap-highlight-color: transparent; touch-action: manipulation;">腳本</button>
              </div>
              <div id="one-click-content" class="one-click-content">
                <div class="loading-text">載入中...</div>
              </div>
            </div>
          </div>
          <!-- 我的訂單 -->
          <div id="db-myOrders" class="db-section">
            <h3 class="section-title"><i class="fas fa-credit-card" style="margin-right: 8px;"></i>我的訂單</h3>
            <div class="section-content" id="myOrdersContent">
              <div class="loading-text">載入中...</div>
            </div>
          </div>
          <!-- 設定 -->
          <div id="db-settings" class="db-section">
            <h3 class="section-title"><i class="fas fa-cog" style="margin-right: 8px;"></i>設定</h3>
            <div class="section-content" id="settingsContent">
              <div class="settings-container">
                <!-- BYOK 說明 -->
                <div class="byok-notice" style="margin-bottom: 24px; padding: 16px; background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px;">
                  <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                    <i class="fas fa-key" style="font-size: 24px; color: #0369a1;"></i>
                    <h4 style="margin: 0; color: #0369a1; font-size: 16px; font-weight: 600;">AI API Key金鑰管理</h4>
                  </div>
                  <p style="margin: 0; color: #0c4a6e; font-size: 14px; line-height: 1.6;">
                    使用您自己的 API 金鑰可以獲得更高的使用額度和更穩定的服務
                  </p>
                </div>
                
                <div class="setting-group">
                  <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
                    <h4 style="margin: 0;"><i class="fas fa-key" style="margin-right: 8px;"></i>AI API Key金鑰管理</h4>
                    <button onclick="window.location.href='https://reelmind.aijob.com.tw/guide.html?article=article5'; return false;" style="
                      padding: 8px 16px;
                      background: #3b82f6;
                      color: white;
                      border: none;
                      border-radius: 6px;
                      font-weight: 600;
                      cursor: pointer;
                      font-size: 14px;
                      display: inline-flex;
                      align-items: center;
                      gap: 6px;
                      -webkit-tap-highlight-color: transparent;
                      touch-action: manipulation;
                    ">
                      <i class="fas fa-question-circle"></i>
                      如何取得
                    </button>
                  </div>
                  <div class="setting-item">
                    <label for="llmProvider">選擇大型語言模型(LLM) 提供商</label>
                    <select id="llmProvider" onchange="updateModelOptions()" style="margin-bottom: 12px; padding: 12px 16px; min-height: 44px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 16px; width: 100%; -webkit-appearance: none; appearance: none;">
                      <option value="gemini">Google Gemini</option>
                      <option value="openai">OpenAI (GPT)</option>
                    </select>
                  </div>
                  <div class="setting-item" id="llmModelContainer">
                    <label for="llmModel">選擇模型（可選，留空則使用系統預設）</label>
                    <select id="llmModel" style="margin-bottom: 12px; padding: 12px 16px; min-height: 44px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 16px; width: 100%; -webkit-appearance: none; appearance: none;">
                      <option value="">請先選擇提供商...</option>
                    </select>
                    <span class="setting-desc" style="margin-top: 8px; display: block; color: #6b7280; font-size: 12px;">
                      選擇您想要使用的模型。如果留空，系統將使用預設模型。
                    </span>
                  </div>
                  <div class="setting-item" id="llmKeyContainer">
                    <label for="llmApiKey">API 金鑰</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                      <input 
                        type="password" 
                        id="llmApiKey" 
                        placeholder="輸入您的 API 金鑰"
                        style="flex: 1; padding: 12px 16px; min-height: 44px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 16px; -webkit-appearance: none; appearance: none;"
                      />
                      <button 
                        type="button" 
                        onclick="toggleApiKeyVisibility()"
                        style="padding: 10px 12px; min-height: 44px; min-width: 44px; background: #f3f4f6; border: 1px solid #e5e7eb; border-radius: 6px; cursor: pointer; -webkit-tap-highlight-color: transparent; touch-action: manipulation;"
                      >
                        <i class="fas fa-eye" id="toggleKeyIcon"></i>
                      </button>
                    </div>
                    <div id="savedKeyDisplay" style="display: none; margin-top: 8px;">
                      <span style="color: #6b7280; font-size: 12px;">已保存的金鑰: <span id="savedKeyLast4"></span></span>
                      <button 
                        type="button" 
                        onclick="clearSavedApiKey()"
                        style="margin-left: 8px; padding: 8px 12px; min-height: 44px; font-size: 14px; color: #ef4444; background: none; border: none; cursor: pointer; -webkit-tap-highlight-color: transparent; touch-action: manipulation;"
                      >
                        清除
                      </button>
                    </div>
                    <span class="setting-desc" style="margin-top: 8px; display: block; color: #6b7280; font-size: 12px;">
                      您的 API 金鑰將以加密方式安全存儲在伺服器上，僅用於生成 AI 內容
                    </span>
                  </div>
                  <div class="setting-item">
                    <button onclick="saveApiKey()" style="margin-right: 8px; padding: 10px 16px; min-height: 44px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; -webkit-tap-highlight-color: transparent; touch-action: manipulation;"><i class="fas fa-save" style="margin-right: 4px;"></i>保存金鑰</button>
                    <button onclick="testApiKey()" style="padding: 10px 16px; min-height: 44px; background: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; border-radius: 6px; cursor: pointer; font-weight: 500; -webkit-tap-highlight-color: transparent; touch-action: manipulation;"><i class="fas fa-vial" style="margin-right: 4px;"></i>測試金鑰</button>
                    <span class="setting-desc" style="display: block; margin-top: 8px; color: #6b7280; font-size: 12px;">
                      保存前建議先測試金鑰是否有效
                    </span>
                    <div id="testKeyResult" style="display: none; margin-top: 12px; padding: 12px; border-radius: 6px; font-size: 14px;"></div>
                  </div>
                </div>
                
                <div class="setting-group" style="margin-top: 32px;">
                  <h4><i class="fas fa-chart-bar" style="margin-right: 8px;"></i>數據管理</h4>
                  <div class="setting-item">
                    <button onclick="exportUserData()" style="padding: 10px 16px; min-height: 44px; background: #f3f4f6; color: #374151; border: 1px solid #e5e7eb; border-radius: 6px; cursor: pointer; font-weight: 500; margin-bottom: 8px; -webkit-tap-highlight-color: transparent; touch-action: manipulation;"><i class="fas fa-download" style="margin-right: 4px;"></i>匯出我的資料</button>
                    <span class="setting-desc" style="display: block; color: #6b7280; font-size: 12px;">匯出所有腳本、對話、定位記錄為 Excel 檔案（不同功能分不同分頁）</span>
                  </div>
                  <div class="setting-item">
                    <button onclick="clearUserData()" style="padding: 10px 16px; min-height: 44px; background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; border-radius: 6px; cursor: pointer; font-weight: 500; margin-bottom: 8px; -webkit-tap-highlight-color: transparent; touch-action: manipulation;"><i class="fas fa-trash-alt" style="margin-right: 4px;"></i>清除本地快取</button>
                    <span class="setting-desc" style="display: block; color: #6b7280; font-size: 12px;">清除本地暫存數據</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- 使用統計 -->
          <div id="db-usageStats" class="db-section">
            <h3 class="section-title"><i class="fas fa-chart-bar" style="margin-right: 8px;"></i>使用統計</h3>
            <div class="section-content" id="usageStatsContent">
              <div class="stats-overview" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 24px;">
                <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                  <div class="stat-number" id="totalScripts" style="font-size: 32px; font-weight: 700; color: #3b82f6; margin-bottom: 8px;">0</div>
                  <div class="stat-label" style="color: #6b7280; font-size: 14px;">已生成腳本</div>
                </div>
                <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                  <div class="stat-number" id="totalPositioning" style="font-size: 32px; font-weight: 700; color: #10b981; margin-bottom: 8px;">0</div>
                  <div class="stat-label" style="color: #6b7280; font-size: 14px;">帳號定位記錄</div>
                </div>
                <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                  <div class="stat-number" id="totalTopics" style="font-size: 32px; font-weight: 700; color: #f59e0b; margin-bottom: 8px;">0</div>
                  <div class="stat-label" style="color: #6b7280; font-size: 14px;">選題記錄</div>
                </div>
                <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                  <div class="stat-number" id="totalConversations" style="font-size: 32px; font-weight: 700; color: #8b5cf6; margin-bottom: 8px;">0</div>
                  <div class="stat-label" style="color: #6b7280; font-size: 14px;">對話次數</div>
                </div>
              </div>
              <div class="stats-chart" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                <canvas id="usageChart"></canvas>
              </div>
            </div>
          </div>
          <!-- 幫助中心 -->
          <div id="db-helpCenter" class="db-section">
            <h3 class="section-title"><i class="fas fa-question-circle" style="margin-right: 8px;"></i>幫助中心</h3>
            <div class="section-content" id="helpContent">
              <div class="help-container">
                <div class="help-section" style="margin-bottom: 24px; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                  <h4 style="margin: 0 0 12px 0; color: #1f2937; font-size: 18px; font-weight: 600;"><i class="fas fa-rocket" style="margin-right: 8px;"></i>快速開始</h4>
                  <ul style="margin: 0; padding-left: 20px; color: #374151; line-height: 1.8;">
                    <li>首次使用建議先嘗試「一鍵生成」功能</li>
                    <li>點擊「開始」按鈕即可生成帳號定位、選題、腳本</li>
                    <li>所有生成內容會自動保存到「我的腳本」</li>
                  </ul>
                </div>
                <div class="help-section" style="margin-bottom: 24px; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                  <h4 style="margin: 0 0 12px 0; color: #1f2937; font-size: 18px; font-weight: 600;"><i class="fas fa-list" style="margin-right: 8px;"></i>三大使用模式</h4>
                  <ul style="margin: 0; padding-left: 20px; color: #374151; line-height: 1.8;">
                    <li><strong>一鍵生成：</strong>快速生成定位、選題、腳本</li>
                    <li><strong>IP人設規劃：</strong>14天規劃與個人化資料庫</li>
                  </ul>
                </div>
                <div class="help-section" style="margin-bottom: 24px; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                  <h4 style="margin: 0 0 12px 0; color: #1f2937; font-size: 18px; font-weight: 600;"><i class="fas fa-database" style="margin-right: 8px;"></i>資料庫功能</h4>
                  <ul style="margin: 0; padding-left: 20px; color: #374151; line-height: 1.8;">
                    <li>所有生成內容自動保存</li>
                    <li>可在「創作者資料庫」查看歷史記錄</li>
                    <li>支持重命名、刪除、查看詳情</li>
                  </ul>
                </div>
                <div class="help-section" style="margin-bottom: 24px; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                  <h4 style="margin: 0 0 12px 0; color: #1f2937; font-size: 18px; font-weight: 600;"><i class="fas fa-question-circle" style="margin-right: 8px;"></i>常見問題</h4>
                  <div class="faq-item" style="margin-bottom: 16px;">
                    <strong style="display: block; margin-bottom: 4px; color: #1f2937;">Q: 如何保存腳本？</strong>
                    <p style="margin: 0; color: #6b7280;">A: 點擊生成結果右上角的「保存」按鈕即可。</p>
                  </div>
                  <div class="faq-item" style="margin-bottom: 16px;">
                    <strong style="display: block; margin-bottom: 4px; color: #1f2937;">Q: 可以匯出資料嗎？</strong>
                    <p style="margin: 0; color: #6b7280;">A: 可以，在「設定」→「資料管理」中選擇匯出。</p>
                  </div>
                  <div class="faq-item">
                    <strong style="display: block; margin-bottom: 4px; color: #1f2937;">Q: 如何刪除記錄？</strong>
                    <p style="margin: 0; color: #6b7280;">A: 在「創作者資料庫」中找到對應記錄，點擊刪除按鈕。</p>
                  </div>
                </div>
                <div class="help-section" style="padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                  <h4 style="margin: 0 0 12px 0; color: #1f2937; font-size: 18px; font-weight: 600;"><i class="fas fa-phone" style="margin-right: 8px;"></i>聯絡我們</h4>
                  <p style="margin: 0 0 8px 0; color: #374151;">如有問題，請聯繫客服：</p>
                  <ul style="margin: 0; padding-left: 20px; color: #374151; line-height: 1.8;">
                    <li>Email: aiagent168168@gmail.com</li>
                    <li>Discord: <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="color: #3b82f6; text-decoration: none;">加入社群</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 載入共用 JavaScript 檔案 -->
    <script src="assets/js/config.js?v=20251126"></script>
    <script src="assets/js/auth.js?v=20251125"></script>
    <script src="assets/js/api.js?v=20251125"></script>
    <script src="assets/js/common.js?v=20251126"></script>
    <script src="assets/js/userDB.js?v=20251130"></script>
    
    <script>
      // API_BASE_URL 已在 config.js 中定義為全局變數
      // 這裡直接使用 window.APP_CONFIG，避免重複聲明
      const API_URL = window.APP_CONFIG?.API_BASE || 'https://api.aijob.com.tw';
      let ipPlanningToken = localStorage.getItem('ipPlanningToken') || '';
      let ipPlanningUser = JSON.parse(localStorage.getItem('ipPlanningUser') || 'null');

      // 手機版抽屜切換
      function toggleMobileDrawer() {
        const drawer = document.getElementById('mobileDrawer');
        const overlay = document.getElementById('mobileDrawerOverlay');
        
        if (drawer && overlay) {
          const isOpen = drawer.classList.contains('open');
          
          if (isOpen) {
            closeMobileDrawer();
          } else {
            openMobileDrawer();
          }
        }
      }

      function openMobileDrawer() {
        const drawer = document.getElementById('mobileDrawer');
        const overlay = document.getElementById('mobileDrawerOverlay');
        
        if (drawer && overlay) {
          drawer.classList.add('open');
          overlay.style.display = 'block';
          document.body.style.overflow = 'hidden';
        }
      }

      function closeMobileDrawer() {
        const drawer = document.getElementById('mobileDrawer');
        const overlay = document.getElementById('mobileDrawerOverlay');
        
        if (drawer && overlay) {
          drawer.classList.remove('open');
          overlay.style.display = 'none';
          document.body.style.overflow = '';
        }
      }
      
      // 登入/登出函數（從 common.js 使用）
      function goToLogin() {
        if (window.ReelMindCommon && window.ReelMindCommon.goToLogin) {
          window.ReelMindCommon.goToLogin();
        } else {
          window.location.href = 'index.html';
        }
      }
      
      function logout() {
        // 清除所有登入相關的 localStorage
        localStorage.removeItem('ipPlanningToken');
        localStorage.removeItem('ipPlanningRefreshToken');
        localStorage.removeItem('ipPlanningUser');
        localStorage.removeItem('ipPlanningTokenUpdated');
        localStorage.removeItem('subscriptionStatus');
        
        // 清除 CSRF Token 緩存
        if (window.Api && window.Api.clearCsrfToken) {
          window.Api.clearCsrfToken();
        }
        
        // 直接跳轉到首頁（不顯示中間頁面）
        window.location.href = 'index.html';
      }
      
      // 更新用戶資訊顯示
      function updateUserInfo() {
        const userInfoDiv = document.getElementById('userInfo');
        const authButtonsDiv = document.getElementById('authButtons');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const dbUserAvatar = document.getElementById('dbUserAvatar');
        const dbUserName = document.getElementById('dbUserName');
        const dbUserEmail = document.getElementById('dbUserEmail');
        
        if (ipPlanningUser && ipPlanningToken) {
          // 顯示用戶資訊
          if (userInfoDiv) userInfoDiv.style.display = 'flex';
          if (authButtonsDiv) authButtonsDiv.style.display = 'none';
          
          if (userAvatar && ipPlanningUser.picture) {
            userAvatar.src = ipPlanningUser.picture;
            userAvatar.alt = ipPlanningUser.name || '用戶頭像';
          }
          
          if (userName) {
            userName.textContent = ipPlanningUser.name || '用戶';
          }
          
          if (dbUserAvatar && ipPlanningUser.picture) {
            dbUserAvatar.src = ipPlanningUser.picture;
            dbUserAvatar.alt = ipPlanningUser.name || '用戶頭像';
          }
          
          if (dbUserName) {
            dbUserName.textContent = ipPlanningUser.name || '用戶名稱';
          }
          
          if (dbUserEmail) {
            dbUserEmail.textContent = ipPlanningUser.email || 'user@example.com';
          }
        } else {
          // 顯示登入按鈕
          if (userInfoDiv) userInfoDiv.style.display = 'none';
          if (authButtonsDiv) authButtonsDiv.style.display = 'flex';
        }
      }
      
      // 切換資料庫區塊
      async function showDbSection(sectionName) {
        // 隱藏所有分區
        document.querySelectorAll('.db-section').forEach(section => {
          section.classList.remove('active');
        });
        
        // 移除所有選單項的active狀態
        document.querySelectorAll('.menu-item').forEach(item => {
          item.classList.remove('active');
        });
        
        // 顯示選中的分區
        const targetSection = document.getElementById(`db-${sectionName}`);
        if (targetSection) {
          targetSection.classList.add('active');
        }
        
        // 添加對應選單項的active狀態
        const targetMenuItem = document.querySelector(`[onclick="showDbSection('${sectionName}')"]`);
        if (targetMenuItem) {
          targetMenuItem.classList.add('active');
        }
        
        // 根據分區載入相應數據
        try {
        switch(sectionName) {
          case 'personalInfo':
              // 優先使用 userDB.js 中的函數
              if (window.loadPersonalInfoForUserDB && typeof window.loadPersonalInfoForUserDB === 'function') {
                await window.loadPersonalInfoForUserDB();
              } else if (typeof loadPersonalInfoForUserDB === 'function') {
                await loadPersonalInfoForUserDB();
              }
            break;
          case 'myScripts':
              if (window.loadMyScriptsForUserDB && typeof window.loadMyScriptsForUserDB === 'function') {
                await window.loadMyScriptsForUserDB();
              } else if (typeof loadMyScriptsForUserDB === 'function') {
                await loadMyScriptsForUserDB();
              }
            break;
          case 'settings':
              // 確保 loadSavedApiKey 函數已載入
              if (typeof loadSavedApiKey === 'function') {
                await loadSavedApiKey();
              } else if (window.loadSavedApiKey && typeof window.loadSavedApiKey === 'function') {
                await window.loadSavedApiKey();
              } else {
                console.error('loadSavedApiKey 函數未找到');
              }
            break;
          case 'accountPositioning':
              if (window.loadPositioningRecordsForUserDB && typeof window.loadPositioningRecordsForUserDB === 'function') {
                await window.loadPositioningRecordsForUserDB();
              } else if (typeof loadPositioningRecordsForUserDB === 'function') {
                await loadPositioningRecordsForUserDB();
              }
            break;
          case 'topicRecords':
              if (window.loadTopicHistoryForUserDB && typeof window.loadTopicHistoryForUserDB === 'function') {
                await window.loadTopicHistoryForUserDB();
              } else if (typeof loadTopicHistoryForUserDB === 'function') {
                await loadTopicHistoryForUserDB();
              }
            break;
          case 'ipPlanning':
              if (window.loadIpPlanningResultsForUserDB && typeof window.loadIpPlanningResultsForUserDB === 'function') {
                await window.loadIpPlanningResultsForUserDB();
              } else if (typeof loadIpPlanningResultsForUserDB === 'function') {
                await loadIpPlanningResultsForUserDB();
              }
            break;
          case 'myOrders':
              if (window.loadMyOrdersForUserDB && typeof window.loadMyOrdersForUserDB === 'function') {
                await window.loadMyOrdersForUserDB();
              } else if (typeof loadMyOrdersForUserDB === 'function') {
                await loadMyOrdersForUserDB();
              }
            break;
          case 'usageStats':
              if (window.loadUsageStatsForUserDB && typeof window.loadUsageStatsForUserDB === 'function') {
                await window.loadUsageStatsForUserDB();
              } else if (typeof loadUsageStatsForUserDB === 'function') {
                await loadUsageStatsForUserDB();
              }
            break;
          case 'helpCenter':
            // 幫助中心內容已在HTML中定義，無需動態載入
            break;
        }
        } catch (error) {
          console.error('載入分區數據失敗:', error);
          if (window.ReelMindCommon && window.ReelMindCommon.showToast) {
            window.ReelMindCommon.showToast('載入失敗，請稍後再試', 3000);
          }
        }
      }
      
      // 導出到 window 以便 HTML onclick 調用
      window.showDbSection = showDbSection;
      
      // 統一的載入動畫函數
      function showLoadingAnimation(container, message = '載入中...') {
        if (!container) return;
        container.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; padding: 40px; gap: 12px; flex-direction: column;">
            <div class="spinner" style="width: 24px; height: 24px; border: 3px solid #e5e7eb; border-top: 3px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 8px;"></div>
            <span style="color: #6b7280; font-size: 14px;">${message}</span>
          </div>
        `;
      }
      
      // 格式化台灣時區時間
      function formatTaiwanTime(dateString) {
        if (!dateString) return '-';
        try {
          const date = new Date(dateString);
          if (isNaN(date.getTime())) {
            return dateString;
          }
          return date.toLocaleString('zh-TW', {
            timeZone: 'Asia/Taipei',
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          });
        } catch (error) {
          console.error('格式化台灣時區時間錯誤:', error);
          return dateString;
        }
      }
      
      // 顯示 Toast 通知
      function showToast(message, duration = 3000) {
        if (window.ReelMindCommon && window.ReelMindCommon.showToast) {
          window.ReelMindCommon.showToast(message, duration);
        } else {
          alert(message);
        }
      }
      
      // 載入個人資料庫的個人資料（此函數已被 assets/js/userDB.js 中的版本覆蓋，保留此處僅作為備用）
      async function loadPersonalInfoForUserDB() {
        // 如果 userDB.js 中的函數已載入，使用那個版本（避免遞迴調用）
        const userDBJsFunction = window.loadPersonalInfoForUserDB;
        if (userDBJsFunction && userDBJsFunction !== arguments.callee && typeof userDBJsFunction === 'function') {
          try {
            const funcString = userDBJsFunction.toString();
            if (funcString.includes('assets/js/userDB.js') || funcString.length > 500) {
              return await userDBJsFunction();
            }
          } catch (e) {
            console.warn('調用 userDB.js 中的 loadPersonalInfoForUserDB 失敗，使用本地版本:', e);
          }
        }
        
        const content = document.querySelector('#db-personalInfo .section-content');
        if (!content) return;
        
        if (!ipPlanningUser) {
          content.innerHTML = '<div class="loading-text">請先登入以查看個人資料</div>';
          return;
        }
        
        // 如果用戶資料已經完整，直接渲染，不需要 loading 和延遲
        if (ipPlanningUser && (ipPlanningUser.name || ipPlanningUser.email) && ipPlanningUser.created_at) {
          await renderPersonalInfoContent();
          return;
        }
        
        // 只有在需要載入資料時才顯示 loading
        showLoadingAnimation(content, '載入個人資料中...');
        
        // 如果用戶資料不完整，先嘗試從 API 獲取
        if (ipPlanningToken && !ipPlanningUser.created_at) {
          try {
            await fetchUserInfo();
            // API 請求完成後再渲染
            await renderPersonalInfoContent();
          } catch (error) {
            console.warn('無法從伺服器獲取最新資訊，使用本地資料');
            // 即使 API 失敗，也嘗試用本地資料渲染
            if (ipPlanningUser && (ipPlanningUser.name || ipPlanningUser.email)) {
              await renderPersonalInfoContent();
            } else {
              content.innerHTML = '<div class="loading-text">載入失敗，請稍後再試</div>';
            }
          }
        } else if (ipPlanningUser && (ipPlanningUser.name || ipPlanningUser.email)) {
          // 有本地資料但沒有 created_at，直接渲染（不需要等待）
          await renderPersonalInfoContent();
        } else {
          content.innerHTML = '<div class="loading-text">暫無個人資料</div>';
        }
      }
      
      // 渲染個人資料內容
      async function renderPersonalInfoContent() {
        const content = document.querySelector('#db-personalInfo .section-content');
        if (!content || !ipPlanningUser) return;
        
        let registrationTime = '未知';
        if (ipPlanningUser.created_at) {
          try {
            const date = new Date(ipPlanningUser.created_at);
            if (!isNaN(date.getTime())) {
              registrationTime = date.toLocaleString('zh-TW', {
                timeZone: 'Asia/Taipei',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
              });
            }
          } catch (e) {
            registrationTime = ipPlanningUser.created_at;
          }
        }
        
        const isSubscribed = ipPlanningUser.is_subscribed !== false;
        const subscriptionStatus = isSubscribed ? 
          '<span style="color: #10b981; font-weight: bold;"><i class="fas fa-check-circle" style="margin-right: 4px;"></i>已訂閱</span>' : 
          '<span style="color: #ef4444; font-weight: bold;"><i class="fas fa-times-circle" style="margin-right: 4px;"></i>未訂閱</span>';
        
        let expiresAt = null;
        let daysLeft = null;
        let expiresAtText = '未知';
        let daysLeftText = '';
        let expirationWarning = '';
        
        if (ipPlanningToken && ipPlanningUser?.user_id) {
          try {
            const subResponse = await fetch(`${API_URL}/api/user/subscription`, {
              headers: {
                'Authorization': `Bearer ${ipPlanningToken}`
              }
            });
            
            if (subResponse.ok) {
              const subData = await subResponse.json();
              if (subData.expires_at) {
                expiresAt = new Date(subData.expires_at);
                const now = new Date();
                daysLeft = Math.ceil((expiresAt - now) / (1000 * 60 * 60 * 24));
                
                expiresAtText = expiresAt.toLocaleString('zh-TW', {
                  timeZone: 'Asia/Taipei',
                  year: 'numeric',
                  month: '2-digit',
                  day: '2-digit',
                  hour: '2-digit',
                  minute: '2-digit'
                });
                
                if (daysLeft < 0) {
                  daysLeftText = `<span style="color: #ef4444; font-weight: bold;">（已過期 ${Math.abs(daysLeft)} 天）</span>`;
                  expirationWarning = '<div style="margin-top: 12px; padding: 12px; background: #fee2e2; border: 1px solid #fca5a5; border-radius: 8px; color: #991b1b;"><strong><i class="fas fa-exclamation-triangle" style="margin-right: 4px;"></i>訂閱已過期</strong><br>請前往訂閱頁面續費以繼續使用服務。</div>';
                } else if (daysLeft <= 3) {
                  daysLeftText = `<span style="color: #ef4444; font-weight: bold;">（剩餘 ${daysLeft} 天）</span>`;
                  expirationWarning = '<div style="margin-top: 12px; padding: 12px; background: #fef3c7; border: 1px solid #fde68a; border-radius: 8px; color: #92400e;"><strong><i class="fas fa-exclamation-triangle" style="margin-right: 4px;"></i>訂閱即將到期</strong><br>請盡快前往訂閱頁面續費。</div>';
                } else if (daysLeft <= 7) {
                  daysLeftText = `<span style="color: #f59e0b; font-weight: bold;">（剩餘 ${daysLeft} 天）</span>`;
                  expirationWarning = '<div style="margin-top: 12px; padding: 12px; background: #fffbeb; border: 1px solid #fde68a; border-radius: 8px; color: #92400e;"><strong>提醒</strong><br>您的訂閱將在 7 天內到期，請記得續費。</div>';
                } else {
                  daysLeftText = `<span style="color: #10b981;">（剩餘 ${daysLeft} 天）</span>`;
                }
              }
            }
          } catch (e) {
            console.warn('載入訂閱詳情失敗:', e);
          }
        }
        
        content.innerHTML = `
          <div class="profile-details">
            <div class="detail-item">
              <label>姓名：</label>
              <span>${escapeHtml(ipPlanningUser.name || '未設定')}</span>
            </div>
            <div class="detail-item">
              <label>Email：</label>
              <span>${escapeHtml(ipPlanningUser.email || '未設定')}</span>
            </div>
            <div class="detail-item">
              <label>用戶ID：</label>
              <span>${escapeHtml(ipPlanningUser.user_id || '未生成')}</span>
            </div>
            <div class="detail-item">
              <label>註冊時間：</label>
              <span>${escapeHtml(registrationTime)}</span>
            </div>
            <div class="detail-item">
              <label>訂閱狀態：</label>
              <span>${subscriptionStatus}</span>
            </div>
            ${isSubscribed ? `
            <div class="detail-item">
              <label>到期日期：</label>
              <span>${escapeHtml(expiresAtText)} ${daysLeftText}</span>
            </div>
            ${expirationWarning}
            <div class="detail-actions" style="margin-top: 16px; display: flex; gap: 8px; flex-wrap: wrap;">
              <a href="subscription.html" style="display: inline-flex; align-items: center; justify-content: center; padding: 10px 16px; min-height: 44px; background: #3B82F6; color: white; border-radius: 6px; text-decoration: none; font-weight: 500; font-size: 14px; -webkit-tap-highlight-color: transparent; touch-action: manipulation;">
                <i class="fas fa-credit-card" style="margin-right: 4px;"></i>續費訂閱
              </a>
              ${userInfo.auto_renew !== false ? `
              <button onclick="cancelAutoRenewForUserDB()" style="display: inline-block; padding: 10px 16px; min-height: 44px; background: #EF4444; color: white; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; font-size: 14px; -webkit-tap-highlight-color: transparent; touch-action: manipulation;">
                <i class="fas fa-ban" style="margin-right: 4px;"></i>取消自動續費
              </button>
              ` : `
              <div style="display: inline-block; padding: 8px 16px; background: #F3F4F6; color: #6B7280; border-radius: 6px; font-weight: 500; font-size: 14px;">
                <i class="fas fa-check-circle" style="margin-right: 4px;"></i>已取消自動續費
              </div>
              `}
            </div>
            ` : `
            <div class="detail-actions">
              <a href="subscription.html" style="display: inline-block; padding: 10px 16px; min-height: 44px; background: #10b981; color: white; border-radius: 6px; text-decoration: none; font-weight: 500; -webkit-tap-highlight-color: transparent; touch-action: manipulation;">
                ✨ 啟用訂閱
              </a>
            </div>
            `}
          </div>
        `;
      }
      
      // XSS 防護函數
      function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
      
      // 獲取用戶資訊
      async function fetchUserInfo() {
        if (!ipPlanningToken) return;
        
        try {
          const response = await fetch(`${API_URL}/api/auth/me`, {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            const userData = await response.json();
            ipPlanningUser = userData;
            localStorage.setItem('ipPlanningUser', JSON.stringify(userData));
            updateUserInfo();
            
            // 獲取用戶資訊後，檢查 IP 人設規劃權限
            if (typeof checkIpPlanningPermission === 'function') {
              await checkIpPlanningPermission();
            }
          } else if (response.status === 401) {
            // Token 過期，嘗試刷新
            if (window.Api && window.Api.refreshTokenIfNeeded) {
              await window.Api.refreshTokenIfNeeded();
              // 刷新後重試
              if (ipPlanningToken) {
                return fetchUserInfo();
              }
            }
          }
        } catch (error) {
          console.error('獲取用戶資訊失敗:', error);
        }
      }
      
      // 處理選單點擊（手機版用彈跳視窗，桌面版用原有方式）
      function handleMenuClick(sectionName) {
        const isMobile = window.innerWidth <= 768;
        
        if (isMobile) {
          // 手機版：顯示彈跳視窗
          openUserDbModal(sectionName);
        } else {
          // 桌面版：使用原有方式
          showDbSection(sectionName);
        }
      }
      
      // 檢查 IP 人設規劃權限（頁面載入時）
      if (typeof checkIpPlanningPermission === 'function') {
        checkIpPlanningPermission();
      }
      
      // 打開彈跳視窗
      function openUserDbModal(sectionName) {
        const overlay = document.getElementById('userdbModalOverlay');
        const titleEl = document.getElementById('userdbModalTitle');
        const bodyEl = document.getElementById('userdbModalBody');
        
        if (!overlay || !titleEl || !bodyEl) {
          console.error('彈跳視窗元素未找到:', { overlay, titleEl, bodyEl });
          return;
        }
        
        console.log('打開彈跳視窗:', sectionName);
        
        // 設置標題
        const titleMap = {
          'personalInfo': '個人資料',
          'myScripts': '我的腳本',
          'accountPositioning': '帳號定位',
          'topicRecords': '選題內容',
          'ipPlanning': 'IP人設規劃',
          'myOrders': '我的訂單',
          'settings': '設定',
          'usageStats': '使用統計',
          'helpCenter': '幫助中心'
        };
        titleEl.textContent = titleMap[sectionName] || '內容';
        
        // 更新選單項的 active 狀態
        document.querySelectorAll('.menu-item').forEach(item => {
          item.classList.remove('active');
        });
        const targetMenuItem = document.querySelector(`[onclick="handleMenuClick('${sectionName}')"]`);
        if (targetMenuItem) {
          targetMenuItem.classList.add('active');
        }
        
        // 載入內容
        bodyEl.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; padding: 40px;"><div class="spinner" style="width: 24px; height: 24px; border: 3px solid #e5e7eb; border-top: 3px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite;"></div></div>';
        
        // 獲取對應的內容區域
        const targetSection = document.getElementById(`db-${sectionName}`);
        if (!targetSection) {
          console.error('找不到目標區塊:', `db-${sectionName}`);
          bodyEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #ef4444;">找不到對應的內容區塊</div>';
          return;
        }
        
        // 先顯示內容區域（臨時）以獲取內容
        const originalDisplay = targetSection.style.display;
        targetSection.style.display = 'block';
        const sectionContent = targetSection.querySelector('.section-content');
        
        if (!sectionContent) {
          console.error('找不到 section-content:', targetSection);
          bodyEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #ef4444;">找不到內容區域</div>';
          targetSection.style.display = originalDisplay;
          return;
        }
        
        // 載入數據（優化版：個人資料優先使用已載入的資料）
        const loadContent = async () => {
          try {
            // 個人資料特殊處理：如果資料已完整，直接渲染，不需要等待 API
            if (sectionName === 'personalInfo' && ipPlanningUser && (ipPlanningUser.name || ipPlanningUser.email)) {
              // 資料已存在，先嘗試直接渲染（使用 userDB.html 中的 renderPersonalInfoContent）
              if (typeof renderPersonalInfoContent === 'function') {
                // 確保 section 可見以渲染內容
                targetSection.style.display = 'block';
                await renderPersonalInfoContent();
                // 等待渲染完成（減少延遲）
                await new Promise(resolve => setTimeout(resolve, 50));
                if (sectionContent && sectionContent.innerHTML && sectionContent.innerHTML.trim() !== '') {
                  bodyEl.innerHTML = sectionContent.innerHTML;
                  console.log('個人資料已快速載入到彈跳視窗');
                  targetSection.style.display = originalDisplay || 'none';
                  return;
                }
              }
            }
            
            switch(sectionName) {
              case 'personalInfo':
                await loadPersonalInfoForUserDB();
                break;
              case 'myScripts':
                await loadMyScriptsForUserDB();
                break;
              case 'settings':
                loadSavedApiKey();
                // 等待一下讓內容渲染
                await new Promise(resolve => setTimeout(resolve, 100));
                break;
              case 'accountPositioning':
                await loadPositioningRecordsForUserDB();
                break;
              case 'topicRecords':
                await loadTopicHistoryForUserDB();
                break;
              case 'ipPlanning':
                await loadIpPlanningResultsForUserDB();
                break;
              case 'myOrders':
                await loadMyOrdersForUserDB();
                break;
              case 'usageStats':
                await loadUsageStatsForUserDB();
                break;
              case 'helpCenter':
                // 幫助中心內容已在HTML中定義，無需動態載入
                break;
            }
            
            // 等待內容渲染後再複製（個人資料已優化，減少延遲）
            const delay = sectionName === 'personalInfo' ? 10 : 300;
            await new Promise(resolve => setTimeout(resolve, delay));
            
            // 如果內容還是空的，再等待一下
            if (!sectionContent || !sectionContent.innerHTML || sectionContent.innerHTML.trim() === '') {
              await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            if (sectionContent && sectionContent.innerHTML && sectionContent.innerHTML.trim() !== '') {
              bodyEl.innerHTML = sectionContent.innerHTML;
              console.log('內容已載入到彈跳視窗');
            } else {
              // 如果還是沒有內容，顯示載入中或暫無內容
              if (sectionName === 'personalInfo') {
                bodyEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #6b7280;">載入中...</div>';
                // 再等待一下，如果還是沒有，顯示暫無內容
                setTimeout(() => {
                  if (!sectionContent || !sectionContent.innerHTML || sectionContent.innerHTML.trim() === '') {
                    bodyEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #6b7280;">暫無內容</div>';
                  } else {
                    bodyEl.innerHTML = sectionContent.innerHTML;
                  }
                }, 500);
              } else {
                bodyEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #6b7280;">暫無內容</div>';
              }
            }
          } catch (error) {
            console.error('載入內容失敗:', error);
            bodyEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #ef4444;">載入失敗，請稍後再試</div>';
          } finally {
            targetSection.style.display = originalDisplay || 'none';
          }
        };
        
        // 先顯示彈跳視窗，再載入內容
        overlay.classList.add('show');
        overlay.style.cssText = 'display: flex !important; visibility: visible !important; opacity: 1 !important; position: fixed !important; top: 0 !important; left: 0 !important; width: 100% !important; height: 100% !important; height: 100dvh !important; z-index: 99999 !important; background: rgba(0, 0, 0, 0.5) !important; justify-content: center !important; align-items: center !important; padding: 20px !important; box-sizing: border-box !important; margin: 0 !important;';
        document.body.style.overflow = 'hidden';
        document.body.style.position = 'fixed';
        document.body.style.width = '100%';
        document.documentElement.style.overflow = 'hidden'; // 防止 iOS Safari 滾動
        
        console.log('彈跳視窗已顯示，overlay classes:', overlay.className);
        console.log('彈跳視窗 computed style:', window.getComputedStyle(overlay).display);
        console.log('彈跳視窗 visibility:', window.getComputedStyle(overlay).visibility);
        console.log('彈跳視窗 opacity:', window.getComputedStyle(overlay).opacity);
        
        // 載入內容
        loadContent();
        
        // 點擊背景關閉
        overlay.onclick = function(e) {
          if (e.target === overlay) {
            closeUserDbModal();
          }
        };
        
        // ESC 鍵關閉
        const handleEsc = (e) => {
          if (e.key === 'Escape') {
            closeUserDbModal();
            document.removeEventListener('keydown', handleEsc);
          }
        };
        document.addEventListener('keydown', handleEsc);
      }
      
      // 關閉彈跳視窗
      function closeUserDbModal() {
        const overlay = document.getElementById('userdbModalOverlay');
        if (overlay) {
          overlay.classList.remove('show');
          overlay.style.cssText = 'display: none !important; visibility: hidden !important; opacity: 0 !important;';
          document.body.style.overflow = '';
          document.body.style.position = '';
          document.body.style.width = '';
          document.documentElement.style.overflow = '';
          console.log('彈跳視窗已關閉');
        }
      }
      
      // 將函數導出到全局，方便調試和 HTML onclick 調用
      window.handleMenuClick = handleMenuClick;
      window.openUserDbModal = openUserDbModal;
      window.closeUserDbModal = closeUserDbModal;
      
      // 初始化頁面
      document.addEventListener('DOMContentLoaded', async () => {
        // 檢查登入狀態（創作者資料庫允許未訂閱用戶訪問，至少可查看個人資訊和登出）
        if (window.ReelMindCommon && window.ReelMindCommon.checkFeatureAccess) {
          const canAccess = await window.ReelMindCommon.checkFeatureAccess('userDB');
          if (!canAccess) {
            return; // checkFeatureAccess 已經處理了跳轉（未登入會導向登入）
          }
        }
        
        // 載入用戶資訊
        if (window.Auth && window.Auth.getToken()) {
          ipPlanningToken = window.Auth.getToken();
        }
        
        if (window.ReelMindCommon && window.ReelMindCommon.getUser) {
          ipPlanningUser = window.ReelMindCommon.getUser();
        } else {
          const userStr = localStorage.getItem('ipPlanningUser');
          ipPlanningUser = userStr ? JSON.parse(userStr) : null;
        }
        
        // 更新用戶資訊顯示
        updateUserInfo();
        
        // 等待用戶資料載入完成後再打開彈跳視窗（避免延遲）
        const initializeUserDB = async () => {
          // 如果沒有用戶資訊但有 token，先獲取用戶資訊
        if (ipPlanningToken && (!ipPlanningUser || !ipPlanningUser.user_id)) {
            try {
          await fetchUserInfo();
            } catch (error) {
              console.warn('獲取用戶資訊失敗:', error);
            }
          }
          
          // 檢查 URL hash，如果有指定分類則跳轉到該分類
          const hash = window.location.hash.replace('#', '');
          const isMobile = window.innerWidth <= 768;
          
          if (hash) {
            // 有 hash，跳轉到指定分類
            if (isMobile) {
              // 手機版：打開對應的彈跳視窗（減少延遲）
              setTimeout(() => {
                openUserDbModal(hash);
              }, 100);
            } else {
              // 桌面版：切換到對應的分類
              if (typeof showDbSection === 'function') {
                showDbSection(hash);
              }
            }
          } else {
            // 沒有 hash，載入個人資料（預設顯示）
            if (isMobile) {
              // 手機版：預設打開個人資料彈跳視窗（減少延遲）
              setTimeout(() => {
                openUserDbModal('personalInfo');
              }, 100);
            } else {
              // 桌面版：使用原有方式
              loadPersonalInfoForUserDB();
            }
          }
        };
        
        // 執行初始化
        await initializeUserDB();
        
        // 監聽 hash 變化
        window.addEventListener('hashchange', function() {
          const newHash = window.location.hash.replace('#', '');
          if (newHash) {
            const isMobile = window.innerWidth <= 768;
            if (isMobile) {
              openUserDbModal(newHash);
            } else {
              if (typeof showDbSection === 'function') {
                showDbSection(newHash);
              }
            }
          }
        });
        
        // 用戶資訊獲取已在 initializeUserDB 中處理
      });
    </script>
    
    <!-- 所有 userDB 相關函數已移至 assets/js/userDB.js -->
  </body>
</html>

