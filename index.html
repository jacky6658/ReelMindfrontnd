<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>ReelMind | AI çŸ­å½±éŸ³å¹³å° - AI ç”Ÿæˆè…³æœ¬ Ã— AI å¸³è™Ÿå®šä½</title>
    
    <!-- Favicon: ä½¿ç”¨ SVG data URIï¼Œé¿å… 404 éŒ¯èª¤ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ¬%3C/text%3E%3C/svg%3E" />
    
    <!-- SEO çµæ§‹åŒ–è³‡æ–™ -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "ReelMindï½œAI çŸ­å½±éŸ³å¹³å°",
      "applicationCategory": "Multimedia",
      "operatingSystem": "Web",
      "inLanguage": "zh-Hant",
      "areaServed": "TW",
      "offers": { 
        "@type": "Offer", 
        "price": "3980", 
        "priceCurrency": "TWD",
        "priceSpecification": {
          "@type": "UnitPriceSpecification",
          "price": "3980",
          "priceCurrency": "TWD"
        }
      },
      "description": "AI çŸ­å½±éŸ³ã€AI ç”Ÿæˆè…³æœ¬ã€AI å¸³è™Ÿå®šä½ï¼Œæ”¯æ´ IG/TikTok/YouTube Shortsï¼Œä»˜è²»å³ä½¿ç”¨ã€‚æœå‹™åœ°å€ï¼šå°åŒ—ï½œå°ä¸­ï½œé«˜é›„",
      "url": "https://video.aijob.com.tw/",
      "provider": {
        "@type": "Organization",
        "name": "AIJob",
        "url": "https://video.aijob.com.tw/"
      }
    }
    </script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        { 
          "@type": "Question", 
          "name": "ä»€éº¼æ˜¯ AI çŸ­å½±éŸ³ï¼Ÿ", 
          "acceptedAnswer": { 
            "@type": "Answer", 
            "text": "AI ä¾ç”¢æ¥­èˆ‡å¹³å°ï¼Œè‡ªå‹•ç”Ÿæˆé¡Œæã€è…³æœ¬ã€å£æ’­ã€åˆ†é¡ï¼Œç¸®çŸ­è£½ä½œæ™‚é–“ä¸¦æå‡ä¸Šç‰‡é »ç‡ï¼Œæ”¯æ´å°åŒ—ã€å°ä¸­ã€é«˜é›„ç­‰åœ°å€çš„å‰µä½œè€…ã€‚" 
          } 
        },
        { 
          "@type": "Question", 
          "name": "AI ç”Ÿæˆè…³æœ¬æ€éº¼é‹ä½œï¼Ÿ", 
          "acceptedAnswer": { 
            "@type": "Answer", 
            "text": "è¼¸å…¥ä¸»é¡Œèˆ‡å¹³å°ï¼Œç³»çµ±è¼¸å‡ºé–‹å ´ Hookã€æ©‹æ®µé‡é»èˆ‡ CTAï¼Œä¸¦èƒ½è‡ªå‹•åœ¨åœ°åŒ–èªæ°£ï¼Œé©åˆå°ç£å¸‚å ´çš„å‰µä½œè€…ä½¿ç”¨ã€‚" 
          } 
        },
        { 
          "@type": "Question", 
          "name": "AI å¸³è™Ÿå®šä½èƒ½å¹«ä»€éº¼ï¼Ÿ", 
          "acceptedAnswer": { 
            "@type": "Answer", 
            "text": "åˆ†æå—çœ¾ã€å…§å®¹æ”¯æŸ±èˆ‡ä¸Šç‰‡ç¯€å¥ï¼Œå¹«åŠ©ä½ å¿«é€Ÿæ‰¾åˆ°å¸³è™Ÿé¢¨æ ¼èˆ‡å®šä½ï¼Œç‰¹åˆ¥é‡å° IGã€TikTokã€YouTube Shorts ç­‰å¹³å°å„ªåŒ–ã€‚" 
          } 
        }
      ]
    }
    </script>
    
    <!-- Markdown å’Œèªæ³•é«˜äº®å‡½å¼åº« -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <!-- Highlight.js: ä½¿ç”¨ç€è¦½å™¨ UMD ç‰ˆæœ¬ï¼ˆ/build/ è€Œé /lib/ï¼‰é¿å… module is not defined éŒ¯èª¤ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css">
    <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/javascript.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/python.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/css.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/html.min.js"></script>
    <!-- Font Awesome åœ–æ¨™åº« -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {}
        }
      }
    </script>
    
    <link rel="stylesheet" href="/assets/css/main.css" />
    <script defer src="/assets/js/config.js"></script>
    <script defer src="/assets/js/auth.js"></script>
    <script defer src="/assets/js/api.js"></script>
    <script defer src="/assets/js/ui.js"></script>
    <script defer src="/assets/js/bootstrap.js"></script>
    
    <style>
      :root { 
        color-scheme: light; 
        --safe-area-inset-top: env(safe-area-inset-top);
        --safe-area-inset-bottom: env(safe-area-inset-bottom);
        --safe-area-inset-left: env(safe-area-inset-left);
        --safe-area-inset-right: env(safe-area-inset-right);
      }
      body { 
        margin: 0; 
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; 
        background:#ffffff; 
        color:#1a1a1a; 
        -webkit-text-size-adjust: 100%;
        -webkit-tap-highlight-color: transparent;
        overflow-x: hidden; /* é˜²æ­¢æ•´å€‹é é¢å·¦å³æ»‘å‹• */
        width: 100%; /* ç¢ºä¿å¯¬åº¦å›ºå®š */
        max-width: 100vw; /* é™åˆ¶æœ€å¤§å¯¬åº¦ç‚ºè¦–çª—å¯¬åº¦ */
      }
      
      /* é é¢å®¹å™¨ */
      .app-container {
        display: flex;
        min-height: 100vh;
      }
      
      /* ä¸»å…§å®¹å€åŸŸ */
      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        transition: margin-right 0.3s ease;
      }
      
      .main-content.sidebar-open {
        margin-right: 300px;
      }
      
      /* é ‚éƒ¨å°èˆªæ¬„ */
      .top-navbar {
        background: white;
        border-bottom: 1px solid #e5e7eb;
        padding: 16px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding-top: calc(16px + var(--safe-area-inset-top));
        min-height: 60px;
        position: sticky;
        top: 0;
        z-index: 100;
      }
      
      .navbar-left {
        display: flex;
        align-items: center;
        gap: 24px;
      }
      
      .navbar-title {
        font-size: 30px;
        font-weight: 600;
        color: #1f2937;
        margin-right: auto;
      }
      
      .clickable-title {
        cursor: pointer;
        transition: color 0.2s ease;
      }
      
      .clickable-title:hover {
        color: #3b82f6;
      }
      
      .navbar-tabs {
        display: flex;
        gap: 8px;
      }
      
      .navbar-tab {
        padding: 8px 16px;
        border: none;
        background: transparent;
        color: #6b7280;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
        text-decoration: none;
      }
      
      .navbar-tab.active {
        background: #3b82f6;
        color: white;
      }
      
      .navbar-tab:hover:not(.active) {
        background: #f3f4f6;
      }
      
      .navbar-right {
        display: flex;
        align-items: center;
        gap: 16px;
      }
      
      .user-info {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #6b7280;
        font-size: 14px;
      }
      
      .logout-btn {
        padding: 6px 12px;
        background: #ef4444;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 500;
      }
      
      .logout-btn:hover {
        background: #dc2626;
      }
      
      /* é é¢å…§å®¹å€åŸŸ */
      .page-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
      }
      
      /* æ‰‹æ©Ÿç‰ˆï¼šç§»é™¤å·¦å³ padding */
      @media (max-width: 768px) {
        .page-content {
          padding: 12px 0;
        }
      }
      
      /* è§¸æ§è¨­å‚™ï¼šè®“å¡ç‰‡æœ‰æŒ‰å£“å‹•ç•« */
      @media (hover: none) and (pointer: coarse) {
        /* è§¸æ§è¨­å‚™ä¸Šçš„å¡ç‰‡ */
        [class*="group"].bg-white {
          -webkit-tap-highlight-color: transparent;
          touch-action: manipulation;
          cursor: pointer;
        }
        
        /* å¡ç‰‡æŒ‰å£“æ•ˆæœ */
        [class*="group"].bg-white:active {
          transform: scale(0.96) !important;
          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15) !important;
        }
        
        /* é¡¯ç¤ºåº•éƒ¨é€£çµ */
        [class*="opacity-0"] {
          opacity: 0.7 !important;
        }
      }
      
      /* mode2é é¢ç‰¹æ®Šæ¨£å¼ - æ»¿ç‰ˆé¡¯ç¤º */
      .mode2 .page-content {
        padding: 0;
        max-width: none;
        width: 100%;
      }
      
      /* é¦–é æ¨£å¼ */
      .homepage {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 60vh;
        text-align: center;
      }
      
      .homepage-title {
        font-size: 32px;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 16px;
      }
      
      .homepage-subtitle {
        font-size: 18px;
        color: #6b7280;
        margin-bottom: 48px;
        max-width: 600px;
        line-height: 1.6;
      }
      
      .mode-cards {
        display: flex;
        gap: 24px;
        max-width: 800px;
      }
      
      .mode-card {
        flex: 1;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 32px 24px;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 1;
        user-select: none;
      }
      
      .mode-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border-color: #3b82f6;
      }
      
      .mode-card-icon {
        font-size: 48px;
        margin-bottom: 16px;
      }
      
      .mode-card-title {
        font-size: 20px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 12px;
      }
      
      .mode-card-desc {
        font-size: 14px;
        color: #6b7280;
        line-height: 1.5;
      }
      
      /* æ¨¡å¼1ï¼šä¸€éµç”Ÿæˆé é¢ */
      .mode1-page {
        display: flex;
        gap: 24px;
        height: calc(100vh - 120px);
      }
      
      .mode1-left {
        flex: 1;
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
      }
      
      .mode1-right {
        flex: 1;
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
      }
      
      .section-title {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      /* æ¨¡å¼2ï¼šAIé¡§å•å°è©±é é¢ */
      .mode2-page {
        display: flex;
        flex-direction: column;
        height: calc(100vh - 140px);
        min-height: 600px;
        position: relative;
        max-width: none;
        width: 100%;
        margin: 0;
        padding: 0;
      }
      
      /* èªªæ˜æŒ‰éˆ• */
      .instructions-toggle-btn {
        position: fixed;
        top: 90px;
        right: 20px;
        background: #3b82f6;
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 14px;
        font-weight: 500;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        transition: all 0.2s ease;
        z-index: 1000;
      }
      
      .instructions-toggle-btn:hover {
        background: #2563eb;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
      }
      
      .btn-icon {
        font-size: 16px;
      }
      
      .btn-text {
        font-size: 13px;
      }
      
      /* æŠ½å±œèƒŒæ™¯é®ç½© */
      .drawer-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .drawer-overlay.show {
        opacity: 1;
        visibility: visible;
      }
      
      /* èªªæ˜æŠ½å±œ */
      .instructions-drawer {
        position: fixed;
        top: 80px;
        right: -400px;
        width: 400px;
        height: calc(100vh - 80px);
        background: white;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        transition: right 0.3s ease;
        z-index: 1001;
        display: flex;
        flex-direction: column;
      }
      
      .instructions-drawer.open {
        right: 0;
      }
      
      .drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
      }
      
      .drawer-header h3 {
        margin: 0;
        font-size: 18px;
        color: #1f2937;
      }
      
      .drawer-close-btn {
        background: none;
        border: none;
        font-size: 20px;
        color: #6b7280;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: all 0.2s;
      }
      
      .drawer-close-btn:hover {
        background: #e5e7eb;
        color: #374151;
      }
      
      .drawer-content {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
      }
      
      .drawer-content p {
        margin: 0 0 16px 0;
        font-size: 14px;
        line-height: 1.6;
        color: #374151;
      }
      
      .drawer-content p:last-child {
        margin-bottom: 0;
        padding-top: 12px;
        border-top: 1px solid #e5e7eb;
        font-size: 13px;
        color: #6b7280;
      }
      
      .step-guide {
        margin: 16px 0;
      }
      
      .step {
        display: flex;
        align-items: flex-start;
        margin-bottom: 16px;
        gap: 12px;
      }
      
      .step-number {
        background: #3b82f6;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
        flex-shrink: 0;
      }
      
      .step-content {
        flex: 1;
        font-size: 14px;
        line-height: 1.5;
      }
      
      .chat-container {
        flex: 1;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      
      /* å´é‚Šæ¬„æ¨£å¼ */
      .sidebar {
        position: fixed;
        top: 0;
        right: -300px;
        width: 300px;
        height: 100vh;
        background: white;
        border-left: 1px solid #e5e7eb;
        box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
        transition: right 0.3s ease;
        z-index: 1000;
        overflow-y: auto;
      }
      
      .sidebar.open {
        right: 0;
      }
      
      .sidebar-header {
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .sidebar-title {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
      }
      
      .sidebar-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #6b7280;
      }
      
      .sidebar-menu {
        padding: 20px 0;
      }
      
      .sidebar-item {
        display: block;
        width: 100%;
        padding: 12px 20px;
        border: none;
        background: none;
        text-align: left;
        color: #6b7280;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
      }
      
      .sidebar-item:hover {
        background: #f3f4f6;
        color: #1f2937;
      }
      
      .sidebar-item.active {
        background: #3b82f6;
        color: white;
      }
      
      
      /* å´é‚Šæ¬„é é¢æ¨£å¼ */
      .sidebar-page-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      .sidebar-page-container {
        background: white;
        border-radius: 12px;
        width: 90%;
        max-width: 800px;
        max-height: 90%;
        overflow: hidden;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
      }
      
      .sidebar-page-header {
        padding: 20px 24px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f8fafc;
      }
      
      .sidebar-page-header h2 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
        color: #1f2937;
      }
      
      .sidebar-page-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #6b7280;
        padding: 4px;
        border-radius: 4px;
        transition: all 0.2s;
      }
      
      .sidebar-page-close:hover {
        background: #e5e7eb;
        color: #374151;
      }
      
      .sidebar-page-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
      }
      
      /* å´é‚Šæ¬„é é¢å…§å®¹æ¨£å¼ */
      .profile-content {
        display: flex;
        flex-direction: column;
        gap: 24px;
      }
      
      .profile-section h3 {
        margin: 0 0 16px 0;
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
      }
      
      .user-details {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      
      .detail-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .detail-item label {
        font-weight: 500;
        color: #6b7280;
        min-width: 80px;
      }
      
      .detail-item span {
        color: #1f2937;
      }
      
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
      }
      
      .stat-item {
        text-align: center;
        padding: 16px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
      }
      
      .stat-number {
        font-size: 24px;
        font-weight: 700;
        color: #3b82f6;
        margin-bottom: 4px;
      }
      
      .stat-label {
        font-size: 12px;
        color: #6b7280;
      }
      
      .scripts-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      
      .script-item {
        padding: 16px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        background: #f8fafc;
      }
      
      .script-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      
      .script-header h4 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
        color: #1f2937;
      }
      
      .script-date {
        font-size: 12px;
        color: #6b7280;
      }
      
      .script-preview {
        font-size: 14px;
        color: #6b7280;
        margin-bottom: 12px;
        line-height: 1.4;
      }
      
      .script-actions {
        display: flex;
        gap: 8px;
      }
      
      .btn-primary {
        padding: 6px 12px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }
      
      .btn-danger {
        padding: 6px 12px;
        background: #ef4444;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }
      
      .help-content {
        display: flex;
        flex-direction: column;
        gap: 24px;
      }
      
      .help-section {
        padding: 16px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
      }
      
      .help-section h3,
      .help-section h4 {
        margin: 0 0 12px 0;
        color: #1f2937;
      }
      
      .help-section h3 {
        font-size: 20px;
        font-weight: 600;
      }
      
      .help-section h4 {
        font-size: 16px;
        font-weight: 500;
      }
      
      .help-section p {
        margin: 8px 0;
        color: #6b7280;
        line-height: 1.5;
      }
      
      /* ä¸€éµç”Ÿæˆä½¿ç”¨èªªæ˜æ¨£å¼ */
      .one-click-instructions {
        margin-top: 20px;
        padding: 20px;
        background: #f8fafc;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
      }
      
      .one-click-instructions h3 {
        margin: 0 0 16px 0;
        font-size: 16px;
        font-weight: 600;
        color: #1f2937;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .instruction-steps {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      
      .step {
        display: flex;
        align-items: flex-start;
        gap: 12px;
      }
      
      .step-number {
        width: 24px;
        height: 24px;
        background: #3b82f6;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
        flex-shrink: 0;
      }
      
      .step-content {
        flex: 1;
      }
      
      .step-content strong {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 4px;
      }
      
      .step-content p {
        margin: 0;
        font-size: 13px;
        color: #6b7280;
        line-height: 1.4;
      }
      
      /* é é¢éš±è—/é¡¯ç¤º */
      .page {
        display: none;
      }
      
      .page.active {
        display: block;
      }
      
      /* å‹•ç•«æ•ˆæœ */
      @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(5deg); }
      }
      
      @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.6; transform: scale(1.1); }
      }
      
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      /* iOS Safari ç›¸å®¹æ€§ */
      html, body {
        -webkit-font-smoothing: antialiased;
        -webkit-text-size-adjust: 100%;
      }
      
      @supports (height: 100svh) {
        .min-h-screen {
          min-height: 100svh;
        }
      }
      
      /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
      @media (max-width: 1024px) {
        .rm-hero-grid {
          grid-template-columns: 1fr !important;
          gap: 40px !important;
        }
        .rm-pricing-cards {
          flex-direction: column !important;
          gap: 16px !important;
        }
        .rm-pricing-cards > div {
          width: 100% !important;
          max-width: 100% !important;
        }
      }
      
      @media (max-width: 768px) {
        .rm-hero {
          padding: 40px 0 !important;
          margin: -20px 0 0 0 !important;
        }
        .rm-hero-container {
          padding: 0 16px !important;
        }
        .rm-hero-grid {
          gap: 24px !important;
        }
        .rm-hero-title {
          font-size: 1.75rem !important;
          line-height: 1.3 !important;
        }
        .rm-hero p {
          font-size: 0.95rem !important;
          line-height: 1.6 !important;
        }
        .rm-guide-section {
          padding: 60px 0 !important;
          margin: -20px 0 0 0 !important;
        }
        .rm-guide-section > div {
          padding: 0 16px !important;
        }
        .rm-pricing {
          padding: 60px 0 !important;
          margin: -20px 0 0 0 !important;
        }
        .rm-pricing > div {
          padding: 0 16px !important;
        }
        .rm-pricing-cards {
          gap: 16px !important;
        }
        .rm-footer {
          padding: 40px 0 !important;
          margin: -20px 0 0 0 !important;
        }
        .rm-footer > div {
          padding: 0 16px !important;
        }
        
        .mode1-page {
          flex-direction: column;
          height: auto;
        }
        
        .mode1-left,
        .mode1-right {
          flex: none;
        }
        
        .mode-cards {
          flex-direction: column;
        }
        
        .main-content.sidebar-open {
          margin-right: 0;
        }
        
        .sidebar {
          width: 100%;
          right: -100%;
        }
        
        .user-name { display: none !important; }
        .navbar-right { display: flex; align-items: center; gap: 10px; margin-left: auto; }
        .user-info { padding: 6px 8px; }
        .user-avatar { margin: 0; }
        .logout-btn { margin: 0; }
        .top-navbar { justify-content: space-between; }
        .navbar-left { flex: 1; }
        .navbar-title { margin-left: auto; }
        /* ä¸€éµç”Ÿæˆ/AIé¡§å•/IPäººè¨­å¡ç‰‡åŠ å¯¬ */
        .mode-cards { grid-template-columns: 1fr; }
        .mode-card { width: 100%; max-width: none; }
      }
      
      .container { max-width: 1400px; margin: 0 auto; padding: 16px; }
      
      /* ç¢ºä¿åŸæœ‰åŠŸèƒ½åœ¨æ–°ä½ˆå±€ä¸­æ­£å¸¸é¡¯ç¤º */
      .userSettingsContainer,
      .oneClickGenerationContainer,
      .chatContainer {
        width: 100%;
        height: 100%;
      }
      
      /* ç”¨æˆ¶éœ€æ±‚è¨­å®šæ¨£å¼èª¿æ•´ */
      .settings-block {
        margin-bottom: 20px;
      }
      
      .settings-content {
        margin-top: 16px;
      }
      
      /* ä¸€éµç”Ÿæˆé é¢å¸ƒå±€ */
      .mode1-page {
        display: flex;
        gap: 24px;
        min-height: calc(100vh - 120px);
      }
      
      .mode1-left {
        flex: 1;
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      
      .mode1-right {
        flex: 1;
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      
      /* ä¸€éµç”Ÿæˆçµæœå€å¡Šæ¨£å¼èª¿æ•´ */
      .result-tabs {
        margin-bottom: 0;
      }
      
      .results-container {
        flex: 1;
        min-height: 400px;
      }
      
      /* èŠå¤©å®¹å™¨æ¨£å¼èª¿æ•´ - ChatGPT é¢¨æ ¼ */
      .chat-container {
        display: flex !important;
        flex-direction: column !important;
        height: 100% !important;
        max-width: 800px !important;
        margin: 0 auto !important;
        width: 100% !important;
        background: #f7f7f8 !important;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
      }
      
      #chatMessages {
        flex: 1;
        overflow-y: auto;
        padding: 0 0 5px 0;
        margin-bottom: 5px;
      }
      
      /* ç•¶èªªæ˜æ”¶èµ·æ™‚ï¼ŒèŠå¤©è¨Šæ¯å€å»¶é•·é«˜åº¦ */
      .instruction-list.collapsed + #chatContainer #chatMessages {
        min-height: 600px;
      }

      /* ===== AIé¡§å•èŠå¤©è¨Šæ¯æ¨£å¼ - ChatGPT é¢¨æ ¼ ===== */
      
      /* èŠå¤©è¨Šæ¯å®¹å™¨ - æ¡ç”¨æ›´ç°¡æ½”çš„è¨­è¨ˆ */
      .message {
        display: flex;
        margin-bottom: 16px;
        align-items: flex-start;
      }

      .message:last-child {
        margin-bottom: 0;
      }

      .message-avatar {
        width: 30px !important;
        height: 30px !important;
        min-width: 30px !important;
        border-radius: 4px !important;
        background: #10a37f !important;
        color: white !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        font-size: 16px !important;
        font-weight: bold !important;
        margin-right: 15px !important;
        flex-shrink: 0 !important;
      }

      .user .message-avatar {
        background: transparent !important;
        color: #374151 !important;
      }

      .assistant .message-avatar {
        background: #10a37f !important;
        color: white !important;
      }

      .message-content {
        flex: 1 !important;
        padding: 0 !important;
        margin: 0 !important;
        line-height: 1.6 !important;
        color: #374151 !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
        white-space: pre-wrap !important;
        max-width: 100% !important; /* é˜²æ­¢è¶…å‡ºå®¹å™¨ */
        overflow: hidden !important; /* é˜²æ­¢å…§å®¹æº¢å‡º */
        box-sizing: border-box !important; /* åŒ…å«é‚Šæ¡†åœ¨å…§ */
      }

      /* è¨Šæ¯å…§å®¹çš„æ¨£å¼é‡ç½® */
      .message-content p:first-child {
        margin-top: 0 !important;
      }
      .message-content p:last-child {
        margin-bottom: 0 !important;
      }

      /* Markdown æ¸²æŸ“æ¨£å¼ - ChatGPT é¢¨æ ¼ */
      .message-content pre {
        background: #202123 !important;
        color: #f8f8f2 !important;
        padding: 10px !important;
        border-radius: 6px !important;
        overflow-x: auto !important;
        position: relative !important;
        margin: 15px 0 !important;
      }

      .message-content pre code {
        display: block !important;
        padding: 0 !important;
        background: none !important;
        color: inherit !important;
      }

      .message-content table {
        border-collapse: collapse !important;
        width: 100% !important;
        margin: 15px 0 !important;
      }

      .message-content th, 
      .message-content td {
        border: 1px solid #ddd !important;
        padding: 8px !important;
        text-align: left !important;
      }

      .message-content th {
        background-color: #f2f2f2 !important;
      }

      .message-content blockquote {
        border-left: 4px solid #ccc !important;
        padding-left: 15px !important;
        margin: 15px 0 !important;
        color: #666 !important;
      }

      .message-content ul, 
      .message-content ol {
        margin: 15px 0 !important;
        padding-left: 20px !important;
      }

      .message-content h1,
      .message-content h2,
      .message-content h3,
      .message-content h4,
      .message-content h5,
      .message-content h6 {
        margin: 16px 0 8px 0 !important;
        font-weight: 600 !important;
        line-height: 1.3 !important;
      }

      .message-content p {
        margin: 8px 0 !important;
        line-height: 1.6 !important;
      }

      .message-content code {
        background: #f1f3f4 !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace !important;
        font-size: 0.9em !important;
      }

      /* AI æ€è€ƒä¸­å‹•ç•« - ChatGPT é¢¨æ ¼ */
      .typing-indicator {
        display: flex !important;
        align-items: center !important;
        font-style: italic !important;
        color: #6b7280 !important;
        margin: 0 !important;
        padding: 0 !important;
      }

      .typing-dots {
        display: flex !important;
        margin-left: 10px !important;
      }

      .typing-dot {
        width: 6px !important;
        height: 6px !important;
        margin: 0 2px !important;
        background-color: #3b82f6 !important;
        border-radius: 50% !important;
        animation: dot-flashing 1s infinite alternate !important;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s !important;
      }

      .typing-dot:nth-child(3) {
        animation-delay: 0.4s !important;
      }

      @keyframes dot-flashing {
        0% {
          opacity: 0.2;
        }
        100% {
          opacity: 1;
        }
      }

      /* ä¸²æµæ–‡å­—æ•ˆæœ */
      .streaming-text {
        position: relative;
      }

      .streaming-cursor {
        display: inline-block;
        width: 2px;
        height: 1.2em;
        background: #374151;
        animation: blink 1s infinite;
        margin-left: 2px;
      }

      @keyframes blink {
        0%, 50% { opacity: 1; }
        51%, 100% { opacity: 0; }
      }

      .message-content p {
        margin: 0 0 8px 0;
        line-height: 1.5;
      }

      .message-content ul {
        margin: 8px 0;
        padding-left: 20px;
      }

      .message-content li {
        margin: 4px 0;
      }

      .message-content:last-child p:last-child {
        margin-bottom: 0;
      }
      
      /* AIæ€è€ƒä¸­è¼‰å…¥å‹•ç•« */
      .ai-loading {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #6b7280;
        font-size: 14px;
      }

      .ai-loading-dots {
        display: flex;
        gap: 4px;
      }

      .ai-loading-dot {
        width: 6px;
        height: 6px;
        background: #3b82f6;
        border-radius: 50%;
        animation: ai-bounce 1.4s infinite ease-in-out both;
      }

      .ai-loading-dot:nth-child(1) { animation-delay: -0.32s; }
      .ai-loading-dot:nth-child(2) { animation-delay: -0.16s; }

      @keyframes ai-bounce {
        0%, 80%, 100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }
      
      .input-row {
        padding: 16px;
        margin-top: 0;
        border-top: 1px solid #e5e7eb;
        background: transparent;
        border-radius: 0;
        display: flex;
        gap: 12px;
        align-items: flex-end;
      }
      
      /* å„ªåŒ–èŠå¤©è¨Šæ¯æ¨£å¼ */
      .msg {
        display: flex;
        margin-bottom: 16px;
        align-items: flex-start;
        max-width: 85%;
      }
      
      .msg.user {
        margin-left: auto;
        flex-direction: row-reverse;
      }
      
      .msg.assistant {
        margin-right: auto;
      }
      
      .msg-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 600;
        margin: 0 8px;
        flex-shrink: 0;
      }
      
      .msg.user .msg-avatar {
        background: #3b82f6;
        color: white;
      }
      
      .msg.assistant .msg-avatar {
        background: #f3f4f6;
        color: #374151;
      }
      
      .msg-bubble {
        flex: 1;
        background: #f8fafc;
        padding: 12px 16px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        line-height: 1.5;
        font-size: 15px;
        box-sizing: border-box;
        overflow: hidden;
      }
      
      .msg.user .msg-bubble {
        background: #dbeafe;
        border-color: #3b82f6;
        color: #1e40af;
        max-width: 100%;
        word-wrap: break-word;
      }
      
      .msg.assistant .msg-bubble {
        background: #f8fafc;
        border-color: #e5e7eb;
        color: #1f2937;
        max-width: 100%;
        word-wrap: break-word;
      }
      
      .msg-bubble p {
        margin: 0 0 4px 0;
        line-height: 1.3;
      }
      
      .msg-bubble ul {
        margin: 4px 0;
        padding-left: 20px;
      }
      
      .msg-bubble li {
        margin: 2px 0;
        line-height: 1.3;
      }
      
      .msg-bubble:last-child p:last-child {
        margin-bottom: 0;
      }
      
      .msg-label {
        font-size: 12px;
        font-weight: 500;
        margin-bottom: 6px;
        color: #6b7280;
      }
      
      /* å„ªåŒ–è¼¸å…¥æ¡†æ¨£å¼ */
      #messageInput {
        flex: 1;
        height: 44px; /* å›ºå®šé«˜åº¦èˆ‡é€å‡ºæŒ‰éˆ•ä¸€è‡´ */
        min-height: 44px;
        max-height: 44px; /* é™åˆ¶æœ€å¤§é«˜åº¦èˆ‡æœ€å°é«˜åº¦ä¸€è‡´ */
        padding: 12px 16px;
        border: 1px solid #e5e7eb;
        border-radius: 22px;
        font-size: 15px;
        resize: none;
        outline: none;
        transition: border-color 0.2s;
        line-height: 1.2; /* èª¿æ•´è¡Œé«˜ç¢ºä¿æ–‡å­—å‚ç›´å±…ä¸­ */
      }
      
      #messageInput:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      #sendBtn {
        padding: 12px 20px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 22px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: background-color 0.2s;
        min-width: 80px;
      }
      
      #sendBtn:hover {
        background: #2563eb;
      }
      
      #sendBtn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
      }
      
      /* å¿«é€Ÿæå•æŒ‰éˆ•æ¨£å¼ï¼ˆå¥—ç”¨IPæ¨¡å¼è¨­è¨ˆï¼‰ */
      .quick-questions {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
        flex-wrap: wrap;
      }
      
      .quick-question-btn {
        padding: 8px 16px;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 20px;
        cursor: pointer;
        font-size: 13px;
        color: #6b7280;
        transition: all 0.2s;
      }
      
      .quick-question-btn:hover {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }

      /* ChatGPT é¢¨æ ¼å¿«é€ŸæŒ‰éˆ• */
      .quick-buttons { 
        display: flex !important; 
        gap: 8px !important; 
        margin-bottom: 12px !important; 
        flex-wrap: wrap !important;
        padding: 0 !important;
        background: transparent !important;
        border: none !important;
        position: relative !important;
        bottom: auto !important;
        z-index: auto !important;
        flex-shrink: 0 !important;
        height: auto !important;
      }

      .quick-btn {
        background: #ffffff !important;
        border: 1px solid #d1d5db !important;
        color: #374151 !important;
        padding: 8px 16px !important;
        border-radius: 16px !important;
        font-size: 14px !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
        white-space: nowrap !important;
        font-weight: 400 !important;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important;
      }

      .quick-btn:hover {
        background: #3b82f6;
        border-color: #3b82f6;
        color: white;
      }
      
      /* ä¸»è¦å¸ƒå±€ï¼šå·¦å³åˆ†æ¬„ 5:5 */
      .main-layout { 
        display: flex; 
        gap: 20px; 
        min-height: calc(100vh - 100px);
      }
      
      /* å·¦å´é¢æ¿ - 5ä»½ */
      .left-panel { 
        flex: 5; 
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      
      /* å³å´é¢æ¿ - 5ä»½ */
      .right-panel { 
        flex: 5; 
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      
      /* å·¦å´å…§å®¹å€åŸŸ */
      .left-content {
        background: #f8fafc;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      
      /* çµæœå€å¡Šæ¨™ç±¤åˆ‡æ› */
      .result-tabs {
        display: flex;
        background: white;
        border-radius: 12px 12px 0 0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        border-bottom: none;
        overflow: hidden;
      }
      
      .result-tab {
        flex: 1;
        padding: 16px 20px;
        background: #f8fafc;
        border: none;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        color: #6b7280;
        transition: all 0.2s;
        border-right: 1px solid #e5e7eb;
      }
      
      .result-tab:last-child {
        border-right: none;
      }
      
      .result-tab.active {
        background: white;
        color: #1f2937;
        border-bottom: 2px solid #3b82f6;
      }
      
      .result-tab:hover {
        background: #f1f5f9;
      }
      
      /* çµæœå€å¡Šå®¹å™¨ */
      .results-container {
        background: white;
        border-radius: 0 0 12px 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        border-top: none;
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      
      .result-content {
        flex: 1;
        padding: 20px;
        min-height: 400px;
        color: #6b7280;
        font-style: italic;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        white-space: pre-wrap;
        line-height: 1.6;
      }
      
      .result-content.has-content {
        color: #1f2937;
        font-style: normal;
        text-align: left;
        align-items: flex-start;
      }
      
      /* çµæœå€å¡Šæ–°æ¨£å¼ */
      .result-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      
      .result-header h3 {
        margin: 0;
        color: #1f2937;
        font-size: 18px;
        font-weight: 600;
      }
      
      .generate-btn {
        padding: 8px 16px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      
      .generate-btn:hover {
        background: #2563eb;
        transform: translateY(-1px);
      }
      
      .generate-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
      }
      
      .result-body {
        min-height: 200px;
        color: #6b7280;
        font-style: italic;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        white-space: pre-wrap;
        line-height: 1.6;
      }
      
      .result-body.has-content {
        color: #1f2937;
        font-style: normal;
        text-align: left;
        align-items: flex-start;
      }
      
      .result-actions {
        display: flex;
        gap: 12px;
        margin-top: 16px;
        padding-top: 12px;
        border-top: 1px solid #e5e7eb;
      }
      
      .save-btn, .regenerate-btn {
        padding: 8px 16px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      
      .save-btn {
        background: #10b981;
        color: white;
        border-color: #10b981;
      }
      
      .save-btn:hover {
        background: #059669;
        border-color: #059669;
      }
      
      .regenerate-btn {
        background: #f59e0b;
        color: white;
        border-color: #f59e0b;
      }
      
      .regenerate-btn:hover {
        background: #d97706;
        border-color: #d97706;
      }
      
      /* èŠå¤©å€åŸŸæ¨£å¼ */
      .chat-section {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-top: 20px;
        min-height: 600px;
        flex: 1;
      }
      
      .chat-messages {
        background: white;
        border-radius: 12px;
        padding: 16px;
        min-height: 400px;
        max-height: 600px;
        overflow-y: auto;
        border: 1px solid #e5e7eb;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        flex: 1;
      }
      
      .message {
        margin-bottom: 12px;
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 14px;
        line-height: 1.5;
      }
      
      .message.user {
        display: flex;
        margin-bottom: 16px;
        align-items: flex-start;
        flex-direction: row-reverse;
      }
      
      .message.user .message-content {
        flex: 1;
        background: #dbeafe !important;
        padding: 12px 16px;
        border-radius: 12px;
        border: 1px solid #3b82f6;
        color: #1e40af !important;
        margin-right: 12px;
      }
      
      .message.ai {
        display: flex;
        margin-bottom: 16px;
        align-items: flex-start;
      }
      
      .message.ai .message-content {
        flex: 1;
        background: #f8fafc !important;
        padding: 12px 16px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        margin-left: 12px;
      }
      
      .message-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        margin-right: 12px;
        flex-shrink: 0;
      }
      
      .message.user .message-avatar {
        background: #3b82f6;
        color: white;
        margin-right: 0;
        margin-left: 12px;
      }
      
      .message.ai .message-avatar {
        background: #f3f4f6;
        color: #374151;
      }
      
      .message-content p {
        margin: 0 0 8px 0;
        line-height: 1.5;
      }
      
      .message-content ul {
        margin: 8px 0;
        padding-left: 20px;
      }
      
      .message-content li {
        margin: 4px 0;
      }
      
      .message-content:last-child p:last-child {
        margin-bottom: 0;
      }
      
      
      
      
      
      /* èŠå¤©è¨Šæ¯å€åŸŸ */
      #chatMessages {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden; /* é˜²æ­¢æ°´å¹³æ»¾å‹• */
        padding: 16px 24px 140px 24px; /* å…§è·æ›´è²¼è¿‘åœ–1 */
        min-height: calc(100vh - 200px);
        background: #ffffff; /* å°è©±ç•«å¸ƒç™½åº• */
        max-width: 100%;
        width: 100%;
        box-sizing: border-box;
        border: 1px solid #e5e7eb; /* ç´°é‚Šæ¡† */
        border-radius: 8px;       /* ç•¥åœ“è§’ */
      }
      
      /* èŠå¤©è¨Šæ¯æ¨£å¼ */
      .message {
        display: flex;
        margin-bottom: 0;
        align-items: flex-start;
        padding: 20px 0;
        border-bottom: 1px solid #e5e7eb;
        width: 100%; /* ç¢ºä¿å¯¬åº¦å›ºå®š */
        max-width: 100%; /* é˜²æ­¢è¶…å‡ºå®¹å™¨ */
        box-sizing: border-box; /* åŒ…å«é‚Šæ¡†åœ¨å…§ */
        overflow: hidden; /* é˜²æ­¢å…§å®¹æº¢å‡º */
      }

      .message:last-child {
        border-bottom: none;
      }

      .message-avatar {
        width: 30px;
        height: 30px;
        min-width: 30px;
        border-radius: 50%;
        background: transparent;
        color: #374151;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 16px;
        font-weight: bold;
        margin-right: 15px;
        flex-shrink: 0;
        overflow: hidden;
      }

      .user .message-avatar {
        background: transparent;
      }

      .message-content {
        flex: 1;
        padding: 20px 40px;
        margin: 0;
        line-height: 1.6;
        color: #374151;
        word-wrap: break-word;
        overflow-wrap: break-word;
        white-space: pre-wrap;
        max-width: 100%; /* é™åˆ¶æœ€å¤§å¯¬åº¦ */
        width: 100%;
        box-sizing: border-box; /* åŒ…å«é‚Šæ¡†åœ¨å…§ */
        overflow: visible; /* è®“å…§å®¹å¯è¦‹ */
      }

      .message-content p:first-child {
        margin-top: 0;
      }
      .message-content p:last-child {
        margin-bottom: 0;
      }

      /* Mode2 é é¢å›ºå®šè¨­è¨ˆ - é˜²æ­¢å·¦å³æ»‘å‹• */
      .mode2 {
        width: 100% !important;
        max-width: 100% !important;
        overflow-x: hidden !important;
        box-sizing: border-box !important;
      }
      
      .mode2-page {
        width: 100% !important;
        max-width: 100% !important;
        overflow-x: hidden !important;
        box-sizing: border-box !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      
      /* å¿«é€ŸæŒ‰éˆ•åˆ— */
      .mode2.fig1 .quick-buttons {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        padding: 8px 0 12px 0; /* èˆ‡è¼¸å…¥æ¡†ç•™ç™½ */
        margin: 0;
        background: transparent;
        border: none;
        justify-content: flex-start;
      }

      .mode2.fig1 .quick-btn {
        background: transparent;
        border: 1px solid #d1d5db;
        color: #374151;
        padding: 10px 8px; /* è®“é«˜åº¦ä¸€è‡´ä¸”å®¹ç´é•·æ–‡ */
        border-radius: 16px;
        font-size: 12px !important; /* èª¿æ•´ç‚º 10px ä¸¦ç¢ºä¿è¦†å¯« */
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
        font-weight: 400;
        box-shadow: none;
        backdrop-filter: none;
        width: 100% !important;  /* å¡«æ»¿gridæ¬„ä½ */
        min-width: 0 !important; /* é˜²æ­¢æ’ç ´ */
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        text-align: center !important; /* æ–‡å­—ç½®ä¸­ */
        display: inline-flex !important; /* å‚ç›´æ°´å¹³ç½®ä¸­ */
        justify-content: center !important;
        align-items: center !important;
      }

      .mode2.fig1 .quick-btn:hover {
        background: #3b82f6;
        border-color: #3b82f6;
        color: white;
      }

      /* è¼¸å…¥å€åŸŸï¼ˆè²¼è¿‘åœ–1ï¼šå¯¬ã€æ‰ã€å³å´é€å‡ºï¼‰ */
      .mode2.fig1 .input-row {
        background: transparent;
        border: none;
        padding: 0; /* ç”±å¤–å±¤ç•™ç™½æ§åˆ¶ */
        display: flex;
        gap: 12px;
        align-items: center;
      }

      .mode2.fig1 .chat-input {
        flex: 1;
        height: 44px;
        min-height: 44px;
        max-height: 44px;
        border: 1px solid #d1d5db;
        border-radius: 10px;
        padding: 10px 12px;
        font-size: 14px;
        background: #ffffff;
      }

      .mode2.fig1 .send-btn {
        height: 44px;
        min-width: 44px;
        border-radius: 10px;
        background: #3b82f6;
        color: #ffffff;
        border: none;
        padding: 0 18px;
      }

      /* æ‰‹æ©Ÿç‰ˆå¾®èª¿ */
      @media (max-width: 768px) {
        .mode2.fig1 .mode2-page {
          padding-left: 12px !important;
          padding-right: 12px !important;
        }
        .mode2.fig1 #chatMessages {
          padding: 12px !important; /* ç§»é™¤åº•éƒ¨ paddingï¼Œç”±è¼¸å…¥æ¬„çš„ sticky è™•ç† */
          border-radius: 8px !important;
          width: 100% !important; /* å°è©±æ¡†æ»¿ç‰ˆé¡¯ç¤º */
          max-width: 100% !important; /* ç§»é™¤å¯¬åº¦é™åˆ¶ */
          margin: 0 !important; /* ç§»é™¤ç½®ä¸­å°é½Š */
        }
        .mode2.fig1 .quick-buttons { 
          gap: 6px !important; 
          width: 100% !important; /* å¿«é€ŸæŒ‰éˆ•æ»¿ç‰ˆé¡¯ç¤º */
          max-width: 100% !important; /* ç§»é™¤å¯¬åº¦é™åˆ¶ */
          margin: 0 !important; /* ç§»é™¤ç½®ä¸­å°é½Š */
          padding: 8px 0 !important; /* ä¿æŒä¸€è‡´çš„ padding */
        }
        .mode2.fig1 .input-row {
          width: 100% !important; /* è¼¸å…¥æ¬„ä½æ»¿ç‰ˆé¡¯ç¤º */
          max-width: 100% !important; /* ç§»é™¤å¯¬åº¦é™åˆ¶ */
          margin: 0 !important; /* ç§»é™¤ç½®ä¸­å°é½Š */
          padding: 8px 0 !important; /* ä¿æŒä¸€è‡´çš„ padding */
        }
        .mode2.fig1 .chat-input { font-size: 15px !important; }
      }

      /* fig1 å¼·åˆ¶è¦†å¯«ï¼ˆæé«˜å„ªå…ˆç´šï¼‰ */
      /* é–ä½æ•´é æ»¾å‹•ï¼šç•¶ mode2.fig1 å­˜åœ¨æ™‚ï¼Œé é¢ä¸æ²å‹•ï¼Œåªè®“èŠå¤©æ¡†æ²å‹• */
      .mode2.fig1 {
        height: 100dvh !important; /* æ•´é å›ºå®šé«˜åº¦ */
        overflow: hidden !important; /* é–ä½æ•´é ï¼Œåªè®“å°è©±æ¡†æ»¾å‹• */
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        width: 100% !important;
      }

      .mode2.fig1 .mode2-page {
        display: flex !important;
        flex-direction: column !important;
        height: 100% !important; /* è·Ÿéš¨çˆ¶å±¤100dvh */
        overflow: hidden !important; /* åªè®“å°è©±æ¡†æ»¾å‹• */
        padding-top: 0 !important; /* chat container è²¼é½Š header */
        padding-left: 24px !important;
        padding-right: 24px !important;
        padding-bottom: 0 !important; /* ç§»é™¤åº•éƒ¨ paddingï¼Œè®“è¼¸å…¥æ¬„å›ºå®š */
        box-sizing: border-box !important;
        gap: 0 !important; /* ç§»é™¤ gapï¼Œä½¿ç”¨ flex-1 å¡«å…… */
        position: relative !important;
      }

      .mode2.fig1 #chatMessages {
        margin-top: 0 !important;
        padding: 16px !important; /* ç§»é™¤åº•éƒ¨ paddingï¼Œç”±è¼¸å…¥æ¬„çš„ sticky è™•ç† */
        background: #ffffff !important;
        border: 1px solid #e5e7eb !important;
        border-radius: 8px !important;
        flex: 1 !important; /* å æ»¿å‰©é¤˜é«˜åº¦ */
        min-height: 0 !important; /* å…è¨±å­å…ƒç´ æ­£ç¢ºæ²å‹• */
        height: auto !important; /* ç”±flexæ±ºå®šé«˜åº¦ */
        -webkit-overflow-scrolling: touch !important; /* iOS æ…£æ€§æ²å‹• */
        overscroll-behavior: contain !important;
        touch-action: pan-y !important;
        overflow-y: auto !important; /* chat list æ»¾å‹• */
        position: relative !important;
        z-index: 1 !important;
        width: 100% !important; /* å°è©±æ¡†æ»¿ç‰ˆé¡¯ç¤º */
        max-width: 100% !important; /* ç§»é™¤å¯¬åº¦é™åˆ¶ */
        margin: 0 auto !important; /* ç½®ä¸­å°é½Š */
      }

      .mode2.fig1 .quick-buttons {
        gap: 8px !important;
        padding: 8px 0 !important; /* èª¿æ•´ padding */
        margin: 0 !important; /* ç§»é™¤ç½®ä¸­å°é½Šï¼Œè®“æŒ‰éˆ•è²¼é‚Š */
        display: grid !important;
        grid-template-columns: repeat(3, 1fr) !important;
        align-items: stretch !important;
        width: 100% !important; /* å¿«é€ŸæŒ‰éˆ•æ»¿ç‰ˆé¡¯ç¤º */
        max-width: 100% !important; /* ç§»é™¤å¯¬åº¦é™åˆ¶ */
        background: transparent !important; /* èƒŒæ™¯é€æ˜ï¼Œä½¿ç”¨çˆ¶å±¤èƒŒæ™¯ */
        flex-shrink: 0 !important; /* ä¸å…è¨±ç¸®å°ï¼Œå›ºå®šåœ¨åº•éƒ¨ */
      }

      .mode2.fig1 .input-row {
        background: transparent !important;
        border: none !important;
        padding: 8px 0 !important; /* èª¿æ•´ padding */
        gap: 12px !important;
        align-items: center !important;
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        width: 100% !important; /* è¼¸å…¥æ¬„ä½æ»¿ç‰ˆé¡¯ç¤º */
        max-width: 100% !important; /* ç§»é™¤å¯¬åº¦é™åˆ¶ */
        margin: 0 !important; /* ç§»é™¤ç½®ä¸­å°é½Šï¼Œè®“è¼¸å…¥æ¬„ä½è²¼é‚Š */
        flex-shrink: 0 !important; /* ä¸å…è¨±ç¸®å°ï¼Œå›ºå®šåœ¨åº•éƒ¨ */
      }

      .mode2.fig1 .chat-input {
        flex: 1 !important;
        height: 44px !important;
        min-height: 44px !important;
        max-height: 44px !important;
        border: 1px solid #d1d5db !important;
        border-radius: 10px !important;
        padding: 10px 12px !important;
        font-size: 14px !important;
        background: #ffffff !important;
      }

      .mode2.fig1 .send-btn {
        height: 44px !important;
        min-width: 44px !important;
        border-radius: 10px !important;
        background: #3b82f6 !important;
        color: #ffffff !important;
        border: none !important;
        padding: 0 18px !important;
        width: auto !important; /* è¦†å¯«å…ˆå‰æ‰‹æ©Ÿæ¨£å¼çš„ 100% å¯¬ */
      }
      
      /* è¼‰å…¥å‹•ç•«æ¨£å¼ */
      .typing-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        background: #ffffff;
        border-radius: 18px 18px 18px 4px;
        border: 1px solid #e5e7eb;
        margin: 8px 0;
      }
      
      .typing-dots {
        display: flex;
        gap: 4px;
      }
      
      .typing-dot {
        width: 8px;
        height: 8px;
        background: #9ca3af;
        border-radius: 50%;
        animation: typing 1.4s infinite ease-in-out;
      }
      
      .typing-dot:nth-child(1) { animation-delay: -0.32s; }
      .typing-dot:nth-child(2) { animation-delay: -0.16s; }
      
      @keyframes typing {
        0%, 80%, 100% {
          transform: scale(0.8);
          opacity: 0.5;
        }
        40% {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* è¼¸å…¥å€åŸŸ */
      .input-row {
        padding: 20px;
        background: #f7f7f8;
        border: none;
        flex-shrink: 0;
        z-index: 100;
        box-shadow: none;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      /* å¿«é€ŸæŒ‰éˆ•å€åŸŸ */
      .quick-buttons {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        padding: 20px;
        background: #f7f7f8;
        border: none;
        z-index: 99;
        justify-content: center;
      }
      
      .input-container {
        display: flex;
        gap: 8px;
        align-items: center;
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 8px 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: border-color 0.2s;
      }

      .input-container:focus-within {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      .chat-input {
        flex: 1;
        border: none;
        resize: none;
        outline: none;
        padding: 8px 0;
        font-size: 16px;
        line-height: 1.5;
        max-height: 200px;
        overflow-y: auto;
        background: transparent;
        font-family: inherit;
        min-height: 24px;
      }
      
      .chat-input:focus {
        outline: none;
      }
      
      .send-btn {
        background: #3b82f6;
        border: none;
        color: white;
        cursor: pointer;
        padding: 8px 12px;
        font-size: 16px;
        transition: all 0.2s;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 40px;
        height: 40px;
      }
      
      .send-btn:hover:not(:disabled) {
        background: #2563eb;
        transform: translateY(-1px);
      }
      
      .send-btn:disabled {
        color: #d1d5db;
        cursor: not-allowed;
      }

      /* Markdown æ¸²æŸ“æ¨£å¼ */
      .message-content pre {
        background: #202123;
        color: #f8f8f2;
        padding: 16px;
        border-radius: 8px;
        overflow-x: auto;
        margin: 16px 0;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        line-height: 1.5;
      }

      .message-content pre code {
        background: none;
        padding: 0;
        color: inherit;
        font-size: inherit;
      }

      .message-content code {
        background: #f1f3f4;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.9em;
        color: #d63384;
      }

      .message-content table {
        border-collapse: collapse;
        width: 100%;
        margin: 16px 0;
        font-size: 14px;
      }

      .message-content th,
      .message-content td {
        border: 1px solid #e5e7eb;
        padding: 12px;
        text-align: left;
      }

      .message-content th {
        background: #f8f9fa;
        font-weight: 600;
      }

      .message-content blockquote {
        border-left: 4px solid #e5e7eb;
        padding-left: 16px;
        margin: 16px 0;
        color: #6b7280;
        font-style: italic;
      }

      .message-content ul,
      .message-content ol {
        margin: 16px 0;
        padding-left: 24px;
      }

      .message-content li {
        margin: 8px 0;
        line-height: 1.6;
      }

      .message-content h1,
      .message-content h2,
      .message-content h3,
      .message-content h4,
      .message-content h5,
      .message-content h6 {
        margin: 24px 0 16px 0;
        font-weight: 600;
        line-height: 1.3;
        color: #1f2937;
      }

      .message-content h1 { font-size: 1.5em; }
      .message-content h2 { font-size: 1.3em; }
      .message-content h3 { font-size: 1.1em; }

      /* è¼‰å…¥å‹•ç•« */
      .typing-indicator {
        display: flex;
        align-items: center;
        font-style: italic;
        color: #6b7280;
        margin: 0;
        padding: 0;
      }

      .typing-dots {
        display: flex;
        margin-left: 10px;
      }

      .typing-dot {
        width: 6px;
        height: 6px;
        margin: 0 2px;
        background-color: #3b82f6;
        border-radius: 50%;
        animation: dot-flashing 1s infinite alternate;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes dot-flashing {
        0% {
          opacity: 0.2;
        }
        100% {
          opacity: 1;
        }
      }
      
      .input-container button:hover {
        background: #2563eb;
      }
      
      /* ç”¨æˆ¶æŠ½å±œæ¨£å¼ - å·¦å³å…©æ¬„å½ˆå‡ºå¼è¦–çª— */
      .user-drawer {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.8);
        width: 800px;
        max-width: 95vw;
        height: 600px;
        max-height: 90vh;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        opacity: 0;
        visibility: hidden;
      }
      
      .user-drawer.open {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
        visibility: visible;
      }
      
      .user-drawer-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none;
      }
      
      .user-drawer-overlay.open {
        display: block;
      }
      
      .user-drawer-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
        flex-shrink: 0;
      }
      
      .user-drawer-title {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .app-logo {
        font-size: 20px;
        font-weight: bold;
        color: #3b82f6;
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      
      .app-name {
        font-size: 16px;
        color: #374151;
        font-weight: 500;
      }
      
      .user-drawer-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #6b7280;
        cursor: pointer;
        padding: 8px;
        border-radius: 8px;
        transition: all 0.2s;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .user-drawer-close:hover {
        background: #e5e7eb;
        color: #374151;
      }
      
      /* å·¦å³å…©æ¬„å¸ƒå±€ */
      .user-drawer-body {
        display: flex;
        flex: 1;
        overflow: hidden;
      }
      
      /* å·¦å´é¸å–®æ¬„ */
      .user-drawer-sidebar {
        width: 250px;
        background: #f8fafc;
        border-right: 1px solid #e5e7eb;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }
      
      .user-profile {
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .user-drawer-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 2px solid #e5e7eb;
      }
      
      .user-drawer-info h3 {
        margin: 0;
        font-size: 16px;
        color: #1f2937;
        font-weight: 600;
      }
      
      .user-drawer-info p {
        margin: 4px 0 0 0;
        font-size: 14px;
        color: #6b7280;
      }
      
      /* å³å´å…§å®¹å€åŸŸ */
      .user-drawer-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        background: white;
      }
      
      
      .user-drawer-menu {
        list-style: none;
        padding: 0;
        margin: 0;
        flex: 1;
      }
      
      .user-drawer-menu li {
        margin: 0;
      }
      
      .user-drawer-menu a {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px 20px;
        color: #374151;
        text-decoration: none;
        border-radius: 0;
        transition: all 0.2s;
        border-left: 3px solid transparent;
        font-weight: 500;
      }
      
      .user-drawer-menu a:hover {
        background: #f3f4f6;
        color: #1f2937;
      }
      
      .user-drawer-menu a.active {
        background: #dbeafe;
        color: #1d4ed8;
        border-left-color: #3b82f6;
        font-weight: 600;
      }
      
      .user-drawer-menu .icon {
        width: 20px;
        height: 20px;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .content-section {
        display: none;
      }
      
      .content-section.active {
        display: block;
      }
      
      .content-section h2 {
        margin: 0 0 24px 0;
        font-size: 24px;
        color: #1f2937;
        font-weight: 600;
        border-bottom: 2px solid #e5e7eb;
        padding-bottom: 12px;
      }
      
      .user-info-detail {
        background: #f9fafb;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      
      .info-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding: 8px 0;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .info-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }
      
      .info-item label {
        font-weight: 600;
        color: #374151;
        min-width: 80px;
      }
      
      .info-item span {
        color: #6b7280;
        word-break: break-all;
      }
      
      .generations-list, .conversations-list, .memory-content {
        max-height: 500px;
        overflow-y: auto;
      }
      
      .generation-item, .conversation-item {
        background: #f9fafb;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 10px;
        border-left: 3px solid #3b82f6;
      }
      
      /* è…³æœ¬åˆ—è¡¨æ¨£å¼ */
      .script-item {
        background: #f8f9fa;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        margin-bottom: 12px;
        overflow: hidden;
      }
      
      .script-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px;
        cursor: pointer;
        background: #fff;
        border-bottom: 1px solid #e5e7eb;
        transition: background-color 0.2s;
      }
      
      .script-header:hover {
        background: #f9fafb;
      }
      
      .script-info {
        display: flex;
        align-items: center;
        gap: 16px;
        flex: 1;
      }
      
      .script-number {
        background: #3b82f6;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        min-width: 40px;
        text-align: center;
      }
      
      .script-name {
        font-weight: 500;
        color: #1f2937;
        cursor: pointer;
        padding: 4px 8px;
        border-radius: 4px;
        transition: background-color 0.2s;
      }
      
      .script-name:hover {
        background: #e5e7eb;
      }
      
      .script-date {
        color: #6b7280;
        font-size: 14px;
      }
      
      .script-toggle {
        color: #6b7280;
        font-size: 14px;
      }
      
      .script-content {
        padding: 16px;
        background: #fff;
        border-top: 1px solid #e5e7eb;
      }
      
      .script-table {
        overflow-x: auto;
      }
      
      .script-table table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }
      
      .script-table th,
      .script-table td {
        border: 1px solid #e5e7eb;
        padding: 8px 12px;
        text-align: left;
      }
      
      .script-table th {
        background: #f3f4f6;
        font-weight: 600;
        color: #374151;
      }
      
      .script-table td {
        color: #4b5563;
      }
      
      .script-actions {
        display: flex;
        gap: 8px;
        padding: 16px;
        background: #f8f9fa;
        border-top: 1px solid #e5e7eb;
        flex-wrap: wrap;
      }
      
      .action-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
      }
      
      .view-btn {
        background: #3b82f6;
        color: white;
      }
      
      .view-btn:hover {
        background: #2563eb;
      }
      
      .download-pdf-btn {
        background: #dc2626;
        color: white;
      }
      
      .download-pdf-btn:hover {
        background: #b91c1c;
      }
      .download-csv-btn {
        background: #059669;
        color: white;
      }
      
      .download-csv-btn:hover {
        background: #047857;
      }
      
      .delete-btn {
        background: #ef4444;
        color: white;
      }
      
      .delete-btn:hover {
        background: #dc2626;
      }
      
      .generation-header {
        display: flex;
        gap: 10px;
        margin-bottom: 8px;
      }
      
      .generation-platform, .generation-topic {
        background: #dbeafe;
        color: #1d4ed8;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
      }
      
      .generation-content, .conversation-summary {
        color: #374151;
        line-height: 1.5;
        margin-bottom: 8px;
      }
      
      .generation-date, .conversation-date {
        font-size: 12px;
        color: #9ca3af;
      }
      
      .loading-text {
        text-align: center;
        color: #6b7280;
        font-style: italic;
        padding: 20px;
      }
      
      /* åº•éƒ¨å°èˆªæ¬„é»˜èªéš±è—ï¼ˆæ¡Œé¢ç‰ˆï¼‰ */
      .bottom-navbar {
        display: none;
      }
      
      /* å¸³è™Ÿå®šä½è¨˜éŒ„æ¨£å¼ */
      .positioning-record-item {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 12px;
        transition: all 0.2s ease;
      }
      
      .positioning-record-item:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }
      
      .record-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      
      .record-number {
        font-weight: 600;
        color: #3b82f6;
        font-size: 14px;
      }
      
      .record-date {
        color: #6b7280;
        font-size: 12px;
      }
      
      .record-preview {
        color: #374151;
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 12px;
        background: white;
        padding: 12px;
        border-radius: 6px;
        border-left: 3px solid #3b82f6;
      }
      
      .record-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      
      .view-btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 12px;
        cursor: pointer;
        transition: background 0.2s ease;
      }
      
      .view-btn:hover {
        background: #2563eb;
      }
      
      .delete-btn {
        background: #ef4444;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 12px;
        cursor: pointer;
        transition: background 0.2s ease;
      }
      
      .delete-btn:hover {
        background: #dc2626;
      }
      
      /* å½ˆå‡ºè¦–çª—æ¨£å¼ */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 20px;
      }
      
      .modal-content {
        background: white;
        border-radius: 12px;
        max-width: 600px;
        width: 100%;
        max-height: 80vh;
        overflow: hidden;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      }
      
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8f9fa;
      }
      
      .modal-header h3 {
        margin: 0;
        font-size: 18px;
        color: #1f2937;
      }
      
      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #6b7280;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s ease;
      }
      
      .modal-close:hover {
        background: #e5e7eb;
        color: #374151;
      }
      
      .modal-body {
        padding: 20px;
        max-height: 60vh;
        overflow-y: auto;
      }
      
      .record-detail {
        line-height: 1.6;
      }
      
      .detail-meta {
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .detail-label {
        font-weight: 600;
        color: #374151;
        margin-right: 8px;
      }
      
      .detail-value {
        color: #6b7280;
      }
      
      .detail-content {
        background: #f8f9fa;
        padding: 16px;
        border-radius: 8px;
        border-left: 4px solid #3b82f6;
      }
      
      .content-text {
        color: #1f2937;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      
      .modal-footer {
        padding: 20px;
        border-top: 1px solid #e5e7eb;
        background: #f8f9fa;
        text-align: right;
      }
      
      /* æŠ½å±œå…§å®¹å€åŸŸæ¨£å¼ */
      .drawer-content {
        padding: 20px;
        max-height: 400px;
        overflow-y: auto;
      }
      
      .content-section {
        display: none;
      }
      
      .content-section.active {
        display: block;
      }
      
      .content-section h3 {
        margin: 0 0 15px 0;
        color: #333;
        font-size: 18px;
        border-bottom: 2px solid #007bff;
        padding-bottom: 5px;
      }
      
      .user-info-detail {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
      }
      
      .info-item {
        display: flex;
        margin-bottom: 10px;
      }
      
      .info-item label {
        font-weight: bold;
        min-width: 80px;
        color: #666;
      }
      
      .info-item span {
        color: #333;
      }
      
      .generations-list,
      .conversations-list,
      .memory-content {
        max-height: 300px;
        overflow-y: auto;
      }
      
      .generation-item,
      .conversation-item {
        background: #f8f9fa;
        padding: 12px;
        margin-bottom: 10px;
        border-radius: 6px;
        border-left: 3px solid #007bff;
      }
      
      .generation-header {
        display: flex;
        gap: 10px;
        margin-bottom: 8px;
      }
      
      .generation-platform {
        background: #007bff;
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
      }
      
      .generation-topic {
        background: #28a745;
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
      }
      
      .generation-content,
      .conversation-summary {
        color: #333;
        margin-bottom: 5px;
        line-height: 1.4;
      }
      
      .generation-date,
      .conversation-date {
        color: #666;
        font-size: 12px;
      }
      
      .loading-text {
        text-align: center;
        color: #666;
        font-style: italic;
      }
      
      /* è¨­å®šå€å¡Šæ¨£å¼ */
      .settings-block {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
      }
      
      .settings-block h3 {
        font-size: 20px;
        font-weight: 600;
        color: #1f2937;
        margin: 0 0 16px 0;
        padding-bottom: 8px;
        border-bottom: 2px solid #e5e7eb;
      }
      
      .settings-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
        margin-bottom: 20px;
      }
      
      .setting-item {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      
      .setting-item label {
        font-size: 14px;
        font-weight: 500;
        color: #374151;
      }
      
      .setting-item input,
      .setting-item select {
        padding: 12px 16px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.2s;
      }
      
      .setting-item input:focus,
      .setting-item select:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      .apply-btn {
        width: 100%;
        padding: 12px 24px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
      }
      
      .apply-btn:hover {
        background: #2563eb;
      }
      
      /* AI èªªæ˜å€å¡Šæ¨£å¼ */
      .ai-instructions {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        margin-bottom: 20px;
      }
      
      .instructions-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 20px;
        cursor: pointer;
        border-radius: 12px 12px 0 0;
        transition: background-color 0.2s;
      }
      
      .instructions-header:hover {
        background-color: #f8fafc;
      }
      
      .instructions-header h3 {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
        padding-bottom: 0;
        border-bottom: none;
      }
      
      .instructions-toggle {
        font-size: 16px;
        color: #6b7280;
        transition: transform 0.2s ease;
      }
      
      .instruction-list {
        padding: 0 20px 20px 20px;
        transition: all 0.3s ease;
        overflow: hidden;
        display: none;
      }
      
      .instruction-list.collapsed {
        padding: 0 20px;
        max-height: 0;
        display: none;
      }
      
      .instruction-list.show {
        display: block;
      }
      
      .instruction-list p {
        margin: 0 0 12px 0;
        font-size: 14px;
        color: #6b7280;
        line-height: 1.5;
      }
      
      /* ç°¡æ½”èªªæ˜æ¨£å¼ */
      .instruction-list p {
        margin: 0 0 12px 0;
        font-size: 14px;
        color: #6b7280;
        line-height: 1.6;
      }
      
      .instruction-list p:last-child {
        margin-bottom: 0;
        padding-top: 8px;
        border-top: 1px solid #e5e7eb;
        font-size: 13px;
        color: #9ca3af;
      }
      
      /* æ§åˆ¶å€åŸŸæ¨£å¼ */
      .controls {
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      
      .controls .row {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      
      .control-btn, .secondary-btn {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        flex: 1;
      }
      
      .control-btn {
        background: #10b981;
        color: white;
      }
      
      .control-btn:hover {
        background: #059669;
      }
      
      .secondary-btn {
        background: #f3f4f6;
        color: #374151;
        border: 1px solid #d1d5db;
      }
      
      .secondary-btn:hover {
        background: #e5e7eb;
      }
      
      .controls textarea {
        flex: 1;
        padding: 12px 16px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 14px;
        resize: vertical;
        min-height: 50px;
        font-family: inherit;
      }
      
      .controls textarea:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      .send-btn {
        padding: 12px 24px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
        white-space: nowrap;
      }
      
      .send-btn:hover {
        background: #2563eb;
      }
      
      /* æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
      @media (max-width: 768px) {
        .container { padding: 12px; }
        .main-layout { 
          flex-direction: column; 
          gap: 16px;
        }
        .left-panel { 
          order: 1;
        }
        .right-panel { 
          order: 2;
        }
        .left-content {
          padding: 16px;
        }
        .settings-grid {
          grid-template-columns: 1fr;
          gap: 12px;
        }
        .chat-messages {
          min-height: 300px;
          max-height: 400px;
        }
        .result-tabs {
          flex-direction: column;
        }
        .result-tab {
          border-right: none;
          border-bottom: 1px solid #e5e7eb;
        }
        .result-tab:last-child {
          border-bottom: none;
        }
        .result-content {
          min-height: 200px;
        }
        .user-drawer {
          width: 280px;
          right: -280px;
        }
        .input-row {
          flex-direction: column;
          gap: 8px;
        }
        
        .input-container {
          flex-direction: row;
          gap: 8px;
          align-items: flex-end;
        }
        .input-container button {
          width: auto;
          min-width: 80px;
          flex-shrink: 0;
        }
        h1 { font-size: 16px; margin-bottom: 12px; }
        .chat { height: 50vh; padding: 12px; }
        .msg-bubble { max-width: 90%; padding: 10px 14px; font-size: 14px; }
        .settings-block { padding: 16px; margin-bottom: 12px; }
        .settings-block h3 { font-size: 14px; margin-bottom: 12px; }
        .settings-grid { grid-template-columns: 1fr; gap: 10px; margin-bottom: 12px; }
        .setting-item input, .setting-item select { padding: 10px 12px; font-size: 16px; }
        .apply-btn { padding: 12px 16px; font-size: 14px; }
        .controls { flex-direction: column; gap: 10px; }
        .controls .row { flex-direction: row !important; justify-content: space-between; }
        .controls .row button { flex: 1; margin: 0 4px; }
        textarea { min-height: 40px; font-size: 16px; }
        button { padding: 12px 16px; font-size: 14px; }
        .results-block { padding: 16px; }
        .results-block h3 { font-size: 14px; }
        .result-item h4 { font-size: 13px; }
        .result-item .content { padding: 10px; font-size: 14px; }
        .toast { top: 10px; right: 10px; left: 10px; max-width: none; font-size: 13px; }
      }
      h1 { font-size: 18px; font-weight: 600; color:#2563eb; margin: 0 0 16px; }
      
      /* ç”¨æˆ¶èªè­‰æ¨£å¼ */
      .header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 16px; 
      }
      .header-right {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .user-info { 
        display: flex; 
        align-items: center; 
        gap: 8px; 
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 8px;
        transition: background 0.2s;
      }
      .user-info:hover {
        background: #f3f4f6;
      }
      .user-avatar { 
        width: 32px; 
        height: 32px; 
        border-radius: 50%; 
        border: 2px solid #e5ecef; 
        object-fit: cover;
        object-position: center;
      }
      .user-name { font-size: 14px; font-weight: 500; color: #374151; }
      .auth-buttons { display: flex; gap: 8px; }
      .login-btn, .logout-btn { 
        padding: 8px 16px; 
        border: none; 
        border-radius: 6px; 
        font-size: 14px; 
        font-weight: 500; 
        cursor: pointer; 
        transition: all 0.2s;
      }
      .login-btn { 
        background: #4285f4; 
        color: white; 
      }
      .login-btn:hover { background: #3367d6; }
      .logout-btn { 
        background: #f3f4f6; 
        color: #374151; 
        border: 1px solid #d1d5db;
      }
      .logout-btn:hover { background: #e5e7eb; }
      
      /* å½ˆè·³è¦–çª—ç™»å…¥æ¨£å¼ */
      .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: none;
        align-items: center;
        justify-content: center;
      }
      
      .popup-content {
        background: white;
        border-radius: 12px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 90%;
      }
      
      .popup-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }
      
      .popup-message {
        font-size: 16px;
        color: #2c3e50;
        margin-bottom: 20px;
      }
      
      .popup-btn {
        background: #3498db;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        margin: 0 10px;
      }
      
      .popup-btn:hover {
        background: #2980b9;
      }
      
      .popup-btn.secondary {
        background: #95a5a6;
      }
      
      .popup-btn.secondary:hover {
        background: #7f8c8d;
      }
      
      /* æ‰‹æ©Ÿç‰ˆç”¨æˆ¶èªè­‰å„ªåŒ– */
      @media (max-width: 768px) {
        .header { flex-direction: column; align-items: flex-start; gap: 12px; }
        .user-info { width: 100%; justify-content: space-between; }
        .auth-buttons { width: 100%; justify-content: flex-end; }
        .login-btn, .logout-btn { padding: 10px 16px; font-size: 16px; }
      }
      .chat { border: 1px solid #e5e7eb; background: #f9fafb; border-radius: 12px; height: 60vh; overflow: auto; padding: 16px; }
      .msg { margin: 12px 0; line-height: 1.6; display: flex; }
      .msg.user { justify-content: flex-end; }
      .msg.assistant { justify-content: flex-start; }
      .msg-bubble { max-width: 80%; padding: 12px 16px; border-radius: 18px; white-space: pre-wrap; word-wrap: break-word; }
      .msg.user .msg-bubble { background: #3b82f6; color: #ffffff; border-bottom-right-radius: 4px; }
      .msg.assistant .msg-bubble { background: #f3f4f6; color: #374151; border-bottom-left-radius: 4px; }
      .msg-label { font-size: 11px; color: #6b7280; margin-bottom: 4px; font-weight: 500; }
      .msg.user .msg-label { text-align: right; }
      .msg.assistant .msg-label { text-align: left; }
      
      /* è¼‰å…¥å‹•ç•« */
      .loading { 
        display: flex; 
        align-items: center; 
        gap: 8px; 
        padding: 8px 12px;
        background: #f0f9ff;
        color: #0c4a6e;
        border-radius: 8px;
        margin-right: 20px;
        max-width: 70%;
        position: relative;
      }
      
      .loading::after {
        content: '';
        position: absolute;
        right: -8px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-left: 8px solid #f0f9ff;
        border-top: 8px solid transparent;
        border-bottom: 8px solid transparent;
      }
      .spinner { 
        width: 16px; 
        height: 16px; 
        border: 2px solid #e5e7eb; 
        border-top: 2px solid #3b82f6; 
        border-radius: 50%; 
        animation: spin 1s linear infinite; 
      }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      .controls { display: flex; gap: 8px; margin-top: 12px; align-items:center; }
      textarea { flex: 1; min-height: 40px; max-height: 140px; resize: vertical; border-radius: 10px; border:1px solid #d1d5db; background:#ffffff; color:#374151; padding: 10px 12px; line-height: 1.4; -webkit-appearance: none; }
      button { padding: 10px 14px; border-radius: 10px; border:1px solid #d1d5db; background:#f9fafb; color:#374151; cursor:pointer; -webkit-appearance: none; }
      button:disabled { opacity: .6; cursor:not-allowed; }
      .row { display:flex; gap:8px; flex-direction:column; }
      .meta { display:flex; gap:8px; margin-bottom:8px; align-items:center; flex-wrap:wrap; }
      .meta input, .meta select { flex:1; min-width: 200px; border-radius: 8px; border:1px solid #d1d5db; background:#ffffff; color:#374151; padding:8px 10px; }
      .small { font-size:12px; color:#6b7280; }
      .tag { display:inline-block; padding:4px 8px; border:1px solid #d1d5db; border-radius:999px; font-size:12px; color:#6b7280; background:#f3f4f6; }
      
      /* è¨­å®šå€å¡Šæ¨£å¼ */
      .settings-block { background:#ffffff; border:1px solid #e5e7eb; border-radius:12px; padding:20px; margin-bottom:16px; }
      .settings-block h3 { margin:0 0 16px; color:#2563eb; font-size:16px; cursor:pointer; user-select:none; display:flex; align-items:center; gap:8px; }
      .settings-block h3:hover { color:#1d4ed8; }
      .settings-toggle { font-size:12px; transition:transform 0.2s ease; }
      .settings-content { transition:all 0.3s ease; overflow:hidden; }
      .settings-content.collapsed { max-height:0; margin:0; padding:0; }
      .settings-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:12px; margin-bottom:16px; }
      .setting-item { display:flex; flex-direction:column; gap:6px; }
      .setting-item label { font-size:12px; color:#6b7280; font-weight:500; }
      .setting-item input, .setting-item select { padding:8px 12px; border-radius:8px; border:1px solid #d1d5db; background:#ffffff; color:#374151; -webkit-appearance: none; }
      .apply-btn { background:#3b82f6; border:1px solid #2563eb; color:#ffffff; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:500; }
      .apply-btn:hover { background:#2563eb; }
      .applied-tags { display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
      
      /* çµæœå€å¡Šæ¨£å¼ */
      .results-block { background:#ffffff; border:1px solid #e5e7eb; border-radius:12px; padding:20px; margin-top:16px; display:none; }
      .results-block h3 { margin:0 0 16px; color:#2563eb; font-size:16px; }
      .result-item { margin-bottom:16px; }
      .result-item h4 { margin:0 0 8px; color:#374151; font-size:14px; font-weight:500; }
      .result-item .content { background:#f9fafb; border:1px solid #e5e7eb; border-radius:8px; padding:12px; color:#374151; white-space:pre-wrap; line-height:1.6; }
      
      /* å½ˆå‡ºæ¡†æ¨£å¼ */
      .toast { position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; font-size: 14px; max-width: 300px; word-wrap: break-word; }
      .toast.show { animation: slideIn 0.3s ease-out; }
      .toast.hide { animation: slideOut 0.3s ease-in; }
      @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
      @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
      
      /* iOS Safari ç‰¹å®šå„ªåŒ– */
      @supports (-webkit-touch-callout: none) {
        .chat { -webkit-overflow-scrolling: touch; }
        textarea { -webkit-user-select: text; }
        input, select { -webkit-user-select: text; }
        .msg-bubble { -webkit-user-select: text; }
        .result-item .content { -webkit-user-select: text; }
      }
      
      /* é˜²æ­¢ iOS Safari ç¸®æ”¾ */
      input[type="text"], input[type="email"], input[type="password"], textarea, select { font-size: 16px; }
      
      /* å¿«é€ŸæŒ‰éˆ•æ¨£å¼ */
      .quick-buttons { 
        display: flex; 
        gap: 8px; 
        margin-bottom: 12px; 
        flex-wrap: wrap;
        justify-content: center;
      }
      .quick-btn { 
        padding: 10px 18px; 
        border-radius: 20px; 
        border: 1px solid #3b82f6; 
        background: #ffffff; 
        color: #3b82f6; 
        cursor: pointer; 
        font-size: 16px;
        font-weight: 500;
        transition: all 0.2s ease;
        white-space: nowrap;
      }
      .quick-btn:hover { 
        background: #3b82f6; 
        color: #ffffff; 
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
      }
      .quick-btn:active { 
        transform: translateY(0); 
        box-shadow: 0 1px 4px rgba(59, 130, 246, 0.2);
      }
      
      /* æ‰‹æ©Ÿç‰ˆå¿«é€ŸæŒ‰éˆ•å„ªåŒ– */
      @media (max-width: 768px) {
        .quick-buttons { 
          display: flex !important;
          gap: 6px; 
          margin-bottom: 8px;
          visibility: visible !important;
          opacity: 1 !important;
          height: auto !important;
          min-height: auto !important;
          padding: 0 !important;
          background: transparent !important;
        }
        .quick-btn { 
          padding: 6px 8px; 
          font-size: 12px;
          flex: 1;
          min-width: 0;
          text-align: center;
        }
        .input-row {
          display: flex !important;
          visibility: visible !important;
          opacity: 1 !important;
          height: auto !important;
          min-height: 80px !important;
        }
      }
      
      /* å¸³è™Ÿå®šä½è¨˜éŒ„åˆ—è¡¨æ¨£å¼ */
      .positioning-history-content {
        padding: 10px;
        max-height: 500px;
        overflow-y: auto;
      }
      
      .positioning-records {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      
      .positioning-record-item {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 12px;
      }
      
      .record-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        padding-bottom: 8px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .record-number {
        font-weight: 600;
        color: #3b82f6;
        font-size: 14px;
      }
      
      .record-date {
        font-size: 12px;
        color: #6b7280;
      }
      
      .record-preview {
        color: #374151;
        font-size: 14px;
        margin-bottom: 10px;
        line-height: 1.5;
      }
      
      .record-actions {
        display: flex;
        gap: 8px;
      }
      
      .view-btn, .delete-btn {
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 13px;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .view-btn {
        background: #3b82f6;
        color: white;
      }
      
      .view-btn:hover {
        background: #2563eb;
      }
      
      .delete-btn {
        background: #ef4444;
        color: white;
      }
      
      .delete-btn:hover {
        background: #dc2626;
      }
      
      /* è©³ç´°å…§å®¹å½ˆå‡ºè¦–çª—æ¨£å¼ */
      .detail-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      }
      
      .detail-modal {
        background: white;
        border-radius: 12px;
        width: 90%;
        max-width: 700px;
        max-height: 80vh;
        display: flex;
        flex-direction: column;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      
      .detail-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 24px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .detail-modal-header h3 {
        margin: 0;
        font-size: 20px;
        color: #111827;
      }
      
      .close-detail-btn {
        background: none;
        border: none;
        font-size: 24px;
        color: #6b7280;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: all 0.2s;
      }
      
      .close-detail-btn:hover {
        background: #f3f4f6;
        color: #111827;
      }
      
      .detail-modal-body {
        padding: 24px;
        overflow-y: auto;
        flex: 1;
      }
      
      .detail-info {
        display: flex;
        gap: 24px;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .detail-info span {
        font-size: 14px;
        color: #6b7280;
      }
      
      .detail-info strong {
        color: #111827;
        font-weight: 600;
      }
      
      .detail-content {
        color: #374151;
        line-height: 1.8;
        font-size: 15px;
      }
      
      
      /* æ“´å¤§ç”¨æˆ¶æŠ½å±œè¦–çª— */
      .user-drawer {
        width: 85%;
        max-width: 1000px;
        height: 85vh;
        max-height: 700px;
      }
      
      /* å€‹äººè³‡æ–™åº«é é¢æ¨£å¼ */
      .user-db-page {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
      }
      
      .page-title {
        font-size: 24px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 24px;
        text-align: center;
      }
      
      .user-db-container {
        display: flex;
        gap: 24px;
        min-height: 600px;
      }
      
      .user-db-sidebar {
        width: 280px;
        background: #f8fafc;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      
      .sidebar-header {
        margin-bottom: 24px;
        padding-bottom: 20px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .user-profile {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .profile-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: 2px solid #e5e7eb;
      }
      
      .profile-info h3 {
        margin: 0 0 4px 0;
        font-size: 16px;
        font-weight: 600;
        color: #1f2937;
      }
      
      .profile-info p {
        margin: 0;
        font-size: 14px;
        color: #6b7280;
      }
      
      .sidebar-menu {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      
      .menu-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        background: none;
        text-align: left;
        font-size: 14px;
        color: #6b7280;
      }
      
      .menu-item:hover {
        background: #e5e7eb;
        color: #1f2937;
      }
      
      .menu-item.active {
        background: #3b82f6;
        color: white;
      }
      
      .menu-icon {
        font-size: 16px;
      }
      
      .menu-text {
        font-weight: 500;
      }
      
      .menu-divider {
        height: 1px;
        background: #e5e7eb;
        margin: 12px 0;
      }
      
      .logout-item {
        color: #dc2626;
      }
      
      .logout-item:hover {
        background: #fef2f2;
        color: #dc2626;
      }
      
      .user-db-content {
        flex: 1;
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }
      
      .db-section {
        display: none;
      }
      
      .db-section.active {
        display: block;
      }
      
      .section-title {
        font-size: 20px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 16px;
      }
      
      .section-content {
        color: #6b7280;
        line-height: 1.6;
      }
      
      .profile-details {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      
      .detail-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: #f8fafc;
        border-radius: 8px;
      }
      
      .detail-item label {
        font-weight: 600;
        color: #374151;
        min-width: 80px;
      }
      
      .detail-item span {
        color: #6b7280;
      }

      /* ===== æ¨¡å¼3ï¼šIPäººè¨­è¦åŠƒæ¨¡å¼æ¨£å¼ ===== */
      .mode3-page {
        min-height: 100vh;
        background: #f8fafc;
        padding: 0;
      }
      
      /* IPäººè¨­è¦åŠƒå›ºå®šä½ˆå±€ */
      .mode3-fixed {
        position: relative;
        width: 100%;
        min-height: calc(100vh - 60px);
        background: #f8fafc;
      }
      
      .mode3-page {
        position: relative;
        width: 100%;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }
      
      .mode3-chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 80px 20px 0 20px;
        overflow: hidden;
      }
      
      .mode3-chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 0 0 5px 0;
        margin-bottom: 5px;
      }
      
      .mode3-quick-buttons {
        display: flex;
        gap: 6px;
        margin-bottom: 8px;
        flex-wrap: wrap;
        justify-content: center;
      }
      
      .mode3-quick-btn {
        padding: 6px 12px;
        background: #e5e7eb;
        border: none;
        border-radius: 16px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
        flex: 1;
        min-width: 0;
      }
      
      .mode3-quick-btn:hover {
        background: #d1d5db;
        transform: translateY(-1px);
      }
      
      .mode3-input-container {
        position: sticky;
        bottom: 0;
        background: white;
        padding: 12px 20px 15px 20px;
        border-top: 1px solid #e5e7eb;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 0;
      }
      
      .mode3-input-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
      }
      
      .mode3-message-input {
        flex: 1;
        padding: 8px 16px;
        border: 1px solid #d1d5db;
        border-radius: 20px;
        font-size: 14px;
        resize: none;
        outline: none;
        transition: border-color 0.2s ease;
        min-height: 36px;
        max-height: 80px;
      }
      
      .mode3-message-input:focus {
        border-color: #4f46e5;
      }
      
      .mode3-send-btn {
        padding: 12px;
        background: #4f46e5;
        color: white;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s ease;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .mode3-send-btn:hover {
        background: #4338ca;
        transform: translateY(-1px);
      }
      
      /* ä½¿ç”¨èªªæ˜æ­¥é©ŸæŒ‡å—æ¨£å¼ */
      .mode3-step-guide {
        margin: 16px 0;
      }
      
      .mode3-step {
        display: flex;
        align-items: flex-start;
        margin-bottom: 16px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        border-left: 4px solid #4f46e5;
      }
      
      .mode3-step-number {
        width: 32px;
        height: 32px;
        background: #4f46e5;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 14px;
        margin-right: 12px;
        flex-shrink: 0;
      }
      
      .mode3-step-content {
        flex: 1;
      }
      
      .mode3-step-content strong {
        color: #1f2937;
        font-size: 14px;
        display: block;
        margin-bottom: 4px;
      }
      
      .mode3-step-content p {
        color: #6b7280;
        font-size: 13px;
        margin: 0;
        line-height: 1.4;
      }
      
      /* ç”Ÿæˆå…§å®¹é¡å‹æ¨£å¼ */
      .mode3-result-types {
        margin: 12px 0;
      }
      
      .mode3-result-type {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 6px;
        padding: 10px 12px;
        margin-bottom: 8px;
        border-left: 3px solid #10b981;
      }
      
      .mode3-result-type strong {
        color: #1f2937;
        font-size: 13px;
        display: block;
        margin-bottom: 4px;
      }
      
      .mode3-result-type p {
        color: #6b7280;
        font-size: 12px;
        margin: 0;
        line-height: 1.3;
      }
      
      /* IPäººè¨­è¦åŠƒä½¿ç”¨èªªæ˜æŒ‰éˆ•å’ŒæŠ½å±œæ¨£å¼ */
      .mode3-instructions-btn-container {
        position: fixed;
        top: 75px;
        right: 20px;
        z-index: 1001;
      }
      
      .mode3-results-btn-container {
        position: fixed;
        top: 75px;
        right: 120px;
        z-index: 1001;
      }
      
      .mode3-results-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        background: #10b981;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
      }
      
      .mode3-results-btn:hover {
        background: #059669;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(16, 185, 129, 0.4);
      }
      
      .mode3-results-icon {
        font-size: 16px;
      }
      
      .mode3-results-text {
        font-size: 14px;
      }
      
      .mode3-instructions-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        background: #4f46e5;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(79, 70, 229, 0.3);
      }
      
      .mode3-instructions-btn:hover {
        background: #4338ca;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(79, 70, 229, 0.4);
      }
      
      .mode3-instructions-icon {
        font-size: 16px;
      }
      
      .mode3-instructions-text {
        font-size: 14px;
      }
      
      /* æŠ½å±œæ¨£å¼ */
      .mode3-instructions-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9998;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .mode3-instructions-overlay.open {
        opacity: 1;
        visibility: visible;
      }
      
      .mode3-instructions-drawer {
        position: fixed;
        top: 0;
        right: -400px;
        width: 400px;
        height: 100%;
        background: white;
        z-index: 9999;
        transition: right 0.3s ease;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
      }
      
      .mode3-instructions-drawer.open {
        right: 0;
      }
      
      .mode3-instructions-drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
      }
      
      .mode3-instructions-drawer-header h3 {
        margin: 0;
        color: #1f2937;
        font-size: 18px;
        font-weight: 600;
      }
      
      .mode3-instructions-drawer-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #6b7280;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }
      
      .mode3-instructions-drawer-close:hover {
        background: #e5e7eb;
        color: #374151;
      }
      
      .mode3-instructions-drawer-content {
        padding: 20px;
        color: #374151;
        line-height: 1.6;
      }
      
      .mode3-instructions-drawer-content p {
        margin: 0 0 16px 0;
      }
      
      .mode3-instructions-drawer-content ul {
        margin: 0 0 16px 0;
        padding-left: 20px;
      }
      
      .mode3-instructions-drawer-content li {
        margin-bottom: 8px;
      }
      
      /* ç”ŸæˆçµæœæŠ½å±œæ¨£å¼ */
      .mode3-results-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9998;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .mode3-results-overlay.open {
        opacity: 1;
        visibility: visible;
      }
      
      .mode3-results-drawer {
        position: fixed;
        top: 0;
        right: -500px;
        width: 500px;
        height: 100%;
        background: white;
        z-index: 9999;
        transition: right 0.3s ease;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
      }
      
      .mode3-results-drawer.open {
        right: 0;
      }
      
      .mode3-results-drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
      }
      
      .mode3-results-drawer-header h3 {
        margin: 0;
        color: #1f2937;
        font-size: 18px;
        font-weight: 600;
      }
      
      .mode3-results-drawer-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #6b7280;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }
      
      .mode3-results-drawer-close:hover {
        background: #e5e7eb;
        color: #374151;
      }
      
      .mode3-results-drawer-content {
        padding: 20px;
        color: #374151;
        line-height: 1.6;
      }
      
      .mode3-results-drawer-content .mode3-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .mode3-results-drawer-content .mode3-tab {
        padding: 10px 16px;
        background: none;
        border: none;
        border-bottom: 2px solid transparent;
        cursor: pointer;
        font-size: 14px;
        color: #6b7280;
        transition: all 0.2s ease;
      }
      
      .mode3-results-drawer-content .mode3-tab.active {
        color: #4f46e5;
        border-bottom-color: #4f46e5;
      }
      
      .mode3-results-drawer-content .mode3-tab:hover {
        color: #4f46e5;
      }
      
      .mode3-results-drawer-content .mode3-result-block {
        display: none;
      }
      
      .mode3-results-drawer-content .mode3-result-block.active {
        display: block;
      }
      
      .mode3-results-drawer-content .mode3-result-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e5e7eb;
      }
      
      .mode3-results-drawer-content .mode3-action-btn {
        flex: 1;
        padding: 10px 16px;
        background: #f3f4f6;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        color: #374151;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      
      .mode3-results-drawer-content .mode3-action-btn:hover {
        background: #e5e7eb;
        transform: translateY(-1px);
      }
      
      /* æ‰‹æ©Ÿç‰ˆé©é… */
      @media (max-width: 768px) {
        .mode3-instructions-drawer,
        .mode3-results-drawer {
          width: 100%;
          right: -100%;
        }
        
        .mode3-instructions-btn-container {
          top: 65px;
          right: 15px;
        }
        
        .mode3-results-btn-container {
          top: 65px;
          right: 80px;
        }
        
        .mode3-instructions-btn,
        .mode3-results-btn {
          padding: 10px 12px;
          font-size: 13px;
        }
        
        .mode3-instructions-text,
        .mode3-results-text {
          display: none;
        }
        
        .mode3-fixed {
          min-height: calc(100vh - 50px);
        }
        
        .mode3-page {
          padding: 0 10px;
        }
        
        .mode3-chat-container {
          padding: 70px 10px 0 10px;
        }
        
        .mode3-input-container {
          padding: 12px 15px 15px 15px;
          margin-bottom: 0;
        }
        
        .mode3-quick-buttons {
          gap: 4px;
          margin-bottom: 6px;
        }
        
        .mode3-quick-btn {
          padding: 5px 10px;
          font-size: 12px;
          flex: 1;
          min-width: 0;
        }
        
        .mode3-message-input {
          padding: 6px 12px;
          min-height: 32px;
          max-height: 70px;
        }
      }

      .mode3-container {
        display: flex;
        height: calc(100vh - 60px);
        gap: 0;
      }

      .mode3-left-panel {
        flex: 1;
        background: white;
        border-right: 1px solid #e5e7eb;
        display: flex;
        flex-direction: column;
        min-width: 0;
        overflow: hidden;
      }

      .mode3-right-panel {
        flex: 1;
        background: white;
        display: flex;
        flex-direction: column;
        min-width: 0;
        overflow: hidden;
      }

      /* èªªæ˜æ¬„ä½ */
      .mode3-instructions {
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
      }

      .mode3-instructions-header {
        padding: 12px 16px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f1f5f9;
        border-bottom: 1px solid #e5e7eb;
        transition: background-color 0.2s;
      }

      .mode3-instructions-header:hover {
        background: #e2e8f0;
      }

      .mode3-instructions-title {
        font-weight: 600;
        color: #374151;
        font-size: 14px;
      }

      .mode3-instructions-toggle {
        font-size: 12px;
        color: #6b7280;
        transition: transform 0.2s;
      }

      .mode3-instructions.collapsed .mode3-instructions-toggle {
        transform: rotate(-90deg);
      }

      .mode3-instructions-content {
        padding: 16px;
        font-size: 13px;
        line-height: 1.6;
        color: #4b5563;
        max-height: 300px;
        overflow-y: auto;
        transition: max-height 0.3s ease;
      }

      .mode3-instructions.collapsed .mode3-instructions-content {
        max-height: 0;
        padding: 0 16px;
        overflow: hidden;
      }

      .mode3-instructions-content p {
        margin: 0 0 12px 0;
      }

      .mode3-instructions-content ul {
        margin: 8px 0;
        padding-left: 20px;
      }

      .mode3-instructions-content li {
        margin: 4px 0;
      }

      /* èŠå¤©å®¹å™¨ */
      .mode3-chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .mode3-chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 16px;
        min-height: 200px;
        transition: min-height 0.3s ease;
      }

      .mode3-chat-messages.expanded {
        min-height: 400px;
      }

      .mode3-message {
        display: flex;
        margin-bottom: 16px;
        align-items: flex-start;
      }

      .mode3-message-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        margin-right: 12px;
        flex-shrink: 0;
      }

      .mode3-user-message .mode3-message-avatar {
        background: #3b82f6;
        color: white;
      }

      .mode3-assistant-message .mode3-message-avatar {
        background: #f3f4f6;
        color: #374151;
      }

      .mode3-message-content {
        flex: 1;
        background: #f8fafc;
        padding: 12px 16px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
      }

      .mode3-user-message .mode3-message-content {
        background: #dbeafe;
        border-color: #3b82f6;
        color: #1e40af;
      }

      .mode3-message-content p {
        margin: 0 0 8px 0;
        line-height: 1.5;
      }

      .mode3-message-content ul {
        margin: 8px 0;
        padding-left: 20px;
      }

      .mode3-message-content li {
        margin: 4px 0;
      }

      .mode3-message-content:last-child p:last-child {
        margin-bottom: 0;
      }

      /* å¿«é€ŸæŒ‰éˆ• */
      .mode3-quick-buttons {
        padding: 12px 16px;
        border-top: 1px solid #e5e7eb;
        background: #f8fafc;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .mode3-quick-btn {
        background: white;
        border: 1px solid #d1d5db;
        color: #374151;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
      }

      .mode3-quick-btn:hover {
        background: #3b82f6;
        border-color: #3b82f6;
        color: white;
      }

      /* è¼¸å…¥å€åŸŸ */
      .mode3-input-container {
        padding: 16px;
        border-top: 1px solid #e5e7eb;
        background: white;
      }

      .mode3-input-wrapper {
        display: flex;
        gap: 8px;
        align-items: flex-end;
      }

      .mode3-message-input {
        flex: 1;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        padding: 12px;
        font-size: 14px;
        resize: vertical;
        min-height: 44px;
        max-height: 120px;
        font-family: inherit;
      }

      .mode3-message-input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .mode3-send-btn {
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.2s;
        flex-shrink: 0;
      }

      .mode3-send-btn:hover {
        background: #2563eb;
      }

      .mode3-send-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
      }

      .mode3-send-icon {
        font-size: 16px;
      }

      /* çµæœé¢æ¿ */
      .mode3-results-header {
        padding: 16px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .mode3-results-header h3 {
        margin: 0;
        font-size: 16px;
        color: #374151;
      }

      .mode3-result-actions {
        display: flex;
        gap: 8px;
      }

      .mode3-action-btn {
        background: white;
        border: 1px solid #d1d5db;
        color: #6b7280;
        width: 32px;
        height: 32px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
      }

      .mode3-action-btn:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
        color: #374151;
      }

      /* æ¨™ç±¤ */
      .mode3-tabs {
        display: flex;
        border-bottom: 1px solid #e5e7eb;
        background: white;
      }

      .mode3-tab {
        flex: 1;
        background: none;
        border: none;
        padding: 12px 16px;
        cursor: pointer;
        font-size: 13px;
        color: #6b7280;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
      }

      .mode3-tab:hover {
        background: #f8fafc;
        color: #374151;
      }

      .mode3-tab.active {
        color: #3b82f6;
        border-bottom-color: #3b82f6;
        background: #f8fafc;
      }

      /* çµæœå…§å®¹ */
      .mode3-results-content {
        flex: 1;
        overflow-y: auto;
        background: white;
      }

      .mode3-result-block {
        display: none;
        padding: 16px;
        height: 100%;
      }

      .mode3-result-block.active {
        display: block;
      }
      .mode3-result-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        text-align: center;
        color: #6b7280;
      }

      .mode3-placeholder-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .mode3-placeholder-icon h4 {
        margin: 0 0 8px 0;
        color: #374151;
        font-size: 18px;
      }

      .mode3-placeholder-icon p {
        margin: 0 0 24px 0;
        font-size: 14px;
        line-height: 1.5;
      }

      .mode3-generate-btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .mode3-generate-btn:hover {
        background: #2563eb;
      }

      .mode3-generate-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
      }

      /* çµæœå…§å®¹æ¨£å¼ */
      .mode3-result-content {
        line-height: 1.6;
        color: #374151;
      }

      .mode3-result-content h1,
      .mode3-result-content h2,
      .mode3-result-content h3,
      .mode3-result-content h4 {
        color: #1f2937;
        margin: 16px 0 8px 0;
      }

      .mode3-result-content h1:first-child,
      .mode3-result-content h2:first-child,
      .mode3-result-content h3:first-child,
      .mode3-result-content h4:first-child {
        margin-top: 0;
      }

      .mode3-result-content p {
        margin: 8px 0;
      }

      .mode3-result-content ul,
      .mode3-result-content ol {
        margin: 8px 0;
        padding-left: 20px;
      }

      .mode3-result-content li {
        margin: 4px 0;
      }

      .mode3-result-content strong {
        color: #1f2937;
        font-weight: 600;
      }

      .mode3-result-content em {
        color: #6b7280;
        font-style: italic;
      }

      /* è¼‰å…¥å‹•ç•« */
      .mode3-loading {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #6b7280;
        font-size: 14px;
      }

      .mode3-loading-dots {
        display: flex;
        gap: 4px;
      }

      .mode3-loading-dot {
        width: 6px;
        height: 6px;
        background: #3b82f6;
        border-radius: 50%;
        animation: mode3-bounce 1.4s infinite ease-in-out both;
      }

      .mode3-loading-dot:nth-child(1) { animation-delay: -0.32s; }
      .mode3-loading-dot:nth-child(2) { animation-delay: -0.16s; }

      @keyframes mode3-bounce {
        0%, 80%, 100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }

      /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
      @media (max-width: 768px) {
        .mode3-container {
          flex-direction: column;
          height: auto;
          padding-top: 70px;
        }

        .mode3-left-panel,
        .mode3-right-panel {
          min-height: 50vh;
        }

        .mode3-tabs {
          flex-wrap: wrap;
        }

        .mode3-tab {
          flex: none;
          min-width: 120px;
        }
      }
      
      /* æ¡Œé¢ç‰ˆæ¨£å¼ */
      @media (min-width: 769px) {
        .desktop-only {
          display: block !important;
        }
      }
      
      /* æ‰‹æ©Ÿç‰ˆæŠ½å±œå°èˆªæ¨£å¼ */
      .mobile-drawer-toggle {
        display: none;
        background: none;
        border: none;
        font-size: 20px;
        color: #374151;
        cursor: pointer;
        padding: 8px;
        margin-right: 12px;
        border-radius: 4px;
        transition: background-color 0.2s;
      }

      .mobile-drawer-toggle:hover {
        background-color: #f3f4f6;
      }

      .mobile-drawer-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none;
      }

      .mobile-drawer {
        position: fixed;
        top: 0;
        left: -300px;
        width: 280px;
        height: 100%;
        background: white;
        z-index: 1000;
        transition: left 0.3s ease;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      }

      .mobile-drawer.open {
        left: 0;
      }

      .mobile-drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
      }

      .mobile-drawer-header h3 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
      }

      .mobile-drawer-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #6b7280;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: background-color 0.2s;
      }

      .mobile-drawer-close:hover {
        background-color: #e5e7eb;
      }

      .mobile-drawer-content {
        padding: 20px 0;
      }

      .mobile-drawer-item {
        display: flex;
        align-items: center;
        padding: 16px 20px;
        color: #374151;
        text-decoration: none;
        transition: background-color 0.2s;
        border-left: 3px solid transparent;
      }

      .mobile-drawer-item:hover {
        background-color: #f8fafc;
        color: #1f2937;
      }

      .mobile-drawer-item.active {
        background-color: #eff6ff;
        color: #3b82f6;
        border-left-color: #3b82f6;
      }

      .mobile-drawer-icon {
        font-size: 20px;
        margin-right: 12px;
        width: 24px;
        text-align: center;
      }

      .mobile-drawer-text {
        font-size: 16px;
        font-weight: 500;
      }

      /* ChatGPT é¢¨æ ¼éŸ¿æ‡‰å¼è¨­è¨ˆ */
      @media (max-width: 768px) {
        /* æ‰‹æ©Ÿç‰ˆæŠ½å±œæŒ‰éˆ•é¡¯ç¤º */
        .mobile-drawer-toggle {
          display: block !important;
        }

        /* éš±è—æ¡Œé¢ç‰ˆå°èˆªæ¨™ç±¤ */
        .navbar-tabs {
          display: none !important;
        }

        /* éš±è—åº•éƒ¨å°è¦½åˆ— */
        .bottom-navbar {
          display: none !important;
        }

        .chat-container {
          max-width: 100% !important;
          margin: 0 !important;
          padding: 0 !important;
        }
        
        .message {
          padding: 15px 0 !important;
          margin-bottom: 0 !important;
        }
        
        .message-avatar {
          width: 28px !important;
          height: 28px !important;
          min-width: 28px !important;
          font-size: 14px !important;
          margin-right: 12px !important;
        }
        
        .message-content {
          max-width: calc(100% - 40px) !important;
          word-wrap: break-word !important;
          overflow-wrap: break-word !important;
        }
        
        .input-row {
          padding: 20px !important;
          background: #f7f7f8 !important;
          border: none !important;
          box-shadow: none !important;
          display: flex !important;
          flex-direction: column !important;
          gap: 6px !important;
          z-index: auto !important;
        }
        
        .input-container {
          background: white !important;
          border: 1px solid #e5e7eb !important;
          border-radius: 12px !important;
          padding: 8px 12px !important;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
        }
        
        .input-container textarea {
          font-size: 16px !important; /* é˜²æ­¢iOSç¸®æ”¾ */
          padding: 8px 0 !important;
          min-height: 24px !important;
          max-height: 120px !important;
          line-height: 1.5 !important;
          resize: none !important;
        }
        
        .input-container button {
          background: #3b82f6 !important;
          color: white !important;
          border: none !important;
          border-radius: 8px !important;
          padding: 8px 12px !important;
          font-size: 16px !important;
          min-width: 40px !important;
          height: 40px !important;
        }
        
        .quick-buttons {
          gap: 6px !important;
          padding: 20px !important;
          background: #f7f7f8 !important;
          border: none !important;
          z-index: auto !important;
          display: flex !important;
          flex-wrap: wrap !important;
          justify-content: center !important;
        }
        
        .quick-btn {
          padding: 8px 16px !important;
          font-size: 14px !important;
          border-radius: 12px !important;
          background: white !important;
          border: 1px solid #d1d5db !important;
          white-space: nowrap !important;
          min-width: fit-content !important;
          flex-shrink: 0 !important;
        }
        
        
        /* æ‰‹æ©Ÿç‰ˆèŠå¤©å®¹å™¨èª¿æ•´ */
        .chat-container {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          bottom: 0 !important;
          max-width: 100% !important;
          margin: 0 !important;
          display: flex !important;
          flex-direction: column !important;
        }
        
        .chat-messages {
          flex: 1 !important;
          padding: 0 !important;
          padding-top: 80px !important; /* æ·»åŠ é ‚éƒ¨é–“è·é¿å…è¢«é é¦–é®ä½ */
          padding-bottom: 0 !important; /* ç§»é™¤åº•éƒ¨paddingï¼Œè®“è¨Šæ¯ç·Šè²¼è¼¸å…¥å€åŸŸ */
          overflow-y: auto !important;
          min-height: 0 !important;
          max-width: none !important;
          width: 100% !important;
        }
        
        /* æ‰‹æ©Ÿç‰ˆå¿«é€ŸæŒ‰éˆ•ç¨ç«‹é¡¯ç¤º - å·²åœ¨ä¸Šæ–¹å®šç¾© */
        
        .input-row {
          padding: 15px !important;
          margin-top: 0 !important;
          background: white !important;
          border: none !important;
          box-shadow: none !important;
          display: flex !important;
          flex-direction: column !important;
          gap: 6px !important;
          z-index: auto !important;
        }
        
        .message {
          padding: 15px 0 !important;
        }
        
        .message-content {
          padding: 15px 20px !important;
          max-width: none !important;
          width: 100% !important;
        }
        
        .message-avatar {
          width: 28px !important;
          height: 28px !important;
          min-width: 28px !important;
          font-size: 14px !important;
          margin-right: 12px !important;
        }
        
        .quick-btn {
          padding: 6px 12px !important;
          font-size: 13px !important;
        }
        
        
        .input-container {
          padding: 6px 10px !important;
          border-radius: 10px !important;
        }
        
        .chat-input {
          font-size: 16px !important; /* é˜²æ­¢iOSç¸®æ”¾ */
          padding: 6px 0 !important;
        }
        
        .send-btn {
          font-size: 16px !important;
          padding: 6px !important;
        }
      }
      
      @media (min-width: 769px) and (max-width: 1024px) {
        .chat-container {
          max-width: 700px;
        }
      }
      
      @media (min-width: 1025px) {
        .chat-container {
          max-width: 800px;
        }
      }

      /* æ¡Œé¢ç‰ˆæ¨£å¼ - éš±è—æ‰‹æ©Ÿç‰ˆæŠ½å±œ */
      @media (min-width: 769px) {
        .mobile-drawer-toggle {
          display: none !important;
        }
        
        .mobile-drawer {
          display: none !important;
        }
        
        .mobile-drawer-overlay {
          display: none !important;
        }
        
        .bottom-navbar {
          display: none !important;
        }
      }
      
      /* éŸ¿æ‡‰å¼è¨­è¨ˆ - æ‰‹æ©Ÿç‰ˆ */
      @media (max-width: 768px) {
        /* é ‚éƒ¨å°èˆªæ¬„æ‰‹æ©Ÿç‰ˆ */
        .top-navbar {
          padding: 12px 16px;
          padding-top: calc(12px + var(--safe-area-inset-top));
          flex-wrap: wrap;
          gap: 12px;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1000;
        }
        
        .navbar-left {
          gap: 16px;
          flex: 1;
          min-width: 0;
        }
        
        .navbar-title {
          font-size: 25px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }
        
        .navbar-tabs {
          display: none; /* æ‰‹æ©Ÿç‰ˆéš±è—æ¨™ç±¤ï¼Œæ”¹ç”¨åº•éƒ¨å°èˆª */
        }
        
        /* ä¸»å…§å®¹å€åŸŸç‚ºå›ºå®šé é¦–ç•™å‡ºç©ºé–“ */
        .main-content {
          padding-top: 80px;
          padding-bottom: 80px;
          height: calc(100vh - 80px - 80px);
          overflow: hidden;
        }
        
        /* é¦–é å…§å®¹å€åŸŸç¨ç«‹æ»¾å‹• */
        #homepage {
          height: 100%;
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
          padding: 20px 16px;
        }
        
        /* é¦–é å¡ç‰‡å®¹å™¨èª¿æ•´ */
        #homepage .mode-cards {
          padding-top: 20px;
          padding-bottom: 20px;
        }
        
        /* é¦–é æ¨™é¡Œå€åŸŸèª¿æ•´ */
        #homepage .homepage-title {
          margin-top: 40px;
          margin-bottom: 16px;
        }
        
        #homepage .homepage-subtitle {
          margin-bottom: 20px;
        }
        
        .navbar-right {
          gap: 8px;
        }
        
        .user-info {
          padding: 6px 12px;
          font-size: 14px;
        }
        
        .user-avatar {
          width: 28px !important;
          height: 28px !important;
          object-fit: cover !important;
          object-position: center !important;
        }
        
        .user-name {
          font-size: 14px;
        }
        
        .login-btn, .logout-btn {
          padding: 8px 16px;
          font-size: 14px;
        }
        
        /* ä¸»å…§å®¹å€åŸŸæ‰‹æ©Ÿç‰ˆ - æ»¿ç‰ˆè¨­è¨ˆ */
        .main-content {
          width: 100% !important;
          margin: 0 !important;
          padding: 0 !important;
          height: auto !important;
          min-height: calc(100vh - 60px) !important;
          min-height: calc(100dvh - 60px) !important;
          overflow: visible !important;
        }
        
        .main-content.sidebar-open {
          margin-right: 0 !important;
        }
        
        /* é¦–é æ‰‹æ©Ÿç‰ˆ - æ»¿ç‰ˆè¨­è¨ˆ */
        .homepage {
          width: 100% !important;
          max-width: 100vw !important;
          height: auto !important;
          min-height: calc(100vh - 60px) !important;
          min-height: calc(100dvh - 60px) !important;
          margin: 0 !important;
          padding: 20px 0 !important;
          overflow-x: hidden !important; /* é˜²æ­¢æ°´å¹³æ»¾å‹• */
          overflow-y: auto !important; /* å…è¨±å‚ç›´æ»¾å‹• */
          display: flex !important;
          flex-direction: column !important;
          box-sizing: border-box !important;
        }
        
        .homepage-title {
          font-size: 24px !important;
          margin-bottom: 16px !important;
          text-align: center !important;
          padding: 0 20px !important;
          line-height: 1.2 !important;
          color: #1f2937 !important;
          font-weight: 700 !important;
          white-space: normal !important;
          word-wrap: break-word !important;
        }
        
        /* æ‰‹æ©Ÿç‰ˆæ¨™é¡Œæ›è¡Œæ•ˆæœ */
        .homepage-title .mobile-break {
          display: block;
          margin-top: 4px;
        }
        
        .homepage-subtitle {
          font-size: 16px !important;
          margin-bottom: 24px !important;
          text-align: center !important;
          padding: 0 20px !important;
          line-height: 1.5 !important;
          color: #6b7280 !important;
          font-weight: 400 !important;
          white-space: normal !important;
          word-wrap: break-word !important;
        }
        
        .mode-cards {
          display: flex !important;
          flex-direction: column !important;
          gap: 8px !important;
          padding: 0 16px !important;
          width: 100% !important;
          max-width: 100% !important;
          height: auto !important;
          overflow: hidden !important;
          flex: none !important;
          margin: 0 0 20px 0 !important;
          box-sizing: border-box !important;
        }
        
        .mode-card {
          width: 100% !important;
          max-width: 90% !important;
          height: auto !important;
          min-height: 100% !important;
          margin: 0 !important;
          padding: 16px 12px !important;
          border-radius: 12px !important;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
          background: white !important;
          border: 1px solid #e5e7eb !important;
          display: flex !important;
          flex-direction: column !important;
          justify-content: center !important;
          align-items: center !important;
          text-align: center !important;
          overflow: visible !important;
          cursor: pointer !important;
          position: relative !important;
          z-index: 1 !important;
          user-select: none !important;
          transition: all 0.2s ease !important;
        }
        
        .mode-card h3 {
          font-size: 14px !important;
          margin-bottom: 3px !important;
          font-weight: 600 !important;
          line-height: 1.1 !important;
          color: #1f2937 !important;
          text-align: center !important;
          width: 100% !important;
          white-space: normal !important;
          word-wrap: break-word !important;
        }
        
        .mode-card p {
          font-size: 11px !important;
          line-height: 1.2 !important;
          color: #374151 !important;
          text-align: center !important;
          width: 100% !important;
          white-space: normal !important;
          word-wrap: break-word !important;
          display: block !important;
          margin-bottom: 0 !important;
        }
        
        /* ç¢ºä¿æ¨¡å¼å¡ç‰‡æè¿°æ–‡å­—é¡¯ç¤º */
        .mode-card-desc {
          font-size: 11px !important;
          line-height: 1.2 !important;
          color: #374151 !important;
          text-align: center !important;
          width: 100% !important;
          white-space: normal !important;
          word-wrap: break-word !important;
          display: block !important;
          margin-bottom: 0 !important;
        }
        
        /* æ‰€æœ‰æ¨¡å¼å¡ç‰‡æ¨™é¡Œå­—é«”çµ±ä¸€èª¿æ•´ */
        .mode-card:nth-child(1) .mode-card-title {
          font-size: 20px !important;
          font-weight: 700 !important;
        }
        .mode-card:nth-child(2) .mode-card-title {
          font-size: 20px !important;
          font-weight: 700 !important;
        }
        .mode-card:nth-child(3) .mode-card-title {
          font-size: 20px !important;
          font-weight: 700 !important;
        }
        
        /* æ‰‹æ©Ÿç‰ˆæ¨¡å¼å¡ç‰‡æ‡¸åœæ•ˆæœ - æ›´éˆæ•çš„è¨­è¨ˆ */
        .mode-card {
          transition: all 0.1s ease !important;
        }
        .mode-card:active {
          transform: scale(0.95) !important;
          box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3) !important;
          border-color: #3b82f6 !important;
          background: #f0f9ff !important;
        }
        .mode-card:hover {
          transform: scale(1.02) !important;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2) !important;
          border-color: #3b82f6 !important;
        }
        
        /* ä¸€éµç”Ÿæˆæ‰‹æ©Ÿç‰ˆ */
        .mode1-page {
          flex-direction: column;
          gap: 20px;
          padding: 0 8px;
          max-width: 100%;
          overflow-x: hidden;
        }
        
        .mode1-left {
          width: 100%;
          max-width: 100%;
          padding: 16px;
          box-sizing: border-box;
        }
        
        .mode1-right {
          width: 100%;
          max-width: 100%;
          padding: 16px;
          box-sizing: border-box;
        }
        
        
        
        .results-section {
          width: 100%;
          max-width: 100%;
          overflow-x: hidden;
        }
        
        /* çµæœå€å¡Šæ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        .results-container {
          max-width: 100%;
          overflow-x: hidden;
        }
        
        .result-content {
          max-width: 100%;
          overflow-x: hidden;
          word-wrap: break-word;
        }
        
        .result-body {
          max-width: 100%;
          overflow-x: hidden;
          word-wrap: break-word;
        }
        
        
        .form-group {
          margin-bottom: 16px;
        }
        
        .form-group label {
          font-size: 14px;
          margin-bottom: 8px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
          padding: 10px;
          font-size: 16px; /* é˜²æ­¢iOSç¸®æ”¾ */
          width: 100%;
          max-width: 100%;
          box-sizing: border-box;
        }
        
        .generate-btn {
          padding: 10px 20px;
          font-size: 16px;
          width: 100%;
          max-width: 100%;
          box-sizing: border-box;
        }
        
        .result-content {
          padding: 12px;
          max-width: 100%;
          overflow-x: hidden;
          word-wrap: break-word;
        }
        
        .result-header h3 {
          font-size: 18px;
          max-width: 100%;
          overflow-x: hidden;
          word-wrap: break-word;
        }
        
        .result-body {
          font-size: 14px;
          line-height: 1.6;
          max-width: 100%;
          overflow-x: hidden;
          word-wrap: break-word;
        }
        
        .result-actions {
          flex-direction: column;
          gap: 8px;
          max-width: 100%;
        }
        
        .save-btn, .regenerate-btn {
          padding: 10px 16px;
          font-size: 14px;
          width: 100%;
          max-width: 100%;
          box-sizing: border-box;
        }
        
        /* AIé¡§å•æ‰‹æ©Ÿç‰ˆ */
        .mode2-container {
          padding: 16px;
          padding-top: 50px;
        }
        
        /* æ‰‹æ©Ÿç‰ˆèªªæ˜æŒ‰éˆ• */
        .instructions-toggle-btn {
          top: 80px;
          right: 16px;
          padding: 6px 12px;
          font-size: 13px;
        }
        
        .btn-text {
          font-size: 12px;
        }
        
        /* æ‰‹æ©Ÿç‰ˆæŠ½å±œèƒŒæ™¯é®ç½© */
        .drawer-overlay {
          z-index: 999;
        }
        
        /* æ‰‹æ©Ÿç‰ˆèªªæ˜æŠ½å±œ */
        .instructions-drawer {
          width: 100%;
          right: -100%;
          top: 70px;
          height: calc(100vh - 70px);
        }
        
        .drawer-header {
          padding: 16px;
        }
        
        .drawer-header h3 {
          font-size: 16px;
        }
        
        .drawer-content {
          padding: 16px;
        }
        
        .drawer-content p {
          font-size: 13px;
          margin-bottom: 12px;
        }
        
        .ai-instructions {
          margin-bottom: 20px;
        }
        
        .instructions-header {
          padding: 16px;
        }
        
        .instructions-header h3 {
          font-size: 16px;
        }
        
        .instruction-list {
          padding: 16px;
        }
        
        .instruction-list li {
          font-size: 14px;
          margin-bottom: 8px;
        }
        
        .chat-container {
          height: calc(100vh - 80px - 80px);
          min-height: 500px;
          display: flex !important;
          flex-direction: column !important;
          overflow: hidden !important;
          margin-bottom: 0;
          margin-top: 10px !important;
          position: fixed !important;
          top: 80px !important;
          left: 0 !important;
          right: 0 !important;
          z-index: 100 !important;
        }
        
        #chatContainer {
          display: flex !important;
          flex-direction: column !important;
          flex: 1 !important;
          height: 100% !important;
          overflow: visible !important;
        }
        
        .chat-messages {
          padding: 16px;
          flex: 1;
          overflow-y: auto;
          height: calc(100vh - 160px); /* ç°¡åŒ–é«˜åº¦è¨ˆç®— */
          min-height: 400px;
          max-height: calc(100vh - 160px);
          -webkit-overflow-scrolling: touch;
          scroll-behavior: smooth;
          overscroll-behavior: contain;
        }
        
        .message {
          margin-bottom: 16px;
          max-width: 85%;
        }
        
        .message.user {
          margin-left: auto;
        }
        
        .message-content {
          padding: 12px 16px;
          font-size: 14px;
          line-height: 1.5;
        }
        
        .chat-input-container {
          padding: 16px;
          flex-direction: column;
          gap: 12px;
        }
        
        .chat-input {
          width: 100%;
          padding: 12px 16px;
          font-size: 16px;
          border-radius: 25px;
        }
        
        .send-btn {
          padding: 12px 24px;
          font-size: 16px;
          border-radius: 25px;
          width: 100%;
        }
        
        /* AIé¡§å•æ¨¡å¼çš„è¼¸å…¥å€åŸŸæ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        .input-row {
          padding: 16px !important;
          flex-direction: column !important;
          gap: 12px !important;
          display: flex !important;
          border-top: 1px solid #e5e7eb !important;
          background: #f7f7f8 !important;
          border-radius: 0 !important;
          flex-shrink: 0 !important;
          position: sticky !important;
          bottom: 0 !important;
          z-index: 100 !important;
          visibility: visible !important;
          opacity: 1 !important;
          height: auto !important;
          min-height: auto !important;
          margin: 0 !important;
        }
        
        .input-row textarea {
          width: 100% !important;
          padding: 12px 16px !important;
          font-size: 16px !important;
          border-radius: 25px !important;
          resize: none !important;
          border: 1px solid #d1d5db !important;
          height: 44px !important; /* å›ºå®šé«˜åº¦èˆ‡é€å‡ºæŒ‰éˆ•ä¸€è‡´ */
          min-height: 44px !important;
          max-height: 44px !important; /* é™åˆ¶æœ€å¤§é«˜åº¦èˆ‡æœ€å°é«˜åº¦ä¸€è‡´ */
          line-height: 1.2 !important; /* èª¿æ•´è¡Œé«˜ç¢ºä¿æ–‡å­—å‚ç›´å±…ä¸­ */
        }
        
        .input-row .send-btn {
          padding: 12px 24px !important;
          font-size: 16px !important;
          border-radius: 25px !important;
          width: 100% !important;
          background: #3b82f6 !important;
          color: white !important;
          border: none !important;
        }
        
        .quick-buttons {
          display: flex !important;
          flex-direction: column !important;
          gap: 8px !important;
          padding: 16px !important;
          background: transparent !important;
          border: none !important;
          flex-shrink: 0 !important;
          position: relative !important;
          z-index: 10 !important;
          visibility: visible !important;
          opacity: 1 !important;
          height: auto !important;
          min-height: 60px !important;
          margin: 0 !important;
        }
        
        /* å¼·åˆ¶é¡¯ç¤ºAIé¡§å•æ¨¡å¼çš„å¿«é€ŸæŒ‰éˆ•å’Œè¼¸å…¥å€åŸŸ */
        .mode2 .quick-buttons,
        .mode2 .input-row {
          display: flex !important;
          visibility: visible !important;
          opacity: 1 !important;
          height: auto !important;
          position: relative !important;
          z-index: 100 !important;
        }
        
        .mode2 .quick-buttons {
          min-height: auto !important;
          background: transparent !important;
          border: none !important;
          padding: 0 !important;
          flex-direction: row !important;
          gap: 8px !important;
          margin-bottom: 12px !important;
          position: relative !important;
          bottom: auto !important;
          left: auto !important;
          right: auto !important;
          z-index: auto !important;
          flex-wrap: wrap !important;
          justify-content: flex-start !important;
          height: auto !important;
          display: flex !important;
        }
        
        /* æ‰‹æ©Ÿç‰ˆå¿«é€ŸæŒ‰éˆ•æ–‡å­—å°é½Šèª¿æ•´ */
        .mode2 .quick-btn {
          text-align: left !important; /* å¼·åˆ¶æ–‡å­—å·¦å°é½Š */
          padding: 8px 12px !important; /* èª¿æ•´å·¦å³paddingï¼Œå·¦é‚Šå°‘ä¸€é» */
        }
        
        /* æ‰‹æ©Ÿç‰ˆMode2é é¢å›ºå®šè¨­è¨ˆ - é˜²æ­¢å·¦å³æ»‘å‹• */
        .mode2 {
          width: 100% !important;
          max-width: 100vw !important;
          overflow-x: hidden !important;
          box-sizing: border-box !important;
        }
        
      .mode2-page {
        width: 100% !important;
        max-width: 100vw !important;
        overflow-x: hidden !important;
        box-sizing: border-box !important;
        margin: 0 !important;
        padding: 0 !important;
        display: flex !important;
        flex-direction: column !important;
      }
        
        .mode2 #chatMessages {
          width: 100% !important;
          max-width: 100% !important;
          overflow-x: hidden !important;
          box-sizing: border-box !important;
        }
        
        .mode2 .message {
          width: 100% !important;
          max-width: 100% !important;
          overflow-x: hidden !important;
          box-sizing: border-box !important;
          position: relative !important;
          z-index: 1 !important;
        }
        
        .mode2 .message-content {
          width: 100% !important;
          max-width: 90% !important;
          overflow-x: hidden !important;
          box-sizing: border-box !important;
        }
        
        /* ç¢ºä¿ç”¨æˆ¶è¨Šæ¯æ–‡å­—å¯è¦‹ */
        .mode2 .message.user {
          position: relative !important;
          z-index: 10 !important;
        }
        
        .mode2 .message.user .message-content {
          color: #000000 !important;
          background: #dbeafe !important;
          font-size: 14px !important;
          line-height: 1.5 !important;
          min-width: 200px !important;
          position: relative !important;
          z-index: 11 !important;
        }
        
        /* ç¢ºä¿AIè¨Šæ¯æ–‡å­—å¯è¦‹ */
        .mode2 .message.ai {
          position: relative !important;
          z-index: 5 !important;
        }
        
        .mode2 .message.ai .message-content {
          color: #0c4a6e !important;
          background: #f0f9ff !important;
          font-size: 14px !important;
          line-height: 1.5 !important;
          position: relative !important;
          z-index: 6 !important;
        }
        
        .mode2 .input-row {
          min-height: auto !important;
          background: transparent !important;
          border: none !important;
          padding: 12px 16px !important;
          flex-direction: column !important;
          gap: 0 !important;
          position: fixed !important;
          bottom: 80px !important;
          left: 16px !important;
          right: 16px !important;
          z-index: 1001 !important;
          box-shadow: none !important;
          margin: 0 !important;
          height: auto !important; /* å®Œå…¨è‡ªé©æ‡‰é«˜åº¦ */
          border-radius: 0 !important;
          max-height: none !important; /* ç§»é™¤æœ€å¤§é«˜åº¦é™åˆ¶ */
        }
        
        .mode2 .input-container {
          flex-direction: row !important;
          gap: 8px !important;
          align-items: flex-end !important;
        }
        
        .mode2 .input-container button {
          width: auto !important;
          min-width: 80px !important;
          flex-shrink: 0 !important;
        }
        
        .mode2 .input-container textarea {
          height: 44px !important; /* å›ºå®šé«˜åº¦èˆ‡é€å‡ºæŒ‰éˆ•ä¸€è‡´ */
          min-height: 44px !important;
          max-height: 44px !important; /* é™åˆ¶æœ€å¤§é«˜åº¦èˆ‡æœ€å°é«˜åº¦ä¸€è‡´ */
          resize: none !important; /* ç¦æ­¢èª¿æ•´å¤§å°ä¿æŒå›ºå®šé«˜åº¦ */
          line-height: 1.2 !important; /* èª¿æ•´è¡Œé«˜ç¢ºä¿æ–‡å­—å‚ç›´å±…ä¸­ */
        }
        
        /* å‰µä½œè€…è³‡æ–™åº«æ‰‹æ©Ÿç‰ˆ */
        .user-db-page {
          padding: 16px;
          padding-top: 50px;
          max-width: 100%;
          overflow-x: hidden;
        }
        
        .user-db-container {
          flex-direction: column;
          max-width: 100%;
          overflow-x: hidden;
        }
        
        .user-db-sidebar {
          width: 100%;
          margin-bottom: 20px;
          border-radius: 12px;
          max-width: 100%;
        }
        
        .user-db-content {
          width: 100%;
          max-width: 100%;
          overflow-x: hidden;
        }
        
        /* å€‹äººè³‡æ–™å¡ç‰‡æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        .db-section {
          max-width: 100%;
          overflow-x: hidden;
        }
        
        .section-content {
          max-width: 100%;
          overflow-x: hidden;
          word-wrap: break-word;
        }
        
        .user-info-detail {
          max-width: 100%;
          overflow-x: hidden;
          width: 100%;
          padding: 20px;
        }
        
        .info-item {
          max-width: 100%;
          overflow-x: hidden;
          white-space: nowrap;
          display: flex;
          align-items: center;
        }
        
        .info-item label {
          flex-shrink: 0;
          margin-right: 8px;
        }
        
        .info-item span {
          flex: 1;
          overflow: hidden;
          text-overflow: ellipsis;
        }
        
        /* å¼·åˆ¶é˜²æ­¢è³‡æ–™åº«é é¢æ°´å¹³æ»¾å‹• */
        #userDB {
          overflow-x: hidden !important;
          max-width: 100vw !important;
        }
        
        .user-db-page * {
          box-sizing: border-box !important;
        }
        
        .user-db-page input,
        .user-db-page span,
        .user-db-page div {
          max-width: 100% !important;
          overflow-x: hidden !important;
        }
        
        .user-db-page .info-item {
          white-space: nowrap !important;
          display: flex !important;
          align-items: center !important;
        }
        
        .user-db-page .info-item span {
          text-overflow: ellipsis !important;
          overflow: hidden !important;
        }
        
        /* å¼·åˆ¶æ‹‰é•·å€‹äººè³‡æ–™ç°åº•å¯¬åº¦ */
        .user-db-page .user-info-detail {
          width: 100% !important;
          max-width: 100% !important;
          padding: 50px !important;
          margin: 0 !important;
        }
        
        .user-db-page .section-content {
          width: 100% !important;
          max-width: 100% !important;
          padding: 0 !important;
        }
        
        .user-db-page .db-section {
          width: 100% !important;
          max-width: 100% !important;
        }
        
        /* å€‹äººè³‡æ–™ç°åº•å¯¬åº¦æ‰‹æ©Ÿç‰ˆ */
        .user-db-page .detail-item {
          width: 100% !important;
          max-width: 100% !important;
          padding: 16px !important;
        }
        
        .user-db-page .profile-details {
          width: 100% !important;
          max-width: 100% !important;
        }
        
        .sidebar-header {
          padding: 16px;
        }
        
        .user-profile {
          flex-direction: column;
          text-align: center;
          gap: 12px;
        }
        
        .profile-avatar {
          width: 60px;
          height: 60px;
        }
        
        .profile-info h3 {
          font-size: 18px;
        }
        
        .profile-info p {
          font-size: 14px;
        }
        
        .sidebar-menu {
          padding: 16px;
        }
        
        .menu-item {
          padding: 12px 16px;
          margin-bottom: 8px;
          border-radius: 8px;
        }
        
        .menu-text {
          font-size: 14px;
        }
        
        .user-db-content {
          width: 100%;
        }
        
        .db-section {
          padding: 16px;
        }
        
        .section-title {
          font-size: 18px;
          margin-bottom: 16px;
        }
        
        /* è…³æœ¬è¡¨æ ¼æ‰‹æ©Ÿç‰ˆ */
        .script-table {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }
        
        .script-table table {
          min-width: 600px;
          font-size: 12px;
        }
        
        .script-table th,
        .script-table td {
          padding: 8px 6px;
          white-space: nowrap;
        }
        
        .script-actions {
          flex-direction: column;
          gap: 8px;
        }
        
        .action-btn {
          padding: 10px 16px;
          font-size: 14px;
          width: 100%;
        }
        
        /* ç”¨æˆ¶æŠ½å±œæ‰‹æ©Ÿç‰ˆ */
        .user-drawer {
          width: 100%;
          max-width: 100vw;
          right: 0;
          border-radius: 0;
        }
        
        .user-drawer-header {
          padding: 20px 16px;
          padding-top: calc(20px + var(--safe-area-inset-top));
        }
        
        .user-drawer-content {
          padding: 16px;
        }
        
        .drawer-section h3 {
          font-size: 16px;
          margin-bottom: 12px;
        }
        
        .drawer-section p {
          font-size: 14px;
          margin-bottom: 8px;
        }
        
        /* åº•éƒ¨å°èˆªæ¬„ï¼ˆæ‰‹æ©Ÿç‰ˆå°ˆç”¨ï¼‰ */
        .bottom-navbar {
          display: flex !important;
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          background: white;
          border-top: 1px solid #e5e7eb;
          padding: 8px 0;
          padding-bottom: calc(8px + var(--safe-area-inset-bottom));
          z-index: 1000;
        }
        
        .bottom-nav-item {
          flex: 1;
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 8px 4px;
          text-decoration: none;
          color: #6b7280;
          font-size: 12px;
          transition: color 0.2s;
        }
        
        .bottom-nav-item.active {
          color: #3b82f6;
        }
        
        .bottom-nav-item span {
          margin-top: 4px;
        }
        
        /* éš±è—æ¡Œé¢ç‰ˆå°èˆª */
        .navbar-tabs {
          display: none;
        }
      }
      
      /* è¶…å°è¢å¹•æ‰‹æ©Ÿ */
      @media (max-width: 480px) {
        .homepage-title {
          font-size: 20px;
        }
        
        .homepage-subtitle {
          font-size: 14px;
        }
        
        .mode-card {
          padding: 20px 16px;
        }
        
        .mode-card h3 {
          font-size: 18px;
        }
        
        .mode-card p {
          font-size: 13px;
        }
        
        .chat-container {
          height: calc(100vh - 180px);
        }
        
        .script-table table {
          font-size: 11px;
        }
        
        .script-table th,
        .script-table td {
          padding: 6px 4px;
        }
      }
      
      /* iOS Safari ç‰¹æ®Šè™•ç† */
      @supports (-webkit-touch-callout: none) {
        .chat-container {
          height: calc(100vh - 220px);
          height: calc(100dvh - 220px);
        }
        
        .main-content {
          min-height: calc(100vh - 60px);
          min-height: calc(100dvh - 60px);
        }
        
        .app-container {
          min-height: 100vh;
          min-height: 100dvh;
        }
      }
      
      /* ç™»å…¥é é¢æ¨£å¼ */
      .login-page {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #ffffff;
        background-image: 
          radial-gradient(circle at 20% 20%, rgba(0, 0, 0, 0.1) 1px, transparent 1px),
          radial-gradient(circle at 40% 40%, rgba(0, 0, 0, 0.08) 1px, transparent 1px),
          radial-gradient(circle at 60% 60%, rgba(0, 0, 0, 0.06) 1px, transparent 1px),
          radial-gradient(circle at 80% 80%, rgba(0, 0, 0, 0.1) 1px, transparent 1px),
          radial-gradient(circle at 30% 70%, rgba(0, 0, 0, 0.05) 1px, transparent 1px),
          radial-gradient(circle at 70% 30%, rgba(0, 0, 0, 0.07) 1px, transparent 1px);
        background-size: 50px 50px, 60px 60px, 40px 40px, 70px 70px, 30px 30px, 80px 80px;
        animation: starField 15s linear infinite;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        overflow: hidden;
      }
      
      /* æ˜Ÿæ˜Ÿå‹•ç•« */
      @keyframes starField {
        0% {
          background-position: 0% 0%, 0% 0%, 0% 0%, 0% 0%, 0% 0%;
        }
        25% {
          background-position: 25% 25%, 25% 25%, 25% 25%, 25% 25%, 25% 25%;
        }
        50% {
          background-position: 50% 50%, 50% 50%, 50% 50%, 50% 50%, 50% 50%;
        }
        75% {
          background-position: 75% 75%, 75% 75%, 75% 75%, 75% 75%, 75% 75%;
        }
        100% {
          background-position: 100% 100%, 100% 100%, 100% 100%, 100% 100%, 100% 100%;
        }
      }
      
      /* ç™»å…¥å®¹å™¨å‹•ç•« */
      .login-container {
        background: white;
        border-radius: 16px;
        padding: 40px;
        border: 2px solid #e5e7eb;
        box-shadow: 
          0 25px 50px -12px rgba(0, 0, 0, 0.25),
          0 0 0 1px rgba(255, 255, 255, 0.8),
          inset 0 1px 0 rgba(255, 255, 255, 0.9),
          inset 0 -1px 0 rgba(0, 0, 0, 0.05);
        max-width: 400px;
        width: 90%;
        text-align: center;
        animation: fadeInUp 0.8s ease-out;
        position: relative;
        overflow: hidden;
      }
      
      .login-container:hover {
        transform: translateY(-2px);
        box-shadow: 
          0 32px 64px -12px rgba(0, 0, 0, 0.35),
          0 0 0 1px rgba(255, 255, 255, 0.9),
          inset 0 1px 0 rgba(255, 255, 255, 0.95),
          inset 0 -1px 0 rgba(0, 0, 0, 0.08);
        border-color: #d1d5db;
        transition: all 0.3s ease;
      }
      
      .login-container::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(59, 130, 246, 0.03), transparent);
        animation: shimmer 3s ease-in-out infinite;
        pointer-events: none;
      }
      
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      @keyframes shimmer {
        0% {
          transform: translateX(-100%) translateY(-100%) rotate(45deg);
        }
        100% {
          transform: translateX(100%) translateY(100%) rotate(45deg);
        }
      }
      
      .login-header {
        margin-bottom: 32px;
      }
      
      .login-title {
        font-size: 35px;
        font-weight: bold;
        color: #1f2937;
        margin: 0 0 8px 0;
        animation: titleGlow 2s ease-in-out infinite alternate;
      }
      
      @keyframes titleGlow {
        from {
          text-shadow: 0 0 5px rgba(59, 130, 246, 0.3);
        }
        to {
          text-shadow: 0 0 20px rgba(59, 130, 246, 0.6), 0 0 30px rgba(59, 130, 246, 0.4);
        }
      }
      
      .login-subtitle {
        font-size: 16px;
        color: #6b7280;
        margin: 0 0 16px 0;
      }
      
      .login-prompt {
        font-size: 14px;
        color: #9ca3af;
        margin: 0;
      }
      
      .login-buttons {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 24px;
      }
      
      .login-btn {
        padding: 12px 24px;
        border-radius: 8px;
        border: none;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      
      .skip-btn {
        background: #fbbf24;
        color: #1f2937;
      }
      
      .skip-btn:hover {
        background: #f59e0b;
      }
      
      .google-btn {
        background: #3b82f6;
        color: white;
        border: 2px solid #1d4ed8;
        box-shadow: 
          0 4px 8px rgba(0, 0, 0, 0.15),
          inset 0 1px 0 rgba(255, 255, 255, 0.2),
          inset 0 -1px 0 rgba(0, 0, 0, 0.1);
      }
      
      .google-btn:hover {
        background: #2563eb;
        border-color: #1e40af;
        transform: translateY(-2px);
        box-shadow: 
          0 8px 25px -5px rgba(59, 130, 246, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.3),
          inset 0 -1px 0 rgba(0, 0, 0, 0.15);
      }
      
      .google-btn:active {
        transform: translateY(0);
        background: #1d4ed8;
        border-color: #1e3a8a;
        box-shadow: 
          0 2px 4px rgba(0, 0, 0, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.1),
          inset 0 -1px 0 rgba(0, 0, 0, 0.2);
      }
      
      .line-btn {
        background: #f3f4f6;
        color: #9ca3af;
        cursor: not-allowed;
      }
      
      .google-icon, .line-icon {
        width: 18px;
        height: 18px;
      }
      
      .login-note {
        font-size: 12px;
        color: #9ca3af;
        margin: 0 0 24px 0;
      }
      
      .language-selector {
        display: flex;
        gap: 8px;
        justify-content: center;
      }
      
      .lang-btn {
        padding: 8px 16px;
        border-radius: 20px;
        border: 1px solid #d1d5db;
        background: white;
        color: #6b7280;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .lang-btn.active {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }
      
      .lang-btn:hover:not(.active) {
        background: #f9fafb;
      }
      
      /* æ‰‹æ©Ÿç‰ˆç™»å…¥é é¢ */
      @media (max-width: 768px) {
        .login-container {
          padding: 32px 24px;
          margin: 16px;
        }
        
        /* æ‰‹æ©Ÿç‰ˆéš±è—ç™»å‡ºæŒ‰éˆ• */
        .logout-btn {
          display: none !important;
        }
        
        /* é˜²æ­¢æ•´å€‹é é¢æ°´å¹³æ»¾å‹• */
        body {
          overflow-x: hidden !important;
        }
        
        .main-content {
          overflow-x: hidden !important;
        }
        
        /* ä¸€éµç”Ÿæˆæ¨¡å¼é˜²æ­¢æ°´å¹³æ»¾å‹• */
        #mode1 {
          overflow-x: hidden !important;
          max-width: 100vw !important;
        }
        
        .mode1-page {
          overflow-x: hidden !important;
          max-width: 100% !important;
        }
        
        .mode1-left,
        .mode1-right {
          overflow-x: hidden !important;
          word-wrap: break-word !important;
        }
        
        .login-title {
          font-size: 30px;
        }
        
        .login-subtitle {
          font-size: 14px;
        }
        
        .login-btn {
          padding: 14px 20px;
          font-size: 15px;
        }
      }
    </style>
  </head>
  <body data-subscribed="false">
    <!-- ç™»å…¥é é¢ -->
    <div id="loginPage" class="login-page">
      <div class="login-container">
        <div class="login-header">
          <h1 class="login-title">ReelMind</h1>
          <p class="login-subtitle">è®“ä½ çš„çŸ­å½±éŸ³ä¸å†é é‹æ°£ï¼Œè€Œé ç­–ç•¥ã€‚<br>AI çŸ­å½±éŸ³é¡§å•ï¼Œå¹«ä½ ç²¾æº–å®šä½ã€å¿«é€Ÿç”Ÿæˆã€‚</p>
        </div>
        
        <div class="login-buttons">
          <button class="login-btn google-btn" onclick="login()">
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOCAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE3LjY0IDkuMjA0NTVDMTcuNjQgOC41NjY0MSAxNy41ODI3IDcuOTUyMjcgMTcuNDc3MyA3LjM2MzY0SDkuMTgzNjRWMTAuODQ1NUgxMy44NDA5QzEzLjYzNjQgMTIuMzI1IDEyLjgxODIgMTMuNTU0NSAxMS42MzY0IDE0LjM0NTVDMTEuNjM2NCAxNC4zNDU1IDExLjYzNjQgMTQuMzQ1NSAxMS42MzY0IDE0LjM0NTVMMTMuNDU0NSAxNS45OTU1QzE0LjkwOTEgMTQuNjU0NSAxNy42NCAxMi4zMjUgMTcuNjQgOS4yMDQ1NVoiIGZpbGw9IjQyODVGNCIvPgo8cGF0aCBkPSJNOS4xODM2NCAxOC4wMDAyQzExLjQzMTggMTguMDAwMiAxMy4yNzI3IDE3LjI3MjcgMTQuNjM2NCAxNi4wOTU1TDEyLjgxODIgMTQuNDQ1NUMxMi4wOTU1IDE1LjAwOTEgMTEuMTU0NSAxNS40MzE4IDEwLjAwOTEgMTUuNDMxOEM3Ljc0NTQ1IDE1LjQzMTggNS44NDU0NSAxMy45NTQ1IDUuMTU0NTUgMTEuOTU0NUwzLjI3MjczIDEzLjU0NTVDNC42MzYzNiAxNi4wOTU1IDYuNzI3MjcgMTguMDAwMiA5LjE4MzY0IDE4LjAwMDJaIiBmaWxsPSIzNEE4NTMiLz4KPHBhdGggZD0iTTMuMjcyNzMgMTEuOTU0NUMzLjAwOTA5IDExLjE4MTggMi44NzI3MyAxMC4zNjM2IDIuODcyNzMgOS41MDAwMkMyLjg3MjczIDguNjM2MzYgMy4wMDkwOSA3LjgxODE4IDMuMjcyNzMgNy4wNDU0NUw1LjE1NDU1IDguNjM2MzZDNC45NTQ1NSA5LjM2MzY0IDQuODcyNzMgMTAuMTM2NCA0Ljg3MjczIDEwLjk1NDVDNC44NzI3MyAxMS43NzI3IDQuOTU0NTUgMTIuNTQ1NSAzLjI3MjczIDEzLjU0NTVMMy4yNzI3MyAxMS45NTQ1WiIgZmlsbD0iRkJCQzA0Ii8+CjxwYXRoIGQ9Ik05LjE4MzY0IDMuNTY4MThDMTEuMTU0NSAzLjU2ODE4IDEyLjYzNjQgNC4zNDA5MSAxMy40NTQ1IDUuMDQ1NDVMMTQuNjM2NCAzLjkwOTA5QzEzLjI3MjcgMi42MzYzNiAxMS40MzE4IDEuOTk5OTggOS4xODM2NCAxLjk5OTk4QzYuNzI3MjcgMS45OTk5OCA0LjYzNjM2IDMuOTA5MDkgMy4yNzI3MyA2LjQ1OTA5TDUuMTU0NTUgOC4wNDU0NUM1Ljg0NTQ1IDYuMDQ1NDUgNy43NDU0NSA0LjU2ODE4IDkuMTgzNjQgMy41NjgxOFoiIGZpbGw9IjM0QTg1MyIvPgo8L3N2Zz4K" alt="Google" class="google-icon">
            ä½¿ç”¨ Google ç™»å…¥
          </button>
          <p class="login-prompt">è«‹ç™»å…¥ä»¥ç¹¼çºŒ</p>
        </div>
      </div>
    </div>

    <!-- ä¸»æ‡‰ç”¨ç¨‹å¼å®¹å™¨ -->
    <div id="appContainer" class="app-container" style="display: none;">
      <!-- ä¸»å…§å®¹å€åŸŸ -->
      <div class="main-content" id="mainContent">
        <!-- é ‚éƒ¨å°èˆªæ¬„ -->
        <div class="top-navbar">
          <div class="navbar-left">
            <!-- æ‰‹æ©Ÿç‰ˆæŠ½å±œæŒ‰éˆ• -->
            <button class="mobile-drawer-toggle" onclick="toggleMobileDrawer()">
              <span class="hamburger-icon">â˜°</span>
            </button>
            <div class="navbar-title clickable-title" onclick="switchPage('homepage')">ReelMind</div>
            <div class="navbar-tabs">
              <a href="#homepage" class="navbar-tab" onclick="switchPage('homepage'); return false;">é¦–é </a>
              <a href="#mode1" class="navbar-tab" onclick="switchPage('mode1'); return false;">ä¸€éµç”Ÿæˆ</a>
              <a href="#mode2" class="navbar-tab" onclick="switchPage('mode2'); return false;">AIé¡§å•</a>
              <a href="#mode3" class="navbar-tab" onclick="switchPage('mode3'); return false;">IPäººè¨­è¦åŠƒ</a>
              <a href="#forum" class="navbar-tab" onclick="switchPage('forum'); return false;">è«–å£‡ä»‹ç´¹</a>
              <a href="#guide" class="navbar-tab" onclick="switchPage('guide'); return false;">å¯¦æˆ°æŒ‡å—</a>
              <a href="#userDB" id="userDBTab" class="navbar-tab" onclick="switchPage('userDB'); return false;" style="display:none;">å‰µä½œè€…è³‡æ–™åº«</a>
            </div>
          </div>
          <div class="navbar-right">
            <div class="user-info" id="userInfo" style="display: none;" onclick="switchPage('userDB')">
              <img id="userAvatar" class="user-avatar" src="" alt="ç”¨æˆ¶é ­åƒ" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; object-position: center;">
            <span id="userName" class="user-name"></span>
          </div>
          <div class="auth-buttons" style="display: none;">
              <button id="loginBtn" class="login-btn" onclick="goToLogin()" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ” ç™»å…¥</button>
          </div>
        </div>
      </div>

        <!-- é é¢å…§å®¹å€åŸŸ -->
        <div class="page-content">
          <!-- é¦–é  -->
          <div id="homepage" class="page active">
            <div class="homepage">
              <!-- Hero Section: ç™½ï¼‹è—å†·ç³»ï½œæ»¿ç‰ˆå…¨å‡ºè¡€ -->
              <section class="rm-hero" style="background: #F8FAFC; position: relative; overflow: hidden; padding: 80px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw;">
                <!-- èƒŒæ™¯æ·¡è—å…‰æšˆ -->
                <div style="position: absolute; top: -100px; right: 0; width: 800px; height: 800px; background: radial-gradient(circle at 80% 20%, rgba(59,130,246,0.10), transparent 60%); pointer-events: none;"></div>
                
                <div class="rm-hero-container" style="max-width: 1400px; margin: 0 auto; padding: 0 16px; position: relative; z-index: 1;">
                  <div class="rm-hero-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 60px; align-items: center;">
                    
                    <!-- å·¦å´ï¼šæ–‡æ¡ˆå€ -->
                    <div style="padding: 20px 0;">
                      <h1 class="rm-hero-title" style="font-size: clamp(2rem, 5vw, 3.5rem); font-weight: 900; color: #1E293B; margin-bottom: 20px; line-height: 1.2; letter-spacing: -0.02em;">
                        è®“ AI å¹«ä½ æ‰“é€ <br/>ä¸‹ä¸€æ”¯çˆ†æ¬¾çŸ­å½±éŸ³
                      </h1>
                      <p style="font-size: clamp(1rem, 2vw, 1.25rem); color: #64748B; margin-bottom: 32px; line-height: 1.7;">
                        AI ç”Ÿæˆè…³æœ¬ã€AI å¸³è™Ÿå®šä½ï¼Œä¸€æ¬¡å®Œæˆã€‚<br/>
                        <span style="font-size: 0.9em; color: #94A3B8;">ä»˜è²»å³ä½¿ç”¨ï¼Œç„¡å…è²»é«”é©—ã€‚</span>
                      </p>
                      <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 24px;">
                        <a href="#" onclick="goToPricing(); return false;" style="padding: 16px 24px; background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); color: white; border-radius: 12px; font-weight: 700; text-decoration: none; box-shadow: 0 4px 20px rgba(59,130,246,0.25); transition: all 0.3s; font-size: 0.9rem; min-height: 48px; display: inline-flex; align-items: center; justify-content: center; flex: 1;">
                          ç«‹å³å•Ÿç”¨<br>AI æ™ºèƒ½é«”
                        </a>
                        <a href="#rm-overview-v2" onclick="smoothScrollTo('rm-overview-v2'); return false;" style="padding: 16px 24px; background: white; color: #2563EB; border: 2px solid #2563EB; border-radius: 12px; font-weight: 600; text-decoration: none; transition: all 0.3s; font-size: 0.9rem; min-height: 48px; display: inline-flex; align-items: center; justify-content: center; flex: 1;">
                          äº†è§£ä½¿ç”¨æ–¹å¼
                        </a>
                      </div>
                    </div>
                    
                    <!-- å³å´ï¼šå½±ç‰‡é è¦½ -->
                    <div style="position: relative;">
                      <div style="aspect-ratio: 16/9; background: #E2E8F0; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05);">
                        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/@AgentAi" title="ReelMind Demo" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="display: block;"></iframe>
                      </div>
                    </div>
                    
                  </div>
                </div>
              </section>

              <!-- ä¸‰åŠŸèƒ½å¡å€ï¼ˆä¿ç•™åŸæœ‰ DOM èˆ‡äº‹ä»¶ï¼‰ -->

              <!-- æ•™å­¸æ–‡ç«  / å¯¦æˆ°æŒ‡å—å€ï¼ˆå–ä»£ã€Œç²¾å½©ä½œå“å±•ç¤ºã€ï¼‰-->
              <section class="rm-guide-section" style="background: #F8FAFC; padding: 100px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw;">
                <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px;">
                  <div style="text-align: center; margin-bottom: 60px;">
                    <h2 style="font-size: clamp(2rem, 4vw, 2.8rem); font-weight: 800; color: #1E293B; margin-bottom: 16px;"><i class="fas fa-book-open" style="margin-right: 10px;"></i>AI çŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—</h2>
                    <p style="font-size: 1.1rem; color: #64748B; max-width: 600px; margin: 0 auto;">å­¸ç¿’å¦‚ä½•ç”¨ AI æ‰“é€ çˆ†æ¬¾çŸ­å½±éŸ³å…§å®¹</p>
                  </div>
                  
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 32px; margin-top: 40px;">
                    <!-- æ–‡ç«  1 -->
                    <a onclick="switchPage('guide-article1'); return false;" style="text-decoration: none; display: block; cursor: pointer;">
                      <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; display: flex; flex-direction: column; height: 100%;">
                        <div style="padding: 32px; border-bottom: 1px solid #F1F5F9; flex: 1 1 auto;">
                          <div style="font-size: 1.25rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">ä¸‰æ­¥ç”Ÿæˆ 30 ç§’çŸ­å½±éŸ³è…³æœ¬</div>
                          <div style="font-size: 0.95rem; color: #64748B; line-height: 1.6;">
                            åªéœ€ä¸‰æ­¥ï¼šè¨­å®šå¹³å°èˆ‡ä¸»é¡Œã€AI ç”ŸæˆåŠ‡æœ¬å¤§ç¶±ã€ç¢ºèªä¸¦å„²å­˜ã€‚æœ¬æ•™å­¸å°‡ç¤ºç¯„å®Œæ•´æµç¨‹ï¼Œå¹«ä½ åœ¨ 5 åˆ†é˜å…§ç”¢å‡º Instagram Reels è…³æœ¬...
                          </div>
                        </div>
                        <div style="padding: 20px 32px; background: #F8FAFC;">
                          <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                        </div>
                      </div>
                    </a>
                    
                    <!-- æ–‡ç«  2 -->
                    <a onclick="switchPage('guide-article2'); return false;" style="text-decoration: none; display: block; cursor: pointer;">
                      <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; display: flex; flex-direction: column; height: 100%;">
                        <div style="padding: 32px; border-bottom: 1px solid #F1F5F9; flex: 1 1 auto;">
                          <div style="font-size: 1.25rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">AI å¸³è™Ÿå®šä½ï¼šå…§å®¹æ”¯æŸ±èˆ‡ 14 å¤©è¨ˆç•«</div>
                          <div style="font-size: 0.95rem; color: #64748B; line-height: 1.6;">
                            äº†è§£å¦‚ä½•ç”¨ AI åˆ†æä½ çš„å…§å®¹å®šä½ï¼Œä¸¦è‡ªå‹•ç”Ÿæˆ 14 å¤©ç™¼å¸ƒè¨ˆç•«ã€‚åŒ…å«å…§å®¹æ”¯æŸ±ï¼ˆæ•™è‚²ã€å¨›æ¨‚ã€å•Ÿç™¼ã€æˆäº¤ï¼‰èˆ‡æ’ç¨‹å»ºè­°...
                          </div>
                        </div>
                        <div style="padding: 20px 32px; background: #F8FAFC;">
                          <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                        </div>
                      </div>
                    </a>
                    
                    <!-- æ–‡ç«  3 -->
                    <a onclick="switchPage('guide-article3'); return false;" style="text-decoration: none; display: block; cursor: pointer;">
                      <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; display: flex; flex-direction: column; height: 100%;">
                        <div style="padding: 32px; border-bottom: 1px solid #F1F5F9; flex: 1 1 auto;">
                          <div style="font-size: 1.25rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">Reels / Shorts / TikTok<br>è…³æœ¬å·®ç•°</div>
                          <div style="font-size: 0.95rem; color: #64748B; line-height: 1.6;">
                            æ¯å€‹å¹³å°çš„çŸ­å½±éŸ³éƒ½æœ‰ä¸åŒç‰¹æ€§ï¼šIG Reels åé‡å“ç‰Œæ•˜äº‹ï¼ŒYouTube Shorts å¼·èª¿å¿«é€Ÿçˆ†é»ï¼ŒTikTok é‡è¦–å¨›æ¨‚æ€§ã€‚æœ¬æŒ‡å—è§£æ AI å¦‚ä½•è‡ªå‹•èª¿æ•´...
                          </div>
                        </div>
                        <div style="padding: 20px 32px; background: #F8FAFC;">
                          <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                        </div>
                      </div>
                    </a>
                  </div>
                </div>
              </section>

              <!-- ReelMind èƒ½ç‚ºä½ åšä»€éº¼ï¼Ÿå…¨æ–°è¨­è¨ˆç‰ˆ -->
              <section id="rm-overview-v2" style="background: white; padding: 100px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw; position: relative; overflow: hidden;">
                <!-- èƒŒæ™¯è£é£¾ -->
                <div style="position: absolute; inset: 0; background: linear-gradient(to bottom right, #EFF6FF, white, #F0FDF4); opacity: 0.5;"></div>
                <div style="position: absolute; top: 0; left: 0; width: 384px; height: 384px; background: #DBEAFE; border-radius: 50%; filter: blur(96px); opacity: 0.3;"></div>
                <div style="position: absolute; bottom: 0; right: 0; width: 384px; height: 384px; background: #D1FAE5; border-radius: 50%; filter: blur(96px); opacity: 0.3;"></div>
                
                <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px; position: relative; z-index: 10;">
                  <!-- æ¨™é¡Œå€ - å…¨æ–°è¨­è¨ˆ -->
                  <div class="text-center mb-16 md:mb-24">
                    <!-- æ¨™ç±¤å¾½ç«  -->
                    <div class="inline-flex items-center gap-2.5 px-6 py-3 mb-6 bg-gradient-to-r from-blue-50 to-emerald-50 border border-blue-100 rounded-full">
                      <span class="text-xl animate-pulse">âœ¨</span>
                      <span class="text-sm md:text-base font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-emerald-600">
                        å››é …æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸€ç«™å¼çŸ­å½±éŸ³å‰µä½œ
                      </span>
                    </div>
                    
                    <!-- ä¸»æ¨™é¡Œ -->
                    <h2 class="text-4xl md:text-5xl lg:text-6xl font-extrabold mb-6 bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 bg-clip-text text-transparent leading-tight">
                      ReelMind èƒ½ç‚ºä½ åšä»€éº¼ï¼Ÿ
                    </h2>
                    
                    <!-- å‰¯æ¨™é¡Œ -->
                    <p class="text-lg md:text-xl text-gray-600 max-w-4xl mx-auto leading-relaxed px-4">
                      ä»¥ <strong class="text-blue-600">AI é¡§å•å°è©±</strong>ã€<strong class="text-emerald-600">ä¸€éµç”Ÿæˆ</strong>èˆ‡ <strong class="text-purple-600">IP äººè¨­è¦åŠƒ</strong>ï¼Œå”åŠ©å°ç£å‰µä½œè€…å»ºç«‹é«˜æ•ˆç‡çš„çŸ­å½±éŸ³å…§å®¹ç³»çµ±ã€‚è®“æ¯æ¬¡å‰µä½œéƒ½æœ‰ç­–ç•¥ã€æ¯æ¬¡ç™¼å¸ƒéƒ½æœ‰è½‰æ›ã€‚
                    </p>
                    
                    <!-- è£é£¾ç·š -->
                    <div class="flex items-center justify-center gap-4 mt-8">
                      <div class="w-16 h-0.5 bg-gradient-to-r from-transparent to-blue-400"></div>
                      <div class="w-2 h-2 rounded-full bg-blue-500"></div>
                      <div class="w-24 h-0.5 bg-gradient-to-r from-blue-400 to-emerald-400"></div>
                      <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
                      <div class="w-16 h-0.5 bg-gradient-to-r from-emerald-400 to-transparent"></div>
                    </div>
                  </div>
                  
                  <!-- å››å¼µåŠŸèƒ½å¡ - å…¨æ–°ç¶²æ ¼è¨­è¨ˆ -->
                  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8 mb-16">
                    
                    <!-- å¡ç‰‡ 1: AI é¡§å• -->
                    <div class="group relative bg-white border-2 border-transparent hover:border-blue-200 rounded-3xl p-8 shadow-sm hover:shadow-2xl transition-all duration-500 hover:-translate-y-2 transform overflow-hidden">
                      <!-- èƒŒæ™¯å…‰æ•ˆ -->
                      <div class="absolute inset-0 bg-gradient-to-br from-blue-50/0 to-blue-50/100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                      
                      <!-- åœ–æ¨™å€ -->
                      <div class="relative z-10 flex items-center justify-center w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-blue-100 to-blue-200 rounded-2xl group-hover:scale-110 transition-transform duration-500">
                        <i class="fas fa-user-md text-4xl text-blue-600"></i>
                      </div>
                      
                      <!-- å…§å®¹å€ -->
                      <div class="relative z-10">
                        <!-- å°æ¨™ç±¤ -->
                        <div class="inline-block px-3 py-1 mb-4 bg-blue-100 text-blue-700 text-xs font-bold rounded-full">
                          AI é¡§å•
                        </div>
                        
                        <h3 class="text-xl font-bold text-gray-900 mb-3 leading-tight group-hover:text-blue-600 transition-colors">
                          å¾å•é¡Œåˆ°è§£æ³•
                        </h3>
                        
                        <p class="text-sm text-gray-600 mb-6 leading-relaxed">
                          èˆ‡ AI é¡§å•æ·±åº¦å°è©±ï¼Œé‡æ¸…ä½ çš„ç›®æ¨™ã€å—çœ¾ã€å…§å®¹æ–¹å‘èˆ‡è®Šç¾ç­–ç•¥ï¼›å³æ™‚çµ¦å‡ºå¯åŸ·è¡Œçš„ä¸‹ä¸€æ­¥ã€‚
                        </p>
                        
                        <!-- åˆ—è¡¨ -->
                        <ul class="space-y-3 mb-6">
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-blue-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">è¨ºæ–·ç—›é»èˆ‡ç›®æ¨™å°é½Šï¼ˆå°ç£å¸‚å ´èªæ°£ï¼‰</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-blue-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">æ‹†è§£å…§å®¹æ”¯æŸ±èˆ‡æµé‡ç¯€å¥</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-blue-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">ç”¢å‡ºå…·é«”è¡Œå‹•æ¸…å–®ï¼ˆä»Šå¤©å°±èƒ½åšï¼‰</span>
                          </li>
                        </ul>
                        
                        <!-- åº•éƒ¨é€£çµ -->
                        <div class="flex items-center gap-2 text-xs font-semibold text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                          <span>äº†è§£æ›´å¤š</span>
                          <span class="text-lg">â†’</span>
                        </div>
                      </div>
                    </div>
                    
                    <!-- å¡ç‰‡ 2: ä¸€éµç”Ÿæˆ -->
                    <div class="group relative bg-white border-2 border-transparent hover:border-emerald-200 rounded-3xl p-8 shadow-sm hover:shadow-2xl transition-all duration-500 hover:-translate-y-2 transform overflow-hidden">
                      <!-- èƒŒæ™¯å…‰æ•ˆ -->
                      <div class="absolute inset-0 bg-gradient-to-br from-emerald-50/0 to-emerald-50/100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                      
                      <!-- åœ–æ¨™å€ -->
                      <div class="relative z-10 flex items-center justify-center w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-emerald-100 to-emerald-200 rounded-2xl group-hover:scale-110 transition-transform duration-500">
                        <i class="fas fa-magic text-4xl text-emerald-600"></i>
                      </div>
                      
                      <!-- å…§å®¹å€ -->
                      <div class="relative z-10">
                        <!-- å°æ¨™ç±¤ -->
                        <div class="inline-block px-3 py-1 mb-4 bg-emerald-100 text-emerald-700 text-xs font-bold rounded-full">
                          ä¸€éµç”Ÿæˆ
                        </div>
                        
                        <h3 class="text-xl font-bold text-gray-900 mb-3 leading-tight group-hover:text-emerald-600 transition-colors">
                          ç›´æ¥å¯ç”¨çš„è…³æœ¬
                        </h3>
                        
                        <p class="text-sm text-gray-600 mb-6 leading-relaxed">
                          è¼¸å…¥å¹³å°èˆ‡ä¸»é¡Œï¼Œç«‹å³ç”¢å‡º<strong class="text-emerald-600">Hook é–‹å ´ã€å£æ’­æ–‡å­—ã€é¡é ­æŒ‡ç¤º</strong>èˆ‡ä¸Šç‰‡å»ºè­°ï¼›å¯é‡ç”Ÿç›´åˆ°æ»¿æ„ã€‚
                        </p>
                        
                        <!-- åˆ—è¡¨ -->
                        <ul class="space-y-3 mb-6">
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-emerald-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">60 ç§’å…§å®ŒæˆçŸ­å½±éŸ³è…³æœ¬</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-emerald-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">è‡ªå‹•é™„ CTA èˆ‡æƒ…ç·’ç¯€å¥</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-emerald-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">æ”¯æ´ IG / TikTok / Shorts è¦æ ¼</span>
                          </li>
                        </ul>
                        
                        <!-- åº•éƒ¨é€£çµ -->
                        <div class="flex items-center gap-2 text-xs font-semibold text-emerald-600 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                          <span>äº†è§£æ›´å¤š</span>
                          <span class="text-lg">â†’</span>
                        </div>
                      </div>
                    </div>
                    
                    <!-- å¡ç‰‡ 3: IP äººè¨­è¦åŠƒ -->
                    <div class="group relative bg-white border-2 border-transparent hover:border-purple-200 rounded-3xl p-8 shadow-sm hover:shadow-2xl transition-all duration-500 hover:-translate-y-2 transform overflow-hidden">
                      <!-- èƒŒæ™¯å…‰æ•ˆ -->
                      <div class="absolute inset-0 bg-gradient-to-br from-purple-50/0 to-purple-50/100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                      
                      <!-- åœ–æ¨™å€ -->
                      <div class="relative z-10 flex items-center justify-center w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-purple-100 to-purple-200 rounded-2xl group-hover:scale-110 transition-transform duration-500">
                        <i class="fas fa-id-card text-4xl text-purple-600"></i>
                      </div>
                      
                      <!-- å…§å®¹å€ -->
                      <div class="relative z-10">
                        <!-- å°æ¨™ç±¤ -->
                        <div class="inline-block px-3 py-1 mb-4 bg-purple-100 text-purple-700 text-xs font-bold rounded-full">
                          IP äººè¨­
                        </div>
                        
                        <h3 class="text-xl font-bold text-gray-900 mb-3 leading-tight group-hover:text-purple-600 transition-colors">
                          å»ºç«‹ä½ çš„å°ˆå±¬è²éŸ³
                        </h3>
                        
                        <p class="text-sm text-gray-600 mb-6 leading-relaxed">
                          é€éä¸€ç³»åˆ—è¨ªè«‡é¡Œï¼Œå»ºç«‹ IP Profileï¼ˆäººæ ¼ç‰¹è³ªã€èªæ°£è¨­å®šã€å…§å®¹é‚è¼¯ï¼‰ï¼Œä¸¦é™„ 14 å¤©å…§å®¹è¦åŠƒã€‚
                        </p>
                        
                        <!-- åˆ—è¡¨ -->
                        <ul class="space-y-3 mb-6">
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-purple-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">IP Profile + 14 å¤©è¦åŠƒ</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-purple-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">å“ç‰Œèªæ°£èˆ‡èªªè©±é¢¨æ ¼ç”Ÿæˆ</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-purple-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">å¯æŒçºŒå„ªåŒ–èˆ‡è¿­ä»£</span>
                          </li>
                        </ul>
                        
                        <!-- åº•éƒ¨é€£çµ -->
                        <div class="flex items-center gap-2 text-xs font-semibold text-purple-600 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                          <span>äº†è§£æ›´å¤š</span>
                          <span class="text-lg">â†’</span>
                        </div>
                      </div>
                    </div>
                    
                    <!-- å¡ç‰‡ 4: å‰µä½œè€…è³‡æ–™åº« -->
                    <div class="group relative bg-white border-2 border-transparent hover:border-orange-200 rounded-3xl p-8 shadow-sm hover:shadow-2xl transition-all duration-500 hover:-translate-y-2 transform overflow-hidden">
                      <!-- èƒŒæ™¯å…‰æ•ˆ -->
                      <div class="absolute inset-0 bg-gradient-to-br from-orange-50/0 to-orange-50/100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                      
                      <!-- åœ–æ¨™å€ -->
                      <div class="relative z-10 flex items-center justify-center w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-orange-100 to-orange-200 rounded-2xl group-hover:scale-110 transition-transform duration-500">
                        <i class="fas fa-database text-4xl text-orange-600"></i>
                      </div>
                      
                      <!-- å…§å®¹å€ -->
                      <div class="relative z-10">
                        <!-- å°æ¨™ç±¤ -->
                        <div class="inline-block px-3 py-1 mb-4 bg-orange-100 text-orange-700 text-xs font-bold rounded-full">
                          å‰µä½œè€…è³‡æ–™åº«
                        </div>
                        
                        <h3 class="text-xl font-bold text-gray-900 mb-3 leading-tight group-hover:text-orange-600 transition-colors">
                          ä½œå“æ•´åˆèˆ‡å†åˆ©ç”¨
                        </h3>
                        
                        <p class="text-sm text-gray-600 mb-6 leading-relaxed">
                          ä½ çš„æ¯ä¸€æ¬¡ç”Ÿæˆï¼ˆè…³æœ¬ã€é¸é¡Œã€å®šä½ï¼‰éƒ½æœƒè‡ªå‹•æ­¸æª”æ–¼å€‹äººè³‡æ–™åº«ï¼›æ”¯æ´ PDF / CSV ä¸‹è¼‰ã€ç‰ˆæœ¬é‡ç”Ÿèˆ‡æ¨™è¨»ã€‚
                        </p>
                        
                        <!-- åˆ—è¡¨ -->
                        <ul class="space-y-3 mb-6">
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-orange-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">æˆ‘çš„è…³æœ¬ï¼šåˆ†é¡ã€å£æ’­ã€CTA ä¸€æ¬¡çœ‹</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-orange-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">ä¸€éµä¸‹è¼‰ï¼ˆPDFï¼CSVï¼‰èˆ‡é‡ç”Ÿ</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-orange-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">å¯è¦–åŒ–æ¸…å–®ï¼Œæ–¹ä¾¿æ•´ç†èˆ‡å›é¡§</span>
                          </li>
                        </ul>
                        
                        <!-- åº•éƒ¨é€£çµ -->
                        <div class="flex items-center gap-2 text-xs font-semibold text-orange-600 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                          <span>äº†è§£æ›´å¤š</span>
                          <span class="text-lg">â†’</span>
                        </div>
                      </div>
                    </div>
                    
                  </div>
                  
                  <!-- åº•éƒ¨ CTA å€ - å…¨æ–°è¨­è¨ˆ -->
                  <div class="relative">
                    <div class="bg-gradient-to-r from-yellow-50 via-orange-50 to-yellow-50 rounded-3xl p-8 md:p-12 border-2 border-yellow-200 shadow-xl">
                      <!-- å»ºè­°æ–‡å­— -->
                      <div class="text-center mb-10">
                        <p class="text-base md:text-lg text-gray-800 mb-2">
                          <i class="fas fa-lightbulb text-2xl text-orange-600"></i>
                        </p>
                        <p class="text-base md:text-lg text-gray-800 font-medium">
                          <strong class="text-orange-700">å»ºè­°ä½¿ç”¨é †åºï¼š</strong>å…ˆåš IP äººè¨­ â†’ å–å¾— 14 å¤©è¦åŠƒ â†’ æ¯æ—¥ä½¿ç”¨ä¸€éµç”Ÿæˆã€‚AI æœƒè¨˜ä½ä½ ä¹‹å‰çš„å…§å®¹ä¸¦æŒçºŒå„ªåŒ–ã€‚
                        </p>
                      </div>
                      
                      <!-- CTA æŒ‰éˆ• -->
                      <div class="flex justify-center">
                        <a href="#" onclick="goToLogin(); return false;" class="group inline-flex items-center gap-4 px-10 md:px-14 py-5 md:py-6 bg-gradient-to-r from-orange-500 via-orange-500 to-yellow-500 text-white rounded-2xl font-bold text-lg md:text-xl shadow-lg hover:shadow-2xl hover:shadow-orange-500/50 hover:scale-105 transition-all duration-300 transform">
                          <i class="fas fa-lock-open text-2xl"></i>
                          <span>ç™»å…¥è§£é–ä½ çš„å°ˆå±¬ AI æ™ºèƒ½é«”</span>
                          <span class="text-3xl group-hover:translate-x-1 transition-transform">â†’</span>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </section>
              
              <h1 class="homepage-title" style="display: none;">æ­¡è¿ä½¿ç”¨AIJob<span class="mobile-break">çŸ­å½±éŸ³æ™ºèƒ½é«”</span></h1>
              <p class="homepage-subtitle" style="display: none;">é¸æ“‡æ‚¨åå¥½çš„ä½¿ç”¨æ¨¡å¼ï¼Œé–‹å§‹å‰µä½œç²¾å½©çš„çŸ­å½±éŸ³å…§å®¹</p>
              <div class="mode-cards" style="position: relative;">
                <div class="mode-card" onclick="switchPage('mode1'); console.log('Mode1 card clicked');">
                  <div class="mode-card-icon"><i class="fas fa-magic"></i></div>
                  <h3 class="mode-card-title">ä¸€éµç”Ÿæˆæ¨¡å¼</h3>
                  <p class="mode-card-desc">å¿«é€Ÿè¨­å®šéœ€æ±‚ï¼Œä¾åºç”Ÿæˆå¸³è™Ÿå®šä½ã€é¸é¡Œå’Œè…³æœ¬ï¼Œé©åˆæ•ˆç‡å°å‘çš„ç”¨æˆ¶</p>
                </div>
                <div class="mode-card" onclick="switchPage('mode2'); console.log('Mode2 card clicked');">
                  <div class="mode-card-icon"><i class="fas fa-comments"></i></div>
                  <h3 class="mode-card-title">AIé¡§å•å°è©±æ¨¡å¼</h3>
                  <p class="mode-card-desc">èˆ‡AIé€²è¡Œæ·±åº¦å°è©±ï¼Œéˆæ´»è¨è«–å…§å®¹ç­–ç•¥ï¼Œé©åˆéœ€è¦å‰µæ„è¨è«–çš„ç”¨æˆ¶</p>
                </div>
                <div class="mode-card" onclick="switchPage('mode3'); console.log('Mode3 card clicked');">
                  <div class="mode-card-icon"><i class="fas fa-user-tie"></i></div>
                  <h3 class="mode-card-title">IPäººè¨­è¦åŠƒæ¨¡å¼</h3>
                  <p class="mode-card-desc">é€éèŠå¤©è¨˜éŒ„äººç”Ÿæ›²ç·šï¼ŒAIå”åŠ©æ“¬å®šå€‹äººåŒ–IP Profileã€14å¤©è¦åŠƒå’Œè…³æœ¬</p>
                </div>
              </div>

              <!-- è¨‚é–± CTA å€ï¼ˆè—ç³»æ¼¸å±¤ï½œæ»¿ç‰ˆï½œæ¡Œæ©Ÿæ©«å¼ï½œæ‰‹æ©Ÿç›´å¼ï¼‰ -->
              <section id="subscription-cta" class="rm-pricing" style="background: linear-gradient(to bottom right, #3B82F6 0%, #1D4ED8 100%); padding: 100px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw; position: relative; overflow: hidden;">
                <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px;">
                  <div style="text-align: center; margin-bottom: 60px;">
                    <h2 style="font-size: clamp(2rem, 5vw, 3rem); font-weight: 800; color: white; margin-bottom: 20px; text-shadow: 0 2px 20px rgba(0,0,0,0.1);">
                      é–‹å§‹ä½ çš„ AI å‰µä½œä¹‹æ—…
                    </h2>
                    <p style="font-size: 1.1rem; color: rgba(255,255,255,0.9); max-width: 600px; margin: 0 auto;">
                      ğŸ’ å–®ä¸€è¨‚é–±ï¼ŒåŠŸèƒ½å®Œæ•´ï¼Œä¸åˆ†ç­‰ç´š
                    </p>
                  </div>
                  
                  <!-- å®šåƒ¹å¡ç‰‡ï¼ˆæ¡Œæ©Ÿæ©«å¼ï¼æ‰‹æ©Ÿç›´å¼ï¼‰ -->
                  <div class="rm-pricing-cards" style="display: flex; gap: 32px; justify-content: center; flex-wrap: wrap; margin-bottom: 60px; padding: 0 20px;">
                    <!-- æœˆè²»å¡ -->
                    <div style="flex: 0 1 320px; max-width: 380px; padding: 40px; background: rgba(255,255,255,0.15); backdrop-filter: blur(20px); border-radius: 24px; border: 2px solid rgba(255,255,255,0.3); transition: all 0.3s; display: flex; flex-direction: column;">
                      <div style="font-size: 1rem; color: rgba(255,255,255,0.9); margin-bottom: 12px; font-weight: 600;">æœˆè²»æ–¹æ¡ˆ</div>
                      <div style="display: flex; align-items: flex-end; flex-wrap: nowrap; gap: 4px; margin-bottom: 8px;">
                        <div style="font-size: 2.5rem; font-weight: 800; color: white; line-height: 1;">NT$3,980</div>
                        <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8); flex-shrink: 0;">/æœˆ</div>
                      </div>
                      <a href="#" onclick="goToPricing('monthly'); return false;" style="display: block; margin-top: auto; padding: 0 32px; background: white; color: #2563EB; border-radius: 12px; font-weight: 700; text-decoration: none; transition: all 0.3s; text-align: center; height: 56px; display: flex; align-items: center; justify-content: center;">
                        ç«‹å³è¨‚é–±
                      </a>
                    </div>
                    
                    <!-- å¹´è²»å¡ï¼ˆæœ€åˆ’ç®—ï¼‰ -->
                    <div style="flex: 0 1 320px; max-width: 380px; padding: 40px; background: rgba(255,255,255,0.95); border-radius: 24px; border: 2px solid rgba(255,255,255,0.5); box-shadow: 0 20px 60px rgba(0,0,0,0.2); position: relative; transition: all 0.3s; display: flex; flex-direction: column;">
                      <div style="position: absolute; top: -16px; left: 50%; transform: translateX(-50%); padding: 8px 24px; background: linear-gradient(135deg, #FBBF24 0%, #F59E0B 100%); color: white; border-radius: 20px; font-size: 0.9rem; font-weight: 700; box-shadow: 0 4px 12px rgba(251,191,36,0.3);">
                        â­ æœ€åˆ’ç®—
                      </div>
                      <div style="font-size: 1rem; color: #64748B; margin-bottom: 12px; font-weight: 600; margin-top: 12px;">å¹´è²»æ–¹æ¡ˆ</div>
                      <div style="display: flex; align-items: flex-end; flex-wrap: nowrap; gap: 4px; margin-bottom: 8px;">
                        <div style="font-size: 2.5rem; font-weight: 800; background: linear-gradient(135deg, #10B981 0%, #059669 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1;">NT$39,800</div>
                        <div style="font-size: 0.9rem; color: #94A3B8; flex-shrink: 0; margin-bottom: 0.3rem;">/å¹´</div>
                      </div>
                      <div style="font-size: 0.9rem; color: #94A3B8;">ï¼ˆçœ NT$7,960ï¼‰</div>
                      <a href="#" onclick="goToPricing('yearly'); return false;" style="display: block; margin-top: auto; padding: 0 32px; background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; border-radius: 12px; font-weight: 700; text-decoration: none; box-shadow: 0 4px 20px rgba(16,185,129,0.3); transition: all 0.3s; text-align: center; height: 56px; display: flex; align-items: center; justify-content: center;">
                        ç«‹å³è¨‚é–±
                      </a>
                    </div>
                  </div>
                  
                  <!-- åƒ¹å€¼æ‰¿è«¾ -->
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 32px; margin-top: 60px; padding: 0 20px;">
                    <div style="padding: 32px; background: rgba(255,255,255,0.15); backdrop-filter: blur(20px); border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">
                      <div style="font-size: 3rem; margin-bottom: 16px;">âš¡</div>
                      <div style="font-weight: 700; margin-bottom: 8px; color: white; font-size: 1.1rem;">ç”¢å‡ºæ™‚é–“æ¸›å°‘ 70%</div>
                      <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">AI è‡ªå‹•ç”Ÿæˆè…³æœ¬ï¼Œå¾å°æ™‚ç¸®çŸ­åˆ°åˆ†é˜</div>
                    </div>
                    <div style="padding: 32px; background: rgba(255,255,255,0.15); backdrop-filter: blur(20px); border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">
                      <div style="font-size: 3rem; margin-bottom: 16px;">ğŸ“ˆ</div>
                      <div style="font-weight: 700; margin-bottom: 8px; color: white; font-size: 1.1rem;">ä¸Šç‰‡é »ç‡æå‡ 200%</div>
                      <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">ä¸€éµç”Ÿæˆï¼Œä¸å†ç‚ºå…§å®¹ç™¼æ„</div>
                    </div>
                    <div style="padding: 32px; background: rgba(255,255,255,0.15); backdrop-filter: blur(20px); border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">
                      <div style="font-size: 3rem; margin-bottom: 16px;">ğŸŒ</div>
                      <div style="font-weight: 700; margin-bottom: 8px; color: white; font-size: 1.1rem;">åœ¨åœ°åŒ–æ¨¡æ¿</div>
                      <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">å°ˆç‚ºå°åŒ—ã€å°ä¸­ã€é«˜é›„å„ªåŒ–</div>
                    </div>
                  </div>
                  
                  <p style="color: rgba(255,255,255,0.9); font-size: 1rem; margin-top: 40px; padding: 20px; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 16px; border: 1px solid rgba(255,255,255,0.2); max-width: 600px; margin-left: auto; margin-right: auto; text-align: center;">
                    ğŸ’¡ è‹¥ä½ å·²æœ‰åºè™Ÿï¼Œè«‹å‰å¾€ã€Œå…Œæ›åºè™Ÿã€é–‹é€šä¸€å¹´ä½¿ç”¨æ¬Š
                  </p>
                </div>
              </section>
              
              <!-- Footerï¼ˆGEOï¼‹SEOï¼‰ -->
              <section class="rm-footer" style="background: #EFF6FF; padding: 60px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw;">
                <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px; text-align: center;">
                  <div style="font-size: 1.1rem; font-weight: 600; color: #1E293B; margin-bottom: 12px;">
                    AI çŸ­å½±éŸ³ï½œAI ç”Ÿæˆè…³æœ¬ï½œAI å¸³è™Ÿå®šä½
                  </div>
                  <div style="font-size: 0.95rem; color: #64748B; margin-bottom: 12px;">
                    æœå‹™åœ°å€ï¼šå°åŒ—ï½œå°ä¸­ï½œé«˜é›„ï½œé¦™æ¸¯ï½œæ–°åŠ å¡
                  </div>
                  <div style="font-size: 0.9rem; color: #94A3B8; font-weight: 500;">
                    ReelMind â€” ç‚ºäºæ´²å‰µä½œè€…æ‰“é€ çš„ AI çŸ­å½±éŸ³æ™ºèƒ½é«”
                  </div>
                </div>
              </section>


            </div>
          </div>

          <!-- è«–å£‡ä»‹ç´¹ & è¯çµ¡æ–¹å¼é é¢ -->
          <div id="forum" class="page">
            <div style="max-width: 1200px; margin: 0 auto; padding: 0;">
              <!-- Hero å€å¡Š -->
              <div style="position: relative; overflow: hidden; padding: 60px 20px 40px; background: linear-gradient(135deg, #eff6ff 0%, #f0fdf4 50%, #fef3c7 100%); text-align: center;">
                <div style="display: inline-block; background: #e0f2fe; color: #075985; padding: 8px 16px; border-radius: 9999px; font-weight: 700; font-size: 14px; margin-bottom: 20px;">
                  ğŸš€ AIJob å­¸é™¢ Â· Discord ç¤¾ç¾¤
                </div>
                <h1 style="font-size: 2.8rem; font-weight: 800; color: #0f172a; margin: 12px 0; line-height: 1.2;">
                  ä¸€èµ·æŠŠçŸ­å½±éŸ³åšæˆã€Œå¯è¤‡è£½çš„ç³»çµ±ã€
                </h1>
                <p style="font-size: 1.25rem; color: #475569; max-width: 800px; margin: 0 auto 24px;">
                  ä¸€éµç”Ÿæˆåˆ†äº«ï½œAI é¡§å•å•ç­”ï½œIP äººè¨­è¦åŠƒï½œå‰µä½œè€…è³‡æ–™åº«æ•´åˆã€‚åŠ å…¥ Discordï¼Œé‚Šåšé‚Šå­¸é‚Šä¸Šç‰‡ã€‚
                </p>
                <div style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; margin-bottom: 30px;">
                  <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display: inline-flex; align-items: center; justify-content: center; padding: 14px 28px; background: #0ea5e9; color: white; border-radius: 9999px; font-weight: 800; text-decoration: none; transition: all 0.3s;">
                    ç«‹å³åŠ å…¥ Discord
                  </a>
                  <a href="#channels" style="display: inline-flex; align-items: center; justify-content: center; padding: 14px 28px; background: white; border: 1px solid #cbd5e1; color: #334155; border-radius: 9999px; font-weight: 800; text-decoration: none;">
                    ç†±é–€é »é“
                  </a>
                </div>
                
                <!-- è·‘é¦¬ç‡ˆ -->
                <div style="display: flex; gap: 32px; overflow: auto; white-space: nowrap; padding: 12px 0; color: #0ea5e9; font-weight: 800; border-top: 1px solid #cbd5e1;">
                  <span>ğŸ”¥ #ä¸€éµç”Ÿæˆå·¥ä½œå€ æ¯å¤©æ–°è²¼æ–‡ 30+</span>
                  <span>ğŸ§­ #IPäººè¨­è¦åŠƒ çœŸå¯¦æ¡ˆä¾‹äº¤æµ</span>
                  <span>ğŸ¤– #AIé¡§å•å•ç­” ç¯€å¥ / Hook / CTA</span>
                  <span>ğŸ“¦ ä½ çš„æˆæœå¯å­˜å›ã€Œå‰µä½œè€…è³‡æ–™åº«ã€</span>
                </div>
              </div>

              <!-- ç¤¾ç¾¤æ—¥å¸¸æ™‚é–“è»¸ -->
              <div style="padding: 60px 20px;">
                <h2 style="font-size: 1.75rem; font-weight: 900; margin: 0 0 32px; color: #0f172a;">ç¤¾ç¾¤æ—¥å¸¸ï½œä»Šå¤©åœ¨è¨è«–ä»€éº¼ï¼Ÿ</h2>
                
                <div style="position: relative; padding-left: 28px; max-width: 800px;">
                  <!-- Timeline ç·š -->
                  <div style="position: absolute; left: 12px; top: 8px; bottom: 8px; width: 2px; background: #cbd5e1;"></div>
                  
                  <!-- Timeline Item 1 -->
                  <div style="position: relative; padding: 14px 16px; background: white; border: 1px solid #e2e8f0; border-radius: 14px; margin: 10px 0; box-shadow: 0 12px 26px rgba(2,6,23,.06);">
                    <div style="position: absolute; left: -18px; top: 18px; width: 12px; height: 12px; border-radius: 50%; background: #0ea5e9; border: 3px solid white;"></div>
                    <div style="font-size: 12px; color: #64748b; margin-bottom: 6px;">09:32 Â· #ä¸€éµç”Ÿæˆå·¥ä½œå€</div>
                    <h3 style="font-weight: 900; margin: 0 0 4px; color: #0f172a;">ç¾è‚¡ç›¤å¾Œé€Ÿå ±ï¼šå¦‚ä½•åš 20 ç§’çŸ­è©•ï¼Ÿ</h3>
                    <p style="color: #475569; margin: 0;">ç”¨ 3 å¥è©±æ¡†ï¼ŒHookâ†’æ•¸æ“šâ†’CTAï¼Œä¸¦é™„ä¸Šä¸‹ä¸€æ”¯é å‘Šã€‚</p>
                  </div>
                  
                  <!-- Timeline Item 2 -->
                  <div style="position: relative; padding: 14px 16px; background: white; border: 1px solid #e2e8f0; border-radius: 14px; margin: 10px 0; box-shadow: 0 12px 26px rgba(2,6,23,.06);">
                    <div style="position: absolute; left: -18px; top: 18px; width: 12px; height: 12px; border-radius: 50%; background: #0ea5e9; border: 3px solid white;"></div>
                    <div style="font-size: 12px; color: #64748b; margin-bottom: 6px;">13:15 Â· #AIé¡§å•å•ç­”</div>
                    <h3 style="font-weight: 900; margin: 0 0 4px; color: #0f172a;">å°ç£å¥³æ€§å—çœ¾èªæ°£ï¼Œå“ªäº›è©æ›´è‡ªç„¶ï¼Ÿ</h3>
                    <p style="color: #475569; margin: 0;">æŠŠå£æ°£å¾ã€Œæ•™å°ã€æ”¹ç‚ºã€Œé™ªä¼´ã€ï¼Œä¸¦åŠ å…¥åœ¨åœ°å£èªè½‰å ´ã€‚</p>
                  </div>
                  
                  <!-- Timeline Item 3 -->
                  <div style="position: relative; padding: 14px 16px; background: white; border: 1px solid #e2e8f0; border-radius: 14px; margin: 10px 0; box-shadow: 0 12px 26px rgba(2,6,23,.06);">
                    <div style="position: absolute; left: -18px; top: 18px; width: 12px; height: 12px; border-radius: 50%; background: #0ea5e9; border: 3px solid white;"></div>
                    <div style="font-size: 12px; color: #64748b; margin-bottom: 6px;">20:41 Â· #IPäººè¨­è¦åŠƒ</div>
                    <h3 style="font-weight: 900; margin: 0 0 4px; color: #0f172a;">14 å¤©ä¸Šç‰‡ç¯€å¥ï¼šé€±ä¸€è…³æœ¬ã€é€±ä¸‰éŒ„å½±ã€é€±æœ«è¼ªæ’­</h3>
                    <p style="color: #475569; margin: 0;">å»ºç«‹å›ºå®šç¯€é»ï¼Œè³‡æ–™åº«ç‰ˆæœ¬ç®¡ç†æ›´å¥½æ‰¾ã€‚</p>
                  </div>
                </div>
              </div>

              <!-- é »é“åœ°åœ– -->
              <div id="channels" style="padding: 40px 20px 60px;">
                <h2 style="font-size: 1.75rem; font-weight: 900; margin: 0 0 32px; color: #0f172a;">é »é“åœ°åœ–ï½œå…ˆå¾é€™ä¸‰å€‹é–‹å§‹</h2>
                
                <div style="display: grid; gap: 20px; max-width: 900px;">
                  <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 20px; box-shadow: 0 10px 24px rgba(2,6,23,.06);">
                    <div style="display: grid; gap: 12px; grid-template-columns: repeat(2, 1fr); margin-bottom: 16px;">
                      <div style="display: flex; align-items: center; gap: 10px; border: 1px dashed #93c5fd; padding: 12px; border-radius: 12px;">
                        <span>ğŸ“Œ</span>
                        <div>
                          <div style="font-weight: 700; color: #1e293b;">#æ­¡è¿èˆ‡è¦å‰‡</div>
                          <div style="font-size: 12px; color: #64748b; margin-top: 2px;">è²¼æ–‡æ ¼å¼ã€å‹å–„äº¤æµ</div>
                        </div>
                      </div>
                      
                      <div style="display: flex; align-items: center; gap: 10px; border: 1px dashed #93c5fd; padding: 12px; border-radius: 12px;">
                        <span>âš¡</span>
                        <div>
                          <div style="font-weight: 700; color: #1e293b;">#ä¸€éµç”Ÿæˆå·¥ä½œå€</div>
                          <div style="font-size: 12px; color: #64748b; margin-top: 2px;">è²¼æˆæœæ‹¿å›é¥‹</div>
                        </div>
                      </div>
                      
                      <div style="display: flex; align-items: center; gap: 10px; border: 1px dashed #93c5fd; padding: 12px; border-radius: 12px;">
                        <span>ğŸ¤–</span>
                        <div>
                          <div style="font-weight: 700; color: #1e293b;">#AIé¡§å•å•ç­”</div>
                          <div style="font-size: 12px; color: #64748b; margin-top: 2px;">å®šä½/ç¯€å¥/è®Šç¾</div>
                        </div>
                      </div>
                      
                      <div style="display: flex; align-items: center; gap: 10px; border: 1px dashed #93c5fd; padding: 12px; border-radius: 12px;">
                        <span>ğŸ§­</span>
                        <div>
                          <div style="font-weight: 700; color: #1e293b;">#IPäººè¨­è¦åŠƒ</div>
                          <div style="font-size: 12px; color: #64748b; margin-top: 2px;">Profileï¼‹14å¤©</div>
                        </div>
                      </div>
                    </div>
                    
                    <div style="font-size: 12px; color: #64748b; margin-bottom: 12px;">
                      âœ… å»ºè­°é †åºï¼š#æ­¡è¿èˆ‡è¦å‰‡ â†’ #IPäººè¨­è¦åŠƒ â†’ #ä¸€éµç”Ÿæˆå·¥ä½œå€
                    </div>
                    
                    <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display: inline-block; padding: 12px 24px; background: #0ea5e9; color: white; border-radius: 9999px; font-weight: 800; text-decoration: none;">
                      åŠ å…¥ Discord
                    </a>
                  </div>
                </div>
              </div>

              <!-- è¯çµ¡æ–¹å¼ -->
              <div style="padding: 60px 20px; background: #f8fafc;">
                <h2 style="font-size: 1.75rem; font-weight: 900; margin: 0 0 32px; color: #0f172a; text-align: center;">è¯çµ¡æ–¹å¼</h2>
                
                <div style="display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); max-width: 1000px; margin: 0 auto;">
                  <!-- LINE å®˜æ–¹å¸³è™Ÿ -->
                  <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 24px; box-shadow: 0 10px 24px rgba(2,6,23,.06);">
                    <div style="font-weight: 700; margin-bottom: 8px; color: #0f172a;">LINE å®˜æ–¹å¸³è™Ÿ</div>
                    <a href="https://AIJobschool.short.gy/E49kA8" target="_blank" style="font-size: 14px; color: #06c755; text-decoration: none;">
                      åŠ å…¥ LINE å¥½å‹
                    </a>
                  </div>
                  
                  <!-- Discord -->
                  <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 24px; box-shadow: 0 10px 24px rgba(2,6,23,.06);">
                    <div style="font-weight: 700; margin-bottom: 8px; color: #0f172a;">Discord</div>
                    <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="font-size: 14px; color: #0ea5e9; text-decoration: none;">
                      AIJob å­¸é™¢
                    </a>
                  </div>
                  
                  <!-- ç¤¾ç¾¤ -->
                  <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 24px; box-shadow: 0 10px 24px rgba(2,6,23,.06);">
                    <div style="font-weight: 700; margin-bottom: 8px; color: #0f172a;">ç¤¾ç¾¤</div>
                    <div style="font-size: 14px; color: #64748b;">IG / YouTube æœå°‹ã€ŒReelMindã€</div>
                  </div>
                </div>
              </div>
              
              <!-- Footer -->
              <div style="padding: 28px 20px; text-align: center; color: #64748b; border-top: 1px solid #e2e8f0; font-size: 14px;">
                Â© 2025 ReelMind Â· AI çŸ­å½±éŸ³ Â· å°ç£
              </div>
            </div>
          </div>

          <!-- AIçŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—é é¢ -->
          <div id="guide" class="page">
            <div style="max-width: 1200px; margin: 0 auto; padding: 40px 20px;">
              <!-- æ¨™é¡Œå€ -->
              <div style="text-align: center; margin-bottom: 50px;">
                <h1 style="font-size: 2.5rem; font-weight: 800; color: #1E293B; margin-bottom: 20px;">
                  <i class="fas fa-book-open" style="margin-right: 15px; color: #3B82F6;"></i>AI çŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—
                </h1>
                <p style="font-size: 1.2rem; color: #64748B; max-width: 700px; margin: 0 auto;">
                  å­¸ç¿’å¦‚ä½•ç”¨ AI æ‰“é€ çˆ†æ¬¾çŸ­å½±éŸ³å…§å®¹ï¼Œå¾åŸºç¤åˆ°é€²éšæŠ€å·§
                </p>
              </div>

              <!-- æŒ‡å—æ–‡ç« åˆ—è¡¨ -->
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px;">
                <!-- æ–‡ç«  1 -->
                <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; cursor: pointer;" onclick="switchPage('guide-article1')">
                  <div style="padding: 32px; border-bottom: 1px solid #F1F5F9;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">ä¸‰æ­¥ç”Ÿæˆ 30 ç§’çŸ­å½±éŸ³è…³æœ¬</div>
                    <div style="font-size: 1rem; color: #64748B; line-height: 1.6;">
                      åªéœ€ä¸‰æ­¥ï¼šè¨­å®šå¹³å°èˆ‡ä¸»é¡Œã€AI ç”ŸæˆåŠ‡æœ¬å¤§ç¶±ã€ç¢ºèªä¸¦å„²å­˜ã€‚æœ¬æ•™å­¸å°‡ç¤ºç¯„å®Œæ•´æµç¨‹ï¼Œå¹«ä½ åœ¨ 5 åˆ†é˜å…§ç”¢å‡º Instagram Reels è…³æœ¬...
                    </div>
                  </div>
                  <div style="padding: 20px 32px; background: #F8FAFC;">
                    <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                  </div>
                </div>
                
                <!-- æ–‡ç«  2 -->
                <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; cursor: pointer;" onclick="switchPage('guide-article2')">
                  <div style="padding: 32px; border-bottom: 1px solid #F1F5F9;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">AI å¸³è™Ÿå®šä½ï¼šå…§å®¹æ”¯æŸ±èˆ‡ 14 å¤©è¨ˆç•«</div>
                    <div style="font-size: 1rem; color: #64748B; line-height: 1.6;">
                      äº†è§£å¦‚ä½•ç”¨ AI åˆ†æä½ çš„å…§å®¹å®šä½ï¼Œä¸¦è‡ªå‹•ç”Ÿæˆ 14 å¤©ç™¼å¸ƒè¨ˆç•«ã€‚åŒ…å«å…§å®¹æ”¯æŸ±ï¼ˆæ•™è‚²ã€å¨›æ¨‚ã€å•Ÿç™¼ã€æˆäº¤ï¼‰èˆ‡æ’ç¨‹å»ºè­°...
                    </div>
                  </div>
                  <div style="padding: 20px 32px; background: #F8FAFC;">
                    <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                  </div>
                </div>
                
                <!-- æ–‡ç«  3 -->
                <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; cursor: pointer;" onclick="switchPage('guide-article3')">
                  <div style="padding: 32px; border-bottom: 1px solid #F1F5F9;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">Reels / Shorts / TikTok<br>è…³æœ¬å·®ç•°</div>
                    <div style="font-size: 1rem; color: #64748B; line-height: 1.6;">
                      æ¯å€‹å¹³å°çš„çŸ­å½±éŸ³éƒ½æœ‰ä¸åŒç‰¹æ€§ï¼šIG Reels åé‡å“ç‰Œæ•˜äº‹ï¼ŒYouTube Shorts å¼·èª¿å¿«é€Ÿçˆ†é»ï¼ŒTikTok é‡è¦–å¨›æ¨‚æ€§ã€‚æœ¬æŒ‡å—è§£æ AI å¦‚ä½•è‡ªå‹•èª¿æ•´...
                    </div>
                  </div>
                  <div style="padding: 20px 32px; background: #F8FAFC;">
                    <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- æ–‡ç« ï¼šä¸‰æ­¥ç”Ÿæˆ 30 ç§’çŸ­å½±éŸ³è…³æœ¬ -->
          <div id="guide-article1" class="page">
            <div>
              <!-- Header -->
              <header style="padding: 56px 0 18px; border-bottom: 1px solid #e2e8f0; background: linear-gradient(135deg, rgba(37,99,235,.10), transparent 60%), linear-gradient(135deg, rgba(59,130,246,.10), transparent 60%);">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                <div style="font-size: 12px; color: #64748b; margin-bottom: 10px;">
                  <a onclick="switchPage('homepage'); return false;" style="text-decoration: none; color: #64748b; cursor: pointer;">é¦–é </a> / 
                  <a onclick="switchPage('guide'); return false;" style="text-decoration: none; color: #64748b; cursor: pointer;">AI çŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—</a> / æ–‡ç« 
                </div>
                <h1 style="font-size: 30px; margin: 0 0 6px; color: #0f172a; font-weight: 800;">ä¸‰æ­¥ç”Ÿæˆ 30 ç§’çŸ­å½±éŸ³è…³æœ¬</h1>
                <p style="color: #475569; margin: 0 0 8px; line-height: 1.6;">
                  ç”¨ ReelMind ä¸€éµç”Ÿæˆï¼Œä¸‰æ­¥å®Œæˆ Hookã€å£æ’­èˆ‡åˆ†é¡ã€‚é©ç”¨ IG Reels / TikTok / YouTube Shortsï¼Œå«å°ç£å¸‚å ´åœ¨åœ°åŒ–èªæ°£å»ºè­°ã€‚
                </p>
                <div style="display: flex; gap: 12px; flex-wrap: wrap; color: #64748b; font-size: 12px; margin-top: 8px;">
                  <span>é–±è®€ç´„ 6 åˆ†é˜</span>
                  <span>é©ç”¨è§’è‰²ï¼šå‰µä½œè€… / è¡ŒéŠ·äºº / è€é—†</span>
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: nowrap; margin-top: 18px; margin-bottom: 32px;">
                  <button onclick="switchPage('homepage');" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; background: #2563eb; color: white; border: none; cursor: pointer; flex: 1;">
                    ç™»å…¥è§£é– AI ç”Ÿæˆ
                  </button>
                  <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; border: 1px solid #cbd5e1; color: #334155; background: white; text-decoration: none; cursor: pointer; flex: 1;">
                    åŠ å…¥ Discord è¨è«–
                  </a>
                </div>
                </div>
              </header>

              <!-- Article -->
              <article style="padding: 28px 0;">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                <!-- å¿«é€Ÿå°è¦½ -->
                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 14px; margin-bottom: 28px;">
                  <strong style="display: block; margin-bottom: 8px; color: #0f172a;">å¿«é€Ÿå°è¦½</strong>
                  <ol style="margin: 0; padding-left: 20px; color: #334155;">
                    <li><a href="#step1" style="color: #334155; text-decoration: none;">Step 1ï¼šè¨­å®šå¹³å°èˆ‡ä¸»é¡Œ</a></li>
                    <li><a href="#step2" style="color: #334155; text-decoration: none;">Step 2ï¼šä¸€éµç”Ÿæˆï¼ˆHookï¼å£æ’­ï¼åˆ†é¡ï¼‰</a></li>
                    <li><a href="#step3" style="color: #334155; text-decoration: none;">Step 3ï¼šå„ªåŒ–èˆ‡ä¸Šç‰‡ï¼ˆCTAï¼æ¨™é¡Œï¼Hashtagï¼‰</a></li>
                  </ol>
                </div>

                <h2 id="step1" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">Step 1ï¼šè¨­å®šå¹³å°èˆ‡ä¸»é¡Œ</h2>
                <p style="color: #475569; line-height: 1.8; margin: 10px 0;">
                  åœ¨ ReelMind çš„ã€Œä¸€éµç”Ÿæˆã€ä¸­ï¼Œé¸æ“‡ <strong>IG Reels / TikTok / Shorts</strong>ï¼Œå¡«å…¥ä½ çš„ä¸»é¡Œï¼ˆç”¢å“ï¼æœå‹™ï¼é¢¨æ ¼ï¼‰ï¼Œä»¥åŠå½±ç‰‡é•·åº¦ï¼ˆå»ºè­° 20â€“45 ç§’ï¼‰ã€‚
                </p>
                <div style="background: #eff6ff; border: 1px solid #dbeafe; border-radius: 12px; padding: 12px 14px; color: #1e3a8a; margin: 14px 0;">
                  å°æŠ€å·§ï¼šä¸»é¡Œè«‹å…·é«”åˆ°ã€Œæ—ç¾¤ï¼‹å ´æ™¯ï¼‹ç—›é»ã€ï¼ˆä¾‹ï¼šä¸Šç­æ—ï¼åˆä¼‘ï¼å¿«é€Ÿå‚™é¤ï¼‰ã€‚
                </div>

                <h2 id="step2" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">Step 2ï¼šä¸€éµç”Ÿæˆï¼ˆHookï¼å£æ’­ï¼åˆ†é¡ï¼‰</h2>
                <p style="color: #475569; line-height: 1.8; margin: 10px 0;">æŒ‰ä¸‹ã€Œç”Ÿæˆã€ï¼Œç³»çµ±æœƒè¼¸å‡ºï¼š</p>
                <ul style="color: #475569; line-height: 1.8;">
                  <li><strong>Hook é–‹å ´</strong>ï¼šå‰ 3â€“5 ç§’æŠ“ä½æ³¨æ„åŠ›ï¼ˆæ•¸æ“šï¼ç–‘å•ï¼åå·®ï¼‰ã€‚</li>
                  <li><strong>å£æ’­æ–‡å­—</strong>ï¼šä¸€å¥è©±ä¸€é‡é»ï¼Œé¿å…å†—é•·ã€‚</li>
                  <li><strong>é¡é ­æŒ‡ç¤º</strong>ï¼šç‰¹å¯«ï¼ä¸­æ™¯ï¼è½‰å ´ï¼Œæ­é…å‹•ä½œèˆ‡è¡¨æƒ…ã€‚</li>
                </ul>
                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 16px; margin: 14px 0; position: relative;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-size: 14px; font-weight: 600; color: #64748b;">ä»£ç¢¼ç¤ºä¾‹</span>
                    <button onclick="copyCode()" style="background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer; transition: all 0.2s;">
                      <i class="fas fa-copy"></i> è¤‡è£½
                    </button>
                  </div>
                  <pre id="codeBlock" style="font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: #0f172a; color: white; border-radius: 8px; padding: 10px 12px; display: block; overflow: auto; margin: 0;"># ç”Ÿæˆç¤ºä¾‹ï¼ˆæ‘˜è¦ï¼‰
Hookï¼šä¸Šç­æ—åˆä¼‘ 30 åˆ†é˜ï¼Œä¸‰æ­¥åšå‡ºé«˜è›‹ç™½ä¾¿ç•¶ï¼Ÿ
å£æ’­ï¼šæ­¥é©Ÿä¸€â€¦ æ­¥é©ŸäºŒâ€¦ æ­¥é©Ÿä¸‰â€¦
åˆ†é¡ï¼š0-5s é–‹å ´ç‰¹å¯«ï¼›5-20s æ­¥é©Ÿç•«é¢ï¼›20-30s æˆå“ï¼‹CTA</pre>
                </div>

                <h2 id="step3" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">Step 3ï¼šå„ªåŒ–èˆ‡ä¸Šç‰‡ï¼ˆCTAï¼æ¨™é¡Œï¼Hashtagï¼‰</h2>
                <p style="color: #475569; line-height: 1.8; margin: 10px 0;">ç¢ºèªç¯€å¥å¾Œï¼ŒåŠ å…¥ <strong>CTA</strong>ï¼ˆç•™è¨€é—œéµå­—ã€ä¸‹è¼‰æ¸…å–®ã€ç§è¨Šé€£çµï¼‰ï¼Œä¸¦ä¾å¹³å°æœ€ä½³åšæ³•èª¿æ•´ï¼š</p>
                <ul style="color: #475569; line-height: 1.8;">
                  <li>IG Reelsï¼šå“ç‰Œæ„Ÿèˆ‡ä¸€è‡´è¦–è¦ºã€‚</li>
                  <li>Shortsï¼šå¼·ç¯€å¥èˆ‡é—œéµå­—æ¨™é¡Œã€‚</li>
                  <li>TikTokï¼šå¨›æ¨‚æ€§èˆ‡äº’å‹•èª˜ç™¼ã€‚</li>
                </ul>
                <div style="background: #eff6ff; border: 1px solid #dbeafe; border-radius: 12px; padding: 12px 14px; color: #1e3a8a; margin: 14px 0;">
                  è‹¥ä½ å·²è¨‚é–±ï¼Œç”¨ã€Œå‰µä½œè€…è³‡æ–™åº«ã€ä¸‹è¼‰ PDF/CSVã€é‡ç”Ÿä¸åŒç‰ˆæœ¬ï¼ŒæŒçºŒåš A/B æ¸¬è©¦ã€‚
                </div>

                <div style="display: flex; gap: 10px; flex-wrap: nowrap; margin: 18px 0;">
                  <button onclick="switchPage('homepage');" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; background: #2563eb; color: white; border: none; cursor: pointer; flex: 1;">
                    ç«‹å³ç™»å…¥ï¼Œç”Ÿæˆæˆ‘çš„ç¬¬ä¸€æ”¯è…³æœ¬
                  </button>
                  <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; border: 1px solid #cbd5e1; color: #334155; background: white; text-decoration: none; cursor: pointer; flex: 1;">
                    åˆ° Discord çœ‹å¤§å®¶æ€éº¼æ”¹è…³æœ¬
                  </a>
                </div>
                </div>
              </article>

              <!-- Footer -->
              <footer style="padding: 26px 0; color: #64748b; text-align: center; border-top: 1px solid #e2e8f0; font-size: 14px;">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                Â© 2025 ReelMind Â· AI çŸ­å½±éŸ³ï½œAI è…³æœ¬ç”Ÿæˆï½œAI é¡§å•ï½œIP äººè¨­è¦åŠƒ Â· å°ç£ / é¦™æ¸¯ / æ–°åŠ å¡
                </div>
              </footer>
            </div>
          </div>

          <!-- æ–‡ç« ï¼šAI å¸³è™Ÿå®šä½ï¼šå…§å®¹æ”¯æŸ±èˆ‡ 14 å¤©è¨ˆç•«ï¼ˆé€²éšç‰ˆï¼‰ -->
          <div id="guide-article2" class="page">
            <div>
              <!-- Header -->
              <header style="padding: 56px 0 18px; border-bottom: 1px solid #e2e8f0; background: linear-gradient(135deg, rgba(234,179,8,.12), transparent 60%), linear-gradient(135deg, rgba(245,158,11,.10), transparent 60%);">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                  <div style="font-size: 12px; color: #64748b; margin-bottom: 10px;">
                    <a onclick="switchPage('homepage'); return false;" style="text-decoration: none; color: #64748b; cursor: pointer;">é¦–é </a> / 
                    <a onclick="switchPage('guide'); return false;" style="text-decoration: none; color: #64748b; cursor: pointer;">AI çŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—</a> / æ–‡ç« 
                  </div>
                  <h1 style="font-size: 30px; margin: 0 0 6px; color: #0f172a; font-weight: 800;">AI å¸³è™Ÿå®šä½ï¼šå…§å®¹æ”¯æŸ±èˆ‡ 14 å¤©è¨ˆç•«</h1>
                  <p style="color: #475569; margin: 0 0 8px; line-height: 1.6;">å»ºç«‹ ICP èˆ‡è¨Šæ¯é‡‘å­—å¡” â†’ å…§å®¹æ”¯æŸ±èˆ‡çŸ©é™£ â†’ Hook/CTA åº« â†’ æ‹æ”æ¨¡æ¿ â†’ 14 å¤©ä¸Šç‰‡æ—¥æ›† â†’ KPI èˆ‡ A/B å¯¦é©— â†’ SEO/GEO åœ¨åœ°åŒ–ã€‚</p>
                  <div style="display: flex; gap: 12px; flex-wrap: wrap; color: #64748b; font-size: 12px; margin-top: 8px;">
                    <span>é–±è®€ç´„ 8 åˆ†é˜</span>
                    <span>é©ç”¨è§’è‰²ï¼šå‰µä½œè€… / è¡ŒéŠ·äºº / è€é—†</span>
                  </div>
                  <div style="display: flex; gap: 10px; flex-wrap: nowrap; margin-top: 18px; margin-bottom: 32px;">
                    <button onclick="goToLogin();" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; background: #2563eb; color: white; border: none; cursor: pointer; flex: 1;">ç™»å…¥è§£é– AI ç”Ÿæˆ</button>
                    <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; border: 1px solid #cbd5e1; color: #334155; background: white; text-decoration: none; cursor: pointer; flex: 1;">åŠ å…¥ Discord è¨è«–</a>
                  </div>
                </div>
              </header>

              <!-- Article -->
              <article style="padding: 28px 0;">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                  <!-- å¿«é€Ÿå°è¦½ -->
                  <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 14px; margin-bottom: 28px;">
                    <strong style="display: block; margin-bottom: 8px; color: #0f172a;">å¿«é€Ÿå°è¦½</strong>
                    <ol style="margin: 0; padding-left: 20px; color: #334155;">
                      <li><a href="#icp" style="color: #334155; text-decoration: none;">ICP èˆ‡è¨Šæ¯é‡‘å­—å¡”</a></li>
                      <li><a href="#pillars" style="color: #334155; text-decoration: none;">å…§å®¹æ”¯æŸ±èˆ‡çŸ©é™£</a></li>
                      <li><a href="#hooks" style="color: #334155; text-decoration: none;">Hook / CTA åº«</a></li>
                      <li><a href="#script" style="color: #334155; text-decoration: none;">æ‹æ”è…³æœ¬æ¨¡æ¿</a></li>
                      <li><a href="#calendar" style="color: #334155; text-decoration: none;">14 å¤©æ—¥æ›†èˆ‡æ¯æ—¥ä»»å‹™</a></li>
                      <li><a href="#kpi" style="color: #334155; text-decoration: none;">KPI èˆ‡ A/B å¯¦é©—</a></li>
                      <li><a href="#seo" style="color: #334155; text-decoration: none;">SEO / GEO åœ¨åœ°åŒ–</a></li>
                      <li><a href="#prompts" style="color: #334155; text-decoration: none;">å¯è¤‡è£½çš„ AI æç¤ºè©</a></li>
                    </ol>
                  </div>

                  <h2 id="icp" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">ä¸€ã€ICP èˆ‡è¨Šæ¯é‡‘å­—å¡”</h2>
                  <div style="display:grid; gap:14px; grid-template-columns:1fr;">
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">1) ICPï¼ˆIdeal Customer Profileï¼‰</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li><b>æ—ç¾¤</b>ï¼šå¹´é½¡ / åœ°å€ï¼ˆå°ç£åŒ—ä¸­å—ï¼‰/ èº«åˆ†ï¼ˆä¸Šç­æ—ã€è‡ªç”±å·¥ä½œè€…ï¼‰</li>
                        <li><b>æƒ…å¢ƒ</b>ï¼šé€šå‹¤ã€åˆä¼‘ã€ä¸‹ç­å¾Œå‰ªç‰‡ã€é€±æœ«æ‰¹é‡æ‹æ”</li>
                        <li><b>ç—›é»</b>ï¼šç„¡æ³•ç©©å®šä¸Šç‰‡ã€è…³æœ¬å¡é—œã€è½‰æ›ç‡ä½</li>
                        <li><b>æœŸæœ›</b>ï¼šæ¯é€± 3 æ”¯ã€30 ç§’è…³æœ¬ã€å°æµåˆ° IG/Line</li>
                      </ul>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">2) è¨Šæ¯é‡‘å­—å¡”</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li><b>å“ç‰Œä¸»å¼µ</b>ï¼šç”¨ AI æŠŠçŸ­å½±éŸ³è®Šæˆå¯è¤‡è£½çš„ç³»çµ±</li>
                        <li><b>åƒ¹å€¼è­‰æ˜</b>ï¼šä¸€éµç”Ÿæˆè…³æœ¬ã€IP äººè¨­ã€è³‡æ–™åº«èˆ‡ A/B</li>
                        <li><b>åŠŸèƒ½èªªæ˜</b>ï¼šHook/CTA æ¨¡æ¿ã€14 å¤©ç¯€å¥ã€åœ¨åœ°åŒ–èªæ°£</li>
                      </ul>
                    </div>
                  </div>

                  <h2 id="pillars" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">äºŒã€å…§å®¹æ”¯æŸ±èˆ‡çŸ©é™£</h2>
                  <div style="display:grid; gap:14px; grid-template-columns:1fr;">
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">æ”¯æŸ± Ã— ç›®æ¨™</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li><b>æ•™è‚²</b>ï¼šæ•™æ–¹æ³• / æ‹†æ­¥é©Ÿï¼ˆå»ºç«‹å°ˆæ¥­æ„Ÿï¼‰</li>
                        <li><b>å¨›æ¨‚</b>ï¼šåå·® / æ¢—åŒ– / å¿«ç¯€å¥ï¼ˆæ“´è§¸åŠï¼‰</li>
                        <li><b>å•Ÿç™¼</b>ï¼šæ•…äº‹ / å¿ƒæ³• / è½‰æŠ˜ï¼ˆæƒ…æ„Ÿé€£çµï¼‰</li>
                        <li><b>æˆäº¤</b>ï¼šæ¡ˆä¾‹ / è¦åŠƒ / CTAï¼ˆå°æµè½‰æ›ï¼‰</li>
                      </ul>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">å…§å®¹çŸ©é™£å»ºè­°</h3>
                      <p style="color:#475569; line-height:1.8; margin:10px 0;">æ©«è»¸ï¼šæ”¯æŸ±ï¼›ç¸±è»¸ï¼šå½¢å¼ï¼ˆå£æ’­ / é–‹ç®± / éŒ„å¹• / é‡æ¼” / æ¸…å–®ï¼‰ã€‚å®Œæˆ 4Ã—5 çŸ©é™£ï¼20 é¡Œï¼Œè¶³å¤ å…©é€±ä¸Šç‰‡ã€‚</p>
                    </div>
                  </div>

                  <h2 id="hooks" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">ä¸‰ã€Hook / CTA åº«ï¼ˆå¯ç›´æ¥å¥—ç”¨ï¼‰</h2>
                  <div style="display:grid; gap:14px; grid-template-columns:1fr;">
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">20 ç¨® Hook æ¨¡æ¿</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li>åå·®ï¼šå…¶å¯¦æˆ‘ä¸€é–‹å§‹æ˜¯å¤±æ•—çš„â€¦</li>
                        <li>æ•¸æ“šï¼šç”¨ 30 ç§’å­¸æœƒ Xï¼Œè‡³å°‘å¿« 5 å€</li>
                        <li>æ¸…å–®ï¼šé€™ 3 ä»¶äº‹è®“æˆ‘ä¸Šç‰‡ç‡ç¿»å€</li>
                        <li>éŒ¯èª¤ï¼šä½ å¯èƒ½ä¸€ç›´åšéŒ¯äº†</li>
                        <li>æå•ï¼š3 ç§’å…§å‘Šè¨´æˆ‘ï¼Œä½ æœƒé¸å“ªå€‹ï¼Ÿ</li>
                        <li>æŒ‘æˆ°ï¼šæˆ‘ç”¨ 7 å¤©è­‰æ˜ä¸€ä»¶äº‹</li>
                        <li>ç¥•æŠ€ï¼š99% äººå¿½ç•¥çš„è¨­å®š</li>
                        <li>æ‹†è§£ï¼šæŠŠ X æ‹†æˆ 3 æ­¥</li>
                        <li>å°æ¯”ï¼šæ²’æœ‰ AI v.s. æœ‰ AI</li>
                        <li>æ•…äº‹ï¼šæˆ‘åœ¨åŒ—è»Šåœ°ä¸‹è¡—å­¸åˆ°çš„â€¦</li>
                      </ul>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">CTA ç¯„æœ¬ï¼ˆå°ç£èªæ°£ï¼‰</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li>ç•™è¨€é—œéµå­—ï¼šã€Œ<b>è…³æœ¬</b>ã€ï¼Œæˆ‘æŠŠæ¸…å–®å‚³çµ¦ä½ </li>
                        <li>å°æµï¼šæƒ³è¦æ¨¡æ¿ï¼Ÿé»ç°¡ä»‹é€£çµä¸‹è¼‰</li>
                        <li>äº’å‹•ï¼šä½ æœƒé¸ A é‚„æ˜¯ Bï¼Ÿç•™è¨€å‘Šè¨´æˆ‘</li>
                        <li>æ”¶è—ï¼šé€™æ‹›å¾ˆå¯¦ç”¨ï¼Œå…ˆå­˜èµ·ä¾†</li>
                      </ul>
                    </div>
                  </div>

                  <h2 id="script" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">å››ã€æ‹æ”è…³æœ¬æ¨¡æ¿</h2>
                  <div style="display:grid; gap:14px; grid-template-columns:1fr 1fr; max-width:100%;">
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">å£æ’­ï¼ˆSOVï¼‰</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li>0â€“3s Hookï¼ˆåå·®/æ•¸æ“š/æå•ï¼‰</li>
                        <li>3â€“20s æ­¥é©Ÿ 1/2/3ï¼ˆæ¯æ­¥ 5â€“7 ç§’ï¼‰</li>
                        <li>20â€“27s æˆæœç•«é¢ï¼ˆå‰/å¾Œå°æ¯”ï¼‰</li>
                        <li>27â€“30s CTAï¼ˆå–®ä¸€è¡Œå‹•ï¼‰</li>
                      </ul>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">B-Roll æ¸…å–®</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li>å™¨æç‰¹å¯«ã€æ‰‹éƒ¨æ“ä½œã€ç•«é¢è·³åˆ‡</li>
                        <li>è¢å¹•éŒ„å½±ï¼ˆå¿«æ·éµé¡¯ç¤ºï¼‰</li>
                        <li>è¡¨æƒ…åæ‡‰é¡é ­ã€é»é ­ã€æŒ‡é»</li>
                        <li>åŸå¸‚/é€šå‹¤æƒ…å¢ƒåšè½‰å ´</li>
                      </ul>
                    </div>
                  </div>

                  <h2 id="calendar" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">äº”ã€14 å¤©æ—¥æ›†èˆ‡æ¯æ—¥ä»»å‹™</h2>
                  <div style="display:grid; gap:14px; grid-template-columns:1fr 1fr; max-width:100%;">
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">æ—¥æ›†ï¼ˆå»ºè­°æ™‚æ®µï¼š12:00 / 20:00ï¼‰</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li><b>Day 1â€“2ï¼š</b>å—çœ¾/æ”¯æŸ±ç¢ºèªï¼‹é¡Œåº« 20 é¡Œ</li>
                        <li><b>Day 3â€“4ï¼š</b>ä¸€éµç”Ÿæˆè…³æœ¬ 8 æ”¯</li>
                        <li><b>Day 5â€“6ï¼š</b>éŒ„å½±ï¼‹å‰ªè¼¯</li>
                        <li><b>Day 7ï¼š</b>ä¸Šç‰‡ 2 æ”¯ï¼‹è¨˜éŒ„æ•¸æ“š</li>
                        <li><b>Day 8â€“9ï¼š</b>å†ç”¢ 8 æ”¯ï¼ˆå„ªåŒ– Hookï¼‰</li>
                        <li><b>Day 10â€“11ï¼š</b>éŒ„å½±ï¼‹å‰ªè¼¯ï¼ˆæ‰¹é‡ï¼‰</li>
                        <li><b>Day 12â€“13ï¼š</b>ä¸Šç‰‡ 4 æ”¯ï¼‹A/B æ¸¬è©¦</li>
                        <li><b>Day 14ï¼š</b>åŒ¯ç¸½èˆ‡é¡Œç›®æº–å‚™</li>
                      </ul>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">æ¯æ—¥ä»»å‹™ï¼ˆ15â€“30 åˆ†é˜ï¼‰</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li>10 åˆ†é˜é¸é¡Œï¼‹è…³æœ¬å¾®èª¿</li>
                        <li>10 åˆ†é˜å›è¦†ç•™è¨€ã€è’é›†ç—›é»</li>
                        <li>5 åˆ†é˜è¨˜éŒ„ï¼šæ’­æ”¾ / å®Œæ’­ / äº’å‹•</li>
                        <li>æ¯æ™šå®‰æ’æ˜æ—¥ç´ æï¼ˆæœè£ã€å ´æ™¯ï¼‰</li>
                      </ul>
                    </div>
                  </div>

                  <h2 id="kpi" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">å…­ã€KPI èˆ‡ A/B å¯¦é©—</h2>
                  <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                    <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                      <li>å®Œæ’­ç‡ â‰¥ 35%ï¼ˆ30 ç§’ç‰‡ï¼‰</li>
                      <li>3 ç§’ç•™å­˜ â‰¥ 70%</li>
                      <li>äº’å‹•ç‡ â‰¥ 3%ï¼ˆæŒ‰è®š+ç•™è¨€+æ”¶è— / è§€çœ‹ï¼‰</li>
                      <li>æ¯è¼ªåªæ”¹ã€Œä¸€ä»¶äº‹ã€ï¼Œè¨˜éŒ„ç‰ˆæœ¬å·®ç•°</li>
                    </ul>
                  </div>

                  <h2 id="seo" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">ä¸ƒã€SEO / GEO åœ¨åœ°åŒ–ï¼ˆç¹ä¸­ï¼‰</h2>
                  <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                    <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                      <li>ä¿ç•™å°ç£å£èªï¼ˆä¾‹ï¼šå…ˆå­˜èµ·ä¾†ã€é€™æ‹›ï¼‰</li>
                      <li>æ¨™é¡Œå«é—œéµè©ï¼šå¹³å°ï¼‹å‹•è©ï¼‹ç›®æ¨™</li>
                      <li>æè¿°å‰ 80 å­—æ”¾ä¸»é—œéµè©ï¼‹CTAï¼›Hashtag 3â€“7 å€‹</li>
                    </ul>
                  </div>

                  <h2 id="prompts" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">å…«ã€å¯è¤‡è£½çš„ AI æç¤ºè©</h2>
                  <div style="background:#0f172a;color:#fff;border-radius:12px;padding:12px;overflow:auto;">
ç³»çµ±ï¼šä½ æ˜¯çŸ­å½±éŸ³è…³æœ¬æ•™ç·´ï¼Œè¼¸å‡ºç¹ä¸­ï¼ˆå°ç£ï¼‰ï¼Œå­—æ•¸ç²¾ç…‰ã€‚
ä½¿ç”¨è€…ï¼šå¹³å°ï¼IG Reelsï¼›æ”¯æŸ±ï¼æ•™è‚²ï¼›é¡Œç›®ï¼ã€Œç§Ÿå±‹æˆ¿é–“ä¹Ÿèƒ½æ‹å‡ºæ¸…æ™°äººåƒã€ï¼›é•·åº¦ï¼30 ç§’ã€‚
è«‹è¼¸å‡ºï¼š1) Hook 3 ç¨® 2) å£æ’­é€å¥ 3) åˆ†é¡ï¼ˆSOV/B-roll/å­—å¹•ï¼‰4) å–®ä¸€ CTAï¼ˆç•™è¨€é—œéµå­—ï¼‰ã€‚
                  </div>

                  <div style="display: flex; gap: 10px; flex-wrap: nowrap; margin: 18px 0;">
                    <button onclick="goToLogin();" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; background: #2563eb; color: white; border: none; cursor: pointer; flex: 1;">ç«‹å³ç™»å…¥ï¼Œç”Ÿæˆæˆ‘çš„ 14 å¤©è¨ˆç•«</button>
                    <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; border: 1px solid #cbd5e1; color: #334155; background: white; text-decoration: none; cursor: pointer; flex: 1;">åŠ å…¥ Discordï¼Œå’Œå¤§å®¶ä¸€èµ·åŸ·è¡Œ</a>
                  </div>
                </div>
              </article>

              <!-- Footer -->
              <footer style="padding: 26px 0; color: #64748b; text-align: center; border-top: 1px solid #e2e8f0; font-size: 14px;">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">Â© 2025 ReelMind Â· AI çŸ­å½±éŸ³ Â· å°ç£</div>
              </footer>
            </div>
          </div>

          <!-- æ–‡ç« ï¼šReels / Shorts / TikTok è…³æœ¬å·®ç•° -->
          <div id="guide-article3" class="page">
            <div>
              <!-- Header -->
              <header style="padding: 56px 0 18px; border-bottom: 1px solid #e2e8f0; background: linear-gradient(135deg, rgba(14,165,233,.10), transparent 60%), linear-gradient(135deg, rgba(167,139,250,.10), transparent 60%);">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                  <div style="font-size: 12px; color: #64748b; margin-bottom: 10px;">
                    <a onclick="switchPage('homepage'); return false;" style="text-decoration: none; color: #64748b; cursor: pointer;">é¦–é </a> / 
                    <a onclick="switchPage('guide'); return false;" style="text-decoration: none; color: #64748b; cursor: pointer;">AI çŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—</a> / æ–‡ç« 
                  </div>
                  <h1 style="font-size: 30px; margin: 0 0 6px; color: #0f172a; font-weight: 800;">Reels / Shorts / TikTok è…³æœ¬å·®ç•°</h1>
                  <p style="color: #475569; margin: 0 0 8px; line-height: 1.6;">ä¸‰å¹³å°åŒé¡Œç›®ã€Œä¸åŒå¯«æ³•ã€ï¼šReels é‡å“ç‰Œæ•˜äº‹ã€Shorts å¼·å¿«è³‡è¨Šã€TikTok é‡å¨›æ¨‚äº’å‹•ã€‚æŠŠåŒä¸€æ”¯ç´ ææ”¹å¯«å‡ºä¸‰ç¨®æ‰“æ³•ã€‚</p>
                </div>
              </header>

              <!-- Article -->
              <article style="padding: 28px 0;">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                  <section style="background:#0f172a;border:1px solid #1f2937;border-radius:16px;padding:16px;color:#e5e7eb;">
                    <h2 style="font-size: 22px; margin: 0 0 8px; color:#e5e7eb;">ä¸€ã€å·®ç•°é€Ÿè¦½</h2>
                    <div style="overflow:auto;">
                      <table style="width:100%; border-collapse:separate; border-spacing:0 10px;">
                        <tr style="background:#111827;">
                          <td style="padding:10px 12px; font-weight:700; color:#94a3b8;">é‡é»</td>
                          <td style="padding:10px 12px;">Reelsï¼šå“ç‰Œèª¿æ€§ã€ç•«é¢ä¸€è‡´</td>
                          <td style="padding:10px 12px;">Shortsï¼šå¿«è¨Šæ¯ã€å¯æª¢ç´¢æ¨™é¡Œ</td>
                          <td style="padding:10px 12px;">TikTokï¼šå¨›æ¨‚æ€§ã€äº’å‹•èª˜ç™¼</td>
                        </tr>
                        <tr style="background:#0f172a;">
                          <td style="padding:10px 12px; font-weight:700; color:#94a3b8;">Hook</td>
                          <td style="padding:10px 12px;">æ•˜äº‹å¼ï¼šä½ ä¹Ÿé‡åˆ°é€™å•é¡Œå—ï¼Ÿ</td>
                          <td style="padding:10px 12px;">æ•¸æ“šå¼ï¼š30 ç§’æ•™æœƒä½ â€¦</td>
                          <td style="padding:10px 12px;">åå·®å¼ï¼šå…¶å¯¦æˆ‘ä¸€é–‹å§‹æ˜¯å¤±æ•—çš„â€¦</td>
                        </tr>
                        <tr style="background:#111827;">
                          <td style="padding:10px 12px; font-weight:700; color:#94a3b8;">CTA</td>
                          <td style="padding:10px 12px;">å­˜èµ·ä¾†ï¼‹é—œæ³¨å“ç‰Œ</td>
                          <td style="padding:10px 12px;">çœ‹æè¿°é€£çµ / æ–‡ç« </td>
                          <td style="padding:10px 12px;">ç•™è¨€é—œéµå­—é ˜æª”æ¡ˆ</td>
                        </tr>
                      </table>
                    </div>
                  </section>

                  <section style="display:grid; gap:14px; grid-template-columns:1fr; margin-top:14px;">
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:16px;padding:16px;">
                      <span style="display:inline-block;padding:6px 10px;border-radius:999px;background:#ecfeff;border:1px solid #cffafe;color:#06b6d4;font-weight:800;font-size:12px;margin-bottom:6px;">Reels</span>
                      <div style="height:1px;background:linear-gradient(90deg,transparent,#e5e7eb,transparent);margin:10px 0"></div>
                      <div style="font-weight:700;color:#0f172a;">å¯«æ³•å»ºè­°</div>
                      <p style="color:#475569;">èªæ°£ç©©é‡ã€é¡é ­ä¹¾æ·¨ã€å­—å¹•å°‘è€Œæº–ã€‚ç”¨å“ç‰Œè‰²å°é¢èˆ‡å›ºå®šæ¨¡æ¿ã€‚</p>
                      <div style="font-weight:700;color:#0f172a;">ç¯„ä¾‹ Hook</div>
                      <p style="color:#475569;">ã€Œå¦‚æœä»Šå¤©é‡ä¾†ï¼Œæˆ‘åªä¿ç•™ä¸‰å€‹å‹•ä½œâ€¦ã€</p>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:16px;padding:16px;">
                      <span style="display:inline-block;padding:6px 10px;border-radius:999px;background:#f5f3ff;border:1px solid #ede9fe;color:#7c3aed;font-weight:800;font-size:12px;margin-bottom:6px;">Shorts</span>
                      <div style="height:1px;background:linear-gradient(90deg,transparent,#e5e7eb,transparent);margin:10px 0"></div>
                      <div style="font-weight:700;color:#0f172a;">å¯«æ³•å»ºè­°</div>
                      <p style="color:#475569;">å‰ 3 ç§’å°±çµ¦çµè«–ï¼Œæ¨™é¡Œå«é—œéµè©ï¼Œå­—å¹•ç¯€å¥å¿«ã€‚</p>
                      <div style="font-weight:700;color:#0f172a;">ç¯„ä¾‹ Hook</div>
                      <p style="color:#475569;">ã€Œ90 ç§’æ•™ä½ å®Œæˆ Xï¼Œæ­¥é©Ÿéƒ½åœ¨é€™è£¡ã€‚ã€</p>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:16px;padding:16px;">
                      <span style="display:inline-block;padding:6px 10px;border-radius:999px;background:#ecfccb;border:1px solid #d9f99d;color:#65a30d;font-weight:800;font-size:12px;margin-bottom:6px;">TikTok</span>
                      <div style="height:1px;background:linear-gradient(90deg,transparent,#e5e7eb,transparent);margin:10px 0"></div>
                      <div style="font-weight:700;color:#0f172a;">å¯«æ³•å»ºè­°</div>
                      <p style="color:#475569;">è¡¨æƒ…å¤šã€äº’å‹•è©å¼·ã€å¯ç”¨æ¢—éŸ³æ¨‚æˆ–æŒ‘æˆ°æ ¼å¼ã€‚</p>
                      <div style="font-weight:700;color:#0f172a;">ç¯„ä¾‹ Hook</div>
                      <p style="color:#475569;">ã€Œæˆ‘ä¿è­‰çœ‹å®Œä½ ä¸€å®šæœƒè©¦ä¸€æ¬¡ã€‚ã€</p>
                    </div>
                  </section>

                  <div style="display:flex;gap:10px;flex-wrap:wrap;margin:18px 0 0 0;">
                    <a class="btn sky" onclick="goToLogin();" style="display:inline-flex;height:46px;align-items:center;justify-content:center;padding:0 18px;border-radius:999px;font-weight:900;background:#06b6d4;color:#001018;text-decoration:none;cursor:pointer;">ç™»å…¥è§£é– AI ç”Ÿæˆ</a>
                    <a class="btn alt" href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display:inline-flex;height:46px;align-items:center;justify-content:center;padding:0 18px;border-radius:999px;font-weight:900;border:1px solid #cbd5e1;color:#334155;background:#fff;text-decoration:none;">åˆ° Discord çœ‹ç¯„ä¾‹</a>
                  </div>
                </div>
              </article>

              <!-- Footer -->
              <footer style="padding: 26px 0; color: #64748b; text-align: center; border-top: 1px solid #e2e8f0; font-size: 14px;">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">Â© 2025 ReelMind Â· AI çŸ­å½±éŸ³ Â· å°ç£</div>
              </footer>
            </div>
          </div>

<!-- æ¨¡å¼1ï¼šä¸€éµç”Ÿæˆé é¢ -->
          <div id="mode1" class="page">
            <div class="mode1-page">
              <!-- å·¦åŠéƒ¨ï¼šç”¨æˆ¶éœ€æ±‚è¨­å®š -->
              <div class="mode1-left">
                <h2 class="section-title">
                  <span>âš™ï¸</span>
                  ç”¨æˆ¶éœ€æ±‚è¨­å®š
                </h2>
                <!-- é€™è£¡å°‡æ”¾ç½®åŸæœ‰çš„ç”¨æˆ¶éœ€æ±‚è¨­å®šè¡¨å–® -->
                <div id="userSettingsContainer">
                  <!-- åŸæœ‰çš„ç”¨æˆ¶éœ€æ±‚è¨­å®šå…§å®¹å°‡ç§»å‹•åˆ°é€™è£¡ -->
                </div>
                
                <!-- ä¸€éµç”Ÿæˆä½¿ç”¨èªªæ˜ -->
                <div class="one-click-instructions" id="oneClickInstructions" style="display: none;">
                  <h3>ğŸš€ ä¸€éµç”Ÿæˆä½¿ç”¨èªªæ˜</h3>
                  <div class="instruction-steps">
                    <div class="step">
                      <div class="step-number">1</div>
                      <div class="step-content">
                        <strong>è¨­å®šéœ€æ±‚</strong>
                        <p>é¸æ“‡å¹³å°ã€è¼¸å…¥ä¸»é¡Œã€è¨­å®šç§’æ•¸å’Œå¸³è™Ÿå®šä½ï¼Œç„¶å¾Œé»æ“Šã€Œå¥—ç”¨è¨­å®šã€</p>
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">2</div>
                      <div class="step-content">
                        <strong>ç”Ÿæˆå¸³è™Ÿå®šä½</strong>
                        <p>é»æ“Šå³å´ã€Œä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½ã€æŒ‰éˆ•ï¼ŒAIå°‡åˆ†ææ‚¨çš„å¸³è™Ÿå®šä½</p>
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">3</div>
                      <div class="step-content">
                        <strong>ç”Ÿæˆé¸é¡Œ</strong>
                        <p>é»æ“Šã€Œä¸€éµç”Ÿæˆé¸é¡Œã€æŒ‰éˆ•ï¼ŒAIå°‡ç‚ºæ‚¨æ¨è–¦é©åˆçš„è…³æœ¬ä¸»é¡Œ</p>
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">4</div>
                      <div class="step-content">
                        <strong>ç”Ÿæˆè…³æœ¬</strong>
                        <p>é»æ“Šã€Œä¸€éµç”Ÿæˆè…³æœ¬ã€æŒ‰éˆ•ï¼ŒAIå°‡ç”Ÿæˆå®Œæ•´çš„çŸ­å½±éŸ³è…³æœ¬</p>
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">5</div>
                      <div class="step-content">
                        <strong>å„²å­˜æˆ–é‡æ–°ç”Ÿæˆ</strong>
                        <p>æ»¿æ„çµæœå¯é»æ“Šã€Œå„²å­˜ã€ï¼Œä¸æ»¿æ„å¯é»æ“Šã€Œå†æ›ä¸€å€‹ã€é‡æ–°ç”Ÿæˆ</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- å³åŠéƒ¨ï¼šä¸€éµç”Ÿæˆçµæœå€å¡Š -->
              <div class="mode1-right">
                <h2 class="section-title">
                  <span>ğŸš€</span>
                  ä¸€éµç”Ÿæˆè…³æœ¬
                </h2>
                <!-- é€™è£¡å°‡æ”¾ç½®åŸæœ‰çš„ä¸€éµç”ŸæˆåŠŸèƒ½ -->
                <div id="oneClickGenerationContainer">
                  <!-- åŸæœ‰çš„ä¸€éµç”Ÿæˆå…§å®¹å°‡ç§»å‹•åˆ°é€™è£¡ -->
                </div>
              </div>
            </div>
          </div>

          <!-- æ¨¡å¼2ï¼šAIé¡§å•å°è©±é é¢ -->
          <div id="mode2" class="page mode2 fig1">
            <div class="mode2-page">
              <!-- èªªæ˜æŒ‰éˆ• -->
              <div class="instructions-toggle-btn" onclick="toggleInstructionsDrawer()">
                <span class="btn-icon">ğŸ“‹</span>
                <span class="btn-text">ä½¿ç”¨èªªæ˜</span>
              </div>
              
              <!-- èªªæ˜æŠ½å±œèƒŒæ™¯é®ç½© -->
              <div id="drawerOverlay" class="drawer-overlay" onclick="toggleInstructionsDrawer()"></div>
              
              <!-- èªªæ˜æŠ½å±œ -->
              <div id="instructionsDrawer" class="instructions-drawer">
                <div class="drawer-header">
                  <h3>å¦‚ä½•ä½¿ç”¨ AI çŸ­å½±éŸ³é¡§å• ğŸš€</h3>
                  <button class="drawer-close-btn" onclick="toggleInstructionsDrawer()">âœ•</button>
                </div>
                <div class="drawer-content">
                  <p><strong>ğŸ¯ AIçŸ­å½±éŸ³é¡§å•æ¨¡å¼</strong></p>
                  <p>é€éèˆ‡AIæ·±åº¦å°è©±ï¼Œç²å¾—å°ˆæ¥­çš„çŸ­å½±éŸ³å‰µä½œæŒ‡å°å’Œç­–ç•¥å»ºè­°ã€‚</p>
                  
                  <p><strong>ğŸš€ æ“ä½œæ­¥é©Ÿï¼š</strong></p>
                  <div class="step-guide">
                    <div class="step">
                      <div class="step-number">1</div>
                      <div class="step-content">
                        <strong>æè¿°éœ€æ±‚</strong><br>
                        å‘Šè¨´AIä½ çš„ç›®æ¨™ã€å—çœ¾ã€å…§å®¹æ–¹å‘æˆ–é‡åˆ°çš„å•é¡Œ
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">2</div>
                      <div class="step-content">
                        <strong>æ·±åº¦å°è©±</strong><br>
                        èˆ‡AIé€²è¡Œå¤šè¼ªå°è©±ï¼Œæ·±å…¥æ¢è¨å‰µä½œç­–ç•¥å’ŒåŸ·è¡Œæ–¹æ¡ˆ
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">3</div>
                      <div class="step-content">
                        <strong>ç²å¾—å»ºè­°</strong><br>
                        AIæä¾›å°ˆæ¥­çš„å¸³è™Ÿå®šä½ã€é¸é¡Œå»ºè­°ã€è…³æœ¬å‰µä½œæŒ‡å°
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">4</div>
                      <div class="step-content">
                        <strong>æŒçºŒå„ªåŒ–</strong><br>
                        æ ¹æ“šAIå»ºè­°èª¿æ•´å…§å®¹ï¼Œç›´åˆ°é”åˆ°ç†æƒ³æ•ˆæœ
                      </div>
                    </div>
                  </div>
                  
                  <p><strong>ğŸ’¡ å°ˆæ¥­æœå‹™ï¼š</strong></p>
                  <ul>
                    <li>ğŸ¯ å¸³è™Ÿå®šä½ç­–ç•¥åˆ†æ</li>
                    <li>ğŸ“ å…§å®¹é¸é¡Œå»ºè­°</li>
                    <li>âœï¸ è…³æœ¬å‰µä½œæŒ‡å°</li>
                    <li>ğŸ“Š æ•¸æ“šåˆ†æè§£è®€</li>
                    <li>ğŸš€ çˆ†æ¬¾å…§å®¹ç­–ç•¥</li>
                    <li>ğŸ‘¥ å—çœ¾åˆ†ææ´å¯Ÿ</li>
                  </ul>
                  
                  <p><strong>ğŸ’¬ ä½¿ç”¨æŠ€å·§ï¼š</strong></p>
                  <p>â€¢ è©³ç´°æè¿°ä½ çš„èƒŒæ™¯å’Œç›®æ¨™<br>
                  â€¢ æå‡ºå…·é«”å•é¡Œç²å¾—ç²¾æº–å»ºè­°<br>
                  â€¢ å¤šè¼ªå°è©±æ·±å…¥æ¢è¨ç´°ç¯€<br>
                  â€¢ å–„ç”¨å¿«é€ŸæŒ‰éˆ•å¿«é€Ÿé–‹å§‹å°è©±</p>
                </div>
              </div>
              
              <!-- èŠå¤©è¨Šæ¯å€åŸŸ -->
              <div id="chatMessages" class="chat-messages">
                <!-- èŠå¤©è¨Šæ¯å°‡åœ¨é€™è£¡å‹•æ…‹æ’å…¥ -->
              </div>
              
              <!-- å¿«é€ŸæŒ‰éˆ•å€åŸŸ -->
              <div class="quick-buttons" id="quickButtons">
                <button class="quick-btn" data-text="æˆ‘è¦å¦‚ä½•é–‹å§‹ï¼Ÿ">æˆ‘è¦å¦‚ä½•é–‹å§‹ï¼Ÿ</button>
                <button class="quick-btn" data-text="æˆ‘è¦æ€éº¼å¸³è™Ÿå®šä½">æˆ‘è¦æ€éº¼å¸³è™Ÿå®šä½</button>
                <button class="quick-btn" data-text="ä»€éº¼æ˜¯è…³æœ¬é¸é¡Œ">ä»€éº¼æ˜¯è…³æœ¬é¸é¡Œ</button>
              </div>
              
              <!-- è¼¸å…¥å€åŸŸ -->
              <div class="input-row">
                <textarea id="messageInput" class="chat-input" placeholder="å‘AIé¡§å•æå•..." rows="1"></textarea>
                <button id="sendBtn" class="send-btn" disabled>
                  <i class="fas fa-paper-plane"></i>
                </button>
              </div>
              
              </div>
            </div>
          </div>

          <!-- æ¨¡å¼3ï¼šIPäººè¨­è¦åŠƒé é¢ -->
          <div id="mode3" class="page mode3-fixed">
            <div class="mode3-page">
              <!-- ä½¿ç”¨èªªæ˜æŒ‰éˆ• -->
              <div class="mode3-instructions-btn-container">
                <button class="mode3-instructions-btn" onclick="toggleMode3InstructionsDrawer()">
                  <span class="mode3-instructions-icon">ğŸ“‹</span>
                  <span class="mode3-instructions-text">ä½¿ç”¨èªªæ˜</span>
                </button>
                    </div>
              
              <!-- ç”ŸæˆçµæœæŒ‰éˆ• -->
              <div class="mode3-results-btn-container">
                <button class="mode3-results-btn" onclick="toggleMode3ResultsDrawer()">
                  <span class="mode3-results-icon">ğŸ“Š</span>
                  <span class="mode3-results-text">ç”Ÿæˆçµæœ</span>
                </button>
                  </div>

                  <!-- èŠå¤©å€åŸŸ -->
                  <div class="mode3-chat-container">
                    <div class="mode3-chat-messages" id="mode3-chat-messages">
                      <div class="mode3-message mode3-assistant-message">
                        <div class="mode3-message-avatar">ğŸ¤–</div>
                        <div class="mode3-message-content">
                          <p>æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„IPäººè¨­è¦åŠƒé¡§å•ã€‚è®“æˆ‘å€‘é–‹å§‹å»ºç«‹æ‚¨çš„å€‹äººå“ç‰Œæª”æ¡ˆå§ï¼</p>
                          <p>è«‹å‘Šè¨´æˆ‘ï¼š</p>
                          <ul>
                            <li>æ‚¨çš„è·æ¥­èƒŒæ™¯å’Œå°ˆé•·é ˜åŸŸ</li>
                            <li>æ‚¨å¸Œæœ›åˆ†äº«çš„åƒ¹å€¼è§€æˆ–ç†å¿µ</li>
                            <li>æ‚¨çš„ç›®æ¨™å—çœ¾æ˜¯èª°</li>
                            <li>æ‚¨å¸Œæœ›åœ¨çŸ­å½±éŸ³ä¸­å±•ç¾ä»€éº¼æ¨£çš„å½¢è±¡</li>
                          </ul>
                        </div>
                      </div>
                    </div>

                    <!-- å¿«é€ŸæŒ‰éˆ• -->
                    <div class="mode3-quick-buttons">
                      <button class="mode3-quick-btn" onclick="sendMode3Message('æˆ‘æƒ³åˆ†äº«æˆ‘çš„å°ˆæ¥­ç¶“é©—')">å°ˆæ¥­ç¶“é©—</button>
                      <button class="mode3-quick-btn" onclick="sendMode3Message('æˆ‘æƒ³å»ºç«‹å€‹äººå“ç‰Œ')">å€‹äººå“ç‰Œ</button>
                      <button class="mode3-quick-btn" onclick="sendMode3Message('æˆ‘æƒ³åˆ†äº«ç”Ÿæ´»æ•…äº‹')">ç”Ÿæ´»æ•…äº‹</button>
                      <button class="mode3-quick-btn" onclick="sendMode3Message('æˆ‘æƒ³åšçŸ¥è­˜åˆ†äº«')">çŸ¥è­˜åˆ†äº«</button>
                    </div>

                    <!-- è¼¸å…¥å€åŸŸ -->
                    <div class="mode3-input-container">
                      <div class="mode3-input-wrapper">
                        <textarea 
                          id="mode3-message-input" 
                          class="mode3-message-input" 
                          placeholder="è«‹æè¿°æ‚¨çš„èƒŒæ™¯ã€å°ˆé•·ã€åƒ¹å€¼è§€æˆ–ç›®æ¨™..."
                          rows="2"
                        ></textarea>
                        <button class="mode3-send-btn" onclick="sendMode3Message()">
                          <i class="fas fa-paper-plane"></i>
                        </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- å‰µä½œè€…è³‡æ–™åº«é é¢ -->
          <div id="userDB" class="page">
            <div class="user-db-page">
              <h2 class="page-title">ğŸ‘¤ å‰µä½œè€…è³‡æ–™åº«</h2>
              <div class="user-db-container">
                <!-- å·¦å´åŠŸèƒ½é¸å–® -->
                <div class="user-db-sidebar">
                  <div class="sidebar-header">
                    <div class="user-profile">
                      <img id="dbUserAvatar" class="profile-avatar" src="" alt="ç”¨æˆ¶é ­åƒ">
                      <div class="profile-info">
                        <h3 id="dbUserName">ç”¨æˆ¶åç¨±</h3>
                        <p id="dbUserEmail">user@example.com</p>
                      </div>
                    </div>
                  </div>
                  <nav class="sidebar-menu">
                    <div class="menu-item" onclick="showDbSection('personalInfo')">
                      <span class="menu-icon">ğŸ‘¤</span>
                      <span class="menu-text">å€‹äººè³‡æ–™</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('myScripts')">
                      <span class="menu-icon">ğŸ’¾</span>
                      <span class="menu-text">æˆ‘çš„è…³æœ¬</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('accountPositioning')">
                      <span class="menu-icon">ğŸ¯</span>
                      <span class="menu-text">å¸³è™Ÿå®šä½</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('topicRecords')">
                      <span class="menu-icon">ğŸ’¡</span>
                      <span class="menu-text">é¸é¡Œè¨˜éŒ„</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('settings')">
                      <span class="menu-icon">âš™ï¸</span>
                      <span class="menu-text">è¨­å®š</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('usageStats')">
                      <span class="menu-icon">ğŸ“Š</span>
                      <span class="menu-text">ä½¿ç”¨çµ±è¨ˆ</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('helpCenter')">
                      <span class="menu-icon">â“</span>
                      <span class="menu-text">å¹«åŠ©ä¸­å¿ƒ</span>
                    </div>
                    <div class="menu-divider"></div>
                    <div class="menu-item logout-item" onclick="logout()">
                      <span class="menu-icon">ğŸšª</span>
                      <span class="menu-text">ç™»å‡º</span>
                    </div>
                  </nav>
                </div>
                <!-- å³å´å…§å®¹å€åŸŸ -->
                <div class="user-db-content">
                  <!-- å€‹äººè³‡æ–™ -->
                  <div id="db-personalInfo" class="db-section active">
                    <h3 class="section-title">ğŸ‘¤ å€‹äººè³‡æ–™</h3>
                    <div class="section-content">
                      <p>å€‹äººè³‡æ–™åŠŸèƒ½é–‹ç™¼ä¸­...</p>
                    </div>
                  </div>
                  <!-- æˆ‘çš„è…³æœ¬ -->
                  <div id="db-myScripts" class="db-section">
                    <h3 class="section-title">ğŸ’¾ æˆ‘çš„è…³æœ¬</h3>
                    <div class="section-content">
                      <p>æˆ‘çš„è…³æœ¬åŠŸèƒ½é–‹ç™¼ä¸­...</p>
                    </div>
                  </div>
                  <!-- å¸³è™Ÿå®šä½ -->
                  <div id="db-accountPositioning" class="db-section">
                    <h3 class="section-title">ğŸ¯ å¸³è™Ÿå®šä½</h3>
                    <div class="section-content">
                      <p>å¸³è™Ÿå®šä½åŠŸèƒ½é–‹ç™¼ä¸­...</p>
                    </div>
                  </div>
                  <!-- é¸é¡Œè¨˜éŒ„ -->
                  <div id="db-topicRecords" class="db-section">
                    <h3 class="section-title">ğŸ’¡ é¸é¡Œè¨˜éŒ„</h3>
                    <div class="section-content">
                      <p>é¸é¡Œè¨˜éŒ„åŠŸèƒ½é–‹ç™¼ä¸­...</p>
                    </div>
                  </div>
                  <!-- è¨­å®š -->
                  <div id="db-settings" class="db-section">
                    <h3 class="section-title">âš™ï¸ è¨­å®š</h3>
                    <div class="section-content" id="settingsContent">
                      <div class="settings-container">
                        <div class="setting-group">
                          <h4>ğŸ“‹ é€šçŸ¥è¨­å®š</h4>
                          <div class="setting-item">
                            <label>
                              <input type="checkbox" checked> æ–°åŠŸèƒ½é€šçŸ¥
                            </label>
                            <span class="setting-desc">æ¥æ”¶æ–°åŠŸèƒ½ä¸Šç·šé€šçŸ¥</span>
                          </div>
                          <div class="setting-item">
                            <label>
                              <input type="checkbox" checked> ç³»çµ±å…¬å‘Š
                            </label>
                            <span class="setting-desc">æ¥æ”¶é‡è¦ç³»çµ±å…¬å‘Š</span>
                          </div>
                        </div>
                        
                        <div class="setting-group">
                          <h4>ğŸ¨ é¡¯ç¤ºåå¥½</h4>
                          <div class="setting-item">
                            <label for="theme">ä¸»é¡Œ</label>
                            <select id="theme">
                              <option value="light" selected>æ·ºè‰²æ¨¡å¼</option>
                              <option value="dark">æ·±è‰²æ¨¡å¼</option>
                              <option value="auto">è‡ªå‹•</option>
                            </select>
                          </div>
                          <div class="setting-item">
                            <label for="language">èªè¨€</label>
                            <select id="language">
                              <option value="zh-TW" selected>ç¹é«”ä¸­æ–‡</option>
                              <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                              <option value="en">English</option>
                            </select>
                          </div>
                        </div>
                        
                        <div class="setting-group">
                          <h4>ğŸ“Š æ•¸æ“šç®¡ç†</h4>
                          <div class="setting-item">
                            <button class="btn btn-secondary" onclick="exportUserData()">ğŸ“¥ åŒ¯å‡ºæˆ‘çš„è³‡æ–™</button>
                            <span class="setting-desc">åŒ¯å‡ºæ‰€æœ‰è…³æœ¬ã€å°è©±ã€å®šä½è¨˜éŒ„</span>
                          </div>
                          <div class="setting-item">
                            <button class="btn btn-danger" onclick="clearUserData()">ğŸ—‘ï¸ æ¸…é™¤æœ¬åœ°å¿«å–</button>
                            <span class="setting-desc">æ¸…é™¤æœ¬åœ°æš«å­˜æ•¸æ“š</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- ä½¿ç”¨çµ±è¨ˆ -->
                  <div id="db-usageStats" class="db-section">
                    <h3 class="section-title">ğŸ“Š ä½¿ç”¨çµ±è¨ˆ</h3>
                    <div class="section-content" id="usageStatsContent">
                      <div class="stats-overview">
                        <div class="stat-card">
                          <div class="stat-number" id="totalScripts">0</div>
                          <div class="stat-label">å·²ç”Ÿæˆè…³æœ¬</div>
                        </div>
                        <div class="stat-card">
                          <div class="stat-number" id="totalPositioning">0</div>
                          <div class="stat-label">å¸³è™Ÿå®šä½è¨˜éŒ„</div>
                        </div>
                        <div class="stat-card">
                          <div class="stat-number" id="totalTopics">0</div>
                          <div class="stat-label">é¸é¡Œè¨˜éŒ„</div>
                        </div>
                        <div class="stat-card">
                          <div class="stat-number" id="totalConversations">0</div>
                          <div class="stat-label">å°è©±æ¬¡æ•¸</div>
                        </div>
                      </div>
                      <div class="stats-chart">
                        <canvas id="usageChart"></canvas>
                      </div>
                    </div>
                  </div>
                  <!-- å¹«åŠ©ä¸­å¿ƒ -->
                  <div id="db-helpCenter" class="db-section">
                    <h3 class="section-title">â“ å¹«åŠ©ä¸­å¿ƒ</h3>
                    <div class="section-content" id="helpContent">
                      <div class="help-container">
                        <div class="help-section">
                          <h4>ğŸš€ å¿«é€Ÿé–‹å§‹</h4>
                          <ul>
                            <li>é¦–æ¬¡ä½¿ç”¨å»ºè­°å…ˆå˜—è©¦ã€Œä¸€éµç”Ÿæˆã€åŠŸèƒ½</li>
                            <li>é»æ“Šã€Œé–‹å§‹ã€æŒ‰éˆ•å³å¯ç”Ÿæˆå¸³è™Ÿå®šä½ã€é¸é¡Œã€è…³æœ¬</li>
                            <li>æ‰€æœ‰ç”Ÿæˆå…§å®¹æœƒè‡ªå‹•ä¿å­˜åˆ°ã€Œæˆ‘çš„è…³æœ¬ã€</li>
                          </ul>
                        </div>
                        <div class="help-section">
                          <h4>ğŸ“ ä¸‰å¤§ä½¿ç”¨æ¨¡å¼</h4>
                          <ul>
                            <li><strong>ä¸€éµç”Ÿæˆï¼š</strong>å¿«é€Ÿç”Ÿæˆå®šä½ã€é¸é¡Œã€è…³æœ¬</li>
                            <li><strong>AIé¡§å•ï¼š</strong>æ·±åº¦å°è©±ï¼Œå…·å‚™è¨˜æ†¶åŠŸèƒ½</li>
                            <li><strong>IPäººè¨­è¦åŠƒï¼š</strong>14å¤©è¦åŠƒèˆ‡å€‹äººåŒ–è³‡æ–™åº«</li>
                          </ul>
                        </div>
                        <div class="help-section">
                          <h4>ğŸ’¾ è³‡æ–™åº«åŠŸèƒ½</h4>
                          <ul>
                            <li>æ‰€æœ‰ç”Ÿæˆå…§å®¹è‡ªå‹•ä¿å­˜</li>
                            <li>å¯åœ¨ã€Œå‰µä½œè€…è³‡æ–™åº«ã€æŸ¥çœ‹æ­·å²è¨˜éŒ„</li>
                            <li>æ”¯æŒé‡å‘½åã€åˆªé™¤ã€æŸ¥çœ‹è©³æƒ…</li>
                          </ul>
                        </div>
                        <div class="help-section">
                          <h4>â“ å¸¸è¦‹å•é¡Œ</h4>
                          <div class="faq-item">
                            <strong>Q: å¦‚ä½•ä¿å­˜è…³æœ¬ï¼Ÿ</strong>
                            <p>A: é»æ“Šç”Ÿæˆçµæœå³ä¸Šè§’çš„ã€Œä¿å­˜ã€æŒ‰éˆ•å³å¯ã€‚</p>
                          </div>
                          <div class="faq-item">
                            <strong>Q: å¯ä»¥åŒ¯å‡ºè³‡æ–™å—ï¼Ÿ</strong>
                            <p>A: å¯ä»¥ï¼Œåœ¨ã€Œè¨­å®šã€â†’ã€Œè³‡æ–™ç®¡ç†ã€ä¸­é¸æ“‡åŒ¯å‡ºã€‚</p>
                          </div>
                          <div class="faq-item">
                            <strong>Q: å¦‚ä½•åˆªé™¤è¨˜éŒ„ï¼Ÿ</strong>
                            <p>A: åœ¨ã€Œå‰µä½œè€…è³‡æ–™åº«ã€ä¸­æ‰¾åˆ°å°æ‡‰è¨˜éŒ„ï¼Œé»æ“Šåˆªé™¤æŒ‰éˆ•ã€‚</p>
                          </div>
                        </div>
                        <div class="help-section">
                          <h4>ğŸ“ è¯çµ¡æˆ‘å€‘</h4>
                          <p>å¦‚æœ‰å•é¡Œï¼Œè«‹è¯ç¹«å®¢æœï¼š</p>
                          <ul>
                            <li>Email: support@aijob.com</li>
                            <li>Discord: <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank">åŠ å…¥ç¤¾ç¾¤</a></li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- å´é‚Šæ¬„ -->
      <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h3 class="sidebar-title">åŠŸèƒ½é¸å–®</h3>
          <button class="sidebar-close" onclick="toggleSidebar()">Ã—</button>
        </div>
        <div class="sidebar-menu">
          <button class="sidebar-item" onclick="showSidebarPage('profile')">ğŸ‘¤ å€‹äººè³‡æ–™</button>
          <button class="sidebar-item" onclick="showSidebarPage('scripts')">ğŸ“ æˆ‘çš„è…³æœ¬</button>
          <button class="sidebar-item" onclick="showSidebarPage('positioning')">ğŸ¯ å¸³è™Ÿå®šä½</button>
          <button class="sidebar-item" onclick="showSidebarPage('topics')">ğŸ’¡ é¸é¡Œè¨˜éŒ„</button>
          <button class="sidebar-item" onclick="showSidebarPage('settings')">âš™ï¸ è¨­å®š</button>
          <button class="sidebar-item" onclick="showSidebarPage('statistics')">ğŸ“Š ä½¿ç”¨çµ±è¨ˆ</button>
          <button class="sidebar-item" onclick="showSidebarPage('help')">â“ å¹«åŠ©ä¸­å¿ƒ</button>
        </div>
      </div>

      <!-- å´é‚Šæ¬„é é¢å®¹å™¨ -->
      <div class="sidebar-page-overlay" id="sidebarPageOverlay" style="display: none;">
        <div class="sidebar-page-container">
          <div class="sidebar-page-header">
            <h2 id="sidebarPageTitle">é é¢æ¨™é¡Œ</h2>
            <button class="sidebar-page-close" onclick="closeSidebarPage()">Ã—</button>
          </div>
          <div class="sidebar-page-content" id="sidebarPageContent">
            <!-- é é¢å…§å®¹å°‡å‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
          </div>
        </div>
      </div>

    </div>
          <div class="left-content">
            <!-- ç”¨æˆ¶éœ€æ±‚è¨­å®šå€å¡Š -->
      <div class="settings-block">
              <h3 id="settingsToggle">ğŸ“‹ ç”¨æˆ¶éœ€æ±‚è¨­å®š <span class="settings-toggle">â–¼</span></h3>
        <div class="settings-content" id="settingsContent">
          <div class="settings-grid">
          <div class="setting-item">
            <label>å¹³å°</label>
                    <select id="platformSelect">
              <option value="">é¸æ“‡å¹³å°</option>
              <option value="TikTok">TikTok</option>
                      <option value="Instagram">Instagram Reels</option>
                      <option value="YouTube">YouTube Shorts</option>
                      <option value="Facebook">Facebook Reels</option>
            </select>
          </div>
          <div class="setting-item">
            <label>ä¸»é¡Œ</label>
                    <input type="text" id="topicInput" placeholder="ä¾‹å¦‚:å¤å­£è®Šç™½æŒ‘æˆ°/ç¾ç™½ä¿é¤Š">
          </div>
          <div class="setting-item">
            <label>è…³æœ¬ç§’æ•¸</label>
                    <select id="durationInput">
                      <option value="15ç§’">15ç§’</option>
                      <option value="30ç§’" selected>30ç§’</option>
                      <option value="45ç§’">45ç§’</option>
                      <option value="60ç§’">60ç§’</option>
            </select>
          </div>
          <div class="setting-item">
            <label>å¸³è™Ÿå®šä½</label>
                    <input type="text" id="positioningInput" placeholder="å¦‚:å¥åº·Ã—åŠ å¯†,è¼•é¬†å¹½é»˜">
          </div>
        </div>
                <button id="applyBtn" class="apply-btn">å¥—ç”¨è¨­å®š</button>
          </div>
            </div>

          </div>
        </div>

        <!-- å³å´é¢æ¿ï¼šçµæœå€å¡Šï¼ˆå¯åˆ‡æ›ï¼‰ -->
        <div class="right-panel">
          <!-- çµæœæ¨™ç±¤åˆ‡æ› -->
          <div class="result-tabs">
            <button class="result-tab active" data-tab="positioning">ğŸ¯ å¸³è™Ÿå®šä½</button>
            <button class="result-tab" data-tab="topics">ğŸ’¡ è…³æœ¬é¸é¡Œ</button>
            <button class="result-tab" data-tab="script">ğŸ“ çŸ­å½±éŸ³è…³æœ¬</button>
          </div>
          
          <!-- çµæœå€å¡Šå®¹å™¨ -->
          <div class="results-container">
            <!-- å¸³è™Ÿå®šä½çµæœ -->
            <div id="positioningResult" class="result-content" style="display: block;">
              <div class="result-header">
                <h3>å¸³è™Ÿå®šä½åˆ†æ</h3>
                <button class="generate-btn" onclick="generatePositioning()">ä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½</button>
              </div>
              <div id="positioningContent" class="result-body">
                é»æ“Šã€Œä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½ã€æŒ‰éˆ•é–‹å§‹åˆ†æ...
              </div>
              <div class="result-actions" id="positioningActions" style="display: none;">
                <button class="save-btn" onclick="saveResult('positioning')">å„²å­˜</button>
                <button class="regenerate-btn" onclick="regenerateResult('positioning')">å†æ›ä¸€å€‹</button>
              </div>
            </div>
            
            <!-- è…³æœ¬é¸é¡Œçµæœ -->
            <div id="topicSelectionResult" class="result-content" style="display: none;">
              <div class="result-header">
                <h3>è…³æœ¬é¸é¡Œæ¨è–¦</h3>
                <button class="generate-btn" onclick="generateTopics()">ä¸€éµç”Ÿæˆé¸é¡Œ</button>
              </div>
              <div id="topicContent" class="result-body">
                è«‹å…ˆå®Œæˆå¸³è™Ÿå®šä½ï¼Œå†é€²è¡Œé¸é¡Œæ¨è–¦...
              </div>
              <div class="result-actions" id="topicActions" style="display: none;">
                <button class="save-btn" onclick="saveResult('topics')">å„²å­˜</button>
                <button class="regenerate-btn" onclick="regenerateResult('topics')">å†æ›ä¸€å€‹</button>
              </div>
            </div>
            
            <!-- çŸ­å½±éŸ³è…³æœ¬çµæœ -->
            <div id="scriptResult" class="result-content" style="display: none;">
              <div class="result-header">
                <h3>çŸ­å½±éŸ³è…³æœ¬ç”Ÿæˆ</h3>
                <button class="generate-btn" onclick="generateScript()">ä¸€éµç”Ÿæˆè…³æœ¬</button>
              </div>
              <div id="scriptContent" class="result-body">
                è«‹å…ˆå®Œæˆå¸³è™Ÿå®šä½å’Œé¸é¡Œï¼Œå†ç”Ÿæˆè…³æœ¬...
              </div>
              <div class="result-actions" id="scriptActions" style="display: none;">
                <button class="save-btn" onclick="saveScript()">å„²å­˜</button>
                <button class="regenerate-btn" onclick="regenerateResult('script')">å†æ›ä¸€å€‹</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ç”¨æˆ¶æŠ½å±œ -->
      <div id="userDrawerOverlay" class="user-drawer-overlay" onclick="closeUserDrawer()"></div>
      <div id="userDrawer" class="user-drawer">
        <!-- æ¨™é¡Œæ¬„ -->
        <div class="user-drawer-header">
          <div class="user-drawer-title">
            <div class="app-logo">AIJob</div>
            <span class="app-name">çŸ­å½±éŸ³é¡§å•</span>
          </div>
          <button class="user-drawer-close" onclick="closeUserDrawer()">Ã—</button>
        </div>
        
        <!-- å·¦å³å…©æ¬„å¸ƒå±€ -->
        <div class="user-drawer-body">
          <!-- å·¦å´é¸å–® -->
          <div class="user-drawer-sidebar">
            <div class="user-profile">
              <img id="drawerAvatar" class="user-drawer-avatar" src="" alt="ç”¨æˆ¶é ­åƒ">
              <div class="user-drawer-info">
                <h3 id="drawerName">ç”¨æˆ¶åç¨±</h3>
                <p id="drawerEmail">user@example.com</p>
              </div>
            </div>
            
            <ul class="user-drawer-menu">
              <li><a href="#" class="active" data-section="personalInfo" onclick="switchDrawerContent('personalInfo')"><span class="icon">ğŸ‘¤</span>å€‹äººè³‡æ–™</a></li>
              <li><a href="#" data-section="myScripts" onclick="switchDrawerContent('myScripts')"><span class="icon">ğŸ’¾</span>æˆ‘çš„è…³æœ¬</a></li>
              <li><a href="#" data-section="accountPositioning" onclick="switchDrawerContent('accountPositioning')"><span class="icon">ğŸ¯</span>å¸³è™Ÿå®šä½</a></li>
              <li><a href="#" data-section="topicHistory" onclick="switchDrawerContent('topicHistory')"><span class="icon">ğŸ’¡</span>é¸é¡Œè¨˜éŒ„</a></li>
              <li><a href="#" data-section="settings" onclick="switchDrawerContent('settings')"><span class="icon">âš™ï¸</span>è¨­å®š</a></li>
              <li><a href="#" data-section="usageStats" onclick="switchDrawerContent('usageStats')"><span class="icon">ğŸ“Š</span>ä½¿ç”¨çµ±è¨ˆ</a></li>
              <li><a href="#" data-section="helpCenter" onclick="switchDrawerContent('helpCenter')"><span class="icon">â“</span>å¹«åŠ©ä¸­å¿ƒ</a></li>
            </ul>
          </div>
          
          <!-- å³å´å…§å®¹å€åŸŸ -->
          <div class="user-drawer-content">
            <!-- å€‹äººè³‡æ–™ -->
            <div id="personalInfo" class="content-section active">
              <h2>å€‹äººè³‡æ–™</h2>
              <div class="user-info-detail">
                <div class="info-item">
                  <label>å§“åï¼š</label>
                  <span id="userNameDetail">-</span>
                </div>
                <div class="info-item">
                  <label>ä¿¡ç®±ï¼š</label>
                  <span id="userEmailDetail">-</span>
                </div>
                <div class="info-item">
                  <label>ç”¨æˆ¶IDï¼š</label>
                  <span id="userIdDetail">-</span>
                </div>
              </div>
            </div>
            
            <!-- æˆ‘çš„è…³æœ¬ -->
            <div id="myScripts" class="content-section">
              <h2>æˆ‘çš„è…³æœ¬</h2>
              <div id="generationsList" class="generations-list">
                <div class="loading-text">è¼‰å…¥ä¸­...</div>
              </div>
            </div>
            
            <!-- å¸³è™Ÿå®šä½ -->
            <div id="accountPositioning" class="content-section">
              <h2>å¸³è™Ÿå®šä½è¨˜éŒ„</h2>
              <div id="positioningHistoryContent" class="positioning-history-content">
                <div class="loading-text">è¼‰å…¥ä¸­...</div>
              </div>
            </div>
            
            <!-- é¸é¡Œè¨˜éŒ„ -->
            <div id="topicHistory" class="content-section">
              <h2>é¸é¡Œè¨˜éŒ„</h2>
              <div id="conversationsList" class="conversations-list">
                <div class="loading-text">è¼‰å…¥ä¸­...</div>
              </div>
            </div>
            
            <!-- è¨­å®š -->
            <div id="settings" class="content-section">
              <h2>è¨­å®š</h2>
              <div class="settings-content">
                <p>è¨­å®šåŠŸèƒ½é–‹ç™¼ä¸­...</p>
              </div>
            </div>
            
            <!-- ä½¿ç”¨çµ±è¨ˆ -->
            <div id="usageStats" class="content-section">
              <h2>ä½¿ç”¨çµ±è¨ˆ</h2>
              <div class="stats-content">
                <p>çµ±è¨ˆåŠŸèƒ½é–‹ç™¼ä¸­...</p>
              </div>
            </div>
            
            <!-- å¹«åŠ©ä¸­å¿ƒ -->
            <div id="helpCenter" class="content-section">
              <h2>å¹«åŠ©ä¸­å¿ƒ</h2>
              <div class="help-content">
                <p>å¹«åŠ©åŠŸèƒ½é–‹ç™¼ä¸­...</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- å½ˆè·³è¦–çª—ç™»å…¥è¦†è“‹å±¤ -->
      <div id="popupOverlay" class="popup-overlay">
        <div class="popup-content">
          <div id="popupSpinner" class="popup-spinner"></div>
          <div id="popupMessage" class="popup-message">æ­£åœ¨é–‹å•Ÿ Google ç™»å…¥è¦–çª—...</div>
          <div id="popupButtons" style="display: none;">
            <button id="popupRetry" class="popup-btn">é‡è©¦</button>
            <button id="popupCancel" class="popup-btn secondary">å–æ¶ˆ</button>
          </div>
        </div>
      </div>


      <div id="status" class="small"></div>
      
      <!-- çµæœå€å¡Š -->
      <div id="results" class="results-block">
        <h3>ğŸ“ çŸ­å½±éŸ³è…³æœ¬çµæœ</h3>
        <div class="result-item">
          <h4>ğŸ¯ ä¸»é¡Œ</h4>
          <div id="result-title" class="content">å°šæœªç”Ÿæˆ</div>
        </div>
        <div class="result-item">
          <h4>ğŸ“œ è…³æœ¬å…§å®¹</h4>
          <div id="result-script" class="content">å°šæœªç”Ÿæˆ</div>
        </div>
        <div class="result-item">
          <h4>ğŸ¬ ç•«é¢æ„Ÿ</h4>
          <div id="result-visual" class="content">å°šæœªç”Ÿæˆ</div>
        </div>
        <div class="result-item">
          <h4>ğŸ“± æ–‡æ¡ˆ</h4>
          <div id="result-copy" class="content">å°šæœªç”Ÿæˆ</div>
        </div>
      </div>
      
      <div class="small">2025 AIJobå­¸é™¢ç‰ˆæ¬Šæ‰€æœ‰</div>
    </div>

    <!-- å½ˆå‡ºæç¤ºæ¡† -->
    <div id="toast" class="toast" style="display: none;"></div>
    <script>
      // é é¢æ§åˆ¶å‡½æ•¸
      function switchPage(pageId) {
        console.log('switchPage called with:', pageId);
        
        // éœ€è¦è¨‚é–±æ‰èƒ½è¨ªå•çš„é é¢åˆ—è¡¨
        const protectedPages = ['mode1', 'mode2', 'mode3', 'userDB'];
        
        // æª¢æŸ¥æ˜¯å¦ç‚ºå—ä¿è­·çš„é é¢
        if (protectedPages.includes(pageId)) {
          const isSubscribed = document.body.dataset.subscribed === 'true';
          const isLoggedIn = ipPlanningToken && ipPlanningUser;
          
          console.log('å˜—è©¦è¨ªå•å—ä¿è­·é é¢:', pageId);
          console.log('è¨‚é–±ç‹€æ…‹:', isSubscribed);
          console.log('ç™»å…¥ç‹€æ…‹:', isLoggedIn);
          console.log('document.body.dataset.subscribed:', document.body.dataset.subscribed);
          
          // æœªç™»å…¥ï¼Œé¡¯ç¤ºç™»å…¥æç¤º
          if (!isLoggedIn) {
            console.warn('æœªç™»å…¥ - éœ€è¦ç™»å…¥');
            alert('è«‹å…ˆç™»å…¥ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½ï¼');
            goToLogin();
            // ä¿æŒé¦–é é¡¯ç¤º
            const homepage = document.getElementById('homepage');
            if (homepage) {
              homepage.classList.add('active');
            }
            return;
          }
          
          // å·²ç™»å…¥ä½†æœªè¨‚é–±ï¼ˆéœ€è¦è¨‚é–±æ‰èƒ½ä½¿ç”¨ï¼‰
          if (isLoggedIn && !isSubscribed) {
            console.warn('å·²ç™»å…¥ä½†æœªè¨‚é–± - å…è¨±è¨ªå•ï¼ˆè‡¨æ™‚ï¼‰');
            // æš«æ™‚å…è¨±è¨ªå•ï¼Œå› ç‚ºæ‰€æœ‰ç¾æœ‰ç”¨æˆ¶éƒ½æ‡‰è©²æ˜¯å·²è¨‚é–±ç‹€æ…‹
          }
        }
        
        // éš±è—æ‰€æœ‰é é¢
        document.querySelectorAll('.page').forEach(page => {
          page.classList.remove('active');
        });
        
        // é¡¯ç¤ºé¸ä¸­çš„é é¢
        const targetPage = document.getElementById(pageId);
        if (targetPage) {
          targetPage.classList.add('active');
          console.log('Switched to page:', pageId);
        } else {
          console.error('Page not found:', pageId);
        }
        
        // æ›´æ–°å°èˆªæ¨™ç±¤ç‹€æ…‹
        document.querySelectorAll('.navbar-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        
        // æ ¹æ“šé é¢IDè¨­ç½®å°æ‡‰æ¨™ç±¤ç‚ºactive
        const tabMap = {
          'homepage': 0,
          'mode1': 1,
          'mode2': 2,
          'mode3': 3,
          'forum': 4,
          'guide': 5,
          'userDB': 6,
          'guide-article1': null, // æ–‡ç« é é¢ä¸éœ€è¦å°èˆªåˆ—è®Šäº®
          'guide-article2': null,
          'guide-article3': null
        };
        
        if (tabMap[pageId] !== undefined && tabMap[pageId] !== null) {
          document.querySelectorAll('.navbar-tab')[tabMap[pageId]].classList.add('active');
        }
      }
      
      
      // AIèªªæ˜å€å¡Šæ§åˆ¶å‡½æ•¸ï¼ˆèˆŠç‰ˆï¼Œä¿ç•™ä»¥é˜²éœ€è¦ï¼‰
      function toggleInstructions() {
        const instructionList = document.querySelector('.instruction-list');
        const toggleIcon = document.querySelector('.instructions-toggle');
        const chatMessages = document.getElementById('chatMessages');
        
        if (instructionList && toggleIcon) {
          instructionList.classList.toggle('show');
          
          if (instructionList.classList.contains('show')) {
            toggleIcon.textContent = 'â–¼';
            // é¡¯ç¤ºæ™‚æ¢å¾©åŸå§‹é«˜åº¦
            if (chatMessages) chatMessages.style.minHeight = '600px';
          } else {
            toggleIcon.textContent = 'â–¶';
            // éš±è—æ™‚å»¶é•·èŠå¤©è¨Šæ¯å€é«˜åº¦
            if (chatMessages) chatMessages.style.minHeight = '800px';
          }
        }
      }
      
      // æŠ½å±œå¼èªªæ˜æ¬„ä½æ§åˆ¶å‡½æ•¸
      function toggleInstructionsDrawer() {
        const drawer = document.getElementById('instructionsDrawer');
        const overlay = document.getElementById('drawerOverlay');
        
        if (drawer && overlay) {
          const isOpen = drawer.classList.contains('open');
          
          if (isOpen) {
            // é—œé–‰æŠ½å±œ
            drawer.classList.remove('open');
            overlay.classList.remove('show');
          } else {
            // æ‰“é–‹æŠ½å±œ
            drawer.classList.add('open');
            overlay.classList.add('show');
          }
        }
      }
      
      // å´é‚Šæ¬„é é¢é¡¯ç¤ºå‡½æ•¸
      function showSidebarPage(pageType) {
        const overlay = document.getElementById('sidebarPageOverlay');
        const title = document.getElementById('sidebarPageTitle');
        const content = document.getElementById('sidebarPageContent');
        
        // è¨­ç½®é é¢æ¨™é¡Œ
        const pageTitles = {
          'profile': 'å€‹äººè³‡æ–™',
          'scripts': 'æˆ‘çš„è…³æœ¬',
          'positioning': 'å¸³è™Ÿå®šä½è¨˜éŒ„',
          'topics': 'é¸é¡Œè¨˜éŒ„',
          'settings': 'ç³»çµ±è¨­å®š',
          'statistics': 'ä½¿ç”¨çµ±è¨ˆ',
          'help': 'å¹«åŠ©ä¸­å¿ƒ'
        };
        
        title.textContent = pageTitles[pageType] || 'åŠŸèƒ½é é¢';
        
        // æ ¹æ“šé é¢é¡å‹è¼‰å…¥ç›¸æ‡‰å…§å®¹
        switch(pageType) {
          case 'profile':
            loadProfilePage(content);
            break;
          case 'scripts':
            loadScriptsPage(content);
            break;
          case 'positioning':
            loadPositioningPage(content);
            break;
          case 'topics':
            loadTopicsPage(content);
            break;
          case 'settings':
            loadSettingsPage(content);
            break;
          case 'statistics':
            loadStatisticsPage(content);
            break;
          case 'help':
            loadHelpPage(content);
            break;
          default:
            content.innerHTML = '<p>åŠŸèƒ½é–‹ç™¼ä¸­...</p>';
        }
        
        // é¡¯ç¤ºé é¢
        overlay.style.display = 'flex';
        
        // é—œé–‰å´é‚Šæ¬„
        toggleSidebar();
      }
      
      // é—œé–‰å´é‚Šæ¬„é é¢
      function closeSidebarPage() {
        document.getElementById('sidebarPageOverlay').style.display = 'none';
      }
      
      // è¼‰å…¥å€‹äººè³‡æ–™é é¢
      function loadProfilePage(container) {
        // æ ¼å¼åŒ–æ³¨å†Œæ—¶é—´
        let registrationTime = 'æœªçŸ¥';
        if (ipPlanningUser?.created_at) {
          try {
            const date = new Date(ipPlanningUser.created_at);
            if (!isNaN(date.getTime())) {
              registrationTime = date.toLocaleString('zh-TW', {
                timeZone: 'Asia/Taipei',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
              });
            }
          } catch (e) {
            registrationTime = ipPlanningUser.created_at;
          }
        }
        
        container.innerHTML = `
          <div class="profile-content">
            <div class="profile-section">
              <h3>ç”¨æˆ¶è³‡è¨Š</h3>
              <div class="user-details">
                <div class="detail-item">
                  <label>å§“åï¼š</label>
                  <span id="profileName">${ipPlanningUser?.name || 'æœªè¨­å®š'}</span>
                </div>
                <div class="detail-item">
                  <label>Emailï¼š</label>
                  <span id="profileEmail">${ipPlanningUser?.email || 'æœªè¨­å®š'}</span>
                </div>
                <div class="detail-item">
                  <label>è¨»å†Šæ™‚é–“ï¼š</label>
                  <span id="profileDate">${registrationTime}</span>
                </div>
              </div>
            </div>
            <div class="profile-section">
              <h3>ä½¿ç”¨çµ±è¨ˆ</h3>
              <div class="stats-grid">
                <div class="stat-item">
                  <div class="stat-number">${getLocalScripts().length}</div>
                  <div class="stat-label">å·²ç”Ÿæˆè…³æœ¬</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number">${getLocalPositioning().length}</div>
                  <div class="stat-label">å¸³è™Ÿå®šä½</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number">${getLocalTopics().length}</div>
                  <div class="stat-label">é¸é¡Œè¨˜éŒ„</div>
                </div>
              </div>
            </div>
          </div>
        `;
      }
      
      // è¼‰å…¥æˆ‘çš„è…³æœ¬é é¢
      function loadScriptsPage(container) {
        const scripts = getLocalScripts();
        if (scripts.length === 0) {
          container.innerHTML = '<p>å°šæœªç”Ÿæˆä»»ä½•è…³æœ¬</p>';
          return;
        }
        
        let html = '<div class="scripts-list">';
        scripts.forEach(script => {
          const date = new Date(script.created_at).toLocaleDateString('zh-TW');
          html += `
            <div class="script-item">
              <div class="script-header">
                <h4>${script.name || 'æœªå‘½åè…³æœ¬'}</h4>
                <span class="script-date">${date}</span>
              </div>
              <div class="script-preview">${script.content ? script.content.substring(0, 100) + '...' : 'ç„¡å…§å®¹'}</div>
              <div class="script-actions">
                <button onclick="viewScript(${script.id})" class="btn-primary">æŸ¥çœ‹</button>
                <button onclick="deleteScript(${script.id})" class="btn-danger">åˆªé™¤</button>
              </div>
            </div>
          `;
        });
        html += '</div>';
        container.innerHTML = html;
      }
      
      // è¼‰å…¥å¸³è™Ÿå®šä½é é¢
      function loadPositioningPage(container) {
        container.innerHTML = '<p>å¸³è™Ÿå®šä½è¨˜éŒ„åŠŸèƒ½é–‹ç™¼ä¸­...</p>';
      }
      
      // è¼‰å…¥é¸é¡Œè¨˜éŒ„é é¢
      function loadTopicsPage(container) {
        container.innerHTML = '<p>é¸é¡Œè¨˜éŒ„åŠŸèƒ½é–‹ç™¼ä¸­...</p>';
      }
      
      // è¼‰å…¥è¨­å®šé é¢
      function loadSettingsPage(container) {
        container.innerHTML = '<p>ç³»çµ±è¨­å®šåŠŸèƒ½é–‹ç™¼ä¸­...</p>';
      }
      
      // è¼‰å…¥çµ±è¨ˆé é¢
      function loadStatisticsPage(container) {
        container.innerHTML = '<p>ä½¿ç”¨çµ±è¨ˆåŠŸèƒ½é–‹ç™¼ä¸­...</p>';
      }
      
      // è¼‰å…¥å¹«åŠ©é é¢
      function loadHelpPage(container) {
        container.innerHTML = `
          <div class="help-content">
            <h3>ä½¿ç”¨æŒ‡å—</h3>
            <div class="help-section">
              <h4>ä¸€éµç”Ÿæˆæ¨¡å¼</h4>
              <p>1. åœ¨å·¦å´è¨­å®šæ‚¨çš„éœ€æ±‚ï¼ˆå¹³å°ã€ä¸»é¡Œã€ç§’æ•¸ã€å¸³è™Ÿå®šä½ï¼‰</p>
              <p>2. é»æ“Šã€Œå¥—ç”¨è¨­å®šã€</p>
              <p>3. åœ¨å³å´ä¾åºé»æ“Šç”ŸæˆæŒ‰éˆ•</p>
              <p>4. å„²å­˜æˆ–é‡æ–°ç”Ÿæˆ</p>
            </div>
            <div class="help-section">
              <h4>AIé¡§å•å°è©±æ¨¡å¼</h4>
              <p>1. ç›´æ¥èˆ‡AIé€²è¡Œå°è©±</p>
              <p>2. è¨è«–å…§å®¹ç­–ç•¥å’Œå‰µæ„</p>
              <p>3. AIå”åŠ©ç”Ÿæˆè…³æœ¬</p>
            </div>
            <div class="help-section">
              <h4>å¸¸è¦‹å•é¡Œ</h4>
              <p><strong>Q: å¦‚ä½•å„²å­˜è…³æœ¬ï¼Ÿ</strong></p>
              <p>A: ç”Ÿæˆå®Œæˆå¾Œé»æ“Šã€Œå„²å­˜ã€æŒ‰éˆ•å³å¯</p>
              <p><strong>Q: å¦‚ä½•æŸ¥çœ‹å·²å„²å­˜çš„è…³æœ¬ï¼Ÿ</strong></p>
              <p>A: é»æ“Šå³å´åŠŸèƒ½æŒ‰éˆ•ï¼Œé¸æ“‡ã€Œæˆ‘çš„è…³æœ¬ã€</p>
            </div>
          </div>
        `;
      }
      
      // å®šæœŸæª¢æŸ¥ token ç‹€æ…‹ï¼ˆæ¯åˆ†é˜æª¢æŸ¥ä¸€æ¬¡ï¼‰
      function startTokenMonitor() {
        setInterval(() => {
          const token = localStorage.getItem('ipPlanningToken');
          if (token) {
            // æª¢æŸ¥æ˜¯å¦éæœŸ
            if (isTokenExpired(token)) {
              // Token å·²éæœŸï¼Œå˜—è©¦åˆ·æ–°ï¼ˆæœƒè‡ªå‹•ç™»å‡ºå¦‚æœåˆ·æ–°å¤±æ•—ï¼‰
              tryRefreshTokenSafe().catch(err => {
                console.error('è‡ªå‹•åˆ·æ–° Token å¤±æ•—:', err);
              });
            }
          }
        }, 60000); // æ¯åˆ†é˜æª¢æŸ¥ä¸€æ¬¡
      }

      // çµ±ä¸€çš„å®‰å…¨ fetch å‡½æ•¸ï¼ˆç”¨æ–¼éœ€è¦èªè­‰çš„ API å‘¼å«ï¼‰
      async function safeFetch(url, options = {}) {
        const token = localStorage.getItem('ipPlanningToken');
        
        // æª¢æŸ¥ token æ˜¯å¦å­˜åœ¨
        if (!token) {
          // å¦‚æœæ²’æœ‰ tokenï¼Œä½†ç”¨æˆ¶èªç‚ºå·²ç™»å…¥ï¼Œå¯èƒ½éœ€è¦ç™»å‡º
          if (ipPlanningUser) {
            forceLogout('è«‹å…ˆç™»å…¥');
          }
          throw new Error('éœ€è¦ç™»å…¥');
        }
        
        // æª¢æŸ¥ token æ˜¯å¦éæœŸ
        if (isTokenExpired(token)) {
          // Token å·²éæœŸï¼Œå˜—è©¦åˆ·æ–°
          const refreshed = await tryRefreshTokenSafe();
          if (!refreshed) {
            // åˆ·æ–°å¤±æ•—ï¼Œå·²è‡ªå‹•ç™»å‡º
            throw new Error('Token å·²éæœŸä¸”ç„¡æ³•åˆ·æ–°');
          }
        }
        
        // æº–å‚™ headers
        const headers = {
          ...options.headers,
          'Authorization': `Bearer ${localStorage.getItem('ipPlanningToken')}`
        };
        
        try {
          const response = await fetch(url, { ...options, headers });
          
          // å¦‚æœæ”¶åˆ° 401 æˆ– 403ï¼Œå˜—è©¦åˆ·æ–°æˆ–ç™»å‡º
          if (response.status === 401) {
            const refreshed = await tryRefreshTokenSafe();
            if (refreshed) {
              // åˆ·æ–°æˆåŠŸï¼Œä½¿ç”¨æ–° token é‡è©¦
              headers['Authorization'] = `Bearer ${localStorage.getItem('ipPlanningToken')}`;
              return await fetch(url, { ...options, headers });
            }
            // åˆ·æ–°å¤±æ•—ï¼Œå·²è‡ªå‹•ç™»å‡º
            throw new Error('èªè­‰å¤±æ•—');
          }
          
          if (response.status === 403) {
            let errorMessage = 'èªè­‰å¤±æ•—ï¼Œè«‹é‡æ–°ç™»å…¥';
            try {
              const errorData = await response.clone().json();
              if (errorData.detail) {
                errorMessage = errorData.detail;
              }
            } catch (e) {
              // å¦‚æœç„¡æ³•è§£æ JSONï¼Œä½¿ç”¨é è¨­è¨Šæ¯
            }
            forceLogout(errorMessage);
            throw new Error(errorMessage);
          }
          
          return response;
        } catch (error) {
          // å¦‚æœæ˜¯ç¶²è·¯éŒ¯èª¤ï¼Œä¸è¦ç™»å‡ºï¼ˆå¯èƒ½æ˜¯æš«æ™‚çš„ç¶²è·¯å•é¡Œï¼‰
          if (error.name === 'TypeError' && error.message.includes('fetch')) {
            throw error;
          }
          
          // å…¶ä»–éŒ¯èª¤ï¼ˆåŒ…æ‹¬æˆ‘å€‘è‡ªå·±æ‹‹å‡ºçš„ï¼‰ç¹¼çºŒå‚³æ’­
          throw error;
        }
      }

      // åˆå§‹åŒ–é é¢
      document.addEventListener('DOMContentLoaded', function() {
        // å•Ÿå‹• token ç›£æ§ï¼ˆæ¯åˆ†é˜æª¢æŸ¥ä¸€æ¬¡ï¼‰
        startTokenMonitor();
        
        // æª¢æŸ¥ URL åƒæ•¸ä¸­æ˜¯å¦æœ‰ tokenï¼ˆOAuth callback fallbackï¼‰
        const urlParams = new URLSearchParams(window.location.search);
        const tokenParam = urlParams.get('token');
        if (tokenParam) {
          console.log('DEBUG: Found token in URL params, processing OAuth callback...');
          const userId = urlParams.get('user_id');
          const email = urlParams.get('email');
          const name = urlParams.get('name');
          const picture = urlParams.get('picture');
          
          if (tokenParam && userId) {
            ipPlanningToken = tokenParam;
            ipPlanningUser = {
              user_id: userId,
              email: email || '',
              name: name || '',
              picture: picture || ''
            };
            localStorage.setItem('ipPlanningToken', ipPlanningToken);
            localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
            
            // æ¸…é™¤ URL åƒæ•¸
            window.history.replaceState({}, document.title, window.location.pathname);
            
            console.log('DEBUG: Token processed from URL params, updating UI');
            updateAuthUI(true);
            showMainApp();
          }
        }
        
        // æª¢æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰æ–°çš„ tokenï¼ˆæ‰‹æ©Ÿç‰ˆè·³è½‰å›ä¾†å¾Œçš„è™•ç†ï¼‰
        // å¦‚æœç™¼ç¾ ipPlanningTokenUpdated æ¨™è¨˜ï¼Œè¡¨ç¤ºå‰›å‰›å®Œæˆç™»å…¥
        const tokenUpdatedFlag = localStorage.getItem('ipPlanningTokenUpdated');
        const storedToken = localStorage.getItem('ipPlanningToken');
        const storedUserStr = localStorage.getItem('ipPlanningUser');
        
        if (tokenUpdatedFlag && storedToken) {
          // æª¢æŸ¥é€™å€‹ token æ˜¯å¦æ˜¯æ–°çš„ï¼ˆèˆ‡ç•¶å‰å…¨åŸŸè®Šæ•¸ä¸åŒï¼‰
          // æ³¨æ„ï¼šæ­¤æ™‚å…¨åŸŸè®Šæ•¸å¯èƒ½é‚„æ²’å¾ localStorage è¼‰å…¥ï¼ˆcheckLoginStatus å°šæœªåŸ·è¡Œï¼‰
          // æ‰€ä»¥åªè¦æœ‰ tokenUpdatedFlagï¼Œå°±è¡¨ç¤ºæ˜¯æ–°çš„ç™»å…¥
          const currentToken = ipPlanningToken || localStorage.getItem('ipPlanningToken');
          const isNewToken = !currentToken || storedToken !== currentToken;
          
          if (isNewToken) {
            console.log('DEBUG: âœ… New token found in localStorage (likely from mobile redirect)');
            console.log('DEBUG: Token updated flag timestamp:', tokenUpdatedFlag);
            
            // æ›´æ–°å…¨åŸŸè®Šæ•¸
            ipPlanningToken = storedToken;
            if (storedUserStr) {
              try {
                ipPlanningUser = JSON.parse(storedUserStr);
              } catch (e) {
                console.warn('DEBUG: Failed to parse stored user data:', e);
              }
            }
            
            // æ¸…é™¤æ¨™è¨˜ï¼ˆé¿å…é‡è¤‡è™•ç†ï¼‰
            localStorage.removeItem('ipPlanningTokenUpdated');
            
            // æ›´æ–° UI
            updateAuthUI(true);
            showMainApp();
            checkSubscriptionStatus();
            
            console.log('DEBUG: âœ… Login state updated from localStorage');
          }
        }
        
        // æª¢æŸ¥æ˜¯å¦å·²ç¶“ç™»å…¥
        checkLoginStatus();
        
        // æª¢æŸ¥è¨‚é–±ç‹€æ…‹
        checkSubscriptionStatus();
        
        // ç¢ºä¿ Highlight.js è¼‰å…¥å¾Œåˆå§‹åŒ–ï¼ˆå› ç‚ºä½¿ç”¨äº† deferï¼‰
        function initializeHighlightJS() {
          if (typeof hljs !== 'undefined') {
            console.log('DEBUG: Highlight.js loaded, initializing...');
            try {
              hljs.highlightAll();
              // åˆå§‹åŒ– Markdown æ¸²æŸ“å™¨
              initMarkdownRenderer();
            } catch (e) {
              console.warn('DEBUG: Highlight.js initialization error:', e);
            }
          } else {
            // å¦‚æœé‚„æ²’è¼‰å…¥ï¼Œå»¶é²é‡è©¦
            setTimeout(initializeHighlightJS, 100);
          }
        }
        initializeHighlightJS();
        
        // ç§»å‹•åŸæœ‰å…§å®¹åˆ°æ–°å®¹å™¨
        moveExistingContent();
        
        // åˆå§‹åŒ–æ‰‹æ©Ÿç‰ˆä¸€éµç”Ÿæˆæ¨™ç±¤åˆ‡æ›
        initializeMode1MobileTabs();
        
        // èª¿è©¦AIé¡§å•æ¨¡å¼å…ƒç´ 
        setTimeout(debugAIConsultantElements, 2000);
        
        // æ§åˆ¶è¨‚é–±é–å®šæµ®å±¤é¡¯ç¤º
        updateSubscriptionLock();
      });

      // ===== è¨‚é–±å°é–èˆ‡å°è³¼ï¼šæœªè¨‚é–±ä½¿ç”¨è€…ç¦æ­¢é€²å…¥ä¸‰å¤§æ¨¡å¼ =====
      function isSubscribed() {
        try {
          const userStr = localStorage.getItem('ipPlanningUser');
          if (!userStr) return false;
          const user = JSON.parse(userStr);
          // å¾Œç«¯/å‰ç«¯ä¸€ç‡ä»¥ falsy è¦–ç‚ºæœªè¨‚é–±
          return !!(user && (user.is_subscribed === true || user.is_subscribed === 1 || user.is_subscribed === '1'));
        } catch (_) {
          return false;
        }
      }

      function showSubscriptionPaywall(plan) {
        // è‹¥å‚³å…¥æ–¹æ¡ˆï¼Œå°‡åƒæ•¸é™„åœ¨å°è³¼é é¢
        const planParam = plan ? `?plan=${encodeURIComponent(plan)}` : '';
        // é¡¯ç¤ºå°è³¼æç¤ºï¼ˆè¼•é‡ä½œæ³•ï¼šæç¤º + å°å‘ï¼‰
        try { showToast('æ­¤åŠŸèƒ½éœ€è¨‚é–±æ‰èƒ½ä½¿ç”¨ï¼Œå°‡å‰å¾€è³¼è²·é é¢', 3000); } catch (_) {}
        setTimeout(() => {
          window.location.href = `subscription.html${planParam}`;
        }, 300);
      }

      // åŒ…è£é é¢åˆ‡æ›ï¼Œå°ä¸‰å¤§æ¨¡å¼é€²è¡Œå°é–
      const originalSwitchPage = typeof switchPage === 'function' ? switchPage : null;
      window.switchPage = function(page) {
        // ä¸‰å¤§æ¨¡å¼ä»£ç¨±ï¼šmode1(ä¸€éµç”Ÿæˆ)ã€mode2(AIé¡§å•)ã€mode3(IPäººè¨­è¦åŠƒ)
        const isModePage = page === 'mode1' || page === 'mode2' || page === 'mode3';
        if (isModePage && !isSubscribed()) {
          // é è¨­å°åˆ°è¨‚é–±é ï¼ˆä¸å¸¶æ–¹æ¡ˆï¼›å¦‚éœ€å¯æ”¹ 'monthly' æˆ– 'yearly'ï¼‰
          return showSubscriptionPaywall();
        }
        // å…¶ä»–é é¢æ­£å¸¸åˆ‡æ›
        if (originalSwitchPage) {
          return originalSwitchPage(page);
        }
      };

      // åœ¨ç™»å…¥æˆåŠŸå¾Œèˆ‡è¨‚é–±ç‹€æ…‹è¼‰å…¥æ™‚ï¼ŒåŒæ­¥æœ¬åœ° user.is_subscribed æ¬„ä½
      function markUnsubscribedByDefault() {
        try {
          const userStr = localStorage.getItem('ipPlanningUser');
          if (!userStr) return;
          const user = JSON.parse(userStr);
          if (!('is_subscribed' in user)) {
            user.is_subscribed = false;
            localStorage.setItem('ipPlanningUser', JSON.stringify(user));
          }
        } catch (_) {}
      }
      // ç«‹å³åŸ·è¡Œä¸€æ¬¡ï¼Œç¢ºä¿ç›®å‰ç€è¦½ä½¿ç”¨è€…ç‚ºæœªè¨‚é–±é è¨­ï¼ˆå¾Œç«¯äº¦æœƒé è¨­æœªè¨‚é–±ï¼‰
      markUnsubscribedByDefault();
      
      // æ§åˆ¶è¨‚é–±é–å®šæµ®å±¤é¡¯ç¤º
      function updateSubscriptionLock() {
        const overlay = document.getElementById('subscription-lock-overlay');
        
        // æª¢æŸ¥è¨‚é–±ç‹€æ…‹å’Œç™»å…¥ç‹€æ…‹
        const isSubscribed = document.body.dataset.subscribed === 'true';
        const isLoggedIn = ipPlanningToken && ipPlanningUser;
        
        if (overlay) {
          if (isSubscribed && isLoggedIn) {
            // å·²ç™»å…¥ä¸”æœ‰è¨‚é–±ï¼Œéš±è—æµ®å±¤
            overlay.style.display = 'none';
          } else {
            // æœªç™»å…¥æˆ–æœªè¨‚é–±ï¼Œé¡¯ç¤ºæµ®å±¤
            overlay.style.display = 'flex';
            
            // æ ¹æ“šç™»å…¥ç‹€æ…‹æ›´æ–°æŒ‰éˆ•æ–‡å­—
            const loginButton = overlay.querySelector('a[href="/login"]');
            if (loginButton) {
              if (isLoggedIn) {
                // å·²ç™»å…¥ä½†æœªè¨‚é–±ï¼Œé¡¯ç¤ºè¨‚é–±æç¤º
                overlay.querySelector('h3').textContent = 'ğŸ”’ è§£é–å®Œæ•´åŠŸèƒ½';
                overlay.querySelector('p').textContent = 'ç«‹å³è¨‚é–±å³å¯ä½¿ç”¨æ‰€æœ‰ AI çŸ­å½±éŸ³åŠŸèƒ½';
                // éš±è—ç™»å…¥æŒ‰éˆ•ï¼Œå› ç‚ºå·²ç¶“ç™»å…¥äº†
                loginButton.style.display = 'none';
              } else {
                // æœªç™»å…¥ï¼Œä¿æŒåŸä¾†çš„æç¤º
                overlay.querySelector('h3').textContent = 'ğŸ”’ è§£é–å®Œæ•´åŠŸèƒ½';
                overlay.querySelector('p').textContent = 'è«‹å…ˆç™»å…¥ä¸¦è¨‚é–±å³å¯ä½¿ç”¨æ‰€æœ‰ AI çŸ­å½±éŸ³åŠŸèƒ½';
                loginButton.style.display = 'block';
              }
            }
          }
        }
      }
      
      // åˆå§‹åŒ–æ‰‹æ©Ÿç‰ˆä¸€éµç”Ÿæˆæ¨™ç±¤åˆ‡æ›åŠŸèƒ½
      function initializeMode1MobileTabs() {
        const tabs = document.querySelectorAll('.mode1-mobile-tab');
        const panels = document.querySelectorAll('.mode1-mobile-panel');
        
        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            const targetTab = tab.getAttribute('data-tab');
            
            // ç§»é™¤æ‰€æœ‰activeé¡
            tabs.forEach(t => t.classList.remove('active'));
            panels.forEach(p => p.classList.remove('show'));
            
            // æ·»åŠ activeé¡åˆ°é»æ“Šçš„æ¨™ç±¤
            tab.classList.add('active');
            
            // é¡¯ç¤ºå°æ‡‰çš„é¢æ¿
            const targetPanel = document.getElementById(`mode1-mobile-${targetTab}`);
            if (targetPanel) {
              targetPanel.classList.add('show');
            }
          });
        });
      }
      
      // å…¨åŸŸè®Šæ•¸
      let ipPlanningUser = null;
      let ipPlanningToken = null;
      let isRefreshingToken = false; // é˜²æ­¢é‡è¤‡åˆ·æ–°
      let lastRefreshAttempt = 0; // ä¸Šæ¬¡åˆ·æ–°å˜—è©¦çš„æ™‚é–“
      let handleAuthMessage = null; // èªè­‰è¨Šæ¯è™•ç†å‡½æ•¸ï¼ˆåœ¨ login() ä¸­å‹•æ…‹å‰µå»ºï¼‰
      
      // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
      async function checkLoginStatus() {
        ipPlanningToken = localStorage.getItem('ipPlanningToken');
        ipPlanningUser = JSON.parse(localStorage.getItem('ipPlanningUser') || 'null');
        
        // ç„¡è«–æ˜¯å¦ç™»å…¥ï¼Œéƒ½å…ˆé¡¯ç¤ºé¦–é 
        showMainApp();
        
        // æ ¹æ“šç™»å…¥ç‹€æ…‹æ›´æ–° UI
        if (ipPlanningToken && ipPlanningUser) {
          // æª¢æŸ¥ token æ˜¯å¦å·²éæœŸ
          if (isTokenExpired(ipPlanningToken)) {
            // Token å·²éæœŸï¼Œå˜—è©¦åˆ·æ–°
            console.log('Token å·²éæœŸï¼Œå˜—è©¦åˆ·æ–°...');
            const refreshed = await tryRefreshTokenSafe();
            if (!refreshed) {
              // åˆ·æ–°å¤±æ•—ï¼Œå·²è‡ªå‹•ç™»å‡ºï¼ˆåœ¨ tryRefreshTokenSafe ä¸­è™•ç†ï¼‰
              return;
            }
          } else if (isTokenExpiringSoon(ipPlanningToken)) {
            // Token å³å°‡éæœŸï¼Œä¸»å‹•åˆ·æ–°
            await proactiveRefreshToken();
          }
          updateUserInfo();
        } else {
          // æœªç™»å…¥æ™‚é¡¯ç¤ºç™»å…¥æŒ‰éˆ•
          showLoginButton();
        }
      }
      
      // é¡¯ç¤ºç™»å…¥é é¢
      function showLoginPage() {
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('appContainer').style.display = 'none';
      }
      
      // é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼
      function showMainApp() {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('appContainer').style.display = 'block';
        
        // è¨­ç½®é»˜èªé é¢ç‚ºé¦–é 
        switchPage('homepage');
      }
      
      // é¡¯ç¤ºç™»å…¥æŒ‰éˆ•
      function showLoginButton() {
        const authButtons = document.querySelector('.auth-buttons');
        const userInfo = document.getElementById('userInfo');
        if (authButtons) authButtons.style.display = 'flex';
        if (userInfo) userInfo.style.display = 'none';
      }
      
      // é¡¯ç¤ºç”¨æˆ¶è³‡è¨Š
      async function updateUserInfo() {
        const authButtons = document.querySelector('.auth-buttons');
        const userInfo = document.getElementById('userInfo');
        if (authButtons) authButtons.style.display = 'none';
        if (userInfo && ipPlanningUser) {
          userInfo.style.display = 'flex';
          const userNameEl = document.getElementById('userName');
          const userAvatarEl = document.getElementById('userAvatar');
          if (userNameEl) userNameEl.textContent = ipPlanningUser.name || 'ç”¨æˆ¶';
          if (userAvatarEl && ipPlanningUser.picture) {
            userAvatarEl.src = ipPlanningUser.picture;
          }
        }
        // æ›´æ–°ç”¨æˆ¶è³‡è¨Šå¾Œï¼Œæª¢æŸ¥è¨‚é–±ç‹€æ…‹
        await checkSubscriptionStatus();
      }
      
      // è·³éç™»å…¥
      function skipLogin() {
        showMainApp();
        showLoginButton();
      }
      
      // å‰å¾€ç™»å…¥é é¢
      function goToLogin() {
        // è·³è½‰åˆ°ç™»å…¥é é¢ï¼ˆåœ–1ï¼‰
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('appContainer').style.display = 'none';
      }
      
      // æª¢æŸ¥è¨‚é–±ç‹€æ…‹ä¸¦æ›´æ–°æµ®å±¤
      async function checkSubscriptionStatus() {
        // å¦‚æœæœ‰ç™»å…¥è³‡è¨Šï¼Œå¾å¾Œç«¯ API ç²å–è¨‚é–±ç‹€æ…‹
        if (ipPlanningToken && ipPlanningUser && ipPlanningUser.user_id) {
          try {
            let response = await fetch('https://aivideobackend.zeabur.app/api/auth/me', {
              headers: {
                'Authorization': `Bearer ${ipPlanningToken}`
              }
            });
            
            // å¦‚æœæ”¶åˆ° 401ï¼Œå˜—è©¦åˆ·æ–° token å¾Œé‡è©¦
            if (response.status === 401) {
              const refreshed = await tryRefreshTokenSafe();
              if (refreshed) {
                // Token åˆ·æ–°æˆåŠŸï¼Œä½¿ç”¨æ–° token é‡è©¦
                response = await fetch('https://aivideobackend.zeabur.app/api/auth/me', {
                  headers: {
                    'Authorization': `Bearer ${ipPlanningToken}`
                  }
                });
              }
            }
            
            if (response.ok) {
              const userInfo = await response.json();
              console.log('ç”¨æˆ¶è³‡è¨Š:', userInfo);
              console.log('è¨‚é–±ç‹€æ…‹:', userInfo.is_subscribed);
              
              // æ›´æ–°è¨‚é–±ç‹€æ…‹
              // è™•ç†å„ç¨®å¯èƒ½çš„è¿”å›é¡å‹
              const isSubscribed = userInfo.is_subscribed === true || 
                                  userInfo.is_subscribed === 1 || 
                                  userInfo.is_subscribed === 'true' ||
                                  userInfo.is_subscribed === '1' ||
                                  userInfo.is_subscribed === undefined;
              
              if (isSubscribed) {
                document.body.dataset.subscribed = 'true';
                localStorage.setItem('subscriptionStatus', 'active');
                console.log('è¨­ç‚ºå·²è¨‚é–±ï¼Œè¨‚é–±ç‹€æ…‹:', userInfo.is_subscribed);
              } else {
                document.body.dataset.subscribed = 'false';
                localStorage.setItem('subscriptionStatus', 'inactive');
                console.log('è¨­ç‚ºæœªè¨‚é–±ï¼Œè¨‚é–±ç‹€æ…‹:', userInfo.is_subscribed);
              }
            } else {
              // API å¤±æ•—ï¼ˆåŒ…æ‹¬ 401 åˆ·æ–°å¤±æ•—ï¼‰ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜æˆ–é è¨­å·²è¨‚é–±
              const localSubscriptionStatus = localStorage.getItem('subscriptionStatus');
              const localIsSubscribed = ipPlanningUser.is_subscribed !== false; // é è¨­ç‚ºå·²è¨‚é–±
              
              if (localSubscriptionStatus === 'active' || localIsSubscribed) {
              document.body.dataset.subscribed = 'true';
              localStorage.setItem('subscriptionStatus', 'active');
              } else {
                document.body.dataset.subscribed = 'false';
                localStorage.setItem('subscriptionStatus', 'inactive');
              }
              // éœé»˜è™•ç†ï¼Œä¸é¡¯ç¤ºéŒ¯èª¤æ—¥èªŒ
            }
          } catch (error) {
            // ç¶²è·¯éŒ¯èª¤ç­‰ç•°å¸¸ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜æˆ–é è¨­å·²è¨‚é–±
            const localSubscriptionStatus = localStorage.getItem('subscriptionStatus');
            const localIsSubscribed = ipPlanningUser && ipPlanningUser.is_subscribed !== false;
            
            if (localSubscriptionStatus === 'active' || localIsSubscribed) {
            document.body.dataset.subscribed = 'true';
            localStorage.setItem('subscriptionStatus', 'active');
            } else {
              document.body.dataset.subscribed = 'false';
              localStorage.setItem('subscriptionStatus', 'inactive');
            }
            // ä¸è¼¸å‡ºéŒ¯èª¤æ—¥èªŒï¼Œé¿å…æ§åˆ¶å°å™ªéŸ³
          }
        } else {
          // æœªç™»å…¥ï¼Œå¾æœ¬åœ°å­˜å„²æª¢æŸ¥è¨‚é–±ç‹€æ…‹
          const subscriptionStatus = localStorage.getItem('subscriptionStatus');
          
          if (subscriptionStatus === 'active') {
            document.body.dataset.subscribed = 'true';
          } else {
            document.body.dataset.subscribed = 'false';
          }
        }
        
        console.log('ç•¶å‰è¨‚é–±ç‹€æ…‹:', document.body.dataset.subscribed);
        console.log('ç™»å…¥ç‹€æ…‹:', ipPlanningToken && ipPlanningUser ? 'å·²ç™»å…¥' : 'æœªç™»å…¥');
        
        // æ›´æ–°é–å®šæµ®å±¤
        updateSubscriptionLock();
      }
      
      // è¨­ç½®èªè¨€
      function setLanguage(lang) {
        // æ›´æ–°èªè¨€æŒ‰éˆ•ç‹€æ…‹
        document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // é€™è£¡å¯ä»¥æ·»åŠ èªè¨€åˆ‡æ›é‚è¼¯
        console.log('Language set to:', lang);
      }
      
      // èª¿è©¦å‡½æ•¸ï¼šæª¢æŸ¥AIé¡§å•æ¨¡å¼å…ƒç´ ç‹€æ…‹
      function debugAIConsultantElements() {
        console.log('=== èª¿è©¦AIé¡§å•æ¨¡å¼å…ƒç´  ===');
        
        const quickButtons = document.querySelector('.quick-buttons');
        const inputRow = document.querySelector('.input-row');
        const chatContainer = document.querySelector('#chatContainer');
        
        console.log('å¿«é€ŸæŒ‰éˆ•å…ƒç´ :', quickButtons);
        console.log('è¼¸å…¥å€åŸŸå…ƒç´ :', inputRow);
        console.log('èŠå¤©å®¹å™¨å…ƒç´ :', chatContainer);
        
        if (quickButtons) {
          console.log('å¿«é€ŸæŒ‰éˆ•æ¨£å¼:', {
            display: getComputedStyle(quickButtons).display,
            visibility: getComputedStyle(quickButtons).visibility,
            opacity: getComputedStyle(quickButtons).opacity,
            height: getComputedStyle(quickButtons).height,
            position: getComputedStyle(quickButtons).position,
            zIndex: getComputedStyle(quickButtons).zIndex
          });
        }
        
        if (inputRow) {
          console.log('è¼¸å…¥å€åŸŸæ¨£å¼:', {
            display: getComputedStyle(inputRow).display,
            visibility: getComputedStyle(inputRow).visibility,
            opacity: getComputedStyle(inputRow).opacity,
            height: getComputedStyle(inputRow).height,
            position: getComputedStyle(inputRow).position,
            zIndex: getComputedStyle(inputRow).zIndex
          });
        }
        
        if (chatContainer) {
          console.log('èŠå¤©å®¹å™¨æ¨£å¼:', {
            display: getComputedStyle(chatContainer).display,
            height: getComputedStyle(chatContainer).height,
            overflow: getComputedStyle(chatContainer).overflow,
            flexDirection: getComputedStyle(chatContainer).flexDirection
          });
        }
      }
      
      // ç§»å‹•ç¾æœ‰å…§å®¹åˆ°æ–°å®¹å™¨
      function moveExistingContent() {
        // ç§»å‹•ç”¨æˆ¶éœ€æ±‚è¨­å®šå…§å®¹
        const settingsBlock = document.querySelector('.settings-block');
        if (settingsBlock) {
          const container = document.getElementById('userSettingsContainer');
          if (container) {
            container.appendChild(settingsBlock);
            
            // è¨­ç½®ä½¿ç”¨èªªæ˜é¡¯ç¤ºæ§åˆ¶
            setupInstructionsToggle();
          }
          
          // è¤‡è£½åˆ°æ‰‹æ©Ÿç‰ˆå®¹å™¨
          const mobileSettingsContainer = document.querySelector('#mode1-mobile-setup #userSettingsContainer');
          if (mobileSettingsContainer) {
            const mobileSettingsBlock = settingsBlock.cloneNode(true);
            mobileSettingsContainer.appendChild(mobileSettingsBlock);
          }
        }
        
        // ç§»å‹•ä¸€éµç”Ÿæˆå…§å®¹
        const resultTabs = document.querySelector('.result-tabs');
        const resultsContainer = document.querySelector('.results-container');
        if (resultTabs && resultsContainer) {
          const container = document.getElementById('oneClickGenerationContainer');
          if (container) {
            container.appendChild(resultTabs);
            container.appendChild(resultsContainer);
          }
          
          // è¤‡è£½åˆ°æ‰‹æ©Ÿç‰ˆå®¹å™¨
          const mobileContainer = document.getElementById('oneClickGenerationContainerMobile');
          if (mobileContainer) {
            const mobileResultTabs = resultTabs.cloneNode(true);
            const mobileResultsContainer = resultsContainer.cloneNode(true);
            
            // ä¿®æ­£æ‰‹æ©Ÿç‰ˆæŒ‰éˆ•çš„onclickäº‹ä»¶
            const mobileButtons = mobileResultsContainer.querySelectorAll('.generate-btn');
            mobileButtons.forEach(btn => {
              const text = btn.textContent.trim();
              if (text.includes('å¸³è™Ÿå®šä½')) {
                btn.setAttribute('onclick', 'generatePositioning()');
              } else if (text.includes('é¸é¡Œ')) {
                btn.setAttribute('onclick', 'generateTopics()');
              } else if (text.includes('è…³æœ¬')) {
                btn.setAttribute('onclick', 'generateScript()');
              }
            });
            
            mobileContainer.appendChild(mobileResultTabs);
            mobileContainer.appendChild(mobileResultsContainer);
          }
        }
        
        // èŠå¤©å…§å®¹å·²ç¶“åœ¨æ­£ç¢ºä½ç½®ï¼Œä¸éœ€è¦ç§»å‹•
        // åªéœ€è¦ç¢ºä¿å¿«é€ŸæŒ‰éˆ•åŠŸèƒ½æ­£å¸¸
        setupQuickButtons();
      }
      
      // è¨­ç½®ä½¿ç”¨èªªæ˜é¡¯ç¤ºæ§åˆ¶
      function setupInstructionsToggle() {
        const settingsToggle = document.getElementById('settingsToggle');
        const settingsContent = document.getElementById('settingsContent');
        const instructions = document.getElementById('oneClickInstructions');
        
        if (settingsToggle && settingsContent && instructions) {
          // ç›£è½è¨­å®šå€å¡Šçš„å±•é–‹/æ”¶åˆ
          const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
              if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                const isExpanded = settingsContent.style.display !== 'none';
                instructions.style.display = isExpanded ? 'block' : 'none';
              }
            });
          });
          
          observer.observe(settingsContent, { attributes: true });
          
          // åˆå§‹ç‹€æ…‹æª¢æŸ¥
          const isExpanded = settingsContent.style.display !== 'none';
          instructions.style.display = isExpanded ? 'block' : 'none';
        }
      }
      
      // è¨­ç½®å¿«é€ŸæŒ‰éˆ•åŠŸèƒ½
      function setupQuickButtons() {
        // å¿«é€ŸæŒ‰éˆ•åŠŸèƒ½
        document.querySelectorAll('.quick-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const text = btn.getAttribute('data-text');
            if (text) {
              const messageInput = document.getElementById('messageInput');
              if (messageInput) {
                messageInput.value = text;
                messageInput.focus();
                
                // æ·»åŠ è¦–è¦ºåé¥‹
                btn.style.transform = 'scale(0.95)';
                setTimeout(() => {
                  btn.style.transform = 'scale(1)';
                }, 150);
              }
            }
          });
        });
      }

      // æ–°çš„å…ƒç´ å¼•ç”¨
      const chatEl = document.getElementById('chatMessages');
      const messageInput = document.getElementById('messageInput');
      const sendBtn = document.getElementById('sendBtn');
      const applyBtn = document.getElementById('applyBtn');
      const platformSelect = document.getElementById('platformSelect');
      const topicInput = document.getElementById('topicInput');
      const durationInput = document.getElementById('durationInput');
      const positioningInput = document.getElementById('positioningInput');
      
      // çµæœå€å¡Šå…ƒç´ 
      const resultsEl = document.getElementById('results');
      const resultTitleEl = document.getElementById('result-title');
      const resultScriptEl = document.getElementById('result-script');
      const resultVisualEl = document.getElementById('result-visual');
      const resultCopyEl = document.getElementById('result-copy');
      const scriptResult = document.getElementById('scriptResult');
      const positioningResult = document.getElementById('positioningResult');
      const topicSelectionResult = document.getElementById('topicSelectionResult');
      
      // æ§åˆ¶æŒ‰éˆ•ï¼ˆå·²ç§»é™¤ï¼ŒåŠŸèƒ½æ•´åˆåˆ°å¿«é€ŸæŒ‰éˆ•ä¸­ï¼‰
      
      // ç”¨æˆ¶æŠ½å±œå…ƒç´ 
      const userDrawer = document.getElementById('userDrawer');
      const userDrawerOverlay = document.getElementById('userDrawerOverlay');
      const drawerAvatar = document.getElementById('drawerAvatar');
      const drawerName = document.getElementById('drawerName');
      const drawerEmail = document.getElementById('drawerEmail');
      
      // èªè­‰ç›¸é—œå…ƒç´ 
      const userInfo = document.getElementById('userInfo');
      const userAvatar = document.getElementById('userAvatar');
      const userName = document.getElementById('userName');
      const loginBtn = document.getElementById('loginBtn');
      const logoutBtn = document.getElementById('logoutBtn');
      
      // å½ˆè·³è¦–çª—å…ƒç´ 
      const popupOverlay = document.getElementById('popupOverlay');
      const popupSpinner = document.getElementById('popupSpinner');
      const popupMessage = document.getElementById('popupMessage');
      const popupButtons = document.getElementById('popupButtons');
      const popupRetry = document.getElementById('popupRetry');
      const popupCancel = document.getElementById('popupCancel');
      
      // æç¤ºæ¡†
      const toastEl = document.getElementById('toast');
      
      // è¨­å®šå€å¡Šå…ƒç´ 
      const settingsToggleEl = document.getElementById('settingsToggle');
      const settingsContentEl = document.getElementById('settingsContent');
      
      // å…¨å±€è®Šæ•¸
      let currentPlatform = null;
      let currentTopic = null;
      let currentProfile = null;
      const styleInstruction = 'æ ¼å¼è¦æ±‚ï¼šåˆ†æ®µæ¸…æ¥šï¼ŒçŸ­å¥ï¼Œæ¯æ®µæ›è¡Œï¼Œé©åº¦åŠ å…¥è¡¨æƒ…ç¬¦è™Ÿï¼ˆå¦‚ï¼šâœ…âœ¨ğŸ”¥ğŸ“Œï¼‰ï¼Œé¿å…å£é ­ç¦ªã€‚çµ•å°ä¸è¦ä½¿ç”¨ ** æˆ–ä»»ä½• Markdown æ ¼å¼ç¬¦è™Ÿï¼Œæ‰€æœ‰å…§å®¹å¿…é ˆæ˜¯ç´”æ–‡å­—æ ¼å¼ã€‚';
      
      // ç”Ÿæˆéš¨æ©Ÿç”¨æˆ¶ID
      function generateUserId() {
        const timestamp = Date.now().toString(36);
        const randomStr = Math.random().toString(36).substring(2, 8);
        return `user_${timestamp}_${randomStr}`;
      }
      
      // ç”¨æˆ¶æŠ½å±œåŠŸèƒ½
      function toggleUserDrawer() {
        userDrawer.classList.toggle('open');
        userDrawerOverlay.classList.toggle('open');
        
        // å¦‚æœæŠ½å±œæ‰“é–‹ï¼Œè¼‰å…¥ç”¨æˆ¶æ­·å²è³‡è¨Š
        if (userDrawer.classList.contains('open') && ipPlanningUser) {
          loadUserHistory();
        }
      }
      
      function closeUserDrawer() {
        userDrawer.classList.remove('open');
        userDrawerOverlay.classList.remove('open');
      }
      
      // æ›´æ–°ç”¨æˆ¶æŠ½å±œè³‡è¨Š
      function updateUserDrawer(user) {
        if (user) {
          // ç¢ºä¿ç”¨æˆ¶æœ‰ID
          if (!user.user_id) {
            user.user_id = generateUserId();
            ipPlanningUser = user; // æ›´æ–°ç•¶å‰ç”¨æˆ¶
            localStorage.setItem('ipPlanningUser', JSON.stringify(user));
            console.log('åœ¨updateUserDrawerä¸­ç‚ºç”¨æˆ¶ç”Ÿæˆæ–°ID:', user.user_id);
          }
          
          // æ›´æ–°æŠ½å±œå…§çš„è³‡è¨Š
          drawerAvatar.src = user.picture || 'https://via.placeholder.com/50';
          drawerName.textContent = user.name || 'ç”¨æˆ¶';
          drawerEmail.textContent = user.email || '';
          
          // æ›´æ–°é ‚éƒ¨ header ä¸­çš„ç”¨æˆ¶è³‡è¨Š
          userAvatar.src = user.picture || 'https://via.placeholder.com/32';
          userName.textContent = user.name || 'ç”¨æˆ¶';
          
          // æ›´æ–°å€‹äººè³‡æ–™é¡¯ç¤º
          updatePersonalInfo();
          
          // è¼‰å…¥ç”¨æˆ¶çš„éå¾€è³‡è¨Š
          loadUserHistory();
        }
      }

      // è¼‰å…¥ç”¨æˆ¶æ­·å²è³‡è¨Š
      async function loadUserHistory() {
        // ç¢ºä¿ç”¨æˆ¶æœ‰ID
        if (!ipPlanningUser?.user_id) {
          console.log('æ²’æœ‰ç”¨æˆ¶IDï¼Œå˜—è©¦ç”Ÿæˆ...');
          if (ipPlanningUser) {
            ipPlanningUser.user_id = generateUserId();
            localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
            console.log('ç‚ºç”¨æˆ¶ç”Ÿæˆæ–°ID:', ipPlanningUser.user_id);
          } else {
            console.log('æ²’æœ‰ç•¶å‰ç”¨æˆ¶ï¼Œè·³éè¼‰å…¥æ­·å²');
            return;
          }
        }
        
        console.log('é–‹å§‹è¼‰å…¥ç”¨æˆ¶æ­·å²ï¼Œç”¨æˆ¶ID:', ipPlanningUser.user_id);
        
        try {
          // è¼‰å…¥å°è©±è¨˜éŒ„
          console.log('æ­£åœ¨è¼‰å…¥å°è©±è¨˜éŒ„...');
          const conversationsResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/conversations/${ipPlanningUser.user_id}`);
          console.log('å°è©±è¨˜éŒ„éŸ¿æ‡‰ç‹€æ…‹:', conversationsResponse.status);
          if (conversationsResponse.ok) {
            const conversationsData = await conversationsResponse.json();
            console.log('å°è©±è¨˜éŒ„æ•¸æ“š:', conversationsData);
            updateConversationsDisplay(conversationsData.conversations);
          } else {
            console.error('è¼‰å…¥å°è©±è¨˜éŒ„å¤±æ•—:', conversationsResponse.status, conversationsResponse.statusText);
          }
          
          // è¼‰å…¥ç”Ÿæˆè¨˜éŒ„
          console.log('æ­£åœ¨è¼‰å…¥ç”Ÿæˆè¨˜éŒ„...');
          const generationsResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/generations/${ipPlanningUser.user_id}`);
          console.log('ç”Ÿæˆè¨˜éŒ„éŸ¿æ‡‰ç‹€æ…‹:', generationsResponse.status);
          if (generationsResponse.ok) {
            const generationsData = await generationsResponse.json();
            console.log('ç”Ÿæˆè¨˜éŒ„æ•¸æ“š:', generationsData);
            updateGenerationsDisplay(generationsData.generations);
          } else {
            console.error('è¼‰å…¥ç”Ÿæˆè¨˜éŒ„å¤±æ•—:', generationsResponse.status, generationsResponse.statusText);
          }
          
          // è¼‰å…¥å¸³è™Ÿå®šä½è¨˜éŒ„
          console.log('æ­£åœ¨è¼‰å…¥å¸³è™Ÿå®šä½è¨˜éŒ„...');
          await loadPositioningRecords();
          
          // è¼‰å…¥ç”¨æˆ¶è¨˜æ†¶
          console.log('æ­£åœ¨è¼‰å…¥ç”¨æˆ¶è¨˜æ†¶...');
          const memoryResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/memory/${ipPlanningUser.user_id}`);
          console.log('ç”¨æˆ¶è¨˜æ†¶éŸ¿æ‡‰ç‹€æ…‹:', memoryResponse.status);
          if (memoryResponse.ok) {
            const memoryData = await memoryResponse.json();
            console.log('ç”¨æˆ¶è¨˜æ†¶æ•¸æ“š:', memoryData);
            updateMemoryDisplay(memoryData.memory);
          } else {
            console.error('è¼‰å…¥ç”¨æˆ¶è¨˜æ†¶å¤±æ•—:', memoryResponse.status, memoryResponse.statusText);
          }
          
        } catch (error) {
          console.error('è¼‰å…¥ç”¨æˆ¶æ­·å²è³‡è¨Šæ™‚å‡ºéŒ¯:', error);
        }
      }

      // æ›´æ–°å°è©±è¨˜éŒ„é¡¯ç¤º
      function updateConversationsDisplay(conversations) {
        const conversationsList = document.getElementById('conversationsList');
        if (!conversationsList) return;
        
        conversationsList.innerHTML = '';
        conversations.forEach(conv => {
          const item = document.createElement('div');
          item.className = 'conversation-item';
          item.innerHTML = `
            <div class="conversation-summary">${conv.summary}</div>
            <div class="conversation-date">${new Date(conv.created_at).toLocaleDateString()}</div>
          `;
          conversationsList.appendChild(item);
        });
      }

      // æ›´æ–°ç”Ÿæˆè¨˜éŒ„é¡¯ç¤º
      function updateGenerationsDisplay(generations) {
        const generationsList = document.getElementById('generationsList');
        if (!generationsList) return;
        
        generationsList.innerHTML = '';
        generations.forEach(gen => {
          const item = document.createElement('div');
          item.className = 'generation-item';
          item.innerHTML = `
            <div class="generation-header">
              <span class="generation-platform">${gen.platform}</span>
              <span class="generation-topic">${gen.topic}</span>
            </div>
            <div class="generation-content">${gen.content}</div>
            <div class="generation-date">${new Date(gen.created_at).toLocaleDateString()}</div>
          `;
          generationsList.appendChild(item);
        });
      }

      // æ›´æ–°è¨˜æ†¶é¡¯ç¤º
      function updateMemoryDisplay(memory) {
        const memoryContent = document.getElementById('memoryContent');
        if (!memoryContent) return;
        
        memoryContent.innerHTML = memory || 'æš«ç„¡è¨˜æ†¶è³‡è¨Š';
      }
      
      // è¼‰å…¥å¸³è™Ÿå®šä½è¨˜éŒ„
      async function loadPositioningRecords() {
        if (!ipPlanningUser?.user_id) return;
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${ipPlanningUser.user_id}`, {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            updatePositioningDisplay(data.records || []);
          }
        } catch (error) {
          console.error('è¼‰å…¥å¸³è™Ÿå®šä½è¨˜éŒ„å¤±æ•—:', error);
        }
      }
      
      // æ›´æ–°å¸³è™Ÿå®šä½é¡¯ç¤º
      function updatePositioningDisplay(records) {
        const positioningContent = document.getElementById('positioningHistoryContent');
        if (!positioningContent) return;
        
        if (records.length === 0) {
          positioningContent.innerHTML = '<p style="color: #666;">å°šç„¡å¸³è™Ÿå®šä½è¨˜éŒ„</p>';
          return;
        }
        
        let html = '<div class="positioning-records">';
        records.forEach(record => {
          const date = new Date(record.created_at).toLocaleString('zh-TW', {
            timeZone: 'Asia/Taipei',
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          });
          const preview = record.content.substring(0, 50) + (record.content.length > 50 ? '...' : '');
          
          html += `
            <div class="positioning-record-item">
              <div class="record-header">
                <span class="record-number">ç·¨è™Ÿ ${record.record_number}</span>
                <span class="record-date">${date}</span>
              </div>
              <div class="record-preview">${preview}</div>
              <div class="record-actions">
                <button class="view-btn" onclick="viewPositioningDetail(${record.id}, '${record.record_number}')">æŸ¥çœ‹å®Œæ•´çµæœ</button>
                <button class="delete-btn" onclick="deletePositioningRecord(${record.id})">åˆªé™¤</button>
              </div>
            </div>
          `;
        });
        html += '</div>';
        
        positioningContent.innerHTML = html;
      }
      
      // æŸ¥çœ‹å¸³è™Ÿå®šä½è©³ç´°å…§å®¹
      async function viewPositioningDetail(recordId, recordNumber) {
        if (!ipPlanningUser?.user_id) return;
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${ipPlanningUser.user_id}`, {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            const record = data.records.find(r => r.id === recordId);
            
            if (record) {
              // é¡¯ç¤ºè©³ç´°å…§å®¹åœ¨å½ˆå‡ºè¦–çª—
              showDetailModal(recordNumber, record.created_at, record.content);
            }
          }
        } catch (error) {
          console.error('è¼‰å…¥è©³ç´°å…§å®¹å¤±æ•—:', error);
          showToast('è¼‰å…¥å¤±æ•—', 3000);
        }
      }
      
      // é¡¯ç¤ºè©³ç´°å…§å®¹å½ˆå‡ºè¦–çª—
      function showDetailModal(recordNumber, createdAt, content) {
        const date = new Date(createdAt).toLocaleString('zh-TW');
        const modal = document.createElement('div');
        modal.className = 'detail-modal-overlay';
        modal.innerHTML = `
          <div class="detail-modal">
            <div class="detail-modal-header">
              <h3>å¸³è™Ÿå®šä½è©³ç´°å…§å®¹</h3>
              <button class="close-detail-btn" onclick="this.closest('.detail-modal-overlay').remove()">âœ•</button>
            </div>
            <div class="detail-modal-body">
              <div class="detail-info">
                <span><strong>ç·¨è™Ÿï¼š</strong>${recordNumber}</span>
                <span><strong>ç”Ÿæˆæ—¥æœŸï¼š</strong>${date}</span>
              </div>
              <div class="detail-content">
                ${content.replace(/\n/g, '<br>')}
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
        
        // é»æ“ŠèƒŒæ™¯é—œé–‰
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
          }
        });
      }
      
      // åˆªé™¤å¸³è™Ÿå®šä½è¨˜éŒ„
      async function deletePositioningRecord(recordId) {
        if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨˜éŒ„å—ï¼Ÿ')) return;
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${recordId}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            showToast('è¨˜éŒ„å·²åˆªé™¤', 2000);
            await loadPositioningRecords();
          } else {
            throw new Error('åˆªé™¤å¤±æ•—');
          }
        } catch (error) {
          console.error('åˆªé™¤éŒ¯èª¤:', error);
          showToast('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }

      // åˆ‡æ›æŠ½å±œå…§å®¹å€åŸŸ
      function switchDrawerContent(sectionId) {
        // éš±è—æ‰€æœ‰å…§å®¹å€åŸŸ
        const allSections = document.querySelectorAll('.content-section');
        allSections.forEach(section => {
          section.classList.remove('active');
        });
        
        // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ active ç‹€æ…‹
        const allMenuItems = document.querySelectorAll('.user-drawer-menu a');
        allMenuItems.forEach(item => {
          item.classList.remove('active');
        });
        
        // é¡¯ç¤ºé¸ä¸­çš„å…§å®¹å€åŸŸ
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
          targetSection.classList.add('active');
        }
        
        // æ·»åŠ å°æ‡‰æŒ‰éˆ•çš„ active ç‹€æ…‹
        const targetMenuItem = document.querySelector(`[data-section="${sectionId}"]`);
        if (targetMenuItem) {
          targetMenuItem.classList.add('active');
        }
        
        // æ ¹æ“šä¸åŒçš„å€åŸŸè¼‰å…¥ç›¸æ‡‰çš„æ•¸æ“š
        switch(sectionId) {
          case 'myScripts':
            loadMyScripts();
            break;
          case 'accountPositioning':
            loadPositioningRecords();
            break;
          case 'topicHistory':
            loadTopicHistory();
            break;
        }
      }

      // æ›´æ–°å€‹äººè³‡æ–™é¡¯ç¤º
      function updatePersonalInfo() {
        if (ipPlanningUser) {
          // ç¢ºä¿ç”¨æˆ¶æœ‰IDï¼Œå¦‚æœæ²’æœ‰å‰‡ç”Ÿæˆä¸€å€‹
          if (!ipPlanningUser.user_id) {
            ipPlanningUser.user_id = generateUserId();
            localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
            console.log('åœ¨updatePersonalInfoä¸­ç‚ºç”¨æˆ¶ç”Ÿæˆæ–°ID:', ipPlanningUser.user_id);
          }
          
          const userNameDetail = document.getElementById('userNameDetail');
          const userEmailDetail = document.getElementById('userEmailDetail');
          const userIdDetail = document.getElementById('userIdDetail');
          
          if (userNameDetail) userNameDetail.textContent = ipPlanningUser.name || ipPlanningUser.displayName || 'æœªè¨­å®š';
          if (userEmailDetail) userEmailDetail.textContent = ipPlanningUser.email || 'æœªè¨­å®š';
          if (userIdDetail) userIdDetail.textContent = ipPlanningUser.user_id || 'æœªç”Ÿæˆ';
          
          console.log('æ›´æ–°å€‹äººè³‡æ–™:', {
            name: ipPlanningUser.name,
            email: ipPlanningUser.email,
            user_id: ipPlanningUser.user_id
          });
        }
      }
      
      // æ›´æ–°ç”¨æˆ¶è³‡è¨Šé¡¯ç¤º
      function updateUserInfo() {
        if (ipPlanningUser) {
          // æ›´æ–°é ­åƒ
          if (userAvatar) {
            userAvatar.src = ipPlanningUser.picture || 'https://via.placeholder.com/32';
          }
          // æ›´æ–°ç”¨æˆ¶å
          if (userName) {
            userName.textContent = ipPlanningUser.name || ipPlanningUser.displayName || 'ç”¨æˆ¶';
          }
          // é¡¯ç¤ºç”¨æˆ¶è³‡è¨Šå€åŸŸ
          if (userInfo) {
            userInfo.style.display = 'flex';
          }
          console.log('ç”¨æˆ¶è³‡è¨Šå·²æ›´æ–°:', ipPlanningUser);
        }
      }
      
      // æ›´æ–°èªè­‰ UI
      function updateAuthUI(isLoggedIn) {
        if (isLoggedIn) {
          // æ›´æ–°ç”¨æˆ¶è³‡è¨Šé¡¯ç¤º
          updateUserInfo();
          loginBtn.style.display = 'none';
          updateUserDrawer(ipPlanningUser);
          // é¡¯ç¤ºå€‹äººè³‡æ–™åº«åˆ†é 
          const userDBTab = document.getElementById('userDBTab');
          if (userDBTab) {
            userDBTab.style.display = 'inline-block';
          }
          // åŒæ™‚æ›´æ–°åº•éƒ¨å°èˆªæ¬„
          const bottomUserDBTab = document.getElementById('bottomUserDBTab');
          if (bottomUserDBTab) {
            bottomUserDBTab.style.display = 'flex';
          }
          // æ›´æ–°å€‹äººè³‡æ–™åº«ç”¨æˆ¶è³‡è¨Š
          updateDbUserInfo();
        } else {
          userInfo.style.display = 'none';
          loginBtn.style.display = 'block';
          closeUserDrawer();
          // éš±è—å€‹äººè³‡æ–™åº«åˆ†é 
          const userDBTab = document.getElementById('userDBTab');
          if (userDBTab) {
            userDBTab.style.display = 'none';
          }
          // åŒæ™‚éš±è—åº•éƒ¨å°èˆªæ¬„
          const bottomUserDBTab = document.getElementById('bottomUserDBTab');
          if (bottomUserDBTab) {
            bottomUserDBTab.style.display = 'none';
          }
        }
      }
      
      // å–æ¶ˆè¨‚é–±åŠŸèƒ½
      async function cancelSubscription() {
        if (!confirm('ç¢ºå®šè¦å–æ¶ˆè‡ªå‹•çºŒè²»å—ï¼Ÿå–æ¶ˆå¾Œå°‡åœ¨ç•¶æœŸçµæŸæ™‚åœæ­¢æœå‹™ã€‚')) {
          return;
        }
        
        if (!ipPlanningToken || !ipPlanningUser) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        try {
          // èª¿ç”¨å¾Œç«¯APIå–æ¶ˆè¨‚é–±
          const response = await fetch(`https://aivideobackend.zeabur.app/api/auth/me`, {
            method: 'PUT',
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              is_subscribed: false
            })
          });
          
          if (response.ok) {
            // æ›´æ–°æœ¬åœ°ç‹€æ…‹
            ipPlanningUser.is_subscribed = false;
            localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
            document.body.dataset.subscribed = 'false';
            
            showToast('å·²å–æ¶ˆè‡ªå‹•çºŒè²»', 3000);
            
            // é‡æ–°è¼‰å…¥å€‹äººè³‡æ–™
            setTimeout(() => {
              loadPersonalInfoForUserDB();
              closeUserDrawer();
            }, 1000);
          } else {
            showToast('æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
          }
        } catch (error) {
          console.error('å–æ¶ˆè¨‚é–±å¤±æ•—:', error);
          showToast('æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // ç™»å‡ºåŠŸèƒ½
      function logout() {
        ipPlanningToken = null;
        ipPlanningUser = null;
        localStorage.removeItem('ipPlanningToken');
        localStorage.removeItem('ipPlanningUser');
        localStorage.removeItem('subscriptionStatus');
        
        updateAuthUI(false);
        showToast('å·²ç™»å‡º', 3000);
        closeUserDrawer();
        
        // é¡¯ç¤ºé¦–é ï¼ˆä¸è·³è½‰åˆ°ç™»å…¥é é¢ï¼‰
        showMainApp();
        
        // é¡¯ç¤ºç™»å…¥æŒ‰éˆ•
        showLoginButton();
        
        // æ›´æ–°è¨‚é–±ç‹€æ…‹ç‚ºæœªè¨‚é–±
        document.body.dataset.subscribed = 'false';
        updateSubscriptionLock();
      }
      // æ›´æ–°å€‹äººè³‡æ–™åº«ç”¨æˆ¶è³‡è¨Š
      function updateDbUserInfo() {
        if (ipPlanningUser) {
          const dbUserAvatar = document.getElementById('dbUserAvatar');
          const dbUserName = document.getElementById('dbUserName');
          const dbUserEmail = document.getElementById('dbUserEmail');
          
          if (dbUserAvatar) dbUserAvatar.src = ipPlanningUser.picture || 'https://via.placeholder.com/48';
          if (dbUserName) dbUserName.textContent = ipPlanningUser.name || 'ç”¨æˆ¶';
          if (dbUserEmail) dbUserEmail.textContent = ipPlanningUser.email || 'user@example.com';
        }
      }
      
      // é¡¯ç¤ºå€‹äººè³‡æ–™åº«åˆ†å€
      function showDbSection(sectionName) {
        // éš±è—æ‰€æœ‰åˆ†å€
        document.querySelectorAll('.db-section').forEach(section => {
          section.classList.remove('active');
        });
        
        // ç§»é™¤æ‰€æœ‰é¸å–®é …çš„activeç‹€æ…‹
        document.querySelectorAll('.menu-item').forEach(item => {
          item.classList.remove('active');
        });
        
        // é¡¯ç¤ºé¸ä¸­çš„åˆ†å€
        const targetSection = document.getElementById(`db-${sectionName}`);
        if (targetSection) {
          targetSection.classList.add('active');
        }
        
        // æ·»åŠ å°æ‡‰é¸å–®é …çš„activeç‹€æ…‹
        const targetMenuItem = document.querySelector(`[onclick="showDbSection('${sectionName}')"]`);
        if (targetMenuItem) {
          targetMenuItem.classList.add('active');
        }
        
        // æ ¹æ“šåˆ†å€è¼‰å…¥ç›¸æ‡‰æ•¸æ“š
        switch(sectionName) {
          case 'personalInfo':
            loadPersonalInfoForUserDB();
            break;
          case 'myScripts':
            loadMyScriptsForUserDB();
            break;
          case 'accountPositioning':
            loadPositioningRecordsForUserDB();
            break;
          case 'topicRecords':
            loadTopicHistoryForUserDB();
            break;
          case 'settings':
            // è¨­å®šé é¢å…§å®¹å·²åœ¨HTMLä¸­å®šç¾©ï¼Œç„¡éœ€å‹•æ…‹è¼‰å…¥
            break;
          case 'usageStats':
            loadUsageStatsForUserDB();
            break;
          case 'helpCenter':
            // å¹«åŠ©ä¸­å¿ƒå…§å®¹å·²åœ¨HTMLä¸­å®šç¾©ï¼Œç„¡éœ€å‹•æ…‹è¼‰å…¥
            break;
        }
      }
      
      // æ¸²æŸ“å€‹äººè³‡æ–™å…§å®¹ï¼ˆç¨ç«‹å‡½æ•¸ï¼Œé¿å…éè¿´å•é¡Œï¼‰
      function renderPersonalInfoContent() {
        const content = document.querySelector('#db-personalInfo .section-content');
        if (!content || !ipPlanningUser) return;
        
        // å¦‚æœæœ‰æœ¬åœ°å„²å­˜çš„ç”¨æˆ¶è³‡è¨Šï¼Œç›´æ¥ä½¿ç”¨ï¼ˆå³ä½¿ API å¤±æ•—ä¹Ÿèƒ½é¡¯ç¤ºï¼‰
          // æ ¼å¼åŒ–æ—¥æœŸé¡¯ç¤º
          let registrationTime = 'æœªçŸ¥';
          if (ipPlanningUser.created_at) {
            try {
              const date = new Date(ipPlanningUser.created_at);
              if (!isNaN(date.getTime())) {
                registrationTime = date.toLocaleString('zh-TW', {
                  timeZone: 'Asia/Taipei',
                  year: 'numeric',
                  month: '2-digit',
                  day: '2-digit',
                  hour: '2-digit',
                  minute: '2-digit'
                });
              }
            } catch (e) {
              // å¦‚æœæ ¼å¼åŒ–å¤±æ•—ï¼Œä½¿ç”¨åŸå§‹å€¼
              registrationTime = ipPlanningUser.created_at;
            }
          }
          
          // è¨‚é–±ç‹€æ…‹ï¼ˆé è¨­ç‚ºå·²è¨‚é–±ï¼Œé™¤éæ˜ç¢ºè¨­ç‚º falseï¼‰
          const isSubscribed = ipPlanningUser.is_subscribed !== false; // é è¨­ç‚ºå·²è¨‚é–±
          const subscriptionStatus = isSubscribed ? 
            '<span style="color: #10b981; font-weight: bold;">âœ… å·²è¨‚é–±</span>' : 
            '<span style="color: #ef4444; font-weight: bold;">âŒ æœªè¨‚é–±</span>';
          
          // è‡ªå‹•çºŒè²»æ—¥æœŸï¼ˆä¸‹å€‹æœˆåŒä¸€å¤©ï¼‰
          let renewalDate = 'æœªçŸ¥';
          if (ipPlanningUser.created_at && isSubscribed) {
            try {
              const createdDate = new Date(ipPlanningUser.created_at);
              const renewal = new Date(createdDate);
              renewal.setMonth(renewal.getMonth() + 1);
              renewalDate = renewal.toLocaleString('zh-TW', {
                timeZone: 'Asia/Taipei',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
              });
            } catch (e) {
              renewalDate = 'æœªçŸ¥';
            }
          }
          
          content.innerHTML = `
            <div class="profile-details">
              <div class="detail-item">
                <label>å§“åï¼š</label>
                <span>${ipPlanningUser.name || 'æœªè¨­å®š'}</span>
              </div>
              <div class="detail-item">
                <label>Emailï¼š</label>
                <span>${ipPlanningUser.email || 'æœªè¨­å®š'}</span>
              </div>
              <div class="detail-item">
                <label>ç”¨æˆ¶IDï¼š</label>
                <span>${ipPlanningUser.user_id || 'æœªç”Ÿæˆ'}</span>
              </div>
              <div class="detail-item">
                <label>è¨»å†Šæ™‚é–“ï¼š</label>
                <span>${registrationTime}</span>
              </div>
              <div class="detail-item">
                <label>è¨‚é–±ç‹€æ…‹ï¼š</label>
                <span>${subscriptionStatus}</span>
              </div>
              ${isSubscribed ? `
              <div class="detail-item">
                <label>ä¸‹æ¬¡çºŒè²»æ—¥æœŸï¼š</label>
                <span>${renewalDate}</span>
              </div>
              <div class="detail-actions">
                <button class="btn btn-danger" onclick="cancelSubscription()" style="padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; background: #ef4444; color: white;">
                  ğŸ”´ å–æ¶ˆè‡ªå‹•çºŒè²»
                </button>
              </div>
              ` : `
              <div class="detail-actions">
                <button class="btn btn-success" onclick="window.open('https://aivideonew.zeabur.app/', '_blank')" style="padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; background: #10b981; color: white;">
                  âœ¨ å•Ÿç”¨è¨‚é–±
                </button>
              </div>
              `}
            </div>
          `;
      }
      
      // è¼‰å…¥å€‹äººè³‡æ–™åº«çš„å€‹äººè³‡æ–™
      async function loadPersonalInfoForUserDB() {
        const content = document.querySelector('#db-personalInfo .section-content');
        if (!content) return;
        
        // å¦‚æœæ²’æœ‰æœ¬åœ°ç”¨æˆ¶è³‡è¨Šï¼Œé¡¯ç¤ºæç¤º
        if (!ipPlanningUser) {
          content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥ä»¥æŸ¥çœ‹å€‹äººè³‡æ–™</div>';
          return;
        }
        
        // å…ˆç«‹å³æ¸²æŸ“æœ¬åœ°è³‡è¨Šï¼ˆç¢ºä¿é é¢æœ‰å…§å®¹ï¼‰
        renderPersonalInfoContent();
        
        // å¦‚æœæœ‰ token ä½†ç¼ºå°‘ created_at ç­‰é—œéµè³‡è¨Šï¼Œåœ¨èƒŒæ™¯ä¸­å˜—è©¦æ›´æ–°
        if (ipPlanningToken && !ipPlanningUser.created_at) {
          // ä½¿ç”¨ setTimeout éåŒæ­¥è™•ç†ï¼Œé¿å…é˜»å¡é é¢é¡¯ç¤º
          setTimeout(async () => {
            try {
              await fetchUserInfo();
              // å¦‚æœæ›´æ–°æˆåŠŸï¼Œé‡æ–°æ¸²æŸ“ï¼ˆåªæ¸²æŸ“ï¼Œä¸é‡æ–°è¼‰å…¥ï¼‰
              if (ipPlanningUser && ipPlanningUser.created_at) {
                renderPersonalInfoContent();
              }
            } catch (error) {
              // éœé»˜å¤±æ•—ï¼Œä¸å½±éŸ¿å·²é¡¯ç¤ºçš„å…§å®¹
            }
          }, 100);
        }
      }
      
      // è¼‰å…¥å‰µä½œè€…è³‡æ–™åº«çš„æˆ‘çš„è…³æœ¬
      async function loadMyScriptsForUserDB() {
        const content = document.querySelector('#db-myScripts .section-content');
        
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥ä»¥æŸ¥çœ‹è…³æœ¬è¨˜éŒ„</div>';
          return;
        }
        
        content.innerHTML = '<div class="loading-text">æ­£åœ¨è¼‰å…¥è…³æœ¬è¨˜éŒ„...</div>';
        
        console.log('æ­£åœ¨è¼‰å…¥è…³æœ¬åˆ—è¡¨...', {
          ipPlanningToken: ipPlanningToken ? 'present' : 'missing',
          userId: ipPlanningUser.user_id
        });
        
        // å…ˆæª¢æŸ¥æœ¬åœ°å„²å­˜çš„è…³æœ¬ï¼ˆåƒ…ç”¨æ–¼å¿«é€Ÿé¡¯ç¤ºï¼Œä»æœƒå¾å¾Œç«¯ç²å–æœ€æ–°è³‡æ–™ï¼‰
        const localScripts = getLocalScripts();
        console.log('æœ¬åœ°è…³æœ¬æ•¸é‡:', localScripts.length);
        console.log('æœ¬åœ°è…³æœ¬å…§å®¹:', localScripts);
        
        if (localScripts.length > 0) {
          console.log('å…ˆé¡¯ç¤ºæœ¬åœ°è…³æœ¬:', localScripts);
          displayScriptsForUserDB(localScripts);
          // ç¹¼çºŒåŸ·è¡Œ API èª¿ç”¨ä»¥ç²å–æœ€æ–°è³‡æ–™
        }
        
        // å¾å¾Œç«¯ API ç²å–è…³æœ¬åˆ—è¡¨
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/scripts/my', {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            }
          });
          
          console.log('è…³æœ¬åˆ—è¡¨éŸ¿æ‡‰ç‹€æ…‹:', response.status);
          
          if (response.ok) {
            const data = await response.json();
            console.log('è…³æœ¬åˆ—è¡¨æ•¸æ“š:', data);
            const serverScripts = data.scripts || [];
            
            // å¦‚æœæœ‰ä¼ºæœå™¨è…³æœ¬ï¼Œé¡¯ç¤ºä¼ºæœå™¨è…³æœ¬ï¼›å¦å‰‡å¦‚æœæœ‰æœ¬åœ°è…³æœ¬ï¼Œä¿æŒé¡¯ç¤ºæœ¬åœ°è…³æœ¬
            if (serverScripts.length > 0) {
              displayScriptsForUserDB(serverScripts);
            } else if (localScripts.length === 0) {
              content.innerHTML = '<div class="loading-text">é‚„æ²’æœ‰å„²å­˜çš„è…³æœ¬ï¼Œè«‹å…ˆä½¿ç”¨ä¸€éµç”ŸæˆåŠŸèƒ½å‰µå»ºè…³æœ¬</div>';
            }
          } else if (response.status === 401) {
            console.log('è…³æœ¬è¼‰å…¥å¤±æ•—: èªè­‰éŒ¯èª¤');
            // å¦‚æœæ²’æœ‰æœ¬åœ°è…³æœ¬ï¼Œé¡¯ç¤ºéŒ¯èª¤ï¼›å¦å‰‡ä¿æŒé¡¯ç¤ºæœ¬åœ°è…³æœ¬
            if (localScripts.length === 0) {
              // å˜—è©¦åˆ·æ–° token å¾Œé‡è©¦
              const refreshed = await tryRefreshTokenSafe();
              if (refreshed) {
                // Token åˆ·æ–°æˆåŠŸï¼Œé‡è©¦ä¸€æ¬¡
                return loadMyScriptsForUserDB();
              }
              content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
            } else {
              console.warn('API èªè­‰å¤±æ•—ï¼Œä½†å·²æœ‰æœ¬åœ°è…³æœ¬ï¼Œç¹¼çºŒä½¿ç”¨æœ¬åœ°è…³æœ¬');
            }
          } else if (response.status === 404) {
            console.log('è…³æœ¬è¼‰å…¥å¤±æ•—: APIä¸å­˜åœ¨');
            // å¦‚æœæ²’æœ‰æœ¬åœ°è…³æœ¬ï¼Œé¡¯ç¤ºéŒ¯èª¤ï¼›å¦å‰‡ä¿æŒé¡¯ç¤ºæœ¬åœ°è…³æœ¬
            if (localScripts.length === 0) {
              content.innerHTML = '<div class="loading-text">è…³æœ¬åŠŸèƒ½å³å°‡ä¸Šç·šï¼Œè«‹ç¨å¾Œå†è©¦</div>';
            } else {
              console.warn('API ä¸å­˜åœ¨ï¼Œä½†å·²æœ‰æœ¬åœ°è…³æœ¬ï¼Œç¹¼çºŒä½¿ç”¨æœ¬åœ°è…³æœ¬');
            }
          } else {
            const errorData = await response.json().catch(() => ({}));
            console.log('è…³æœ¬è¼‰å…¥å¤±æ•—:', errorData);
            // å¦‚æœæ²’æœ‰æœ¬åœ°è…³æœ¬ï¼Œé¡¯ç¤ºéŒ¯èª¤ï¼›å¦å‰‡ä¿æŒé¡¯ç¤ºæœ¬åœ°è…³æœ¬
            if (localScripts.length === 0) {
              content.innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
            } else {
              console.warn('API è¼‰å…¥å¤±æ•—ï¼Œä½†å·²æœ‰æœ¬åœ°è…³æœ¬ï¼Œç¹¼çºŒä½¿ç”¨æœ¬åœ°è…³æœ¬');
            }
          }
        } catch (error) {
          console.error('Load scripts error:', error);
          // å¦‚æœæ²’æœ‰æœ¬åœ°è…³æœ¬ï¼Œé¡¯ç¤ºéŒ¯èª¤ï¼›å¦å‰‡ä¿æŒé¡¯ç¤ºæœ¬åœ°è…³æœ¬
          if (localScripts.length === 0) {
            content.innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
          } else {
            console.warn('API èª¿ç”¨ç•°å¸¸ï¼Œä½†å·²æœ‰æœ¬åœ°è…³æœ¬ï¼Œç¹¼çºŒä½¿ç”¨æœ¬åœ°è…³æœ¬');
          }
        }
      }
      
      // ===== ChatGPT é¢¨æ ¼åŠŸèƒ½å‡½æ•¸ =====
      
      // åˆå§‹åŒ– Markdown æ¸²æŸ“å™¨
      function initMarkdownRenderer() {
        if (typeof marked !== 'undefined') {
          marked.setOptions({
            highlight: function(code, lang) {
              if (typeof hljs !== 'undefined' && lang && hljs.getLanguage(lang)) {
                return hljs.highlight(code, { language: lang }).value;
              }
              return code;
            },
            breaks: true,
            gfm: true
          });
        }
      }
      
      // Markdown æ¸²æŸ“å‡½æ•¸
      function renderMarkdown(text) {
        if (typeof marked !== 'undefined') {
          return marked.parse(text);
        }
        return text.replace(/\n/g, '<br>');
      }
      
      // å‰µå»º ChatGPT é¢¨æ ¼çš„è¨Šæ¯å…ƒç´ 
      function createChatGPTMessage(role, content) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${role}`;
        
        const avatarDiv = document.createElement('div');
        avatarDiv.className = 'message-avatar';
        
        if (role === 'user') {
          // è¼‰å…¥Googleç”¨æˆ¶é ­åƒ
          const userAvatarImg = document.getElementById('userAvatar');
          if (userAvatarImg && userAvatarImg.src && userAvatarImg.src !== '') {
            const img = document.createElement('img');
            img.src = userAvatarImg.src;
            img.alt = 'ç”¨æˆ¶é ­åƒ';
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.borderRadius = '50%';
            img.style.objectFit = 'cover';
            avatarDiv.appendChild(img);
          } else {
            avatarDiv.textContent = 'ğŸ‘¤';
          }
        } else {
          avatarDiv.textContent = 'ğŸ¤–';
        }
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        
        if (role === 'assistant') {
          contentDiv.innerHTML = renderMarkdown(content);
        } else {
          contentDiv.textContent = content;
        }
        
        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);
        
        return messageDiv;
      }
      
      // å‰µå»ºè¼‰å…¥å‹•ç•«
      function createTypingIndicator() {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message assistant';
        
        const avatarDiv = document.createElement('div');
        avatarDiv.className = 'message-avatar';
        avatarDiv.textContent = 'ğŸ¤–';
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        contentDiv.innerHTML = `
          <div class="typing-indicator">
            <span>AIæ­£åœ¨æ€è€ƒä¸­</span>
            <div class="typing-dots">
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
            </div>
          </div>
        `;
        
        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);
        
        return messageDiv;
      }
      
      // ä¸²æµé¡¯ç¤ºæ–‡å­—
      function streamText(element, text, speed = 30) {
        return new Promise((resolve) => {
          let index = 0;
          element.innerHTML = '';
          
          const stream = () => {
            if (index < text.length) {
              element.innerHTML += text[index];
              index++;
              setTimeout(stream, speed);
            } else {
              // æ·»åŠ é–ƒçˆæ¸¸æ¨™
              const cursor = document.createElement('span');
              cursor.className = 'streaming-cursor';
              element.appendChild(cursor);
              resolve();
            }
          };
          
          stream();
        });
      }
      
      // è‡ªå‹•èª¿æ•´è¼¸å…¥æ¡†é«˜åº¦
      function autoResizeTextarea(textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
      }
      
      // ç™¼é€è¨Šæ¯å‡½æ•¸ï¼ˆChatGPT é¢¨æ ¼ï¼Œå…¼å®¹ç¾æœ‰å¾Œç«¯ï¼‰
      async function sendMessageChatGPT(message) {
        const chatMessages = document.getElementById('chatMessages');
        if (!chatMessages) return;
        
        // æ·»åŠ ç”¨æˆ¶è¨Šæ¯
        const userMessage = createChatGPTMessage('user', message);
        chatMessages.appendChild(userMessage);
        try { await recordConversationMessage('ip_planning', 'user', message); } catch (_) {}
        
        // æ·»åŠ è¼‰å…¥å‹•ç•«
        const typingIndicator = createTypingIndicator();
        chatMessages.appendChild(typingIndicator);
        
        // æ»¾å‹•åˆ°åº•éƒ¨
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        try {
          // ä½¿ç”¨ç¾æœ‰çš„å¾Œç«¯APIç«¯é»å’Œåƒæ•¸
          const endpoint = 'https://aivideobackend.zeabur.app/api/chat/stream';
          const headers = { 'Content-Type': 'application/json' };
          if (ipPlanningToken) {
            headers['Authorization'] = `Bearer ${ipPlanningToken}`;
          }
          
          // å®‰å…¨åœ°ç²å–è¨­å®šå€¼ï¼Œé¿å…æœªå®šç¾©è®Šæ•¸éŒ¯èª¤
          const safeSettingsApplied = typeof settingsApplied !== 'undefined' ? settingsApplied : false;
          const safeAppliedSettings = typeof appliedSettings !== 'undefined' ? appliedSettings : {};
          const safeStyleInstruction = typeof styleInstruction !== 'undefined' ? styleInstruction : null;
          
          const response = await fetch(endpoint, {
            method: 'POST',
            headers,
            body: JSON.stringify({
              message: message,
              platform: safeSettingsApplied ? safeAppliedSettings.platform : null,
              topic: safeSettingsApplied ? safeAppliedSettings.topic : null,
              duration: safeSettingsApplied ? safeAppliedSettings.duration : null,
              style: safeStyleInstruction,
              profile: safeSettingsApplied ? safeAppliedSettings.positioning : null,
              history: [], // ä¿æŒç¾æœ‰çš„æ­·å²è¨˜éŒ„æ ¼å¼
              user_id: ipPlanningUser?.user_id || null
            })
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          // ç§»é™¤è¼‰å…¥å‹•ç•«
          chatMessages.removeChild(typingIndicator);
          
          // å‰µå»ºAIå›æ‡‰å®¹å™¨
          const aiMessage = createChatGPTMessage('assistant', '');
          chatMessages.appendChild(aiMessage);
          
          const contentDiv = aiMessage.querySelector('.message-content');
          
          // è™•ç†ä¸²æµå›æ‡‰
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          let buffer = '';
          let fullContent = '';
          
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += decoder.decode(value, { stream: true });
            const lines = buffer.split('\n');
            buffer = lines.pop(); // ä¿ç•™æœ€å¾Œä¸€è¡Œï¼ˆå¯èƒ½ä¸å®Œæ•´ï¼‰
            
            for (const line of lines) {
              if (line.startsWith('data: ')) {
                const data = line.slice(6);
                if (data === '[DONE]') {
                  // ç§»é™¤é–ƒçˆæ¸¸æ¨™
                  const cursor = contentDiv.querySelector('.streaming-cursor');
                  if (cursor) cursor.remove();
                  
                  // æª¢æŸ¥æ˜¯å¦éœ€è¦é¡¯ç¤ºçµæœå€å¡Š
                  if (fullContent) {
                    checkIfScriptRequest(fullContent);
                  }
                  try { await recordConversationMessage('ip_planning', 'assistant', fullContent); } catch (_) {}
                  return;
                }
                
                try {
                  const parsed = JSON.parse(data);
                  if (parsed.content) {
                    fullContent += parsed.content;
                    contentDiv.innerHTML = renderMarkdown(fullContent);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                  }
                } catch (e) {
                  // å¿½ç•¥è§£æéŒ¯èª¤
                }
              }
            }
          }
          
        } catch (error) {
          console.error('ç™¼é€è¨Šæ¯éŒ¯èª¤:', error);
          
          // ç§»é™¤è¼‰å…¥å‹•ç•«
          if (chatMessages.contains(typingIndicator)) {
            chatMessages.removeChild(typingIndicator);
          }
          
          // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
          const errorMessage = createChatGPTMessage('assistant', `æŠ±æ­‰ï¼Œç™¼ç”Ÿäº†éŒ¯èª¤ï¼š${error.message}`);
          chatMessages.appendChild(errorMessage);
        }
        
        // æ»¾å‹•åˆ°åº•éƒ¨
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      
      // å¼·åˆ¶æ¸…é™¤å¿«å–ä¸¦é‡æ–°è¼‰å…¥æ¨£å¼
      function forceReloadStyles() {
        // å¼·åˆ¶é‡æ–°è¼‰å…¥CSS
        const links = document.querySelectorAll('link[rel="stylesheet"]');
        links.forEach(link => {
          const href = link.href;
          link.href = href + '?v=' + Date.now();
        });
        
        // å¼·åˆ¶é‡æ–°è¼‰å…¥å…§è¯æ¨£å¼
        const style = document.querySelector('style');
        if (style) {
          style.innerHTML = style.innerHTML;
        }
      }
      
      // ===== ChatGPT é¢¨æ ¼ AI é¡§å•åŠŸèƒ½ =====
      
      // åˆå§‹åŒ– Markdown æ¸²æŸ“å™¨
      function initMarkdownRenderer() {
        if (typeof marked !== 'undefined') {
          marked.setOptions({
            renderer: new marked.Renderer(),
            gfm: true,
            breaks: true,
            sanitize: false,
            langPrefix: 'hljs language-',
            highlight: function(code, lang) {
              if (typeof hljs !== 'undefined' && hljs.getLanguage(lang)) {
                return hljs.highlight(code, { language: lang }).value;
              }
              return code;
            }
          });
        }
      }

      // æ¸²æŸ“ Markdown å…§å®¹
      function renderMarkdown(text) {
        if (typeof marked !== 'undefined') {
          return marked.parse(text);
        }
        return text.replace(/\n/g, '<br>');
      }

      // å‰µå»ºèŠå¤©è¨Šæ¯å…ƒç´ 
      function createMessage(role, content) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${role}`;
        
        const avatarDiv = document.createElement('div');
        avatarDiv.className = 'message-avatar';
        
        if (role === 'user') {
          // å˜—è©¦è¼‰å…¥Googleç”¨æˆ¶é ­åƒ
          const userAvatarImg = document.getElementById('userAvatar');
          if (userAvatarImg && userAvatarImg.src && userAvatarImg.src !== '') {
            const img = document.createElement('img');
            img.src = userAvatarImg.src;
            img.alt = 'ç”¨æˆ¶é ­åƒ';
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.borderRadius = '50%';
            img.style.objectFit = 'cover';
            avatarDiv.appendChild(img);
          } else {
            avatarDiv.textContent = 'ğŸ‘¤';
          }
        } else {
          avatarDiv.textContent = 'ğŸ¤–';
        }
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        
        if (role === 'assistant' && content) {
          contentDiv.innerHTML = renderMarkdown(content);
          // å°ä»£ç¢¼å¡Šé€²è¡Œèªæ³•é«˜äº®
          if (typeof hljs !== 'undefined') {
            contentDiv.querySelectorAll('pre code').forEach((block) => {
              hljs.highlightElement(block);
            });
          }
        } else if (role === 'user') {
          contentDiv.textContent = content;
        }
        
        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);
        
        return messageDiv;
      }

      // å‰µå»ºè¼‰å…¥å‹•ç•«
      function createTypingIndicator() {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message assistant';
        
        const avatarDiv = document.createElement('div');
        avatarDiv.className = 'message-avatar';
        avatarDiv.textContent = 'ğŸ¤–';
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        contentDiv.innerHTML = `
          <div class="typing-indicator">
            <span>AIæ­£åœ¨æ€è€ƒä¸­</span>
            <div class="typing-dots">
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
            </div>
          </div>
        `;
        
        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);
        
        return messageDiv;
      }

      // è‡ªå‹•èª¿æ•´è¼¸å…¥æ¡†é«˜åº¦
      function autoResizeTextarea() {
        const textarea = document.getElementById('messageInput');
        if (textarea) {
          textarea.style.height = 'auto';
          textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
          
          // æ›´æ–°ç™¼é€æŒ‰éˆ•ç‹€æ…‹
          const sendBtn = document.getElementById('sendBtn');
          if (sendBtn) {
            sendBtn.disabled = textarea.value.trim() === '';
          }
        }
      }

      // ç™¼é€è¨Šæ¯ï¼ˆæ•´åˆåŸæœ‰å¾Œç«¯å’ŒLLMè¨­å®šï¼‰
      async function sendMessage(message) {
        if (!message || !message.trim()) return;
        
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const quickButtons = document.getElementById('quickButtons');
        
        // æ·»åŠ ç”¨æˆ¶è¨Šæ¯
        const userMessage = createMessage('user', message);
        chatMessages.appendChild(userMessage);
        
        // éš±è—å¿«é€ŸæŒ‰éˆ•
        if (quickButtons) {
          quickButtons.style.display = 'none';
        }
        
        // æ¸…ç©ºè¼¸å…¥æ¡†ä¸¦ç¦ç”¨
        messageInput.value = '';
        messageInput.disabled = true;
        sendBtn.disabled = true;
        autoResizeTextarea();
        
        // æ·»åŠ è¼‰å…¥å‹•ç•«
        const typingIndicator = createTypingIndicator();
        chatMessages.appendChild(typingIndicator);
        
        // æ»¾å‹•åˆ°åº•éƒ¨
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        try {
          // ä½¿ç”¨åŸæœ‰çš„å¾Œç«¯APIå’ŒLLMè¨­å®š
          const endpoint = 'https://aivideobackend.zeabur.app/api/chat/stream';
          const headers = { 'Content-Type': 'application/json' };
          if (ipPlanningToken) {
            headers['Authorization'] = `Bearer ${ipPlanningToken}`;
          }
          
          // å®‰å…¨åœ°ç²å–è¨­å®šå€¼
          const safeSettingsApplied = typeof settingsApplied !== 'undefined' ? settingsApplied : false;
          const safeAppliedSettings = typeof appliedSettings !== 'undefined' ? appliedSettings : {};
          const safeStyleInstruction = typeof styleInstruction !== 'undefined' ? styleInstruction : null;
          
          const response = await fetch(endpoint, {
            method: 'POST',
            headers,
            body: JSON.stringify({
              message: message,
              platform: safeSettingsApplied ? safeAppliedSettings.platform : null,
              topic: safeSettingsApplied ? safeAppliedSettings.topic : null,
              duration: safeSettingsApplied ? safeAppliedSettings.duration : null,
              style: safeStyleInstruction,
              profile: safeSettingsApplied ? safeAppliedSettings.positioning : null,
              history: [], // ä¿æŒç¾æœ‰çš„æ­·å²è¨˜éŒ„æ ¼å¼
              user_id: ipPlanningUser?.user_id || null
            })
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          // ç§»é™¤è¼‰å…¥å‹•ç•«
          chatMessages.removeChild(typingIndicator);
          
          // å‰µå»ºAIå›æ‡‰å®¹å™¨
          const aiMessage = createMessage('assistant', '');
          chatMessages.appendChild(aiMessage);
          
          const contentDiv = aiMessage.querySelector('.message-content');
          
          // è™•ç†ä¸²æµå›æ‡‰
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          let buffer = '';
          let fullContent = '';
          
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += decoder.decode(value, { stream: true });
            const lines = buffer.split('\n');
            buffer = lines.pop();
            
            for (const line of lines) {
              if (line.startsWith('data: ')) {
                const data = line.slice(6);
                if (data === '[DONE]') {
                  // æª¢æŸ¥æ˜¯å¦éœ€è¦é¡¯ç¤ºçµæœå€å¡Š
                  if (fullContent) {
                    checkIfScriptRequest(fullContent);
                  }
                  break;
                }
                
                try {
                  const parsed = JSON.parse(data);
                  if (parsed.content) {
                    fullContent += parsed.content;
                    contentDiv.innerHTML = renderMarkdown(fullContent);
                    
                    // å°ä»£ç¢¼å¡Šé€²è¡Œèªæ³•é«˜äº®
                    if (typeof hljs !== 'undefined') {
                      contentDiv.querySelectorAll('pre code').forEach((block) => {
                        if (!block.classList.contains('hljs')) {
                          hljs.highlightElement(block);
                        }
                      });
                    }
                    
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                  }
                } catch (e) {
                  // å¿½ç•¥è§£æéŒ¯èª¤
                }
              }
            }
          }
          
        } catch (error) {
          console.error('ç™¼é€è¨Šæ¯éŒ¯èª¤:', error);
          
          // ç§»é™¤è¼‰å…¥å‹•ç•«
          if (chatMessages.contains(typingIndicator)) {
            chatMessages.removeChild(typingIndicator);
          }
          
          // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
          const errorMessage = createMessage('assistant', `æŠ±æ­‰ï¼Œç™¼ç”Ÿäº†éŒ¯èª¤ï¼š${error.message}`);
          chatMessages.appendChild(errorMessage);
        }
        
        // æ¢å¾©è¼¸å…¥æ¡†å’ŒæŒ‰éˆ•
        messageInput.disabled = false;
        sendBtn.disabled = false;
        
        // æ»¾å‹•åˆ°åº•éƒ¨
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      // åˆå§‹åŒ– ChatGPT é¢¨æ ¼åŠŸèƒ½
      function initChatGPTFeatures() {
        try {
          // åªåœ¨AIé¡§å•æ¨¡å¼é é¢æ‰åˆå§‹åŒ–
          const currentPage = document.querySelector('.page.active');
          if (!currentPage || currentPage.id !== 'mode2') {
            return;
          }
          
          
          // å¼·åˆ¶æ¸…é™¤å¿«å–
          forceReloadStyles();
          
          // åˆå§‹åŒ– Markdown æ¸²æŸ“å™¨
          initMarkdownRenderer();
        
          // è¨­ç½®è¼¸å…¥æ¡†äº‹ä»¶ç›£è½å™¨
          const messageInput = document.getElementById('messageInput');
          const sendBtn = document.getElementById('sendBtn');
          
          if (messageInput) {
            // è‡ªå‹•èª¿æ•´é«˜åº¦
            messageInput.addEventListener('input', autoResizeTextarea);
            
            // éµç›¤äº‹ä»¶ï¼šEnteræ›è¡Œï¼ŒCtrl+Enterç™¼é€
            messageInput.addEventListener('keydown', (e) => {
              if (e.key === 'Enter' && e.ctrlKey) {
                e.preventDefault();
                const message = messageInput.value.trim();
                if (message) {
                  sendMessage(message);
                }
              }
            });
          }
          
          // è¨­ç½®ç™¼é€æŒ‰éˆ•äº‹ä»¶
          if (sendBtn) {
            sendBtn.addEventListener('click', () => {
              const message = messageInput.value.trim();
              if (message) {
                sendMessage(message);
              }
            });
          }
          
          // è¼‰å…¥æ­·å²å°è©±è¨˜éŒ„
          loadMode2History();
          
          // è¨­ç½®å¿«é€ŸæŒ‰éˆ•äº‹ä»¶
          const quickButtons = document.getElementById('quickButtons');
          if (quickButtons) {
            const quickBtns = quickButtons.querySelectorAll('.quick-btn');
            quickBtns.forEach(btn => {
              btn.addEventListener('click', () => {
                const text = btn.getAttribute('data-text');
                if (text) {
                  sendMessage(text);
                }
              });
            });
          }
        } catch (error) {
          console.error('ChatGPTåŠŸèƒ½åˆå§‹åŒ–éŒ¯èª¤:', error);
        }
      }
      
      // é¡¯ç¤ºè…³æœ¬åˆ—è¡¨ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      function displayScriptsForUserDB(scripts) {
        const container = document.querySelector('#db-myScripts .section-content');
        
        if (scripts.length === 0) {
          container.innerHTML = '<div class="loading-text">é‚„æ²’æœ‰å„²å­˜çš„è…³æœ¬</div>';
          return;
        }
        
        container.innerHTML = scripts.map((script, index) => `
          <div class="script-item" data-script-id="${script.id}">
            <div class="script-header" onclick="toggleScriptForUserDB(${script.id})">
              <div class="script-info">
                <span class="script-number">ç·¨è™Ÿ${String(index + 1).padStart(2, '0')}</span>
                <span class="script-name" onclick="editScriptNameForUserDB(${script.id}, event)">${script.name || script.title || 'æœªå‘½åè…³æœ¬'}</span>
                <span class="script-date">${formatTaiwanTime(script.created_at)}</span>
              </div>
              <div class="script-toggle">
                <span class="toggle-icon">â–¼</span>
              </div>
            </div>
            <div class="script-content" id="script-${script.id}" style="display: none;">
              <div class="script-details">
                <div class="script-table">
                  <table>
                    <thead>
                      <tr>
                        <th>æ™‚é–“</th>
                        <th>æ®µè½</th>
                        <th>é¡é ­/ç•«é¢</th>
                        <th>å°è© (æ¼”å“¡å£ç™½)</th>
                        <th>å­—å¹•æ–‡å­— (å¯å‹•ç•«)</th>
                        <th>éŸ³æ•ˆèˆ‡è½‰å ´</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${generateScriptTable(script.script_data || script.content || script)}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="script-actions" id="actions-${script.id}" style="display: none;">
              <button class="action-btn view-btn" onclick="viewFullScriptForUserDB(${script.id})">æŸ¥çœ‹å®Œæ•´çµæœ</button>
              <button class="action-btn download-pdf-btn" onclick="downloadScriptPDF(${script.id})">ä¸‹è¼‰PDFæª”æ¡ˆ</button>
              <button class="action-btn download-csv-btn" onclick="downloadScriptCSV(${script.id})">ä¸‹è¼‰CSVæª”æ¡ˆ</button>
              <button class="action-btn delete-btn" onclick="deleteScriptForUserDB(${script.id})">åˆªé™¤</button>
            </div>
          </div>
        `).join('');
      }
      
      // åˆ‡æ›è…³æœ¬é¡¯ç¤ºï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      function toggleScriptForUserDB(scriptId) {
        const scriptContent = document.getElementById(`script-${scriptId}`);
        const scriptActions = document.getElementById(`actions-${scriptId}`);
        const toggleIcon = document.querySelector(`[data-script-id="${scriptId}"] .toggle-icon`);
        
        if (scriptContent.style.display === 'none') {
          scriptContent.style.display = 'block';
          scriptActions.style.display = 'flex';
          toggleIcon.textContent = 'â–²';
        } else {
          scriptContent.style.display = 'none';
          scriptActions.style.display = 'none';
          toggleIcon.textContent = 'â–¼';
        }
      }
      
      // ç·¨è¼¯è…³æœ¬åç¨±ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      function editScriptNameForUserDB(scriptId, event) {
        event.stopPropagation();
        const scriptNameElement = document.querySelector(`[data-script-id="${scriptId}"] .script-name`);
        const currentName = scriptNameElement.textContent;
        
        const newName = prompt('è«‹è¼¸å…¥æ–°çš„è…³æœ¬åç¨±:', currentName);
        if (newName && newName.trim() !== '' && newName !== currentName) {
          updateScriptNameForUserDB(scriptId, newName.trim());
        }
      }
      
      // æ›´æ–°è…³æœ¬åç¨±ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      async function updateScriptNameForUserDB(scriptId, newName) {
        try {
          // å…ˆæ›´æ–°æœ¬åœ°é¡¯ç¤º
          const scriptNameElement = document.querySelector(`[data-script-id="${scriptId}"] .script-name`);
          scriptNameElement.textContent = newName;
          
          // æ›´æ–°æœ¬åœ°å„²å­˜
          const localScripts = getLocalScripts();
          const scriptIndex = localScripts.findIndex(script => script.id == scriptId);
          if (scriptIndex !== -1) {
            localScripts[scriptIndex].name = newName;
            localStorage.setItem('user_scripts', JSON.stringify(localScripts));
          }
          
          // å˜—è©¦æ›´æ–°å¾Œç«¯ï¼ˆå¦‚æœAPIå­˜åœ¨ï¼‰
          try {
            const response = await fetch(`https://aivideobackend.zeabur.app/api/scripts/${scriptId}/name`, {
              method: 'PUT',
              headers: {
                'Authorization': `Bearer ${ipPlanningToken}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ name: newName })
            });
            
            if (response.ok) {
              showToast('è…³æœ¬åç¨±å·²æ›´æ–°', 3000);
            } else {
              console.log('å¾Œç«¯æ›´æ–°å¤±æ•—ï¼Œä½†æœ¬åœ°å·²æ›´æ–°');
              showToast('è…³æœ¬åç¨±å·²æ›´æ–°ï¼ˆæœ¬åœ°ï¼‰', 3000);
            }
          } catch (apiError) {
            console.log('APIä¸å­˜åœ¨æˆ–ç¶²è·¯éŒ¯èª¤ï¼Œä½†æœ¬åœ°å·²æ›´æ–°');
            showToast('è…³æœ¬åç¨±å·²æ›´æ–°ï¼ˆæœ¬åœ°ï¼‰', 3000);
          }
          
        } catch (error) {
          console.error('Update script name error:', error);
          showToast('æ›´æ–°å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // æŸ¥çœ‹å®Œæ•´è…³æœ¬ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      function viewFullScriptForUserDB(scriptId) {
        // é€™è£¡å¯ä»¥å¯¦ç¾æŸ¥çœ‹å®Œæ•´è…³æœ¬çš„åŠŸèƒ½
        showToast('æŸ¥çœ‹å®Œæ•´è…³æœ¬åŠŸèƒ½é–‹ç™¼ä¸­...', 3000);
      }
      
      // åˆªé™¤è…³æœ¬ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      async function deleteScriptForUserDB(scriptId) {
        if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è…³æœ¬å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
          return;
        }
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/scripts/${scriptId}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            }
          });
        
          if (response.ok) {
            // å¾æœ¬åœ°å„²å­˜ä¸­ç§»é™¤
        const localScripts = getLocalScripts();
        const updatedScripts = localScripts.filter(script => script.id != scriptId);
        localStorage.setItem('user_scripts', JSON.stringify(updatedScripts));
        
        // é‡æ–°è¼‰å…¥è…³æœ¬åˆ—è¡¨
        loadMyScriptsForUserDB();
            showToast('è…³æœ¬å·²åˆªé™¤', 3000);
          } else {
            throw new Error('åˆªé™¤å¤±æ•—');
          }
        } catch (error) {
          console.error('Delete script error:', error);
          showToast('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // è¼‰å…¥å€‹äººè³‡æ–™åº«çš„å¸³è™Ÿå®šä½è¨˜éŒ„
      async function loadPositioningRecordsForUserDB() {
        const content = document.querySelector('#db-accountPositioning .section-content');
        
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥ä»¥æŸ¥çœ‹å¸³è™Ÿå®šä½è¨˜éŒ„</div>';
          return;
        }
        
        content.innerHTML = '<div class="loading-text">æ­£åœ¨è¼‰å…¥å¸³è™Ÿå®šä½è¨˜éŒ„...</div>';
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${ipPlanningUser.user_id}`, {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            displayPositioningRecordsForUserDB(data.records || []);
          } else if (response.status === 401) {
            content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          } else if (response.status === 404) {
            content.innerHTML = '<div class="loading-text">å¸³è™Ÿå®šä½åŠŸèƒ½å³å°‡ä¸Šç·šï¼Œè«‹ç¨å¾Œå†è©¦</div>';
          } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'è¼‰å…¥å¤±æ•—');
          }
        } catch (error) {
          console.error('Load positioning records error:', error);
          content.innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
        }
      }
      
      // é¡¯ç¤ºå¸³è™Ÿå®šä½è¨˜éŒ„ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      function displayPositioningRecordsForUserDB(records) {
        const container = document.querySelector('#db-accountPositioning .section-content');
        
        if (records.length === 0) {
          container.innerHTML = '<div class="loading-text">å°šç„¡å¸³è™Ÿå®šä½è¨˜éŒ„</div>';
          return;
        }
        
        container.innerHTML = records.map(record => {
          const date = new Date(record.created_at).toLocaleString('zh-TW', {
            timeZone: 'Asia/Taipei',
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          });
          const preview = record.content.substring(0, 100) + (record.content.length > 100 ? '...' : '');
          
          return `
            <div class="positioning-record-item" data-record-id="${record.id}">
              <div class="record-header">
                <span class="record-number">ç·¨è™Ÿ ${record.record_number}</span>
                <span class="record-date">${date}</span>
              </div>
              <div class="record-preview">${preview}</div>
              <div class="record-actions">
                <button class="action-btn view-btn" onclick="viewPositioningDetailForUserDB(${record.id}, '${record.record_number}')">æŸ¥çœ‹å®Œæ•´çµæœ</button>
                <button class="action-btn delete-btn" onclick="deletePositioningRecordForUserDB(${record.id})">åˆªé™¤</button>
              </div>
            </div>
          `;
        }).join('');
      }
      
      // æŸ¥çœ‹å¸³è™Ÿå®šä½è©³ç´°å…§å®¹ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      async function viewPositioningDetailForUserDB(recordId, recordNumber) {
        if (!ipPlanningUser?.user_id) return;
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${ipPlanningUser.user_id}`, {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            const record = data.records.find(r => r.id === recordId);
            
            if (record) {
              // å‰µå»ºå½ˆå‡ºè¦–çª—é¡¯ç¤ºå®Œæ•´å…§å®¹
              const modal = document.createElement('div');
              modal.className = 'modal-overlay';
              modal.innerHTML = `
                <div class="modal-content">
                  <div class="modal-header">
                    <h3>å¸³è™Ÿå®šä½è©³ç´°å…§å®¹ - ç·¨è™Ÿ ${recordNumber}</h3>
                    <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">Ã—</button>
                  </div>
                  <div class="modal-body">
                    <div class="record-detail">
                      <div class="detail-meta">
                        <span class="detail-label">å»ºç«‹æ™‚é–“ï¼š</span>
                        <span class="detail-value">${new Date(record.created_at).toLocaleString('zh-TW', {
                          timeZone: 'Asia/Taipei',
                          year: 'numeric',
                          month: '2-digit',
                          day: '2-digit',
                          hour: '2-digit',
                          minute: '2-digit'
                        })}</span>
                      </div>
                      <div class="detail-content">
                        <div class="content-text">${record.content.replace(/\n/g, '<br>')}</div>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button class="action-btn" onclick="this.closest('.modal-overlay').remove()">é—œé–‰</button>
                  </div>
                </div>
              `;
              
              document.body.appendChild(modal);
            } else {
              showToast('æ‰¾ä¸åˆ°è©²è¨˜éŒ„', 3000);
            }
          } else {
            throw new Error('è¼‰å…¥å¤±æ•—');
          }
        } catch (error) {
          console.error('View positioning detail error:', error);
          showToast('è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // åˆªé™¤å¸³è™Ÿå®šä½è¨˜éŒ„ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      async function deletePositioningRecordForUserDB(recordId) {
        if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†å¸³è™Ÿå®šä½è¨˜éŒ„å—ï¼Ÿ')) return;
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${ipPlanningUser.user_id}/${recordId}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            showToast('è¨˜éŒ„å·²åˆªé™¤', 2000);
            // é‡æ–°è¼‰å…¥åˆ—è¡¨
            await loadPositioningRecordsForUserDB();
          } else {
            throw new Error('åˆªé™¤å¤±æ•—');
          }
        } catch (error) {
          console.error('Delete positioning record error:', error);
          showToast('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // è¼‰å…¥å€‹äººè³‡æ–™åº«çš„é¸é¡Œè¨˜éŒ„
      async function loadTopicHistoryForUserDB() {
        const content = document.querySelector('#db-topicRecords .section-content');
        
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥ä»¥æŸ¥çœ‹é¸é¡Œè¨˜éŒ„</div>';
          return;
        }
        
        content.innerHTML = '<div class="loading-text">æ­£åœ¨è¼‰å…¥é¸é¡Œè¨˜éŒ„...</div>';
        
        try {
          // å¾å¾Œç«¯ç²å–å°è©±è¨˜éŒ„
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/conversations/${ipPlanningUser.user_id}`, {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            // éæ¿¾å‡ºé¸é¡Œè¨è«–é¡å‹çš„å°è©±
            const topicRecords = data.conversations || [];
            displayTopicRecordsForUserDB(topicRecords);
          } else if (response.status === 401) {
            content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          } else {
            content.innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
          }
        } catch (error) {
          console.error('è¼‰å…¥é¸é¡Œè¨˜éŒ„éŒ¯èª¤:', error);
          content.innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
        }
      }
      
      // é¡¯ç¤ºé¸é¡Œè¨˜éŒ„ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      function displayTopicRecordsForUserDB(records) {
        const container = document.querySelector('#db-topicRecords .section-content');
        
        if (records.length === 0) {
          container.innerHTML = '<div class="loading-text">å°šç„¡é¸é¡Œè¨˜éŒ„</div>';
          return;
        }
        
        container.innerHTML = records.map((record, index) => {
          const date = formatTaiwanTime(record.created_at);
          return `
            <div class="topic-item">
              <div class="topic-header">
                <span class="topic-number">è¨˜éŒ„ ${index + 1}</span>
                <span class="topic-date">${date}</span>
              </div>
              <div class="topic-content">${record.summary || 'ç„¡æ‘˜è¦'}</div>
              <div class="topic-meta">
                <span class="topic-mode">${record.mode || 'é¸é¡Œè¨è«–'}</span>
                <span class="topic-count">${record.message_count || 0} æ¢æ¶ˆæ¯</span>
              </div>
            </div>
          `;
        }).join('');
      }
      
      // è¼‰å…¥ä½¿ç”¨çµ±è¨ˆ
      async function loadUsageStatsForUserDB() {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          return;
        }
        
        try {
          // ç²å–è…³æœ¬æ•¸
          const scripts = getLocalScripts();
          document.getElementById('totalScripts').textContent = scripts.length;
          
          // ç²å–å¸³è™Ÿå®šä½æ•¸
          const positioningResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${ipPlanningUser.user_id}`, {
            headers: {'Authorization': `Bearer ${ipPlanningToken}`}
          });
          if (positioningResponse.ok) {
            const positioningData = await positioningResponse.json();
            document.getElementById('totalPositioning').textContent = positioningData.records?.length || 0;
          }
          
          // ç²å–å°è©±æ•¸
          const convResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/conversations/${ipPlanningUser.user_id}`, {
            headers: {'Authorization': `Bearer ${ipPlanningToken}`}
          });
          if (convResponse.ok) {
            const convData = await convResponse.json();
            const topicRecords = convData.conversations?.filter(c => c.mode?.includes('é¸é¡Œ') || c.conversation_type === 'topic_selection') || [];
            document.getElementById('totalTopics').textContent = topicRecords.length;
            document.getElementById('totalConversations').textContent = convData.conversations?.length || 0;
          }
        } catch (error) {
          console.error('è¼‰å…¥çµ±è¨ˆå¤±æ•—:', error);
        }
      }
      
      // åŒ¯å‡ºç”¨æˆ¶è³‡æ–™
      function exportUserData() {
        const data = {
          user_info: ipPlanningUser,
          scripts: getLocalScripts(),
          timestamp: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `aijob_user_data_${Date.now()}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        showToast('è³‡æ–™å·²åŒ¯å‡º', 3000);
      }
      
      // æ¸…é™¤æœ¬åœ°å¿«å–
      function clearUserData() {
        if (!confirm('ç¢ºå®šè¦æ¸…é™¤æœ¬åœ°å¿«å–å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
          return;
        }
        
        // æ¸…é™¤æœ¬åœ°å­˜å„²ï¼ˆä¿ç•™ç™»å…¥ä¿¡æ¯ï¼‰
        const token = localStorage.getItem('ipPlanningToken');
        const user = localStorage.getItem('ipPlanningUser');
        
        localStorage.clear();
        
        // æ¢å¾©ç™»å…¥ä¿¡æ¯
        if (token) localStorage.setItem('ipPlanningToken', token);
        if (user) localStorage.setItem('ipPlanningUser', user);
        
        showToast('æœ¬åœ°å¿«å–å·²æ¸…é™¤', 3000);
        
        // é‡æ–°è¼‰å…¥é é¢
        setTimeout(() => {
          location.reload();
        }, 1000);
      }
      
      // çµæœå€å¡ŠåŠŸèƒ½
      function updateResultBlock(blockId, content, hasContent = true) {
        const block = document.getElementById(blockId);
        if (block) {
          block.textContent = content;
          if (hasContent) {
            block.classList.add('has-content');
          } else {
            block.classList.remove('has-content');
          }
        }
      }
      
      // æ¨™ç±¤åˆ‡æ›åŠŸèƒ½
      function switchTab(tabName) {
        // ç§»é™¤æ‰€æœ‰æ¨™ç±¤çš„ active é¡åˆ¥
        document.querySelectorAll('.result-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        
        // éš±è—æ‰€æœ‰çµæœå…§å®¹
        document.querySelectorAll('.result-content').forEach(content => {
          content.style.display = 'none';
        });
        
        // æ¿€æ´»é¸ä¸­çš„æ¨™ç±¤
        const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
        if (activeTab) {
          activeTab.classList.add('active');
        }
        
        // é¡¯ç¤ºå°æ‡‰çš„çµæœå…§å®¹
        let contentId = '';
        if (tabName === 'positioning') {
          contentId = 'positioningResult';
        } else if (tabName === 'topics') {
          contentId = 'topicSelectionResult';
        } else if (tabName === 'script') {
          contentId = 'scriptResult';
        }
        
        const activeContent = document.getElementById(contentId);
        if (activeContent) {
          activeContent.style.display = 'block';
        }
      }
      
      // æ·»åŠ èŠå¤©è¨Šæ¯ï¼ˆå¥—ç”¨IPæ¨¡å¼è¨­è¨ˆï¼‰
      function addMessage(content, isUser = false) {
        const chatMessages = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
        
        // æ·»åŠ é ­åƒ
        const avatar = document.createElement('div');
        avatar.className = 'message-avatar';
        
        if (isUser) {
          // ç”¨æˆ¶é ­åƒï¼šä½¿ç”¨ Gmail é ­åƒæˆ–é»˜èªé ­åƒ
          const userAvatarImg = document.getElementById('userAvatar');
          if (userAvatarImg && userAvatarImg.src && userAvatarImg.src !== '') {
            const img = document.createElement('img');
            img.src = userAvatarImg.src;
            img.alt = 'ç”¨æˆ¶é ­åƒ';
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.borderRadius = '50%';
            img.style.objectFit = 'cover';
            avatar.appendChild(img);
          } else {
            avatar.textContent = 'ğŸ‘¤';
          }
        } else {
          // AI é ­åƒï¼šä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿ
          avatar.textContent = 'ğŸ¤–';
        }
        
        messageDiv.appendChild(avatar);
        
        // æ·»åŠ è¨Šæ¯å…§å®¹
        const messageContent = document.createElement('div');
        messageContent.className = 'message-content';
        
        // å¦‚æœæ˜¯ AI å›è¦†ï¼Œæ¸…ç† Markdown æ ¼å¼
        if (!isUser) {
          const cleanText = cleanMarkdownFormat(content);
          messageContent.innerHTML = cleanText;
        } else {
          messageContent.textContent = content;
        }
        
        messageDiv.appendChild(messageContent);
        chatMessages.appendChild(messageDiv);
        
        // ç¢ºä¿æ»¾å‹•åˆ°åº•éƒ¨ï¼Œè€ƒæ…®åˆ°åº•éƒ¨å›ºå®šå…ƒç´ çš„é«˜åº¦
        setTimeout(() => {
        chatMessages.scrollTop = chatMessages.scrollHeight;
          // å†æ¬¡æ»¾å‹•ç¢ºä¿åˆ°é”æ­£ç¢ºä½ç½®
          setTimeout(() => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 50);
        }, 10);
        
        // é€šç”¨æ»¾å‹•è™•ç†ï¼šç¢ºä¿æ»¾å‹•åˆ°å®Œå…¨å¯è¦‹çš„ä½ç½®ï¼ˆé›»è…¦ç‰ˆå’Œæ‰‹æ©Ÿç‰ˆéƒ½é©ç”¨ï¼‰
        setTimeout(() => {
          // ç›´æ¥æ»¾å‹•åˆ°åº•éƒ¨ï¼Œè®“CSSçš„padding-bottomè™•ç†åº•éƒ¨ç©ºé–“
          chatMessages.scrollTop = chatMessages.scrollHeight;
          
          // å†æ¬¡ç¢ºä¿æ»¾å‹•åˆ°æ­£ç¢ºä½ç½®
          setTimeout(() => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 50);
          
          // æœ€çµ‚ç¢ºä¿æ»¾å‹•åˆ°åº•éƒ¨
          setTimeout(() => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 150);
        }, 100);
      }
      
      // ç™¼é€èŠå¤©è¨Šæ¯
      async function sendMessage() {
        const message = messageInput.value.trim();
        if (!message) return;
        
        // æ·»åŠ ç”¨æˆ¶è¨Šæ¯
        addMessage(message, true);
        messageInput.value = '';
        
        // é¡¯ç¤º AI å›è¦†ä¸­çš„è¼‰å…¥ç‹€æ…‹
        const thinkingDiv = document.createElement('div');
        thinkingDiv.className = 'message ai';
        thinkingDiv.id = 'thinking-message';
        
        // æ·»åŠ  AI é ­åƒ
        const avatar = document.createElement('div');
        avatar.className = 'message-avatar';
        avatar.textContent = 'ğŸ¤–';
        thinkingDiv.appendChild(avatar);
        
        // æ·»åŠ è¼‰å…¥å‹•ç•«å…§å®¹
        const messageContent = document.createElement('div');
        messageContent.className = 'message-content';
        
        const loadingDiv = document.createElement('div');
        loadingDiv.className = 'ai-loading';
        loadingDiv.innerHTML = `
          <span>AIæ­£åœ¨æ€è€ƒä¸­</span>
          <div class="ai-loading-dots">
            <div class="ai-loading-dot"></div>
            <div class="ai-loading-dot"></div>
            <div class="ai-loading-dot"></div>
          </div>
        `;
        messageContent.appendChild(loadingDiv);
        thinkingDiv.appendChild(messageContent);
        
        document.getElementById('chatMessages').appendChild(thinkingDiv);
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/chat/stream', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: message,
              platform: platformSelect.value || null,
              topic: topicInput.value || null,
              duration: durationInput.value || '30',
              style: styleInstruction,
              profile: positioningInput.value || null,
              history: [],
              user_id: ipPlanningUser?.user_id || null
            })
          });
          
          if (!response.ok) {
            throw new Error('ç™¼é€å¤±æ•—');
          }
          
          // æº–å‚™æ¥æ”¶ AI å›æ‡‰
          const reader = response.body.getReader();
          let aiResponse = '';
          let aiDiv = null;
          let bubble = null;
          
          let buffer = '';
          
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += new TextDecoder().decode(value, { stream: true });
            
            // è™•ç†å®Œæ•´çš„ JSON è¡Œ
            let idx;
            while ((idx = buffer.indexOf('\n\n')) !== -1) {
              const frame = buffer.slice(0, idx).trim();
              buffer = buffer.slice(idx + 2);
              
              if (!frame.startsWith('data:')) continue;
              
              try {
                const jsonStr = frame.slice(5).trim();
                const data = JSON.parse(jsonStr);
                
                if (data.type === 'token' && data.content) {
                  // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ”¶åˆ° tokenï¼Œå‰µå»º AI å›æ‡‰ div ä¸¦ç§»é™¤è¼‰å…¥å‹•ç•«
                  if (!aiDiv) {
                    const thinkingMsg = document.getElementById('thinking-message');
                    if (thinkingMsg) {
                      thinkingMsg.remove();
                    }
                    
                    // å‰µå»º AI å›æ‡‰ div
                    aiDiv = document.createElement('div');
                    aiDiv.className = 'msg assistant';
                    aiDiv.id = 'ai-response';
                    
                    // æ·»åŠ  AI é ­åƒ
                    const aiAvatar = document.createElement('div');
                    aiAvatar.className = 'msg-avatar';
                    aiAvatar.textContent = 'ğŸ¤–';
                    aiDiv.appendChild(aiAvatar);
                    
                    // æ·»åŠ æ°£æ³¡
                    bubble = document.createElement('div');
                    bubble.className = 'msg-bubble';
                    aiDiv.appendChild(bubble);
                    
                    document.getElementById('chatMessages').appendChild(aiDiv);
                  }
                  
                  aiResponse += data.content;
                  bubble.innerHTML = cleanMarkdownFormat(aiResponse);
                } else if (data.type === 'end') {
                  // å›æ‡‰çµæŸ
                  // æ–°å¢ï¼šæ™ºèƒ½åˆ¤æ–· AI å›æ‡‰é¡å‹ä¸¦é¡¯ç¤ºåˆ°çµæœå€å¡Š
                  if (aiResponse && ipPlanningUser?.user_id) {
                    detectAndDisplayResult(message, aiResponse);
                  }
                  break;
                }
              } catch (e) {
                // å¿½ç•¥è§£æéŒ¯èª¤
                continue;
              }
            }
            
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
          }
        } catch (error) {
          // ç§»é™¤è¼‰å…¥å‹•ç•«ï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
          const thinkingMsg = document.getElementById('thinking-message');
          if (thinkingMsg) {
            thinkingMsg.remove();
          }
          
          addMessage('æŠ±æ­‰ï¼Œç™¼é€å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', false);
        }
      }
      
      // ç”Ÿæˆè…³æœ¬åŠŸèƒ½
      async function generateScript() {
        // å‹•æ…‹æŸ¥æ‰¾è¼¸å…¥å…ƒç´ ï¼Œå„ªå…ˆä½¿ç”¨æ‰‹æ©Ÿç‰ˆ
        const platformEl = document.querySelector('#mode1-mobile-setup #platformSelect') || document.getElementById('platformSelect');
        const topicEl = document.querySelector('#mode1-mobile-setup #topicInput') || document.getElementById('topicInput');
        const positioningEl = document.querySelector('#mode1-mobile-setup #positioningInput') || document.getElementById('positioningInput');
        
        const platform = platformEl ? platformEl.value : '';
        const topic = topicEl ? topicEl.value : '';
        const positioning = positioningEl ? positioningEl.value : '';
        
        // æª¢æŸ¥æ˜¯å¦å·²å®Œæˆå¸³è™Ÿå®šä½å’Œé¸é¡Œï¼ˆåªæª¢æŸ¥æ˜¯å¦ç‚ºé è¨­æç¤ºæ–‡å­—ï¼‰
        const positioningContent = document.getElementById('positioningContent').textContent.trim();
        const topicContent = document.getElementById('topicContent').textContent.trim();
        
        const isPositioningDefault = positioningContent.includes('é»æ“Šã€Œä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½ã€') || 
                                     positioningContent.includes('é–‹å§‹åˆ†æ');
        const isTopicDefault = topicContent.includes('å®Œæˆå¸³è™Ÿå®šä½') || 
                              topicContent.includes('é€²è¡Œé¸é¡Œ') ||
                              topicContent.includes('é»æ“Šã€Œä¸€éµç”Ÿæˆé¸é¡Œã€');
        
        if (!positioningContent || isPositioningDefault) {
          showToast('è«‹å…ˆå®Œæˆå¸³è™Ÿå®šä½', 3000);
          return;
        }
        
        if (!topicContent || isTopicDefault) {
          showToast('è«‹å…ˆå®Œæˆé¸é¡Œæ¨è–¦', 3000);
          return;
        }
        
        if (!platform) {
          showToast('è«‹å…ˆé¸æ“‡å¹³å°', 3000);
          return;
        }
        
        updateResultBlock('scriptContent', 'æ­£åœ¨ç”Ÿæˆè…³æœ¬...', false);
        
        // ç«‹å³é¡¯ç¤ºæ“ä½œæŒ‰éˆ•
        document.getElementById('scriptActions').style.display = 'flex';
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/generate/script', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: 'è«‹å¹«æˆ‘ç”Ÿæˆå®Œæ•´è…³æœ¬',
              platform: platform,
              topic: topic,
              duration: durationInput.value || '30',
              style: styleInstruction,
              profile: positioning,
              history: [],
              user_id: ipPlanningUser?.user_id || null
            })
          });
          
          if (!response.ok) {
            throw new Error('ç”Ÿæˆå¤±æ•—');
          }
          
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          let buffer = '';
          let result = '';
          
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += decoder.decode(value, { stream: true });
            const lines = buffer.split('\n');
            buffer = lines.pop() || '';
            
            for (const line of lines) {
              if (line.startsWith('data: ')) {
                try {
                  const data = JSON.parse(line.slice(6));
                  if (data.type === 'token' && data.content) {
                    result += data.content;
                    updateResultBlock('scriptContent', result, true);
                  } else if (data.type === 'end') {
                    break;
                  } else if (data.type === 'error') {
                    throw new Error(data.message || 'ç”Ÿæˆå¤±æ•—');
                  }
                } catch (e) {
                  console.error('è§£æéŒ¯èª¤:', e);
                }
              }
            }
          }
          
          // è‡ªå‹•åˆ‡æ›åˆ°è…³æœ¬æ¨™ç±¤
          switchTab('script');
          
        } catch (error) {
          updateResultBlock('scriptContent', 'ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', false);
          showToast('ç”Ÿæˆè…³æœ¬å¤±æ•—', 3000);
        }
      }
      // ä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½
      async function generatePositioning() {
        // å‹•æ…‹æŸ¥æ‰¾è¼¸å…¥å…ƒç´ ï¼Œå„ªå…ˆä½¿ç”¨æ‰‹æ©Ÿç‰ˆ
        const platformEl = document.querySelector('#mode1-mobile-setup #platformSelect') || document.getElementById('platformSelect');
        const topicEl = document.querySelector('#mode1-mobile-setup #topicInput') || document.getElementById('topicInput');
        const positioningEl = document.querySelector('#mode1-mobile-setup #positioningInput') || document.getElementById('positioningInput');
        
        const platform = platformEl ? platformEl.value : '';
        const topic = topicEl ? topicEl.value : '';
        const positioning = positioningEl ? positioningEl.value : '';
        
        if (!platform) {
          showToast('è«‹å…ˆé¸æ“‡å¹³å°', 3000);
          return;
        }
        
        updateResultBlock('positioningContent', 'æ­£åœ¨åˆ†æå¸³è™Ÿå®šä½...', false);
        
        // ç«‹å³é¡¯ç¤ºæ“ä½œæŒ‰éˆ•
        document.getElementById('positioningActions').style.display = 'flex';
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/generate/positioning', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: 'è«‹å¹«æˆ‘é€²è¡Œå¸³è™Ÿå®šä½åˆ†æ',
              platform: platform,
              topic: topic,
              duration: '30',
              style: styleInstruction,
              profile: positioning,
              history: [],
              user_id: ipPlanningUser?.user_id || null
            })
          });
          
          if (!response.ok) {
            throw new Error('ç”Ÿæˆå¤±æ•—');
          }
          
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          let buffer = '';
          let result = '';
          
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += decoder.decode(value, { stream: true });
            const lines = buffer.split('\n');
            buffer = lines.pop() || '';
            
            for (const line of lines) {
              if (line.startsWith('data: ')) {
                try {
                  const data = JSON.parse(line.slice(6));
                  if (data.type === 'token' && data.content) {
                    result += data.content;
                    updateResultBlock('positioningContent', result, true);
                  } else if (data.type === 'end') {
                    break;
                  } else if (data.type === 'error') {
                    throw new Error(data.message || 'ç”Ÿæˆå¤±æ•—');
                  }
                } catch (e) {
                  console.error('è§£æéŒ¯èª¤:', e);
                }
              }
            }
          }
          
          // è‡ªå‹•åˆ‡æ›åˆ°å¸³è™Ÿå®šä½æ¨™ç±¤
          switchTab('positioning');
          
          // è‡ªå‹•ä¿å­˜å¸³è™Ÿå®šä½åˆ°å¾Œç«¯
          if (result && ipPlanningToken && ipPlanningUser) {
            try {
              const saveResponse = await fetch('https://aivideobackend.zeabur.app/api/user/positioning/save', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${ipPlanningToken}`
                },
                body: JSON.stringify({
                  user_id: ipPlanningUser.user_id,
                  content: result
                })
              });
              
              if (saveResponse.ok) {
                const saveData = await saveResponse.json();
                showToast(`å¸³è™Ÿå®šä½å·²è‡ªå‹•å„²å­˜ï¼ˆç·¨è™Ÿï¼š${saveData.record_number}ï¼‰`, 2000);
              }
            } catch (saveError) {
              console.error('è‡ªå‹•å„²å­˜å¤±æ•—:', saveError);
            }
          }
          
        } catch (error) {
          updateResultBlock('positioningContent', 'ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', false);
          showToast('ç”Ÿæˆå¸³è™Ÿå®šä½å¤±æ•—', 3000);
        }
      }
      
      // æ™ºèƒ½åˆ¤æ–· AI å›æ‡‰é¡å‹ä¸¦é¡¯ç¤ºåˆ°çµæœå€å¡Š
      function detectAndDisplayResult(userMessage, aiResponse) {
        // åˆ¤æ–·æ˜¯å¦ç‚ºæ˜ç¢ºçš„å¸³è™Ÿå®šä½ç¸½çµ
        const isPositioningSummary = aiResponse.includes('ğŸ“Œ ä½ çš„å¸³è™Ÿå®šä½å»ºè­°') ||
                                     aiResponse.includes('å¸³è™Ÿå®šä½å»ºè­°ï¼š') ||
                                     aiResponse.includes('å®šä½ç¸½çµï¼š') ||
                                     (aiResponse.includes('å®šä½å»ºè­°') && aiResponse.length > 200);
        
        // åˆ¤æ–·æ˜¯å¦ç‚ºæ˜ç¢ºçš„é¸é¡Œæ¨è–¦çµæœ
        const isTopicsSummary = aiResponse.includes('ğŸ“Œ é¸é¡Œæ¨è–¦') ||
                               aiResponse.includes('é¸é¡Œå»ºè­°ï¼š') ||
                               aiResponse.includes('æ¨è–¦é¸é¡Œï¼š') ||
                               (aiResponse.includes('é¸é¡Œ') && 
                                (aiResponse.includes('1.') || aiResponse.includes('ä¸€ã€')) &&
                                aiResponse.length > 200);
        
        // åˆ¤æ–·æ˜¯å¦ç‚ºå®Œæ•´è…³æœ¬ï¼ˆå¿…é ˆåŒ…å«çµæ§‹åŒ–å…§å®¹ï¼‰
        const isCompletScript = (aiResponse.includes('Hook') || aiResponse.includes('é–‹å ´')) && 
                               (aiResponse.includes('Value') || aiResponse.includes('æ ¸å¿ƒ')) && 
                               (aiResponse.includes('CTA') || aiResponse.includes('è¡Œå‹•å‘¼ç±²')) &&
                               aiResponse.length > 300;
        
        // æ ¹æ“šåˆ¤æ–·çµæœé¡¯ç¤ºåˆ°å°æ‡‰å€å¡Šï¼ˆåªé¡¯ç¤ºæ˜ç¢ºçš„ç¸½çµ/çµæœï¼‰
        if (isCompletScript) {
          // å®Œæ•´è…³æœ¬ï¼šé¡¯ç¤ºåˆ°è…³æœ¬å€å¡Š
          updateResultBlock('scriptContent', aiResponse, true);
          document.getElementById('scriptActions').style.display = 'flex';
          switchTab('script');
        } else if (isTopicsSummary) {
          // é¸é¡Œæ¨è–¦ï¼šé¡¯ç¤ºåˆ°é¸é¡Œå€å¡Š
          updateResultBlock('topicContent', aiResponse, true);
          document.getElementById('topicActions').style.display = 'flex';
          switchTab('topics');
        } else if (isPositioningSummary) {
          // å¸³è™Ÿå®šä½ç¸½çµï¼šé¡¯ç¤ºåˆ°å®šä½å€å¡Š
          updateResultBlock('positioningContent', aiResponse, true);
          document.getElementById('positioningActions').style.display = 'flex';
          switchTab('positioning');
        }
        // å¦‚æœéƒ½ä¸ç¬¦åˆï¼ˆä¸€èˆ¬è¨è«–ã€å•ç­”ï¼‰ï¼Œå°±ä¸é¡¯ç¤ºåˆ°çµæœå€ï¼ˆä¿ç•™åœ¨å°è©±æ¡†ä¸­ï¼‰
      }
      
      // ä¸€éµç”Ÿæˆé¸é¡Œ
      async function generateTopics() {
        // å‹•æ…‹æŸ¥æ‰¾è¼¸å…¥å…ƒç´ ï¼Œå„ªå…ˆä½¿ç”¨æ‰‹æ©Ÿç‰ˆ
        const platformEl = document.querySelector('#mode1-mobile-setup #platformSelect') || document.getElementById('platformSelect');
        const topicEl = document.querySelector('#mode1-mobile-setup #topicInput') || document.getElementById('topicInput');
        const positioningEl = document.querySelector('#mode1-mobile-setup #positioningInput') || document.getElementById('positioningInput');
        
        const platform = platformEl ? platformEl.value : '';
        const topic = topicEl ? topicEl.value : '';
        const positioning = positioningEl ? positioningEl.value : '';
        
        // æª¢æŸ¥æ˜¯å¦å·²å®Œæˆå¸³è™Ÿå®šä½ï¼ˆåªæª¢æŸ¥æ˜¯å¦ç‚ºé è¨­æç¤ºæ–‡å­—ï¼‰
        const positioningContent = document.getElementById('positioningContent').textContent.trim();
        const isDefaultText = positioningContent.includes('é»æ“Šã€Œä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½ã€') || 
                             positioningContent.includes('é–‹å§‹åˆ†æ');
        
        if (!positioningContent || isDefaultText) {
          showToast('è«‹å…ˆå®Œæˆå¸³è™Ÿå®šä½', 3000);
          return;
        }
        
        if (!platform) {
          showToast('è«‹å…ˆé¸æ“‡å¹³å°', 3000);
          return;
        }
        
        updateResultBlock('topicContent', 'æ­£åœ¨æ¨è–¦é¸é¡Œ...', false);
        
        // ç«‹å³é¡¯ç¤ºæ“ä½œæŒ‰éˆ•
        document.getElementById('topicActions').style.display = 'flex';
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/generate/topics', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: 'è«‹å¹«æˆ‘æ¨è–¦é¸é¡Œ',
              platform: platform,
              topic: topic,
              duration: '30',
              style: styleInstruction,
              profile: positioning,
              history: [],
              user_id: ipPlanningUser?.user_id || null
            })
          });
          
          if (!response.ok) {
            throw new Error('ç”Ÿæˆå¤±æ•—');
          }
          
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          let buffer = '';
          let result = '';
          
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += decoder.decode(value, { stream: true });
            const lines = buffer.split('\n');
            buffer = lines.pop() || '';
            
            for (const line of lines) {
              if (line.startsWith('data: ')) {
                try {
                  const data = JSON.parse(line.slice(6));
                  if (data.type === 'token' && data.content) {
                    result += data.content;
                    updateResultBlock('topicContent', result, true);
                  } else if (data.type === 'end') {
                    break;
                  } else if (data.type === 'error') {
                    throw new Error(data.message || 'ç”Ÿæˆå¤±æ•—');
                  }
                } catch (e) {
                  console.error('è§£æéŒ¯èª¤:', e);
                }
              }
            }
          }
          
          // è‡ªå‹•åˆ‡æ›åˆ°é¸é¡Œæ¨™ç±¤
          switchTab('topics');
          
        } catch (error) {
          updateResultBlock('topicContent', 'ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', false);
          showToast('ç”Ÿæˆé¸é¡Œå¤±æ•—', 3000);
        }
      }
      
      // å„²å­˜çµæœ
      async function saveResult(type) {
        if (!ipPlanningUser || !ipPlanningUser.user_id) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        let content = '';
        let contentElement = null;
        
        switch(type) {
          case 'positioning':
            contentElement = document.getElementById('positioningContent');
            break;
          case 'topics':
            contentElement = document.getElementById('topicContent');
            break;
          case 'script':
            contentElement = document.getElementById('scriptContent');
            break;
        }
        
        if (contentElement) {
          content = contentElement.textContent;
          
          // åªæœ‰å¸³è™Ÿå®šä½éœ€è¦ä¿å­˜åˆ°è³‡æ–™åº«
          if (type === 'positioning') {
            try {
              const response = await fetch('https://aivideobackend.zeabur.app/api/user/positioning/save', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${ipPlanningToken}`
                },
                body: JSON.stringify({
                  user_id: ipPlanningUser.user_id,
                  content: content
                })
              });
              
              if (response.ok) {
                const data = await response.json();
                showToast(`å¸³è™Ÿå®šä½å·²å„²å­˜ï¼ˆç·¨è™Ÿï¼š${data.record_number}ï¼‰`, 3000);
                // é‡æ–°è¼‰å…¥å¸³è™Ÿå®šä½åˆ—è¡¨
                await loadPositioningRecords();
              } else {
                throw new Error('å„²å­˜å¤±æ•—');
              }
            } catch (error) {
              console.error('å„²å­˜éŒ¯èª¤:', error);
              showToast('å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
            }
          } else {
            // å…¶ä»–é¡å‹æš«æ™‚å„²å­˜åˆ° localStorage
            localStorage.setItem(`saved_${type}`, content);
            showToast(`${type === 'topics' ? 'é¸é¡Œ' : 'è…³æœ¬'}å·²å„²å­˜`, 2000);
          }
        }
      }
      
      // è…³æœ¬å„²å­˜åŠŸèƒ½
      async function saveScript() {
        if (!ipPlanningUser || !ipPlanningUser.user_id || !ipPlanningToken) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        const content = document.getElementById('scriptContent').textContent;
        if (!content || content.includes('è«‹å…ˆå®Œæˆ')) {
          showToast('æ²’æœ‰å¯å„²å­˜çš„å…§å®¹', 3000);
          return;
        }
        
        console.log('é–‹å§‹å„²å­˜è…³æœ¬...', {
          userId: ipPlanningUser.user_id,
          contentLength: content.length
        });
        
        try {
          // æå–è…³æœ¬å…§å®¹çš„çµæ§‹åŒ–æ•¸æ“š
          const scriptData = extractScriptData(content);
          console.log('æå–çš„è…³æœ¬æ•¸æ“š:', scriptData);
          
          const response = await fetch('https://aivideobackend.zeabur.app/api/scripts/save', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              user_id: ipPlanningUser.user_id,
              content: content,
              script_data: scriptData,
              platform: currentPlatform || 'æœªè¨­å®š',
              topic: currentTopic || 'æœªè¨­å®š',
              profile: currentProfile || 'æœªè¨­å®š'
            })
          });
          
          console.log('è…³æœ¬å„²å­˜éŸ¿æ‡‰ç‹€æ…‹:', response.status);
          
          if (response.ok) {
            const result = await response.json();
            console.log('è…³æœ¬å„²å­˜æˆåŠŸ:', result);
            
            // åŒæ™‚å„²å­˜åˆ°æœ¬åœ°
            const localScriptData = {
              name: scriptData.title || 'æœªå‘½åè…³æœ¬',
              title: scriptData.title || '',
              content: content,
              script_data: scriptData,
              platform: currentPlatform || 'æœªè¨­å®š',
              topic: currentTopic || 'æœªè¨­å®š',
              profile: currentProfile || 'æœªè¨­å®š'
            };
            saveScriptToLocal(localScriptData);
            
            showToast('è…³æœ¬å„²å­˜æˆåŠŸï¼', 3000);
            // å»¶é²ä¸€ä¸‹å†è¼‰å…¥è…³æœ¬åˆ—è¡¨ï¼Œç¢ºä¿å¾Œç«¯è™•ç†å®Œæˆ
            setTimeout(() => {
              loadMyScripts();
              loadMyScriptsForUserDB(); // åŒæ™‚è¼‰å…¥è³‡æ–™åº«é é¢çš„è…³æœ¬
            }, 1000);
          } else if (response.status === 401) {
            console.log('è…³æœ¬å„²å­˜å¤±æ•—: èªè­‰éŒ¯èª¤');
            showToast('è«‹å…ˆç™»å…¥', 3000);
          } else if (response.status === 404) {
            console.log('è…³æœ¬å„²å­˜å¤±æ•—: APIä¸å­˜åœ¨ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜');
            // å¾Œç«¯APIä¸å­˜åœ¨æ™‚ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜
            const localScriptData = {
              name: scriptData.title || 'æœªå‘½åè…³æœ¬',
              title: scriptData.title || '',
              content: content,
              script_data: scriptData,
              platform: currentPlatform || 'æœªè¨­å®š',
              topic: currentTopic || 'æœªè¨­å®š',
              profile: currentProfile || 'æœªè¨­å®š'
            };
            saveScriptToLocal(localScriptData);
            showToast('è…³æœ¬å·²å„²å­˜åˆ°æœ¬åœ°ï¼', 3000);
            setTimeout(() => {
              loadMyScripts();
              loadMyScriptsForUserDB(); // åŒæ™‚è¼‰å…¥è³‡æ–™åº«é é¢çš„è…³æœ¬
            }, 500);
          } else {
            const errorData = await response.json();
            console.log('è…³æœ¬å„²å­˜å¤±æ•—:', errorData);
            throw new Error(errorData.error || 'å„²å­˜å¤±æ•—');
          }
        } catch (error) {
          console.error('Save script error:', error);
          // ç¶²è·¯éŒ¯èª¤æ™‚ï¼Œä¹Ÿä½¿ç”¨æœ¬åœ°å„²å­˜
          console.log('ç¶²è·¯éŒ¯èª¤ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜');
          const localScriptData = {
            name: scriptData.title || 'æœªå‘½åè…³æœ¬',
            title: scriptData.title || '',
            content: content,
            script_data: scriptData,
            platform: currentPlatform || 'æœªè¨­å®š',
            topic: currentTopic || 'æœªè¨­å®š',
            profile: currentProfile || 'æœªè¨­å®š'
          };
          saveScriptToLocal(localScriptData);
          showToast('è…³æœ¬å·²å„²å­˜åˆ°æœ¬åœ°ï¼', 3000);
          setTimeout(() => {
            loadMyScripts();
            loadMyScriptsForUserDB(); // åŒæ™‚è¼‰å…¥è³‡æ–™åº«é é¢çš„è…³æœ¬
          }, 500);
        }
      }
      
      // æå–è…³æœ¬æ•¸æ“š - æŒ‰ç…§è¦ç¯„æ ¼å¼è§£æ
      function extractScriptData(content) {
        console.log('é–‹å§‹è§£æè…³æœ¬å…§å®¹:', content);
        
        try {
          // æ¸…ç†å…§å®¹ï¼Œç§»é™¤HTMLæ¨™ç±¤
          const cleanContent = content.replace(/<[^>]*>/g, '').trim();
          console.log('æ¸…ç†å¾Œçš„å…§å®¹:', cleanContent);
          
          // æŒ‰ç…§è¦ç¯„è§£æè…³æœ¬
          const scriptData = parseScriptToJSON(cleanContent);
          console.log('è§£æçµæœ:', scriptData);
          return scriptData;
          
        } catch (error) {
          console.error('è…³æœ¬è§£æå¤±æ•—:', error);
          return {
            error: "PARSE_FAILED",
            message: "è…³æœ¬æ ¼å¼è§£æå¤±æ•—ï¼Œè«‹æª¢æŸ¥å…§å®¹æ ¼å¼"
          };
        }
      }
      
      // æŒ‰ç…§è¦ç¯„å°‡è…³æœ¬è§£æç‚ºJSONæ ¼å¼
      function parseScriptToJSON(content) {
        const lines = content.split('\n').map(line => line.trim()).filter(line => line);
        
        // 1. æå–ä¸»é¡Œæ¨™é¡Œ
        let title = '';
        for (let line of lines) {
          if (line.includes('ä¸»é¡Œ') || line.includes('æ¨™é¡Œ') || line.match(/^[1-9]\.?\s*[^0-9]/)) {
            title = line.replace(/^[1-9]\.?\s*/, '').replace(/[ï¼š:]\s*/, '').trim();
            break;
          }
        }
        
        // å¦‚æœæ²’æ‰¾åˆ°ä¸»é¡Œï¼Œä½¿ç”¨ç¬¬ä¸€è¡Œ
        if (!title && lines.length > 0) {
          title = lines[0].replace(/^[1-9]\.?\s*/, '').replace(/[ï¼š:]\s*/, '').trim();
        }
        
        // 2. è§£æè…³æœ¬åˆ†æ®µ
        const rows = [];
        let currentSegment = null;
        let valueCount = 0;
        
        for (let i = 0; i < lines.length; i++) {
          const line = lines[i];
          
          // æª¢æŸ¥æ™‚é–“æ¨¡å¼
          const timeMatch = line.match(/(\d+)-(\d+)s?/i);
          if (timeMatch) {
            // ä¿å­˜ä¸Šä¸€å€‹æ®µè½
            if (currentSegment) {
              rows.push(currentSegment);
            }
            
            // é–‹å§‹æ–°æ®µè½
            const startSec = parseInt(timeMatch[1]);
            const endSec = parseInt(timeMatch[2]);
            
            // ç¢ºå®šæ®µè½é¡å‹
            let section = '';
            if (line.toLowerCase().includes('hook')) {
              section = 'Hook';
            } else if (line.toLowerCase().includes('value') || line.toLowerCase().includes('åƒ¹å€¼')) {
              valueCount++;
              section = `Value ${valueCount}`;
            } else if (line.toLowerCase().includes('cta') || line.toLowerCase().includes('è¡Œå‹•å‘¼ç±²')) {
              section = 'CTA';
            } else {
              // æ ¹æ“šæ™‚é–“æ¨æ¸¬æ®µè½é¡å‹
              if (startSec === 0) {
                section = 'Hook';
              } else if (valueCount < 3) {
                valueCount++;
                section = `Value ${valueCount}`;
              } else {
                section = 'CTA';
              }
            }
            
            currentSegment = {
              start_sec: startSec,
              end_sec: endSec,
              section: section,
              shot_desc: '',
              dialogue: '',
              subtitle: '',
              sfx: ''
            };
            
            continue;
          }
          
          // è§£ææ®µè½å…§å®¹
          if (currentSegment) {
            // æª¢æŸ¥æ˜¯å¦ç‚ºå°è©
            if (line.includes('å°è©') || line.includes('å£ç™½') || line.match(/^ã€Œ.*ã€$/) || line.match(/^".*"$/)) {
              currentSegment.dialogue = line.replace(/^[å°è©å£ç™½ï¼š:]\s*/, '').replace(/^["ã€Œ]|["ã€]$/g, '').trim();
            }
            // æª¢æŸ¥æ˜¯å¦ç‚ºé¡é ­æè¿°
            else if (line.includes('é¡é ­') || line.includes('ç•«é¢') || line.includes('CU') || line.includes('MS') || line.includes('LS')) {
              currentSegment.shot_desc = line.replace(/^[é¡é ­ç•«é¢ï¼š:]\s*/, '').trim();
            }
            // æª¢æŸ¥æ˜¯å¦ç‚ºå­—å¹•
            else if (line.includes('å­—å¹•') || line.includes('å¤§å­—å¡')) {
              currentSegment.subtitle = line.replace(/^[å­—å¹•å¤§å­—å¡ï¼š:]\s*/, '').trim();
            }
            // æª¢æŸ¥æ˜¯å¦ç‚ºéŸ³æ•ˆ
            else if (line.includes('éŸ³æ•ˆ') || line.includes('è½‰å ´') || line.includes('éŸ³æ¨‚')) {
              currentSegment.sfx = line.replace(/^[éŸ³æ•ˆè½‰å ´éŸ³æ¨‚ï¼š:]\s*/, '').trim();
            }
            // å¦‚æœæ²’æœ‰æ¨™ç±¤ï¼Œæ ¹æ“šå…§å®¹æ¨æ¸¬
            else if (line.length > 0) {
              // å¦‚æœå°è©ç‚ºç©ºï¼Œå¯èƒ½æ˜¯å°è©
              if (!currentSegment.dialogue) {
                currentSegment.dialogue = line;
              }
              // å¦‚æœé¡é ­æè¿°ç‚ºç©ºï¼Œå¯èƒ½æ˜¯é¡é ­æè¿°
              else if (!currentSegment.shot_desc) {
                currentSegment.shot_desc = line;
              }
            }
          }
        }
        
        // ä¿å­˜æœ€å¾Œä¸€å€‹æ®µè½
        if (currentSegment) {
          rows.push(currentSegment);
        }
        
        // 3. æ’åºä¸¦ç¢ºä¿æ™‚é–“æ­£ç¢º
        rows.sort((a, b) => a.start_sec - b.start_sec);
        
        // 4. æ¸…ç†æ•¸æ“š
        rows.forEach(row => {
          // ç§»é™¤æœ«å°¾ç©ºç™½å’Œæ¨™é»ç¬¦è™Ÿï¼ˆä¿ç•™è¡¨æƒ…ç¬¦è™Ÿï¼‰
          row.dialogue = cleanText(row.dialogue);
          row.shot_desc = cleanText(row.shot_desc);
          row.subtitle = cleanText(row.subtitle);
          row.sfx = cleanText(row.sfx);
          
          // ç¢ºä¿end_sec > start_sec
          if (row.end_sec <= row.start_sec) {
            row.end_sec = row.start_sec + 1;
          }
        });
        
        // 5. æ§‹å»ºæœ€çµ‚JSON
        const result = {
          creator_id: ipPlanningUser ? ipPlanningUser.user_id : 'unknown',
          project_id: null,
          title: title,
          rows: rows
        };
        
        return result;
      }
      
      // æ¸…ç†æ–‡æœ¬æ•¸æ“š
      function cleanText(text) {
        if (!text) return '';
        
        // ç§»é™¤æœ«å°¾ç©ºç™½å’Œæ¨™é»ç¬¦è™Ÿï¼ˆä¿ç•™è¡¨æƒ…ç¬¦è™Ÿï¼‰
        return text.replace(/\s+$/, '').replace(/[ã€‚ï¼Œã€ï¼›ï¼šï¼ï¼Ÿ]$/, '');
      }
      
      // è¼‰å…¥æˆ‘çš„è…³æœ¬
      async function loadMyScripts() {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          document.getElementById('generationsList').innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          return;
        }
        
        console.log('æ­£åœ¨è¼‰å…¥è…³æœ¬åˆ—è¡¨...', {
          ipPlanningToken: ipPlanningToken ? 'present' : 'missing',
          userId: ipPlanningUser.user_id
        });
        
        // å…ˆæª¢æŸ¥æœ¬åœ°å„²å­˜çš„è…³æœ¬
        const localScripts = getLocalScripts();
        if (localScripts.length > 0) {
          console.log('è¼‰å…¥æœ¬åœ°è…³æœ¬:', localScripts);
          displayScripts(localScripts);
          return;
        }
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/scripts/my', {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            }
          });
          
          console.log('è…³æœ¬åˆ—è¡¨éŸ¿æ‡‰ç‹€æ…‹:', response.status);
          
          if (response.ok) {
            const data = await response.json();
            console.log('è…³æœ¬åˆ—è¡¨æ•¸æ“š:', data);
            displayScripts(data.scripts || []);
          } else if (response.status === 401) {
            console.log('è…³æœ¬è¼‰å…¥å¤±æ•—: èªè­‰éŒ¯èª¤');
            document.getElementById('generationsList').innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          } else if (response.status === 404) {
            console.log('è…³æœ¬è¼‰å…¥å¤±æ•—: APIä¸å­˜åœ¨');
            document.getElementById('generationsList').innerHTML = '<div class="loading-text">è…³æœ¬åŠŸèƒ½å³å°‡ä¸Šç·šï¼Œè«‹ç¨å¾Œå†è©¦</div>';
          } else {
            const errorData = await response.json();
            console.log('è…³æœ¬è¼‰å…¥å¤±æ•—:', errorData);
            throw new Error(errorData.error || 'è¼‰å…¥å¤±æ•—');
          }
        } catch (error) {
          console.error('Load scripts error:', error);
          document.getElementById('generationsList').innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
        }
      }
      
      // ç²å–æœ¬åœ°å„²å­˜çš„è…³æœ¬
      function getLocalScripts() {
        try {
          const scripts = localStorage.getItem('user_scripts');
          return scripts ? JSON.parse(scripts) : [];
        } catch (error) {
          console.error('Error loading local scripts:', error);
          return [];
        }
      }
      
      // å„²å­˜è…³æœ¬åˆ°æœ¬åœ°
      function saveScriptToLocal(scriptData) {
        try {
          const scripts = getLocalScripts();
          const newScript = {
            id: Date.now(),
            ...scriptData,
            created_at: new Date().toISOString()
          };
          scripts.unshift(newScript);
          localStorage.setItem('user_scripts', JSON.stringify(scripts));
          console.log('è…³æœ¬å·²å„²å­˜åˆ°æœ¬åœ°:', newScript);
        } catch (error) {
          console.error('Error saving script locally:', error);
        }
      }
      
      // è¼‰å…¥é¸é¡Œè¨˜éŒ„
      async function loadTopicHistory() {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          document.getElementById('generationsList').innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          return;
        }
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/generations', {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            displayTopicHistory(data.generations || []);
          } else if (response.status === 401) {
            document.getElementById('generationsList').innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'è¼‰å…¥å¤±æ•—');
          }
        } catch (error) {
          console.error('Load topic history error:', error);
          document.getElementById('generationsList').innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
        }
      }
      
      // é¡¯ç¤ºé¸é¡Œè¨˜éŒ„
      function displayTopicHistory(topics) {
        const container = document.getElementById('generationsList');
        
        if (topics.length === 0) {
          container.innerHTML = '<div class="loading-text">é‚„æ²’æœ‰é¸é¡Œè¨˜éŒ„</div>';
          return;
        }
        
        container.innerHTML = topics.map((topic, index) => `
          <div class="generation-item">
            <div class="generation-header">
              <span class="generation-number">è¨˜éŒ„ ${index + 1}</span>
              <span class="generation-date">${formatTaiwanTime(topic.created_at)}</span>
            </div>
            <div class="generation-content">${topic.content}</div>
          </div>
        `).join('');
      }
      
      // é¡¯ç¤ºè…³æœ¬åˆ—è¡¨
      function displayScripts(scripts) {
        const container = document.getElementById('generationsList');
        
        if (scripts.length === 0) {
          container.innerHTML = '<div class="loading-text">é‚„æ²’æœ‰å„²å­˜çš„è…³æœ¬</div>';
          return;
        }
        
        container.innerHTML = scripts.map((script, index) => `
          <div class="script-item" data-script-id="${script.id}">
            <div class="script-header" onclick="toggleScript(${script.id})">
              <div class="script-info">
                <span class="script-number">ç·¨è™Ÿ${String(index + 1).padStart(2, '0')}</span>
                <span class="script-name" onclick="editScriptName(${script.id}, event)">${script.name || script.title || 'æœªå‘½åè…³æœ¬'}</span>
                <span class="script-date">${formatTaiwanTime(script.created_at)}</span>
              </div>
              <div class="script-toggle">
                <span class="toggle-icon">â–¼</span>
              </div>
            </div>
            <div class="script-content" id="script-${script.id}" style="display: none;">
              <div class="script-details">
                <div class="script-table">
                  <table>
                    <thead>
                      <tr>
                        <th>æ™‚é–“</th>
                        <th>æ®µè½</th>
                        <th>é¡é ­/ç•«é¢</th>
                        <th>å°è© (æ¼”å“¡å£ç™½)</th>
                        <th>å­—å¹•æ–‡å­— (å¯å‹•ç•«)</th>
                        <th>éŸ³æ•ˆèˆ‡è½‰å ´</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${generateScriptTable(script.script_data)}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="script-actions" id="actions-${script.id}" style="display: none;">
              <button class="action-btn view-btn" onclick="viewFullScript(${script.id})">æŸ¥çœ‹å®Œæ•´çµæœ</button>
              <button class="action-btn download-pdf-btn" onclick="downloadScriptPDF(${script.id})">ä¸‹è¼‰PDFæª”æ¡ˆ</button>
              <button class="action-btn download-csv-btn" onclick="downloadScriptCSV(${script.id})">ä¸‹è¼‰CSVæª”æ¡ˆ</button>
              <button class="action-btn delete-btn" onclick="deleteScript(${script.id})">åˆªé™¤</button>
            </div>
          </div>
        `).join('');
      }
      // æ ¹æ“šå°è©å…§å®¹ç”Ÿæˆç•«é¢æè¿°
      function generateVisualDescription(dialogue) {
        if (!dialogue || dialogue.trim() === '') return '-';
        
        const content = dialogue.toLowerCase();
        
        // æ™‚é–“ç›¸é—œ
        if (content.includes('æ™‚é–“') || content.includes('â³') || content.includes('æ™‚é˜')) {
          return 'æ™‚é˜ç‰¹å¯«ï¼ŒæŒ‡é‡å¿«é€Ÿè½‰å‹•';
        }
        
        // å·¥ä½œ/åŠ ç­ç›¸é—œ
        if (content.includes('åŠ ç­') || content.includes('å·¥ä½œ') || content.includes('ç–²æ†Š')) {
          return 'ç–²æ†Šçš„ä¸Šç­æ—åœ¨è¾¦å…¬å®¤åŠ ç­';
        }
        
        // AI/ç§‘æŠ€ç›¸é—œ
        if (content.includes('ai') || content.includes('æ™ºèƒ½') || content.includes('âœ¨')) {
          return 'é«˜æ•ˆå·¥ä½œè€…ä½¿ç”¨AIå·¥å…·ï¼Œè¢å¹•ç™¼å…‰';
        }
        
        // é©šè¨/éœ‡é©šç›¸é—œ
        if (content.includes('ğŸ˜²') || content.includes('ä¸çŸ¥é“') || content.includes('out')) {
          return 'é©šè¨è¡¨æƒ…ç‰¹å¯«';
        }
        
        // æ±ºç­–/æ€è€ƒç›¸é—œ
        if (content.includes('æ±ºç­–') || content.includes('è°æ˜') || content.includes('ğŸ§ ')) {
          return 'å¤§è…¦åœ–æ¡ˆèˆ‡æ•¸æ“šåˆ†æåœ–è¡¨çµåˆ';
        }
        
        // æ©Ÿæœƒ/ç›®æ¨™ç›¸é—œ
        if (content.includes('æ©Ÿæœƒ') || content.includes('æŠ“ä½') || content.includes('ğŸ¯')) {
          return 'ç®­é ­å°„ä¸­é¶å¿ƒ';
        }
        
        // ç«¶çˆ­ç›¸é—œ
        if (content.includes('ç«¶çˆ­') || content.includes('è¶…è»Š') || content.includes('ğŸ”¥')) {
          return 'è³½è»Šè¶…è¶Šå°æ‰‹ï¼Œç«ç„°ç‰¹æ•ˆ';
        }
        
        // æœªä¾†/è¶¨å‹¢ç›¸é—œ
        if (content.includes('æœªä¾†') || content.includes('è¶¨å‹¢') || content.includes('å…¥å ´åˆ¸')) {
          return 'ä¸€å¼µé€šå¾€æœªä¾†ä¸–ç•Œçš„é–€ç¥¨';
        }
        
        // æˆåŠŸ/æˆå°±ç›¸é—œ
        if (content.includes('æˆåŠŸ') || content.includes('æŒæ¡') || content.includes('ğŸ†')) {
          return 'ä¸€äººè‡ªä¿¡åœ°æ“ä½œAIå·¥å…·ï¼Œçç›ƒç‰¹å¯«';
        }
        
        // è§’è‰²ç›¸é—œ
        if (content.includes('å­¸ç”Ÿ') || content.includes('ä¸Šç­æ—') || content.includes('å‰µæ¥­è€…')) {
          return 'å­¸ç”Ÿã€ä¸Šç­æ—ã€å‰µæ¥­è€…ä¸‰ç¨®ä¸åŒè§’è‰²çš„è’™å¤ªå¥‡ç•«é¢';
        }
        
        // ä¸Šå‡/é€²æ­¥ç›¸é—œ
        if (content.includes('ä¸Šå‡') || content.includes('æ­ä¸Š') || content.includes('åˆ—è»Š')) {
          return 'ä¸€äººç™»ä¸Šå¿«é€Ÿè¡Œé§›çš„åˆ—è»Šæˆ–é›»æ¢¯';
        }
        
        // é‡‘éŒ¢ç›¸é—œ
        if (content.includes('é‡‘éŒ¢') || content.includes('ğŸ’°') || content.includes('çœä¸‹')) {
          return 'æ™‚é˜èˆ‡é‡‘éŒ¢ç¬¦è™Ÿçš„ç–ŠåŠ å‹•ç•«';
        }
        
        // æ–‡ä»¶/è³‡æ–™ç›¸é—œ
        if (content.includes('æ–‡ä»¶') || content.includes('è³‡æ–™') || content.includes('åˆ†æ')) {
          return 'å‹•ç•«å±•ç¤ºæ–‡ä»¶è‡ªå‹•æ­¸é¡ã€æ•¸æ“šåœ–è¡¨è‡ªå‹•ç”Ÿæˆ';
        }
        
        // æ“ä½œç›¸é—œ
        if (content.includes('æŒ‡ä»¤') || content.includes('ä¸‹æŒ‡ä»¤') || content.includes('ğŸ’¡')) {
          return 'æ‰‹æŒ‡è¼•é»è¢å¹•ï¼Œä»»å‹™å¿«é€Ÿå®Œæˆçš„é€²åº¦æ¢';
        }
        
        // å•é¡Œ/ç–‘å•ç›¸é—œ
        if (content.includes('?') || content.includes('ï¼Ÿ') || content.includes('å¦‚ä½•') || content.includes('ä»€éº¼')) {
          return 'ç–‘å•è¡¨æƒ…ç‰¹å¯«ï¼Œæ€è€ƒç‹€æ…‹';
        }
        
        // å¼·èª¿/é‡è¦ç›¸é—œ
        if (content.includes('é‡è¦') || content.includes('é—œéµ') || content.includes('æ³¨æ„')) {
          return 'é‡è¦è³‡è¨Šé«˜äº®é¡¯ç¤ºï¼Œå¼·èª¿æ•ˆæœ';
        }
        
        // å°æ¯”ç›¸é—œ
        if (content.includes('vs') || content.includes('å°æ¯”') || content.includes('æ¯”è¼ƒ')) {
          return 'å·¦å³åˆ†å±å°æ¯”ç•«é¢';
        }
        
        // æ­¥é©Ÿ/æµç¨‹ç›¸é—œ
        if (content.includes('æ­¥é©Ÿ') || content.includes('æµç¨‹') || content.includes('ç¬¬ä¸€') || content.includes('ç¬¬äºŒ')) {
          return 'æ­¥é©ŸæŒ‡ç¤ºåœ–ï¼Œæµç¨‹å‹•ç•«';
        }
        
        // é è¨­æè¿°
        return 'æ ¹æ“šå°è©å…§å®¹çš„ç›¸é—œç•«é¢';
      }
      
      // ç”Ÿæˆè…³æœ¬è¡¨æ ¼
      function generateScriptTable(scriptData) {
        console.log('ç”Ÿæˆè…³æœ¬è¡¨æ ¼ï¼Œæ•¸æ“š:', scriptData);
        
        // æª¢æŸ¥æ˜¯å¦æœ‰éŒ¯èª¤
        if (scriptData && scriptData.error) {
          console.log('è…³æœ¬æ•¸æ“šæœ‰éŒ¯èª¤:', scriptData.message);
          return `<tr><td colspan="6">è§£æå¤±æ•—: ${scriptData.message}</td></tr>`;
        }
        
        // è™•ç†æ–°æ ¼å¼ï¼ˆæœ‰rowsæ¬„ä½ï¼‰
        if (scriptData && scriptData.rows && scriptData.rows.length > 0) {
          let tableRows = '';
          
          // æŒ‰ç…§è¦ç¯„æ ¼å¼ç”Ÿæˆè¡¨æ ¼è¡Œ
          scriptData.rows.forEach((row, index) => {
            const timeRange = `${row.start_sec}-${row.end_sec}s`;
            const section = row.section || '-';
            const shotDesc = row.shot_desc || '-';
            const dialogue = row.dialogue || '-';
            const subtitle = row.subtitle || '-';
            const sfx = row.sfx || '-';
            
            tableRows += `
              <tr>
                <td>${timeRange}</td>
                <td>${section}</td>
                <td title="${shotDesc}">${shotDesc}</td>
                <td title="${dialogue}">${dialogue}</td>
                <td title="${subtitle}">${subtitle}</td>
                <td title="${sfx}">${sfx}</td>
              </tr>
            `;
          });
          
          console.log('ç”Ÿæˆçš„è¡¨æ ¼è¡Œ:', tableRows);
          return tableRows || '<tr><td colspan="6">ç„¡æ•¸æ“š</td></tr>';
        }
        
        // è™•ç†èˆŠæ ¼å¼ï¼ˆæœ‰sectionsæ¬„ä½ï¼‰
        if (scriptData && scriptData.sections && scriptData.sections.length > 0) {
        let tableRows = '';
        let timeIndex = 0;
        const timeRanges = ['0-3s', '3-7s', '7-15s', '15-25s', '25-30s'];
        
          // æª¢æŸ¥æ˜¯å¦æœ‰ç•«é¢æ„Ÿè³‡æ–™
          const hasVisualData = scriptData.visual && scriptData.visual.trim() !== '';
          let visualLines = [];
          
          if (hasVisualData) {
            // è§£æç•«é¢æ„Ÿå…§å®¹ï¼ŒæŒ‰è¡Œåˆ†å‰²
            visualLines = scriptData.visual.split('\n').map(line => line.trim()).filter(line => line);
            console.log('ç•«é¢æ„Ÿè³‡æ–™:', visualLines);
          }
          
          scriptData.sections.forEach((section, sectionIndex) => {
            console.log(`è™•ç†æ®µè½ ${sectionIndex}:`, section);
            
            // å¦‚æœæ®µè½æœ‰å…§å®¹
            if (section.content && section.content.length > 0) {
          section.content.forEach((content, contentIndex) => {
            const timeRange = timeRanges[timeIndex] || '-';
            const sectionType = section.type || 'å…§å®¹æ®µè½';
                
                // æ¸…ç†å…§å®¹ï¼Œç§»é™¤å¤šé¤˜çš„ç©ºç™½
                const cleanContent = content.trim();
                
                // é™åˆ¶é¡¯ç¤ºé•·åº¦ï¼Œè¶…é30å€‹å­—ç¬¦å°±æˆªæ–·ä¸¦åŠ ä¸Šçœç•¥è™Ÿ
                const displayContent = cleanContent.length > 30 ? 
                  cleanContent.substring(0, 30) + '...' : cleanContent;
              
                // ç²å–å°æ‡‰çš„ç•«é¢æè¿°
                let visualDescription = '-';
                if (hasVisualData && visualLines[timeIndex]) {
                  // ä½¿ç”¨å¯¦éš›çš„ç•«é¢æ„Ÿå…§å®¹
                  visualDescription = visualLines[timeIndex].length > 50 ? 
                    visualLines[timeIndex].substring(0, 50) + '...' : visualLines[timeIndex];
                } else {
                  // å¦‚æœæ²’æœ‰ç•«é¢æ„Ÿè³‡æ–™ï¼Œä½¿ç”¨æ™ºèƒ½ç”Ÿæˆ
                  visualDescription = generateVisualDescription(cleanContent);
                }
            
            tableRows += `
              <tr>
                <td>${timeRange}</td>
                <td>${sectionType}</td>
                    <td title="${hasVisualData && visualLines[timeIndex] ? visualLines[timeIndex] : visualDescription}">${visualDescription}</td>
                    <td title="${cleanContent}">${displayContent}</td>
                <td>-</td>
                    <td>-</td>
                  </tr>
                `;
                timeIndex++;
              });
            } else {
              // å¦‚æœæ®µè½æ²’æœ‰å…§å®¹ï¼Œä½†æ®µè½é¡å‹å­˜åœ¨
              const timeRange = timeRanges[timeIndex] || '-';
              const sectionType = section.type || 'å…§å®¹æ®µè½';
              
              // ç²å–å°æ‡‰çš„ç•«é¢æè¿°
              let visualDescription = '-';
              if (hasVisualData && visualLines[timeIndex]) {
                visualDescription = visualLines[timeIndex].length > 50 ? 
                  visualLines[timeIndex].substring(0, 50) + '...' : visualLines[timeIndex];
              }
              
              tableRows += `
                <tr>
                  <td>${timeRange}</td>
                  <td>${sectionType}</td>
                  <td title="${hasVisualData && visualLines[timeIndex] ? visualLines[timeIndex] : ''}">${visualDescription}</td>
                  <td>-</td>
                <td>-</td>
                <td>-</td>
              </tr>
            `;
            timeIndex++;
            }
        });
        
          console.log('ç”Ÿæˆçš„è¡¨æ ¼è¡Œ:', tableRows);
        return tableRows || '<tr><td colspan="6">ç„¡æ•¸æ“š</td></tr>';
        }
        
        // å¦‚æœéƒ½æ²’æœ‰ï¼Œè¿”å›ç„¡æ•¸æ“š
        console.log('æ²’æœ‰è…³æœ¬æ•¸æ“šï¼Œè¿”å›ç„¡æ•¸æ“šè¡Œ');
        return '<tr><td colspan="6">ç„¡æ•¸æ“š</td></tr>';
      }
      
      // åˆ‡æ›è…³æœ¬å±•é–‹/æ”¶èµ·
      function toggleScript(scriptId) {
        const content = document.getElementById(`script-${scriptId}`);
        const actions = document.getElementById(`actions-${scriptId}`);
        const toggleIcon = document.querySelector(`[data-script-id="${scriptId}"] .toggle-icon`);
        
        if (content.style.display === 'none') {
          content.style.display = 'block';
          actions.style.display = 'flex';
          toggleIcon.textContent = 'â–²';
        } else {
          content.style.display = 'none';
          actions.style.display = 'none';
          toggleIcon.textContent = 'â–¼';
        }
      }
      
      // ç·¨è¼¯è…³æœ¬åç¨±
      function editScriptName(scriptId, event) {
        event.stopPropagation();
        const nameElement = event.target;
        const currentName = nameElement.textContent;
        
        const newName = prompt('è«‹è¼¸å…¥æ–°çš„è…³æœ¬åç¨±:', currentName);
        if (newName && newName !== currentName) {
          updateScriptName(scriptId, newName);
        }
      }
      
      // æ›´æ–°è…³æœ¬åç¨±
      async function updateScriptName(scriptId, newName) {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/scripts/${scriptId}/name`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({ name: newName })
          });
          
          if (response.ok) {
            showToast('è…³æœ¬åç¨±æ›´æ–°æˆåŠŸï¼', 3000);
            loadMyScripts(); // é‡æ–°è¼‰å…¥åˆ—è¡¨
          } else if (response.status === 401) {
            showToast('è«‹å…ˆç™»å…¥', 3000);
          } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'æ›´æ–°å¤±æ•—');
          }
        } catch (error) {
          console.error('Update script name error:', error);
          showToast('æ›´æ–°å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // æŸ¥çœ‹å®Œæ•´è…³æœ¬
      function viewFullScript(scriptId) {
        // æ‰¾åˆ°å°æ‡‰çš„è…³æœ¬æ•¸æ“š
        const scripts = getLocalScripts();
        const script = scripts.find(s => s.id == scriptId);
        
        if (!script) {
          showToast('æ‰¾ä¸åˆ°è…³æœ¬æ•¸æ“š', 3000);
          return;
        }
        
        // å‰µå»ºå½ˆå‡ºè¦–çª—
        const modal = document.createElement('div');
        modal.className = 'script-modal-overlay';
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 10000;
        `;
        
        const modalContent = document.createElement('div');
        modalContent.style.cssText = `
          background: white;
          border-radius: 12px;
          padding: 24px;
          max-width: 90%;
          max-height: 90%;
          overflow-y: auto;
          box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        `;
        
        // ç”Ÿæˆå®Œæ•´è…³æœ¬å…§å®¹
        let fullContent = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #e5e7eb; padding-bottom: 16px;">
            <h2 style="margin: 0; color: #1f2937; font-size: 20px;">${script.name || 'æœªå‘½åè…³æœ¬'}</h2>
            <button onclick="this.closest('.script-modal-overlay').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">Ã—</button>
          </div>
        `;
        
        if (script.script_data && script.script_data.sections) {
          fullContent += '<div style="margin-bottom: 20px;">';
          script.script_data.sections.forEach((section, index) => {
            fullContent += `
              <div style="margin-bottom: 16px; padding: 16px; background: #f8fafc; border-radius: 8px;">
                <h3 style="margin: 0 0 12px 0; color: #374151; font-size: 16px; font-weight: 600;">${section.type || 'å…§å®¹æ®µè½'}</h3>
                <div style="color: #4b5563; line-height: 1.6;">
                  ${section.content ? section.content.map(content => `<p style="margin: 8px 0;">${content}</p>`).join('') : '<p>ç„¡å…§å®¹</p>'}
                </div>
              </div>
            `;
          });
          fullContent += '</div>';
        } else {
          // å¦‚æœæ²’æœ‰çµæ§‹åŒ–æ•¸æ“šï¼Œé¡¯ç¤ºåŸå§‹å…§å®¹
          fullContent += `
            <div style="background: #f8fafc; padding: 16px; border-radius: 8px; white-space: pre-wrap; line-height: 1.6; color: #4b5563;">
              ${script.content || 'ç„¡å…§å®¹'}
            </div>
          `;
        }
        
        modalContent.innerHTML = fullContent;
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        // é»æ“ŠèƒŒæ™¯é—œé–‰
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
          }
        });
      }
      
      // ä¸‹è¼‰PDF
      function downloadScriptPDF(scriptId) {
        showToast('PDFä¸‹è¼‰åŠŸèƒ½é–‹ç™¼ä¸­...', 3000);
      }
      
      // ä¸‹è¼‰CSV
      function downloadScriptCSV(scriptId) {
        showToast('CSVä¸‹è¼‰åŠŸèƒ½é–‹ç™¼ä¸­...', 3000);
      }
      
      // åˆªé™¤è…³æœ¬
      async function deleteScript(scriptId) {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è…³æœ¬å—ï¼Ÿ')) {
          return;
        }
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/scripts/${scriptId}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            showToast('è…³æœ¬åˆªé™¤æˆåŠŸï¼', 3000);
            loadMyScripts(); // é‡æ–°è¼‰å…¥åˆ—è¡¨
          } else if (response.status === 401) {
            showToast('è«‹å…ˆç™»å…¥', 3000);
          } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'åˆªé™¤å¤±æ•—');
          }
        } catch (error) {
          console.error('Delete script error:', error);
          showToast('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // æ ¼å¼åŒ–å°ç£æ™‚é–“
      function formatTaiwanTime(dateString) {
        const date = new Date(dateString);
        return date.toLocaleString('zh-TW', {
          timeZone: 'Asia/Taipei',
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        });
      }
      
      // é‡æ–°ç”Ÿæˆçµæœ
      async function regenerateResult(type) {
        switch(type) {
          case 'positioning':
            await generatePositioning();
            break;
          case 'topics':
            await generateTopics();
            break;
          case 'script':
            await generateScript();
            break;
        }
      }
      
      // æ›´æ–°çµæœå€å¡Šå…§å®¹
      function updateResultBlock(elementId, content, hasContent) {
        const element = document.getElementById(elementId);
        if (element) {
          element.textContent = content;
          if (hasContent) {
            element.classList.add('has-content');
          } else {
            element.classList.remove('has-content');
          }
        }
      }
      
      // å¸³è™Ÿå®šä½åŠŸèƒ½
      async function analyzePositioning() {
        const positioning = positioningInput.value;
        
        if (!positioning) {
          showToast('è«‹å…ˆè¼¸å…¥å¸³è™Ÿå®šä½', 3000);
          return;
        }
        
        updateResultBlock('positioningResult', 'æ­£åœ¨åˆ†æå¸³è™Ÿå®šä½...', false);
        
        try {
          // é€™è£¡å¯ä»¥èª¿ç”¨å¾Œç«¯ API é€²è¡Œå¸³è™Ÿå®šä½åˆ†æ
          // æš«æ™‚ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š
          setTimeout(() => {
            const analysis = `æ ¹æ“šæ‚¨çš„å¸³è™Ÿå®šä½"${positioning}"ï¼Œå»ºè­°ï¼š\n\n1. å…§å®¹é¢¨æ ¼ï¼šè¼•é¬†å¹½é»˜\n2. ç›®æ¨™å—çœ¾ï¼šå¥åº·æ„›å¥½è€…\n3. å…§å®¹ä¸»é¡Œï¼šåŠ å¯†è²¨å¹£èˆ‡å¥åº·çµåˆ\n4. ç™¼å¸ƒæ™‚é–“ï¼šæ™šä¸Š8-10é»\n5. äº’å‹•ç­–ç•¥ï¼šå¤šä½¿ç”¨å•ç­”å½¢å¼`;
            updateResultBlock('positioningResult', analysis, true);
          }, 2000);
        } catch (error) {
          updateResultBlock('positioningResult', 'åˆ†æå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', false);
          showToast('åˆ†æå¤±æ•—', 3000);
        }
      }
      
      // è…³æœ¬é¸é¡ŒåŠŸèƒ½
      async function selectTopics() {
        const platform = platformSelect.value;
        const topic = topicInput.value;
        
        if (!platform) {
          showToast('è«‹å…ˆé¸æ“‡å¹³å°', 3000);
          return;
        }
        
        updateResultBlock('topicSelectionResult', 'æ­£åœ¨ç‚ºæ‚¨é¸é¡Œ...', false);
        
        try {
          // é€™è£¡å¯ä»¥èª¿ç”¨å¾Œç«¯ API é€²è¡Œé¸é¡Œ
          // æš«æ™‚ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š
          setTimeout(() => {
            const topics = `ç‚º${platform}å¹³å°æ¨è–¦ä»¥ä¸‹é¸é¡Œ${topic ? `ï¼ˆåŸºæ–¼"${topic}"ä¸»é¡Œï¼‰` : ''}ï¼š\n\n1. å¤å­£ç¾ç™½ä¿é¤Šçš„5å€‹å°æŠ€å·§\n2. 30å¤©ç¾ç™½æŒ‘æˆ°å¯¦æ¸¬\n3. ç¾ç™½ç”¢å“æˆåˆ†å¤§è§£æ\n4. å¤©ç„¶ç¾ç™½æ–¹æ³•åˆ†äº«\n5. ç¾ç™½èª¤å€ä½ ä¸­äº†å¹¾å€‹ï¼Ÿ`;
            updateResultBlock('topicSelectionResult', topics, true);
          }, 2000);
        } catch (error) {
          updateResultBlock('topicSelectionResult', 'é¸é¡Œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', false);
          showToast('é¸é¡Œå¤±æ•—', 3000);
        }
      }
      
      // äº‹ä»¶ç›£è½å™¨
      document.addEventListener('DOMContentLoaded', async () => {
        // ç¢ºä¿æŠ½å±œåˆå§‹ç‹€æ…‹ç‚ºé—œé–‰
        closeUserDrawer();
        
        // æª¢æŸ¥æ˜¯å¦æœ‰èªè­‰å›èª¿
        await handleAuthCallback();
        
        // æª¢æŸ¥æœ¬åœ°å­˜å„²çš„èªè­‰è³‡è¨Š
        ipPlanningToken = localStorage.getItem('ipPlanningToken');
        ipPlanningUser = JSON.parse(localStorage.getItem('ipPlanningUser') || 'null');
        
        if (ipPlanningToken && ipPlanningUser) {
          updateAuthUI(true);
        } else {
          updateAuthUI(false);
        }
        
        // æŒ‰éˆ•åŠŸèƒ½å·²æ•´åˆåˆ°å¿«é€ŸæŒ‰éˆ•ä¸­
        
        // æ¨™ç±¤åˆ‡æ›äº‹ä»¶
        document.querySelectorAll('.result-tab').forEach(tab => {
          tab.addEventListener('click', () => {
            const tabName = tab.getAttribute('data-tab');
            switchTab(tabName);
          });
        });
        
        // è¨­å®šå€å¡Šæ‘ºç–Š/å±•é–‹åŠŸèƒ½
        settingsToggleEl.addEventListener('click', () => {
          const isCollapsed = settingsContentEl.classList.contains('collapsed');
          const toggleIcon = settingsToggleEl.querySelector('.settings-toggle');
          
          if (isCollapsed) {
            settingsContentEl.classList.remove('collapsed');
            toggleIcon.textContent = 'â–¼';
          } else {
            settingsContentEl.classList.add('collapsed');
            toggleIcon.textContent = 'â–¶';
          }
        });
        
        // ç™»å…¥æŒ‰éˆ•åŠŸèƒ½ - å·²ç¶“åœ¨ HTML ä¸­è¨­å®š onclick="goToLogin()"ï¼Œä¸éœ€è¦å†æ¬¡ç¶å®š
        // loginBtn.addEventListener('click', login);
        
        // èŠå¤©åŠŸèƒ½
        sendBtn.addEventListener('click', sendMessage);
        
        // è¼¸å…¥æ¡†äº‹ä»¶ç›£è½å™¨
        messageInput.addEventListener('input', autoResizeTextarea);
        
        // åˆå§‹åŒ–ç™¼é€æŒ‰éˆ•ç‹€æ…‹
        autoResizeTextarea();
        
        // å¿«é€ŸæŒ‰éˆ•åŠŸèƒ½
        document.querySelectorAll('.quick-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const text = btn.getAttribute('data-text');
            if (text) {
              messageInput.value = text;
              messageInput.focus();
              
              // æ·»åŠ è¦–è¦ºåé¥‹
              btn.style.transform = 'scale(0.95)';
              setTimeout(() => {
                btn.style.transform = '';
              }, 150);
              
              // æ ¹æ“šæŒ‰éˆ•é¡å‹åˆ‡æ›åˆ°å°æ‡‰çš„çµæœæ¨™ç±¤
              if (text.includes('ç”Ÿæˆè…³æœ¬')) {
                switchTab('script');
              } else if (text.includes('è…³æœ¬é¸é¡Œ')) {
                switchTab('topics');
              } else if (text.includes('å¸³è™Ÿå®šä½')) {
                switchTab('positioning');
              }
              
              // è‡ªå‹•ç™¼é€è¨Šæ¯
              setTimeout(() => {
                sendMessage();
              }, 500);
            }
          });
        });
        
        // è¨­å®šå·²å¥—ç”¨çš„æ¨™è¨˜
        let settingsApplied = false;
        let appliedSettings = {
          platform: null,
          topic: null,
          duration: null,
          positioning: null
        };

        applyBtn.addEventListener('click', () => {
          const platform = platformSelect.value;
          const topic = topicInput.value;
          const positioning = positioningInput.value;
          const duration = durationInput.value;
          
          if (platform) {
            // è¨˜éŒ„å·²å¥—ç”¨çš„è¨­å®š
            settingsApplied = true;
            appliedSettings = {
              platform: platform,
              topic: topic,
              duration: duration,
              positioning: positioning
            };
            
            showToast('è¨­å®šå·²å¥—ç”¨', 2000);
            
            // è‡ªå‹•æ”¶åˆè¨­å®šå€å¡Š
            settingsContentEl.classList.add('collapsed');
            const toggleIcon = settingsToggleEl.querySelector('.settings-toggle');
            toggleIcon.textContent = 'â–¶';
          } else {
            showToast('è«‹é¸æ“‡å¹³å°', 3000);
          }
        });
        
        // æ¸¬è©¦é€£ç·šå’Œé¡¯ç¤ºçµæœåŠŸèƒ½å·²æ•´åˆåˆ°å…¶ä»–æŒ‰éˆ•ä¸­
        
        // ç¶å®šå½ˆè·³è¦–çª—æŒ‰éˆ•äº‹ä»¶
        popupRetry.addEventListener('click', () => {
          hidePopupOverlay();
          login();
        });
        
        popupCancel.addEventListener('click', () => {
          hidePopupOverlay();
        });
        
        // éµç›¤å¿«æ·éµ - å·²ç§»è‡³ initChatGPTFeatures ä¸­è™•ç†
      });
      
      // ç™»å…¥åŠŸèƒ½
      async function login() {
        try {
          console.log('DEBUG: Login function called');
          
          // å¾å¾Œç«¯å–å¾— Google èªè­‰ URLï¼ˆéœ€è¦å¾Œç«¯ CORS å…è¨± http://localhost:5173ï¼‰
          console.log('DEBUG: Fetching auth URL from backend...');
          let authUrl = null;
          const fbParam = encodeURIComponent(window.location.origin);
          try {
            const response = await fetch(`https://aivideobackend.zeabur.app/api/auth/google?fb=${fbParam}`);
            const data = await response.json();
            authUrl = data && data.auth_url;
            console.log('DEBUG: Auth URL received:', authUrl);
          } catch (corsErr) {
            console.warn('DEBUG: Fetch auth_url failed (likely CORS). Fallback to direct navigate.', corsErr);
            authUrl = `https://aivideobackend.zeabur.app/api/auth/google?fb=${fbParam}`;
          }
          
          // æª¢æ¸¬æ˜¯å¦ç‚ºæ‰‹æ©Ÿç‰ˆ
          const isMobile = window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
          
          // ä¸€å¾‹æ¡ç”¨ä¸»è¦–çª—è·³è½‰ï¼ˆé¿å…å½ˆçª—è¢«æ“‹èˆ‡é«”é©—ä¸ä¸€è‡´ï¼‰
          console.log('DEBUG: Redirecting to Google auth (main window)');
          window.location.href = authUrl;
          return;

          // ä»¥ä¸‹èˆŠçš„å½ˆçª—æµç¨‹ä¿ç•™æ–¼æ­·å²ï¼Œä¸å†åŸ·è¡Œ
          let popup = null;
          let popupTimeout = null;
          
          // å®šç¾©èªè­‰è¨Šæ¯è™•ç†å‡½æ•¸
          const authMessageHandler = function(event) {
            // å…ˆè¨˜éŒ„æ‰€æœ‰æ”¶åˆ°çš„è¨Šæ¯ï¼ˆç”¨æ–¼èª¿è©¦ï¼‰
            console.log('DEBUG: ğŸ“¥ Received ANY message event:', {
              origin: event.origin,
              source: event.source ? 'window' : 'null',
              data: event.data,
              dataType: typeof event.data,
              currentOrigin: window.location.origin
            });
            
            // æª¢æŸ¥è¨Šæ¯é¡å‹æ˜¯å¦ç‚ºèªè­‰ç›¸é—œ
            const isAuthMessage = event.data && typeof event.data === 'object' && (
              event.data.type === 'GOOGLE_AUTH_SUCCESS' || 
              event.data.type === 'GOOGLE_AUTH_ERROR'
            );
            
            if (!isAuthMessage) {
              console.log('DEBUG: â­ï¸ Ignoring non-auth message. Type:', event.data?.type, 'Data:', event.data);
              return;
            }
            
            console.log('DEBUG: âœ… Auth message detected! Type:', event.data.type);
            console.log('DEBUG: Message origin:', event.origin);
            console.log('DEBUG: Current window origin:', window.location.origin);
            console.log('DEBUG: Full message data:', JSON.stringify(event.data, null, 2));
            
            // æ¥å—ä¾†è‡ªæ‰€æœ‰ origin çš„èªè­‰è¨Šæ¯ï¼ˆå› ç‚ºä½¿ç”¨ '*' targetOriginï¼‰
            // ä½†è¨˜éŒ„ origin ä»¥èª¿è©¦
            const allowedOrigins = [
              'https://aivideobackend.zeabur.app',
              'http://aivideobackend.zeabur.app',
              'https://aivideonew.zeabur.app',
              'http://aivideonew.zeabur.app',
              window.location.origin,
              window.location.protocol + '//' + window.location.host,
              'null'  // æŸäº›æƒ…æ³ä¸‹ origin å¯èƒ½æ˜¯ 'null'
            ];
            
            if (!allowedOrigins.includes(event.origin) && event.origin !== 'null') {
              console.warn('DEBUG: âš ï¸ Message from unexpected origin:', event.origin);
              console.warn('DEBUG: Allowed origins:', allowedOrigins);
              console.warn('DEBUG: But processing anyway since it is auth message with targetOrigin "*"');
            } else {
              console.log('DEBUG: âœ… Origin check passed:', event.origin);
            }
            
            // æ¸…é™¤é€¾æ™‚
            if (popupTimeout) {
              clearTimeout(popupTimeout);
              popupTimeout = null;
            }
            
            // postMessage å·²æˆåŠŸè™•ç†
            
            // é—œé–‰å½ˆè·³è¦–çª—ï¼ˆå¤šç­–ç•¥ + é‡è©¦ï¼‰
            function tryClosePopupNow(){
              try { if (popup) popup.close(); } catch(_) {}
              try { window.open('', 'googleAuth').close(); } catch(_) {}
            }
            tryClosePopupNow();
            let closeRetry = 0;
            const closeTimer = setInterval(() => {
              closeRetry++;
              tryClosePopupNow();
              if (closeRetry >= 6) clearInterval(closeTimer);
            }, 300);
            
              // æ¸…é™¤å®šæœŸæª¢æŸ¥å’Œç§»é™¤äº‹ä»¶ç›£è½å™¨
              if (typeof localStorageCheckInterval !== 'undefined') {
                clearInterval(localStorageCheckInterval);
              }
              window.removeEventListener('message', authMessageHandler);
              window.removeEventListener('storage', storageHandler);
            
            if (event.data.type === 'GOOGLE_AUTH_SUCCESS') {
              console.log('DEBUG: Auth success message received');
              console.log('DEBUG: Full event.data:', JSON.stringify(event.data, null, 2));
              
              // èªè­‰æˆåŠŸï¼Œæ›´æ–° UI
              // å¾Œç«¯ç™¼é€çš„æ˜¯ accessTokenï¼Œéœ€è¦æ˜ å°„åˆ° ipPlanningToken
              ipPlanningToken = event.data.accessToken || event.data.ipPlanningToken;
              
              // è™•ç† user å°è±¡
              if (event.data.user) {
                ipPlanningUser = {
                  user_id: event.data.user.id || event.data.user.user_id,
                  email: event.data.user.email || '',
                  name: event.data.user.name || '',
                  picture: event.data.user.picture || ''
                };
              } else {
                // å¦‚æœæ²’æœ‰ user å°è±¡ï¼Œå˜—è©¦å¾å…¶ä»–å­—æ®µæ§‹å»º
                ipPlanningUser = {
                  user_id: event.data.user_id || event.data.user?.id,
                  email: event.data.email || event.data.user?.email || '',
                  name: event.data.name || event.data.user?.name || '',
                  picture: event.data.picture || event.data.user?.picture || ''
                };
              }
              
              console.log('DEBUG: Processed user data:', ipPlanningUser);
              
              // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
              if (ipPlanningToken) {
                localStorage.setItem('ipPlanningToken', ipPlanningToken);
                console.log('DEBUG: Token saved to localStorage');
              }
              if (ipPlanningUser) {
                localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
                console.log('DEBUG: User data saved to localStorage');
              }
              
              // éš±è—å½ˆçª—è¦†è“‹å±¤
              hidePopupOverlay();
              console.log('DEBUG: Popup overlay hidden');
              
              // æ›´æ–°èªè­‰ UIï¼ˆå¼·åˆ¶æ›´æ–°ï¼‰
              updateAuthUI(true);
              console.log('DEBUG: Auth UI updated');
              
              // é‡æ–°æª¢æŸ¥ç™»å…¥ç‹€æ…‹ï¼ˆç¢ºä¿å…¨åŸŸè®Šæ•¸åŒæ­¥ï¼‰
              ipPlanningToken = localStorage.getItem('ipPlanningToken');
              ipPlanningUser = JSON.parse(localStorage.getItem('ipPlanningUser') || 'null');
              console.log('DEBUG: Global variables synced, token:', ipPlanningToken ? 'present' : 'missing');
              
              // é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼
              showMainApp();
              console.log('DEBUG: Main app shown');
              
              // æª¢æŸ¥ä¸¦æ›´æ–°è¨‚é–±ç‹€æ…‹
              checkSubscriptionStatus();
              console.log('DEBUG: Subscription status checked');
              
              // é¡¯ç¤ºæˆåŠŸæç¤º
              showToast('ç™»å…¥æˆåŠŸï¼', 2000);
              console.log('DEBUG: Login success flow completed');
            } else if (event.data.type === 'GOOGLE_AUTH_ERROR') {
              console.log('DEBUG: Auth error message received:', event.data.error);
              hidePopupOverlay();
              showToast('èªè­‰å¤±æ•—ï¼š' + (event.data.error || 'æœªçŸ¥éŒ¯èª¤'), 5000);
            }
          };
          
          // è™•ç† localStorage æ›´æ–°çš„å‡½æ•¸ï¼ˆä½œç‚º postMessage çš„å‚™ç”¨æ–¹æ¡ˆï¼‰
          const storageHandler = function(event) {
            console.log('DEBUG: ğŸ“¦ Storage event received:', {
              key: event.key,
              newValue: event.newValue,
              oldValue: event.oldValue,
              url: event.url
            });
            
            // æª¢æŸ¥æ˜¯å¦æ˜¯ token æ›´æ–°
            if (event.key === 'ipPlanningTokenUpdated' && event.newValue) {
              console.log('DEBUG: âœ… Token updated in localStorage detected!');
              
              // å¾ localStorage è®€å– token å’Œç”¨æˆ¶è³‡è¨Š
              const newToken = localStorage.getItem('ipPlanningToken');
              const newUserStr = localStorage.getItem('ipPlanningUser');
              
              if (newToken && newToken !== ipPlanningToken) {
                console.log('DEBUG: New token found in localStorage, processing...');
                
                // æ¸…é™¤é€¾æ™‚
                if (popupTimeout) {
                  clearTimeout(popupTimeout);
                  popupTimeout = null;
                }
                
                // æ›´æ–°å…¨åŸŸè®Šæ•¸
                ipPlanningToken = newToken;
                if (newUserStr) {
                  try {
                    ipPlanningUser = JSON.parse(newUserStr);
                  } catch (e) {
                    console.warn('DEBUG: Failed to parse user data:', e);
                  }
                }
                
                // é—œé–‰å½ˆçª—ï¼šé¿å…åœ¨ storage äº‹ä»¶ä¸­è§¸ç™¼ COOP éŒ¯èª¤ï¼Œæ”¹ç”± message handler ä¸»è²¬
                // é€™è£¡ä¸å†å˜—è©¦é—œé–‰ï¼Œä»¥æ¸›å°‘ "Cross-Origin-Opener-Policy would block window.close" çš„è­¦å‘Š
                
                // æ¸…é™¤å®šæœŸæª¢æŸ¥å’Œç§»é™¤ç›£è½å™¨
                if (typeof localStorageCheckInterval !== 'undefined') {
                  clearInterval(localStorageCheckInterval);
                }
                window.removeEventListener('storage', storageHandler);
                window.removeEventListener('message', authMessageHandler);
                
                // éš±è—å½ˆçª—è¦†è“‹å±¤
                hidePopupOverlay();
                console.log('DEBUG: Popup overlay hidden');
                
                // æ›´æ–°èªè­‰ UI
                updateAuthUI(true);
                console.log('DEBUG: Auth UI updated');
                
                // é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼
                showMainApp();
                console.log('DEBUG: Main app shown');
                
              // å…ˆå¼·åˆ¶ refresh ä¸€æ¬¡ï¼Œç¢ºä¿æœå‹™ç«¯èˆ‡å‰ç«¯ token å®Œå…¨åŒæ­¥ï¼Œå†è®€å– me
              (async () => {
                try {
                  console.log('DEBUG: Forcing one refresh after login to sync token...');
                  const t0 = localStorage.getItem('ipPlanningToken') || '';
                  await fetch('https://aivideobackend.zeabur.app/api/auth/refresh', { method: 'POST', headers: t0 ? { 'Authorization': `Bearer ${t0}` } : {} });
                } catch (e) { console.warn('DEBUG: refresh after login failed (can ignore if CORS):', e); }
                try {
                  console.log('DEBUG: Probing /api/auth/me after refresh...');
                  const meRes = await fetch('https://aivideobackend.zeabur.app/api/auth/me');
                  console.log('DEBUG: /api/auth/me status:', meRes.status);
                } catch (e) { console.warn('DEBUG: me probe failed:', e); }
                // æª¢æŸ¥ä¸¦æ›´æ–°è¨‚é–±ç‹€æ…‹ï¼ˆå†ç•¥å¾®å»¶é²ï¼‰
                setTimeout(() => { try { checkSubscriptionStatus(); } catch(_){} }, 150);
              })();
                console.log('DEBUG: Subscription status checked');
                
                // é¡¯ç¤ºæˆåŠŸæç¤º
                showToast('ç™»å…¥æˆåŠŸï¼', 2000);
                console.log('DEBUG: Login success flow completed (via localStorage)');
              }
            }
          };
          
          // å…ˆè¨»å†Šç›£è½å™¨ï¼ˆé—œéµï¼šåœ¨é–‹å½ˆçª—å‰è¨»å†Šï¼Œç¢ºä¿ä¸æœƒéºæ¼è¨Šæ¯ï¼‰
          console.log('DEBUG: Registering message and storage listeners before opening popup');
          window.addEventListener('message', authMessageHandler, false);
          window.addEventListener('storage', storageHandler, false);
          
          // é¡å¤–çš„å®šæœŸæª¢æŸ¥æ©Ÿåˆ¶ï¼ˆæ¯ 500ms æª¢æŸ¥ä¸€æ¬¡ localStorageï¼Œä½œç‚º storage äº‹ä»¶çš„å‚™ç”¨ï¼‰
          let localStorageCheckInterval = setInterval(function() {
            const checkToken = localStorage.getItem('ipPlanningToken');
            const checkUpdatedFlag = localStorage.getItem('ipPlanningTokenUpdated');
            
            if (checkToken && checkUpdatedFlag && checkToken !== ipPlanningToken) {
              console.log('DEBUG: âœ… Token found in localStorage via polling check');
              clearInterval(localStorageCheckInterval);
              
              // è§¸ç™¼èˆ‡ storageHandler ç›¸åŒçš„è™•ç†é‚è¼¯
              const checkUserStr = localStorage.getItem('ipPlanningUser');
              
              if (popupTimeout) {
                clearTimeout(popupTimeout);
                popupTimeout = null;
              }
              
              ipPlanningToken = checkToken;
              if (checkUserStr) {
                try {
                  ipPlanningUser = JSON.parse(checkUserStr);
                } catch (e) {
                  console.warn('DEBUG: Failed to parse user data:', e);
                }
              }
              
              try {
                if (popup) {
                  popup.close();
                }
              } catch (e) {
                console.warn('DEBUG: Error closing popup:', e);
              }
              
              window.removeEventListener('message', authMessageHandler);
              window.removeEventListener('storage', storageHandler);
              
              hidePopupOverlay();
              updateAuthUI(true);
              showMainApp();
              checkSubscriptionStatus();
              showToast('ç™»å…¥æˆåŠŸï¼', 2000);
              console.log('DEBUG: Login success flow completed (via localStorage polling)');
            }
          }, 500);
          
          // è¨­å®šé€¾æ™‚è™•ç†ï¼ˆ90ç§’ï¼‰
          popupTimeout = setTimeout(() => {
            console.warn('DEBUG: Popup timeout after 90 seconds');
            
            // æ¸…é™¤å®šæœŸæª¢æŸ¥
            clearInterval(localStorageCheckInterval);
            
            // æª¢æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰ tokenï¼ˆæœ€å¾Œçš„å‚™ç”¨æª¢æŸ¥ï¼‰
            const finalToken = localStorage.getItem('ipPlanningToken');
            const finalUserStr = localStorage.getItem('ipPlanningUser');
            
            if (finalToken && finalToken !== ipPlanningToken) {
              console.log('DEBUG: Found token in localStorage during timeout, processing...');
              
              // è™•ç† tokenï¼ˆèˆ‡ storageHandler ç›¸åŒçš„é‚è¼¯ï¼‰
              ipPlanningToken = finalToken;
              if (finalUserStr) {
                try {
                  ipPlanningUser = JSON.parse(finalUserStr);
                } catch (e) {
                  console.warn('DEBUG: Failed to parse user data:', e);
                }
              }
              
              hidePopupOverlay();
              updateAuthUI(true);
              showMainApp();
              checkSubscriptionStatus();
              showToast('ç™»å…¥æˆåŠŸï¼', 2000);
              console.log('DEBUG: Login success flow completed (via localStorage timeout check)');
            } else {
              showPopupError('ç™»å…¥é€¾æ™‚ï¼Œè«‹é‡è©¦', true);
            }
            
            try {
              if (popup) {
                popup.close();
              }
            } catch (e) {
              console.warn('DEBUG: Error closing popup:', e);
            }
            window.removeEventListener('message', authMessageHandler);
            window.removeEventListener('storage', storageHandler);
            popupTimeout = null;
          }, 90000);
          
          // ç¾åœ¨æ‰æ‰“é–‹å½ˆçª—
          console.log('DEBUG: Opening popup window with URL:', authUrl);
          popup = window.open(
            authUrl,
            'googleAuth',
            'width=500,height=600,scrollbars=yes,resizable=yes,status=yes,location=yes,toolbar=no,menubar=no'
          );
          window.__loginWindow = popup;
          
          console.log('DEBUG: Popup window object:', popup);
          
          if (!popup) {
            console.error('DEBUG: Popup window blocked or failed to open');
            hidePopupOverlay();
            showPopupError('è«‹å…è¨±å½ˆè·³è¦–çª—ä»¥å®Œæˆç™»å…¥', true);
            window.removeEventListener('message', authMessageHandler);
            window.removeEventListener('storage', storageHandler);
            if (popupTimeout) {
              clearTimeout(popupTimeout);
            }
            return;
          }
          
          console.log('DEBUG: Popup window opened successfully');
          
          // æ›´æ–°è¦†è“‹å±¤è¨Šæ¯
          updatePopupMessage('è«‹åœ¨å½ˆè·³è¦–çª—ä¸­å®Œæˆ Google ç™»å…¥...');
        } catch (error) {
          console.error('Login error:', error);
          hidePopupOverlay();
          showToast('ç™»å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 5000);
        }
      }
      
      function showPopupOverlay(message) {
        popupMessage.textContent = message;
        popupSpinner.style.display = 'block';
        popupButtons.style.display = 'none';
        popupOverlay.style.display = 'flex';
      }
      
      function updatePopupMessage(message) {
        popupMessage.textContent = message;
      }
      
      function showPopupError(message, showRetry = false) {
        popupMessage.textContent = message;
        popupSpinner.style.display = 'none';
        if (showRetry) {
          popupButtons.style.display = 'block';
        } else {
          popupButtons.style.display = 'none';
        }
        popupOverlay.style.display = 'flex';
      }
      
      function hidePopupOverlay() {
        popupOverlay.style.display = 'none';
      }
      
      // handleAuthMessage ç¾åœ¨åœ¨ login() å‡½æ•¸ä¸­å‹•æ…‹å‰µå»ºï¼Œä»¥ä¾¿è¨ªå• popup å’Œ timeout å¼•ç”¨
      
      async function checkAuthResult() {
        // æª¢æŸ¥æœ¬åœ°å­˜å„²ä¸­æ˜¯å¦æœ‰æ–°çš„èªè­‰è³‡è¨Š
        const storedToken = localStorage.getItem('ipPlanningToken');
        const storedUser = localStorage.getItem('ipPlanningUser');
        
        if (storedToken && storedUser && storedToken !== ipPlanningToken) {
          ipPlanningToken = storedToken;
          ipPlanningUser = JSON.parse(storedUser);
          
          // ç‚ºç”¨æˆ¶ç”Ÿæˆéš¨æ©ŸIDï¼ˆå¦‚æœæ²’æœ‰ï¼‰
          if (!ipPlanningUser.user_id) {
            ipPlanningUser.user_id = generateUserId();
            localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
            console.log('é é¢è¼‰å…¥æ™‚ç‚ºç”¨æˆ¶ç”Ÿæˆæ–°ID:', ipPlanningUser.user_id);
          }
          
          updateAuthUI(true);
          updatePersonalInfo();
        }
      }
      async function handleAuthCallback() {
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        const userId = urlParams.get('user_id');
        const email = urlParams.get('email');
        const name = urlParams.get('name');
        const picture = urlParams.get('picture');
        const error = urlParams.get('error');
        
        console.log('DEBUG: Checking auth callback parameters:', {
          token: token ? 'present' : 'missing',
          userId: userId ? 'present' : 'missing',
          email: email ? 'present' : 'missing',
          name: name ? 'present' : 'missing',
          picture: picture ? 'present' : 'missing',
          error: error || 'none'
        });
        
        // è™•ç†éŒ¯èª¤
        if (error) {
          console.error('DEBUG: Auth error received:', error);
          showToast('èªè­‰å¤±æ•—ï¼š' + decodeURIComponent(error), 5000);
          updateAuthUI(false);
          // æ¸…é™¤ URL ä¸­çš„éŒ¯èª¤åƒæ•¸
          window.history.replaceState({}, document.title, window.location.pathname);
          return;
        }
        
        // è™•ç†æˆåŠŸèªè­‰
        if (token && userId && email && name) {
          console.log('DEBUG: Auth success parameters received');
          
          // æ§‹å»ºç”¨æˆ¶ç‰©ä»¶
          ipPlanningUser = {
            id: userId,
            email: email,
            name: name,
            picture: picture || ''
          };
          ipPlanningToken = token;
          
          // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
          localStorage.setItem('ipPlanningToken', ipPlanningToken);
          localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
          
          updateAuthUI(true);
          
          // é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼ï¼ˆæœƒéš±è—ç™»å…¥é é¢ã€é¡¯ç¤ºé¦–é ï¼‰
          showMainApp();
          
          // æª¢æŸ¥ä¸¦æ›´æ–°è¨‚é–±ç‹€æ…‹
          await checkSubscriptionStatus();
          
          // æ¸…é™¤ guestMode æ¨™è¨˜ï¼ˆå¦‚æœæœ‰ï¼‰
          localStorage.removeItem('guestMode');
          
          // æ¸…é™¤ URL ä¸­çš„èªè­‰åƒæ•¸
          window.history.replaceState({}, document.title, window.location.pathname);
          
          console.log('DEBUG: Auth completed successfully');
        }
      }

      async function fetchUserInfo() {
        if (!ipPlanningToken) return;
        
        try {
          let response = await fetch('https://aivideobackend.zeabur.app/api/auth/me', {
          headers: { 'Authorization': `Bearer ${ipPlanningToken}` }
        });
          
          // å¦‚æœæ”¶åˆ° 401ï¼Œå˜—è©¦åˆ·æ–° token å¾Œé‡è©¦
          if (response.status === 401) {
            console.log('æ”¶åˆ° 401ï¼Œå˜—è©¦åˆ·æ–° token...');
            const refreshed = await tryRefreshTokenSafe();
            if (refreshed) {
              // Token åˆ·æ–°æˆåŠŸï¼Œä½¿ç”¨æ–° token é‡è©¦
              response = await fetch('https://aivideobackend.zeabur.app/api/auth/me', {
                headers: { 'Authorization': `Bearer ${ipPlanningToken}` }
              });
            } else {
              // Token åˆ·æ–°å¤±æ•—ï¼Œå·²è‡ªå‹•ç™»å‡ºï¼ˆåœ¨ tryRefreshTokenSafe ä¸­è™•ç†ï¼‰
              return;
            }
          }
          
          // å¦‚æœæ”¶åˆ° 403ï¼Œç›´æ¥ç™»å‡º
          if (response.status === 403) {
            let errorMessage = 'èªè­‰å¤±æ•—ï¼Œè«‹é‡æ–°ç™»å…¥';
            try {
              const errorData = await response.clone().json();
              if (errorData.detail) {
                errorMessage = errorData.detail;
              }
            } catch (e) {
              // å¦‚æœç„¡æ³•è§£æ JSONï¼Œä½¿ç”¨é è¨­è¨Šæ¯
            }
            forceLogout(errorMessage);
            return;
          }
        
        if (response.ok) {
          const userData = await response.json();
          ipPlanningUser = userData;
          
          // ç‚ºç”¨æˆ¶ç”Ÿæˆéš¨æ©ŸIDï¼ˆå¦‚æœæ²’æœ‰ï¼‰
          if (!ipPlanningUser.user_id) {
            ipPlanningUser.user_id = generateUserId();
            console.log('ç‚ºç”¨æˆ¶ç”Ÿæˆæ–°ID:', ipPlanningUser.user_id);
          }
          
          localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
          updateAuthUI(true);
          
          // ç«‹å³æ›´æ–°å€‹äººè³‡æ–™é¡¯ç¤º
          updatePersonalInfo();
        } else {
            // å…¶ä»–éŒ¯èª¤ç‹€æ…‹ï¼Œéœé»˜è™•ç†
            console.warn('ç²å–ç”¨æˆ¶è³‡è¨Šå¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜çš„è³‡è¨Š');
            return;
          }
        } catch (error) {
          // ç¶²è·¯éŒ¯èª¤ç­‰ç•°å¸¸ï¼Œéœé»˜è™•ç†ï¼Œä¸æ‹‹å‡ºéŒ¯èª¤
          console.warn('ç²å–ç”¨æˆ¶è³‡è¨Šæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜çš„è³‡è¨Š');
          return;
        }
      }

      // å½ˆå‡ºæç¤ºæ¡†å‡½æ•¸
      function showToast(message, duration = 3000) {
        toastEl.textContent = message;
        toastEl.style.display = 'block';
        toastEl.className = 'toast show';
        
        setTimeout(() => {
          toastEl.className = 'toast hide';
          setTimeout(() => {
            toastEl.style.display = 'none';
          }, 300);
        }, duration);
      }

      // é€™å€‹äº‹ä»¶ç›£è½å™¨å·²ç¶“åˆä½µåˆ°ä¸Šé¢çš„ DOMContentLoaded ä¸­

      // æ»¾å‹•åˆ°åº•éƒ¨çš„å‡½æ•¸
      function scrollToBottom() {
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
          // ä½¿ç”¨ requestAnimationFrame ç¢ºä¿ DOM æ›´æ–°å¾Œå†æ»¾å‹•
          requestAnimationFrame(() => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
            // å¼·åˆ¶æ»¾å‹•åˆ°æœ€åº•éƒ¨
            setTimeout(() => {
              chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
          });
        }
      }

      // å¼·åˆ¶æ»¾å‹•åˆ°åº•éƒ¨çš„å‡½æ•¸
      function forceScrollToBottom() {
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
          // ç«‹å³æ»¾å‹•åˆ°åº•éƒ¨
          chatMessages.scrollTop = chatMessages.scrollHeight;
          // å»¶é²å†æ¬¡æ»¾å‹•ç¢ºä¿åˆ°é”åº•éƒ¨
          setTimeout(() => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 50);
          setTimeout(() => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 200);
        }
      }

      // åˆå§‹åŒ–èŠå¤©æ»¾å‹•åŠŸèƒ½
      function initChatScroll() {
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
          // ç¢ºä¿èŠå¤©å€åŸŸå¯ä»¥æ»¾å‹•
          chatMessages.style.overflowY = 'auto';
          chatMessages.style.scrollBehavior = 'smooth';
          
          // æ·»åŠ æ»¾å‹•äº‹ä»¶ç›£è½å™¨
          chatMessages.addEventListener('scroll', function() {
            // å¯ä»¥æ·»åŠ æ»¾å‹•ç›¸é—œçš„é‚è¼¯ï¼Œæ¯”å¦‚é¡¯ç¤º/éš±è—æ»¾å‹•åˆ°åº•éƒ¨æŒ‰éˆ•
          });
          
          // ç¢ºä¿åˆå§‹ç‹€æ…‹æ»¾å‹•åˆ°åº•éƒ¨
          forceScrollToBottom();
          
          // å»¶é²å†æ¬¡æ»¾å‹•ç¢ºä¿åˆ°é”åº•éƒ¨
          setTimeout(() => {
            forceScrollToBottom();
          }, 500);
        }
      }

      function append(role, text) {
        const div = document.createElement('div');
        div.className = 'msg ' + (role === 'user' ? 'user' : 'assistant');
        
        // å‰µå»ºé ­åƒå…ƒç´ 
        const avatar = document.createElement('div');
        avatar.className = 'msg-avatar';
        
        if (role === 'user') {
          // ç”¨æˆ¶é ­åƒï¼šä½¿ç”¨ Gmail é ­åƒæˆ–é»˜èªé ­åƒ
          const userAvatarImg = document.getElementById('userAvatar');
          if (userAvatarImg && userAvatarImg.src && userAvatarImg.src !== '') {
            avatar.innerHTML = `<img src="${userAvatarImg.src}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;" alt="ç”¨æˆ¶é ­åƒ">`;
          } else {
            avatar.textContent = 'ä½ ';
          }
        } else {
          avatar.textContent = 'ğŸ¤–';
        }
        
        const bubble = document.createElement('div');
        bubble.className = 'msg-bubble';
        
        // å¦‚æœæ˜¯ AI å›è¦†ï¼Œæ¸…ç† Markdown æ ¼å¼
        if (role === 'assistant') {
          const cleanText = cleanMarkdownFormat(text);
          bubble.innerHTML = `<p>${cleanText}</p>`;
        } else {
          bubble.innerHTML = `<p>${text}</p>`;
        }
        
        div.appendChild(avatar);
        div.appendChild(bubble);
        chatEl.appendChild(div);
        
        // ç¢ºä¿æ»¾å‹•åˆ°åº•éƒ¨
        scrollToBottom();
        return { container: div, bubble: bubble };
      }

      // æ¸…ç† Markdown æ ¼å¼ä¸¦è½‰æ›ç‚º HTML
      function cleanMarkdownFormat(text) {
        if (!text) return '';
        
        // è™•ç† Markdown æ¨™é¡Œæ ¼å¼
        text = text.replace(/^###\s*(.+)$/gm, '<strong>$1</strong>'); // ### æ¨™é¡Œ â†’ **æ¨™é¡Œ**
        text = text.replace(/^##\s*(.+)$/gm, '<strong>$1</strong>');  // ## æ¨™é¡Œ â†’ **æ¨™é¡Œ**
        text = text.replace(/^#\s*(.+)$/gm, '<strong>$1</strong>');   // # æ¨™é¡Œ â†’ **æ¨™é¡Œ**
        
        // å°‡ **æ–‡å­—** è½‰æ›ç‚º <strong>æ–‡å­—</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        
        // è™•ç†å…¶ä»–å¸¸è¦‹çš„ Markdown æ ¼å¼
        text = text.replace(/\*([^*]+)\*/g, '<em>$1</em>');           // *æ–œé«”* â†’ æ–œé«”
        text = text.replace(/`([^`]+)`/g, '<code>$1</code>');         // `ä»£ç¢¼` â†’ ä»£ç¢¼
        
        // ç§»é™¤å–®ç¨çš„ Markdown ç¬¦è™Ÿ
        text = text.replace(/\*\*/g, '');                             // ç§»é™¤å–®ç¨çš„ **
        text = text.replace(/^#{1,6}\s*/gm, '');                      // ç§»é™¤è¡Œé¦–çš„ # ç¬¦è™Ÿ
        
        // è™•ç†åˆ—è¡¨æ ¼å¼
        text = text.replace(/^\d+\.\s*(.+)$/gm, '<div style="margin: 4px 0; padding-left: 16px;">$1</div>'); // æ•¸å­—åˆ—è¡¨
        text = text.replace(/^[-*]\s*(.+)$/gm, '<div style="margin: 4px 0; padding-left: 16px;">â€¢ $1</div>'); // é …ç›®ç¬¦è™Ÿåˆ—è¡¨
        
        // è™•ç†æ›è¡Œç¬¦è™Ÿï¼Œä¿æŒæ®µè½çµæ§‹
        text = text.replace(/\n\n+/g, '</p><p>');                     // å¤šå€‹æ›è¡Œ â†’ æ®µè½åˆ†éš”
        text = text.replace(/\n/g, '<br>');                           // å–®æ›è¡Œ â†’ æ›è¡Œæ¨™ç±¤
        
        // åŒ…è£åœ¨æ®µè½æ¨™ç±¤ä¸­
        if (text && !text.startsWith('<p>')) {
          text = '<p>' + text + '</p>';
        }
        
        return text;
      }

      function updateAssistantNode(nodeObj, text) {
        // æ¸…ç† Markdown æ ¼å¼
        const cleanText = cleanMarkdownFormat(text);
        
        if (nodeObj.bubble) {
          // ä½¿ç”¨ innerHTML ä¾†æ”¯æ´ HTML æ¨™ç±¤ï¼ˆå¦‚ <strong>ï¼‰
          nodeObj.bubble.innerHTML = cleanText;
        } else {
          nodeObj.innerHTML = cleanText;
        }
        
        // ç¢ºä¿æ»¾å‹•åˆ°åº•éƒ¨
        scrollToBottom();
      }

      function canSubmit() {
        if (isSending) return false;
        const now = Date.now();
        if (now - lastSubmitAt < 600) return false; // 600ms ç¯€æµ
        lastSubmitAt = now;
        return true;
      }

      async function send(message) {
        if (!message) return;
        if (!canSubmit()) return;
        lastMessage = message;
        const userNode = append('user', message);
        try { await recordConversationMessage('ai_advisor', 'user', message); } catch (_) {}
        const assistantNode = append('assistant', '');

        // é¡¯ç¤º AI å›è¦†ä¸­çš„è¼‰å…¥ç‹€æ…‹
        const loadingDiv = document.createElement('div');
        loadingDiv.className = 'ai-loading';
        loadingDiv.innerHTML = `
          <span>AIæ­£åœ¨æ€è€ƒä¸­</span>
          <div class="ai-loading-dots">
            <div class="ai-loading-dot"></div>
            <div class="ai-loading-dot"></div>
            <div class="ai-loading-dot"></div>
          </div>
        `;
        assistantNode.bubble.appendChild(loadingDiv);

        sendBtn.disabled = true;
        isSending = true;
        statusEl.textContent = 'æ­£åœ¨é€å‡ºâ€¦';

        try {
          // è‡ªå‹•åµæ¸¬ç’°å¢ƒï¼Œé–‹ç™¼æ™‚ä½¿ç”¨ localhostï¼Œéƒ¨ç½²æ™‚ä½¿ç”¨ç’°å¢ƒè®Šæ•¸æˆ–é è¨­å¾Œç«¯ç¶²åŸŸ
          const isDevelopment = window.location.hostname === 'localhost' || 
                                window.location.hostname === '127.0.0.1' ||
                                window.location.hostname === '0.0.0.0';
          
          // å¦‚æœæ˜¯é–‹ç™¼ç’°å¢ƒï¼Œä½¿ç”¨ localhost:8000ï¼›éƒ¨ç½²ç’°å¢ƒä½¿ç”¨æ­£ç¢ºçš„å¾Œç«¯ç¶²åŸŸ
          let endpoint;
          if (isDevelopment) {
            endpoint = 'https://aivideobackend.zeabur.app/api/chat/stream';
          } else {
            // éƒ¨ç½²ç’°å¢ƒï¼šä½¿ç”¨æ‚¨æä¾›çš„æ­£ç¢ºå¾Œç«¯ç¶²åŸŸ
            endpoint = 'https://aivideobackend.zeabur.app/api/chat/stream';
          }
          // æ·»åŠ èª¿è©¦ä¿¡æ¯
          console.log('API ç«¯é»:', endpoint);
          console.log('ç•¶å‰ä½ç½®:', window.location.href);
          console.log('Hostname:', window.location.hostname);
          console.log('Port:', window.location.port);
          
          // æº–å‚™è«‹æ±‚é ­
          const headers = { 'Content-Type': 'application/json' };
          if (ipPlanningToken) {
            headers['Authorization'] = `Bearer ${ipPlanningToken}`;
          }
          
          const res = await fetch(endpoint, {
            method: 'POST',
            headers,
            body: JSON.stringify({
              message,
              platform: settingsApplied ? appliedSettings.platform : null,
              topic: settingsApplied ? appliedSettings.topic : null,
              duration: settingsApplied ? appliedSettings.duration : null,
              style: styleInstruction,
              profile: settingsApplied ? appliedSettings.positioning : null,
              history,
              user_id: ipPlanningUser?.user_id || null
            })
          });

          if (!res.ok) {
            const text = await res.text().catch(() => '');
            console.error('API è«‹æ±‚å¤±æ•—:', res.status, text);
            
            let errorMessage = `[è«‹æ±‚å¤±æ•— ${res.status}] `;
            try {
              const errorData = JSON.parse(text);
              if (errorData.error) {
                errorMessage += errorData.error;
                if (errorData.error.includes('GEMINI_API_KEY')) {
                  errorMessage += '\n\nğŸ’¡ è§£æ±ºæ–¹æ¡ˆï¼šè«‹åœ¨ Zeabur å¾Œç«¯æœå‹™çš„ç’°å¢ƒè®Šæ•¸ä¸­è¨­å®š GEMINI_API_KEY';
                }
              } else {
                errorMessage += text || 'ç„¡å›æ‡‰å…§å®¹';
              }
            } catch {
              errorMessage += text || 'ç„¡å›æ‡‰å…§å®¹';
            }
            
            updateAssistantNode(assistantNode, errorMessage);
            return;
          }

          const reader = res.body.getReader();
          const decoder = new TextDecoder('utf-8');
          let aiText = '';
          let buffer = '';

          while (true) {
            const { value, done } = await reader.read();
            if (done) break;
            buffer += decoder.decode(value, { stream: true });

            let idx;
            while ((idx = buffer.indexOf('\n\n')) !== -1) {
              const frame = buffer.slice(0, idx).trim();
              buffer = buffer.slice(idx + 2);
              if (!frame.startsWith('data:')) continue;
              try {
                const jsonStr = frame.slice(5).trim();
                const evt = JSON.parse(jsonStr);
                if (evt.type === 'token') {
                  // ç§»é™¤è¼‰å…¥å‹•ç•«ï¼Œé–‹å§‹é¡¯ç¤º AI å›è¦†
                  const loadingDiv = assistantNode.bubble.querySelector('.loading');
                  if (loadingDiv) {
                    loadingDiv.remove();
                  }
                  aiText += evt.content;
                  updateAssistantNode(assistantNode, aiText);
                } else if (evt.type === 'end') {
                  history.push({ role: 'user', content: message });
                  history.push({ role: 'assistant', content: aiText });
                  try { await recordConversationMessage('ai_advisor', 'assistant', aiText); } catch (_) {}
                  
                  // æª¢æŸ¥æ˜¯å¦åŒ…å«è…³æœ¬çµæœï¼Œè‡ªå‹•é¡¯ç¤ºçµæœå€å¡Š
                  checkAndUpdateResults(aiText);
                }
              } catch (e) { /* ignore parse errors */ }
            }
          }
        } catch (e) {
          // ç§»é™¤è¼‰å…¥å‹•ç•«ï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
          const loadingDiv = assistantNode.bubble.querySelector('.loading');
          if (loadingDiv) {
            loadingDiv.remove();
          }
          console.error('è«‹æ±‚éŒ¯èª¤:', e);
          console.error('éŒ¯èª¤è©³æƒ…:', {
            message: e?.message,
            name: e?.name,
            stack: e?.stack,
            endpoint: endpoint,
            location: window.location.href
          });
          
          // æä¾›æ›´è©³ç´°çš„éŒ¯èª¤è¨Šæ¯
          let errorMsg = `[éŒ¯èª¤] ${e?.message || e}`;
          if (e?.name === 'TypeError' && e?.message.includes('fetch')) {
            errorMsg = '[é€£ç·šéŒ¯èª¤] ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦';
          } else if (e?.name === 'TypeError' && e?.message.includes('Failed to fetch')) {
            errorMsg = '[ç¶²è·¯éŒ¯èª¤] è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–é‡æ–°æ•´ç†é é¢';
          } else if (e?.message?.includes('CORS')) {
            errorMsg = '[è·¨åŸŸéŒ¯èª¤] è«‹å˜—è©¦é‡æ–°æ•´ç†é é¢';
          }
          
          // æ·»åŠ æ›´å¤šèª¿è©¦ä¿¡æ¯
          errorMsg += `\n\nèª¿è©¦ä¿¡æ¯ï¼š\nç«¯é»: ${endpoint}\nä½ç½®: ${window.location.href}`;
          updateAssistantNode(assistantNode, errorMsg);
        } finally {
          sendBtn.disabled = false;
          isSending = false;
          statusEl.textContent = '';
        }
      }

      // é€™äº›äº‹ä»¶ç›£è½å™¨å·²ç¶“åœ¨æ–°çš„ DOMContentLoaded ä¸­è™•ç†

      // è¨­å®šå€å¡Šæ‘ºç–Š/å±•é–‹åŠŸèƒ½
      // è¨­å®šå€å¡Šæ‘ºç–Š/å±•é–‹åŠŸèƒ½å·²ç§»é™¤

      // é€™å€‹äº‹ä»¶ç›£è½å™¨å·²ç¶“åœ¨æ–°çš„ DOMContentLoaded ä¸­è™•ç†

      function updateBadge(badgeEl, label, value) {
        if (value) {
          badgeEl.style.display = 'inline-block';
          badgeEl.textContent = label + 'ï¼š' + value;
        } else {
          badgeEl.style.display = 'none';
          badgeEl.textContent = '';
        }
      }

      // æ¸¬è©¦é€£ç·šåŠŸèƒ½
      async function testConnection() {
        const testNode = append('assistant', 'ğŸ”§ æ­£åœ¨æ¸¬è©¦é€£ç·š...');
        
        try {
          // æ¸¬è©¦å¾Œç«¯æ ¹è·¯å¾‘
          const rootResponse = await fetch('https://aivideobackend.zeabur.app/');
          const rootText = await rootResponse.text();
          
          let testResult = `ğŸ” é€£ç·šæ¸¬è©¦çµæœï¼š\n\n`;
          testResult += `1ï¸âƒ£ å¾Œç«¯æ ¹è·¯å¾‘ï¼š${rootResponse.ok ? 'âœ… æ­£å¸¸' : 'âŒ ç•°å¸¸'} (ç‹€æ…‹ç¢¼: ${rootResponse.status})\n`;
          
          // æ¸¬è©¦å¥åº·æª¢æŸ¥
          try {
            const healthResponse = await fetch('https://aivideobackend.zeabur.app/api/health');
            const healthData = await healthResponse.json();
            
            testResult += `2ï¸âƒ£ å¥åº·æª¢æŸ¥ï¼š${healthResponse.ok ? 'âœ… æ­£å¸¸' : 'âŒ ç•°å¸¸'}\n`;
            testResult += `   - çŸ¥è­˜åº«ï¼š${healthData.kb_status}\n`;
            testResult += `   - Geminié…ç½®ï¼š${healthData.gemini_configured ? 'âœ… å·²é…ç½®' : 'âŒ æœªé…ç½®'}\n`;
            testResult += `   - Geminiæ¸¬è©¦ï¼š${healthData.gemini_test}\n`;
            testResult += `   - æ¨¡å‹ï¼š${healthData.model_name}\n`;
            
            if (!healthData.gemini_configured) {
              testResult += `\nâš ï¸ å•é¡Œï¼šGemini API Key æœªé…ç½®\n`;
              testResult += `ğŸ’¡ è§£æ±ºæ–¹æ¡ˆï¼šè«‹åœ¨ Zeabur å¾Œç«¯ç’°å¢ƒè®Šæ•¸ä¸­è¨­å®š GEMINI_API_KEY\n`;
            } else if (healthData.gemini_test !== 'working') {
              testResult += `\nâš ï¸ å•é¡Œï¼šGemini API é€£ç·šç•°å¸¸\n`;
              testResult += `ğŸ’¡ éŒ¯èª¤ï¼š${healthData.gemini_test}\n`;
            }
            
          } catch (healthError) {
            testResult += `2ï¸âƒ£ å¥åº·æª¢æŸ¥ï¼šâŒ ç„¡æ³•é€£ç·š (${healthError.message})\n`;
          }
          
          // æ¸¬è©¦èŠå¤©API
          try {
            const chatResponse = await fetch('https://aivideobackend.zeabur.app/api/chat/stream', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ message: 'test', platform: null, topic: null, duration: '30' })
            });
            
            testResult += `3ï¸âƒ£ èŠå¤©APIï¼š${chatResponse.ok ? 'âœ… æ­£å¸¸' : 'âŒ ç•°å¸¸'} (ç‹€æ…‹ç¢¼: ${chatResponse.status})\n`;
            
            if (!chatResponse.ok) {
              const errorText = await chatResponse.text();
              testResult += `   éŒ¯èª¤ï¼š${errorText}\n`;
            }
            
          } catch (chatError) {
            testResult += `3ï¸âƒ£ èŠå¤©APIï¼šâŒ ç„¡æ³•é€£ç·š (${chatError.message})\n`;
          }
          
          updateAssistantNode(testNode, testResult);
          
        } catch (error) {
          updateAssistantNode(testNode, `âŒ é€£ç·šæ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
        }
      }

      // æ¸¬è©¦é€£ç·šæŒ‰éˆ•å·²ç§»é™¤

      // æ·»åŠ å…¨å±€æ¸¬è©¦å‡½æ•¸ï¼ˆç”¨æ–¼èª¿è©¦ï¼‰
      window.testDOM = function() {
        console.log('=== DOMå…ƒç´ æ¸¬è©¦ ===');
        console.log('resultTitleEl:', resultTitleEl);
        console.log('resultScriptEl:', resultScriptEl);
        console.log('resultVisualEl:', resultVisualEl);
        console.log('resultCopyEl:', resultCopyEl);
        
        if (resultTitleEl) {
          resultTitleEl.innerHTML = 'æ¸¬è©¦æ¨™é¡Œ';
          console.log('æ¸¬è©¦æ¨™é¡Œè¨­ç½®æˆåŠŸ');
        }
        if (resultScriptEl) {
          resultScriptEl.innerHTML = 'æ¸¬è©¦è…³æœ¬å…§å®¹';
          console.log('æ¸¬è©¦è…³æœ¬å…§å®¹è¨­ç½®æˆåŠŸ');
        }
        if (resultVisualEl) {
          resultVisualEl.innerHTML = 'æ¸¬è©¦ç•«é¢æ„Ÿ';
          console.log('æ¸¬è©¦ç•«é¢æ„Ÿè¨­ç½®æˆåŠŸ');
        }
        if (resultCopyEl) {
          resultCopyEl.innerHTML = 'æ¸¬è©¦ç™¼ä½ˆæ–‡æ¡ˆ';
          console.log('æ¸¬è©¦ç™¼ä½ˆæ–‡æ¡ˆè¨­ç½®æˆåŠŸ');
        }
      };
      
      // æ·»åŠ AIå…§å®¹æ¸¬è©¦å‡½æ•¸
      window.testAIContent = function(aiText) {
        console.log('=== AIå…§å®¹æ¸¬è©¦ ===');
        console.log('æ¸¬è©¦æ–‡æœ¬:', aiText);
        
        const isScript = detectScriptContent(aiText);
        console.log('æ˜¯å¦ç‚ºè…³æœ¬å…§å®¹:', isScript);
        
        if (isScript) {
          const sections = parseAIContent(aiText);
          console.log('è§£æçµæœ:', sections);
          
          // æ›´æ–°DOMå…ƒç´ 
          if (sections.title && resultTitleEl) {
            resultTitleEl.innerHTML = sections.title;
            console.log('âœ… ä¸»é¡Œæ¨™é¡Œå·²è¨­ç½®');
          }
          if (sections.script && resultScriptEl) {
            resultScriptEl.innerHTML = sections.script;
            console.log('âœ… è…³æœ¬å…§å®¹å·²è¨­ç½®');
          }
          if (sections.visual && resultVisualEl) {
            resultVisualEl.innerHTML = sections.visual;
            console.log('âœ… ç•«é¢æ„Ÿå·²è¨­ç½®');
          }
          if (sections.copy && resultCopyEl) {
            resultCopyEl.innerHTML = sections.copy;
            console.log('âœ… ç™¼ä½ˆæ–‡æ¡ˆå·²è¨­ç½®');
          }
          
          // é¡¯ç¤ºçµæœå€å¡Š
          resultsEl.style.display = 'block';
          console.log('âœ… çµæœå€å¡Šå·²é¡¯ç¤º');
        }
      };
      
      // æ·»åŠ å¼·åˆ¶æ›´æ–°å‡½æ•¸
      window.forceUpdateResults = function() {
        console.log('=== å¼·åˆ¶æ›´æ–°çµæœå€å¡Š ===');
        
        // å¾èŠå¤©è¨˜éŒ„ä¸­ç²å–æœ€å¾Œä¸€æ¢AIå›æ‡‰
        const chatMessages = document.querySelectorAll('.message.ai');
        if (chatMessages.length > 0) {
          const lastAIMessage = chatMessages[chatMessages.length - 1];
          const aiText = lastAIMessage.textContent || lastAIMessage.innerText;
          
          console.log('ç²å–AIæ–‡æœ¬:', aiText.substring(0, 200) + '...');
          
          const isScript = detectScriptContent(aiText);
          console.log('æ˜¯å¦ç‚ºè…³æœ¬å…§å®¹:', isScript);
          
          if (isScript) {
            const sections = parseAIContent(aiText);
            console.log('è§£æçµæœ:', sections);
            
            // å¼·åˆ¶æ›´æ–°DOMå…ƒç´ 
            if (resultTitleEl) {
              resultTitleEl.innerHTML = sections.title || 'æœªæ‰¾åˆ°ä¸»é¡Œæ¨™é¡Œ';
              console.log('âœ… ä¸»é¡Œæ¨™é¡Œå·²å¼·åˆ¶è¨­ç½®');
            }
            if (resultScriptEl) {
              resultScriptEl.innerHTML = sections.script || 'æœªæ‰¾åˆ°è…³æœ¬å…§å®¹';
              console.log('âœ… è…³æœ¬å…§å®¹å·²å¼·åˆ¶è¨­ç½®');
            }
            if (resultVisualEl) {
              resultVisualEl.innerHTML = sections.visual || 'æœªæ‰¾åˆ°ç•«é¢æ„Ÿ';
              console.log('âœ… ç•«é¢æ„Ÿå·²å¼·åˆ¶è¨­ç½®');
            }
            if (resultCopyEl) {
              resultCopyEl.innerHTML = sections.copy || 'æœªæ‰¾åˆ°ç™¼ä½ˆæ–‡æ¡ˆ';
              console.log('âœ… ç™¼ä½ˆæ–‡æ¡ˆå·²å¼·åˆ¶è¨­ç½®');
            }
            
            // é¡¯ç¤ºçµæœå€å¡Š
            resultsEl.style.display = 'block';
            console.log('âœ… çµæœå€å¡Šå·²å¼·åˆ¶é¡¯ç¤º');
          } else {
            console.log('âŒ æª¢æ¸¬å¤±æ•—ï¼Œä¸æ˜¯è…³æœ¬å…§å®¹');
          }
        } else {
          console.log('âŒ æœªæ‰¾åˆ°AIå›æ‡‰');
        }
      };
      
      // æ·»åŠ ç°¡å–®æ¸¬è©¦å‡½æ•¸
      window.testCurrentContent = function() {
        console.log('=== æ¸¬è©¦ç•¶å‰å…§å®¹ ===');
        
        // å¾èŠå¤©è¨˜éŒ„ä¸­ç²å–æœ€å¾Œä¸€æ¢AIå›æ‡‰
        const chatMessages = document.querySelectorAll('.message.ai');
        if (chatMessages.length > 0) {
          const lastAIMessage = chatMessages[chatMessages.length - 1];
          const aiText = lastAIMessage.textContent || lastAIMessage.innerText;
          
          console.log('AIæ–‡æœ¬é•·åº¦:', aiText.length);
          console.log('AIæ–‡æœ¬å‰500å­—ç¬¦:', aiText.substring(0, 500));
          
          // æ¸¬è©¦ä¸»é¡Œæ¨™é¡Œæå–
          const titleMatch = aiText.match(/ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i);
          console.log('ä¸»é¡Œæ¨™é¡ŒåŒ¹é…çµæœ:', titleMatch);
          
          // æ¸¬è©¦è…³æœ¬å…§å®¹æå–
          const scriptMatch = aiText.match(/è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i);
          console.log('è…³æœ¬å…§å®¹åŒ¹é…çµæœ:', scriptMatch ? 'åŒ¹é…' : 'ç„¡åŒ¹é…');
          
          // æ¸¬è©¦ç•«é¢æ„Ÿæå–
          const visualMatch = aiText.match(/ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i);
          console.log('ç•«é¢æ„ŸåŒ¹é…çµæœ:', visualMatch ? 'åŒ¹é…' : 'ç„¡åŒ¹é…');
          
          // æ¸¬è©¦ç™¼ä½ˆæ–‡æ¡ˆæå–
          const copyMatch = aiText.match(/ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i);
          console.log('ç™¼ä½ˆæ–‡æ¡ˆåŒ¹é…çµæœ:', copyMatch ? 'åŒ¹é…' : 'ç„¡åŒ¹é…');
          
          // ç›´æ¥æ›´æ–°çµæœå€å¡Š
          if (titleMatch && titleMatch[1]) {
            resultTitleEl.innerHTML = cleanMarkdownFormat(titleMatch[1].trim());
            console.log('âœ… ç›´æ¥è¨­ç½®ä¸»é¡Œæ¨™é¡Œ');
          }
          if (scriptMatch && scriptMatch[1]) {
            resultScriptEl.innerHTML = cleanMarkdownFormat(scriptMatch[1].trim());
            console.log('âœ… ç›´æ¥è¨­ç½®è…³æœ¬å…§å®¹');
          }
          if (visualMatch && visualMatch[1]) {
            resultVisualEl.innerHTML = cleanMarkdownFormat(visualMatch[1].trim());
            console.log('âœ… ç›´æ¥è¨­ç½®ç•«é¢æ„Ÿ');
          }
          if (copyMatch && copyMatch[1]) {
            resultCopyEl.innerHTML = cleanMarkdownFormat(copyMatch[1].trim());
            console.log('âœ… ç›´æ¥è¨­ç½®ç™¼ä½ˆæ–‡æ¡ˆ');
          }
          
          // é¡¯ç¤ºçµæœå€å¡Š
          resultsEl.style.display = 'block';
          console.log('âœ… çµæœå€å¡Šå·²é¡¯ç¤º');
        } else {
          console.log('âŒ æœªæ‰¾åˆ°AIå›æ‡‰');
        }
      };
      
      // æ·»åŠ è¶…å¼·åŠ›æ¸¬è©¦å‡½æ•¸
      window.forceExtractContent = function() {
        console.log('=== è¶…å¼·åŠ›å…§å®¹æå– ===');
        
        // å¾èŠå¤©è¨˜éŒ„ä¸­ç²å–æœ€å¾Œä¸€æ¢AIå›æ‡‰
        const chatMessages = document.querySelectorAll('.message.ai');
        if (chatMessages.length > 0) {
          const lastAIMessage = chatMessages[chatMessages.length - 1];
          const aiText = lastAIMessage.textContent || lastAIMessage.innerText;
          
          console.log('AIæ–‡æœ¬é•·åº¦:', aiText.length);
          console.log('AIæ–‡æœ¬å‰1000å­—ç¬¦:', aiText.substring(0, 1000));
          
          // å¼·åˆ¶æå–ä¸»é¡Œæ¨™é¡Œ
          let title = '';
          const titlePatterns = [
            /\*\*ä¸»é¡Œæ¨™é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
            /ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /\d+\.\s*\*\*ä¸»é¡Œæ¨™é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
            /\d+\.\s*ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i
          ];
          
          for (const pattern of titlePatterns) {
            const match = aiText.match(pattern);
            if (match && match[1]) {
              title = cleanMarkdownFormat(match[1].trim());
              console.log('âœ… æ‰¾åˆ°ä¸»é¡Œæ¨™é¡Œ:', title);
              break;
            }
          }
          
          // å¼·åˆ¶æå–è…³æœ¬å…§å®¹
          let script = '';
          const scriptPatterns = [
            /\*\*è…³æœ¬å…§å®¹\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*\*\*è…³æœ¬å…§å®¹\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç•«é¢æ„Ÿ|\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç•«é¢æ„Ÿ|\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i
          ];
          
          for (const pattern of scriptPatterns) {
            const match = aiText.match(pattern);
            if (match && match[1]) {
              script = cleanMarkdownFormat(match[1].trim());
              console.log('âœ… æ‰¾åˆ°è…³æœ¬å…§å®¹:', script.substring(0, 100) + '...');
              break;
            }
          }
          
          // å¼·åˆ¶æå–ç•«é¢æ„Ÿ
          let visual = '';
          const visualPatterns = [
            /\*\*ç•«é¢æ„Ÿ\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*\*\*ç•«é¢æ„Ÿ\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i
          ];
          
          for (const pattern of visualPatterns) {
            const match = aiText.match(pattern);
            if (match && match[1]) {
              visual = cleanMarkdownFormat(match[1].trim());
              console.log('âœ… æ‰¾åˆ°ç•«é¢æ„Ÿ:', visual.substring(0, 100) + '...');
              break;
            }
          }
          
          // å¼·åˆ¶æå–ç™¼ä½ˆæ–‡æ¡ˆ
          let copy = '';
          const copyPatterns = [
            /\*\*ç™¼ä½ˆæ–‡æ¡ˆ\*\*[ï¼š:]\s*([\s\S]*?)$/i,
            /ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
            /\d+\.\s*\*\*ç™¼ä½ˆæ–‡æ¡ˆ\*\*[ï¼š:]\s*([\s\S]*?)$/i,
            /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i
          ];
          
          for (const pattern of copyPatterns) {
            const match = aiText.match(pattern);
            if (match && match[1]) {
              copy = cleanMarkdownFormat(match[1].trim());
              console.log('âœ… æ‰¾åˆ°ç™¼ä½ˆæ–‡æ¡ˆ:', copy.substring(0, 100) + '...');
              break;
            }
          }
          
          // å¼·åˆ¶æ›´æ–°çµæœå€å¡Š
          if (title) {
            resultTitleEl.innerHTML = title;
            console.log('âœ… å¼·åˆ¶è¨­ç½®ä¸»é¡Œæ¨™é¡Œ');
          }
          if (script) {
            resultScriptEl.innerHTML = script;
            console.log('âœ… å¼·åˆ¶è¨­ç½®è…³æœ¬å…§å®¹');
          }
          if (visual) {
            resultVisualEl.innerHTML = visual;
            console.log('âœ… å¼·åˆ¶è¨­ç½®ç•«é¢æ„Ÿ');
          }
          if (copy) {
            resultCopyEl.innerHTML = copy;
            console.log('âœ… å¼·åˆ¶è¨­ç½®ç™¼ä½ˆæ–‡æ¡ˆ');
          }
          
          // é¡¯ç¤ºçµæœå€å¡Š
          resultsEl.style.display = 'block';
          console.log('âœ… çµæœå€å¡Šå·²å¼·åˆ¶é¡¯ç¤º');
          
          // å¦‚æœé‚„æ˜¯æ²’æœ‰å…§å®¹ï¼Œé¡¯ç¤ºåŸå§‹æ–‡æœ¬
          if (!title && !script && !visual && !copy) {
            console.log('âš ï¸ æ‰€æœ‰æå–éƒ½å¤±æ•—ï¼Œé¡¯ç¤ºåŸå§‹æ–‡æœ¬');
            resultTitleEl.innerHTML = 'åŸå§‹AIå›æ‡‰';
            resultScriptEl.innerHTML = aiText.substring(0, 500) + '...';
            resultVisualEl.innerHTML = 'è«‹æª¢æŸ¥æ§åˆ¶å°æ—¥èªŒ';
            resultCopyEl.innerHTML = 'è§£æå¤±æ•—';
          }
        } else {
          console.log('âŒ æœªæ‰¾åˆ°AIå›æ‡‰');
        }
      };
      // æ·»åŠ çµ‚æ¥µè§£æ±ºæ–¹æ¡ˆï¼šç›´æ¥å¾é é¢æå–
      window.extractFromPage = function() {
        console.log('=== çµ‚æ¥µè§£æ±ºæ–¹æ¡ˆï¼šå¾é é¢ç›´æ¥æå– ===');
        
        // æ–¹æ³•1ï¼šå¾èŠå¤©è¨˜éŒ„ä¸­æå–
        const chatMessages = document.querySelectorAll('.message.ai');
        if (chatMessages.length > 0) {
          const lastAIMessage = chatMessages[chatMessages.length - 1];
          const aiText = lastAIMessage.textContent || lastAIMessage.innerText;
          
          console.log('å¾èŠå¤©è¨˜éŒ„æå–ï¼Œæ–‡æœ¬é•·åº¦:', aiText.length);
          
          // ç°¡å–®ç²—æš´çš„æå–æ–¹æ³•
          const lines = aiText.split('\n').filter(line => line.trim().length > 0);
          console.log('ç¸½è¡Œæ•¸:', lines.length);
          
          let title = '';
          let script = '';
          let visual = '';
          let copy = '';
          
          // é€è¡Œæƒæï¼Œæ‰¾åˆ°é—œéµè©å°±æå–
          for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            
            // æå–ä¸»é¡Œæ¨™é¡Œ
            if (line.includes('ä¸»é¡Œæ¨™é¡Œ') && line.includes('ï¼š')) {
              const match = line.match(/ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*(.+)/i);
              if (match && match[1]) {
                title = cleanMarkdownFormat(match[1].trim());
                console.log('âœ… æ‰¾åˆ°ä¸»é¡Œæ¨™é¡Œ:', title);
              }
            }
            
            // æå–è…³æœ¬å…§å®¹
            if (line.includes('è…³æœ¬å…§å®¹') && line.includes('ï¼š')) {
              let scriptLines = [];
              for (let j = i + 1; j < lines.length; j++) {
                const nextLine = lines[j].trim();
                if (nextLine.includes('ç•«é¢æ„Ÿ') || nextLine.includes('ç™¼ä½ˆæ–‡æ¡ˆ') || nextLine.includes('3.') || nextLine.includes('4.')) {
                  break;
                }
                if (nextLine.length > 0) {
                  scriptLines.push(nextLine);
                }
              }
              if (scriptLines.length > 0) {
                script = cleanMarkdownFormat(scriptLines.join('\n'));
                console.log('âœ… æ‰¾åˆ°è…³æœ¬å…§å®¹:', script.substring(0, 100) + '...');
              }
            }
            
            // æå–ç•«é¢æ„Ÿ
            if (line.includes('ç•«é¢æ„Ÿ') && line.includes('ï¼š')) {
              let visualLines = [];
              for (let j = i + 1; j < lines.length; j++) {
                const nextLine = lines[j].trim();
                if (nextLine.includes('ç™¼ä½ˆæ–‡æ¡ˆ') || nextLine.includes('4.')) {
                  break;
                }
                if (nextLine.length > 0) {
                  visualLines.push(nextLine);
                }
              }
              if (visualLines.length > 0) {
                visual = cleanMarkdownFormat(visualLines.join('\n'));
                console.log('âœ… æ‰¾åˆ°ç•«é¢æ„Ÿ:', visual.substring(0, 100) + '...');
              }
            }
            
            // æå–ç™¼ä½ˆæ–‡æ¡ˆ
            if (line.includes('ç™¼ä½ˆæ–‡æ¡ˆ') && line.includes('ï¼š')) {
              let copyLines = [];
              for (let j = i + 1; j < lines.length; j++) {
                const nextLine = lines[j].trim();
                if (nextLine.length > 0) {
                  copyLines.push(nextLine);
                }
              }
              if (copyLines.length > 0) {
                copy = cleanMarkdownFormat(copyLines.join('\n'));
                console.log('âœ… æ‰¾åˆ°ç™¼ä½ˆæ–‡æ¡ˆ:', copy.substring(0, 100) + '...');
              }
            }
          }
          
          // æ›´æ–°çµæœå€å¡Š
          if (title) {
            resultTitleEl.innerHTML = title;
            console.log('âœ… è¨­ç½®ä¸»é¡Œæ¨™é¡Œ');
          }
          if (script) {
            resultScriptEl.innerHTML = script;
            console.log('âœ… è¨­ç½®è…³æœ¬å…§å®¹');
          }
          if (visual) {
            resultVisualEl.innerHTML = visual;
            console.log('âœ… è¨­ç½®ç•«é¢æ„Ÿ');
          }
          if (copy) {
            resultCopyEl.innerHTML = copy;
            console.log('âœ… è¨­ç½®ç™¼ä½ˆæ–‡æ¡ˆ');
          }
          
          // é¡¯ç¤ºçµæœå€å¡Š
          resultsEl.style.display = 'block';
          console.log('âœ… çµæœå€å¡Šå·²é¡¯ç¤º');
          
          // å¦‚æœé‚„æ˜¯æ²’æœ‰å…§å®¹ï¼Œé¡¯ç¤ºåŸå§‹æ–‡æœ¬
          if (!title && !script && !visual && !copy) {
            console.log('âš ï¸ æ‰€æœ‰æå–éƒ½å¤±æ•—ï¼Œé¡¯ç¤ºåŸå§‹æ–‡æœ¬');
            resultTitleEl.innerHTML = 'åŸå§‹AIå›æ‡‰';
            resultScriptEl.innerHTML = aiText.substring(0, 500) + '...';
            resultVisualEl.innerHTML = 'è«‹æª¢æŸ¥æ§åˆ¶å°æ—¥èªŒ';
            resultCopyEl.innerHTML = 'è§£æå¤±æ•—';
          }
        } else {
          console.log('âŒ æœªæ‰¾åˆ°AIå›æ‡‰');
        }
      };

      // å¿«é€ŸæŒ‰éˆ•åŠŸèƒ½å·²ç§»åˆ° DOMContentLoaded äº‹ä»¶ä¸­

      // æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦è¦æ±‚ç”Ÿæˆè…³æœ¬
      function checkIfScriptRequest(aiText) {
        console.log('=== æª¢æŸ¥æ˜¯å¦ç‚ºè…³æœ¬ç”Ÿæˆè«‹æ±‚ ===');
        
        // æª¢æŸ¥AIå›æ‡‰ä¸­æ˜¯å¦åŒ…å«è…³æœ¬ç”Ÿæˆç›¸é—œçš„é—œéµè©
        const scriptRequestKeywords = [
          'çŸ­å½±éŸ³è…³æœ¬',
          'ç”Ÿæˆè…³æœ¬',
          'è…³æœ¬ç”Ÿæˆ',
          'è…³æœ¬å…§å®¹',
          'ä¸»é¡Œæ¨™é¡Œ',
          'ç•«é¢æ„Ÿ',
          'ç™¼ä½ˆæ–‡æ¡ˆ',
          'Hook',
          'Value',
          'CTA',
          'çŸ­å½±éŸ³',
          'è…³æœ¬',
          'Reels',
          'TikTok',
          'å°ç´…æ›¸'
        ];
        
        const hasScriptKeywords = scriptRequestKeywords.some(keyword => 
          aiText.toLowerCase().includes(keyword.toLowerCase())
        );
        
        // æª¢æŸ¥æ˜¯å¦åŒ…å«è…³æœ¬çµæ§‹æ¨™è¨˜
        const hasScriptStructure = [
          /ä¸»é¡Œæ¨™é¡Œ[ï¼š:]/i,
          /è…³æœ¬å…§å®¹[ï¼š:]/i,
          /ç•«é¢æ„Ÿ[ï¼š:]/i,
          /ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]/i,
          /\d+\.\s*ä¸»é¡Œæ¨™é¡Œ/i,
          /\d+\.\s*è…³æœ¬å…§å®¹/i,
          /\d+\.\s*ç•«é¢æ„Ÿ/i,
          /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ/i,
          /Hook\s*\(\d+-\d+ç§’\)/i,
          /Value\s*\d+\s*\(\d+-\d+ç§’\)/i,
          /CTA\s*\(\d+-\d+ç§’\)/i
        ].some(pattern => pattern.test(aiText));
        
        const isScriptRequest = hasScriptKeywords || hasScriptStructure;
        
        console.log('åŒ…å«è…³æœ¬é—œéµè©:', hasScriptKeywords);
        console.log('åŒ…å«è…³æœ¬çµæ§‹:', hasScriptStructure);
        console.log('åˆ¤æ–·ç‚ºè…³æœ¬è«‹æ±‚:', isScriptRequest);
        
        return isScriptRequest;
      }

      // ====== é•·æœŸè¨˜æ†¶èˆ‡æœƒè©±ï¼šæœ€å°å¢é‡å¯¦ä½œï¼ˆä¸å½±éŸ¿æ—¢æœ‰åŠŸèƒ½ï¼‰ ======
      function getCurrentSessionId(conversationType) {
        const key = `session_${conversationType}`;
        let sid = localStorage.getItem(key);
        if (!sid) {
          sid = `${conversationType}_${Date.now().toString(36)}_${Math.random().toString(36).slice(2, 8)}`;
          localStorage.setItem(key, sid);
        }
        return sid;
      }

      async function recordConversationMessage(conversationType, role, content) {
        try {
          if (!content) return;
          // å…¼å®¹èˆŠè³‡æ–™ï¼šè‹¥ user_id æœªå°±ç·’ä½†æœ‰ idï¼Œæˆ–å®Œå…¨æ²’æœ‰å‰‡è‡¨æ™‚ç”¢ç”Ÿ
          if (!ipPlanningUser) ipPlanningUser = {};
          if (!ipPlanningUser.user_id) {
            if (ipPlanningUser.id) {
              ipPlanningUser.user_id = ipPlanningUser.id;
            } else if (typeof generateUserId === 'function') {
              ipPlanningUser.user_id = generateUserId();
            }
            try { localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser)); } catch(_) {}
          }
          const sessionId = getCurrentSessionId(conversationType);
          const res = await fetch('https://aivideobackend.zeabur.app/api/memory/long-term', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              ...(ipPlanningToken ? { 'Authorization': `Bearer ${ipPlanningToken}` } : {})
            },
            body: JSON.stringify({
              conversation_type: conversationType,
              session_id: sessionId,
              message_role: role,
              message_content: content
            })
          });
          if (!res.ok && res.status !== 422) {
            // ä¸è™•ç† 422ï¼Œå…¶ä»–éŒ¯èª¤å˜—è©¦åˆ·æ–°
            if (res.status === 401) {
              const ok = await tryRefreshTokenSafe();
              if (ok) return recordConversationMessage(conversationType, role, content);
            }
            console.warn('è¨˜æ†¶å„²å­˜å¤±æ•—:', res.status);
          }
        } catch (_) { /* éœé»˜å¤±æ•—ï¼Œä¸å½±éŸ¿ä½¿ç”¨è€…é«”é©— */ }
      }

      // æª¢æŸ¥ token æ˜¯å¦å·²éæœŸ
      function isTokenExpired(token) {
        if (!token) return true;
        try {
          // è§£æ JWT tokenï¼ˆç°¡å–®æ ¼å¼ï¼šheader.payload.signatureï¼‰
          const parts = token.split('.');
          if (parts.length !== 3) return true;
          
          // è§£ç¢¼ payload
          const payload = JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/')));
          
          // æª¢æŸ¥éæœŸæ™‚é–“
          if (payload.exp) {
            const now = Math.floor(Date.now() / 1000);
            return payload.exp < now; // å·²éæœŸ
          }
          return true; // å¦‚æœæ²’æœ‰ expï¼Œèªç‚ºå·²éæœŸ
        } catch (e) {
          console.error('æª¢æŸ¥ token éæœŸæ™‚å‡ºéŒ¯:', e);
          return true; // å¦‚æœç„¡æ³•è§£æï¼Œè¦–ç‚ºéæœŸ
        }
      }

      // æª¢æŸ¥ token æ˜¯å¦å³å°‡éæœŸæˆ–å·²éæœŸ
      function isTokenExpiringSoon(token) {
        if (!token) return true;
        try {
          // è§£æ JWT tokenï¼ˆç°¡å–®æ ¼å¼ï¼šheader.payload.signatureï¼‰
          const parts = token.split('.');
          if (parts.length !== 3) return true;
          
          // è§£ç¢¼ payload
          const payload = JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/')));
          
          // æª¢æŸ¥éæœŸæ™‚é–“
          if (payload.exp) {
            const now = Math.floor(Date.now() / 1000);
            const expiresIn = payload.exp - now;
            // å¦‚æœå·²ç¶“éæœŸï¼Œæˆ–å°‡åœ¨ 5 åˆ†é˜å…§éæœŸï¼Œå‰‡è¿”å› true
            return expiresIn < 300; // 5 åˆ†é˜ = 300 ç§’
          }
          return true; // å¦‚æœæ²’æœ‰ expï¼Œèªç‚ºå·²éæœŸ
        } catch (e) {
          // è§£æå¤±æ•—ï¼Œèªç‚ºå·²éæœŸ
          return true;
        }
      }

      // å¼·åˆ¶ç™»å‡ºä¸¦æ¸…é™¤æ‰€æœ‰ç‹€æ…‹
      function forceLogout(reason = 'ç™»å…¥å·²éæœŸï¼Œè«‹é‡æ–°ç™»å…¥') {
        // æ¸…é™¤ token å’Œç”¨æˆ¶è³‡æ–™
        ipPlanningToken = null;
        ipPlanningUser = null;
        localStorage.removeItem('ipPlanningToken');
        localStorage.removeItem('ipPlanningUser');
        localStorage.removeItem('subscriptionStatus');
        
        // æ›´æ–° UI
        updateAuthUI(false);
        showLoginButton();
        
        // é¡¯ç¤ºæç¤º
        showToast(reason || 'ç™»å…¥å·²éæœŸï¼Œè«‹é‡æ–°ç™»å…¥', 5000);
        
        // é—œé–‰ç”¨æˆ¶æŠ½å±œ
        closeUserDrawer();
        
        // æ›´æ–°è¨‚é–±ç‹€æ…‹
        document.body.dataset.subscribed = 'false';
        
        console.log('å·²è‡ªå‹•ç™»å‡º:', reason);
      }

      // ä¸»å‹•åˆ·æ–° tokenï¼ˆåœ¨é é¢è¼‰å…¥æ™‚èª¿ç”¨ï¼‰
      async function proactiveRefreshToken() {
        if (!ipPlanningToken || !ipPlanningUser) return false;
        
        // æª¢æŸ¥ token æ˜¯å¦å³å°‡éæœŸ
        if (!isTokenExpiringSoon(ipPlanningToken)) {
          return false; // token é‚„æœ‰æ•ˆï¼Œä¸éœ€è¦åˆ·æ–°
        }
        
        console.log('Token å³å°‡éæœŸæˆ–å·²éæœŸï¼Œå˜—è©¦åˆ·æ–°...');
        return await tryRefreshTokenSafe();
      }

      async function tryRefreshTokenSafe() {
        // é˜²æ­¢é‡è¤‡åˆ·æ–°ï¼šå¦‚æœæ­£åœ¨åˆ·æ–°æˆ–æœ€è¿‘ 30 ç§’å…§å˜—è©¦éï¼Œç›´æ¥è¿”å›
        if (isRefreshingToken) {
          return false;
        }
        
        const now = Date.now();
        if (lastRefreshAttempt > 0 && (now - lastRefreshAttempt) < 30000) {
          // 30 ç§’å…§å˜—è©¦éï¼Œç›´æ¥è¿”å›ä¸Šæ¬¡çµæœ
          return false;
        }
        
        try {
          if (!ipPlanningToken) return false;
          
          isRefreshingToken = true;
          lastRefreshAttempt = now;
          
          // å¦‚æœ token å·²ç¶“éæœŸï¼Œå¯èƒ½ç„¡æ³•é€šéé©—è­‰ï¼Œä½†ä»å˜—è©¦åˆ·æ–°
          const r = await fetch('https://aivideobackend.zeabur.app/api/auth/refresh', {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${ipPlanningToken}` }
          });
          
          if (!r.ok) {
            // 401 ä»£è¡¨ refresh å¤±æ•ˆï¼ˆtoken å·²éæœŸä¸”ç„¡æ³•åˆ·æ–°ï¼‰
            // å˜—è©¦å¾å›æ‡‰ä¸­ç²å–éŒ¯èª¤è¨Šæ¯
            let errorMessage = 'ç™»å…¥å·²éæœŸï¼Œè«‹é‡æ–°ç™»å…¥';
            try {
              const errorData = await r.clone().json();
              if (errorData.detail) {
                errorMessage = errorData.detail;
              }
            } catch (e) {
              // å¦‚æœç„¡æ³•è§£æ JSONï¼Œä½¿ç”¨é è¨­è¨Šæ¯
            }
            
            // Token ç„¡æ³•åˆ·æ–°ï¼Œå¼·åˆ¶ç™»å‡º
            isRefreshingToken = false;
            forceLogout(errorMessage);
            return false;
          }
          
          const data = await r.json();
          if (data?.access_token) {
            ipPlanningToken = data.access_token;
            localStorage.setItem('ipPlanningToken', ipPlanningToken);
            isRefreshingToken = false;
            lastRefreshAttempt = 0; // æˆåŠŸå¾Œé‡ç½®
            return true;
          }
          
          isRefreshingToken = false;
          return false;
        } catch (error) {
          // ç¶²è·¯éŒ¯èª¤ï¼šå¦‚æœæ˜¯ç¶²è·¯éŒ¯èª¤ï¼Œä¸ç™»å‡ºï¼ˆå¯èƒ½æ˜¯æš«æ™‚çš„é€£ç·šå•é¡Œï¼‰
          if (error.name === 'TypeError' && error.message.includes('fetch')) {
            isRefreshingToken = false;
            return false;
          }
          
          // å…¶ä»–éŒ¯èª¤ï¼šå¼·åˆ¶ç™»å‡º
          isRefreshingToken = false;
          forceLogout('åˆ·æ–°ç™»å…¥ç‹€æ…‹å¤±æ•—ï¼Œè«‹é‡æ–°ç™»å…¥');
          return false;
        }
      }

      // æœƒè©±èˆ‡æ­·å²ï¼šåƒ…æä¾›æœ€å°å¯ç”¨ APIï¼ˆå¯ç”± UI è§¸ç™¼ï¼‰
      async function getSessionList(conversationType) {
        if (!ipPlanningUser?.user_id) {
          console.warn('å°šæœªå»ºç«‹ user_idï¼Œè·³éæœƒè©±åˆ—è¡¨');
          return [];
        }
        try {
          const res = await fetch(`https://aivideobackend.zeabur.app/api/memory/sessions?conversation_type=${encodeURIComponent(conversationType)}`, {
            headers: ipPlanningToken ? { 'Authorization': `Bearer ${ipPlanningToken}` } : {}
          });
          if (res.ok) return (await res.json()).sessions || [];
          // 401 ä»£è¡¨èªè­‰å¤±æ•—æˆ– API ç«¯é»ä¸å­˜åœ¨ï¼Œéœé»˜è¿”å›ç©ºé™£åˆ—
          if (res.status === 401 || res.status === 404) {
            return [];
          }
        } catch (_) {}
        return [];
      }

      async function loadChatHistory(conversationType, sessionId) {
        if (!ipPlanningUser?.user_id) {
          console.warn('å°šæœªå»ºç«‹ user_idï¼Œè·³éæ­·å²è¼‰å…¥');
          return [];
        }
        try {
          const url = new URL('https://aivideobackend.zeabur.app/api/memory/long-term');
          url.searchParams.set('conversation_type', conversationType);
          if (sessionId) url.searchParams.set('session_id', sessionId);
          const res = await fetch(url.toString(), {
            headers: ipPlanningToken ? { 'Authorization': `Bearer ${ipPlanningToken}` } : {}
          });
          if (res.ok) return (await res.json()).records || [];
          // 401/404 ä»£è¡¨èªè­‰å¤±æ•—æˆ– API ç«¯é»ä¸å­˜åœ¨ï¼Œéœé»˜è¿”å›ç©ºé™£åˆ—
          if (res.status === 401 || res.status === 404) {
            return [];
          }
        } catch (_) {}
        return [];
      }

      // å°‡æ­·å²è¨Šæ¯å›çŒåˆ°èŠå¤©å€ï¼ˆä¸å½±éŸ¿ç¾æœ‰è¨Šæ¯æ¨£å¼ï¼‰
      function renderHistoryToChat(records) {
        const chat = document.getElementById('chatMessages');
        if (!chat || !Array.isArray(records)) return;
        chat.innerHTML = '';
        const byTime = [...records].sort((a,b) => new Date(a.created_at||0) - new Date(b.created_at||0));
        byTime.forEach(r => {
          const role = r.message_role === 'assistant' ? 'assistant' : 'user';
          // å„ªå…ˆä½¿ç”¨ ChatGPT é¢¨æ ¼è¨Šæ¯
          if (typeof createChatGPTMessage === 'function') {
            const node = createChatGPTMessage(role, r.message_content || '');
            chat.appendChild(node);
          } else {
            // å¾Œå‚™æ¨£å¼ï¼ˆAI é¡§å•æ¨£å¼ï¼‰
            const div = document.createElement('div');
            div.className = 'msg ' + (role === 'assistant' ? 'assistant' : 'user');
            const bubble = document.createElement('div');
            bubble.className = 'msg-bubble';
            bubble.textContent = r.message_content || '';
            div.appendChild(bubble);
            chat.appendChild(div);
          }
        });
        // æ²åˆ°æœ€åº•
        chat.scrollTop = chat.scrollHeight;
      }

      // å‹•æ…‹æ’å…¥æ¥µç°¡æœƒè©±UIï¼ˆä¸æ”¹å‹•æ—¢æœ‰ HTMLï¼‰
      document.addEventListener('DOMContentLoaded', () => {
        const inject = (pageId, type) => {
          const page = document.getElementById(pageId);
          if (!page || page.querySelector('.session-mini')) return;
          const box = document.createElement('div');
          box.className = 'session-mini';
          box.style.cssText = 'margin:12px 0 8px;padding:8px;border:1px solid #e5e7eb;border-radius:8px;background:#f8fafc;display:flex;gap:8px;flex-wrap:wrap;';
          box.innerHTML = `
            <button id="${pageId}-new" style="padding:6px 10px;border:1px solid #cbd5e1;border-radius:6px;background:white;cursor:pointer;">ğŸ†• æ–°æœƒè©±</button>
            <button id="${pageId}-list" style="padding:6px 10px;border:1px solid #cbd5e1;border-radius:6px;background:white;cursor:pointer;">ğŸ“‹ æœƒè©±åˆ—è¡¨</button>
            <button id="${pageId}-load" style="padding:6px 10px;border:1px solid #cbd5e1;border-radius:6px;background:white;cursor:pointer;">ğŸ”„ è¼‰å…¥æœ¬æœƒè©±</button>
          `;
          const container = page.querySelector('.page') || page; // ä¿å®ˆæ’å…¥
          container.insertBefore(box, container.firstChild);
          document.getElementById(`${pageId}-new`).onclick = () => {
            localStorage.removeItem(`session_${type}`);
            showToast('å·²å»ºç«‹æ–°æœƒè©±');
          };
          document.getElementById(`${pageId}-list`).onclick = async () => {
            const list = await getSessionList(type);
            if (!list.length) { alert('å°šç„¡æœƒè©±'); return; }
            const lines = list.map((s, i) => `${i+1}. ${s.session_id}  (${s.count||0})`).join('\n');
            const pick = prompt(`é¸æ“‡è¦è¼‰å…¥çš„æœƒè©±åºè™Ÿ:\n${lines}\n\nè¼¸å…¥æ•¸å­—ï¼š`);
            const idx = Number(pick) - 1;
            if (!Number.isFinite(idx) || idx < 0 || idx >= list.length) return;
            const chosen = list[idx]?.session_id;
            const records = await loadChatHistory(type, chosen);
            renderHistoryToChat(records);
            showToast(`å·²è¼‰å…¥ ${records.length} ç­†æ­·å²`);
          };
          document.getElementById(`${pageId}-load`).onclick = async () => {
            const sid = getCurrentSessionId(type);
            const records = await loadChatHistory(type, sid);
            renderHistoryToChat(records);
            showToast(`å·²è¼‰å…¥ ${records.length} ç­†æ­·å²`);
          };
        };
        inject('mode2', 'ai_advisor');
        inject('mode3', 'ip_planning');
      });

      function checkAndUpdateResults(aiText) {
        console.log('=== é–‹å§‹è§£æAIå›æ‡‰ ===');
        console.log('AIå›æ‡‰é•·åº¦:', aiText.length);
        console.log('AIå›æ‡‰å‰300å­—ç¬¦:', aiText.substring(0, 300));
        
        // æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦è¦æ±‚ç”Ÿæˆè…³æœ¬ï¼ˆåªæœ‰é€™ç¨®æƒ…æ³æ‰é¡¯ç¤ºè…³æœ¬çµæœå€å¡Šï¼‰
        const isScriptRequest = checkIfScriptRequest(aiText);
        console.log('æ˜¯å¦ç‚ºè…³æœ¬ç”Ÿæˆè«‹æ±‚:', isScriptRequest);
        
        if (!isScriptRequest) {
          console.log('âŒ ä¸æ˜¯è…³æœ¬ç”Ÿæˆè«‹æ±‚ï¼Œä¸é¡¯ç¤ºè…³æœ¬çµæœå€å¡Š');
          return;
        }
        
        // æ›´ç²¾ç¢ºçš„è…³æœ¬å…§å®¹æª¢æ¸¬
        const isScriptContent = detectScriptContent(aiText);
        
        console.log('æ˜¯å¦ç‚ºè…³æœ¬å…§å®¹:', isScriptContent);
        
        if (isScriptContent) {
          // é¡¯ç¤ºçµæœå€å¡Š
          resultsEl.style.display = 'block';
          console.log('çµæœå€å¡Šå·²é¡¯ç¤ºï¼Œé–‹å§‹è§£æå…§å®¹...');
          
          // ç¢ºä¿DOMå…ƒç´ å­˜åœ¨
          if (!resultTitleEl || !resultScriptEl || !resultVisualEl || !resultCopyEl) {
            console.error('DOMå…ƒç´ ä¸å­˜åœ¨:', {
              resultTitleEl: !!resultTitleEl,
              resultScriptEl: !!resultScriptEl,
              resultVisualEl: !!resultVisualEl,
              resultCopyEl: !!resultCopyEl
            });
            return;
          }
          
          try {
            // ä½¿ç”¨æ›´éˆæ´»çš„è§£ææ–¹æ³•
            const sections = parseAIContent(aiText);
            
            // æ›´æ–°DOMå…ƒç´ 
            if (sections.title) {
              resultTitleEl.innerHTML = sections.title;
              console.log('âœ… ä¸»é¡Œæ¨™é¡Œå·²è¨­ç½®:', sections.title);
            }
            
            if (sections.script) {
              resultScriptEl.innerHTML = sections.script;
              console.log('âœ… è…³æœ¬å…§å®¹å·²è¨­ç½®:', sections.script.substring(0, 100) + '...');
            }
            
            if (sections.visual) {
              resultVisualEl.innerHTML = sections.visual;
              console.log('âœ… ç•«é¢æ„Ÿå·²è¨­ç½®:', sections.visual.substring(0, 100) + '...');
            }
            
            if (sections.copy) {
              resultCopyEl.innerHTML = sections.copy;
              console.log('âœ… ç™¼ä½ˆæ–‡æ¡ˆå·²è¨­ç½®:', sections.copy.substring(0, 100) + '...');
            }
            
            // å»¶é²æª¢æŸ¥å…§å®¹æ˜¯å¦æ­£ç¢ºè¨­ç½®
            setTimeout(() => {
              console.log('=== å»¶é²æª¢æŸ¥DOMå…§å®¹ ===');
              console.log('ä¸»é¡Œæ¨™é¡Œ:', resultTitleEl.innerHTML);
              console.log('è…³æœ¬å…§å®¹:', resultScriptEl.innerHTML.substring(0, 100) + '...');
              console.log('ç•«é¢æ„Ÿ:', resultVisualEl.innerHTML.substring(0, 100) + '...');
              console.log('ç™¼ä½ˆæ–‡æ¡ˆ:', resultCopyEl.innerHTML.substring(0, 100) + '...');
            }, 500);
            
          } catch (e) {
            console.error('è§£æçµæœæ™‚å‡ºéŒ¯:', e);
          }
        } else {
          console.log('æœªæª¢æ¸¬åˆ°è…³æœ¬å…§å®¹ï¼Œä¸é¡¯ç¤ºçµæœå€å¡Š');
        }
      }
      
      // æ–°å¢ï¼šç²¾ç¢ºçš„è…³æœ¬å…§å®¹æª¢æ¸¬å‡½æ•¸
      function detectScriptContent(aiText) {
        console.log('=== é–‹å§‹è…³æœ¬å…§å®¹æª¢æ¸¬ ===');
        console.log('æª¢æ¸¬æ–‡æœ¬é•·åº¦:', aiText.length);
        console.log('æª¢æ¸¬æ–‡æœ¬å‰200å­—ç¬¦:', aiText.substring(0, 200));
        
        // 1. æª¢æŸ¥æ˜¯å¦åŒ…å«è…³æœ¬ç›¸é—œçš„çµæ§‹æ¨™è¨˜ï¼ˆæ›´éˆæ´»çš„æª¢æ¸¬ï¼‰
        const structureMarkers = [
          /ä¸»é¡Œæ¨™é¡Œ[ï¼š:]/i,
          /è…³æœ¬å…§å®¹[ï¼š:]/i,
          /ç•«é¢æ„Ÿ[ï¼š:]/i,
          /ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]/i,
          /\d+\.\s*ä¸»é¡Œæ¨™é¡Œ/i,
          /\d+\.\s*è…³æœ¬å…§å®¹/i,
          /\d+\.\s*ç•«é¢æ„Ÿ/i,
          /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ/i,
          /Hook\s*\(\d+-\d+ç§’\)/i,
          /Value\s*\d+\s*\(\d+-\d+ç§’\)/i,
          /CTA\s*\(\d+-\d+ç§’\)/i
        ];
        
        const hasStructureMarkers = structureMarkers.some(pattern => pattern.test(aiText));
        console.log('æ˜¯å¦åŒ…å«è…³æœ¬çµæ§‹æ¨™è¨˜:', hasStructureMarkers);
        
        // 2. æª¢æŸ¥æ˜¯å¦åŒ…å«çŸ­å½±éŸ³è…³æœ¬çš„é—œéµå…ƒç´ 
        const scriptElements = [
          /Hook\s*\(\d+-\d+ç§’\)/i,
          /Value\s*\d+\s*\(\d+-\d+ç§’\)/i,
          /CTA\s*\(\d+-\d+ç§’\)/i,
          /ç•«é¢æ„Ÿ[ï¼š:]/i,
          /ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]/i,
          /\d+\.\s*ç•«é¢æ„Ÿ/i,
          /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ/i,
          /é¡é ­[ï¼š:]/i,
          /éŸ³æ•ˆ[ï¼š:]/i,
          /å­—å¹•[ï¼š:]/i,
          /å°è©[ï¼š:]/i
        ];
        
        const scriptElementCount = scriptElements.filter(pattern => pattern.test(aiText)).length;
        console.log('è…³æœ¬å…ƒç´ æ•¸é‡:', scriptElementCount);
        
        // æª¢æŸ¥æ˜¯å¦åŒ…å«æ™‚é–“æ¨™è¨˜ï¼ˆHookã€Valueã€CTAæ ¼å¼ï¼‰
        const timeMarkersPatterns = [
          /\(\d+-\d+ç§’\)\s*Hook/i,
          /\(\d+-\d+ç§’\)\s*Value/i,
          /\(\d+-\d+ç§’\)\s*CTA/i,
          /Hook\s*\(\d+-\d+ç§’\)/i,
          /Value\s*\d+\s*\(\d+-\d+ç§’\)/i,
          /CTA\s*\(\d+-\d+ç§’\)/i
        ];
        const hasTimeMarkers = timeMarkersPatterns.some(pattern => pattern.test(aiText));
        console.log('æ˜¯å¦åŒ…å«æ™‚é–“æ¨™è¨˜:', hasTimeMarkers);
        
        // æª¢æŸ¥æ˜¯å¦åŒ…å«çŸ­å½±éŸ³ç›¸é—œå…§å®¹
        const videoContent = [
          /ç•«é¢æ„Ÿ/i,
          /ç™¼ä½ˆæ–‡æ¡ˆ/i,
          /å°è©[ï¼š:]/i,
          /é¡é ­[ï¼š:]/i,
          /éŸ³æ•ˆ[ï¼š:]/i,
          /å­—å¹•[ï¼š:]/i
        ];
        const hasVideoContent = videoContent.some(pattern => pattern.test(aiText));
        console.log('æ˜¯å¦åŒ…å«çŸ­å½±éŸ³å…§å®¹:', hasVideoContent);
        
        // æ›´éˆæ´»çš„åˆ¤æ–·æ¢ä»¶
        const hasAnyScriptContent = hasStructureMarkers || scriptElementCount >= 3 || hasTimeMarkers || hasVideoContent;
        console.log('æ˜¯å¦æœ‰ä»»ä½•è…³æœ¬å…§å®¹:', hasAnyScriptContent);
        
        if (!hasAnyScriptContent) {
          console.log('âŒ æœªåŒ…å«è¶³å¤ çš„è…³æœ¬å…§å®¹æ¨™è¨˜ï¼Œä¸é¡¯ç¤ºçµæœå€å¡Š');
          console.log('æª¢æ¸¬çµæœè©³æƒ…:', {
            hasStructureMarkers,
            scriptElementCount,
            hasTimeMarkers,
            hasVideoContent
          });
          return false;
        }
        
        // 2. æª¢æŸ¥æ˜¯å¦åŒ…å«è…³æœ¬ç›¸é—œçš„é—œéµè©çµ„åˆ
        const scriptKeywords = ['ä¸»é¡Œæ¨™é¡Œ', 'è…³æœ¬å…§å®¹', 'ç•«é¢æ„Ÿ', 'ç™¼ä½ˆæ–‡æ¡ˆ', 'Hook', 'Value', 'CTA'];
        const keywordCount = scriptKeywords.filter(keyword => aiText.includes(keyword)).length;
        console.log('è…³æœ¬é—œéµè©æ•¸é‡:', keywordCount);
        
        // 3. æª¢æŸ¥æ˜¯å¦åŒ…å«çŸ­å½±éŸ³ç›¸é—œçš„å…§å®¹æŒ‡ç¤ºè©
        const videoIndicators = [
          'çŸ­å½±éŸ³è…³æœ¬',
          'çŸ­å½±éŸ³è…³æœ¬çµæœ',
          'ç”Ÿæˆè…³æœ¬',
          'è…³æœ¬ç”Ÿæˆ',
          'Reels',
          'TikTok',
          'å°ç´…æ›¸',
          'ç§’è…³æœ¬',
          'å½±éŸ³å…§å®¹',
          'çŸ­å½±éŸ³',
          'è…³æœ¬'
        ];
        const hasVideoIndicators = videoIndicators.some(indicator => aiText.includes(indicator));
        console.log('æ˜¯å¦åŒ…å«çŸ­å½±éŸ³æŒ‡ç¤ºè©:', hasVideoIndicators);
        
        // 4. æª¢æŸ¥æ–‡æœ¬é•·åº¦ï¼ˆè…³æœ¬å…§å®¹é€šå¸¸è¼ƒé•·ï¼‰
        const isLongEnough = aiText.length > 300; // æé«˜é•·åº¦è¦æ±‚
        console.log('æ–‡æœ¬æ˜¯å¦è¶³å¤ é•·:', isLongEnough);
        
        // 5. æª¢æŸ¥æ˜¯å¦åŒ…å«å¤šå€‹æ®µè½ï¼ˆè…³æœ¬é€šå¸¸æœ‰å¤šå€‹éƒ¨åˆ†ï¼‰
        const paragraphCount = aiText.split('\n\n').filter(p => p.trim().length > 0).length;
        const hasMultipleParagraphs = paragraphCount >= 4; // æé«˜æ®µè½è¦æ±‚
        console.log('æ®µè½æ•¸é‡:', paragraphCount, 'æ˜¯å¦å¤šæ®µè½:', hasMultipleParagraphs);
        
        // 6. æ’é™¤æ˜é¡¯çš„éè…³æœ¬å…§å®¹
        const nonScriptIndicators = [
          'ä½ å¥½',
          'è¬è¬',
          'ä¸å®¢æ°£',
          'è«‹å•',
          'ä¸å¥½æ„æ€',
          'æŠ±æ­‰',
          'æˆ‘ä¾†å¹«ä½ ',
          'è®“æˆ‘ç‚ºä½ ',
          'å¾ˆé«˜èˆˆç‚ºæ‚¨',
          'æ­¡è¿',
          'å†è¦‹',
          'æ‹œæ‹œ',
          'æœ‰ä»€éº¼å¯ä»¥å¹«ä½ ',
          'éœ€è¦ä»€éº¼å¹«åŠ©',
          'è«‹å‘Šè¨´æˆ‘',
          'è«‹è¼¸å…¥',
          'è«‹é¸æ“‡',
          'è«‹é»æ“Š',
          'è«‹æŸ¥çœ‹',
          'è«‹æ³¨æ„',
          'æé†’',
          'å»ºè­°',
          'æ¨è–¦',
          'ä»‹ç´¹',
          'èªªæ˜',
          'è§£é‡‹',
          'å›ç­”',
          'å›è¦†',
          'å›æ‡‰'
        ];
        const hasNonScriptIndicators = nonScriptIndicators.some(indicator => 
          aiText.toLowerCase().includes(indicator.toLowerCase())
        );
        console.log('æ˜¯å¦åŒ…å«éè…³æœ¬æŒ‡ç¤ºè©:', hasNonScriptIndicators);
        
        // 7. æª¢æŸ¥æ˜¯å¦åŒ…å«å®Œæ•´çš„è…³æœ¬çµæ§‹ï¼ˆè‡³å°‘åŒ…å«3å€‹å€å¡Šï¼‰
        const requiredStructureMarkers = [
          /ä¸»é¡Œæ¨™é¡Œ[ï¼š:]/i,
          /è…³æœ¬å…§å®¹[ï¼š:]/i,
          /ç•«é¢æ„Ÿ[ï¼š:]/i,
          /ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]/i,
          /\d+\.\s*ä¸»é¡Œæ¨™é¡Œ/i,
          /\d+\.\s*è…³æœ¬å…§å®¹/i,
          /\d+\.\s*ç•«é¢æ„Ÿ/i,
          /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ/i
        ];
        const structureCount = requiredStructureMarkers.filter(pattern => pattern.test(aiText)).length;
        const hasCompleteStructure = structureCount >= 3;
        console.log('çµæ§‹å€å¡Šæ•¸é‡:', structureCount, 'æ˜¯å¦å®Œæ•´çµæ§‹:', hasCompleteStructure);
        
        // 8. æª¢æŸ¥æ˜¯å¦åŒ…å«æ™‚é–“æ¨™è¨˜ï¼ˆè…³æœ¬é€šå¸¸æœ‰æ™‚é–“æ¨™è¨˜ï¼‰
        const timeMarkersGeneral = [
          /\d+[-\s]*\d*\s*ç§’/i,
          /\d+[-\s]*\d*\s*åˆ†é˜/i,
          /0-\d+\s*ç§’/i,
          /\d+-\d+\s*ç§’/i
        ];
        const hasTimeMarkersGeneral = timeMarkersGeneral.some(pattern => pattern.test(aiText));
        console.log('æ˜¯å¦åŒ…å«ä¸€èˆ¬æ™‚é–“æ¨™è¨˜:', hasTimeMarkersGeneral);
        
        // ç¶œåˆåˆ¤æ–·
        const score = {
          structureMarkers: hasStructureMarkers ? 3 : 0,
          scriptElements: Math.min(scriptElementCount, 4), // è…³æœ¬å…ƒç´ æ•¸é‡
          keywordCount: Math.min(keywordCount, 3),
          videoIndicators: hasVideoIndicators ? 2 : 0,
          length: isLongEnough ? 1 : 0,
          paragraphs: hasMultipleParagraphs ? 1 : 0,
          completeStructure: hasCompleteStructure ? 2 : 0,
          timeMarkers: hasTimeMarkers ? 1 : 0,
          timeMarkersGeneral: hasTimeMarkersGeneral ? 1 : 0,
          videoContent: hasVideoContent ? 1 : 0,
          nonScript: hasNonScriptIndicators ? -5 : 0 // é«˜æ‡²ç½°
        };
        
        const totalScore = Object.values(score).reduce((sum, val) => sum + val, 0);
        
        console.log('è…³æœ¬æª¢æ¸¬è©•åˆ†:', score);
        console.log('ç¸½åˆ†:', totalScore);
        
        // æ›´éˆæ´»çš„åˆ¤æ–·æ¢ä»¶
        const isScriptContent = totalScore >= 4 && (hasStructureMarkers || scriptElementCount >= 3);
        
        // å¦‚æœåŒ…å«éè…³æœ¬æŒ‡ç¤ºè©ï¼Œé™ä½è©•åˆ†ä½†ä¸å®Œå…¨æ‹’çµ•
        if (hasNonScriptIndicators) {
          console.log('âš ï¸ åŒ…å«éè…³æœ¬æŒ‡ç¤ºè©ï¼Œä½†å…§å®¹çµæ§‹å®Œæ•´ï¼Œä»è¦–ç‚ºè…³æœ¬å…§å®¹');
        }
        
        console.log('æ˜¯å¦ç‚ºè…³æœ¬å…§å®¹:', isScriptContent);
        console.log('=== è…³æœ¬å…§å®¹æª¢æ¸¬çµæŸ ===');
        
        return isScriptContent;
      }
      // æ–°å¢ï¼šæ›´ç²¾ç¢ºçš„AIå…§å®¹è§£æå‡½æ•¸
      function parseAIContent(aiText) {
        const sections = {
          title: '',
          script: '',
          visual: '',
          copy: ''
        };
        
        console.log('é–‹å§‹è§£æAIå…§å®¹...');
        console.log('åŸå§‹AIæ–‡æœ¬é•·åº¦:', aiText.length);
        console.log('åŸå§‹AIæ–‡æœ¬å‰500å­—ç¬¦:', aiText.substring(0, 500));
        
        // ä½¿ç”¨æ­£å‰‡è¡¨é”å¼ç²¾ç¢ºæå–æ¯å€‹å€å¡Šçš„å…§å®¹
        try {
          // é€šç”¨å…§å®¹æå–ç­–ç•¥ - æ‡‰å°æ‰€æœ‰å¯èƒ½çš„AIæ ¼å¼è®ŠåŒ–
          let scriptContent = aiText;
          let extractionMethod = 'full';
          
          // ç­–ç•¥1: æª¢æŸ¥æ˜¯å¦æœ‰ --- åˆ†éš”ç¬¦
          const dashSections = aiText.split(/---/);
          if (dashSections.length > 1) {
            const contentSections = dashSections.slice(1);
            scriptContent = contentSections.join('---').trim();
            extractionMethod = 'dash-separated';
            console.log('âœ… ä½¿ç”¨ --- åˆ†éš”ç­–ç•¥');
          }
          // ç­–ç•¥2: æª¢æŸ¥æ˜¯å¦æœ‰æ˜ç¢ºçš„çµæ§‹æ¨™è¨˜
          else if (aiText.includes('ä¸»é¡Œæ¨™é¡Œ') || aiText.includes('è…³æœ¬å…§å®¹') || aiText.includes('ç•«é¢æ„Ÿ') || aiText.includes('ç™¼ä½ˆæ–‡æ¡ˆ')) {
            scriptContent = aiText;
            extractionMethod = 'structured';
            console.log('âœ… ä½¿ç”¨çµæ§‹åŒ–æ¨™è¨˜ç­–ç•¥');
          }
          // ç­–ç•¥3: æª¢æŸ¥æ˜¯å¦æœ‰ Hook/Value/CTA çµæ§‹
          else if (aiText.includes('Hook') || aiText.includes('Value') || aiText.includes('CTA')) {
            scriptContent = aiText;
            extractionMethod = 'hook-value-cta';
            console.log('âœ… ä½¿ç”¨ Hook/Value/CTA ç­–ç•¥');
          }
          // ç­–ç•¥4: æª¢æŸ¥æ˜¯å¦æœ‰æ™‚é–“æ¨™è¨˜
          else if (aiText.match(/\d+-\d+ç§’/) || aiText.match(/\d+ç§’/)) {
            scriptContent = aiText;
            extractionMethod = 'time-marked';
            console.log('âœ… ä½¿ç”¨æ™‚é–“æ¨™è¨˜ç­–ç•¥');
          }
          // ç­–ç•¥5: é»˜èªä½¿ç”¨å®Œæ•´å…§å®¹
          else {
            scriptContent = aiText;
            extractionMethod = 'full';
            console.log('âœ… ä½¿ç”¨å®Œæ•´å…§å®¹ç­–ç•¥');
          }
          
          console.log('æå–æ–¹æ³•:', extractionMethod);
            console.log('è…³æœ¬å…§å®¹é•·åº¦:', scriptContent.length);
            console.log('è…³æœ¬å…§å®¹å‰200å­—ç¬¦:', scriptContent.substring(0, 200));
          
          // è¶…ç´šæ™ºèƒ½ä¸»é¡Œæ¨™é¡Œæå–å™¨ - æ‡‰å°æ‰€æœ‰å¯èƒ½çš„AIæ ¼å¼
          function extractTitle(scriptContent) {
          const titlePatterns = [
              // 1. è¡¨æƒ…ç¬¦è™Ÿ + æ¨™é¡Œæ ¼å¼
              /[ğŸ¬ğŸ“ğŸ¯âœ¨ğŸ”¥ğŸ“Œ]\s*ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /[ğŸ¬ğŸ“ğŸ¯âœ¨ğŸ”¥ğŸ“Œ]\s*ä¸»é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /[ğŸ¬ğŸ“ğŸ¯âœ¨ğŸ”¥ğŸ“Œ]\s*æ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              
              // 2. æ¨™æº–æ¨™é¡Œæ ¼å¼
            /ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /ä¸»é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /æ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              
              // 3. ç·¨è™Ÿ + æ¨™é¡Œæ ¼å¼
            /\d+\.\s*ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /\d+\.\s*ä¸»é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /\d+\.\s*æ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              
              // 4. ç²—é«”æ¨™é¡Œæ ¼å¼
            /\*\*ä¸»é¡Œæ¨™é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
            /\*\*ä¸»é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
            /\*\*æ¨™é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
              
              // 5. æ··åˆæ ¼å¼
            /\d+\.\s*\*\*ä¸»é¡Œæ¨™é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
            /\d+\.\s*\*\*ä¸»é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
            /\d+\.\s*\*\*æ¨™é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
              
              // 6. Markdown æ¨™é¡Œæ ¼å¼
            /###\s*ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /###\s*ä¸»é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /###\s*æ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /##\s*ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /##\s*ä¸»é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /##\s*æ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              
              // 7. è¡Œé¦–æ¨™é¡Œæ ¼å¼ï¼ˆ--- åˆ†éš”å¾Œï¼‰
              /^ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /^æ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /^ä¸»é¡Œ[ï¼š:]\s*([^\n]+)/i,
              
              // 8. AI ç‹¡çŒ¾æ ¼å¼ï¼šç›´æ¥çµ¦æ¨™é¡Œï¼Œæ²’æœ‰å‰ç¶´
            /^ä½ çš„.*ä¾†äº†.*å°ç´…æ›¸.*éƒ½åœ¨.*ç”¨çš„.*AIæ™ºèƒ½é«”.*$/i,
            /^.*AIæ™ºèƒ½é«”.*ä¾†äº†.*$/i,
            /^.*å°ç´…æ›¸.*åšä¸».*éƒ½åœ¨.*ç”¨çš„.*$/i,
              /^.*æ•ˆç‡.*çˆ†æ£š.*$/i,
              /^.*AI.*æ™ºèƒ½é«”.*é€™æ¨£ç©.*$/i,
              
              // 9. å¼•è™Ÿæ¨™é¡Œæ ¼å¼
              /ã€Œ([^ã€]+)ã€/,
              /"([^"]+)"/,
              /'([^']+)'/,
              
              // 10. ç‰¹æ®Šæ¨™é¡Œæ¨¡å¼
              /^.*ä½ é‚„åœ¨.*æ–¹æ³•.*AIæ™ºèƒ½é«”.*æ•ˆç‡.*çˆ†æ£š.*$/i,
              /^.*AIæ™ºèƒ½é«”.*æ•ˆç‡.*ç¿»å€.*$/i,
              /^.*è¶…ç´š.*å­¸ä¼´.*$/i
          ];
          
          for (const pattern of titlePatterns) {
            const match = scriptContent.match(pattern);
            if (match) {
              // è™•ç†æœ‰æ•ç²çµ„çš„æƒ…æ³
              if (match[1] && match[1].trim()) {
                  const title = cleanMarkdownFormat(match[1].trim());
                  if (title.length > 5 && title.length < 100) { // åˆç†çš„æ¨™é¡Œé•·åº¦
                    console.log('âœ… æ‰¾åˆ°ä¸»é¡Œæ¨™é¡Œ(æœ‰å‰ç¶´):', title);
                    return title;
                  }
              }
              // è™•ç†æ²’æœ‰å‰ç¶´ï¼Œç›´æ¥åŒ¹é…æ•´è¡Œçš„æƒ…æ³
              else if (match[0] && match[0].trim()) {
                  const title = cleanMarkdownFormat(match[0].trim());
                  if (title.length > 5 && title.length < 100) {
                    console.log('âœ… æ‰¾åˆ°ä¸»é¡Œæ¨™é¡Œ(ç„¡å‰ç¶´):', title);
                    return title;
                  }
                }
              }
            }
            
            // å¦‚æœæ²’æœ‰æ‰¾åˆ°æ˜ç¢ºçš„æ¨™é¡Œï¼Œå˜—è©¦æå–ç¬¬ä¸€è¡Œä½œç‚ºæ¨™é¡Œ
            const lines = scriptContent.split('\n').filter(line => line.trim().length > 0);
            for (const line of lines) {
              const trimmedLine = line.trim();
              // è·³éæ˜é¡¯ä¸æ˜¯æ¨™é¡Œçš„è¡Œ
              if (trimmedLine.match(/^(Hook|Value|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|\d+\.|\(|å°è©|é¡é ­|éŸ³æ•ˆ|å­—å¹•|ä¸»é¡Œå»ºè­°|ç›®æ¨™|åˆ‡å…¥é»|å…§å®¹æ–¹å‘|å¥½çš„|æ²’å•é¡Œ|è®“æˆ‘)/i)) {
                continue;
              }
              // æª¢æŸ¥æ˜¯å¦ç‚ºåˆç†çš„æ¨™é¡Œ
              if (trimmedLine.length > 5 && trimmedLine.length < 100 && !trimmedLine.includes('ï¼š') && !trimmedLine.includes(':')) {
                console.log('ä½¿ç”¨ç¬¬ä¸€è¡Œä½œç‚ºä¸»é¡Œæ¨™é¡Œ:', trimmedLine);
                return cleanMarkdownFormat(trimmedLine);
              }
            }
            
            return '';
          }
          
          // æå–ä¸»é¡Œæ¨™é¡Œ
          sections.title = extractTitle(scriptContent);
          
          // è¶…ç´šæ™ºèƒ½è…³æœ¬å…§å®¹æå–å™¨ - æ‡‰å°æ‰€æœ‰å¯èƒ½çš„AIæ ¼å¼
          function extractScript(scriptContent) {
          const scriptPatterns = [
              // 1. æ¨™æº–è…³æœ¬å…§å®¹æ ¼å¼
            /è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /è…³æœ¬[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 2. è¡¨æƒ…ç¬¦è™Ÿ + è…³æœ¬å…§å®¹æ ¼å¼
              /[ğŸ“ğŸ¬ğŸ“œâœ¨ğŸ”¥]\s*è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /[ğŸ“ğŸ¬ğŸ“œâœ¨ğŸ”¥]\s*è…³æœ¬[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 3. ç·¨è™Ÿ + è…³æœ¬å…§å®¹æ ¼å¼
            /\d+\.\s*è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç•«é¢æ„Ÿ|\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*è…³æœ¬[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç•«é¢æ„Ÿ|\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 4. ç²—é«”è…³æœ¬å…§å®¹æ ¼å¼
            /\*\*è…³æœ¬å…§å®¹\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\*\*è…³æœ¬\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 5. æ··åˆæ ¼å¼
            /\d+\.\s*\*\*è…³æœ¬å…§å®¹\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç•«é¢æ„Ÿ|\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*\*\*è…³æœ¬\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç•«é¢æ„Ÿ|\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 6. Markdown æ¨™é¡Œæ ¼å¼
              /###\s*è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:###\s*ç•«é¢æ„Ÿ|###\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /###\s*è…³æœ¬[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:###\s*ç•«é¢æ„Ÿ|###\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /##\s*è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:##\s*ç•«é¢æ„Ÿ|##\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /##\s*è…³æœ¬[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:##\s*ç•«é¢æ„Ÿ|##\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 7. è¡Œé¦–è…³æœ¬å…§å®¹æ ¼å¼ï¼ˆ--- åˆ†éš”å¾Œï¼‰
            /^è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /^è…³æœ¬[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 8. Hook/Value/CTA çµæ§‹æ ¼å¼
              /Hook\s*\(\d+-\d+ç§’\)[\s\S]*?(?=ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /\(\d+-\d+ç§’\)\s*Hook[\s\S]*?(?=ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /Hook\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /Hook\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value\s*\d+|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              
              // 9. å°è©æ ¼å¼
              /å°è©[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /å°è©\s*\(\d+-\d+ç§’\)[\s\S]*?(?=ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              
              // 10. ç‰¹æ®Šè…³æœ¬æ¨¡å¼
              /^.*ä½ é‚„åœ¨.*æ‰‹å‹•.*å ±å‘Š.*å¯«æ–‡æ¡ˆ.*è½ä¼.*è¶…ç´šåŠ©ç†.*AIæ™ºèƒ½é«”.*$/i,
              /^.*å®ƒä¸åªæ˜¯.*ç¨‹å¼.*çœŸäºº.*æ€è€ƒ.*å­¸ç¿’.*$/i,
              /^.*æƒ³åƒä¸€ä¸‹.*å°ˆå±¬åœ˜éšŠ.*24å°æ™‚.*å¾…å‘½.*$/i,
              /^.*é‡é»æ˜¯.*è¶Šä¾†è¶Šè°æ˜.*ä¸æ–·é€²åŒ–.*$/i,
              /^.*æƒ³çŸ¥é“.*æ€éº¼é–‹å§‹.*AIæ™ºèƒ½é«”.*$/i
          ];
          
          for (const pattern of scriptPatterns) {
            const match = scriptContent.match(pattern);
              if (match) {
                let scriptText = '';
                if (match[1] && match[1].trim()) {
                  scriptText = match[1].trim();
                } else if (match[0] && match[0].trim()) {
                  scriptText = match[0].trim();
                }
                
                if (scriptText && scriptText.length > 10) {
                  console.log('âœ… æ‰¾åˆ°è…³æœ¬å…§å®¹:', scriptText.substring(0, 100) + '...');
                  return cleanMarkdownFormat(scriptText);
                }
            }
          }
          
          // å¦‚æœæ²’æœ‰æ‰¾åˆ°æ˜ç¢ºçš„è…³æœ¬å…§å®¹æ¨™è¨˜ï¼Œå˜—è©¦æå– Hookã€Valueã€CTA éƒ¨åˆ†
            console.log('å˜—è©¦æå– Hook/Value/CTA å…§å®¹...');
            
            // æ”¯æ´å¤šç¨®æ™‚é–“æ¨™è¨˜æ ¼å¼
            const hookPatterns = [
              /Hook\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /\(\d+-\d+ç§’\)\s*Hook[\s\S]*?(?=Value|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /Hook\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /Hook\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value\s*\d+|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i
            ];
            const valuePatterns = [
              /Value\s*\d+\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /\(\d+-\d+ç§’\)\s*Value\s*\d+[\s\S]*?(?=Value|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /Value\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i
            ];
            const ctaPatterns = [
              /CTA\s*\(\d+-\d+ç§’\)[\s\S]*?(?=ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /\(\d+-\d+ç§’\)\s*CTA[\s\S]*?(?=ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i
            ];
            
            let extractedScriptContent = '';
            
            // æå– Hook
            for (const pattern of hookPatterns) {
              const match = scriptContent.match(pattern);
              if (match) {
                console.log('æ‰¾åˆ° Hook:', match[0].substring(0, 100) + '...');
                extractedScriptContent += match[0] + '\n\n';
                break;
              }
            }
            
            // æå– Value
            for (const pattern of valuePatterns) {
              const matches = scriptContent.match(new RegExp(pattern.source, 'gi'));
              if (matches) {
                console.log('æ‰¾åˆ° Value æ•¸é‡:', matches.length);
                extractedScriptContent += matches.join('\n\n');
                break;
              }
            }
            
            // æå– CTA
            for (const pattern of ctaPatterns) {
              const match = scriptContent.match(pattern);
              if (match) {
                console.log('æ‰¾åˆ° CTA:', match[0].substring(0, 100) + '...');
                extractedScriptContent += '\n\n' + match[0];
                break;
              }
            }
            
            if (extractedScriptContent.trim()) {
              console.log('ä½¿ç”¨ Hook/Value/CTA ä½œç‚ºè…³æœ¬å…§å®¹:', extractedScriptContent.substring(0, 100) + '...');
              return cleanMarkdownFormat(extractedScriptContent.trim());
            }
            
            return '';
          }
          
          // æå–è…³æœ¬å…§å®¹
          sections.script = extractScript(scriptContent);
          
          // è¶…ç´šæ™ºèƒ½ç•«é¢æ„Ÿæå–å™¨ - æ‡‰å°æ‰€æœ‰å¯èƒ½çš„AIæ ¼å¼
          function extractVisual(scriptContent) {
          const visualPatterns = [
              // 1. æ¨™æº–ç•«é¢æ„Ÿæ ¼å¼
            /ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /ç•«é¢[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 2. è¡¨æƒ…ç¬¦è™Ÿ + ç•«é¢æ„Ÿæ ¼å¼
              /[ğŸ¬ğŸï¸ğŸ“¹âœ¨ğŸ”¥]\s*ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /[ğŸ¬ğŸï¸ğŸ“¹âœ¨ğŸ”¥]\s*ç•«é¢[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 3. ç·¨è™Ÿ + ç•«é¢æ„Ÿæ ¼å¼
            /\d+\.\s*ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*ç•«é¢[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              // æ–°å¢ï¼šç·¨è™Ÿ + æ‹¬è™Ÿæ ¼å¼
              /\d+\.\s*ç•«é¢æ„Ÿ\s*\([^)]*\)[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /\d+\.\s*ç•«é¢\s*\([^)]*\)[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 4. ç²—é«”ç•«é¢æ„Ÿæ ¼å¼
            /\*\*ç•«é¢æ„Ÿ\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\*\*ç•«é¢\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 5. æ··åˆæ ¼å¼
            /\d+\.\s*\*\*ç•«é¢æ„Ÿ\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*\*\*ç•«é¢\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 6. Markdown æ¨™é¡Œæ ¼å¼
            /###\s*ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:###\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /###\s*ç•«é¢[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:###\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /##\s*ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:##\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /##\s*ç•«é¢[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:##\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 7. è¡Œé¦–ç•«é¢æ„Ÿæ ¼å¼ï¼ˆ--- åˆ†éš”å¾Œï¼‰
            /^ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /^ç•«é¢[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 8. ç‰¹æ®Šç•«é¢æ„Ÿæ¨¡å¼
              /^.*é–‹å ´.*Hook.*é¡é ­.*ç‰¹å¯«.*$/i,
              /^.*æ ¸å¿ƒåƒ¹å€¼.*é¡é ­.*ä¸­æ™¯.*$/i,
              /^.*è¡Œå‹•å‘¼ç±².*é¡é ­.*æŒ‡å‘.*$/i
          ];
          
          for (const pattern of visualPatterns) {
            const match = scriptContent.match(pattern);
            if (match && match[1] && match[1].trim()) {
              // æª¢æŸ¥æ˜¯å¦ç‚ºã€Œå°šæœªç”Ÿæˆã€
              if (match[1].trim() === 'å°šæœªç”Ÿæˆ' || match[1].trim().includes('å°šæœªç”Ÿæˆ')) {
                console.log('âš ï¸ ç•«é¢æ„Ÿæ¨™è¨˜ç‚ºã€Œå°šæœªç”Ÿæˆã€');
                  return 'AI æœªç”Ÿæˆç•«é¢æ„Ÿå…§å®¹';
              } else {
                  const visual = cleanMarkdownFormat(match[1].trim());
                  console.log('âœ… æ‰¾åˆ°ç•«é¢æ„Ÿ:', visual.substring(0, 100) + '...');
                  return visual;
                }
              }
            }
            
            return '';
          }
          
          // æå–ç•«é¢æ„Ÿ
          sections.visual = extractVisual(scriptContent);
          
          // è¶…ç´šæ™ºèƒ½ç™¼ä½ˆæ–‡æ¡ˆæå–å™¨ - æ‡‰å°æ‰€æœ‰å¯èƒ½çš„AIæ ¼å¼
          function extractCopy(scriptContent) {
          const copyPatterns = [
              // 1. æ¨™æº–ç™¼ä½ˆæ–‡æ¡ˆæ ¼å¼
            /ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
            /æ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 2. è¡¨æƒ…ç¬¦è™Ÿ + ç™¼ä½ˆæ–‡æ¡ˆæ ¼å¼
              /[ğŸ“±ğŸ“„ğŸ“âœ¨ğŸ”¥]\s*ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              /[ğŸ“±ğŸ“„ğŸ“âœ¨ğŸ”¥]\s*æ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 3. ç·¨è™Ÿ + ç™¼ä½ˆæ–‡æ¡ˆæ ¼å¼
            /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
            /\d+\.\s*æ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              // æ–°å¢ï¼šç·¨è™Ÿ + æ‹¬è™Ÿæ ¼å¼
              /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ\s*\([^)]*\)[ï¼š:]\s*([\s\S]*?)$/i,
              /\d+\.\s*æ–‡æ¡ˆ\s*\([^)]*\)[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 4. ç²—é«”ç™¼ä½ˆæ–‡æ¡ˆæ ¼å¼
            /\*\*ç™¼ä½ˆæ–‡æ¡ˆ\*\*[ï¼š:]\s*([\s\S]*?)$/i,
            /\*\*æ–‡æ¡ˆ\*\*[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 5. æ··åˆæ ¼å¼
            /\d+\.\s*\*\*ç™¼ä½ˆæ–‡æ¡ˆ\*\*[ï¼š:]\s*([\s\S]*?)$/i,
            /\d+\.\s*\*\*æ–‡æ¡ˆ\*\*[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 6. Markdown æ¨™é¡Œæ ¼å¼
            /###\s*ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
            /###\s*æ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              /##\s*ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              /##\s*æ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 7. è¡Œé¦–ç™¼ä½ˆæ–‡æ¡ˆæ ¼å¼ï¼ˆ--- åˆ†éš”å¾Œï¼‰
            /^ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              /^æ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 8. ç‰¹æ®Šç™¼ä½ˆæ–‡æ¡ˆæ¨¡å¼
              /^.*é‚„åœ¨.*ç¹ç‘£.*å·¥ä½œ.*AIæ™ºèƒ½é«”.*æ•‘æ˜Ÿ.*$/i,
              /^.*è‡ªå‹•åŒ–.*æå‡æ•ˆç‡.*å®¢è£½åŒ–.*$/i,
              /^.*æœªä¾†è¶¨å‹¢.*é»æ“Š.*ä¸»é .*é€£çµ.*$/i,
              /^.*å…è²».*é ˜å–.*AI.*å…¥é–€.*æŒ‡å—.*$/i
          ];
          
          for (const pattern of copyPatterns) {
            const match = scriptContent.match(pattern);
            if (match && match[1] && match[1].trim()) {
              // æª¢æŸ¥æ˜¯å¦ç‚ºã€Œå°šæœªç”Ÿæˆã€
              if (match[1].trim() === 'å°šæœªç”Ÿæˆ' || match[1].trim().includes('å°šæœªç”Ÿæˆ')) {
                console.log('âš ï¸ ç™¼ä½ˆæ–‡æ¡ˆæ¨™è¨˜ç‚ºã€Œå°šæœªç”Ÿæˆã€');
                  return 'AI æœªç”Ÿæˆç™¼ä½ˆæ–‡æ¡ˆå…§å®¹';
              } else {
                  const copy = cleanMarkdownFormat(match[1].trim());
                  console.log('âœ… æ‰¾åˆ°ç™¼ä½ˆæ–‡æ¡ˆ:', copy.substring(0, 100) + '...');
                  return copy;
                }
              }
            }
            
            return '';
          }
          
          // æå–ç™¼ä½ˆæ–‡æ¡ˆ
          sections.copy = extractCopy(scriptContent);
          
          // æœ€çµ‚èª¿è©¦è¼¸å‡º
          console.log('=== è¶…ç´šæ™ºèƒ½è§£æçµæœ ===');
          console.log('æå–æ–¹æ³•:', extractionMethod);
          console.log('ä¸»é¡Œæ¨™é¡Œ:', sections.title ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
          console.log('è…³æœ¬å…§å®¹:', sections.script ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
          console.log('ç•«é¢æ„Ÿ:', sections.visual ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
          console.log('ç™¼ä½ˆæ–‡æ¡ˆ:', sections.copy ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
          
          // å¦‚æœä»»ä½•æ¬„ä½ç‚ºç©ºï¼Œå˜—è©¦æœ€å¾Œçš„å¼·åˆ¶æå–
          if (!sections.title || !sections.script || !sections.visual || !sections.copy) {
            console.log('ğŸ”„ å•Ÿå‹•æœ€å¾Œçš„å¼·åˆ¶æå–æ©Ÿåˆ¶...');
            
            // å¼·åˆ¶æå–ä¸»é¡Œæ¨™é¡Œ
            if (!sections.title) {
              const lines = scriptContent.split('\n').filter(line => line.trim().length > 0);
              for (const line of lines) {
                if (line.length > 10 && line.length < 100 && !line.includes('ï¼š') && !line.includes(':')) {
                  sections.title = cleanMarkdownFormat(line.trim());
                    console.log('å¼·åˆ¶æå–ä¸»é¡Œæ¨™é¡Œ:', sections.title);
                  break;
                }
              }
            }
            
            // å¼·åˆ¶æå–è…³æœ¬å…§å®¹
            if (!sections.script) {
              const scriptMatch = scriptContent.match(/(?:Hook|Value|CTA)[\s\S]*?(?=ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i);
              if (scriptMatch) {
                sections.script = cleanMarkdownFormat(scriptMatch[0].trim());
                console.log('å¼·åˆ¶æå–è…³æœ¬å…§å®¹:', sections.script.substring(0, 100) + '...');
              }
            }
            
            // å¼·åˆ¶æå–ç•«é¢æ„Ÿ
            if (!sections.visual) {
              const visualMatch = scriptContent.match(/ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=ç™¼ä½ˆæ–‡æ¡ˆ|$)/i);
              if (visualMatch && visualMatch[1]) {
                if (visualMatch[1].trim() === 'å°šæœªç”Ÿæˆ' || visualMatch[1].trim().includes('å°šæœªç”Ÿæˆ')) {
                  sections.visual = 'AI æœªç”Ÿæˆç•«é¢æ„Ÿå…§å®¹';
                } else {
                  sections.visual = cleanMarkdownFormat(visualMatch[1].trim());
                }
                  console.log('å¼·åˆ¶æå–ç•«é¢æ„Ÿ:', sections.visual.substring(0, 100) + '...');
              }
            }
            
            // å¼·åˆ¶æå–ç™¼ä½ˆæ–‡æ¡ˆ
            if (!sections.copy) {
              const copyMatch = scriptContent.match(/ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i);
              if (copyMatch && copyMatch[1]) {
                if (copyMatch[1].trim() === 'å°šæœªç”Ÿæˆ' || copyMatch[1].trim().includes('å°šæœªç”Ÿæˆ')) {
                  sections.copy = 'AI æœªç”Ÿæˆç™¼ä½ˆæ–‡æ¡ˆå…§å®¹';
                } else {
                  sections.copy = cleanMarkdownFormat(copyMatch[1].trim());
                }
                  console.log('å¼·åˆ¶æå–ç™¼ä½ˆæ–‡æ¡ˆ:', sections.copy.substring(0, 100) + '...');
              }
            }
          }
          
        } catch (error) {
          console.error('è§£æAIå…§å®¹æ™‚å‡ºéŒ¯:', error);
        }
        
        console.log('=== æœ€çµ‚è§£æçµæœ ===');
        console.log('ä¸»é¡Œæ¨™é¡Œ:', sections.title ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
        console.log('è…³æœ¬å…§å®¹:', sections.script ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
        console.log('ç•«é¢æ„Ÿ:', sections.visual ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
        console.log('ç™¼ä½ˆæ–‡æ¡ˆ:', sections.copy ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
        
        // å¦‚æœæ‰€æœ‰å…§å®¹éƒ½ç‚ºç©ºï¼Œå˜—è©¦å¼·åˆ¶æå–
        if (!sections.title && !sections.script && !sections.visual && !sections.copy) {
          console.log('âš ï¸ æ‰€æœ‰å…§å®¹éƒ½ç‚ºç©ºï¼Œå˜—è©¦å¼·åˆ¶æå–...');
          
          // å¼·åˆ¶æå–ä¸»é¡Œæ¨™é¡Œ
          const titleMatch = aiText.match(/ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i);
          if (titleMatch && titleMatch[1]) {
            sections.title = cleanMarkdownFormat(titleMatch[1].trim());
            console.log('å¼·åˆ¶æå–ä¸»é¡Œæ¨™é¡Œ:', sections.title);
          }
          
          // å¼·åˆ¶æå–è…³æœ¬å…§å®¹
          const scriptMatch = aiText.match(/è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i);
          if (scriptMatch && scriptMatch[1]) {
            sections.script = cleanMarkdownFormat(scriptMatch[1].trim());
            console.log('å¼·åˆ¶æå–è…³æœ¬å…§å®¹:', sections.script.substring(0, 100) + '...');
          }
          
          // å¼·åˆ¶æå–ç•«é¢æ„Ÿ
          const visualMatch = aiText.match(/ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i);
          if (visualMatch && visualMatch[1]) {
            sections.visual = cleanMarkdownFormat(visualMatch[1].trim());
            console.log('å¼·åˆ¶æå–ç•«é¢æ„Ÿ:', sections.visual.substring(0, 100) + '...');
          }
          
          // å¼·åˆ¶æå–ç™¼ä½ˆæ–‡æ¡ˆ
          const copyMatch = aiText.match(/ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i);
          if (copyMatch && copyMatch[1]) {
            sections.copy = cleanMarkdownFormat(copyMatch[1].trim());
            console.log('å¼·åˆ¶æå–ç™¼ä½ˆæ–‡æ¡ˆ:', sections.copy.substring(0, 100) + '...');
          }
        }
        
        console.log('å®Œæ•´è§£æçµæœ:', sections);
        return sections;
      }

      // ===== æ¨¡å¼3ï¼šIPäººè¨­è¦åŠƒæ¨¡å¼å‡½æ•¸ =====
      
      // åˆ‡æ›èªªæ˜æ¬„ä½é¡¯ç¤º/éš±è—
      function toggleMode3Instructions() {
        const instructions = document.querySelector('.mode3-instructions');
        const chatMessages = document.querySelector('.mode3-chat-messages');
        
        if (instructions.classList.contains('collapsed')) {
          instructions.classList.remove('collapsed');
          chatMessages.classList.remove('expanded');
        } else {
          instructions.classList.add('collapsed');
          chatMessages.classList.add('expanded');
        }
      }

      // ç™¼é€è¨Šæ¯
      async function sendMode3Message(message = null) {
        const input = document.getElementById('mode3-message-input');
        const messageText = message || input.value.trim();
        
        if (!messageText) return;
        
        // æ¸…ç©ºè¼¸å…¥æ¡†
        if (!message) {
          input.value = '';
        }
        
        // æ·»åŠ ç”¨æˆ¶è¨Šæ¯
        addMode3Message('user', messageText);
        try { await recordConversationMessage('ip_planning', 'user', messageText); } catch (_) {}
        
        // æ·»åŠ è¼‰å…¥è¨Šæ¯
        const loadingId = addMode3LoadingMessage();
        
        try {
          console.log('ç™¼é€IPäººè¨­è¦åŠƒè¨Šæ¯:', messageText);
          console.log('ç”¨æˆ¶è³‡æ–™:', ipPlanningUser);
          console.log('è¨ªå•ä»¤ç‰Œ:', ipPlanningToken ? 'å·²è¼‰å…¥' : 'æœªè¼‰å…¥');
          
          // ç™¼é€åˆ°å¾Œç«¯ API
          const response = await fetch('https://aivideobackend.zeabur.app/api/chat/stream', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: messageText,
              user_id: ipPlanningUser?.user_id || 'anonymous',
              platform: 'çŸ­å½±éŸ³å¹³å°',
              profile: 'IPäººè¨­è¦åŠƒå°ˆå®¶',
              topic: 'å€‹äººå“ç‰Œå»ºç«‹',
              style: 'å°ˆæ¥­è¨ªè«‡å¼å°è©±ï¼Œæ·±åº¦æŒ–æ˜å€‹äººç‰¹è‰²',
              duration: '30'
            })
          });
          
          console.log('API å›æ‡‰ç‹€æ…‹:', response.status);
          
          if (!response.ok) {
            const errorText = await response.text();
            console.error('API éŒ¯èª¤:', errorText);
            throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
          }
          
          // è™•ç†ä¸²æµå›æ‡‰
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          let assistantMessage = '';
          let hasStarted = false;
          
          // æ·»åŠ åŠ©æ‰‹è¨Šæ¯å®¹å™¨
          const messageDiv = addMode3Message('assistant', '');
          const messageId = messageDiv.id;
          
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            const chunk = decoder.decode(value);
            console.log('æ”¶åˆ°ä¸²æµæ•¸æ“š:', chunk);
            const lines = chunk.split('\n');
            
            for (const line of lines) {
              if (line.startsWith('data: ')) {
                const data = line.slice(6);
                console.log('è§£ææ•¸æ“š:', data);
                if (data === '[DONE]') continue;
                
                try {
                  const parsed = JSON.parse(data);
                  console.log('è§£æ JSON:', parsed);
                  if (parsed.content) {
                    // ç¬¬ä¸€æ¬¡æ”¶åˆ°å…§å®¹æ™‚ç§»é™¤è¼‰å…¥è¨Šæ¯
                    if (!hasStarted) {
                      removeMode3LoadingMessage(loadingId);
                      hasStarted = true;
                    }
                    assistantMessage += parsed.content;
                    console.log('æ›´æ–°è¨Šæ¯å…§å®¹:', assistantMessage);
                    updateMode3Message(messageId, assistantMessage);
                  } else if (data === '[DONE]') {
                    // AI å›è¦†å®Œæˆï¼Œå„²å­˜åˆ°é•·æœŸè¨˜æ†¶
                    if (assistantMessage) {
                      try { await recordConversationMessage('ip_planning', 'assistant', assistantMessage); } catch (_) {}
                    }
                  }
                } catch (e) {
                  console.error('JSON è§£æéŒ¯èª¤:', e, 'æ•¸æ“š:', data);
                }
              }
            }
          }
          
        } catch (error) {
          console.error('ç™¼é€è¨Šæ¯å¤±æ•—:', error);
          removeMode3LoadingMessage(loadingId);
          addMode3Message('assistant', 'æŠ±æ­‰ï¼Œç™¼ç”Ÿäº†éŒ¯èª¤ã€‚è«‹ç¨å¾Œå†è©¦ã€‚');
        }
      }

      // æ·»åŠ è¨Šæ¯åˆ°èŠå¤©å€åŸŸ
      function addMode3Message(sender, content) {
        const messagesContainer = document.getElementById('mode3-chat-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `mode3-message mode3-${sender}-message`;
        
        // ç‚ºåŠ©æ‰‹è¨Šæ¯æ·»åŠ  ID
        if (sender === 'assistant') {
          const messageId = 'msg-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
          messageDiv.id = messageId;
        }
        
        // å‰µå»ºé ­åƒå…ƒç´ 
        const avatarDiv = document.createElement('div');
        avatarDiv.className = 'mode3-message-avatar';
        
        if (sender === 'user') {
          // ç”¨æˆ¶é ­åƒï¼šä½¿ç”¨ Gmail é ­åƒæˆ–é»˜èªé ­åƒ
          const userAvatarImg = document.getElementById('userAvatar');
          if (userAvatarImg && userAvatarImg.src && userAvatarImg.src !== '') {
            const img = document.createElement('img');
            img.src = userAvatarImg.src;
            img.alt = 'ç”¨æˆ¶é ­åƒ';
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.borderRadius = '50%';
            img.style.objectFit = 'cover';
            avatarDiv.appendChild(img);
          } else {
            avatarDiv.textContent = 'ğŸ‘¤';
          }
        } else {
          // AI é ­åƒï¼šä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿ
          avatarDiv.textContent = 'ğŸ¤–';
        }
        
        // å‰µå»ºè¨Šæ¯å…§å®¹å…ƒç´ 
        const contentDiv = document.createElement('div');
        contentDiv.className = 'mode3-message-content';
        contentDiv.innerHTML = `<p>${content}</p>`;
        
        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        
        return messageDiv;
      }

      // æ·»åŠ è¼‰å…¥è¨Šæ¯
      function addMode3LoadingMessage() {
        const messagesContainer = document.getElementById('mode3-chat-messages');
        const messageDiv = document.createElement('div');
        const messageId = 'loading-' + Date.now();
        messageDiv.id = messageId;
        messageDiv.className = 'mode3-message mode3-assistant-message';
        
        messageDiv.innerHTML = `
          <div class="mode3-message-avatar">ğŸ¤–</div>
          <div class="mode3-message-content">
            <div class="mode3-loading">
              <span>AIæ­£åœ¨æ€è€ƒä¸­</span>
              <div class="mode3-loading-dots">
                <div class="mode3-loading-dot"></div>
                <div class="mode3-loading-dot"></div>
                <div class="mode3-loading-dot"></div>
              </div>
            </div>
          </div>
        `;
        
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        
        return messageId;
      }
      
      // ç§»é™¤è¼‰å…¥è¨Šæ¯
      function removeMode3LoadingMessage(messageId) {
        const loadingMessage = document.getElementById(messageId);
        if (loadingMessage) {
          loadingMessage.remove();
        }
      }
      
      // æ›´æ–°è¨Šæ¯å…§å®¹
      function updateMode3Message(messageId, content) {
        const messageDiv = document.getElementById(messageId);
        if (messageDiv) {
          const contentDiv = messageDiv.querySelector('.mode3-message-content');
          if (contentDiv) {
            // ä½¿ç”¨cleanMarkdownFormatè™•ç†å…§å®¹
            const formattedContent = cleanMarkdownFormat(content);
            contentDiv.innerHTML = formattedContent;
            const messagesContainer = document.getElementById('mode3-chat-messages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
          }
        }
      }

      // æ›´æ–°æœ€å¾Œä¸€æ¢è¨Šæ¯
      function updateMode3LastMessage(messageId, sender, content) {
        const messageDiv = document.getElementById(messageId);
        if (messageDiv) {
          messageDiv.className = `mode3-message mode3-${sender}-message`;
          
          // å‰µå»ºé ­åƒå…ƒç´ 
          const avatarDiv = document.createElement('div');
          avatarDiv.className = 'mode3-message-avatar';
          
          if (sender === 'user') {
            // ç”¨æˆ¶é ­åƒï¼šä½¿ç”¨ Gmail é ­åƒæˆ–é»˜èªé ­åƒ
            const userAvatarImg = document.getElementById('userAvatar');
            if (userAvatarImg && userAvatarImg.src && userAvatarImg.src !== '') {
              const img = document.createElement('img');
              img.src = userAvatarImg.src;
              img.alt = 'ç”¨æˆ¶é ­åƒ';
              img.style.width = '100%';
              img.style.height = '100%';
              img.style.borderRadius = '50%';
              img.style.objectFit = 'cover';
              avatarDiv.appendChild(img);
            } else {
              avatarDiv.textContent = 'ğŸ‘¤';
            }
          } else {
            // AI é ­åƒï¼šä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿ
            avatarDiv.textContent = 'ğŸ¤–';
          }
          
          // å‰µå»ºè¨Šæ¯å…§å®¹å…ƒç´ 
          const contentDiv = document.createElement('div');
          contentDiv.className = 'mode3-message-content';
          contentDiv.innerHTML = `<p>${content}</p>`;
          
          messageDiv.innerHTML = '';
          messageDiv.appendChild(avatarDiv);
          messageDiv.appendChild(contentDiv);
        }
      }

      // åˆ‡æ›çµæœæ¨™ç±¤
      function switchMode3Tab(tabName) {
        // ç§»é™¤æ‰€æœ‰æ¨™ç±¤çš„activeé¡åˆ¥
        document.querySelectorAll('.mode3-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        
        // éš±è—æ‰€æœ‰çµæœå€å¡Š
        document.querySelectorAll('.mode3-result-block').forEach(block => {
          block.classList.remove('active');
        });
        
        // æ¿€æ´»é¸ä¸­çš„æ¨™ç±¤
        event.target.classList.add('active');
        
        // é¡¯ç¤ºå°æ‡‰çš„çµæœå€å¡Š
        const resultBlock = document.getElementById(`mode3-${tabName}-result`);
        if (resultBlock) {
          resultBlock.classList.add('active');
        }
      }

      // ç”ŸæˆIP Profile
      async function generateMode3IPProfile() {
        const resultBlock = document.getElementById('mode3-profile-result');
        const button = resultBlock.querySelector('.mode3-generate-btn');
        
        // ç¦ç”¨æŒ‰éˆ•ä¸¦é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        button.disabled = true;
        button.innerHTML = '<span>â³</span> ç”Ÿæˆä¸­...';
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/chat/stream', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: 'è«‹æ ¹æ“šæˆ‘å€‘çš„å°è©±å…§å®¹ï¼Œç”Ÿæˆä¸€ä»½å®Œæ•´çš„IP Profileï¼ŒåŒ…å«ï¼š1.äººè¨­æ¨™ç±¤ï¼ˆ3-5å€‹ï¼‰2.ä¸€å¥è©±å®šä½3.å“ç‰ŒåŸå‹4.èªæ°£è¨­å®š5.æ ¸å¿ƒåƒ¹å€¼è§€6.ç¦èªæ¸…å–®7.è¦–è¦ºè¨­å®š8.KPIæŒ‡æ¨™',
              user_id: ipPlanningUser?.user_id || 'anonymous',
              platform: 'çŸ­å½±éŸ³å¹³å°',
              profile: 'IPäººè¨­è¦åŠƒå°ˆå®¶',
              topic: 'IP Profileç”Ÿæˆ',
              style: 'å°ˆæ¥­åˆ†æå ±å‘Šæ ¼å¼ï¼Œçµæ§‹åŒ–è¼¸å‡º',
              duration: '30'
            })
          });
          
          if (response.ok) {
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let content = '';
            
            while (true) {
              const { done, value } = await reader.read();
              if (done) break;
              
              const chunk = decoder.decode(value);
              const lines = chunk.split('\n');
              
              for (const line of lines) {
                if (line.startsWith('data: ')) {
                  const data = line.slice(6);
                  if (data === '[DONE]') continue;
                  
                  try {
                    const parsed = JSON.parse(data);
                    if (parsed.content) {
                      content += parsed.content;
                    }
                  } catch (e) {
                    // å¿½ç•¥è§£æéŒ¯èª¤
                  }
                }
              }
            }
            
            resultBlock.innerHTML = `<div class="mode3-result-content">${content}</div>`;
            button.innerHTML = '<span>ğŸš€</span> é‡æ–°ç”Ÿæˆ';
            button.disabled = false;
          } else {
            throw new Error('ç”Ÿæˆå¤±æ•—');
          }
        } catch (error) {
          console.error('ç”ŸæˆIP Profileå¤±æ•—:', error);
          button.innerHTML = '<span>âŒ</span> ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦';
          button.disabled = false;
        }
      }

      // ç”Ÿæˆ14å¤©è¦åŠƒ
      async function generateMode314DayPlan() {
        const resultBlock = document.getElementById('mode3-plan-result');
        const button = resultBlock.querySelector('.mode3-generate-btn');
        
        button.disabled = true;
        button.innerHTML = '<span>â³</span> ç”Ÿæˆä¸­...';
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/chat/stream', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: 'è«‹æ ¹æ“šæˆ‘å€‘çš„å°è©±å…§å®¹å’ŒIP Profileï¼Œç”Ÿæˆä¸€ä»½14å¤©çŸ­å½±éŸ³è¦åŠƒè¡¨ï¼ŒåŒ…å«ï¼š1.æ¯æ—¥ä¸»é¡Œ2.å…§å®¹æ–¹å‘3.æ‹æ”å»ºè­°4.ç™¼å¸ƒæ™‚é–“5.äº’å‹•ç­–ç•¥',
              user_id: ipPlanningUser?.user_id || 'anonymous',
              platform: 'çŸ­å½±éŸ³å¹³å°',
              profile: 'IPäººè¨­è¦åŠƒå°ˆå®¶',
              topic: '14å¤©è¦åŠƒç”Ÿæˆ',
              style: 'è©³ç´°è¦åŠƒè¡¨æ ¼æ ¼å¼ï¼Œå¯¦ç”¨æ€§å°å‘',
              duration: '30'
            })
          });
          
          if (response.ok) {
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let content = '';
            
            while (true) {
              const { done, value } = await reader.read();
              if (done) break;
              
              const chunk = decoder.decode(value);
              const lines = chunk.split('\n');
              
              for (const line of lines) {
                if (line.startsWith('data: ')) {
                  const data = line.slice(6);
                  if (data === '[DONE]') continue;
                  
                  try {
                    const parsed = JSON.parse(data);
                    if (parsed.content) {
                      content += parsed.content;
                    }
                  } catch (e) {
                    // å¿½ç•¥è§£æéŒ¯èª¤
                  }
                }
              }
            }
            
            resultBlock.innerHTML = `<div class="mode3-result-content">${content}</div>`;
            button.innerHTML = '<span>ğŸš€</span> é‡æ–°ç”Ÿæˆ';
            button.disabled = false;
          } else {
            throw new Error('ç”Ÿæˆå¤±æ•—');
          }
        } catch (error) {
          console.error('ç”Ÿæˆ14å¤©è¦åŠƒå¤±æ•—:', error);
          button.innerHTML = '<span>âŒ</span> ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦';
          button.disabled = false;
        }
      }
      // ç”Ÿæˆä»Šæ—¥è…³æœ¬
      async function generateMode3TodayScripts() {
        const resultBlock = document.getElementById('mode3-scripts-result');
        const button = resultBlock.querySelector('.mode3-generate-btn');
        
        button.disabled = true;
        button.innerHTML = '<span>â³</span> ç”Ÿæˆä¸­...';
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/chat/stream', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: 'è«‹æ ¹æ“šæˆ‘å€‘çš„å°è©±å…§å®¹å’ŒIP Profileï¼Œç”Ÿæˆä»Šæ—¥3æ”¯çŸ­å½±éŸ³è…³æœ¬ï¼Œæ¯æ”¯è…³æœ¬åŒ…å«ï¼š1.ä¸»é¡Œæ¨™é¡Œ2.Hookï¼ˆé–‹å ´é‰¤å­ï¼‰3.Valueï¼ˆæ ¸å¿ƒåƒ¹å€¼å…§å®¹ï¼‰4.CTAï¼ˆè¡Œå‹•å‘¼ç±²ï¼‰5.ç•«é¢æ„Ÿæè¿°6.ç™¼ä½ˆæ–‡æ¡ˆ',
              user_id: ipPlanningUser?.user_id || 'anonymous',
              platform: 'çŸ­å½±éŸ³å¹³å°',
              profile: 'IPäººè¨­è¦åŠƒå°ˆå®¶',
              topic: 'ä»Šæ—¥è…³æœ¬ç”Ÿæˆ',
              style: 'è…³æœ¬æ ¼å¼ï¼ŒåŒ…å«Hook-Value-CTAçµæ§‹',
              duration: '30'
            })
          });
          
          if (response.ok) {
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let content = '';
            
            while (true) {
              const { done, value } = await reader.read();
              if (done) break;
              
              const chunk = decoder.decode(value);
              const lines = chunk.split('\n');
              
              for (const line of lines) {
                if (line.startsWith('data: ')) {
                  const data = line.slice(6);
                  if (data === '[DONE]') continue;
                  
                  try {
                    const parsed = JSON.parse(data);
                    if (parsed.content) {
                      content += parsed.content;
                    }
                  } catch (e) {
                    // å¿½ç•¥è§£æéŒ¯èª¤
                  }
                }
              }
            }
            
            resultBlock.innerHTML = `<div class="mode3-result-content">${content}</div>`;
            button.innerHTML = '<span>ğŸš€</span> é‡æ–°ç”Ÿæˆ';
            button.disabled = false;
          } else {
            throw new Error('ç”Ÿæˆå¤±æ•—');
          }
        } catch (error) {
          console.error('ç”Ÿæˆä»Šæ—¥è…³æœ¬å¤±æ•—:', error);
          button.innerHTML = '<span>âŒ</span> ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦';
          button.disabled = false;
        }
      }

      // å„²å­˜çµæœ
      function saveMode3Result() {
        showToast('çµæœå·²å„²å­˜åˆ°å€‹äººè³‡æ–™åº«', 3000);
        // é€™è£¡æ‡‰è©²èª¿ç”¨å¾Œç«¯APIå„²å­˜çµæœ
      }

      // é‡æ–°ç”Ÿæˆçµæœ
      function regenerateMode3Result() {
        const activeTab = document.querySelector('.mode3-tab.active');
        if (activeTab) {
          const tabName = activeTab.textContent.includes('Profile') ? 'profile' : 
                         activeTab.textContent.includes('è¦åŠƒ') ? 'plan' : 'scripts';
          
          if (tabName === 'profile') {
            generateMode3IPProfile();
          } else if (tabName === 'plan') {
            generateMode314DayPlan();
          } else if (tabName === 'scripts') {
            generateMode3TodayScripts();
          }
        }
      }

      // åŒ¯å‡ºçµæœ
      function exportMode3Result() {
        const activeTab = document.querySelector('.mode3-tab.active');
        const tabName = activeTab.textContent.includes('Profile') ? 'profile' : 
                       activeTab.textContent.includes('è¦åŠƒ') ? 'plan' : 'scripts';
        
        const resultBlock = document.getElementById(`mode3-${tabName}-result`);
        const content = resultBlock.querySelector('.mode3-result-content');
        
        if (content) {
          const data = {
            type: tabName,
            content: content.innerHTML,
            timestamp: new Date().toISOString()
          };
          
          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `ip-${tabName}-${Date.now()}.json`;
          a.click();
          URL.revokeObjectURL(url);
          
          showToast('çµæœå·²åŒ¯å‡ºç‚ºJSONæª”æ¡ˆ', 3000);
        } else {
          showToast('æ²’æœ‰å¯åŒ¯å‡ºçš„å…§å®¹', 3000);
        }
      }

      // åˆå§‹åŒ–æ¨¡å¼3
      function initializeMode3() {
        // è¨­ç½®èªªæ˜æ¬„ä½é è¨­ç‚ºæ”¶èµ·ç‹€æ…‹
        setTimeout(() => {
          const instructions = document.querySelector('.mode3-instructions');
          const chatMessages = document.querySelector('.mode3-chat-messages');
          if (instructions && chatMessages) {
            instructions.classList.add('collapsed');
            chatMessages.classList.add('expanded');
          }
        }, 100);
        
        // è¨­ç½®è¼¸å…¥æ¡†Enteréµç™¼é€
        const input = document.getElementById('mode3-message-input');
        if (input) {
          input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              sendMode3Message();
            }
          });
        }
        
        // è¼‰å…¥æ­·å²å°è©±è¨˜éŒ„
        loadMode3History();
      }
      
      // è¼‰å…¥IPäººè¨­è¦åŠƒæ¨¡å¼çš„æ­·å²å°è©±
      async function loadMode3History() {
        // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
        if (!ipPlanningUser?.user_id || !ipPlanningToken) {
          console.log('æœªç™»å…¥ï¼Œè·³éè¼‰å…¥æ­·å²å°è©±');
          return;
        }
        
        console.log('é–‹å§‹è¼‰å…¥IPäººè¨­è¦åŠƒæ­·å²å°è©±ï¼Œç”¨æˆ¶ID:', ipPlanningUser.user_id);
        
        try {
          // è¼‰å…¥å°è©±è¨˜éŒ„
          const conversationsResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/conversations/${ipPlanningUser.user_id}`);
          
          if (conversationsResponse.ok) {
            const conversationsData = await conversationsResponse.json();
            console.log('è¼‰å…¥çš„å°è©±è¨˜éŒ„:', conversationsData);
            
            // é¡¯ç¤ºæ­·å²å°è©±åˆ°èŠå¤©å€åŸŸ
            if (conversationsData.conversations && conversationsData.conversations.length > 0) {
              displayMode3History(conversationsData.conversations);
            }
          } else {
            console.error('è¼‰å…¥å°è©±è¨˜éŒ„å¤±æ•—:', conversationsResponse.status);
          }
        } catch (error) {
          console.error('è¼‰å…¥æ­·å²å°è©±éŒ¯èª¤:', error);
        }
      }
      
      // é¡¯ç¤ºæ­·å²å°è©±åˆ°IPäººè¨­è¦åŠƒèŠå¤©å€åŸŸ
      function displayMode3History(conversations) {
        const messagesContainer = document.getElementById('mode3-chat-messages');
        if (!messagesContainer) return;
        
        // æ¸…ç©ºç¾æœ‰çš„æ­¡è¿è¨Šæ¯
        messagesContainer.innerHTML = '';
        
        // é¡¯ç¤ºæ­·å²å°è©±
        conversations.forEach(conversation => {
          if (conversation.messages && conversation.messages.length > 0) {
            conversation.messages.forEach(message => {
              if (message.role === 'user' || message.role === 'assistant') {
                addMode3Message(message.role, message.content);
              }
            });
          }
        });
        
        // æ»¾å‹•åˆ°åº•éƒ¨
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }
      
      // è¼‰å…¥AIé¡§å•æ¨¡å¼çš„æ­·å²å°è©±
      async function loadMode2History() {
        // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
        if (!ipPlanningUser?.user_id || !ipPlanningToken) {
          console.log('æœªç™»å…¥ï¼Œè·³éè¼‰å…¥AIé¡§å•æ­·å²å°è©±');
          return;
        }
        
        console.log('é–‹å§‹è¼‰å…¥AIé¡§å•æ­·å²å°è©±ï¼Œç”¨æˆ¶ID:', ipPlanningUser.user_id);
        
        try {
          // è¼‰å…¥å°è©±è¨˜éŒ„
          const conversationsResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/conversations/${ipPlanningUser.user_id}`);
          
          if (conversationsResponse.ok) {
            const conversationsData = await conversationsResponse.json();
            console.log('è¼‰å…¥çš„AIé¡§å•å°è©±è¨˜éŒ„:', conversationsData);
            
            // é¡¯ç¤ºæ­·å²å°è©±åˆ°èŠå¤©å€åŸŸ
            if (conversationsData.conversations && conversationsData.conversations.length > 0) {
              displayMode2History(conversationsData.conversations);
            }
          } else {
            console.error('è¼‰å…¥AIé¡§å•å°è©±è¨˜éŒ„å¤±æ•—:', conversationsResponse.status);
          }
        } catch (error) {
          console.error('è¼‰å…¥AIé¡§å•æ­·å²å°è©±éŒ¯èª¤:', error);
        }
      }
      
      // é¡¯ç¤ºæ­·å²å°è©±åˆ°AIé¡§å•èŠå¤©å€åŸŸ
      function displayMode2History(conversations) {
        const messagesContainer = document.getElementById('chatMessages');
        if (!messagesContainer) return;
        
        // æ¸…ç©ºç¾æœ‰çš„æ­¡è¿è¨Šæ¯
        messagesContainer.innerHTML = '';
        
        // é¡¯ç¤ºæ­·å²å°è©±
        conversations.forEach(conversation => {
          if (conversation.messages && conversation.messages.length > 0) {
            conversation.messages.forEach(message => {
              if (message.role === 'user' || message.role === 'assistant') {
                const messageDiv = createMessage(message.role, message.content);
                messagesContainer.appendChild(messageDiv);
              }
            });
          }
        });
        
        // æ»¾å‹•åˆ°åº•éƒ¨
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      // é—œé–‰èŠå¤©å®¹å™¨
      function closeChatContainer() {
      }
      
      // IPäººè¨­è¦åŠƒä½¿ç”¨èªªæ˜æŠ½å±œæ§åˆ¶
      function toggleMode3InstructionsDrawer() {
        const overlay = document.getElementById('mode3InstructionsOverlay');
        const drawer = document.getElementById('mode3InstructionsDrawer');
        
        if (overlay && drawer) {
          const isOpen = overlay.classList.contains('open');
          
          if (isOpen) {
            closeMode3InstructionsDrawer();
          } else {
            openMode3InstructionsDrawer();
          }
        }
      }
      
      function openMode3InstructionsDrawer() {
        const overlay = document.getElementById('mode3InstructionsOverlay');
        const drawer = document.getElementById('mode3InstructionsDrawer');
        
        if (overlay && drawer) {
          overlay.classList.add('open');
          drawer.classList.add('open');
          document.body.style.overflow = 'hidden';
        }
      }
      
      function closeMode3InstructionsDrawer() {
        const overlay = document.getElementById('mode3InstructionsOverlay');
        const drawer = document.getElementById('mode3InstructionsDrawer');
        
        if (overlay && drawer) {
          overlay.classList.remove('open');
          drawer.classList.remove('open');
          document.body.style.overflow = '';
        }
      }
      
      // IPäººè¨­è¦åŠƒç”ŸæˆçµæœæŠ½å±œæ§åˆ¶
      function toggleMode3ResultsDrawer() {
        const overlay = document.getElementById('mode3ResultsOverlay');
        const drawer = document.getElementById('mode3ResultsDrawer');
        
        if (overlay && drawer) {
          const isOpen = overlay.classList.contains('open');
          
          if (isOpen) {
            closeMode3ResultsDrawer();
          } else {
            openMode3ResultsDrawer();
          }
        }
      }
      
      function openMode3ResultsDrawer() {
        const overlay = document.getElementById('mode3ResultsOverlay');
        const drawer = document.getElementById('mode3ResultsDrawer');
        
        if (overlay && drawer) {
          overlay.classList.add('open');
          drawer.classList.add('open');
          document.body.style.overflow = 'hidden';
        }
      }
      
      function closeMode3ResultsDrawer() {
        const overlay = document.getElementById('mode3ResultsOverlay');
        const drawer = document.getElementById('mode3ResultsDrawer');
        
        if (overlay && drawer) {
          overlay.classList.remove('open');
          drawer.classList.remove('open');
          document.body.style.overflow = '';
        }
      }

      // æ‰‹æ©Ÿç‰ˆæŠ½å±œæ§åˆ¶å‡½æ•¸
      function toggleMobileDrawer() {
        const drawer = document.getElementById('mobileDrawer');
        const overlay = document.getElementById('mobileDrawerOverlay');
        
        if (drawer && overlay) {
          const isOpen = drawer.classList.contains('open');
          
          if (isOpen) {
            closeMobileDrawer();
          } else {
            openMobileDrawer();
          }
        }
      }

      function openMobileDrawer() {
        const drawer = document.getElementById('mobileDrawer');
        const overlay = document.getElementById('mobileDrawerOverlay');
        
        if (drawer && overlay) {
          drawer.classList.add('open');
          overlay.style.display = 'block';
          document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»¾å‹•
        }
      }

      function closeMobileDrawer() {
        const drawer = document.getElementById('mobileDrawer');
        const overlay = document.getElementById('mobileDrawerOverlay');
        
        if (drawer && overlay) {
          drawer.classList.remove('open');
          overlay.style.display = 'none';
          document.body.style.overflow = ''; // æ¢å¾©èƒŒæ™¯æ»¾å‹•
        }
      }


      // åœ¨é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–æ¨¡å¼3
      window.addEventListener('load', function() {
        setTimeout(() => {
          try {
            initializeMode3();
          } catch (error) {
            console.error('åˆå§‹åŒ–éŒ¯èª¤:', error);
          }
        }, 1000);
      });
    </script>
    
    <!-- IPäººè¨­è¦åŠƒä½¿ç”¨èªªæ˜æŠ½å±œ -->
    <div class="mode3-instructions-overlay" id="mode3InstructionsOverlay" onclick="closeMode3InstructionsDrawer()"></div>
    <div class="mode3-instructions-drawer" id="mode3InstructionsDrawer">
      <div class="mode3-instructions-drawer-header">
        <h3>ğŸ“‹ IPäººè¨­è¦åŠƒä½¿ç”¨èªªæ˜</h3>
        <button class="mode3-instructions-drawer-close" onclick="closeMode3InstructionsDrawer()">âœ•</button>
      </div>
      <div class="mode3-instructions-drawer-content">
        <p><strong>ğŸ¯ IPäººè¨­è¦åŠƒæ¨¡å¼</strong></p>
        <p>é€éèˆ‡AIæ·±åº¦å°è©±ï¼Œè¨˜éŒ„æ‚¨çš„äººç”Ÿæ›²ç·šå’Œå€‹äººç‰¹è‰²ï¼Œè®“AIå”åŠ©æ‚¨å»ºç«‹å®Œæ•´çš„IPäººè¨­ã€‚</p>
        
        <p><strong>ğŸš€ æ“ä½œæ­¥é©Ÿï¼š</strong></p>
        <div class="mode3-step-guide">
          <div class="mode3-step">
            <div class="mode3-step-number">1</div>
            <div class="mode3-step-content">
              <strong>é–‹å§‹å°è©±</strong>
              <p>é»æ“Šå¿«é€ŸæŒ‰éˆ•æˆ–è¼¸å…¥æ¡†ï¼Œèˆ‡AIåˆ†äº«æ‚¨çš„èƒŒæ™¯ã€å°ˆé•·ã€åƒ¹å€¼è§€</p>
            </div>
          </div>
          <div class="mode3-step">
            <div class="mode3-step-number">2</div>
            <div class="mode3-step-content">
              <strong>æ·±åº¦äº¤æµ</strong>
              <p>å»ºè­°é€²è¡Œ5-10è¼ªå°è©±ï¼Œè®“AIå……åˆ†äº†è§£æ‚¨çš„å€‹äººç‰¹è‰²å’Œç›®æ¨™</p>
            </div>
          </div>
          <div class="mode3-step">
            <div class="mode3-step-number">3</div>
            <div class="mode3-step-content">
              <strong>ç”Ÿæˆçµæœ</strong>
              <p>éš¨æ™‚é»æ“Šå³å´ç”ŸæˆæŒ‰éˆ•ï¼Œç„¡éœ€ç­‰å¾…AIæé†’</p>
            </div>
          </div>
        </div>
        
        <p><strong>ğŸ’¬ å°è©±å»ºè­°ï¼š</strong></p>
        <ul>
          <li>åˆ†äº«æ‚¨çš„å°ˆæ¥­ç¶“é©—å’Œæˆå°±</li>
          <li>è¨è«–æ‚¨çš„åƒ¹å€¼è§€å’Œäººç”Ÿç›®æ¨™</li>
          <li>æè¿°æ‚¨çš„å€‹æ€§å’Œæºé€šé¢¨æ ¼</li>
          <li>æ¢ç´¢æ‚¨æƒ³åˆ†äº«çš„å…§å®¹æ–¹å‘</li>
        </ul>
        
        <p><strong>ğŸ“Š ç”Ÿæˆå…§å®¹ï¼š</strong></p>
        <div class="mode3-result-types">
          <div class="mode3-result-type">
            <strong>ğŸ­ IP Profile</strong>
            <p>å€‹äººå“ç‰Œæª”æ¡ˆï¼šäººè¨­æ¨™ç±¤ã€å“ç‰ŒåŸå‹ã€èªæ°£è¨­å®š</p>
          </div>
          <div class="mode3-result-type">
            <strong>ğŸ“… 14å¤©è¦åŠƒ</strong>
            <p>è©³ç´°çš„çŸ­å½±éŸ³å…§å®¹è¦åŠƒè¡¨</p>
          </div>
          <div class="mode3-result-type">
            <strong>ğŸ“ ä»Šæ—¥è…³æœ¬</strong>
            <p>3æ”¯å³æ™‚å¯ç”¨çš„çŸ­å½±éŸ³è…³æœ¬</p>
          </div>
        </div>
        
        <p><strong>ğŸ’¡ é‡è¦æé†’ï¼š</strong></p>
        <ul>
          <li>âœ… <strong>éš¨æ™‚å¯ä»¥ç”Ÿæˆ</strong>ï¼šä¸éœ€è¦ç­‰AIæé†’</li>
          <li>âœ… <strong>å»ºè­°é †åº</strong>ï¼šIP Profile â†’ 14å¤©è¦åŠƒ â†’ ä»Šæ—¥è…³æœ¬</li>
          <li>âœ… <strong>å¯ä»¥é‡è¤‡ç”Ÿæˆ</strong>ï¼šä¸æ»¿æ„å°±é»ã€ŒğŸ”„ é‡æ–°ç”Ÿæˆã€</li>
          <li>âœ… <strong>AIæœ‰è¨˜æ†¶</strong>ï¼šæœƒè¨˜ä½æ‚¨ä¹‹å‰èªªéçš„å…§å®¹</li>
        </ul>
      </div>
    </div>
    
    <!-- IPäººè¨­è¦åŠƒç”ŸæˆçµæœæŠ½å±œ -->
    <div class="mode3-results-overlay" id="mode3ResultsOverlay" onclick="closeMode3ResultsDrawer()"></div>
    <div class="mode3-results-drawer" id="mode3ResultsDrawer">
      <div class="mode3-results-drawer-header">
        <h3>ğŸ“Š ç”Ÿæˆçµæœ</h3>
        <button class="mode3-results-drawer-close" onclick="closeMode3ResultsDrawer()">âœ•</button>
      </div>
      <div class="mode3-results-drawer-content">
        <!-- çµæœæ¨™ç±¤ -->
        <div class="mode3-tabs">
          <button class="mode3-tab active" onclick="switchMode3Tab('profile')">ã€ŠIP Profileã€‹</button>
          <button class="mode3-tab" onclick="switchMode3Tab('plan')">ã€Š14å¤©çŸ­å½±éŸ³è¦åŠƒè¡¨ã€‹</button>
          <button class="mode3-tab" onclick="switchMode3Tab('scripts')">ã€Šä»Šæ—¥3æ”¯è…³æœ¬ã€‹</button>
        </div>

        <!-- çµæœå…§å®¹ -->
        <div class="mode3-results-content">
          <!-- IP Profile çµæœ -->
          <div id="mode3-profile-result" class="mode3-result-block active">
            <div class="mode3-result-placeholder">
              <div class="mode3-placeholder-icon">ğŸ­</div>
              <h4>IP Profile</h4>
              <p>èˆ‡AIå°è©±å¾Œï¼Œå°‡åœ¨æ­¤é¡¯ç¤ºæ‚¨çš„å€‹äººå“ç‰Œæª”æ¡ˆ</p>
              <button class="mode3-generate-btn" onclick="generateMode3IPProfile()">
                <span>ğŸš€</span> ç”ŸæˆIP Profile
              </button>
            </div>
          </div>

          <!-- 14å¤©è¦åŠƒçµæœ -->
          <div id="mode3-plan-result" class="mode3-result-block">
            <div class="mode3-result-placeholder">
              <div class="mode3-placeholder-icon">ğŸ“…</div>
              <h4>14å¤©çŸ­å½±éŸ³è¦åŠƒ</h4>
              <p>åŸºæ–¼æ‚¨çš„IP Profileï¼Œç”Ÿæˆè©³ç´°çš„å…§å®¹è¦åŠƒ</p>
              <button class="mode3-generate-btn" onclick="generateMode314DayPlan()">
                <span>ğŸš€</span> ç”Ÿæˆ14å¤©è¦åŠƒ
              </button>
            </div>
          </div>

          <!-- ä»Šæ—¥è…³æœ¬çµæœ -->
          <div id="mode3-scripts-result" class="mode3-result-block">
            <div class="mode3-result-placeholder">
              <div class="mode3-placeholder-icon">ğŸ“</div>
              <h4>ä»Šæ—¥3æ”¯è…³æœ¬</h4>
              <p>æ ¹æ“šæ‚¨çš„è¦åŠƒï¼Œç”Ÿæˆä»Šæ—¥å¯ç”¨çš„è…³æœ¬</p>
              <button class="mode3-generate-btn" onclick="generateMode3TodayScripts()">
                <span>ğŸš€</span> ç”Ÿæˆä»Šæ—¥è…³æœ¬
              </button>
            </div>
          </div>
        </div>
        
        <!-- æ“ä½œæŒ‰éˆ• -->
        <div class="mode3-result-actions">
          <button class="mode3-action-btn" onclick="saveMode3Result()" title="å„²å­˜çµæœ">
            <span>ğŸ’¾</span> å„²å­˜çµæœ
          </button>
          <button class="mode3-action-btn" onclick="regenerateMode3Result()" title="é‡æ–°ç”Ÿæˆ">
            <span>ğŸ”„</span> é‡æ–°ç”Ÿæˆ
          </button>
          <button class="mode3-action-btn" onclick="exportMode3Result()" title="åŒ¯å‡ºçµæœ">
            <span>ğŸ“¤</span> åŒ¯å‡ºçµæœ
          </button>
        </div>
      </div>
    </div>
    
    <!-- æ‰‹æ©Ÿç‰ˆæŠ½å±œå°èˆª -->
    <div class="mobile-drawer-overlay" id="mobileDrawerOverlay" onclick="closeMobileDrawer()"></div>
    <div class="mobile-drawer" id="mobileDrawer">
      <div class="mobile-drawer-header">
        <h3>é¸å–®</h3>
        <button class="mobile-drawer-close" onclick="closeMobileDrawer()">âœ•</button>
      </div>
      <div class="mobile-drawer-content">
        <a href="#homepage" class="mobile-drawer-item" onclick="switchPage('homepage'); closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon">ğŸ </span>
          <span class="mobile-drawer-text">é¦–é </span>
        </a>
        <a href="#mode1" class="mobile-drawer-item" onclick="switchPage('mode1'); closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon"><i class="fas fa-magic"></i></span>
          <span class="mobile-drawer-text">ä¸€éµç”Ÿæˆ</span>
        </a>
        <a href="#mode2" class="mobile-drawer-item" onclick="switchPage('mode2'); closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon"><i class="fas fa-comments"></i></span>
          <span class="mobile-drawer-text">AIé¡§å•</span>
        </a>
        <a href="#mode3" class="mobile-drawer-item" onclick="switchPage('mode3'); closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon"><i class="fas fa-user-tie"></i></span>
          <span class="mobile-drawer-text">IPäººè¨­</span>
        </a>
        <a href="#forum" class="mobile-drawer-item" onclick="switchPage('forum'); closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon"><i class="fas fa-comments"></i></span>
          <span class="mobile-drawer-text">è«–å£‡ä»‹ç´¹</span>
        </a>
        <a href="#guide" class="mobile-drawer-item" onclick="switchPage('guide'); closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon"><i class="fas fa-book-open"></i></span>
          <span class="mobile-drawer-text">å¯¦æˆ°æŒ‡å—</span>
        </a>
        <a href="#userDB" id="mobileUserDBTab" class="mobile-drawer-item" onclick="switchPage('userDB'); closeMobileDrawer(); return false;" style="display:none;">
          <span class="mobile-drawer-icon">ğŸ‘¤</span>
          <span class="mobile-drawer-text">è³‡æ–™åº«</span>
      </a>
    </div>
    </div>

  </body>
</html>
<script>
  (function(){
    function goToPricing(plan){
      var base = 'subscription.html';
      var url = plan ? (base + '?plan=' + encodeURIComponent(plan)) : base;
      window.location.href = url;
    }
    function smoothScrollTo(id){
      try{
        var el = document.getElementById(id);
        if(el){ el.scrollIntoView({behavior:'smooth'}); }
      }catch(_){ window.location.hash = '#' + id; }
    }
    function goLogin(){
      // ä¸€å¾‹ä½¿ç”¨ä¸»è¦–çª—è·³è½‰ï¼ˆfb=å‰ç«¯åŸºåº•ç¶²å€ï¼‰
      try{
        var fb = encodeURIComponent(window.location.origin);
        window.location.href = 'https://aivideobackend.zeabur.app/api/auth/google?fb=' + fb;
      }catch(_){
        window.location.href = 'https://aivideobackend.zeabur.app/api/auth/google';
      }
    }
    document.addEventListener('click', function(e){
      var t = e.target;
      if (!t) return;
      var txt = (t.innerText||'').trim();
      if (txt.includes('ç«‹å³å•Ÿå‹•') && txt.includes('AI')){ e.preventDefault(); goToPricing(); }
      if (txt === 'ç™»å…¥è§£é–ä½ çš„å°ˆå±¬ AI æ™ºèƒ½é«”'){ e.preventDefault(); goToLogin(); }
      if (txt === 'ç«‹å³è¨‚é–±'){ e.preventDefault(); goToPricing(); }
      if (txt.includes('å·²è¨‚é–±') && txt.includes('ç™»å…¥ä½¿ç”¨')){ e.preventDefault(); goLogin(); }
    }, true);
    window.goToPricing = goToPricing;
    window.smoothScrollTo = smoothScrollTo;
    window.goLogin = goLogin;
  })();
</script>
</html>