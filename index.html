<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    
    <!-- Primary SEO Meta Tags -->
    <title>ReelMind | AI çŸ­å½±éŸ³æ™ºèƒ½é«” - AI ç”Ÿæˆè…³æœ¬ Ã— AI å¸³è™Ÿå®šä½ Ã— çˆ†æ¬¾çŸ­å½±éŸ³</title>
    <meta name="title" content="ReelMind | AI çŸ­å½±éŸ³æ™ºèƒ½é«” - AI ç”Ÿæˆè…³æœ¬ Ã— AI å¸³è™Ÿå®šä½ Ã— çˆ†æ¬¾çŸ­å½±éŸ³" />
    <meta name="description" content="ReelMind AI çŸ­å½±éŸ³æ™ºèƒ½é«”ï¼šAI ç”Ÿæˆè…³æœ¬ã€AI å¸³è™Ÿå®šä½ã€AI æ™ºèƒ½é«”ä¸€éµç”Ÿæˆçˆ†æ¬¾çŸ­å½±éŸ³ã€‚æ”¯æ´ IGã€TikTokã€YouTube Shortsã€‚æœå‹™åœ°å€ï¼šå°åŒ—ã€å°ä¸­ã€é«˜é›„ã€‚æ¯å¤©ä¸åˆ° NT$66ï¼Œå…¨å¹´ AI å¹«ä½ å¸³è™Ÿå®šä½ã€ç”Ÿæˆéˆæ„Ÿé¸é¡Œèˆ‡çˆ†æ¬¾è…³æœ¬ã€‚" />
    <meta name="keywords" content="AIçŸ­å½±éŸ³,AIæ™ºèƒ½é«”,AIç”Ÿæˆè…³æœ¬,AIå¸³è™Ÿå®šä½,çŸ­å½±éŸ³è£½ä½œ,IGçŸ­å½±éŸ³,TikTokçŸ­å½±éŸ³,YouTube Shorts,çŸ­å½±éŸ³è…³æœ¬,çŸ­å½±éŸ³éˆæ„Ÿ,çŸ­å½±éŸ³å·¥å…·,AIçŸ­å½±éŸ³å¹³å°,çŸ­å½±éŸ³AI,AIçŸ­å½±éŸ³ç”Ÿæˆå™¨,çŸ­å½±éŸ³å…§å®¹å‰µä½œ,å°åŒ—çŸ­å½±éŸ³,å°ä¸­çŸ­å½±éŸ³,é«˜é›„çŸ­å½±éŸ³,å°ç£çŸ­å½±éŸ³,çŸ­å½±éŸ³è¡ŒéŠ·,çŸ­å½±éŸ³è…³æœ¬ç”Ÿæˆ,AIçŸ­å½±éŸ³åŠ©æ‰‹,çŸ­å½±éŸ³å‰µä½œè€…å·¥å…·" />
    <meta name="author" content="ReelMind AI" />
    <meta name="robots" content="index, follow" />
    <meta name="language" content="zh-Hant" />
    <meta name="revisit-after" content="7 days" />
    <link rel="canonical" href="https://aivideonew.zeabur.app/" />
    
    <!-- GEO / Location Meta Tags -->
    <meta name="geo.region" content="TW" />
    <meta name="geo.placename" content="å°ç£" />
    <meta name="geo.position" content="25.0330;121.5654" />
    <meta name="ICBM" content="25.0330, 121.5654" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://aivideonew.zeabur.app/" />
    <meta property="og:title" content="ReelMind | AI çŸ­å½±éŸ³æ™ºèƒ½é«” - AI ç”Ÿæˆè…³æœ¬ Ã— AI å¸³è™Ÿå®šä½" />
    <meta property="og:description" content="AI çŸ­å½±éŸ³æ™ºèƒ½é«”ï¼šæ¯å¤©ä¸åˆ° NT$66ï¼Œå…¨å¹´ AI å¹«ä½ å¸³è™Ÿå®šä½ã€ç”Ÿæˆéˆæ„Ÿé¸é¡Œèˆ‡çˆ†æ¬¾è…³æœ¬ã€‚æ”¯æ´ IGã€TikTokã€YouTube Shortsã€‚" />
    <meta property="og:image" content="https://aivideonew.zeabur.app/assets/images/og-image.jpg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="ReelMind AI çŸ­å½±éŸ³æ™ºèƒ½é«”" />
    <meta property="og:locale" content="zh_TW" />
    <meta property="og:site_name" content="ReelMind" />
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://aivideonew.zeabur.app/" />
    <meta name="twitter:title" content="ReelMind | AI çŸ­å½±éŸ³æ™ºèƒ½é«” - AI ç”Ÿæˆè…³æœ¬ Ã— AI å¸³è™Ÿå®šä½" />
    <meta name="twitter:description" content="AI çŸ­å½±éŸ³æ™ºèƒ½é«”ï¼šæ¯å¤©ä¸åˆ° NT$66ï¼Œå…¨å¹´ AI å¹«ä½ å¸³è™Ÿå®šä½ã€ç”Ÿæˆéˆæ„Ÿé¸é¡Œèˆ‡çˆ†æ¬¾è…³æœ¬ã€‚" />
    <meta name="twitter:image" content="https://aivideonew.zeabur.app/assets/images/og-image.jpg" />
    <meta name="twitter:image:alt" content="ReelMind AI çŸ­å½±éŸ³æ™ºèƒ½é«”" />
    
    <!-- Additional SEO -->
    <meta name="theme-color" content="#2563EB" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="ReelMind" />
    
    <!-- Favicon: ä½¿ç”¨ SVG data URIï¼Œé¿å… 404 éŒ¯èª¤ -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EğŸ¬%3C/text%3E%3C/svg%3E" />
    
    <!-- SEO çµæ§‹åŒ–è³‡æ–™ -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "ReelMindï½œAI çŸ­å½±éŸ³å¹³å°",
      "applicationCategory": "Multimedia",
      "operatingSystem": "Web",
      "inLanguage": "zh-Hant",
      "areaServed": "TW",
      "offers": { 
        "@type": "Offer", 
        "price": "3980", 
        "priceCurrency": "TWD",
        "priceSpecification": {
          "@type": "UnitPriceSpecification",
          "price": "3980",
          "priceCurrency": "TWD"
        }
      },
      "description": "AI çŸ­å½±éŸ³æ™ºèƒ½é«”ï¼šAI ç”Ÿæˆè…³æœ¬ã€AI å¸³è™Ÿå®šä½ã€AI æ™ºèƒ½é«”ä¸€éµç”Ÿæˆçˆ†æ¬¾çŸ­å½±éŸ³ã€‚æ”¯æ´ IGã€TikTokã€YouTube Shortsã€‚æœå‹™åœ°å€ï¼šå°åŒ—ã€å°ä¸­ã€é«˜é›„ã€‚æ¯å¤©ä¸åˆ° NT$66ï¼Œå…¨å¹´ AI å¹«ä½ å¸³è™Ÿå®šä½ã€ç”Ÿæˆéˆæ„Ÿé¸é¡Œèˆ‡çˆ†æ¬¾è…³æœ¬ã€‚",
      "url": "https://aivideonew.zeabur.app/",
      "applicationSubCategory": "AI çŸ­å½±éŸ³å·¥å…·",
      "keywords": "AIçŸ­å½±éŸ³,AIæ™ºèƒ½é«”,AIç”Ÿæˆè…³æœ¬,AIå¸³è™Ÿå®šä½,çŸ­å½±éŸ³è£½ä½œ",
      "provider": {
        "@type": "Organization",
        "name": "ReelMind AI",
        "url": "https://aivideonew.zeabur.app/",
        "address": {
          "@type": "PostalAddress",
          "addressCountry": "TW",
          "addressRegion": "å°ç£"
        }
      },
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "ratingCount": "150"
      },
      "offers": [
        {
          "@type": "Offer",
          "name": "æœˆè²»æ–¹æ¡ˆ",
          "price": "2980",
          "priceCurrency": "TWD",
          "availability": "https://schema.org/InStock"
        },
        {
          "@type": "Offer",
          "name": "å¹´è²»æ–¹æ¡ˆ",
          "price": "23760",
          "priceCurrency": "TWD",
          "availability": "https://schema.org/InStock"
        }
      ]
    }
    </script>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        { 
          "@type": "Question", 
          "name": "ä»€éº¼æ˜¯ AI çŸ­å½±éŸ³ï¼Ÿ", 
          "acceptedAnswer": { 
            "@type": "Answer", 
            "text": "AI ä¾ç”¢æ¥­èˆ‡å¹³å°ï¼Œè‡ªå‹•ç”Ÿæˆé¡Œæã€è…³æœ¬ã€å£æ’­ã€åˆ†é¡ï¼Œç¸®çŸ­è£½ä½œæ™‚é–“ä¸¦æå‡ä¸Šç‰‡é »ç‡ï¼Œæ”¯æ´å°åŒ—ã€å°ä¸­ã€é«˜é›„ç­‰åœ°å€çš„å‰µä½œè€…ã€‚" 
          } 
        },
        { 
          "@type": "Question", 
          "name": "AI ç”Ÿæˆè…³æœ¬æ€éº¼é‹ä½œï¼Ÿ", 
          "acceptedAnswer": { 
            "@type": "Answer", 
            "text": "è¼¸å…¥ä¸»é¡Œèˆ‡å¹³å°ï¼Œç³»çµ±è¼¸å‡ºé–‹å ´ Hookã€æ©‹æ®µé‡é»èˆ‡ CTAï¼Œä¸¦èƒ½è‡ªå‹•åœ¨åœ°åŒ–èªæ°£ï¼Œé©åˆå°ç£å¸‚å ´çš„å‰µä½œè€…ä½¿ç”¨ã€‚" 
          } 
        },
        { 
          "@type": "Question", 
          "name": "AI å¸³è™Ÿå®šä½èƒ½å¹«ä»€éº¼ï¼Ÿ", 
          "acceptedAnswer": { 
            "@type": "Answer", 
            "text": "åˆ†æå—çœ¾ã€å…§å®¹æ”¯æŸ±èˆ‡ä¸Šç‰‡ç¯€å¥ï¼Œå¹«åŠ©ä½ å¿«é€Ÿæ‰¾åˆ°å¸³è™Ÿé¢¨æ ¼èˆ‡å®šä½ï¼Œç‰¹åˆ¥é‡å° IGã€TikTokã€YouTube Shorts ç­‰å¹³å°å„ªåŒ–ã€‚" 
          } 
        }
      ]
    }
    </script>
    
    <!-- GEO / Local Business çµæ§‹åŒ–è³‡æ–™ -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "LocalBusiness",
      "name": "ReelMind AI çŸ­å½±éŸ³æ™ºèƒ½é«”",
      "description": "AI çŸ­å½±éŸ³æ™ºèƒ½é«”æœå‹™ï¼Œæä¾› AI ç”Ÿæˆè…³æœ¬ã€AI å¸³è™Ÿå®šä½ç­‰æœå‹™",
      "url": "https://aivideonew.zeabur.app/",
      "telephone": "+886-2-1234-5678",
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "TW",
        "addressRegion": "å°ç£",
        "addressLocality": "å°åŒ—å¸‚"
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": "25.0330",
        "longitude": "121.5654"
      },
      "areaServed": [
        {
          "@type": "City",
          "name": "å°åŒ—å¸‚"
        },
        {
          "@type": "City",
          "name": "å°ä¸­å¸‚"
        },
        {
          "@type": "City",
          "name": "é«˜é›„å¸‚"
        }
      ],
      "priceRange": "NT$2,980 - NT$23,760"
    }
    </script>
    
    <!-- Organization çµæ§‹åŒ–è³‡æ–™ -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "ReelMind AI",
      "url": "https://aivideonew.zeabur.app/",
      "logo": "https://aivideonew.zeabur.app/assets/images/logo.png",
      "description": "AI çŸ­å½±éŸ³æ™ºèƒ½é«”å¹³å°ï¼Œæä¾› AI ç”Ÿæˆè…³æœ¬ã€AI å¸³è™Ÿå®šä½ç­‰æœå‹™",
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "TW",
        "addressRegion": "å°ç£"
      },
      "sameAs": [
        "https://www.facebook.com/reelmindai",
        "https://www.instagram.com/reelmindai"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "email": "aiagent168168@gmail.com",
        "contactType": "customer service",
        "areaServed": "TW",
        "availableLanguage": ["zh-Hant", "zh-Hans"]
      }
    }
    </script>
    
    <!-- Markdown å’Œèªæ³•é«˜äº®å‡½å¼åº« -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
    <!-- Highlight.js: ä½¿ç”¨ç€è¦½å™¨ UMD ç‰ˆæœ¬ï¼ˆ/build/ è€Œé /lib/ï¼‰é¿å… module is not defined éŒ¯èª¤ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github.min.css">
    <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/javascript.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/python.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/css.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/languages/html.min.js"></script>
    <!-- Font Awesome åœ–æ¨™åº« -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- ReelMind å‹•ç•«å’Œæ¨£å¼ -->
    <link rel="stylesheet" href="assets/css/animations.css">
    <script defer src="assets/js/subscription-animations.js"></script>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {}
        }
      }
    </script>
    
    <!-- CSS æ–‡ä»¶ -->
    <link rel="stylesheet" href="assets/css/variables.css" />
    <link rel="stylesheet" href="assets/css/animations.css" />
    <link rel="stylesheet" href="assets/css/styles.css" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <script defer src="/assets/js/config.js"></script>
    <script defer src="/assets/js/auth.js"></script>
    <script defer src="/assets/js/api.js"></script>
    <script defer src="/assets/js/ui.js"></script>
    <script defer src="/assets/js/bootstrap.js"></script>
    
    <style>
      /* ä¸»é¡Œè®Šæ•¸ */
      :root {
        --bg-primary: #ffffff;
        --bg-secondary: #f9fafb;
        --bg-tertiary: #f3f4f6;
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --text-tertiary: #9ca3af;
        --border-color: #e5e7eb;
        --card-bg: #ffffff;
        --navbar-bg: #ffffff;
        --input-bg: #ffffff;
        --input-border: #e5e7eb;
        --button-bg: #3b82f6;
        --button-hover: #2563eb;
        --button-text: #ffffff;
        --shadow: rgba(0, 0, 0, 0.1);
      }
      
      .theme-dark {
        /* ä½¿ç”¨æ·±è‰²æ¼¸è®ŠèƒŒæ™¯ï¼Œé¿å…å…¨é»‘ */
        --bg-primary: #0a0e27;
        --bg-secondary: #1a1f3a;
        --bg-tertiary: #252b47;
        --text-primary: #f0f4ff;
        --text-secondary: #cbd5e1;
        --text-tertiary: #94a3b8;
        --border-color: #3d4a6b;
        --card-bg: #1e2640;
        --navbar-bg: #151a2e;
        --input-bg: #252b47;
        --input-border: #3d4a6b;
        --button-bg: #3b82f6;
        --button-hover: #2563eb;
        --button-text: #ffffff;
        --shadow: rgba(0, 0, 0, 0.4);
        /* æ–°å¢æ¼¸è®Šå’Œå¼·èª¿è‰² */
        --accent-blue: #3b82f6;
        --accent-purple: #8b5cf6;
        --accent-green: #10b981;
        --accent-orange: #f59e0b;
        --gradient-primary: linear-gradient(135deg, #1e2640 0%, #252b47 100%);
        --gradient-card: linear-gradient(135deg, #1e2640 0%, #252b47 50%, #1a1f3a 100%);
      }
      
      /* å…¨å±€æ·±è‰²æ¨¡å¼é©é…è¦å‰‡ */
      .theme-dark {
        color-scheme: dark;
        /* æ·»åŠ æ•´é«”èƒŒæ™¯æ¼¸è®Š */
        background: var(--gradient-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼å‹•ç•«æ•ˆæœ */
      @keyframes darkModeGlow {
        0%, 100% {
          box-shadow: 0 4px 20px rgba(59, 130, 246, 0.1);
        }
        50% {
          box-shadow: 0 4px 30px rgba(59, 130, 246, 0.2);
        }
      }
      
      @keyframes darkModeGradient {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      
      /* å…¨å±€æ·±è‰²æ¨¡å¼é©é… - è¦†è“‹æ‰€æœ‰ç¡¬ç·¨ç¢¼çš„èƒŒæ™¯è‰² */
      .theme-dark .top-navbar,
      .theme-dark .mode1-left,
      .theme-dark .mode1-right,
      .theme-dark .mode-card,
      .theme-dark .user-story-card,
      .theme-dark .login-container,
      .theme-dark .card,
      .theme-dark .setting-group,
      .theme-dark .db-section,
      .theme-dark .sidebar,
      .theme-dark .left-content,
      .theme-dark .user-drawer-sidebar,
      .theme-dark .user-drawer-content,
      .theme-dark .sidebar-page-container,
      .theme-dark .sidebar-page-content,
      .theme-dark .result-tabs,
      .theme-dark .chat-container,
      .theme-dark .results-container,
      .theme-dark .settings-container,
      .theme-dark [style*="background: white"],
      .theme-dark [style*="background:#ffffff"],
      .theme-dark [style*="background: #ffffff"],
      .theme-dark [style*="background:white"],
      .theme-dark [style*="background:#fff"] {
        background: var(--card-bg) !important;
        color: var(--text-primary) !important;
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      
      .theme-dark .sidebar-page-header,
      .theme-dark .result-tab:not(.active),
      .theme-dark [style*="background: #f8fafc"],
      .theme-dark [style*="background:#f8fafc"],
      .theme-dark [style*="background: #F8FAFC"],
      .theme-dark [style*="background:#f3f4f6"],
      .theme-dark [style*="background: #f3f4f6"] {
        background: var(--bg-secondary) !important;
        color: var(--text-primary) !important;
      }
      
      /* è¼¸å…¥æ¡†å’Œé¸æ“‡æ¡† */
      .theme-dark input,
      .theme-dark select,
      .theme-dark textarea {
        background: var(--input-bg) !important;
        color: var(--text-primary) !important;
        border-color: var(--input-border) !important;
      }
      
      /* æ‰€æœ‰æ–‡å­—å…ƒç´  */
      .theme-dark h1,
      .theme-dark h2,
      .theme-dark h3,
      .theme-dark h4,
      .theme-dark h5,
      .theme-dark h6,
      .theme-dark p,
      .theme-dark span,
      .theme-dark label,
      .theme-dark div,
      .theme-dark li,
      .theme-dark td,
      .theme-dark th,
      .theme-dark a:not(.navbar-tab):not(.btn):not(.logout-btn) {
        color: var(--text-primary) !important;
      }
      
      /* æ¬¡è¦æ–‡å­— */
      .theme-dark .setting-desc,
      .theme-dark .text-secondary,
      .theme-dark [style*="color: #6b7280"],
      .theme-dark [style*="color:#6b7280"],
      .theme-dark [style*="color: #64748B"],
      .theme-dark [style*="color:#64748B"],
      .theme-dark [style*="color: #475569"],
      .theme-dark [style*="color:#475569"],
      .theme-dark [style*="color: #374151"],
      .theme-dark [style*="color:#374151"],
      .theme-dark [style*="color: #1f2937"],
      .theme-dark [style*="color:#1f2937"],
      .theme-dark [style*="color: #1E293B"],
      .theme-dark [style*="color:#1E293B"] {
        color: var(--text-secondary) !important;
      }
      
      /* é‚Šæ¡†é¡è‰² */
      .theme-dark [style*="border: 1px solid #e5e7eb"],
      .theme-dark [style*="border:1px solid #e5e7eb"],
      .theme-dark [style*="border: 1px solid #E5E7EB"],
      .theme-dark [style*="border-bottom: 1px solid #e5e7eb"],
      .theme-dark [style*="border: 1px solid #d1d5db"],
      .theme-dark [style*="border:1px solid #d1d5db"],
      .theme-dark [style*="border: 1px solid #E2E8F0"],
      .theme-dark [style*="border:1px solid #E2E8F0"] {
        border-color: var(--border-color) !important;
      }
      
      /* çµæœæ¨™ç±¤ */
      .theme-dark .result-tab.active {
        background: var(--card-bg) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .result-tab {
        background: var(--bg-secondary) !important;
        color: var(--text-secondary) !important;
        border-color: var(--border-color) !important;
      }
      
      /* è¨­å®šå®¹å™¨ */
      .theme-dark .settings-container {
        background: transparent !important;
      }
      
      .theme-dark .setting-group {
        background: var(--card-bg) !important;
        border: 1px solid var(--border-color) !important;
        padding: 20px !important;
        border-radius: 12px !important;
        margin-bottom: 20px !important;
      }
      
      /* çµæœå®¹å™¨ */
      .theme-dark .results-container,
      .theme-dark .result-content {
        background: var(--card-bg) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
      }
      
      /* è³‡æ–™åº«å€å¡Š */
      .theme-dark .db-section,
      .theme-dark .section-content {
        background: transparent !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .user-db-sidebar,
      .theme-dark .user-db-content {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border: 1px solid var(--border-color) !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
        transition: all 0.3s ease !important;
      }
      
      /* æ·±è‰²æ¨¡å¼å¡ç‰‡å¢å¼·æ•ˆæœ */
      .theme-dark .mode-card,
      .theme-dark .user-story-card,
      .theme-dark [style*="background: white"][style*="border-radius"] {
        background: var(--gradient-card) !important;
        border: 1px solid var(--border-color) !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(59, 130, 246, 0.1) !important;
        transition: all 0.3s ease !important;
      }
      
      .theme-dark .mode-card:hover,
      .theme-dark .user-story-card:hover {
        transform: translateY(-4px) !important;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(59, 130, 246, 0.2) !important;
        animation: darkModeGlow 2s ease-in-out infinite !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šä¿®å¾©ã€Œä»‹ç´¹å¦‚ä½•é–‹å§‹ã€å€å¡Šçš„å»ºè­°ä½¿ç”¨é †åºæç¤ºæ¡† */
      .theme-dark [style*="background: linear-gradient(135deg, #FEF3C7"],
      .theme-dark [style*="background:linear-gradient(135deg, #FEF3C7"] {
        background: linear-gradient(135deg, #3d2e1f 0%, #4a3a28 100%) !important;
        border: 2px solid #f59e0b !important;
        box-shadow: 0 4px 20px rgba(245, 158, 11, 0.2) !important;
      }
      
      .theme-dark [style*="background: linear-gradient(135deg, #FEF3C7"] p,
      .theme-dark [style*="background:linear-gradient(135deg, #FEF3C7"] p,
      .theme-dark [style*="background: linear-gradient(135deg, #FEF3C7"] strong,
      .theme-dark [style*="background:linear-gradient(135deg, #FEF3C7"] strong {
        color: #fef3c7 !important;
      }
      
      .theme-dark [style*="background: linear-gradient(135deg, #FEF3C7"] i,
      .theme-dark [style*="background:linear-gradient(135deg, #FEF3C7"] i {
        color: #fbbf24 !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šä¿®å¾©ã€Œåˆ¥äººæ€éº¼ç”¨ã€å€å¡Šçš„æ¨™ç±¤ */
      .theme-dark [style*="background: #EFF6FF"],
      .theme-dark [style*="background:#EFF6FF"] {
        background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%) !important;
        color: #dbeafe !important;
        border: 1px solid rgba(59, 130, 246, 0.3) !important;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2) !important;
      }
      
      .theme-dark [style*="background: #F0FDF4"],
      .theme-dark [style*="background:#F0FDF4"] {
        background: linear-gradient(135deg, #1e3a2e 0%, #059669 100%) !important;
        color: #d1fae5 !important;
        border: 1px solid rgba(16, 185, 129, 0.3) !important;
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2) !important;
      }
      
      .theme-dark [style*="background: #FEF3C7"],
      .theme-dark [style*="background:#FEF3C7"] {
        background: linear-gradient(135deg, #3d2e1f 0%, #d97706 100%) !important;
        color: #fef3c7 !important;
        border: 1px solid rgba(245, 158, 11, 0.3) !important;
        box-shadow: 0 2px 8px rgba(245, 158, 11, 0.2) !important;
      }
      
      .theme-dark [style*="background: #F3E8FF"],
      .theme-dark [style*="background:#F3E8FF"] {
        background: linear-gradient(135deg, #3d2e4a 0%, #7c3aed 100%) !important;
        color: #e9d5ff !important;
        border: 1px solid rgba(139, 92, 246, 0.3) !important;
        box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šä¿®å¾©é å°¾ */
      .theme-dark .rm-footer,
      .theme-dark [style*="background: #EFF6FF"][class*="rm-footer"],
      .theme-dark footer,
      .theme-dark [style*="background: #f8fafc"] {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border-top: 1px solid var(--border-color) !important;
      }
      
      .theme-dark footer p,
      .theme-dark footer div,
      .theme-dark footer span,
      .theme-dark .rm-footer p,
      .theme-dark .rm-footer div,
      .theme-dark .rm-footer span {
        color: var(--text-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šé¦–é å€å¡ŠèƒŒæ™¯ */
      .theme-dark section[id="introduction"],
      .theme-dark section[class*="user-story-section"],
      .theme-dark section[id="mode-cards"] {
        background: var(--gradient-primary) !important;
        position: relative;
      }
      
      .theme-dark section[id="introduction"]::before,
      .theme-dark section[class*="user-story-section"]::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                    radial-gradient(circle at 80% 50%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
        pointer-events: none;
        animation: darkModeGradient 10s ease infinite;
        background-size: 200% 200%;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šDiscord å€å¡Šç´«è‰²èª¿æ•´ï¼Œèˆ‡æ·±è‰²èƒŒæ™¯æ›´å”èª¿ */
      .theme-dark .discord-share-section,
      .theme-dark [style*="background: linear-gradient(to bottom right, #8B5CF6"],
      .theme-dark [style*="background:linear-gradient(to bottom right, #8B5CF6"] {
        background: linear-gradient(135deg, #3d2a5f 0%, #4c1d95 50%, #5b21b6 100%) !important;
        position: relative;
        overflow: hidden;
      }
      
      /* Discord å€å¡Šæ·»åŠ å¾®å¦™çš„ç™¼å…‰æ•ˆæœ */
      .theme-dark .discord-share-section::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(139, 92, 246, 0.15) 0%, transparent 70%);
        animation: darkModeGradient 8s ease infinite;
        pointer-events: none;
      }
      
      /* Discord å€å¡Šå…§çš„å¡ç‰‡æ¨£å¼èª¿æ•´ */
      .theme-dark .discord-share-section [style*="background: rgba(255,255,255,0.15)"],
      .theme-dark .discord-share-section [style*="background:rgba(255,255,255,0.15)"] {
        background: rgba(30, 38, 64, 0.6) !important;
        backdrop-filter: blur(10px) !important;
        border: 1px solid rgba(139, 92, 246, 0.3) !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(139, 92, 246, 0.2) !important;
      }
      
      /* Discord æŒ‰éˆ•æ¨£å¼èª¿æ•´ï¼ˆç™½è‰²æŒ‰éˆ•æ”¹ç‚ºæ·±è‰²æ¨¡å¼å‹å¥½ï¼‰ */
      .theme-dark .discord-share-section a[style*="background: white"],
      .theme-dark .discord-share-section a[style*="background:white"] {
        background: linear-gradient(135deg, #5865F2 0%, #4752C4 100%) !important;
        color: white !important;
        box-shadow: 0 4px 20px rgba(88, 101, 242, 0.3) !important;
        transition: all 0.3s ease !important;
        border: 1px solid rgba(139, 92, 246, 0.3) !important;
      }
      
      .theme-dark .discord-share-section a[style*="background: white"]:hover,
      .theme-dark .discord-share-section a[style*="background:white"]:hover {
        transform: translateY(-2px) scale(1.05) !important;
        box-shadow: 0 6px 30px rgba(88, 101, 242, 0.5) !important;
        background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%) !important;
      }
      
      /* Discord å€å¡Šå…§çš„åœ–æ¨™é¡è‰²èª¿æ•´ */
      .theme-dark .discord-share-section i.fab.fa-discord {
        color: white !important;
      }
      
      .theme-dark .menu-item:not(.active) {
        color: var(--text-secondary) !important;
      }
      
      .theme-dark .menu-item.active {
        background: var(--button-bg) !important;
        color: var(--button-text) !important;
      }
      
      .theme-dark .menu-item:hover:not(.active) {
        background: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .menu-divider {
        background: var(--border-color) !important;
      }
      
      .theme-dark .detail-item {
        background: var(--bg-secondary) !important;
      }
      
      .theme-dark .detail-item label,
      .theme-dark .detail-item span {
        color: var(--text-primary) !important;
      }
      
      /* ç”¨æˆ¶æŠ½å±œ */
      .theme-dark .user-drawer-close:hover {
        background: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }
      
      :root { 
        color-scheme: light; 
        --safe-area-inset-top: env(safe-area-inset-top);
        --safe-area-inset-bottom: env(safe-area-inset-bottom);
        --safe-area-inset-left: env(safe-area-inset-left);
        --safe-area-inset-right: env(safe-area-inset-right);
      }
      html {
        overflow-x: hidden !important; /* é˜²æ­¢æ•´å€‹é é¢å·¦å³æ»‘å‹• */
        width: 100%;
        max-width: 100vw;
      }
      body { 
        margin: 0; 
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; 
        background: var(--bg-primary); 
        color: var(--text-primary); 
        transition: background-color 0.3s ease, color 0.3s ease;
        -webkit-text-size-adjust: 100%;
      }
      
      /* æ·±è‰²æ¨¡å¼ body èƒŒæ™¯ */
      .theme-dark body {
        background: var(--gradient-primary) !important;
        background-attachment: fixed !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šæ­¥é©Ÿå¡ç‰‡å¢å¼· */
      .theme-dark [style*="background: white"][style*="border-radius: 20px"] {
        background: var(--gradient-card) !important;
        border: 1px solid var(--border-color) !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(59, 130, 246, 0.1) !important;
        transition: all 0.3s ease !important;
      }
      
      .theme-dark [style*="background: white"][style*="border-radius: 20px"]:hover {
        transform: translateY(-2px) !important;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(59, 130, 246, 0.2) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šè¯çµ¡æ–¹å¼å¡ç‰‡ */
      .theme-dark [style*="background: white"][style*="border: 1px solid #e2e8f0"] {
        background: var(--gradient-card) !important;
        border: 1px solid var(--border-color) !important;
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.4) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šæ¨™é¡Œå’Œæ–‡å­—é¡è‰²ä¿®å¾© */
      .theme-dark h1, .theme-dark h2, .theme-dark h3,
      .theme-dark [style*="color: #1E293B"],
      .theme-dark [style*="color:#1E293B"],
      .theme-dark [style*="color: #0f172a"],
      .theme-dark [style*="color:#0f172a"] {
        color: var(--text-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šæ¬¡è¦æ–‡å­—é¡è‰² */
      .theme-dark [style*="color: #64748B"],
      .theme-dark [style*="color:#64748B"],
      .theme-dark [style*="color: #475569"],
      .theme-dark [style*="color:#475569"] {
        color: var(--text-secondary) !important;
      }
      
      /* ========== æ·±è‰²æ¨¡å¼ï¼šMode1 ä¸€éµç”Ÿæˆæ¨¡å¼ ========== */
      .theme-dark .mode1-page {
        background: var(--gradient-primary) !important;
      }
      
      .theme-dark .mode1-left,
      .theme-dark .mode1-right {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border: 1px solid var(--border-color) !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4) !important;
      }
      
      .theme-dark .mode1-left input,
      .theme-dark .mode1-left select,
      .theme-dark .mode1-left textarea,
      .theme-dark .mode1-right input,
      .theme-dark .mode1-right select,
      .theme-dark .mode1-right textarea {
        background: var(--input-bg) !important;
        color: var(--text-primary) !important;
        border-color: var(--input-border) !important;
      }
      
      .theme-dark .mode1-left label,
      .theme-dark .mode1-right label,
      .theme-dark .mode1-left h2,
      .theme-dark .mode1-left h3,
      .theme-dark .mode1-right h2,
      .theme-dark .mode1-right h3 {
        color: var(--text-primary) !important;
      }
      
      /* Mode1 è¨­å®šå€å¡Š */
      .theme-dark .settings-block {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3) !important;
      }
      
      .theme-dark .settings-block h3 {
        color: var(--text-primary) !important;
        border-bottom-color: var(--border-color) !important;
      }
      
      /* Mode1 ä¸€éµç”Ÿæˆä½¿ç”¨èªªæ˜ */
      .theme-dark .one-click-instructions {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .one-click-instructions h3 {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .step-content strong {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .step-content p {
        color: var(--text-secondary) !important;
      }
      
      /* Mode1 AI èªªæ˜å€å¡Š */
      .theme-dark .ai-instructions {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .instructions-header {
        background: transparent !important;
      }
      
      .theme-dark .instructions-header:hover {
        background: var(--bg-tertiary) !important;
      }
      
      .theme-dark .instructions-header h3 {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .instruction-list {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .instruction-list p {
        color: var(--text-secondary) !important;
      }
      
      .theme-dark .instruction-list p:last-child {
        border-top-color: var(--border-color) !important;
        color: var(--text-tertiary) !important;
      }
      
      /* Mode1 LLM è¼¸å‡ºæ–‡å­—é¡è‰² */
      .theme-dark .result-body,
      .theme-dark .result-body.has-content,
      .theme-dark .result-content,
      .theme-dark .result-content.has-content {
        color: var(--text-primary) !important;
        background: var(--card-bg) !important;
      }
      
      .theme-dark .result-header h3 {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .result-actions {
        border-top-color: var(--border-color) !important;
      }
      
      /* ========== æ·±è‰²æ¨¡å¼ï¼šMode2 AIé¡§å•æ¨¡å¼ ========== */
      .theme-dark .mode2-page {
        background: var(--gradient-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šAI å°è©±æ³¡æ³¡ - å¼·åˆ¶è¦†è“‹æ‰€æœ‰ç™½è‰²èƒŒæ™¯ï¼ŒèƒŒæ™¯æ”¹ç‚ºæ·±è‰²ï¼Œæ–‡å­—æ”¹ç‚ºç´”ç™½è‰² */
      /* ä½¿ç”¨æœ€é«˜ç‰¹ç•°æ€§ä¾†è¦†è“‹æ·ºè‰²æ¨¡å¼çš„ !important */
      .theme-dark .message.ai .message-content,
      .theme-dark .message.assistant .message-content,
      .theme-dark .message.ai[style*="background"] .message-content,
      .theme-dark .message.assistant[style*="background"] .message-content,
      .theme-dark #mode2 .message.ai .message-content,
      .theme-dark #mode2 .message.assistant .message-content,
      .theme-dark #chatMessages .message.ai .message-content,
      .theme-dark #chatMessages .message.assistant .message-content {
        background: var(--gradient-card) !important; /* æ·±è‰²èƒŒæ™¯ */
        color: #ffffff !important; /* ç™½è‰²æ–‡å­— */
        border-color: var(--border-color) !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
      }
      
      /* å¼·åˆ¶è¦†è“‹æ‰€æœ‰å¯èƒ½çš„ç™½è‰²èƒŒæ™¯ - ä½¿ç”¨æ›´å¼·çš„ç‰¹ç•°æ€§ */
      .theme-dark .message.ai .message-content[style],
      .theme-dark .message.assistant .message-content[style],
      .theme-dark #mode2 .message.ai .message-content[style],
      .theme-dark #mode2 .message.assistant .message-content[style],
      .theme-dark #chatMessages .message.ai .message-content[style],
      .theme-dark #chatMessages .message.assistant .message-content[style] {
        background: var(--gradient-card) !important; /* æ·±è‰²èƒŒæ™¯ */
        color: #ffffff !important; /* ç™½è‰²æ–‡å­— */
      }
      
      /* è¦†è“‹å…§è¯æ¨£å¼ä¸­çš„ç™½è‰²èƒŒæ™¯ */
      /* å¼·åˆ¶è¦†è“‹æ‰€æœ‰ç™½è‰²å’Œæ·ºè‰²èƒŒæ™¯ - æ”¹ç‚ºæ·±è‰²èƒŒæ™¯ */
      .theme-dark .message.ai .message-content[style*="background: #f8fafc"],
      .theme-dark .message.ai .message-content[style*="background:#f8fafc"],
      .theme-dark .message.ai .message-content[style*="background: #F8FAFC"],
      .theme-dark .message.ai .message-content[style*="background:#F8FAFC"],
      .theme-dark .message.ai .message-content[style*="background: white"],
      .theme-dark .message.ai .message-content[style*="background:white"],
      .theme-dark .message.ai .message-content[style*="background:#fff"],
      .theme-dark .message.ai .message-content[style*="background: #fff"],
      .theme-dark .message.assistant .message-content[style*="background: #f8fafc"],
      .theme-dark .message.assistant .message-content[style*="background:#f8fafc"],
      .theme-dark .message.assistant .message-content[style*="background: white"],
      .theme-dark .message.assistant .message-content[style*="background:white"],
      .theme-dark .message.assistant .message-content[style*="background:#fff"],
      .theme-dark .message.assistant .message-content[style*="background: #fff"] {
        background: var(--gradient-card) !important; /* æ·±è‰²èƒŒæ™¯ */
        color: #ffffff !important; /* ç™½è‰²æ–‡å­— */
        border-color: var(--border-color) !important;
      }
      
      /* è¦†è“‹å…§è¯æ¨£å¼ä¸­çš„æ·±è‰²æ–‡å­— - å¼·åˆ¶æ”¹ç‚ºç™½è‰² */
      .theme-dark .message.ai .message-content[style*="color: #1f2937"],
      .theme-dark .message.ai .message-content[style*="color:#1f2937"],
      .theme-dark .message.ai .message-content[style*="color: #374151"],
      .theme-dark .message.ai .message-content[style*="color:#374151"],
      .theme-dark .message.ai .message-content[style*="color: #0c4a6e"],
      .theme-dark .message.ai .message-content[style*="color:#0c4a6e"],
      .theme-dark .message.assistant .message-content[style*="color: #1f2937"],
      .theme-dark .message.assistant .message-content[style*="color:#1f2937"],
      .theme-dark .message.assistant .message-content[style*="color: #374151"],
      .theme-dark .message.assistant .message-content[style*="color:#374151"],
      .theme-dark .message.assistant .message-content[style*="color: #0c4a6e"],
      .theme-dark .message.assistant .message-content[style*="color:#0c4a6e"] {
        color: #ffffff !important; /* å¼·åˆ¶æ”¹ç‚ºç´”ç™½è‰² */
      }
      
      /* æ‰€æœ‰ AI å°è©±æ³¡æ³¡å…§çš„æ–‡å­—å…ƒç´  - å¼·åˆ¶æ”¹ç‚ºç™½è‰² */
      .theme-dark .message.ai .message-content p,
      .theme-dark .message.assistant .message-content p,
      .theme-dark .message.ai .message-content li,
      .theme-dark .message.assistant .message-content li,
      .theme-dark .message.ai .message-content h1,
      .theme-dark .message.ai .message-content h2,
      .theme-dark .message.ai .message-content h3,
      .theme-dark .message.ai .message-content h4,
      .theme-dark .message.ai .message-content h5,
      .theme-dark .message.ai .message-content h6,
      .theme-dark .message.ai .message-content strong,
      .theme-dark .message.ai .message-content em,
      .theme-dark .message.ai .message-content code,
      .theme-dark .message.ai .message-content pre,
      .theme-dark .message.ai .message-content span,
      .theme-dark .message.ai .message-content div,
      .theme-dark .message.assistant .message-content span,
      .theme-dark .message.assistant .message-content div,
      .theme-dark .message.assistant .message-content h1,
      .theme-dark .message.assistant .message-content h2,
      .theme-dark .message.assistant .message-content h3,
      .theme-dark .message.assistant .message-content h4,
      .theme-dark .message.assistant .message-content h5,
      .theme-dark .message.assistant .message-content h6,
      .theme-dark .message.assistant .message-content strong,
      .theme-dark .message.assistant .message-content em,
      .theme-dark .message.assistant .message-content code,
      .theme-dark .message.assistant .message-content pre {
        color: #ffffff !important; /* å¼·åˆ¶æ”¹ç‚ºç´”ç™½è‰² */
      }
      
      .theme-dark .message.ai .message-content pre {
        background: var(--bg-secondary) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .message.user .message-content {
        background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%) !important;
        color: #dbeafe !important;
        border-color: rgba(59, 130, 246, 0.3) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šèŠå¤©æ¶ˆæ¯å®¹å™¨ */
      .theme-dark .chat-messages,
      .theme-dark #chatMessages,
      .theme-dark #mode2 #chatMessages,
      .theme-dark #mode3 #mode3-chatMessages,
      .theme-dark #mode3 #mode3-chat-messages {
        background: var(--bg-secondary) !important;
        border-color: var(--border-color) !important;
        color: var(--text-primary) !important;
      }
      
      /* è¦†è“‹å…§è¯æ¨£å¼ä¸­çš„ç™½è‰²èƒŒæ™¯ */
      .theme-dark .chat-messages[style*="background: white"],
      .theme-dark .chat-messages[style*="background:white"],
      .theme-dark #chatMessages[style*="background: white"],
      .theme-dark #chatMessages[style*="background:white"] {
        background: var(--bg-secondary) !important;
      }
      
      /* Mode2 èªªæ˜æŠ½å±œ */
      .theme-dark .instructions-drawer {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5) !important;
      }
      
      .theme-dark .drawer-header {
        background: transparent !important;
        border-bottom-color: var(--border-color) !important;
      }
      
      .theme-dark .drawer-header h3 {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .drawer-close-btn {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .drawer-close-btn:hover {
        background: var(--bg-tertiary) !important;
      }
      
      .theme-dark .drawer-content {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .drawer-content p,
      .theme-dark .drawer-content strong,
      .theme-dark .drawer-content li {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .step-guide {
        background: transparent !important;
      }
      
      .theme-dark .step {
        background: rgba(30, 38, 64, 0.4) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .step-content strong {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .step-content p {
        color: var(--text-secondary) !important;
      }
      
      .theme-dark .chat-container {
        background: var(--bg-secondary) !important;
      }
      
      /* Mode1 çµæœæ¨™ç±¤å’Œå®¹å™¨ */
      .theme-dark .result-tabs {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .result-tab {
        background: transparent !important;
        color: var(--text-secondary) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .result-tab.active {
        background: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
        border-bottom-color: var(--accent-blue) !important;
      }
      
      .theme-dark .result-tab:hover:not(.active) {
        background: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .results-container {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
        color: var(--text-primary) !important;
      }
      
      /* ========== æ·±è‰²æ¨¡å¼ï¼šMode3 IPäººè¨­è¦åŠƒæ¨¡å¼ ========== */
      .theme-dark .mode3-page,
      .theme-dark .mode3-fixed {
        background: var(--gradient-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šMode3 IPäººè¨­è¦åŠƒå°è©±æ³¡æ³¡ - å¼·åˆ¶è¦†è“‹ç™½è‰²èƒŒæ™¯ */
      .theme-dark #mode3 .message.ai .message-content,
      .theme-dark #mode3-chatMessages .message.ai .message-content,
      .theme-dark #mode3-chat-messages .message.ai .message-content,
      .theme-dark #mode3 .message.assistant .message-content,
      .theme-dark #mode3-chatMessages .message.assistant .message-content,
      .theme-dark #mode3-chat-messages .message.assistant .message-content,
      .theme-dark #mode3 .message.ai .message-content[style*="background"],
      .theme-dark #mode3-chatMessages .message.ai .message-content[style*="background"],
      .theme-dark #mode3-chat-messages .message.ai .message-content[style*="background"] {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
      }
      
      /* è¦†è“‹ Mode3 å…§è¯æ¨£å¼ä¸­çš„ç™½è‰²èƒŒæ™¯ */
      .theme-dark #mode3 .message.ai .message-content[style*="background: #f8fafc"],
      .theme-dark #mode3 .message.ai .message-content[style*="background:#f8fafc"],
      .theme-dark #mode3 .message.ai .message-content[style*="background: white"],
      .theme-dark #mode3 .message.ai .message-content[style*="background:white"],
      .theme-dark #mode3-chatMessages .message.ai .message-content[style*="background: #f8fafc"],
      .theme-dark #mode3-chatMessages .message.ai .message-content[style*="background: white"],
      .theme-dark #mode3-chat-messages .message.ai .message-content[style*="background: #f8fafc"],
      .theme-dark #mode3-chat-messages .message.ai .message-content[style*="background: white"] {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
      }
      
      /* è¦†è“‹ Mode3 å…§è¯æ¨£å¼ä¸­çš„æ·±è‰²æ–‡å­— */
      .theme-dark #mode3 .message.ai .message-content[style*="color: #1f2937"],
      .theme-dark #mode3 .message.ai .message-content[style*="color:#1f2937"],
      .theme-dark #mode3 .message.ai .message-content[style*="color: #374151"],
      .theme-dark #mode3 .message.ai .message-content[style*="color:#374151"],
      .theme-dark #mode3-chatMessages .message.ai .message-content[style*="color: #1f2937"],
      .theme-dark #mode3-chat-messages .message.ai .message-content[style*="color: #1f2937"] {
        color: var(--text-primary) !important;
      }
      
      .theme-dark #mode3 .message.ai .message-content p,
      .theme-dark #mode3-chatMessages .message.ai .message-content p,
      .theme-dark #mode3-chat-messages .message.ai .message-content p,
      .theme-dark #mode3 .message.assistant .message-content p,
      .theme-dark #mode3-chatMessages .message.assistant .message-content p,
      .theme-dark #mode3-chat-messages .message.assistant .message-content p,
      .theme-dark #mode3 .message.ai .message-content li,
      .theme-dark #mode3 .message.ai .message-content h1,
      .theme-dark #mode3 .message.ai .message-content h2,
      .theme-dark #mode3 .message.ai .message-content h3,
      .theme-dark #mode3 .message.ai .message-content strong,
      .theme-dark #mode3 .message.ai .message-content code {
        color: var(--text-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šMode3 ç”¨æˆ¶å°è©±æ³¡æ³¡ */
      .theme-dark #mode3 .message.user .message-content,
      .theme-dark #mode3-chatMessages .message.user .message-content,
      .theme-dark #mode3-chat-messages .message.user .message-content {
        background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%) !important;
        color: #dbeafe !important;
        border-color: rgba(59, 130, 246, 0.3) !important;
      }
      
      /* è¦†è“‹ Mode3 ç”¨æˆ¶æ¶ˆæ¯çš„å…§è¯æ¨£å¼ */
      .theme-dark #mode3 .message.user .message-content[style*="background: #dbeafe"],
      .theme-dark #mode3 .message.user .message-content[style*="background:#dbeafe"],
      .theme-dark #mode3-chatMessages .message.user .message-content[style*="background: #dbeafe"],
      .theme-dark #mode3-chat-messages .message.user .message-content[style*="background: #dbeafe"] {
        background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%) !important;
        color: #dbeafe !important;
      }
      
      .theme-dark #mode3 .message.user .message-content[style*="color: #1e40af"],
      .theme-dark #mode3 .message.user .message-content[style*="color:#1e40af"],
      .theme-dark #mode3-chatMessages .message.user .message-content[style*="color: #1e40af"],
      .theme-dark #mode3-chat-messages .message.user .message-content[style*="color: #1e40af"] {
        color: #dbeafe !important;
      }
      
      .theme-dark #mode3-chatMessages,
      .theme-dark #mode3-chat-messages {
        background: var(--bg-secondary) !important;
      }
      
      .theme-dark .mode3-result-content {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .mode3-result-content h1,
      .theme-dark .mode3-result-content h2,
      .theme-dark .mode3-result-content h3,
      .theme-dark .mode3-result-content h4,
      .theme-dark .mode3-result-content p {
        color: var(--text-primary) !important;
      }
      
      /* Mode3 ä½¿ç”¨èªªæ˜å’Œç”ŸæˆçµæœæŠ½å±œ */
      .theme-dark .mode3-instructions-drawer,
      .theme-dark .mode3-results-drawer {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5) !important;
      }
      
      .theme-dark .mode3-drawer-header {
        background: transparent !important;
        border-bottom-color: var(--border-color) !important;
      }
      
      .theme-dark .mode3-drawer-header h3 {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .mode3-drawer-content {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .mode3-drawer-content p,
      .theme-dark .mode3-drawer-content strong,
      .theme-dark .mode3-drawer-content li {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .mode3-step {
        background: rgba(30, 38, 64, 0.4) !important;
        border-left-color: var(--accent-purple) !important;
      }
      
      .theme-dark .mode3-step-content strong {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .mode3-step-content p {
        color: var(--text-secondary) !important;
      }
      
      .theme-dark .mode3-result-type {
        background: rgba(30, 38, 64, 0.4) !important;
        border-left-color: var(--accent-green) !important;
      }
      
      .theme-dark .mode3-result-type strong {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .mode3-result-type p {
        color: var(--text-secondary) !important;
      }
      
      /* ========== æ·±è‰²æ¨¡å¼ï¼šå‰µä½œè€…è³‡æ–™åº« - LLM è¼¸å‡ºæ–‡å­— ========== */
      .theme-dark .script-item,
      .theme-dark .script-content,
      .theme-dark .script-header {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .script-content p,
      .theme-dark .script-content div,
      .theme-dark .script-content span,
      .theme-dark .script-content strong,
      .theme-dark .script-content em {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .topic-item,
      .theme-dark .topic-content,
      .theme-dark .ip-planning-item,
      .theme-dark .ip-planning-content-item {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .topic-content p,
      .theme-dark .topic-content div,
      .theme-dark .ip-planning-content-item p,
      .theme-dark .ip-planning-content-item div {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .topic-section,
      .theme-dark .topic-section-header,
      .theme-dark .topic-section-content {
        background: var(--bg-secondary) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .topic-section-header h5,
      .theme-dark .topic-section-content {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .topic-section-toggle {
        color: var(--text-secondary) !important;
      }
      
      .theme-dark .topic-item-actions button {
        background: #ef4444 !important;
        color: white !important;
      }
      
      .theme-dark .topic-item-actions button:hover {
        background: #dc2626 !important;
      }
      
      .theme-dark .topic-header,
      .theme-dark .topic-meta {
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .topic-item-title {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .topic-date {
        color: var(--text-secondary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šè¦†è“‹é¸é¡Œå…§å®¹ä¸­çš„å…§è¯æ¨£å¼ */
      .theme-dark .topic-item[style*="background: white"],
      .theme-dark .topic-item[style*="background:white"],
      .theme-dark .topic-item[style*="background: #ffffff"],
      .theme-dark .topic-item[style*="background:#ffffff"] {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
        color: var(--text-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šé¸é¡Œå…§å®¹å¡ç‰‡å…§çš„æ‰€æœ‰æ–‡å­— */
      .theme-dark .topic-item,
      .theme-dark .topic-item * {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .topic-item .topic-header,
      .theme-dark .topic-item .topic-content-sections,
      .theme-dark .topic-item .topic-header *,
      .theme-dark .topic-item .topic-content-sections * {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .topic-header[style*="border-bottom"],
      .theme-dark .topic-header[style*="border-bottom: 2px solid #e5e7eb"] {
        border-bottom-color: var(--border-color) !important;
      }
      
      .theme-dark .topic-item-title[style*="color: #1f2937"],
      .theme-dark h4[style*="color: #1f2937"] {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .topic-meta span[style*="background: #f3f4f6"],
      .theme-dark span[style*="background: #f3f4f6"] {
        background: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .topic-meta span[style*="color: #374151"] {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .topic-section[style*="background: #f9fafb"] {
        background: var(--bg-secondary) !important;
      }
      
      .theme-dark .topic-section-header h5[style*="color: #1f2937"] {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .topic-section-content[style*="color: #374151"] {
        color: var(--text-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šæ¨¡æ…‹æ¡†å’Œè¡¨æ ¼ */
      .theme-dark .script-modal-overlay {
        background: rgba(0, 0, 0, 0.8) !important;
      }
      
      .theme-dark .script-modal-content {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .script-modal-content h2[style*="color: #1f2937"] {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .script-modal-content button[style*="color: #6b7280"] {
        color: var(--text-secondary) !important;
      }
      
      .theme-dark .script-modal-content button[style*="color: #6b7280"]:hover {
        background: var(--bg-tertiary) !important;
      }
      
      .theme-dark .script-modal-content table {
        background: var(--bg-secondary) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .script-modal-content th[style*="color: #374151"] {
        color: var(--text-primary) !important;
        background: var(--bg-tertiary) !important;
      }
      
      .theme-dark .script-modal-content td[style*="color: #1f2937"],
      .theme-dark .script-modal-content td[style*="color: #4b5563"] {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .script-modal-content tr[style*="background: #ffffff"],
      .theme-dark .script-modal-content tr[style*="background: #f9fafb"] {
        background: var(--bg-secondary) !important;
      }
      
      .theme-dark .script-modal-content tr[style*="background: #f9fafb"] {
        background: var(--bg-tertiary) !important;
      }
      
      .theme-dark .script-modal-content tr[style*="border-bottom: 1px solid #e5e7eb"] {
        border-bottom-color: var(--border-color) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šPDFç”Ÿæˆä¸­çš„è¡¨æ ¼ï¼ˆé›–ç„¶æ˜¯æ‰“å°ï¼Œä½†ä¹Ÿè¦è€ƒæ…®é è¦½ï¼‰ */
      .theme-dark table[style*="background: white"] {
        background: var(--bg-secondary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šé¦–é å€å¡Šä¸­çš„ç™½è‰²èƒŒæ™¯ */
      /* æ·±è‰²æ¨¡å¼ï¼šæ‰€æœ‰ section ç™½è‰²èƒŒæ™¯ */
      .theme-dark section[style*="background: white"],
      .theme-dark section[style*="background:white"],
      .theme-dark section[style*="background: #ffffff"],
      .theme-dark section[style*="background:#ffffff"],
      .theme-dark section[style*="background: #F8FAFC"],
      .theme-dark section[style*="background:#F8FAFC"] {
        background: var(--gradient-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šé¦–é å¡ç‰‡ç™½è‰²èƒŒæ™¯ */
      .theme-dark div[style*="background: white"][style*="border-radius: 20px"],
      .theme-dark div[style*="background:white"][style*="border-radius: 20px"],
      .theme-dark div[style*="background: #ffffff"][style*="border-radius: 20px"],
      .theme-dark div[style*="background:#ffffff"][style*="border-radius: 20px"] {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šé¦–é å¡ç‰‡å…§çš„æ–‡å­—é¡è‰² - å…¨é¢è¦†è“‹ */
      .theme-dark div[style*="background: white"] [style*="color: #1E293B"],
      .theme-dark div[style*="background:white"] [style*="color: #1E293B"],
      .theme-dark div[style*="background: white"] [style*="color:#1E293B"],
      .theme-dark div[style*="background:white"] [style*="color:#1E293B"],
      .theme-dark div[style*="background: white"] [style*="color: #64748B"],
      .theme-dark div[style*="background:white"] [style*="color: #64748B"],
      .theme-dark div[style*="background: white"] [style*="color:#64748B"],
      .theme-dark div[style*="background:white"] [style*="color:#64748B"],
      .theme-dark div[style*="background: white"] [style*="color: #475569"],
      .theme-dark div[style*="background:white"] [style*="color: #475569"],
      .theme-dark div[style*="background: white"] [style*="color:#475569"],
      .theme-dark div[style*="background:white"] [style*="color:#475569"] {
        color: var(--text-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šé¦–é å¡ç‰‡å…§çš„æ¬¡è¦æ–‡å­— */
      .theme-dark div[style*="background: white"] [style*="color: #64748B"],
      .theme-dark div[style*="background:white"] [style*="color: #64748B"],
      .theme-dark div[style*="background: white"] [style*="color:#64748B"],
      .theme-dark div[style*="background:white"] [style*="color:#64748B"] {
        color: var(--text-secondary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šå…¨é¢è¦†è“‹æ‰€æœ‰å…§è¯æ¨£å¼ä¸­çš„æ·±è‰²æ–‡å­— */
      .theme-dark [style*="color: #1E293B"],
      .theme-dark [style*="color:#1E293B"],
      .theme-dark [style*="color: #1e293b"],
      .theme-dark [style*="color:#1e293b"],
      .theme-dark [style*="color: #334155"],
      .theme-dark [style*="color:#334155"] {
        color: var(--text-primary) !important;
      }
      
      .theme-dark [style*="color: #64748B"],
      .theme-dark [style*="color:#64748B"],
      .theme-dark [style*="color: #64748b"],
      .theme-dark [style*="color:#64748b"],
      .theme-dark [style*="color: #475569"],
      .theme-dark [style*="color:#475569"] {
        color: var(--text-secondary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šè¦†è“‹æ‰€æœ‰ç™½è‰²èƒŒæ™¯çš„ divï¼ˆåŒ…æ‹¬é¦–é å¡ç‰‡ã€æ­¥é©Ÿå¡ç‰‡ç­‰ï¼‰ */
      .theme-dark div[style*="background: white"][style*="border-radius"],
      .theme-dark div[style*="background:white"][style*="border-radius"],
      .theme-dark div[style*="background: #ffffff"][style*="border-radius"],
      .theme-dark div[style*="background:#ffffff"][style*="border-radius"] {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šè¦†è“‹æ‰€æœ‰ç™½è‰²èƒŒæ™¯çš„ divï¼Œä¸é™å®š border-radius */
      .theme-dark div[style*="background: white"]:not([style*="linear-gradient"]):not([style*="radial-gradient"]),
      .theme-dark div[style*="background:white"]:not([style*="linear-gradient"]):not([style*="radial-gradient"]),
      .theme-dark div[style*="background: #ffffff"]:not([style*="linear-gradient"]):not([style*="radial-gradient"]),
      .theme-dark div[style*="background:#ffffff"]:not([style*="linear-gradient"]):not([style*="radial-gradient"]) {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šé¦–é å¡ç‰‡åº•éƒ¨å€åŸŸ */
      .theme-dark div[style*="background: #F8FAFC"],
      .theme-dark div[style*="background:#F8FAFC"],
      .theme-dark div[style*="background: #f8fafc"],
      .theme-dark div[style*="background:#f8fafc"] {
        background: var(--bg-secondary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šç”¨æˆ¶æ•…äº‹å€å¡Š */
      .theme-dark .user-story-section[style*="background: white"],
      .theme-dark .user-story-section[style*="background:white"] {
        background: var(--gradient-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šå¯¦æˆ°æŒ‡å—å€å¡Š */
      .theme-dark .rm-guide-section[style*="background: #F8FAFC"],
      .theme-dark .rm-guide-section[style*="background:#F8FAFC"] {
        background: var(--gradient-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šä»‹ç´¹å¦‚ä½•é–‹å§‹å€å¡Š */
      .theme-dark section#introduction[style*="background: white"],
      .theme-dark section#introduction[style*="background:white"] {
        background: var(--gradient-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šè¦†è“‹æ‰€æœ‰ç™½è‰²èƒŒæ™¯çš„ a æ¨™ç±¤ï¼ˆæŒ‰éˆ•ï¼‰ */
      .theme-dark a[style*="background: white"][style*="color: #2563EB"],
      .theme-dark a[style*="background:white"][style*="color: #2563EB"],
      .theme-dark a[style*="background: white"][style*="color:#2563EB"],
      .theme-dark a[style*="background:white"][style*="color:#2563EB"] {
        background: var(--gradient-card) !important;
        color: var(--accent-blue) !important;
        border-color: var(--accent-blue) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šè¦†è“‹ Discord åˆ†äº«æŒ‰éˆ• */
      .theme-dark a[style*="background: white"][style*="color: #5865F2"],
      .theme-dark a[style*="background:white"][style*="color: #5865F2"] {
        background: var(--gradient-card) !important;
        color: #5865F2 !important;
        border-color: var(--border-color) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šè¦†è“‹æ‰€æœ‰ç™½è‰²èƒŒæ™¯çš„æŒ‰éˆ•å’Œé€£çµ */
      .theme-dark a[style*="background: white"]:not([style*="linear-gradient"]),
      .theme-dark a[style*="background:white"]:not([style*="linear-gradient"]),
      .theme-dark button[style*="background: white"],
      .theme-dark button[style*="background:white"] {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šè¦†è“‹æ‰€æœ‰ç™½è‰²èƒŒæ™¯çš„å®¹å™¨ï¼ˆåŒ…æ‹¬ Discord é »é“å¡ç‰‡ç­‰ï¼‰ */
      .theme-dark div[style*="background: white"][style*="border: 1px solid"],
      .theme-dark div[style*="background:white"][style*="border: 1px solid"],
      .theme-dark div[style*="background: white"][style*="border-radius: 16px"],
      .theme-dark div[style*="background:white"][style*="border-radius: 16px"],
      .theme-dark div[style*="background: white"][style*="border-radius: 14px"],
      .theme-dark div[style*="background:white"][style*="border-radius: 14px"] {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .homepage-title[style*="color: #1f2937"] {
        color: var(--text-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šé¦–é  Hero å€å¡Šæ–‡å­—å„ªåŒ– */
      .theme-dark .rm-hero-title,
      .theme-dark .rm-hero h1,
      .theme-dark h1[style*="color: #1E293B"],
      .theme-dark h1[style*="color:#1E293B"] {
        color: var(--text-primary) !important;
        font-weight: 900 !important;
        text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
      }
      
      .theme-dark .rm-hero p,
      .theme-dark .rm-hero p[style*="color: #64748B"],
      .theme-dark .rm-hero p[style*="color:#64748B"] {
        color: var(--text-secondary) !important;
        font-weight: 500 !important;
        opacity: 1 !important;
      }
      
      .theme-dark .rm-hero span[style*="color: #94A3B8"],
      .theme-dark .rm-hero span[style*="color:#94A3B8"] {
        color: var(--text-tertiary) !important;
        opacity: 0.9 !important;
      }
      
      .theme-dark .homepage-subtitle,
      .theme-dark .homepage-subtitle[style*="color: #6b7280"],
      .theme-dark .homepage-subtitle[style*="color:#6b7280"],
      .theme-dark p[style*="color: #6b7280"],
      .theme-dark p[style*="color:#6b7280"] {
        color: var(--text-secondary) !important;
        font-weight: 500 !important;
        opacity: 1 !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šé¦–é  Hero å€å¡ŠèƒŒæ™¯å„ªåŒ– */
      .theme-dark .rm-hero {
        background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 15%, #2563EB 30%, #3B82F6 45%, #1E293B 60%, #0F172A 75%, #020617 100%) !important;
        background-size: 400% 400% !important;
        animation: heroGradientFlow 10s ease infinite !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šé¦–é æŒ‰éˆ•å„ªåŒ– */
      .theme-dark .rm-hero a[style*="background: white"],
      .theme-dark .rm-hero a[style*="background:white"] {
        background: var(--gradient-card) !important;
        color: var(--accent-blue) !important;
        border: 2px solid var(--accent-blue) !important;
        box-shadow: 0 4px 16px rgba(59, 130, 246, 0.2) !important;
      }

      /* æ·±è‰²æ¨¡å¼ï¼šé¦–é ä¸»è¦è¡Œå‹•æŒ‰éˆ•ï¼ˆé–‹å§‹ä½¿ç”¨ï¼‰æé«˜å¯è®€æ€§ */
      .theme-dark .rm-hero a[style*="linear-gradient(135deg, #3B82F6"],
      .theme-dark .rm-hero a[style*="linear-gradient(135deg,#3B82F6"] {
        color: #ffffff !important;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6) !important;
        font-weight: 800 !important;
      }
      .theme-dark .rm-hero a[style*="linear-gradient(135deg, #3B82F6"]:hover,
      .theme-dark .rm-hero a[style*="linear-gradient(135deg,#3B82F6"]:hover {
        filter: brightness(1.05) !important;
        color: #ffffff !important;
        text-shadow: 0 2px 6px rgba(0, 0, 0, 0.7) !important;
      }
      
      .theme-dark .rm-hero a[style*="background: white"]:hover,
      .theme-dark .rm-hero a[style*="background:white"]:hover {
        background: var(--accent-blue) !important;
        color: white !important;
        box-shadow: 0 6px 24px rgba(59, 130, 246, 0.4) !important;
        transform: translateY(-2px) !important;
      }
      
      .theme-dark div[style*="background: white"][style*="border-radius: 20px"] {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark div[style*="background: white"][style*="border-radius: 16px"],
      .theme-dark div[style*="background: white"][style*="border-radius: 12px"] {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šIPäººè¨­è¦åŠƒä¸­çš„æ–‡å­—é¡è‰² */
      .theme-dark .ip-planning-content-item[style*="color: #374151"] {
        color: var(--text-primary) !important;
      }
      
      .theme-dark h3[style*="color: #374151"] {
        color: var(--text-primary) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šæŒ‰éˆ•å’Œé€£çµ */
      .theme-dark a[style*="background: white"][style*="color: #2563EB"] {
        background: var(--gradient-card) !important;
        color: var(--accent-blue) !important;
        border-color: var(--accent-blue) !important;
      }
      
      .theme-dark a[style*="background: white"]:hover {
        background: var(--bg-tertiary) !important;
      }
      
      /* ========== æ·±è‰²æ¨¡å¼ï¼šå¯¦æˆ°æŒ‡å—å’Œè«–å£‡ä»‹ç´¹é é¢ ========== */
      .theme-dark .rm-guide-section,
      .theme-dark #guide,
      .theme-dark #forum {
        background: var(--gradient-primary) !important;
      }
      
      .theme-dark .rm-guide-section [style*="background: white"],
      .theme-dark #guide [style*="background: white"],
      .theme-dark #forum [style*="background: white"] {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .step-guide,
      .theme-dark .guide-article {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .step-guide h1,
      .theme-dark .step-guide h2,
      .theme-dark .step-guide h3,
      .theme-dark .step-guide p,
      .theme-dark .guide-article h1,
      .theme-dark .guide-article h2,
      .theme-dark .guide-article p {
        color: var(--text-primary) !important;
      }
      
      /* ========== æ·±è‰²æ¨¡å¼ï¼šè¼¸å…¥æ¡†å’ŒæŒ‰éˆ• ========== */
      .theme-dark .input-row {
        background: transparent !important;
        border-top-color: var(--border-color) !important;
      }
      
      .theme-dark .input-container {
        background: transparent !important;
      }
      
      .theme-dark .input-wrapper {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .input-wrapper:focus-within {
        border-color: var(--accent-blue) !important;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2) !important;
      }
      
      .theme-dark #messageInput,
      .theme-dark #mode3-message-input,
      .theme-dark .input-wrapper input,
      .theme-dark .input-wrapper textarea,
      .theme-dark .chat-input {
        background: var(--input-bg) !important;
        color: #ffffff !important; /* æ”¹ç‚ºç´”ç™½è‰² */
        border-color: var(--input-border) !important;
      }
      
      .theme-dark .chat-input::placeholder,
      .theme-dark #messageInput::placeholder,
      .theme-dark #mode3-message-input::placeholder,
      .theme-dark input::placeholder,
      .theme-dark textarea::placeholder {
        color: var(--text-tertiary) !important;
        opacity: 0.8 !important;
      }
      
      .theme-dark .quick-buttons {
        border-top-color: var(--border-color) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šå»ºè­°æŒ‰éˆ•å’Œå¿«é€ŸæŒ‰éˆ• - å¼·åˆ¶è¦†è“‹æ‰€æœ‰æ¨£å¼ï¼Œæ–‡å­—æ”¹ç‚ºç´”ç™½è‰² */
      .theme-dark .suggestion-btn,
      .theme-dark .quick-btn,
      .theme-dark button[class*="suggestion"],
      .theme-dark button[class*="quick"],
      .theme-dark .input-wrapper .quick-btn,
      .theme-dark .mode2 .quick-btn,
      .theme-dark .mode3 .quick-btn,
      .theme-dark #mode3 .quick-btn,
      .theme-dark .mode3-quick-btn {
        background: var(--card-bg) !important;
        color: #ffffff !important; /* æ”¹ç‚ºç´”ç™½è‰² */
        border-color: var(--border-color) !important;
        font-weight: 500 !important;
      }
      
      /* è¦†è“‹å…§è¯æ¨£å¼ä¸­çš„ç™½è‰²èƒŒæ™¯å’Œæ·±è‰²æ–‡å­— */
      .theme-dark .quick-btn[style*="background: white"],
      .theme-dark .quick-btn[style*="background:white"],
      .theme-dark .quick-btn[style*="background: #ffffff"],
      .theme-dark .quick-btn[style*="background:#ffffff"],
      .theme-dark .suggestion-btn[style*="background: white"],
      .theme-dark .suggestion-btn[style*="background:white"],
      .theme-dark .mode3-quick-btn[style*="background: white"],
      .theme-dark .mode3-quick-btn[style*="background:white"] {
        background: var(--card-bg) !important;
        color: #ffffff !important; /* æ”¹ç‚ºç´”ç™½è‰² */
        border-color: var(--border-color) !important;
      }
      
      /* è¦†è“‹æ‰€æœ‰æ·±è‰²æ–‡å­—ï¼Œå¼·åˆ¶æ”¹ç‚ºç™½è‰² */
      .theme-dark .quick-btn[style*="color: #374151"],
      .theme-dark .quick-btn[style*="color:#374151"],
      .theme-dark .quick-btn[style*="color: #1f2937"],
      .theme-dark .quick-btn[style*="color:#1f2937"],
      .theme-dark .suggestion-btn[style*="color: #374151"],
      .theme-dark .suggestion-btn[style*="color:#374151"],
      .theme-dark .mode3-quick-btn[style*="color: #374151"],
      .theme-dark .mode3-quick-btn[style*="color:#374151"],
      .theme-dark .mode3-quick-btn[style*="color: #1f2937"],
      .theme-dark .mode3-quick-btn[style*="color:#1f2937"] {
        color: #ffffff !important; /* å¼·åˆ¶æ”¹ç‚ºç´”ç™½è‰² */
      }
      
      .theme-dark .suggestion-btn:hover,
      .theme-dark .quick-btn:hover,
      .theme-dark button[class*="suggestion"]:hover,
      .theme-dark button[class*="quick"]:hover,
      .theme-dark .input-wrapper .quick-btn:hover,
      .theme-dark .mode2 .quick-btn:hover,
      .theme-dark .mode3 .quick-btn:hover,
      .theme-dark #mode3 .quick-btn:hover {
        background: var(--accent-blue) !important;
        border-color: var(--accent-blue) !important;
        color: white !important;
        transform: translateY(-1px) !important;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šMode2 å¿«é€ŸæŒ‰éˆ•æ–‡å­—æ”¹ç‚ºç™½è‰²ï¼ˆç¢ºä¿æ‰€æœ‰æƒ…æ³éƒ½è¦†è“‹ï¼‰ */
      .theme-dark .mode2 .quick-btn,
      .theme-dark .mode2 .suggestion-btn,
      .theme-dark #mode2 .quick-btn,
      .theme-dark #mode2 .suggestion-btn,
      .theme-dark .mode2.fig1 .quick-btn,
      .theme-dark .mode2.fig1 .suggestion-btn,
      .theme-dark .mode2.fig1 .input-wrapper .quick-btn {
        color: #ffffff !important;
      }
      
      .theme-dark .mode2 .quick-btn[style*="color"],
      .theme-dark .mode2 .suggestion-btn[style*="color"],
      .theme-dark #mode2 .quick-btn[style*="color"],
      .theme-dark #mode2 .suggestion-btn[style*="color"],
      .theme-dark .mode2.fig1 .quick-btn[style*="color"],
      .theme-dark .mode2.fig1 .suggestion-btn[style*="color"] {
        color: #ffffff !important;
      }
      
      .theme-dark .send-btn {
        background: var(--button-bg) !important;
        color: var(--button-text) !important;
      }
      
      .theme-dark .send-btn:hover:not(:disabled) {
        background: var(--button-hover) !important;
      }
      
      .theme-dark .send-btn:disabled {
        background: var(--bg-tertiary) !important;
        color: var(--text-tertiary) !important;
        opacity: 0.5 !important;
      }
      
      /* ========== æ·±è‰²æ¨¡å¼ï¼šModal å’Œå½ˆçª— ========== */
      .theme-dark .detail-modal {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .detail-modal-header,
      .theme-dark .detail-modal-body {
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .detail-modal-header h3,
      .theme-dark .detail-content {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .detail-info span {
        color: var(--text-secondary) !important;
      }
      
      .theme-dark .detail-info strong {
        color: var(--text-primary) !important;
      }
      
      /* ========== æ·±è‰²æ¨¡å¼ï¼šè«–å£‡ä»‹ç´¹é é¢ç‰¹æ®Šæ¨£å¼ ========== */
      .theme-dark #forum [style*="background: linear-gradient(135deg, #eff6ff"],
      .theme-dark #forum [style*="background:linear-gradient(135deg, #eff6ff"] {
        background: var(--gradient-primary) !important;
      }
      
      .theme-dark #forum [style*="background: rgba(255,255,255,0.15)"],
      .theme-dark #forum [style*="background:rgba(255,255,255,0.15)"] {
        background: rgba(30, 38, 64, 0.6) !important;
        backdrop-filter: blur(10px) !important;
        border-color: var(--border-color) !important;
      }
      
      /* ä»£ç¢¼ç¤ºä¾‹å€å¡Š */
      .theme-dark pre,
      .theme-dark code,
      .theme-dark [class*="code"],
      .theme-dark [style*="background"][style*="code"] {
        background: var(--bg-secondary) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
      }
      
      /* ========== æ·±è‰²æ¨¡å¼ï¼šæ”¹é€²èˆ‡å„ªåŒ– ========== */
      
      /* 1. å°èˆªæ¬„æ¨™ç±¤å„ªåŒ– */
      .theme-dark .navbar-tab {
        color: var(--text-secondary) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
      }
      
      .theme-dark .navbar-tab.active {
        background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%) !important;
        color: white !important;
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3) !important;
        transform: translateY(-1px) !important;
      }
      
      .theme-dark .navbar-tab:hover:not(.active) {
        background: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
        transform: translateY(-1px) !important;
      }
      
      /* 2. æ»¾å‹•æ¢æ¨£å¼å„ªåŒ– */
      .theme-dark ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }
      
      .theme-dark ::-webkit-scrollbar-track {
        background: var(--bg-secondary) !important;
        border-radius: 10px;
      }
      
      .theme-dark ::-webkit-scrollbar-thumb {
        background: var(--border-color) !important;
        border-radius: 10px;
        border: 2px solid var(--bg-secondary);
        transition: background 0.3s ease;
      }
      
      .theme-dark ::-webkit-scrollbar-thumb:hover {
        background: var(--accent-blue) !important;
        box-shadow: 0 0 8px rgba(59, 130, 246, 0.4) !important;
      }
      
      .theme-dark * {
        scrollbar-width: thin;
        scrollbar-color: var(--border-color) var(--bg-secondary);
      }
      
      /* 3. é¸ä¸­æ–‡å­—æ¨£å¼ */
      .theme-dark ::selection {
        background: rgba(59, 130, 246, 0.3) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark ::-moz-selection {
        background: rgba(59, 130, 246, 0.3) !important;
        color: var(--text-primary) !important;
      }
      
      /* 4. åŠ è¼‰å‹•ç•«å’Œéª¨æ¶å± */
      .theme-dark .ai-loading,
      .theme-dark .loading,
      .theme-dark .spinner,
      .theme-dark .popup-spinner {
        background: var(--bg-secondary) !important;
      }
      
      .theme-dark .ai-loading-dot,
      .theme-dark .loading::after {
        background: var(--accent-blue) !important;
        box-shadow: 0 0 10px rgba(59, 130, 246, 0.5) !important;
      }
      
      .theme-dark .loading-text {
        color: var(--text-secondary) !important;
      }
      
      /* 5. Toast é€šçŸ¥å„ªåŒ– */
      .theme-dark .toast {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border: 1px solid var(--border-color) !important;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(59, 130, 246, 0.1) !important;
        backdrop-filter: blur(10px) !important;
      }
      
      /* 6. æŒ‰éˆ•å¢å¼·æ•ˆæœ */
      .theme-dark .btn-primary,
      .theme-dark .apply-btn,
      .theme-dark button[style*="background: #3b82f6"],
      .theme-dark button[style*="background:#3b82f6"] {
        background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%) !important;
        color: white !important;
        box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        border: none !important;
      }
      
      .theme-dark .btn-primary:hover,
      .theme-dark .apply-btn:hover,
      .theme-dark button[style*="background: #3b82f6"]:hover,
      .theme-dark button[style*="background:#3b82f6"]:hover {
        transform: translateY(-2px) scale(1.02) !important;
        box-shadow: 0 6px 24px rgba(59, 130, 246, 0.5) !important;
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%) !important;
      }
      
      .theme-dark .btn-primary:active,
      .theme-dark .apply-btn:active {
        transform: translateY(0) scale(0.98) !important;
      }
      
      /* 7. è¼¸å…¥æ¡†èšç„¦æ•ˆæœå¢å¼· */
      .theme-dark input:focus,
      .theme-dark select:focus,
      .theme-dark textarea:focus {
        outline: none !important;
        border-color: var(--accent-blue) !important;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2), 0 0 20px rgba(59, 130, 246, 0.1) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
      }
      
      /* 8. å¡ç‰‡æ‡¸åœæ•ˆæœå„ªåŒ– */
      .theme-dark .card:hover,
      .theme-dark .mode-card:hover,
      .theme-dark .user-story-card:hover,
      .theme-dark .setting-group:hover {
        transform: translateY(-4px) !important;
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.5), 
                    0 0 0 1px rgba(59, 130, 246, 0.2),
                    0 0 30px rgba(59, 130, 246, 0.1) !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
      }
      
      /* 9. æ‰‹æ©Ÿç‰ˆæŠ½å±œå„ªåŒ– */
      .theme-dark .mobile-drawer,
      .theme-dark .user-drawer-sidebar,
      .theme-dark .user-drawer-content {
        background: var(--gradient-card) !important;
        box-shadow: -4px 0 24px rgba(0, 0, 0, 0.5) !important;
        border-left: 1px solid var(--border-color) !important;
      }
      
      .theme-dark .mobile-drawer-toggle,
      .theme-dark .hamburger-icon {
        color: var(--text-primary) !important;
        transition: all 0.3s ease !important;
      }
      
      .theme-dark .mobile-drawer-toggle:hover,
      .theme-dark .hamburger-icon:hover {
        color: var(--accent-blue) !important;
        transform: scale(1.1) !important;
      }
      
      /* 10. ä¸‹æ‹‰é¸å–®å„ªåŒ– */
      .theme-dark select {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23cbd5e1' d='M6 9L1 4h10z'/%3E%3C/svg%3E") !important;
        background-repeat: no-repeat !important;
        background-position: right 12px center !important;
        padding-right: 36px !important;
        appearance: none !important;
        cursor: pointer !important;
      }
      
      .theme-dark select:hover {
        border-color: var(--accent-blue) !important;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1) !important;
      }
      
      /* 11. ä»£ç¢¼é«˜äº®å„ªåŒ–ï¼ˆHighlight.js æ·±è‰²ä¸»é¡Œé©é…ï¼‰ */
      .theme-dark .hljs {
        background: var(--bg-secondary) !important;
        color: var(--text-primary) !important;
        border: 1px solid var(--border-color) !important;
        border-radius: 8px !important;
        padding: 16px !important;
        box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3) !important;
      }
      
      .theme-dark .hljs-keyword,
      .theme-dark .hljs-selector-tag,
      .theme-dark .hljs-built_in,
      .theme-dark .hljs-name {
        color: #c792ea !important;
      }
      
      .theme-dark .hljs-string,
      .theme-dark .hljs-attr {
        color: #c3e88d !important;
      }
      
      .theme-dark .hljs-comment {
        color: var(--text-tertiary) !important;
        font-style: italic !important;
      }
      
      .theme-dark .hljs-number {
        color: #f78c6c !important;
      }
      
      .theme-dark .hljs-function,
      .theme-dark .hljs-title {
        color: #82aaff !important;
      }
      
      /* 12. è¡¨æ ¼å„ªåŒ– */
      .theme-dark table {
        border-collapse: separate !important;
        border-spacing: 0 !important;
      }
      
      .theme-dark th {
        background: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
        border-bottom: 2px solid var(--border-color) !important;
        font-weight: 600 !important;
      }
      
      .theme-dark td {
        border-bottom: 1px solid var(--border-color) !important;
      }
      
      .theme-dark tr:hover {
        background: var(--bg-tertiary) !important;
        transition: background 0.2s ease !important;
      }
      
      /* 13. é€£çµå„ªåŒ– */
      .theme-dark a:not(.navbar-tab):not(.btn):not(.logout-btn) {
        color: var(--accent-blue) !important;
        text-decoration: none !important;
        transition: all 0.2s ease !important;
        border-bottom: 1px solid transparent !important;
      }
      
      .theme-dark a:not(.navbar-tab):not(.btn):not(.logout-btn):hover {
        color: #60a5fa !important;
        border-bottom-color: var(--accent-blue) !important;
      }
      
      /* 14. æ¨™é¡Œå„ªåŒ– */
      .theme-dark h1,
      .theme-dark h2,
      .theme-dark h3 {
        background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      
      /* 15. åˆ†éš”ç·šå„ªåŒ– */
      .theme-dark hr,
      .theme-dark .divider,
      .theme-dark .menu-divider {
        border-color: var(--border-color) !important;
        background: linear-gradient(90deg, 
          transparent 0%, 
          var(--border-color) 20%, 
          var(--border-color) 80%, 
          transparent 100%) !important;
        height: 1px !important;
        border: none !important;
      }
      
      /* 16. æ¨™ç±¤å’Œå¾½ç« å„ªåŒ– */
      .theme-dark .badge,
      .theme-dark .tag,
      .theme-dark [class*="badge"],
      .theme-dark [class*="tag"] {
        background: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
        border: 1px solid var(--border-color) !important;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
      }
      
      /* 17. å·¥å…·æç¤ºå„ªåŒ– */
      .theme-dark [title]:hover::after,
      .theme-dark [data-tooltip]:hover::after {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border: 1px solid var(--border-color) !important;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4) !important;
      }
      
      /* 18. æ•´é«”éæ¸¡å‹•ç•«å„ªåŒ–ï¼ˆåƒ…é‡å°éœ€è¦å‹•ç•«çš„å…ƒç´ ï¼‰ */
      .theme-dark .card,
      .theme-dark .mode-card,
      .theme-dark .user-story-card,
      .theme-dark .setting-group,
      .theme-dark .btn-primary,
      .theme-dark .apply-btn,
      .theme-dark button,
      .theme-dark input,
      .theme-dark select,
      .theme-dark textarea,
      .theme-dark a {
        transition: background-color 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                    color 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                    border-color 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                    box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                    transform 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
      }
      
      /* 19. å°èˆªæ¬„æ¨™é¡Œå„ªåŒ– */
      .theme-dark .navbar-title,
      .theme-dark .clickable-title {
        background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        transition: all 0.3s ease !important;
      }
      
      .theme-dark .clickable-title:hover {
        filter: brightness(1.2) !important;
        transform: scale(1.05) !important;
      }
      
      /* 20. ç”¨æˆ¶è³‡è¨Šå„ªåŒ– */
      .theme-dark .user-info {
        color: var(--text-secondary) !important;
        transition: all 0.3s ease !important;
      }
      
      .theme-dark .user-info:hover {
        color: var(--text-primary) !important;
        transform: translateX(2px) !important;
      }
      
      /* é é¢å®¹å™¨ */
      .app-container {
        display: flex;
        min-height: 100vh;
        width: 100%;
        max-width: 100vw;
        overflow-x: hidden !important;
        box-sizing: border-box;
      }
      
      /* ä¸»å…§å®¹å€åŸŸ */
      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        transition: margin-right 0.3s ease;
        width: 100%;
        max-width: 100vw;
        overflow-x: hidden !important;
        box-sizing: border-box;
      }
      
      .main-content.sidebar-open {
        margin-right: 300px;
      }
      
      /* é ‚éƒ¨å°èˆªæ¬„ */
      .top-navbar {
        background: var(--navbar-bg);
        border-bottom: 1px solid var(--border-color);
        padding: 16px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 1px 3px var(--shadow);
        padding-top: calc(16px + var(--safe-area-inset-top));
        min-height: 60px;
        position: sticky;
        top: 0;
        z-index: 100;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }
      
      .navbar-left {
        display: flex;
        align-items: center;
        gap: 24px;
      }
      
      .navbar-title {
        font-size: 30px;
        font-weight: 600;
        color: var(--text-primary);
        margin-right: auto;
        transition: color 0.3s ease;
      }
      
      .clickable-title {
        cursor: pointer;
        transition: color 0.2s ease;
      }
      
      .clickable-title:hover {
        color: #3b82f6;
      }
      
      .navbar-tabs {
        display: flex;
        gap: 8px;
      }
      
      .navbar-tab {
        padding: 8px 16px;
        border: none;
        background: transparent;
        color: var(--text-secondary);
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
        text-decoration: none;
      }
      
      .navbar-tab.active {
        background: var(--button-bg);
        color: var(--button-text);
      }
      
      .navbar-tab:hover:not(.active) {
        background: var(--bg-tertiary);
      }
      
      .navbar-right {
        display: flex;
        align-items: center;
        gap: 16px;
      }
      
      .user-info {
        display: flex;
        align-items: center;
        gap: 8px;
        color: var(--text-secondary);
        font-size: 14px;
        transition: color 0.3s ease;
      }
      
      .logout-btn {
        padding: 6px 12px;
        background: #ef4444;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 12px;
        font-weight: 500;
      }
      
      .logout-btn:hover {
        background: #dc2626;
      }
      
      /* é é¢å…§å®¹å€åŸŸ */
      .page-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
      }
      
      /* æ‰‹æ©Ÿç‰ˆï¼šç§»é™¤å·¦å³ padding */
      @media (max-width: 768px) {
        .page-content {
          padding: 12px 0;
        }
      }
      
      /* è§¸æ§è¨­å‚™ï¼šè®“å¡ç‰‡æœ‰æŒ‰å£“å‹•ç•« */
      @media (hover: none) and (pointer: coarse) {
        /* è§¸æ§è¨­å‚™ä¸Šçš„å¡ç‰‡ */
        [class*="group"].bg-white {
          -webkit-tap-highlight-color: transparent;
          touch-action: manipulation;
          cursor: pointer;
        }
        
        /* å¡ç‰‡æŒ‰å£“æ•ˆæœ */
        [class*="group"].bg-white:active {
          transform: scale(0.96) !important;
          box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15) !important;
        }
        
        /* é¡¯ç¤ºåº•éƒ¨é€£çµ */
        [class*="opacity-0"] {
          opacity: 0.7 !important;
        }
      }
      
      /* mode2é é¢ç‰¹æ®Šæ¨£å¼ - æ»¿ç‰ˆé¡¯ç¤º */
      .mode2 .page-content {
        padding: 0;
        max-width: none;
        width: 100%;
      }
      
      /* é¦–é æ¨£å¼ */
      .homepage {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 60vh;
        text-align: center;
        width: 100%;
        max-width: 100vw;
        overflow-x: hidden !important; /* é˜²æ­¢é¦–é å·¦å³æ»‘å‹• */
        box-sizing: border-box;
      }
      
      /* é¦–é è¦–åœ–å®¹å™¨ */
      .homepage-view {
        width: 100%;
        max-width: 100vw;
        overflow-x: hidden !important; /* é˜²æ­¢é¦–é è¦–åœ–å·¦å³æ»‘å‹• */
        box-sizing: border-box;
      }
      
      /* åˆ¥äººæ€éº¼ç”¨å€å¡Šæ¨£å¼ */
      .user-story-section {
        width: 100%;
        max-width: 100vw;
        overflow-x: hidden !important;
        box-sizing: border-box;
      }
      
      .user-story-card {
        background: var(--card-bg);
        border-radius: 16px;
        padding: 32px;
        box-shadow: 0 4px 20px var(--shadow);
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        word-wrap: break-word;
        word-break: break-word;
        overflow-wrap: break-word;
        transition: background-color 0.3s ease;
      }
      
      .user-story-card > div {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        word-wrap: break-word;
        word-break: break-word;
        overflow-wrap: break-word;
      }
      
      /* Hero å€åŸŸæ¨£å¼ä¿®å¾© */
      .rm-hero {
        position: relative;
        overflow-x: hidden !important;
        box-sizing: border-box;
        /* æ¼¸å±¤æµå‹•èƒŒæ™¯ */
        background: linear-gradient(135deg, #2563EB 0%, #1D4ED8 15%, #3B82F6 30%, #60A5FA 45%, #DBEAFE 60%, #F8FAFC 75%, #FFFFFF 100%) !important;
        background-size: 400% 400% !important;
        animation: heroGradientFlow 10s ease infinite !important;
      }
      
      /* Hero æ¼¸å±¤æµå‹•å‹•ç•« */
      @keyframes heroGradientFlow {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }
      
      /* Hero é¡å¤–çš„æµå‹•æ³¢ç´‹æ•ˆæœ */
      .rm-hero::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
        animation: heroRotate 25s linear infinite;
        pointer-events: none;
        z-index: 0;
      }
      
      @keyframes heroRotate {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      
      /* ç¢ºä¿ Hero å…§å®¹åœ¨èƒŒæ™¯ä¹‹ä¸Š */
      .rm-hero > * {
        position: relative;
        z-index: 1;
      }
      
      /* Hero æŒ‰éˆ•å‹•æ…‹æ¸²æŸ“å‹•ç•« */
      .rm-hero .rm-hero-container .rm-hero-grid > div:first-child > div:last-child > a {
        opacity: 0;
        transform: translateY(20px);
        animation: heroButtonFadeIn 0.8s ease-out forwards;
      }
      
      .rm-hero .rm-hero-container .rm-hero-grid > div:first-child > div:last-child > a:nth-child(1) {
        animation-delay: 0.3s;
      }
      
      .rm-hero .rm-hero-container .rm-hero-grid > div:first-child > div:last-child > a:nth-child(2) {
        animation-delay: 0.5s;
      }
      
      @keyframes heroButtonFadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      /* Hero æŒ‰éˆ•æ‡¸æµ®å‹•ç•« */
      .rm-hero .rm-hero-container .rm-hero-grid > div:first-child > div:last-child > a {
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      
      .rm-hero .rm-hero-container .rm-hero-grid > div:first-child > div:last-child > a::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
      }
      
      .rm-hero .rm-hero-container .rm-hero-grid > div:first-child > div:last-child > a:hover::before {
        width: 300px;
        height: 300px;
      }
      
      .rm-hero .rm-hero-container .rm-hero-grid > div:first-child > div:last-child > a:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }
      
      .rm-hero-container {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        padding-left: max(16px, env(safe-area-inset-left)) !important;
        padding-right: max(16px, env(safe-area-inset-right)) !important;
      }
      
      .rm-hero-grid {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      .rm-hero-grid > div {
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
        word-wrap: break-word;
        word-break: break-word;
        overflow-wrap: break-word;
      }
      
      .homepage-title {
        font-size: 32px;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 16px;
      }
      
      .homepage-subtitle {
        font-size: 18px;
        color: #6b7280;
        margin-bottom: 48px;
        max-width: 600px;
        line-height: 1.6;
      }
      
      .mode-cards {
        display: flex;
        gap: 24px;
        max-width: 800px;
      }
      
      .mode-card {
        flex: 1;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 32px 24px;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        position: relative;
        z-index: 1;
        user-select: none;
      }
      
      .mode-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        border-color: #3b82f6;
      }
      
      .mode-card-icon {
        font-size: 48px;
        margin-bottom: 16px;
      }
      
      .mode-card-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 12px;
        transition: color 0.3s ease;
      }
      
      .mode-card-desc {
        font-size: 14px;
        color: var(--text-secondary);
        line-height: 1.5;
        transition: color 0.3s ease;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šæ¨¡å¼å¡ç‰‡èªªæ˜æ–‡å­—æ”¹ç‚ºç™½è‰² */
      .theme-dark .mode-card-desc,
      .theme-dark .mode-card p {
        color: #ffffff !important; /* æ”¹ç‚ºç´”ç™½è‰² */
      }
      
      /* è¦†è“‹å…§è¯æ¨£å¼ */
      .theme-dark .mode-card-desc[style*="color"],
      .theme-dark .mode-card p[style*="color: #374151"],
      .theme-dark .mode-card p[style*="color:#374151"],
      .theme-dark .mode-card p[style*="color: #6b7280"],
      .theme-dark .mode-card p[style*="color:#6b7280"] {
        color: #ffffff !important; /* å¼·åˆ¶æ”¹ç‚ºç™½è‰² */
      }
      
      /* æ¨¡å¼1ï¼šä¸€éµç”Ÿæˆé é¢ */
      .mode1-page {
        display: flex;
        gap: 24px;
        height: calc(100vh - 120px);
      }
      
      .mode1-left {
        flex: 1;
        background: var(--card-bg);
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px var(--shadow);
        overflow-y: auto;
        transition: background-color 0.3s ease;
      }
      
      .mode1-right {
        flex: 1;
        background: var(--card-bg);
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px var(--shadow);
        overflow-y: auto;
        transition: background-color 0.3s ease;
      }
      
      .section-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: color 0.3s ease;
      }
      
      /* æ¨¡å¼2ï¼šAIé¡§å•å°è©±é é¢ */
      .mode2-page {
        display: flex;
        flex-direction: column;
        height: calc(100vh - 140px);
        min-height: 600px;
        position: relative;
        max-width: none;
        width: 100%;
        margin: 0;
        padding: 0;
      }
      
      /* èªªæ˜æŒ‰éˆ• */
      .instructions-toggle-btn {
        position: fixed;
        top: 90px;
        right: 20px;
        background: #3b82f6;
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 14px;
        font-weight: 500;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        transition: all 0.2s ease;
        z-index: 1000;
      }
      
      .instructions-toggle-btn:hover {
        background: #2563eb;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
      }
      
      .btn-icon {
        font-size: 16px;
      }
      
      .btn-text {
        font-size: 13px;
      }
      
      /* æŠ½å±œèƒŒæ™¯é®ç½© */
      .drawer-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .drawer-overlay.show {
        opacity: 1;
        visibility: visible;
      }
      
      /* èªªæ˜æŠ½å±œ */
      .instructions-drawer {
        position: fixed;
        top: 80px;
        right: -400px;
        width: 400px;
        height: calc(100vh - 80px);
        background: white;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        transition: right 0.3s ease;
        z-index: 1001;
        display: flex;
        flex-direction: column;
      }
      
      .instructions-drawer.open {
        right: 0;
      }
      
      .drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
      }
      
      .drawer-header h3 {
        margin: 0;
        font-size: 18px;
        color: #1f2937;
      }
      
      .drawer-close-btn {
        background: none;
        border: none;
        font-size: 20px;
        color: #6b7280;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: all 0.2s;
      }
      
      .drawer-close-btn:hover {
        background: #e5e7eb;
        color: #374151;
      }
      
      .drawer-content {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
      }
      
      .drawer-content p {
        margin: 0 0 16px 0;
        font-size: 14px;
        line-height: 1.6;
        color: #374151;
      }
      
      .drawer-content p:last-child {
        margin-bottom: 0;
        padding-top: 12px;
        border-top: 1px solid #e5e7eb;
        font-size: 13px;
        color: #6b7280;
      }
      
      .step-guide {
        margin: 16px 0;
      }
      
      .step {
        display: flex;
        align-items: flex-start;
        margin-bottom: 16px;
        gap: 12px;
      }
      
      .step-number {
        background: #3b82f6;
        color: white;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
        flex-shrink: 0;
      }
      
      .step-content {
        flex: 1;
        font-size: 14px;
        line-height: 1.5;
      }
      
      .chat-container {
        flex: 1;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      
      /* å´é‚Šæ¬„æ¨£å¼ */
      .sidebar {
        position: fixed;
        top: 0;
        right: -300px;
        width: 300px;
        height: 100vh;
        background: var(--card-bg);
        border-left: 1px solid var(--border-color);
        box-shadow: -2px 0 8px var(--shadow);
        transition: right 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        z-index: 1000;
        overflow-y: auto;
      }
      
      .sidebar.open {
        right: 0;
      }
      
      .sidebar-header {
        padding: 20px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: border-color 0.3s ease;
      }
      
      .sidebar-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-primary);
        transition: color 0.3s ease;
      }
      
      .sidebar-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-secondary);
        transition: color 0.3s ease;
      }
      
      .sidebar-menu {
        padding: 20px 0;
      }
      
      .sidebar-item {
        display: block;
        width: 100%;
        padding: 12px 20px;
        border: none;
        background: none;
        text-align: left;
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s;
      }
      
      .sidebar-item:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
      }
      
      .sidebar-item.active {
        background: var(--button-bg);
        color: var(--button-text);
      }
      
      
      /* å´é‚Šæ¬„é é¢æ¨£å¼ */
      .sidebar-page-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      .sidebar-page-container {
        background: var(--card-bg);
        border-radius: 12px;
        width: 90%;
        max-width: 800px;
        max-height: 90%;
        overflow: hidden;
        box-shadow: 0 20px 25px -5px var(--shadow);
        display: flex;
        flex-direction: column;
        transition: background-color 0.3s ease;
      }
      
      .sidebar-page-header {
        padding: 20px 24px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--bg-secondary);
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }
      
      .sidebar-page-header h2 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
        color: var(--text-primary);
        transition: color 0.3s ease;
      }
      
      .sidebar-page-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: var(--text-secondary);
        padding: 4px;
        border-radius: 4px;
        transition: all 0.2s;
      }
      
      .sidebar-page-close:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
      }
      
      .sidebar-page-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        background: var(--card-bg);
        color: var(--text-primary);
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      
      /* å´é‚Šæ¬„é é¢å…§å®¹æ¨£å¼ */
      .profile-content {
        display: flex;
        flex-direction: column;
        gap: 24px;
      }
      
      .profile-section h3 {
        margin: 0 0 16px 0;
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
      }
      
      .user-details {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      
      .detail-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .detail-item label {
        font-weight: 500;
        color: #6b7280;
        min-width: 80px;
      }
      
      .detail-item span {
        color: #1f2937;
      }
      
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
      }
      
      .stat-item {
        text-align: center;
        padding: 16px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
      }
      
      .stat-number {
        font-size: 24px;
        font-weight: 700;
        color: #3b82f6;
        margin-bottom: 4px;
      }
      
      .stat-label {
        font-size: 12px;
        color: #6b7280;
      }
      
      .scripts-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      
      .script-item {
        padding: 16px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        background: #f8fafc;
      }
      
      .script-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      
      .script-header h4 {
        margin: 0;
        font-size: 16px;
        font-weight: 600;
        color: #1f2937;
      }
      
      .script-date {
        font-size: 12px;
        color: #6b7280;
      }
      
      .script-preview {
        font-size: 14px;
        color: #6b7280;
        margin-bottom: 12px;
        line-height: 1.4;
      }
      
      .script-actions {
        display: flex;
        gap: 8px;
      }
      
      .btn-primary {
        padding: 6px 12px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }
      
      .btn-danger {
        padding: 6px 12px;
        background: #ef4444;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }
      
      .help-content {
        display: flex;
        flex-direction: column;
        gap: 24px;
      }
      
      .help-section {
        padding: 16px;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
      }
      
      .help-section h3,
      .help-section h4 {
        margin: 0 0 12px 0;
        color: #1f2937;
      }
      
      .help-section h3 {
        font-size: 20px;
        font-weight: 600;
      }
      
      .help-section h4 {
        font-size: 16px;
        font-weight: 500;
      }
      
      .help-section p {
        margin: 8px 0;
        color: #6b7280;
        line-height: 1.5;
      }
      
      /* ä¸€éµç”Ÿæˆä½¿ç”¨èªªæ˜æ¨£å¼ */
      .one-click-instructions {
        margin-top: 20px;
        padding: 20px;
        background: #f8fafc;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
      }
      
      .one-click-instructions h3 {
        margin: 0 0 16px 0;
        font-size: 16px;
        font-weight: 600;
        color: #1f2937;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      
      .instruction-steps {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      
      .step {
        display: flex;
        align-items: flex-start;
        gap: 12px;
      }
      
      .step-number {
        width: 24px;
        height: 24px;
        background: #3b82f6;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
        flex-shrink: 0;
      }
      
      .step-content {
        flex: 1;
      }
      
      .step-content strong {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 4px;
      }
      
      .step-content p {
        margin: 0;
        font-size: 13px;
        color: #6b7280;
        line-height: 1.4;
      }
      
      /* é é¢éš±è—/é¡¯ç¤º */
      .page {
        display: none;
        width: 100%;
        max-width: 100vw;
        overflow-x: hidden !important; /* é˜²æ­¢é é¢å·¦å³æ»‘å‹• */
        box-sizing: border-box;
      }
      
      .page.active {
        display: block;
      }
      
      /* å‹•ç•«æ•ˆæœ */
      @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(5deg); }
      }
      
      @keyframes pulse {
        0%, 100% { opacity: 1; transform: scale(1); }
        50% { opacity: 0.6; transform: scale(1.1); }
      }
      
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      /* iOS Safari ç›¸å®¹æ€§ */
      html, body {
        -webkit-font-smoothing: antialiased;
        -webkit-text-size-adjust: 100%;
      }
      
      @supports (height: 100svh) {
        .min-h-screen {
          min-height: 100svh;
        }
      }
      
      /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
      @media (max-width: 1024px) {
        .rm-hero-grid {
          grid-template-columns: 1fr !important;
          gap: 40px !important;
        }
        .rm-pricing-cards {
          flex-direction: column !important;
          gap: 16px !important;
        }
        .rm-pricing-cards > div {
          width: 100% !important;
          max-width: 100% !important;
        }
      }
      
      @media (max-width: 768px) {
        .rm-hero {
          padding: 40px 0 !important;
          margin: -20px 0 0 0 !important;
        }
        .rm-hero-container {
          padding: 0 16px !important;
        }
        .rm-hero-grid {
          gap: 24px !important;
        }
        .rm-hero-title {
          font-size: 1.75rem !important;
          line-height: 1.3 !important;
        }
        .rm-hero p {
          font-size: 0.95rem !important;
          line-height: 1.6 !important;
        }
        
      /* æ‰“å­—æ©Ÿå‹•ç•«æ¨£å¼ */
      .typewriter-title {
        min-height: 1.2em; /* ç¢ºä¿é«˜åº¦ç©©å®š */
      }
      
      .typewriter-text {
        display: inline;
      }
      
      .typewriter-cursor {
        display: inline-block;
        animation: blink 1s infinite;
        margin-left: 2px;
        font-weight: 300;
        color: inherit;
      }
      
      @keyframes blink {
        0%, 50% {
          opacity: 1;
        }
        51%, 100% {
          opacity: 0;
        }
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šæ‰“å­—æ©Ÿå…‰æ¨™ */
      .theme-dark .typewriter-cursor {
        color: var(--text-primary) !important;
      }
      
        .rm-guide-section {
          padding: 60px 0 !important;
          margin: -20px 0 0 0 !important;
        }
        .rm-guide-section > div {
          padding: 0 16px !important;
        }
        .rm-pricing {
          padding: 60px 0 !important;
          margin: -20px 0 0 0 !important;
        }
        .rm-pricing > div {
          padding: 0 16px !important;
        }
        .rm-pricing-cards {
          gap: 16px !important;
        }
        .rm-footer {
          padding: 40px 0 !important;
          margin: -20px 0 0 0 !important;
        }
        .rm-footer > div {
          padding: 0 16px !important;
        }
        
        .mode1-page {
          flex-direction: column;
          height: auto;
        }
        
        .mode1-left,
        .mode1-right {
          flex: none;
        }
        
        .mode-cards {
          flex-direction: column;
        }
        
        .main-content.sidebar-open {
          margin-right: 0;
        }
        
        .sidebar {
          width: 100%;
          right: -100%;
        }
        
        .user-name { display: none !important; }
        .navbar-right { display: flex; align-items: center; gap: 10px; margin-left: auto; }
        .user-info { padding: 6px 8px; }
        .user-avatar { margin: 0; }
        .logout-btn { margin: 0; }
        .top-navbar { justify-content: space-between; }
        .navbar-left { flex: 1; }
        .navbar-title { margin-left: auto; }
        /* ä¸€éµç”Ÿæˆ/AIé¡§å•/IPäººè¨­å¡ç‰‡åŠ å¯¬ */
        .mode-cards { grid-template-columns: 1fr; }
        .mode-card { width: 100%; max-width: none; }
      }
      
      .container { max-width: 1400px; margin: 0 auto; padding: 16px; }
      
      /* ç¢ºä¿åŸæœ‰åŠŸèƒ½åœ¨æ–°ä½ˆå±€ä¸­æ­£å¸¸é¡¯ç¤º */
      .userSettingsContainer,
      .oneClickGenerationContainer,
      .chatContainer {
        width: 100%;
        height: 100%;
      }
      
      /* ç”¨æˆ¶éœ€æ±‚è¨­å®šæ¨£å¼èª¿æ•´ */
      .settings-block {
        margin-bottom: 20px;
      }
      
      .settings-content {
        margin-top: 16px;
      }
      
      /* ä¸€éµç”Ÿæˆé é¢å¸ƒå±€ */
      .mode1-page {
        display: flex;
        gap: 24px;
        min-height: calc(100vh - 120px);
      }
      
      .mode1-left {
        flex: 1;
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      
      .mode1-right {
        flex: 1;
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      
      /* ä¸€éµç”Ÿæˆçµæœå€å¡Šæ¨£å¼èª¿æ•´ */
      .result-tabs {
        margin-bottom: 0;
      }
      
      .results-container {
        flex: 1;
        min-height: 400px;
      }
      
      /* èŠå¤©å®¹å™¨æ¨£å¼èª¿æ•´ - ChatGPT é¢¨æ ¼ */
      .chat-container {
        display: flex !important;
        flex-direction: column !important;
        height: 100% !important;
        max-width: 800px !important;
        margin: 0 auto !important;
        width: 100% !important;
        background: var(--bg-secondary) !important;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif !important;
        transition: background-color 0.3s ease;
      }
      
      #chatMessages {
        flex: 1;
        overflow-y: auto;
        padding: 0 0 5px 0;
        margin-bottom: 5px;
      }
      
      /* ç•¶èªªæ˜æ”¶èµ·æ™‚ï¼ŒèŠå¤©è¨Šæ¯å€å»¶é•·é«˜åº¦ */
      .instruction-list.collapsed + #chatContainer #chatMessages {
        min-height: 600px;
      }

      /* ===== AIé¡§å•èŠå¤©è¨Šæ¯æ¨£å¼ - ChatGPT é¢¨æ ¼ ===== */
      
      /* èŠå¤©è¨Šæ¯å®¹å™¨ - æ¡ç”¨æ›´ç°¡æ½”çš„è¨­è¨ˆ */
      .message {
        display: flex;
        margin-bottom: 16px;
        align-items: flex-start;
      }

      .message:last-child {
        margin-bottom: 0;
      }

      .message-avatar {
        width: 30px !important;
        height: 30px !important;
        min-width: 30px !important;
        border-radius: 4px !important;
        background: #10a37f !important;
        color: white !important;
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        font-size: 16px !important;
        font-weight: bold !important;
        margin-right: 15px !important;
        flex-shrink: 0 !important;
      }

      .user .message-avatar {
        background: transparent !important;
        color: #374151 !important;
      }

      .assistant .message-avatar {
        background: #10a37f !important;
        color: white !important;
      }

      .message-content {
        flex: 1 !important;
        padding: 0 !important;
        margin: 0 !important;
        line-height: 1.6 !important;
        color: #374151 !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
        white-space: pre-wrap !important;
        max-width: 100% !important; /* é˜²æ­¢è¶…å‡ºå®¹å™¨ */
        overflow: hidden !important; /* é˜²æ­¢å…§å®¹æº¢å‡º */
        box-sizing: border-box !important; /* åŒ…å«é‚Šæ¡†åœ¨å…§ */
      }

      /* è¨Šæ¯å…§å®¹çš„æ¨£å¼é‡ç½® */
      .message-content p:first-child {
        margin-top: 0 !important;
      }
      .message-content p:last-child {
        margin-bottom: 0 !important;
      }

      /* Markdown æ¸²æŸ“æ¨£å¼ - ChatGPT é¢¨æ ¼ */
      .message-content pre {
        background: #202123 !important;
        color: #f8f8f2 !important;
        padding: 10px !important;
        border-radius: 6px !important;
        overflow-x: auto !important;
        position: relative !important;
        margin: 15px 0 !important;
      }

      .message-content pre code {
        display: block !important;
        padding: 0 !important;
        background: none !important;
        color: inherit !important;
      }

      .message-content table {
        border-collapse: collapse !important;
        width: 100% !important;
        margin: 15px 0 !important;
      }

      .message-content th, 
      .message-content td {
        border: 1px solid #ddd !important;
        padding: 8px !important;
        text-align: left !important;
      }
      
      .theme-dark .message-content th,
      .theme-dark .message-content td {
        border-color: var(--border-color) !important;
        color: var(--text-primary) !important;
      }

      .message-content th {
        background-color: #f2f2f2 !important;
      }
      
      .theme-dark .message-content th {
        background-color: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }

      .message-content blockquote {
        border-left: 4px solid #ccc !important;
        padding-left: 15px !important;
        margin: 15px 0 !important;
        color: #666 !important;
      }
      
      .theme-dark .message-content blockquote {
        border-left-color: var(--accent-blue) !important;
        color: var(--text-secondary) !important;
      }

      .message-content ul, 
      .message-content ol {
        margin: 15px 0 !important;
        padding-left: 20px !important;
      }

      .message-content h1,
      .message-content h2,
      .message-content h3,
      .message-content h4,
      .message-content h5,
      .message-content h6 {
        margin: 16px 0 8px 0 !important;
        font-weight: 600 !important;
        line-height: 1.3 !important;
      }

      .message-content p {
        margin: 8px 0 !important;
        line-height: 1.6 !important;
      }

      .message-content code {
        background: #f1f3f4 !important;
        padding: 2px 6px !important;
        border-radius: 4px !important;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace !important;
        font-size: 0.9em !important;
      }

      /* AI æ€è€ƒä¸­å‹•ç•« - ChatGPT é¢¨æ ¼ */
      .typing-indicator {
        display: flex !important;
        align-items: center !important;
        font-style: italic !important;
        color: #6b7280 !important;
        margin: 0 !important;
        padding: 0 !important;
      }

      .typing-dots {
        display: flex !important;
        margin-left: 10px !important;
      }

      .typing-dot {
        width: 6px !important;
        height: 6px !important;
        margin: 0 2px !important;
        background-color: #3b82f6 !important;
        border-radius: 50% !important;
        animation: dot-flashing 1s infinite alternate !important;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s !important;
      }

      .typing-dot:nth-child(3) {
        animation-delay: 0.4s !important;
      }

      @keyframes dot-flashing {
        0% {
          opacity: 0.2;
        }
        100% {
          opacity: 1;
        }
      }

      /* ä¸²æµæ–‡å­—æ•ˆæœ */
      .streaming-text {
        position: relative;
      }

      .streaming-cursor {
        display: inline-block;
        width: 2px;
        height: 1.2em;
        background: #374151;
        animation: blink 1s infinite;
        margin-left: 2px;
      }

      @keyframes blink {
        0%, 50% { opacity: 1; }
        51%, 100% { opacity: 0; }
      }

      .message-content p {
        margin: 0 0 8px 0;
        line-height: 1.5;
      }

      .message-content ul {
        margin: 8px 0;
        padding-left: 20px;
      }

      .message-content li {
        margin: 4px 0;
      }

      .message-content:last-child p:last-child {
        margin-bottom: 0;
      }
      
      /* AIæ€è€ƒä¸­è¼‰å…¥å‹•ç•« */
      .ai-loading {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #6b7280;
        font-size: 14px;
      }

      .ai-loading-dots {
        display: flex;
        gap: 4px;
      }

      .ai-loading-dot {
        width: 6px;
        height: 6px;
        background: #3b82f6;
        border-radius: 50%;
        animation: ai-bounce 1.4s infinite ease-in-out both;
      }

      .ai-loading-dot:nth-child(1) { animation-delay: -0.32s; }
      .ai-loading-dot:nth-child(2) { animation-delay: -0.16s; }

      @keyframes ai-bounce {
        0%, 80%, 100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }
      
      /* è¼¸å…¥æ¬„ä½ï¼šé è¨­éš±è—ï¼Œåªåœ¨ mode2 å’Œ mode3 é é¢é¡¯ç¤º */
      .input-row {
        display: none !important;
      }
      
      #mode2.active .input-row,
      #mode3.active .input-row {
        display: flex !important;
        flex-direction: column !important;
        padding: 16px 24px; /* å·¦å³ padding èˆ‡å°è©±å…§å®¹å°é½Š */
        margin-top: 0;
        border-top: 1px solid #e5e7eb;
        background: transparent;
        border-radius: 0;
        gap: 12px; /* è¼¸å…¥æ¡†å’Œå¿«é€ŸæŒ‰éˆ•ä¹‹é–“çš„é–“è· */
      }
      
      #mode2.active .input-container,
      #mode3.active .input-container {
        display: flex !important;
        gap: 12px;
        align-items: flex-start;
        width: 100%;
      }
      
      /* è¼¸å…¥æ¡†åŒ…è£å™¨ï¼ˆç”¨æ–¼å®¹ç´å¿«é€ŸæŒ‰éˆ•ï¼‰ */
      .input-wrapper {
        position: relative;
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 120px; /* æ”¾å¤§æ•´é«”é«˜åº¦ï¼Œå®¹ç´å¿«é€ŸæŒ‰éˆ• */
        background: #ffffff;
        border: 1px solid #d1d5db;
        border-radius: 12px;
        padding: 12px;
        gap: 8px;
      }
      
      .input-wrapper:focus-within {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      /* è¼¸å…¥æ¡†å’Œç™¼é€æŒ‰éˆ•åœ¨åŒä¸€è¡Œ */
      .input-row-inner {
        display: flex;
        gap: 12px;
        align-items: flex-end;
        flex: 1;
      }
      
      .input-wrapper .chat-input {
        flex: 1;
        min-height: 44px; /* æ¢å¾©åˆ°è¼ƒå°é«˜åº¦ */
        max-height: 100px;
        padding: 10px 12px;
        border: 1px solid transparent;
        background: transparent;
        border-radius: 8px;
        font-size: 14px;
        resize: vertical;
        outline: none;
        line-height: 1.5;
      }
      
      .input-wrapper .chat-input:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
      }
      
      .input-wrapper .send-btn {
        height: 44px; /* èˆ‡è¼¸å…¥æ¡†é«˜åº¦ä¸€è‡´ */
        min-width: 44px;
        padding: 0 18px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .input-wrapper .send-btn:hover {
        background: #2563eb;
      }
      
      /* å¿«é€ŸæŒ‰éˆ•åœ¨è¼¸å…¥æ¡†å…§åº•éƒ¨ */
      .input-wrapper .quick-buttons {
        position: relative;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 8px 0 0 0;
        margin: 0;
        border-top: 1px solid #e5e7eb;
        background: transparent;
      }
      
      .input-wrapper .quick-btn {
        background: transparent;
        border: 1px solid #d1d5db;
        color: #374151;
        padding: 6px 12px;
        border-radius: 16px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
      }
      
      .input-wrapper .quick-btn:hover {
        background: #3b82f6;
        border-color: #3b82f6;
        color: white;
      }
      
      /* Mode3 ç¾åœ¨ä½¿ç”¨èˆ‡ Mode2 ç›¸åŒçš„çµæ§‹ï¼Œé¡¯ç¤º/éš±è—é‚è¼¯ç”± .input-row æ§åˆ¶ */
      
      /* å„ªåŒ–èŠå¤©è¨Šæ¯æ¨£å¼ */
      .msg {
        display: flex;
        margin-bottom: 16px;
        align-items: flex-start;
        max-width: 85%;
      }
      
      .msg.user {
        margin-left: auto;
        flex-direction: row-reverse;
      }
      
      .msg.assistant {
        margin-right: auto;
      }
      
      .msg-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 600;
        margin: 0 8px;
        flex-shrink: 0;
      }
      
      .msg.user .msg-avatar {
        background: #3b82f6;
        color: white;
      }
      
      .msg.assistant .msg-avatar {
        background: #f3f4f6;
        color: #374151;
      }
      
      .msg-bubble {
        flex: 1;
        background: #f8fafc;
        padding: 12px 16px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        line-height: 1.5;
        font-size: 15px;
        box-sizing: border-box;
        overflow: hidden;
      }
      
      .msg.user .msg-bubble {
        background: #dbeafe;
        border-color: #3b82f6;
        color: #1e40af;
        max-width: 100%;
        word-wrap: break-word;
      }
      
      .msg.assistant .msg-bubble {
        background: #f8fafc;
        border-color: #e5e7eb;
        color: #1f2937;
        max-width: 100%;
        word-wrap: break-word;
        transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šmsg-bubble æ¨£å¼ï¼ˆå¦ä¸€ç¨®å‰µå»ºæ¶ˆæ¯çš„æ–¹å¼ï¼‰ */
      .theme-dark .msg.assistant .msg-bubble,
      .theme-dark .msg-bubble {
        background: var(--gradient-card) !important;
        color: #ffffff !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .msg.assistant .msg-bubble p,
      .theme-dark .msg.assistant .msg-bubble span,
      .theme-dark .msg.assistant .msg-bubble div,
      .theme-dark .msg-bubble p,
      .theme-dark .msg-bubble span,
      .theme-dark .msg-bubble div {
        color: #ffffff !important;
      }
      
      .theme-dark .msg.assistant .msg-avatar {
        background: var(--bg-secondary) !important;
        color: var(--text-primary) !important;
      }
      
      .msg-bubble p {
        margin: 0 0 4px 0;
        line-height: 1.3;
      }
      
      .msg-bubble ul {
        margin: 4px 0;
        padding-left: 20px;
      }
      
      .msg-bubble li {
        margin: 2px 0;
        line-height: 1.3;
      }
      
      .msg-bubble:last-child p:last-child {
        margin-bottom: 0;
      }
      
      .msg-label {
        font-size: 12px;
        font-weight: 500;
        margin-bottom: 6px;
        color: #6b7280;
      }
      
      /* å„ªåŒ–è¼¸å…¥æ¡†æ¨£å¼ - æ¢å¾©åˆ°è¼ƒå°é«˜åº¦ */
      #messageInput {
        flex: 1;
        min-height: 44px; /* æ¢å¾©åˆ°è¼ƒå°é«˜åº¦ */
        max-height: 100px; /* æœ€å¤§é«˜åº¦ï¼Œå…è¨±èª¿æ•´ */
        padding: 10px 12px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        font-size: 14px;
        resize: vertical; /* å…è¨±å‚ç›´èª¿æ•´é«˜åº¦ */
        outline: none;
        transition: border-color 0.2s;
        line-height: 1.5;
        overflow-y: auto; /* å…§å®¹è¶…å‡ºæ™‚é¡¯ç¤ºæ»¾å‹•æ¢ */
      }
      
      #messageInput:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      #sendBtn {
        height: 44px; /* èˆ‡è¼¸å…¥æ¡†é«˜åº¦ä¸€è‡´ */
        min-width: 44px;
        padding: 0 18px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      #sendBtn:hover {
        background: #2563eb;
      }
      
      #sendBtn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
      }
      
      /* å¿«é€Ÿæå•æŒ‰éˆ•æ¨£å¼ï¼ˆå¥—ç”¨IPæ¨¡å¼è¨­è¨ˆï¼‰ */
      .quick-questions {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
        flex-wrap: wrap;
      }
      
      .quick-question-btn {
        padding: 8px 16px;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 20px;
        cursor: pointer;
        font-size: 13px;
        color: #6b7280;
        transition: all 0.2s;
      }
      
      .quick-question-btn:hover {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }

      /* ChatGPT é¢¨æ ¼å¿«é€ŸæŒ‰éˆ• */
      /* å¿«é€ŸæŒ‰éˆ•å’Œè¼¸å…¥æ¬„ä½ï¼šé è¨­éš±è—ï¼Œåªåœ¨ mode2 é é¢é¡¯ç¤º */
      .quick-buttons,
      #quickButtons,
      .input-row,
      #messageInput,
      #sendBtn {
        display: none !important;
      }
      
      /* åªåœ¨ mode2 é é¢ä¸”ç‚º active æ™‚é¡¯ç¤º */
      #mode2.active .quick-buttons,
      #mode2.active #quickButtons,
      #mode2.active .input-row,
      #mode2.active #messageInput,
      #mode2.active #sendBtn {
        display: flex !important;
      }
      
      #mode2.active #messageInput {
        display: block !important;
      }
      
      /* Mode2 é é¢çš„å¿«é€ŸæŒ‰éˆ•æ¨£å¼ */
      #mode2.active .quick-buttons { 
        gap: 8px !important; 
        margin-bottom: 12px !important; 
        flex-wrap: wrap !important;
        padding: 0 !important;
        background: transparent !important;
        border: none !important;
        position: relative !important;
        bottom: auto !important;
        z-index: auto !important;
        flex-shrink: 0 !important;
        height: auto !important;
      }

      .quick-btn {
        background: #ffffff !important;
        border: 1px solid #d1d5db !important;
        color: #374151 !important;
        padding: 8px 16px !important;
        border-radius: 16px !important;
        font-size: 14px !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
        white-space: nowrap !important;
        font-weight: 400 !important;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05) !important;
      }

      .quick-btn:hover {
        background: #3b82f6;
        border-color: #3b82f6;
        color: white;
      }
      
      /* ä¸»è¦å¸ƒå±€ï¼šå·¦å³åˆ†æ¬„ 5:5 */
      .main-layout { 
        display: flex; 
        gap: 20px; 
        min-height: calc(100vh - 100px);
      }
      
      /* å·¦å´é¢æ¿ - 5ä»½ */
      .left-panel { 
        flex: 5; 
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      
      /* å³å´é¢æ¿ - 5ä»½ */
      .right-panel { 
        flex: 5; 
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      
      /* å·¦å´å…§å®¹å€åŸŸ */
      .left-content {
        background: var(--bg-secondary);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px var(--shadow);
        flex: 1;
        display: flex;
        flex-direction: column;
        transition: background-color 0.3s ease;
      }
      
      /* çµæœå€å¡Šæ¨™ç±¤åˆ‡æ› */
      .result-tabs {
        display: flex;
        background: var(--card-bg);
        border-radius: 12px 12px 0 0;
        box-shadow: 0 2px 8px var(--shadow);
        border: 1px solid var(--border-color);
        border-bottom: none;
        overflow: hidden;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }
      
      .result-tab {
        flex: 1;
        padding: 16px 20px;
        background: var(--bg-secondary);
        border: none;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        color: var(--text-secondary);
        transition: all 0.2s;
        border-right: 1px solid var(--border-color);
      }
      
      .result-tab:last-child {
        border-right: none;
      }
      
      .result-tab.active {
        background: var(--card-bg);
        color: var(--text-primary);
        border-bottom: 2px solid var(--button-bg);
      }
      
      .result-tab:hover {
        background: var(--bg-tertiary);
      }
      
      /* çµæœå€å¡Šå®¹å™¨ */
      .results-container {
        background: var(--card-bg);
        border-radius: 0 0 12px 12px;
        box-shadow: 0 2px 8px var(--shadow);
        border: 1px solid var(--border-color);
        border-top: none;
        flex: 1;
        display: flex;
        flex-direction: column;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }
      
      .result-content {
        flex: 1;
        padding: 20px;
        min-height: 400px;
        color: var(--text-secondary);
        font-style: italic;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        white-space: pre-wrap;
        line-height: 1.6;
        transition: color 0.3s ease;
      }
      
      .result-content.has-content {
        color: var(--text-primary);
        font-style: normal;
        text-align: left;
        align-items: flex-start;
      }
      
      /* çµæœå€å¡Šæ–°æ¨£å¼ */
      .result-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      
      .result-header h3 {
        margin: 0;
        color: #1f2937;
        font-size: 18px;
        font-weight: 600;
      }
      
      .generate-btn {
        padding: 8px 16px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      
      .generate-btn:hover {
        background: #2563eb;
        transform: translateY(-1px);
      }
      
      .generate-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
      }
      
      .result-body {
        min-height: 200px;
        color: #6b7280;
        font-style: italic;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        white-space: pre-wrap;
        line-height: 1.6;
      }
      
      .result-body.has-content {
        color: #1f2937;
        font-style: normal;
        text-align: left;
        align-items: flex-start;
      }
      
      .result-actions {
        display: flex;
        gap: 12px;
        margin-top: 16px;
        padding-top: 12px;
        border-top: 1px solid #e5e7eb;
      }
      
      .save-btn, .regenerate-btn {
        padding: 8px 16px;
        border: 1px solid #d1d5db;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      
      .save-btn {
        background: #10b981;
        color: white;
        border-color: #10b981;
      }
      
      .save-btn:hover {
        background: #059669;
        border-color: #059669;
      }
      
      .regenerate-btn {
        background: #f59e0b;
        color: white;
        border-color: #f59e0b;
      }
      
      .regenerate-btn:hover {
        background: #d97706;
        border-color: #d97706;
      }
      
      /* èŠå¤©å€åŸŸæ¨£å¼ */
      .chat-section {
        display: flex;
        flex-direction: column;
        gap: 16px;
        margin-top: 20px;
        min-height: 600px;
        flex: 1;
      }
      
      .chat-messages {
        background: white;
        border-radius: 12px;
        padding: 16px;
        min-height: 500px; /* å‘ä¸Šæ‹‰é«˜ï¼šå¾ 400px å¢åŠ åˆ° 500px */
        max-height: 700px; /* å‘ä¸Šæ‹‰é«˜ï¼šå¾ 600px å¢åŠ åˆ° 700px */
        overflow-y: auto;
        border: 1px solid #e5e7eb;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        flex: 1;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }
      
      .message {
        margin-bottom: 12px;
        padding: 8px 12px;
        border-radius: 8px;
        font-size: 14px;
        line-height: 1.5;
      }
      
      .message.user {
        display: flex;
        margin-bottom: 16px;
        align-items: flex-start;
        flex-direction: row-reverse;
        background: transparent !important;
      }
      
      .message.user .message-content {
        flex: 1;
        background: #dbeafe !important;
        padding: 28px 40px !important; /* ä¸Šä¸‹é–“è·å¢åŠ åˆ° 28pxï¼Œå·¦å³ä¿æŒ 40px */
        padding-left: 50px !important; /* å¢åŠ å·¦é‚Š paddingï¼Œé¿å…æ–‡å­—å¤ªè²¼é‚Šç•Œ */
        border-radius: 12px !important;
        border: 1px solid #3b82f6 !important;
        color: #1e40af !important;
        margin-right: 12px !important;
        font-size: 16px !important; /* ç”¨æˆ¶å°è©±æ³¡æ³¡å­—é«”å¤§å° */
        line-height: 1.6 !important; /* è¡Œé«˜ */
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
        text-align: right !important; /* ç”¨æˆ¶å°è©±æ³¡æ³¡é å³å°é½Š */
        box-sizing: border-box !important;
      }
      
      .message.ai,
      .message.assistant {
        display: flex;
        margin-bottom: 16px;
        align-items: flex-start;
        background: transparent !important;
      }
      
      .message.ai .message-content,
      .message.assistant .message-content {
        flex: 1;
        background: #f8fafc !important;
        padding: 20px 40px;
        border-radius: 12px;
        border: 1px solid #e5e7eb !important;
        color: #1f2937 !important;
        margin-left: 12px;
        font-size: 16px; /* AI å°è©±æ³¡æ³¡å­—é«”å¤§å° */
        line-height: 1.6; /* è¡Œé«˜ */
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
        text-align: left; /* AI å°è©±æ³¡æ³¡é å·¦å°é½Š */
        transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šå¼·åˆ¶è¦†è“‹æ·ºè‰²æ¨¡å¼çš„ !important - ä½¿ç”¨æ›´é«˜ç‰¹ç•°æ€§ */
      .theme-dark .message.ai .message-content,
      .theme-dark .message.assistant .message-content,
      .theme-dark #mode2 .message.ai .message-content,
      .theme-dark #mode2 .message.assistant .message-content,
      .theme-dark #chatMessages .message.ai .message-content,
      .theme-dark #chatMessages .message.assistant .message-content,
      .theme-dark #mode2 #chatMessages .message.ai .message-content,
      .theme-dark #mode2 #chatMessages .message.assistant .message-content {
        background: var(--gradient-card) !important; /* æ·±è‰²èƒŒæ™¯ - è¦†è“‹æ·ºè‰²æ¨¡å¼çš„ !important */
        color: #ffffff !important; /* ç™½è‰²æ–‡å­— - è¦†è“‹æ·ºè‰²æ¨¡å¼çš„ !important */
        border-color: var(--border-color) !important;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šä½¿ç”¨æœ€é«˜ç‰¹ç•°æ€§è¦†è“‹æ‰€æœ‰å…§è¯æ¨£å¼ */
      .theme-dark #mode2 #chatMessages .message.ai .message-content[style*="background"],
      .theme-dark #mode2 #chatMessages .message.assistant .message-content[style*="background"],
      .theme-dark #mode2 .message.ai .message-content[style*="background"],
      .theme-dark #mode2 .message.assistant .message-content[style*="background"],
      .theme-dark #chatMessages .message.ai .message-content[style*="background"],
      .theme-dark #chatMessages .message.assistant .message-content[style*="background"] {
        background: var(--gradient-card) !important;
        color: #ffffff !important;
      }
      
      .theme-dark #mode2 #chatMessages .message.ai .message-content[style*="color"],
      .theme-dark #mode2 #chatMessages .message.assistant .message-content[style*="color"],
      .theme-dark #mode2 .message.ai .message-content[style*="color"],
      .theme-dark #mode2 .message.assistant .message-content[style*="color"],
      .theme-dark #chatMessages .message.ai .message-content[style*="color"],
      .theme-dark #chatMessages .message.assistant .message-content[style*="color"] {
        color: #ffffff !important;
      }
      
      .message-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        margin-right: 12px;
        flex-shrink: 0;
      }
      
      .message.user .message-avatar {
        background: #3b82f6;
        color: white;
        margin-right: 0;
        margin-left: 12px;
        overflow: hidden;
      }
      
      .message.user .message-avatar img {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        display: block;
      }
      
      .message.user .message-avatar:has(img) {
        background: transparent !important;
      }
      
      .message.ai .message-avatar,
      .message.assistant .message-avatar {
        background: #10a37f !important;
        color: white !important;
      }
      
      .message-content p {
        margin: 0 0 8px 0;
        line-height: 1.5;
      }
      
      .message-content ul {
        margin: 8px 0;
        padding-left: 20px;
      }
      
      .message-content li {
        margin: 4px 0;
      }
      
      .message-content:last-child p:last-child {
        margin-bottom: 0;
      }
      
      
      
      
      
      /* èŠå¤©è¨Šæ¯å€åŸŸ */
      #chatMessages {
        flex: 1;
        overflow-y: auto;
        overflow-x: hidden; /* é˜²æ­¢æ°´å¹³æ»¾å‹• */
        padding: 16px 24px 140px 24px; /* å…§è·æ›´è²¼è¿‘åœ–1 */
        min-height: calc(100vh - 200px);
        background: #ffffff; /* å°è©±ç•«å¸ƒç™½åº• */
        max-width: 100%;
        width: 100%;
        box-sizing: border-box;
        border: 1px solid #e5e7eb; /* ç´°é‚Šæ¡† */
        border-radius: 8px;       /* ç•¥åœ“è§’ */
      }
      
      /* èŠå¤©è¨Šæ¯æ¨£å¼ */
      .message {
        display: flex;
        margin-bottom: 0;
        align-items: flex-start;
        padding: 20px 0;
        border-bottom: 1px solid #e5e7eb;
        width: 100%; /* ç¢ºä¿å¯¬åº¦å›ºå®š */
        max-width: 100%; /* é˜²æ­¢è¶…å‡ºå®¹å™¨ */
        box-sizing: border-box; /* åŒ…å«é‚Šæ¡†åœ¨å…§ */
        overflow: hidden; /* é˜²æ­¢å…§å®¹æº¢å‡º */
      }

      .message:last-child {
        border-bottom: none;
      }

      .message-avatar {
        width: 30px;
        height: 30px;
        min-width: 30px;
        border-radius: 50%;
        background: transparent;
        color: #374151;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 16px;
        font-weight: bold;
        margin-right: 15px;
        flex-shrink: 0;
        overflow: hidden;
      }

      .user .message-avatar {
        background: transparent;
      }

      .message-content {
        flex: 1;
        padding: 20px 40px;
        margin: 0;
        line-height: 1.6;
        color: #374151;
        word-wrap: break-word;
        overflow-wrap: break-word;
        white-space: pre-wrap;
        max-width: 100%; /* é™åˆ¶æœ€å¤§å¯¬åº¦ */
        width: 100%;
        box-sizing: border-box; /* åŒ…å«é‚Šæ¡†åœ¨å…§ */
        overflow: visible; /* è®“å…§å®¹å¯è¦‹ */
      }

      .message-content p:first-child {
        margin-top: 0;
      }
      .message-content p:last-child {
        margin-bottom: 0;
      }

      /* Mode2 é é¢å›ºå®šè¨­è¨ˆ - é˜²æ­¢å·¦å³æ»‘å‹• */
      .mode2 {
        width: 100% !important;
        max-width: 100% !important;
        overflow-x: hidden !important;
        box-sizing: border-box !important;
      }
      
      .mode2-page {
        width: 100% !important;
        max-width: 100% !important;
        overflow-x: hidden !important;
        box-sizing: border-box !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      
      /* å¿«é€ŸæŒ‰éˆ•åˆ— */
      .mode2.fig1 .quick-buttons {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        padding: 8px 0 12px 0; /* èˆ‡è¼¸å…¥æ¡†ç•™ç™½ */
        margin: 0;
        background: transparent;
        border: none;
        justify-content: flex-start;
      }

      .mode2.fig1 .quick-btn {
        background: transparent;
        border: 1px solid #d1d5db;
        color: #374151;
        padding: 10px 8px; /* è®“é«˜åº¦ä¸€è‡´ä¸”å®¹ç´é•·æ–‡ */
        border-radius: 16px;
        font-size: 12px !important; /* èª¿æ•´ç‚º 10px ä¸¦ç¢ºä¿è¦†å¯« */
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
        font-weight: 400;
        box-shadow: none;
        backdrop-filter: none;
        width: 100% !important;  /* å¡«æ»¿gridæ¬„ä½ */
        min-width: 0 !important; /* é˜²æ­¢æ’ç ´ */
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        text-align: center !important; /* æ–‡å­—ç½®ä¸­ */
        display: inline-flex !important; /* å‚ç›´æ°´å¹³ç½®ä¸­ */
        justify-content: center !important;
        align-items: center !important;
      }

      .mode2.fig1 .quick-btn:hover {
        background: #3b82f6;
        border-color: #3b82f6;
        color: white;
      }

      /* è¼¸å…¥å€åŸŸï¼ˆè²¼è¿‘åœ–1ï¼šå¯¬ã€æ‰ã€å³å´é€å‡ºï¼‰ */
      .mode2.fig1 .input-row {
        background: transparent;
        border: none;
        padding: 8px 24px 16px 24px; /* å·¦å³ padding èˆ‡å°è©±å…§å®¹å°é½Š */
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      
      .mode2.fig1 .input-container {
        display: flex;
        gap: 12px;
        align-items: flex-end;
        width: 100%;
      }

      /* Mode2 å’Œ Mode3 å…±ç”¨ç›¸åŒçš„è¼¸å…¥æ¡†åŒ…è£å™¨æ¨£å¼ */
      .mode2.fig1 .input-wrapper,
      .mode3.fig1 .input-wrapper {
        position: relative;
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 120px; /* æ”¾å¤§æ•´é«”é«˜åº¦ï¼Œå®¹ç´å¿«é€ŸæŒ‰éˆ• */
        background: #ffffff;
        border: 1px solid #d1d5db;
        border-radius: 12px;
        padding: 12px;
        gap: 8px;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }
      
      .mode2.fig1 .input-wrapper:focus-within,
      .mode3.fig1 .input-wrapper:focus-within {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      /* Mode2 å’Œ Mode3 è¼¸å…¥æ¡†å’Œç™¼é€æŒ‰éˆ•åœ¨åŒä¸€è¡Œ */
      .mode2.fig1 .input-row-inner,
      .mode3.fig1 .input-row-inner {
        display: flex;
        gap: 12px;
        align-items: flex-end;
        flex: 1;
      }
      
      .mode2.fig1 .input-wrapper .chat-input,
      .mode3.fig1 .input-wrapper .chat-input,
      .mode3.fig1 .input-wrapper #mode3-message-input {
        flex: 1;
        min-height: 44px; /* æ¢å¾©åˆ°è¼ƒå°é«˜åº¦ */
        max-height: 100px;
        padding: 10px 12px;
        border: 1px solid transparent;
        background: transparent;
        border-radius: 8px;
        font-size: 14px;
        resize: vertical;
        outline: none;
        line-height: 1.5;
      }
      
      .mode2.fig1 .input-wrapper .chat-input:focus,
      .mode3.fig1 .input-wrapper .chat-input:focus,
      .mode3.fig1 .input-wrapper #mode3-message-input:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
      }

      .mode2.fig1 .input-wrapper .send-btn,
      .mode3.fig1 .input-wrapper .send-btn,
      .mode3.fig1 .input-wrapper #mode3-send-btn {
        height: 44px; /* æ¢å¾©åˆ°è¼ƒå°é«˜åº¦ */
        min-width: 44px;
        border-radius: 8px;
        background: #3b82f6;
        color: #ffffff;
        border: none;
        padding: 0 18px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .mode2.fig1 .input-wrapper .send-btn:hover,
      .mode3.fig1 .input-wrapper .send-btn:hover,
      .mode3.fig1 .input-wrapper #mode3-send-btn:hover {
        background: #2563eb;
      }
      
      /* Mode2 å’Œ Mode3 å¿«é€ŸæŒ‰éˆ•åœ¨è¼¸å…¥æ¡†å…§åº•éƒ¨ */
      .mode2.fig1 .input-wrapper .quick-buttons,
      .mode3.fig1 .input-wrapper .quick-buttons {
        position: relative;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 8px 0 0 0;
        margin: 0;
        border-top: 1px solid #e5e7eb;
        background: transparent;
      }
      
      .mode2.fig1 .input-wrapper .quick-btn {
        background: transparent;
        border: 1px solid #d1d5db;
        color: #374151;
        padding: 6px 12px;
        border-radius: 16px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
      }
      
      .mode3.fig1 .input-wrapper .quick-btn {
        background: #ffffff !important;
        border: 1px solid #d1d5db !important;
        color: #1f2937 !important;
        padding: 6px 12px;
        border-radius: 16px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
        font-weight: 500;
      }
      
      .mode2.fig1 .input-wrapper .quick-btn:hover {
        background: #3b82f6;
        border-color: #3b82f6;
        color: white;
      }
      
      .mode3.fig1 .input-wrapper .quick-btn:hover {
        background: #f3f4f6 !important;
        border-color: #3b82f6 !important;
        color: #1f2937 !important;
      }

      /* æ‰‹æ©Ÿç‰ˆå¾®èª¿ */
      @media (max-width: 768px) {
        /* ç¢ºä¿æ‰‹æ©Ÿç‰ˆ body ä¸æ»¾å‹• */
        body.mode2-active, html.mode2-active,
        body.mode3-active, html.mode3-active {
          overflow: hidden !important;
          height: 100% !important;
          position: fixed !important;
          width: 100% !important;
        }
        
        .mode2.fig1 .mode2-page,
        .mode3.fig1 .mode3-page {
          padding-top: 70px !important; /* æ‰‹æ©Ÿç‰ˆ header è¼ƒå° */
        }
        
        .mode2.fig1 #chatMessages,
        .mode3.fig1 #mode3-chat-messages {
          padding: 12px !important; /* æ‰‹æ©Ÿç‰ˆè¼ƒå°çš„ padding */
        }
        
        .mode2.fig1 .quick-buttons,
        .mode3.fig1 .quick-buttons { 
          gap: 4px !important; 
          padding: 6px 8px !important; /* æ‰‹æ©Ÿç‰ˆè¼ƒå°çš„ padding */
        }
        
        /* Mode2 å’Œ Mode3 æ‰‹æ©Ÿç‰ˆå¿«é€ŸæŒ‰éˆ•è®Šå¾—æ›´å°ï¼ˆåƒåœ–2é‚£æ¨£ï¼‰ */
        .mode2.fig1 .quick-btn {
          padding: 3px 6px !important; /* æ‰‹æ©Ÿç‰ˆå¿«é€ŸæŒ‰éˆ•è®Šå¾—æ›´å° */
          font-size: 10px !important; /* æ‰‹æ©Ÿç‰ˆå¿«é€ŸæŒ‰éˆ•å­—é«”è®Šå¾—æ›´å° */
        }
        
        .mode3.fig1 .quick-btn {
          padding: 3px 6px !important; /* æ‰‹æ©Ÿç‰ˆå¿«é€ŸæŒ‰éˆ•è®Šå¾—æ›´å° */
          font-size: 10px !important; /* æ‰‹æ©Ÿç‰ˆå¿«é€ŸæŒ‰éˆ•å­—é«”è®Šå¾—æ›´å° */
          background: #ffffff !important;
          color: #1f2937 !important;
          border: 1px solid #d1d5db !important;
        }
        
        /* Mode2 å’Œ Mode3 æ‰‹æ©Ÿç‰ˆè¼¸å…¥å€åŸŸæ¨£å¼çµ±ä¸€ */
        .mode2.fig1 .input-row,
        .mode3.fig1 .input-row {
          position: static !important; /* å¼·åˆ¶è¦†è“‹æ‰‹æ©Ÿç‰ˆçš„ fixed å®šä½ */
          bottom: auto !important;
          left: auto !important;
          right: auto !important;
          padding: 8px 12px 16px 12px !important; /* æ‰‹æ©Ÿç‰ˆè¼ƒå°çš„ padding */
          flex-direction: column !important; /* çµ±ä¸€ç‚ºå‚ç›´æ’åˆ— */
          flex-shrink: 0 !important; /* å›ºå®šåœ¨åº•éƒ¨ */
        }
        
        .mode2.fig1 .chat-input,
        .mode3.fig1 .chat-input,
        .mode3.fig1 #mode3-message-input { 
          font-size: 15px !important; 
        }
        
        /* Mode3 æ‰‹æ©Ÿç‰ˆè¼¸å…¥æ¡†åŒ…è£å™¨æ¨£å¼ï¼ˆèˆ‡ Mode2 ä¸€è‡´ï¼‰ */
        .mode3.fig1 .input-wrapper {
          min-height: 100px !important; /* æ‰‹æ©Ÿç‰ˆç¨å¾®å°ä¸€é» */
          padding: 8px !important;
        }
        
        .mode3.fig1 .input-row-inner {
          display: flex !important;
          flex-direction: row !important;
          gap: 8px !important;
          align-items: center !important;
        }
        
        .mode3.fig1 #mode3-message-input {
          flex: 1 !important;
          min-height: 40px !important;
          max-height: 80px !important;
          padding: 8px 12px !important;
          font-size: 15px !important;
          border-radius: 8px !important;
        }
        
        .mode3.fig1 #mode3-send-btn {
          height: 40px !important;
          min-width: 40px !important;
          padding: 0 12px !important;
          border-radius: 8px !important;
          display: flex !important;
          align-items: center !important;
          justify-content: center !important;
        }
      }

      /* fig1 å¼·åˆ¶è¦†å¯«ï¼ˆæé«˜å„ªå…ˆç´šï¼‰ */
      /* é–ä½æ•´é æ»¾å‹•ï¼šç•¶ mode2.fig1 æˆ– mode3.fig1 å­˜åœ¨æ™‚ï¼Œé é¢ä¸æ²å‹•ï¼Œåªè®“å°è©±æ¡†æ²å‹• */
      /* ç¢ºä¿ body å’Œ html ä¸æ»¾å‹• */
      body.mode2-active, html.mode2-active,
      body.mode3-active, html.mode3-active {
        overflow: hidden !important;
        height: 100% !important;
        position: fixed !important;
        width: 100% !important;
      }
      
      .mode2.fig1 {
        height: 100dvh !important; /* æ•´é å›ºå®šé«˜åº¦ */
        overflow: hidden !important; /* é–ä½æ•´é ï¼Œåªè®“å°è©±æ¡†æ»¾å‹• */
        position: fixed !important;
        top: 0 !important; /* å¾é ‚éƒ¨é–‹å§‹ï¼Œheader æœƒè¦†è“‹åœ¨ä¸Šé¢ */
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        width: 100% !important;
        display: flex !important; /* æœ€å¤–å±¤å®¹å™¨ç›´æ¥ä½¿ç”¨ flex */
        flex-direction: column !important;
        z-index: 1 !important; /* ç¢ºä¿åœ¨ header ä¸‹æ–¹ï¼ˆheader z-index: 100ï¼‰ */
      }

      .mode2.fig1 .mode2-page {
        display: flex !important;
        flex-direction: column !important;
        flex: 1 !important; /* å æ»¿å‰©é¤˜ç©ºé–“ï¼ˆheaderä¸‹æ–¹ï¼‰ */
        min-height: 0 !important; /* å…è¨±å­å…ƒç´ æ­£ç¢ºæ²å‹• */
        overflow: hidden !important; /* åªè®“å°è©±æ¡†æ»¾å‹• */
        padding: 0 !important; /* ç§»é™¤æ‰€æœ‰ paddingï¼Œè®“å…§å®¹ç›´æ¥è²¼é‚Š */
        padding-top: 80px !important; /* ç‚º header é ç•™ç©ºé–“ï¼ˆç´„ 60px + paddingï¼‰ */
        margin: 0 !important;
        box-sizing: border-box !important;
        position: relative !important;
      }

      .mode2.fig1 #chatMessages {
        margin: 0 !important;
        padding: 16px 24px !important; /* å·¦å³ paddingï¼Œè®“å…§å®¹ä¸è²¼é‚Š */
        background: transparent !important; /* ç§»é™¤ç™½è‰²èƒŒæ™¯ï¼Œç›´æ¥é¡¯ç¤ºåœ¨æœ€å¤–å±¤ */
        border: none !important; /* ç§»é™¤é‚Šæ¡† */
        border-radius: 0 !important;
        flex: 1 !important; /* å æ»¿å‰©é¤˜é«˜åº¦ */
        min-height: 0 !important; /* å…è¨±å­å…ƒç´ æ­£ç¢ºæ²å‹• */
        height: auto !important; /* ç”±flexæ±ºå®šé«˜åº¦ */
        -webkit-overflow-scrolling: touch !important; /* iOS æ…£æ€§æ²å‹• */
        overscroll-behavior: contain !important;
        touch-action: pan-y !important;
        overflow-y: auto !important; /* chat list æ»¾å‹•ï¼Œé€™æ˜¯å”¯ä¸€å¯æ»¾å‹•çš„å€åŸŸ */
        position: relative !important;
        z-index: 1 !important;
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
      }
      
      /* Mode3 å›ºå®šä½ˆå±€ - èˆ‡ Mode2 ç›¸åŒ */
      .mode3.fig1 {
        height: 100dvh !important;
        overflow: hidden !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        width: 100% !important;
        display: flex !important;
        flex-direction: column !important;
        z-index: 1 !important;
      }

      .mode3.fig1 .mode3-page {
        display: flex !important;
        flex-direction: column !important;
        flex: 1 !important;
        min-height: 0 !important;
        overflow: hidden !important;
        padding: 0 !important;
        padding-top: 80px !important;
        margin: 0 !important;
        box-sizing: border-box !important;
        position: relative !important;
      }

      .mode3.fig1 .mode3-chat-container {
        display: flex !important;
        flex-direction: column !important;
        flex: 1 !important;
        min-height: 0 !important;
        overflow: hidden !important;
        position: relative !important;
      }

      .mode3.fig1 #mode3-chat-messages {
        margin: 0 !important;
        padding: 16px 24px !important;
        background: transparent !important;
        border: none !important;
        border-radius: 0 !important;
        flex: 1 !important;
        min-height: 0 !important;
        height: auto !important;
        -webkit-overflow-scrolling: touch !important;
        overscroll-behavior: contain !important;
        touch-action: pan-y !important;
        overflow-y: auto !important;
        position: relative !important;
        z-index: 1 !important;
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
      }

      /* å¿«é€ŸæŒ‰éˆ•æ”¾åœ¨è¼¸å…¥æ¬„ä½åº•éƒ¨ - é›»è…¦ç‰ˆ */
      .mode2.fig1 .input-row .quick-buttons {
        gap: 8px !important;
        padding: 8px 0 0 0 !important; /* åœ¨è¼¸å…¥æ¡†ä¸‹æ–¹ï¼Œç•™ä¸€é»é–“è· */
        margin: 0 !important;
        display: flex !important;
        flex-wrap: wrap !important;
        justify-content: flex-start !important;
        width: 100% !important;
        background: transparent !important;
        box-sizing: border-box !important;
      }
      
      .mode2.fig1 .input-row .quick-btn {
        background: transparent !important;
        border: 1px solid #d1d5db !important;
        color: #374151 !important;
        padding: 8px 16px !important;
        border-radius: 16px !important;
        font-size: 14px !important;
        cursor: pointer !important;
        transition: all 0.2s ease !important;
        white-space: nowrap !important;
        font-weight: 400 !important;
        box-shadow: none !important;
        width: auto !important; /* è‡ªå‹•å¯¬åº¦ï¼Œä¸å¡«æ»¿ */
        min-width: fit-content !important;
        flex-shrink: 0 !important;
        display: inline-flex !important;
        justify-content: center !important;
        align-items: center !important;
      }
      
      .mode2.fig1 .input-row .quick-btn:hover {
        background: #3b82f6 !important;
        border-color: #3b82f6 !important;
        color: white !important;
      }

      .mode2.fig1 .chat-input {
        flex: 1 !important;
        height: 44px !important;
        min-height: 44px !important;
        max-height: 44px !important;
        border: 1px solid #d1d5db !important;
        border-radius: 10px !important;
        padding: 10px 12px !important;
        font-size: 14px !important;
        background: #ffffff !important;
      }

      .mode2.fig1 .send-btn {
        height: 44px !important;
        min-width: 44px !important;
        border-radius: 10px !important;
        background: #3b82f6 !important;
        color: #ffffff !important;
        border: none !important;
        padding: 0 18px !important;
        width: auto !important; /* è¦†å¯«å…ˆå‰æ‰‹æ©Ÿæ¨£å¼çš„ 100% å¯¬ */
      }
      
      /* è¼‰å…¥å‹•ç•«æ¨£å¼ */
      .typing-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        background: #ffffff;
        border-radius: 18px 18px 18px 4px;
        border: 1px solid #e5e7eb;
        margin: 8px 0;
      }
      
      .typing-dots {
        display: flex;
        gap: 4px;
      }
      
      .typing-dot {
        width: 8px;
        height: 8px;
        background: #9ca3af;
        border-radius: 50%;
        animation: typing 1.4s infinite ease-in-out;
      }
      
      .typing-dot:nth-child(1) { animation-delay: -0.32s; }
      .typing-dot:nth-child(2) { animation-delay: -0.16s; }
      
      @keyframes typing {
        0%, 80%, 100% {
          transform: scale(0.8);
          opacity: 0.5;
        }
        40% {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* è¼¸å…¥å€åŸŸï¼šé è¨­éš±è—ï¼Œåªåœ¨ mode2 é é¢é¡¯ç¤º */
      .input-row {
        display: none !important;
      }
      
      #mode2.active .input-row {
        display: flex !important;
        padding: 20px;
        background: #f7f7f8;
        border: none;
        flex-shrink: 0;
        z-index: 100;
        box-shadow: none;
        flex-direction: column;
        gap: 8px;
      }

      /* å¿«é€ŸæŒ‰éˆ•å€åŸŸï¼šé è¨­éš±è—ï¼Œåªåœ¨ mode2 é é¢é¡¯ç¤º */
      .quick-buttons {
        display: none !important;
      }
      
      #mode2.active .quick-buttons {
        display: flex !important;
        gap: 8px;
        flex-wrap: wrap;
        padding: 20px;
        background: #f7f7f8;
        border: none;
        z-index: 99;
        justify-content: center;
      }
      
      .input-container {
        display: flex;
        gap: 8px;
        align-items: center;
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 8px 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: border-color 0.2s;
      }

      .input-container:focus-within {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      .chat-input {
        flex: 1;
        border: none;
        resize: none;
        outline: none;
        padding: 8px 0;
        font-size: 16px;
        line-height: 1.5;
        max-height: 200px;
        overflow-y: auto;
        background: transparent;
        font-family: inherit;
        min-height: 24px;
      }
      
      .chat-input:focus {
        outline: none;
      }
      
      .send-btn {
        background: #3b82f6;
        border: none;
        color: white;
        cursor: pointer;
        padding: 8px 12px;
        font-size: 16px;
        transition: all 0.2s;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        min-width: 40px;
        height: 40px;
      }
      
      .send-btn:hover:not(:disabled) {
        background: #2563eb;
        transform: translateY(-1px);
      }
      
      .send-btn:disabled {
        color: #d1d5db;
        cursor: not-allowed;
      }

      /* Markdown æ¸²æŸ“æ¨£å¼ */
      .message-content pre {
        background: #202123;
        color: #f8f8f2;
        padding: 16px;
        border-radius: 8px;
        overflow-x: auto;
        margin: 16px 0;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        line-height: 1.5;
      }

      .message-content pre code {
        background: none;
        padding: 0;
        color: inherit;
        font-size: inherit;
      }

      .message-content code {
        background: #f1f3f4;
        padding: 2px 6px;
        border-radius: 4px;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.9em;
        color: #d63384;
      }
      
      .theme-dark .message-content code {
        background: var(--bg-tertiary) !important;
        color: #f472b6 !important;
      }

      .message-content table {
        border-collapse: collapse;
        width: 100%;
        margin: 16px 0;
        font-size: 14px;
      }

      .message-content th,
      .message-content td {
        border: 1px solid #e5e7eb;
        padding: 12px;
        text-align: left;
      }

      .message-content th {
        background: #f8f9fa;
        font-weight: 600;
      }
      
      .theme-dark .message-content th {
        background: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .message-content td {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .message-content table {
        border-color: var(--border-color) !important;
      }

      .message-content blockquote {
        border-left: 4px solid #e5e7eb;
        padding-left: 16px;
        margin: 16px 0;
        color: #6b7280;
        font-style: italic;
      }
      
      .theme-dark .message-content blockquote {
        border-left-color: var(--accent-blue) !important;
        color: var(--text-secondary) !important;
      }

      .message-content ul,
      .message-content ol {
        margin: 16px 0;
        padding-left: 24px;
      }

      .message-content li {
        margin: 8px 0;
        line-height: 1.6;
      }

      .message-content h1,
      .message-content h2,
      .message-content h3,
      .message-content h4,
      .message-content h5,
      .message-content h6 {
        margin: 24px 0 16px 0;
        font-weight: 600;
        line-height: 1.3;
        color: #1f2937;
      }

      .message-content h1 { font-size: 1.5em; }
      .message-content h2 { font-size: 1.3em; }
      .message-content h3 { font-size: 1.1em; }

      /* è¼‰å…¥å‹•ç•« */
      .typing-indicator {
        display: flex;
        align-items: center;
        font-style: italic;
        color: #6b7280;
        margin: 0;
        padding: 0;
      }

      .typing-dots {
        display: flex;
        margin-left: 10px;
      }

      .typing-dot {
        width: 6px;
        height: 6px;
        margin: 0 2px;
        background-color: #3b82f6;
        border-radius: 50%;
        animation: dot-flashing 1s infinite alternate;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes dot-flashing {
        0% {
          opacity: 0.2;
        }
        100% {
          opacity: 1;
        }
      }
      
      .input-container button:hover {
        background: #2563eb;
      }
      
      /* ç”¨æˆ¶æŠ½å±œæ¨£å¼ - å·¦å³å…©æ¬„å½ˆå‡ºå¼è¦–çª— */
      .user-drawer {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.8);
        width: 800px;
        max-width: 95vw;
        height: 600px;
        max-height: 90vh;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        transition: all 0.3s ease;
        z-index: 1000;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        opacity: 0;
        visibility: hidden;
      }
      
      .user-drawer.open {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
        visibility: visible;
      }
      
      .user-drawer-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none;
      }
      
      .user-drawer-overlay.open {
        display: block;
      }
      
      .user-drawer-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 24px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
        flex-shrink: 0;
      }
      
      .user-drawer-title {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .app-logo {
        font-size: 20px;
        font-weight: bold;
        color: #3b82f6;
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      
      .app-name {
        font-size: 16px;
        color: #374151;
        font-weight: 500;
      }
      
      .user-drawer-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #6b7280;
        cursor: pointer;
        padding: 8px;
        border-radius: 8px;
        transition: all 0.2s;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .user-drawer-close:hover {
        background: #e5e7eb;
        color: #374151;
      }
      
      /* å·¦å³å…©æ¬„å¸ƒå±€ */
      .user-drawer-body {
        display: flex;
        flex: 1;
        overflow: hidden;
      }
      
      /* å·¦å´é¸å–®æ¬„ */
      .user-drawer-sidebar {
        width: 250px;
        background: var(--bg-secondary);
        border-right: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }
      
      .user-profile {
        padding: 20px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 12px;
        transition: border-color 0.3s ease;
      }
      
      .user-drawer-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 2px solid var(--border-color);
        transition: border-color 0.3s ease;
      }
      
      .user-drawer-info h3 {
        margin: 0;
        font-size: 16px;
        color: var(--text-primary);
        font-weight: 600;
        transition: color 0.3s ease;
      }
      
      .user-drawer-info p {
        margin: 4px 0 0 0;
        font-size: 14px;
        color: var(--text-secondary);
        transition: color 0.3s ease;
      }
      
      /* å³å´å…§å®¹å€åŸŸ */
      .user-drawer-content {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        background: var(--card-bg);
        color: var(--text-primary);
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      
      
      .user-drawer-menu {
        list-style: none;
        padding: 0;
        margin: 0;
        flex: 1;
      }
      
      .user-drawer-menu li {
        margin: 0;
      }
      
      .user-drawer-menu a {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px 20px;
        color: var(--text-secondary);
        text-decoration: none;
        border-radius: 0;
        transition: all 0.2s;
        border-left: 3px solid transparent;
        font-weight: 500;
      }
      
      .user-drawer-menu a:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
      }
      
      .user-drawer-menu a.active {
        background: rgba(59, 130, 246, 0.2);
        color: var(--button-bg);
        border-left-color: var(--button-bg);
        font-weight: 600;
      }
      
      .user-drawer-menu .icon {
        width: 20px;
        height: 20px;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .content-section {
        display: none;
      }
      
      .content-section.active {
        display: block;
      }
      
      .content-section h2 {
        margin: 0 0 24px 0;
        font-size: 24px;
        color: #1f2937;
        font-weight: 600;
        border-bottom: 2px solid #e5e7eb;
        padding-bottom: 12px;
      }
      
      .user-info-detail {
        background: #f9fafb;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      
      .info-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding: 8px 0;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .info-item:last-child {
        border-bottom: none;
        margin-bottom: 0;
      }
      
      .info-item label {
        font-weight: 600;
        color: #374151;
        min-width: 80px;
      }
      
      .info-item span {
        color: #6b7280;
        word-break: break-all;
      }
      
      .generations-list, .conversations-list, .memory-content {
        max-height: 500px;
        overflow-y: auto;
      }
      
      .generation-item, .conversation-item {
        background: #f9fafb;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 10px;
        border-left: 3px solid #3b82f6;
      }
      
      /* è…³æœ¬åˆ—è¡¨æ¨£å¼ */
      .script-item {
        background: #f8f9fa;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        margin-bottom: 12px;
        overflow: hidden;
      }
      
      .script-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px;
        cursor: pointer;
        background: #fff;
        border-bottom: 1px solid #e5e7eb;
        transition: background-color 0.2s;
      }
      
      .script-header:hover {
        background: #f9fafb;
      }
      
      .script-info {
        display: flex;
        align-items: center;
        gap: 16px;
        flex: 1;
      }
      
      .script-number {
        background: #3b82f6;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
        width: 60px;
        min-width: 60px;
        max-width: 60px;
        text-align: center;
        white-space: nowrap;
        display: inline-block;
        box-sizing: border-box;
      }
      
      .script-name {
        font-weight: 500;
        color: #1f2937;
        cursor: pointer;
        padding: 4px 8px;
        border-radius: 4px;
        transition: background-color 0.2s;
      }
      
      .script-name:hover {
        background: #e5e7eb;
      }
      
      .script-date {
        color: #6b7280;
        font-size: 14px;
      }
      
      .script-toggle {
        color: #6b7280;
        font-size: 14px;
      }
      
      .script-content {
        padding: 16px;
        background: #fff;
        border-top: 1px solid #e5e7eb;
      }
      
      .script-table {
        overflow-x: auto;
      }
      
      .script-table table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }
      
      .script-table th,
      .script-table td {
        border: 1px solid #e5e7eb;
        padding: 8px 12px;
        text-align: left;
      }
      
      .script-table th {
        background: #f3f4f6;
        font-weight: 600;
        color: #374151;
      }
      
      .script-table td {
        color: #4b5563;
      }
      
      .script-actions {
        display: flex;
        gap: 8px;
        padding: 16px;
        background: #f8f9fa;
        border-top: 1px solid #e5e7eb;
        flex-wrap: wrap;
      }
      
      .action-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s;
      }
      
      .view-btn {
        background: #3b82f6;
        color: white;
      }
      
      .view-btn:hover {
        background: #2563eb;
      }
      
      .download-pdf-btn {
        background: #10b981;
        color: white;
      }
      
      .download-pdf-btn:hover {
        background: #059669;
      }
      .download-csv-btn {
        background: #06b6d4;
        color: white;
      }
      
      .download-csv-btn:hover {
        background: #0891b2;
      }
      
      .delete-btn {
        background: #ef4444;
        color: white;
      }
      
      .delete-btn:hover {
        background: #dc2626;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šæ“ä½œæŒ‰éˆ• */
      .theme-dark .action-btn {
        color: #ffffff !important;
      }
      
      .theme-dark .view-btn {
        background: var(--accent-blue) !important;
        color: #ffffff !important;
      }
      
      .theme-dark .view-btn:hover {
        background: var(--button-hover) !important;
      }
      
      .theme-dark .delete-btn {
        background: #ef4444 !important;
        color: #ffffff !important;
      }
      
      .theme-dark .delete-btn:hover {
        background: #dc2626 !important;
      }
      
      .theme-dark .action-btn.view-btn,
      .theme-dark .action-btn.delete-btn {
        color: #ffffff !important;
      }
      
      .generation-header {
        display: flex;
        gap: 10px;
        margin-bottom: 8px;
      }
      
      .generation-platform, .generation-topic {
        background: #dbeafe;
        color: #1d4ed8;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
      }
      
      .generation-content, .conversation-summary {
        color: #374151;
        line-height: 1.5;
        margin-bottom: 8px;
      }
      
      .generation-date, .conversation-date {
        font-size: 12px;
        color: #9ca3af;
      }
      
      .loading-text {
        text-align: center;
        color: #6b7280;
        font-style: italic;
        padding: 20px;
      }
      
      /* åº•éƒ¨å°èˆªæ¬„é»˜èªéš±è—ï¼ˆæ¡Œé¢ç‰ˆï¼‰ */
      .bottom-navbar {
        display: none;
      }
      
      /* å¸³è™Ÿå®šä½è¨˜éŒ„æ¨£å¼ */
      .positioning-record-item {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 12px;
        transition: all 0.2s ease;
      }
      
      .positioning-record-item:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šå¸³è™Ÿå®šä½è¨˜éŒ„å¡ç‰‡ */
      .theme-dark .positioning-record-item {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .positioning-record-item:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4) !important;
        transform: translateY(-2px) !important;
      }
      
      .theme-dark .record-header,
      .theme-dark .record-preview,
      .theme-dark .record-actions {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .record-number,
      .theme-dark .record-date {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .record-preview {
        color: var(--text-secondary) !important;
      }
      
      .record-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }
      
      .record-number {
        font-weight: 600;
        color: #3b82f6;
        font-size: 14px;
      }
      
      .record-date {
        color: #6b7280;
        font-size: 12px;
      }
      
      .record-preview {
        color: #374151;
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 12px;
        background: white;
        padding: 12px;
        border-radius: 6px;
        border-left: 3px solid #3b82f6;
      }
      
      .record-actions {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      
      .view-btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 12px;
        cursor: pointer;
        transition: background 0.2s ease;
      }
      
      .view-btn:hover {
        background: #2563eb;
      }
      
      .delete-btn {
        background: #ef4444;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 12px;
        cursor: pointer;
        transition: background 0.2s ease;
      }
      
      .delete-btn:hover {
        background: #dc2626;
      }
      
      /* å½ˆå‡ºè¦–çª—æ¨£å¼ */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 20px;
      }
      
      .modal-content {
        background: white;
        border-radius: 12px;
        max-width: 600px;
        width: 100%;
        max-height: 80vh;
        overflow: hidden;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šæ¨¡æ…‹æ¡† */
      .theme-dark .modal-content {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .modal-header {
        background: var(--bg-secondary) !important;
        border-bottom-color: var(--border-color) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .modal-body {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .modal-close {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .modal-close:hover {
        background: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }
      
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8f9fa;
      }
      
      .modal-header h3 {
        margin: 0;
        font-size: 18px;
        color: #1f2937;
      }
      
      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #6b7280;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s ease;
      }
      
      .modal-close:hover {
        background: #e5e7eb;
        color: #374151;
      }
      
      .modal-body {
        padding: 20px;
        max-height: 60vh;
        overflow-y: auto;
      }
      
      .record-detail {
        line-height: 1.6;
      }
      
      .detail-meta {
        margin-bottom: 16px;
        padding-bottom: 12px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .detail-label {
        font-weight: 600;
        color: #374151;
        margin-right: 8px;
      }
      
      .detail-value {
        color: #6b7280;
      }
      
      .detail-content {
        background: #f8f9fa;
        padding: 16px;
        border-radius: 8px;
        border-left: 4px solid #3b82f6;
      }
      
      .content-text {
        color: #1f2937;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      
      .modal-footer {
        padding: 20px;
        border-top: 1px solid #e5e7eb;
        background: #f8f9fa;
        text-align: right;
      }
      
      /* æŠ½å±œå…§å®¹å€åŸŸæ¨£å¼ */
      .drawer-content {
        padding: 20px;
        max-height: 400px;
        overflow-y: auto;
      }
      
      .content-section {
        display: none;
      }
      
      .content-section.active {
        display: block;
      }
      
      .content-section h3 {
        margin: 0 0 15px 0;
        color: #333;
        font-size: 18px;
        border-bottom: 2px solid #007bff;
        padding-bottom: 5px;
      }
      
      .user-info-detail {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
      }
      
      .info-item {
        display: flex;
        margin-bottom: 10px;
      }
      
      .info-item label {
        font-weight: bold;
        min-width: 80px;
        color: #666;
      }
      
      .info-item span {
        color: #333;
      }
      
      .generations-list,
      .conversations-list,
      .memory-content {
        max-height: 300px;
        overflow-y: auto;
      }
      
      .generation-item,
      .conversation-item {
        background: #f8f9fa;
        padding: 12px;
        margin-bottom: 10px;
        border-radius: 6px;
        border-left: 3px solid #007bff;
      }
      
      .generation-header {
        display: flex;
        gap: 10px;
        margin-bottom: 8px;
      }
      
      .generation-platform {
        background: #007bff;
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
      }
      
      .generation-topic {
        background: #28a745;
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
      }
      
      .generation-content,
      .conversation-summary {
        color: #333;
        margin-bottom: 5px;
        line-height: 1.4;
      }
      
      .generation-date,
      .conversation-date {
        color: #666;
        font-size: 12px;
      }
      
      .loading-text {
        text-align: center;
        color: #666;
        font-style: italic;
      }
      
      /* è¨­å®šå€å¡Šæ¨£å¼ */
      .settings-block {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
      }
      
      .settings-block h3 {
        font-size: 20px;
        font-weight: 600;
        color: #1f2937;
        margin: 0 0 16px 0;
        padding-bottom: 8px;
        border-bottom: 2px solid #e5e7eb;
      }
      
      .settings-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
        margin-bottom: 20px;
      }
      
      .setting-item {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      
      .setting-item label {
        font-size: 14px;
        font-weight: 500;
        color: var(--text-primary);
        transition: color 0.3s ease;
      }
      
      .setting-item input,
      .setting-item select {
        padding: 12px 16px;
        border: 1px solid var(--input-border);
        border-radius: 8px;
        font-size: 14px;
        background: var(--input-bg);
        color: var(--text-primary);
        transition: border-color 0.2s, background-color 0.3s ease, color 0.3s ease;
      }
      
      .setting-item input:focus,
      .setting-item select:focus {
        outline: none;
        border-color: var(--button-bg);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      .apply-btn {
        width: 100%;
        padding: 12px 24px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
      }
      
      .apply-btn:hover {
        background: #2563eb;
      }
      
      /* AI èªªæ˜å€å¡Šæ¨£å¼ */
      .ai-instructions {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        margin-bottom: 20px;
      }
      
      .instructions-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 20px;
        cursor: pointer;
        border-radius: 12px 12px 0 0;
        transition: background-color 0.2s;
      }
      
      .instructions-header:hover {
        background-color: #f8fafc;
      }
      
      .instructions-header h3 {
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
        padding-bottom: 0;
        border-bottom: none;
      }
      
      .instructions-toggle {
        font-size: 16px;
        color: #6b7280;
        transition: transform 0.2s ease;
      }
      
      .instruction-list {
        padding: 0 20px 20px 20px;
        transition: all 0.3s ease;
        overflow: hidden;
        display: none;
      }
      
      .instruction-list.collapsed {
        padding: 0 20px;
        max-height: 0;
        display: none;
      }
      
      .instruction-list.show {
        display: block;
      }
      
      .instruction-list p {
        margin: 0 0 12px 0;
        font-size: 14px;
        color: #6b7280;
        line-height: 1.5;
      }
      
      /* ç°¡æ½”èªªæ˜æ¨£å¼ */
      .instruction-list p {
        margin: 0 0 12px 0;
        font-size: 14px;
        color: #6b7280;
        line-height: 1.6;
      }
      
      .instruction-list p:last-child {
        margin-bottom: 0;
        padding-top: 8px;
        border-top: 1px solid #e5e7eb;
        font-size: 13px;
        color: #9ca3af;
      }
      
      /* æ§åˆ¶å€åŸŸæ¨£å¼ */
      .controls {
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      
      .controls .row {
        display: flex;
        gap: 12px;
        align-items: center;
      }
      
      .control-btn, .secondary-btn {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        flex: 1;
      }
      
      .control-btn {
        background: #10b981;
        color: white;
      }
      
      .control-btn:hover {
        background: #059669;
      }
      
      .secondary-btn {
        background: #f3f4f6;
        color: #374151;
        border: 1px solid #d1d5db;
      }
      
      .secondary-btn:hover {
        background: #e5e7eb;
      }
      
      .controls textarea {
        flex: 1;
        padding: 12px 16px;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 14px;
        resize: vertical;
        min-height: 50px;
        font-family: inherit;
      }
      
      .controls textarea:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      .send-btn {
        padding: 12px 24px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.2s;
        white-space: nowrap;
      }
      
      .send-btn:hover {
        background: #2563eb;
      }
      
      /* æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
      @media (max-width: 768px) {
        .container { padding: 12px; }
        .main-layout { 
          flex-direction: column; 
          gap: 16px;
        }
        .left-panel { 
          order: 1;
        }
        .right-panel { 
          order: 2;
        }
        .left-content {
          padding: 16px;
        }
        .settings-grid {
          grid-template-columns: 1fr;
          gap: 12px;
        }
        .chat-messages {
          min-height: 300px;
          max-height: 400px;
        }
        .result-tabs {
          flex-direction: column;
        }
        .result-tab {
          border-right: none;
          border-bottom: 1px solid #e5e7eb;
        }
        .result-tab:last-child {
          border-bottom: none;
        }
        .result-content {
          min-height: 200px;
        }
        .user-drawer {
          width: 280px;
          right: -280px;
        }
        .input-row {
          flex-direction: column;
          gap: 8px;
        }
        
        .input-container {
          flex-direction: row;
          gap: 8px;
          align-items: flex-end;
        }
        .input-container button {
          width: auto;
          min-width: 80px;
          flex-shrink: 0;
        }
        h1 { font-size: 16px; margin-bottom: 12px; }
        .chat { height: 50vh; padding: 12px; }
        .msg-bubble { max-width: 90%; padding: 10px 14px; font-size: 14px; }
        .settings-block { padding: 16px; margin-bottom: 12px; }
        .settings-block h3 { font-size: 14px; margin-bottom: 12px; }
        .settings-grid { grid-template-columns: 1fr; gap: 10px; margin-bottom: 12px; }
        .setting-item input, .setting-item select { padding: 10px 12px; font-size: 16px; }
        .apply-btn { padding: 12px 16px; font-size: 14px; }
        .controls { flex-direction: column; gap: 10px; }
        .controls .row { flex-direction: row !important; justify-content: space-between; }
        .controls .row button { flex: 1; margin: 0 4px; }
        textarea { min-height: 40px; font-size: 16px; }
        button { padding: 12px 16px; font-size: 14px; }
        .results-block { padding: 16px; }
        .results-block h3 { font-size: 14px; }
        .result-item h4 { font-size: 13px; }
        .result-item .content { padding: 10px; font-size: 14px; }
        .toast { top: 10px; right: 10px; left: 10px; max-width: none; font-size: 13px; }
      }
      h1 { font-size: 18px; font-weight: 600; color:#2563eb; margin: 0 0 16px; }
      
      /* ç”¨æˆ¶èªè­‰æ¨£å¼ */
      .header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        margin-bottom: 16px; 
      }
      .header-right {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .user-info { 
        display: flex; 
        align-items: center; 
        gap: 8px; 
        cursor: pointer;
        padding: 8px 12px;
        border-radius: 8px;
        transition: background 0.2s;
      }
      .user-info:hover {
        background: #f3f4f6;
      }
      .user-avatar { 
        width: 32px; 
        height: 32px; 
        border-radius: 50%; 
        border: 2px solid #e5ecef; 
        object-fit: cover;
        object-position: center;
      }
      .user-name { font-size: 14px; font-weight: 500; color: #374151; }
      .auth-buttons { display: flex; gap: 8px; }
      .login-btn, .logout-btn { 
        padding: 8px 16px; 
        border: none; 
        border-radius: 6px; 
        font-size: 14px; 
        font-weight: 500; 
        cursor: pointer; 
        transition: all 0.2s;
      }
      .login-btn { 
        background: #4285f4; 
        color: white; 
      }
      .login-btn:hover { background: #3367d6; }
      .logout-btn { 
        background: #f3f4f6; 
        color: #374151; 
        border: 1px solid #d1d5db;
      }
      .logout-btn:hover { background: #e5e7eb; }
      
      /* å½ˆè·³è¦–çª—ç™»å…¥æ¨£å¼ */
      .popup-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        display: none;
        align-items: center;
        justify-content: center;
      }
      
      .popup-content {
        background: white;
        border-radius: 12px;
        padding: 30px;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        max-width: 400px;
        width: 90%;
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šå½ˆå‡ºè¦–çª— */
      .theme-dark .popup-content {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .popup-content h3,
      .theme-dark .popup-content p {
        color: var(--text-primary) !important;
      }
      
      .popup-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }
      
      .popup-message {
        font-size: 16px;
        color: #2c3e50;
        margin-bottom: 20px;
      }
      
      .popup-btn {
        background: #3498db;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 16px;
        margin: 0 10px;
      }
      
      .popup-btn:hover {
        background: #2980b9;
      }
      
      .popup-btn.secondary {
        background: #95a5a6;
      }
      
      .popup-btn.secondary:hover {
        background: #7f8c8d;
      }
      
      /* æ‰‹æ©Ÿç‰ˆç”¨æˆ¶èªè­‰å„ªåŒ– */
      @media (max-width: 768px) {
        .header { flex-direction: column; align-items: flex-start; gap: 12px; }
        .user-info { width: 100%; justify-content: space-between; }
        .auth-buttons { width: 100%; justify-content: flex-end; }
        .login-btn, .logout-btn { padding: 10px 16px; font-size: 16px; }
      }
      .chat { border: 1px solid #e5e7eb; background: #f9fafb; border-radius: 12px; height: 60vh; overflow: auto; padding: 16px; }
      .msg { margin: 12px 0; line-height: 1.6; display: flex; }
      .msg.user { justify-content: flex-end; }
      .msg.assistant { justify-content: flex-start; }
      .msg-bubble { max-width: 80%; padding: 12px 16px; border-radius: 18px; white-space: pre-wrap; word-wrap: break-word; }
      .msg.user .msg-bubble { background: #3b82f6; color: #ffffff; border-bottom-right-radius: 4px; }
      .msg.assistant .msg-bubble { background: #f3f4f6; color: #374151; border-bottom-left-radius: 4px; }
      
      /* æ·±è‰²æ¨¡å¼ï¼šæ‰‹æ©Ÿç‰ˆ msg-bubble */
      .theme-dark .msg.assistant .msg-bubble {
        background: var(--gradient-card) !important;
        color: #ffffff !important;
      }
      
      .theme-dark .msg.assistant .msg-bubble p,
      .theme-dark .msg.assistant .msg-bubble span,
      .theme-dark .msg.assistant .msg-bubble div {
        color: #ffffff !important;
      }
      .msg-label { font-size: 11px; color: #6b7280; margin-bottom: 4px; font-weight: 500; }
      .msg.user .msg-label { text-align: right; }
      .msg.assistant .msg-label { text-align: left; }
      
      /* è¼‰å…¥å‹•ç•« */
      .loading { 
        display: flex; 
        align-items: center; 
        gap: 8px; 
        padding: 8px 12px;
        background: #f0f9ff;
        color: #0c4a6e;
        border-radius: 8px;
        margin-right: 20px;
        max-width: 70%;
        position: relative;
      }
      
      .loading::after {
        content: '';
        position: absolute;
        right: -8px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-left: 8px solid #f0f9ff;
        border-top: 8px solid transparent;
        border-bottom: 8px solid transparent;
      }
      .spinner { 
        width: 16px; 
        height: 16px; 
        border: 2px solid #e5e7eb; 
        border-top: 2px solid #3b82f6; 
        border-radius: 50%; 
        animation: spin 1s linear infinite; 
      }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
      .controls { display: flex; gap: 8px; margin-top: 12px; align-items:center; }
      textarea { flex: 1; min-height: 40px; max-height: 140px; resize: vertical; border-radius: 10px; border:1px solid #d1d5db; background:#ffffff; color:#374151; padding: 10px 12px; line-height: 1.4; -webkit-appearance: none; }
      button { padding: 10px 14px; border-radius: 10px; border:1px solid #d1d5db; background:#f9fafb; color:#374151; cursor:pointer; -webkit-appearance: none; }
      button:disabled { opacity: .6; cursor:not-allowed; }
      .row { display:flex; gap:8px; flex-direction:column; }
      .meta { display:flex; gap:8px; margin-bottom:8px; align-items:center; flex-wrap:wrap; }
      .meta input, .meta select { flex:1; min-width: 200px; border-radius: 8px; border:1px solid #d1d5db; background:#ffffff; color:#374151; padding:8px 10px; }
      .small { font-size:12px; color:#6b7280; }
      .tag { display:inline-block; padding:4px 8px; border:1px solid #d1d5db; border-radius:999px; font-size:12px; color:#6b7280; background:#f3f4f6; }
      
      /* è¨­å®šå€å¡Šæ¨£å¼ */
      .settings-block { background:#ffffff; border:1px solid #e5e7eb; border-radius:12px; padding:20px; margin-bottom:16px; transition: background-color 0.3s ease, border-color 0.3s ease; }
      .settings-block h3 { margin:0 0 16px; color:#2563eb; font-size:16px; cursor:pointer; user-select:none; display:flex; align-items:center; gap:8px; }
      .settings-block h3:hover { color:#1d4ed8; }
      .settings-toggle { font-size:12px; transition:transform 0.2s ease; }
      .settings-content { transition:all 0.3s ease; overflow:hidden; }
      .settings-content.collapsed { max-height:0; margin:0; padding:0; }
      .settings-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:12px; margin-bottom:16px; }
      .setting-item { display:flex; flex-direction:column; gap:6px; }
      .setting-item label { font-size:12px; color:#6b7280; font-weight:500; transition: color 0.3s ease; }
      .setting-item input, .setting-item select { padding:8px 12px; border-radius:8px; border:1px solid #d1d5db; background:#ffffff; color:#374151; -webkit-appearance: none; transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; }
      
      /* æ·±è‰²æ¨¡å¼ï¼šè¨­å®šå€å¡Š */
      .theme-dark .settings-block {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .settings-block h3 {
        color: var(--accent-blue) !important;
      }
      
      .theme-dark .settings-block h3:hover {
        color: #60a5fa !important;
      }
      
      .theme-dark .setting-item label {
        color: var(--text-secondary) !important;
      }
      
      .theme-dark .setting-item input,
      .theme-dark .setting-item select {
        background: var(--input-bg) !important;
        color: #ffffff !important; /* ç™½è‰²æ–‡å­— */
        border-color: var(--input-border) !important;
      }
      
      .theme-dark .setting-item input::placeholder,
      .theme-dark .setting-item select::placeholder {
        color: var(--text-tertiary) !important;
        opacity: 0.8 !important;
      }
      
      /* è¦†è“‹å…§è¯æ¨£å¼ä¸­çš„ç™½è‰²èƒŒæ™¯å’Œæ·±è‰²æ–‡å­— */
      .theme-dark .setting-item input[style*="background"],
      .theme-dark .setting-item select[style*="background"],
      .theme-dark input[style*="background: white"],
      .theme-dark input[style*="background:white"],
      .theme-dark input[style*="background: #ffffff"],
      .theme-dark input[style*="background:#ffffff"],
      .theme-dark select[style*="background: white"],
      .theme-dark select[style*="background:white"] {
        background: var(--input-bg) !important;
        color: #ffffff !important; /* ç™½è‰²æ–‡å­— */
        border-color: var(--input-border) !important;
      }
      
      .theme-dark input[style*="color: #374151"],
      .theme-dark input[style*="color:#374151"],
      .theme-dark select[style*="color: #374151"],
      .theme-dark select[style*="color:#374151"] {
        color: #ffffff !important; /* å¼·åˆ¶æ”¹ç‚ºç™½è‰² */
      }
      .apply-btn { background:#3b82f6; border:1px solid #2563eb; color:#ffffff; padding:10px 20px; border-radius:8px; cursor:pointer; font-weight:500; }
      .apply-btn:hover { background:#2563eb; }
      .applied-tags { display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
      
      /* çµæœå€å¡Šæ¨£å¼ */
      .results-block { background:#ffffff; border:1px solid #e5e7eb; border-radius:12px; padding:20px; margin-top:16px; display:none; }
      .results-block h3 { margin:0 0 16px; color:#2563eb; font-size:16px; }
      
      .theme-dark .results-block {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .results-block h3 {
        color: var(--accent-blue) !important;
      }
      .result-item { margin-bottom:16px; }
      .result-item h4 { margin:0 0 8px; color:#374151; font-size:14px; font-weight:500; }
      .result-item .content { background:#f9fafb; border:1px solid #e5e7eb; border-radius:8px; padding:12px; color:#374151; white-space:pre-wrap; line-height:1.6; }
      
      .theme-dark .result-item h4 {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .result-item .content {
        background: var(--bg-secondary) !important;
        border-color: var(--border-color) !important;
        color: var(--text-primary) !important;
      }
      
      /* å½ˆå‡ºæ¡†æ¨£å¼ */
      .toast { position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 12px 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; font-size: 14px; max-width: 300px; word-wrap: break-word; }
      
      .theme-dark .toast {
        background: #10b981 !important;
        color: white !important;
        box-shadow: 0 4px 12px rgba(0,0,0,0.4) !important;
      }
      .toast.show { animation: slideIn 0.3s ease-out; }
      .toast.hide { animation: slideOut 0.3s ease-in; }
      @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
      @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }
      
      /* iOS Safari ç‰¹å®šå„ªåŒ– */
      @supports (-webkit-touch-callout: none) {
        .chat { -webkit-overflow-scrolling: touch; }
        textarea { -webkit-user-select: text; }
        input, select { -webkit-user-select: text; }
        .msg-bubble { -webkit-user-select: text; }
        .result-item .content { -webkit-user-select: text; }
      }
      
      /* é˜²æ­¢ iOS Safari ç¸®æ”¾ */
      input[type="text"], input[type="email"], input[type="password"], textarea, select { font-size: 16px; }
      
      /* å¿«é€ŸæŒ‰éˆ•æ¨£å¼ */
      /* å¿«é€ŸæŒ‰éˆ•ï¼šé è¨­éš±è—ï¼Œåªåœ¨ mode2 é é¢é¡¯ç¤º */
      .quick-buttons { 
        display: none !important; 
      }
      
      #mode2.active .quick-buttons {
        display: flex !important;
        gap: 8px; 
        margin-bottom: 12px; 
        flex-wrap: wrap;
        justify-content: center;
      }
      .quick-btn { 
        padding: 10px 18px; 
        border-radius: 20px; 
        border: 1px solid #3b82f6; 
        background: #ffffff; 
        color: #3b82f6; 
        cursor: pointer; 
        font-size: 16px;
        font-weight: 500;
        transition: all 0.2s ease;
        white-space: nowrap;
      }
      .quick-btn:hover { 
        background: #3b82f6; 
        color: #ffffff; 
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
      }
      .quick-btn:active { 
        transform: translateY(0); 
        box-shadow: 0 1px 4px rgba(59, 130, 246, 0.2);
      }
      
      /* æ‰‹æ©Ÿç‰ˆå¿«é€ŸæŒ‰éˆ•å„ªåŒ–ï¼šåªåœ¨ mode2 é é¢é¡¯ç¤º */
      @media (max-width: 768px) {
        /* é è¨­éš±è— */
        .quick-buttons,
        .input-row {
          display: none !important;
        }
        
        /* åªåœ¨ mode2 é é¢é¡¯ç¤º */
        #mode2.active .quick-buttons { 
          display: flex !important;
          gap: 6px; 
          margin-bottom: 8px;
          visibility: visible !important;
          opacity: 1 !important;
          height: auto !important;
          min-height: auto !important;
          padding: 0 !important;
          background: transparent !important;
        }
        .quick-btn { 
          padding: 6px 8px; 
          font-size: 12px;
          flex: 1;
          min-width: 0;
          text-align: center;
        }
        #mode2.active .input-row {
          display: flex !important;
          visibility: visible !important;
          opacity: 1 !important;
          height: auto !important;
          min-height: 80px !important;
        }
      }
      
      /* å¸³è™Ÿå®šä½è¨˜éŒ„åˆ—è¡¨æ¨£å¼ */
      .positioning-history-content {
        padding: 10px;
        max-height: 500px;
        overflow-y: auto;
      }
      
      .positioning-records {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      
      .positioning-record-item {
        background: #f9fafb;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 12px;
      }
      
      .record-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        padding-bottom: 8px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .record-number {
        font-weight: 600;
        color: #3b82f6;
        font-size: 14px;
      }
      
      .record-date {
        font-size: 12px;
        color: #6b7280;
      }
      
      .record-preview {
        color: #374151;
        font-size: 14px;
        margin-bottom: 10px;
        line-height: 1.5;
      }
      
      .record-actions {
        display: flex;
        gap: 8px;
      }
      
      .view-btn, .delete-btn {
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 13px;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .view-btn {
        background: #3b82f6;
        color: white;
      }
      
      .view-btn:hover {
        background: #2563eb;
      }
      
      .delete-btn {
        background: #ef4444;
        color: white;
      }
      
      .delete-btn:hover {
        background: #dc2626;
      }
      
      /* è©³ç´°å…§å®¹å½ˆå‡ºè¦–çª—æ¨£å¼ */
      .detail-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      }
      
      .detail-modal {
        background: white;
        border-radius: 12px;
        width: 90%;
        max-width: 700px;
        max-height: 80vh;
        display: flex;
        flex-direction: column;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        transition: background-color 0.3s ease, color 0.3s ease;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šè©³ç´°å…§å®¹æ¨¡æ…‹æ¡†ï¼ˆå·²åœ¨ä¸Šé¢å®šç¾©ï¼Œé€™è£¡ç¢ºä¿è¦†è“‹ï¼‰ */
      .theme-dark .detail-modal {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .detail-modal-header {
        background: var(--bg-secondary) !important;
        border-bottom-color: var(--border-color) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .detail-modal-body {
        background: var(--gradient-card) !important;
        color: var(--text-primary) !important;
      }
      
      .theme-dark .detail-info,
      .theme-dark .detail-content,
      .theme-dark .record-detail,
      .theme-dark .detail-meta,
      .theme-dark .detail-value,
      .theme-dark .content-text {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .detail-meta .detail-label {
        color: var(--text-secondary) !important;
      }
      
      .theme-dark .close-detail-btn {
        color: var(--text-primary) !important;
      }
      
      .theme-dark .close-detail-btn:hover {
        background: var(--bg-tertiary) !important;
        color: var(--text-primary) !important;
      }
      
      .detail-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 24px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .detail-modal-header h3 {
        margin: 0;
        font-size: 20px;
        color: #111827;
      }
      
      .close-detail-btn {
        background: none;
        border: none;
        font-size: 24px;
        color: #6b7280;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: all 0.2s;
      }
      
      .close-detail-btn:hover {
        background: #f3f4f6;
        color: #111827;
      }
      
      .detail-modal-body {
        padding: 24px;
        overflow-y: auto;
        flex: 1;
      }
      
      .detail-info {
        display: flex;
        gap: 24px;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .detail-info span {
        font-size: 14px;
        color: #6b7280;
      }
      
      .detail-info strong {
        color: #111827;
        font-weight: 600;
      }
      
      .detail-content {
        color: #374151;
        line-height: 1.8;
        font-size: 15px;
      }
      
      
      /* æ“´å¤§ç”¨æˆ¶æŠ½å±œè¦–çª— */
      .user-drawer {
        width: 85%;
        max-width: 1000px;
        height: 85vh;
        max-height: 700px;
      }
      
      /* å€‹äººè³‡æ–™åº«é é¢æ¨£å¼ */
      .user-db-page {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
      }
      
      .page-title {
        font-size: 24px;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 24px;
        text-align: center;
      }
      
      .user-db-container {
        display: flex;
        gap: 24px;
        min-height: 600px;
      }
      
      .user-db-sidebar {
        width: 280px;
        background: var(--bg-secondary);
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 1px 3px var(--shadow);
        transition: background-color 0.3s ease;
      }
      
      .sidebar-header {
        margin-bottom: 24px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--border-color);
        transition: border-color 0.3s ease;
      }
      
      .user-profile {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .profile-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: 2px solid var(--border-color);
        transition: border-color 0.3s ease;
      }
      
      .profile-info h3 {
        margin: 0 0 4px 0;
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        transition: color 0.3s ease;
      }
      
      .profile-info p {
        margin: 0;
        font-size: 14px;
        color: var(--text-secondary);
        transition: color 0.3s ease;
      }
      
      .sidebar-menu {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      
      .menu-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        background: none;
        text-align: left;
        font-size: 14px;
        color: var(--text-secondary);
      }
      
      .menu-item:hover {
        background: var(--bg-tertiary);
        color: var(--text-primary);
      }
      
      .menu-item.active {
        background: var(--button-bg);
        color: var(--button-text);
      }
      
      .menu-icon {
        font-size: 16px;
      }
      
      .menu-text {
        font-weight: 500;
      }
      
      .menu-divider {
        height: 1px;
        background: var(--border-color);
        margin: 12px 0;
        transition: background-color 0.3s ease;
      }
      
      .logout-item {
        color: #dc2626;
      }
      
      .logout-item:hover {
        background: rgba(239, 68, 68, 0.1);
        color: #dc2626;
      }
      
      .user-db-content {
        flex: 1;
        background: var(--card-bg);
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 1px 3px var(--shadow);
        transition: background-color 0.3s ease;
      }
      
      .db-section {
        display: none;
      }
      
      .db-section.active {
        display: block;
      }
      
      .section-title {
        font-size: 20px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 16px;
        transition: color 0.3s ease;
      }
      
      .section-content {
        color: var(--text-secondary);
        line-height: 1.6;
        transition: color 0.3s ease;
      }
      
      .profile-details {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }
      
      .detail-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        background: var(--bg-secondary);
        border-radius: 8px;
        transition: background-color 0.3s ease;
      }
      
      .detail-item label {
        font-weight: 600;
        color: var(--text-primary);
        min-width: 80px;
        transition: color 0.3s ease;
      }
      
      .detail-item span {
        color: var(--text-secondary);
        transition: color 0.3s ease;
      }

      /* ===== æ¨¡å¼3ï¼šIPäººè¨­è¦åŠƒæ¨¡å¼æ¨£å¼ ===== */
      .mode3-page {
        min-height: 100vh;
        background: transparent; /* èˆ‡ Mode2 ä¸€è‡´ï¼Œç§»é™¤ç°è‰²èƒŒæ™¯ */
        padding: 0;
      }
      
      /* IPäººè¨­è¦åŠƒå›ºå®šä½ˆå±€ */
      .mode3-fixed {
        position: relative;
        width: 100%;
        min-height: calc(100vh - 60px);
        background: transparent; /* èˆ‡ Mode2 ä¸€è‡´ï¼Œç§»é™¤ç°è‰²èƒŒæ™¯ */
      }
      
      .mode3-page {
        position: relative;
        width: 100%;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }
      
      .mode3-chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 80px 20px 0 20px;
        overflow: hidden;
      }
      
      /* Mode3 ä½¿ç”¨èˆ‡ Mode2 ç›¸åŒçš„æ¨£å¼çµæ§‹ */
      .mode3-chat-container {
        display: flex;
        flex-direction: column;
        flex: 1;
        min-height: 0;
      }
      
      #mode3-chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 16px 24px;
        margin: 0;
        background: transparent;
        border: none;
        border-radius: 0;
        min-height: 0;
        height: auto;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
        touch-action: pan-y;
        position: relative;
        z-index: 1;
        width: 100%;
        max-width: 100%;
        box-sizing: border-box;
      }
      
      /* Mode3 è¼¸å…¥å€åŸŸä½¿ç”¨èˆ‡ Mode2 ç›¸åŒçš„æ¨£å¼ */
      .mode3-chat-container .input-row {
        background: transparent;
        border: none;
        padding: 8px 24px 16px 24px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      
      .mode3-chat-container .input-container {
        display: flex;
        gap: 12px;
        align-items: flex-end;
        width: 100%;
      }
      
      /* Mode3 å¿«é€ŸæŒ‰éˆ•ä½¿ç”¨èˆ‡ Mode2 ç›¸åŒçš„æ¨£å¼ï¼ˆé›»è…¦ç‰ˆï¼‰ */
      .mode3-chat-container .quick-buttons {
        gap: 8px;
        padding: 0;
        margin: 0;
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start;
        width: 100%;
        background: transparent;
        box-sizing: border-box;
      }
      
      .mode3-chat-container .quick-btn {
        background: transparent;
        border: 1px solid #d1d5db;
        color: #374151;
        padding: 8px 16px;
        border-radius: 16px;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
        font-weight: 400;
        box-shadow: none;
        width: auto;
        min-width: fit-content;
        flex-shrink: 0;
        display: inline-flex;
        justify-content: center;
        align-items: center;
      }
      
      .mode3-chat-container .quick-btn:hover {
        background: #3b82f6;
        border-color: #3b82f6;
        color: white;
      }
      
      /* Mode3 è¼¸å…¥æ¡†ä½¿ç”¨èˆ‡ Mode2 ç›¸åŒçš„æ¨£å¼ */
      #mode3-message-input {
        flex: 1;
        min-height: 44px;
        max-height: 200px;
        border: 1px solid #d1d5db;
        border-radius: 10px;
        padding: 10px 12px;
        font-size: 14px;
        background: #ffffff;
        resize: vertical;
        overflow-y: auto;
        line-height: 1.5;
      }
      
      #mode3-message-input:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        outline: none;
      }
      
      #mode3-send-btn {
        height: 44px;
        min-width: 44px;
        border-radius: 10px;
        background: #3b82f6;
        color: #ffffff;
        border: none;
        padding: 0 18px;
        cursor: pointer;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      #mode3-send-btn:hover {
        background: #2563eb;
      }
      
      #mode3-send-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
      }
      
      /* ä¿ç•™èˆŠçš„ mode3 æ¨£å¼ä½œç‚ºå‚™ç”¨ï¼ˆä½†æœƒè¢«æ–°æ¨£å¼è¦†è“‹ï¼‰ */
      .mode3-input-container {
        position: sticky;
        bottom: 0;
      }
      
      /* Mode3 è¨Šæ¯æ¡†æ¨£å¼ - èˆ‡ Mode2 ä¸€è‡´ï¼Œç¢ºä¿ç”¨æˆ¶å°è©±åœ¨å³é‚Š */
      #mode3 .message.user,
      #mode3-chatMessages .message.user,
      #mode3-chat-messages .message.user,
      #mode3 .message.user.message,
      #mode3-chatMessages .message.user.message {
        display: flex !important;
        flex-direction: row !important; /* æ­£å¸¸é †åºï¼šå…§å®¹åœ¨å·¦ï¼Œé ­åƒåœ¨å³ */
        align-items: flex-start !important;
        justify-content: flex-end !important; /* å³å°é½Šï¼Œè®“æ•´å€‹æ¶ˆæ¯é å³ */
        margin-bottom: 16px !important;
        background: transparent !important;
        margin-left: auto !important; /* ç¢ºä¿æ¶ˆæ¯æ•´é«”é å³ */
      }
      
      #mode3 .message.user .message-content,
      #mode3-chatMessages .message.user .message-content,
      #mode3-chat-messages .message.user .message-content {
        flex: 1 !important;
        background: #dbeafe !important; /* æ·»åŠ èƒŒæ™¯è‰²ï¼Œèˆ‡ Mode2 ä¸€è‡´ */
        padding: 20px 40px !important; /* èˆ‡ AI å›è¦†æ¡†ä¸€æ¨£çš„ paddingï¼Œèˆ‡ Mode2 ä¸€è‡´ */
        padding-left: 50px !important; /* å¢åŠ å·¦é‚Š paddingï¼Œé¿å…æ–‡å­—å¤ªè²¼é‚Šç•Œ */
        border-radius: 12px !important; /* æ·»åŠ åœ“è§’ */
        border: 1px solid #3b82f6 !important; /* æ·»åŠ é‚Šæ¡† */
        color: #1e40af !important; /* æ·»åŠ æ–‡å­—é¡è‰² */
        line-height: 1.6 !important; /* èˆ‡ Mode2 ä¸€è‡´çš„è¡Œé«˜ */
        text-align: right !important; /* ç”¨æˆ¶å°è©±æ³¡æ³¡æ–‡å­—é å³å°é½Š */
        margin-right: 12px !important; /* å°è©±æ³¡æ³¡èˆ‡é ­åƒä¹‹é–“çš„é–“è· */
        margin-left: 0 !important;
        order: 1 !important; /* ç¢ºä¿å…§å®¹åœ¨å·¦é‚Š */
        font-size: 16px !important; /* å­—é«”å¤§å° */
        box-sizing: border-box !important;
      }
      
      /* Mode3 ç”¨æˆ¶é ­åƒæ¨£å¼ - ç¢ºä¿åœ¨å°è©±æ³¡æ³¡å³é‚Š */
      #mode3 .message.user .message-avatar,
      #mode3-chatMessages .message.user .message-avatar,
      #mode3-chat-messages .message.user .message-avatar {
        width: 32px !important;
        height: 32px !important;
        border-radius: 50% !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        flex-shrink: 0 !important;
        margin-right: 0 !important;
        margin-left: 0 !important; /* ç§»é™¤å·¦é‚Šè·ï¼Œå› ç‚ºå·²ç¶“åœ¨å³é‚Š */
        background: #3b82f6 !important;
        color: white !important;
        overflow: hidden !important;
        order: 2 !important; /* ç¢ºä¿é ­åƒåœ¨å³é‚Š */
      }
      
      #mode3 .message.user .message-avatar img,
      #mode3-chatMessages .message.user .message-avatar img,
      #mode3-chat-messages .message.user .message-avatar img {
        width: 100% !important;
        height: 100% !important;
        border-radius: 50% !important;
        object-fit: cover !important;
        display: block !important;
      }
      
      #mode3 .message.user .message-avatar:has(img),
      #mode3-chatMessages .message.user .message-avatar:has(img),
      #mode3-chat-messages .message.user .message-avatar:has(img) {
        background: transparent !important;
      }
      
      /* Mode3 AI è¨Šæ¯å®¹å™¨æ¨£å¼ - èˆ‡ Mode2 ä¸€è‡´ */
      #mode3 .message.ai,
      #mode3-chatMessages .message.ai,
      #mode3-chat-messages .message.ai,
      #mode3 .message.assistant,
      #mode3-chatMessages .message.assistant,
      #mode3-chat-messages .message.assistant {
        display: flex !important;
        margin-bottom: 16px !important;
        align-items: flex-start !important;
        background: transparent !important;
      }
      
      /* Mode3 AI å°è©±æ³¡æ³¡å…§å®¹æ¨£å¼ - èˆ‡ Mode2 å®Œå…¨ä¸€è‡´ */
      #mode3 .message.ai .message-content,
      #mode3-chatMessages .message.ai .message-content,
      #mode3-chat-messages .message.ai .message-content,
      #mode3 .message.assistant .message-content,
      #mode3-chatMessages .message.assistant .message-content,
      #mode3-chat-messages .message.assistant .message-content {
        flex: 1 !important;
        background: #f8fafc !important;
        padding: 20px 40px !important;
        border-radius: 12px !important;
        border: 1px solid #e5e7eb !important;
        color: #1f2937 !important;
        margin-left: 12px !important;
        font-size: 16px !important; /* AI å°è©±æ³¡æ³¡å­—é«”å¤§å° */
        line-height: 1.6 !important; /* è¡Œé«˜ */
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji" !important;
        text-align: left !important; /* AI å°è©±æ³¡æ³¡é å·¦å°é½Š */
        box-sizing: border-box !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
      }
      
      /* Mode3 AI é ­åƒæ¨£å¼ - èˆ‡ Mode2 ä¸€è‡´ */
      #mode3 .message.ai .message-avatar,
      #mode3-chatMessages .message.ai .message-avatar,
      #mode3-chat-messages .message.ai .message-avatar,
      #mode3 .message.assistant .message-avatar,
      #mode3-chatMessages .message.assistant .message-avatar,
      #mode3-chat-messages .message.assistant .message-avatar {
        width: 32px !important;
        height: 32px !important;
        border-radius: 50% !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        font-size: 16px !important;
        margin-right: 12px !important;
        flex-shrink: 0 !important;
        background: #10a37f !important;
        color: white !important;
      }
      
      /* Mode3 AI å°è©±æ³¡æ³¡æ®µè½æ¨£å¼ - èˆ‡ Mode2 å®Œå…¨ä¸€è‡´ï¼Œé™ä½è¡Œè· */
      #mode3 .message.ai .message-content,
      #mode3-chatMessages .message.ai .message-content,
      #mode3-chat-messages .message.ai .message-content,
      #mode3 .message.assistant .message-content,
      #mode3-chatMessages .message.assistant .message-content,
      #mode3-chat-messages .message.assistant .message-content {
        line-height: 1.5 !important; /* é™ä½æ•´é«”è¡Œè·ï¼Œèˆ‡ Mode2 ä¸€è‡´ */
      }
      
      #mode3 .message.ai .message-content p,
      #mode3-chatMessages .message.ai .message-content p,
      #mode3-chat-messages .message.ai .message-content p,
      #mode3 .message.assistant .message-content p,
      #mode3-chatMessages .message.assistant .message-content p,
      #mode3-chat-messages .message.assistant .message-content p {
        margin: 0 0 6px 0 !important; /* æ¸›å°‘æ®µè½é–“è· */
        line-height: 1.4 !important; /* é™ä½æ®µè½å…§è¡Œè· */
      }
      
      #mode3 .message.ai .message-content p:first-child,
      #mode3-chatMessages .message.ai .message-content p:first-child,
      #mode3-chat-messages .message.ai .message-content p:first-child,
      #mode3 .message.assistant .message-content p:first-child,
      #mode3-chatMessages .message.assistant .message-content p:first-child,
      #mode3-chat-messages .message.assistant .message-content p:first-child {
        margin-top: 0 !important;
      }
      
      #mode3 .message.ai .message-content p:last-child,
      #mode3-chatMessages .message.ai .message-content p:last-child,
      #mode3-chat-messages .message.ai .message-content p:last-child,
      #mode3 .message.assistant .message-content p:last-child,
      #mode3-chatMessages .message.assistant .message-content p:last-child,
      #mode3-chat-messages .message.assistant .message-content p:last-child {
        margin-bottom: 0 !important;
      }
      
      /* Mode3 AI å°è©±æ³¡æ³¡åˆ—è¡¨æ¨£å¼ - èˆ‡ Mode2 ä¸€è‡´ */
      #mode3 .message.ai .message-content ul,
      #mode3-chatMessages .message.ai .message-content ul,
      #mode3-chat-messages .message.ai .message-content ul,
      #mode3 .message.assistant .message-content ul,
      #mode3-chatMessages .message.assistant .message-content ul,
      #mode3-chat-messages .message.assistant .message-content ul {
        margin: 8px 0 !important;
        padding-left: 20px !important;
      }
      
      #mode3 .message.ai .message-content li,
      #mode3-chatMessages .message.ai .message-content li,
      #mode3-chat-messages .message.ai .message-content li,
      #mode3 .message.assistant .message-content li,
      #mode3-chatMessages .message.assistant .message-content li,
      #mode3-chat-messages .message.assistant .message-content li {
        margin: 4px 0 !important;
      }
      
      /* Mode3 AI å°è©±æ³¡æ³¡æœ€å¾Œä¸€å€‹æ®µè½æ¨£å¼ - èˆ‡ Mode2 ä¸€è‡´ */
      #mode3 .message.ai .message-content:last-child p:last-child,
      #mode3-chatMessages .message.ai .message-content:last-child p:last-child,
      #mode3-chat-messages .message.ai .message-content:last-child p:last-child,
      #mode3 .message.assistant .message-content:last-child p:last-child,
      #mode3-chatMessages .message.assistant .message-content:last-child p:last-child,
      #mode3-chat-messages .message.assistant .message-content:last-child p:last-child {
        margin-bottom: 0 !important;
      }
      
      /* ç¢ºä¿ mode3 çš„ typing-indicator æ­£ç¢ºé¡¯ç¤º */
      #mode3-chatMessages .typing-indicator,
      #mode3-chat-messages .typing-indicator {
        display: flex !important;
        align-items: center !important;
        font-style: italic !important;
        color: #6b7280 !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      
      #mode3-chatMessages .typing-dots,
      #mode3-chat-messages .typing-dots {
        display: flex !important;
        margin-left: 10px !important;
      }
      
      #mode3-chatMessages .typing-dot,
      #mode3-chat-messages .typing-dot {
        width: 6px !important;
        height: 6px !important;
        margin: 0 2px !important;
        background-color: #3b82f6 !important;
        border-radius: 50% !important;
        animation: dot-flashing 1s infinite alternate !important;
      }
      
      #mode3-chatMessages .typing-dot:nth-child(2),
      #mode3-chat-messages .typing-dot:nth-child(2) {
        animation-delay: 0.2s !important;
      }
      
      #mode3-chatMessages .typing-dot:nth-child(3),
      #mode3-chat-messages .typing-dot:nth-child(3) {
        animation-delay: 0.4s !important;
      }
      
      /* ä½¿ç”¨èªªæ˜æ­¥é©ŸæŒ‡å—æ¨£å¼ */
      .mode3-step-guide {
        margin: 16px 0;
      }
      
      .mode3-step {
        display: flex;
        align-items: flex-start;
        margin-bottom: 16px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        border-left: 4px solid #4f46e5;
      }
      
      .mode3-step-number {
        width: 32px;
        height: 32px;
        background: #4f46e5;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 14px;
        margin-right: 12px;
        flex-shrink: 0;
      }
      
      .mode3-step-content {
        flex: 1;
      }
      
      .mode3-step-content strong {
        color: #1f2937;
        font-size: 14px;
        display: block;
        margin-bottom: 4px;
      }
      
      .mode3-step-content p {
        color: #6b7280;
        font-size: 13px;
        margin: 0;
        line-height: 1.4;
      }
      
      /* ç”Ÿæˆå…§å®¹é¡å‹æ¨£å¼ */
      .mode3-result-types {
        margin: 12px 0;
      }
      
      .mode3-result-type {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 6px;
        padding: 10px 12px;
        margin-bottom: 8px;
        border-left: 3px solid #10b981;
      }
      
      .mode3-result-type strong {
        color: #1f2937;
        font-size: 13px;
        display: block;
        margin-bottom: 4px;
      }
      
      .mode3-result-type p {
        color: #6b7280;
        font-size: 12px;
        margin: 0;
        line-height: 1.3;
      }
      
      /* IPäººè¨­è¦åŠƒä½¿ç”¨èªªæ˜æŒ‰éˆ•å’ŒæŠ½å±œæ¨£å¼ */
      .mode3-instructions-btn-container {
        position: fixed;
        top: 75px;
        left: 20px; /* æ”¹åˆ°å·¦é‚Š */
        z-index: 1001;
      }
      
      .mode3-results-btn-container {
        position: fixed;
        top: 75px;
        left: 120px; /* æ”¹åˆ°å·¦é‚Š */
        z-index: 1001;
      }
      
      .mode3-results-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        background: #10b981;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
      }
      
      .mode3-results-btn:hover {
        background: #059669;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(16, 185, 129, 0.4);
      }
      
      .mode3-results-icon {
        font-size: 16px;
      }
      
      .mode3-results-text {
        font-size: 14px;
      }
      
      .mode3-instructions-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 16px;
        background: #4f46e5;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(79, 70, 229, 0.3);
      }
      
      .mode3-instructions-btn:hover {
        background: #4338ca;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(79, 70, 229, 0.4);
      }
      
      .mode3-instructions-icon {
        font-size: 16px;
      }
      
      .mode3-instructions-text {
        font-size: 14px;
      }
      
      /* æŠ½å±œæ¨£å¼ */
      .mode3-instructions-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9998;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .mode3-instructions-overlay.open {
        opacity: 1;
        visibility: visible;
      }
      
      .mode3-instructions-drawer {
        position: fixed;
        top: 0;
        right: -400px;
        width: 400px;
        height: 100%;
        background: white;
        z-index: 9999;
        transition: right 0.3s ease;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
      }
      
      .mode3-instructions-drawer.open {
        right: 0;
      }
      
      .mode3-instructions-drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
      }
      
      .mode3-instructions-drawer-header h3 {
        margin: 0;
        color: #1f2937;
        font-size: 18px;
        font-weight: 600;
      }
      
      .mode3-instructions-drawer-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #6b7280;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }
      
      .mode3-instructions-drawer-close:hover {
        background: #e5e7eb;
        color: #374151;
      }
      
      .mode3-instructions-drawer-content {
        padding: 20px;
        color: #374151;
        line-height: 1.6;
      }
      
      .mode3-instructions-drawer-content p {
        margin: 0 0 16px 0;
      }
      
      .mode3-instructions-drawer-content ul {
        margin: 0 0 16px 0;
        padding-left: 20px;
      }
      
      .mode3-instructions-drawer-content li {
        margin-bottom: 8px;
      }
      
      /* ç”ŸæˆçµæœæŠ½å±œæ¨£å¼ */
      .mode3-results-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9998;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .mode3-results-overlay.open {
        opacity: 1;
        visibility: visible;
      }
      
      .mode3-results-drawer {
        position: fixed;
        top: 0;
        right: -500px;
        width: 500px;
        height: 100%;
        background: white;
        z-index: 9999;
        transition: right 0.3s ease;
        box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
        overflow-y: auto;
      }
      
      .mode3-results-drawer.open {
        right: 0;
      }
      
      .mode3-results-drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
      }
      
      .mode3-results-drawer-header h3 {
        margin: 0;
        color: #1f2937;
        font-size: 18px;
        font-weight: 600;
      }
      
      .mode3-results-drawer-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #6b7280;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }
      
      .mode3-results-drawer-close:hover {
        background: #e5e7eb;
        color: #374151;
      }
      
      .mode3-results-drawer-content {
        padding: 20px;
        color: #374151;
        line-height: 1.6;
      }
      
      .mode3-results-drawer-content .mode3-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 1px solid #e5e7eb;
      }
      
      .mode3-results-drawer-content .mode3-tab {
        padding: 10px 16px;
        background: none;
        border: none;
        border-bottom: 2px solid transparent;
        cursor: pointer;
        font-size: 14px;
        color: #6b7280;
        transition: all 0.2s ease;
      }
      
      .mode3-results-drawer-content .mode3-tab.active {
        color: #4f46e5;
        border-bottom-color: #4f46e5;
      }
      
      .mode3-results-drawer-content .mode3-tab:hover {
        color: #4f46e5;
      }
      
      .mode3-results-drawer-content .mode3-result-block {
        display: none;
      }
      
      .mode3-results-drawer-content .mode3-result-block.active {
        display: block;
      }
      
      .mode3-results-drawer-content .mode3-result-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #e5e7eb;
      }
      
      .mode3-results-drawer-content .mode3-action-btn {
        flex: 1;
        padding: 10px 16px;
        background: #f3f4f6;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        color: #374151;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      
      .mode3-results-drawer-content .mode3-action-btn:hover {
        background: #e5e7eb;
        transform: translateY(-1px);
      }
      
      /* æ‰‹æ©Ÿç‰ˆé©é… */
      @media (max-width: 768px) {
        .mode3-instructions-drawer,
        .mode3-results-drawer {
          width: 100%;
          right: -100%;
        }
        
        .mode3-instructions-btn-container {
          top: 65px;
          left: 15px; /* æ”¹åˆ°å·¦é‚Š */
          right: auto; /* å–æ¶ˆå³é‚Šå®šä½ */
        }
        
        .mode3-results-btn-container {
          top: 65px;
          left: 80px; /* æ”¹åˆ°å·¦é‚Š */
          right: auto; /* å–æ¶ˆå³é‚Šå®šä½ */
        }
        
        .mode3-instructions-btn,
        .mode3-results-btn {
          padding: 10px 12px;
          font-size: 13px;
        }
        
        .mode3-instructions-text,
        .mode3-results-text {
          display: none;
        }
        
        .mode3-fixed {
          min-height: calc(100vh - 50px);
        }
        
        .mode3-page {
          padding: 0 10px;
        }
        
        .mode3-chat-container {
          padding: 70px 10px 0 10px;
        }
        
        .mode3-input-container {
          padding: 12px 15px 15px 15px;
          margin-bottom: 0;
        }
        
        .mode3-quick-buttons {
          gap: 4px;
          margin-bottom: 6px;
        }
        
        .mode3-quick-btn {
          padding: 5px 10px;
          font-size: 12px;
          flex: 1;
          min-width: 0;
        }
        
        .mode3-message-input {
          padding: 6px 12px;
          min-height: 32px;
          max-height: 70px;
        }
      }

      .mode3-container {
        display: flex;
        height: calc(100vh - 60px);
        gap: 0;
      }

      .mode3-left-panel {
        flex: 1;
        background: white;
        border-right: 1px solid #e5e7eb;
        display: flex;
        flex-direction: column;
        min-width: 0;
        overflow: hidden;
      }

      .mode3-right-panel {
        flex: 1;
        background: white;
        display: flex;
        flex-direction: column;
        min-width: 0;
        overflow: hidden;
      }

      /* èªªæ˜æ¬„ä½ */
      .mode3-instructions {
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
      }

      .mode3-instructions-header {
        padding: 12px 16px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #f1f5f9;
        border-bottom: 1px solid #e5e7eb;
        transition: background-color 0.2s;
      }

      .mode3-instructions-header:hover {
        background: #e2e8f0;
      }

      .mode3-instructions-title {
        font-weight: 600;
        color: #374151;
        font-size: 14px;
      }

      .mode3-instructions-toggle {
        font-size: 12px;
        color: #6b7280;
        transition: transform 0.2s;
      }

      .mode3-instructions.collapsed .mode3-instructions-toggle {
        transform: rotate(-90deg);
      }

      .mode3-instructions-content {
        padding: 16px;
        font-size: 13px;
        line-height: 1.6;
        color: #4b5563;
        max-height: 300px;
        overflow-y: auto;
        transition: max-height 0.3s ease;
      }

      .mode3-instructions.collapsed .mode3-instructions-content {
        max-height: 0;
        padding: 0 16px;
        overflow: hidden;
      }

      .mode3-instructions-content p {
        margin: 0 0 12px 0;
      }

      .mode3-instructions-content ul {
        margin: 8px 0;
        padding-left: 20px;
      }

      .mode3-instructions-content li {
        margin: 4px 0;
      }

      /* èŠå¤©å®¹å™¨ */
      .mode3-chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .mode3-chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 16px;
        min-height: 200px;
        transition: min-height 0.3s ease;
      }

      .mode3-chat-messages.expanded {
        min-height: 400px;
      }

      .mode3-message {
        display: flex;
        margin-bottom: 16px;
        align-items: flex-start;
      }

      .mode3-message-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        margin-right: 12px;
        flex-shrink: 0;
      }

      .mode3-user-message .mode3-message-avatar {
        background: #3b82f6;
        color: white;
      }

      .mode3-assistant-message .mode3-message-avatar {
        background: #f3f4f6;
        color: #374151;
      }

      .mode3-message-content {
        flex: 1;
        background: #f8fafc;
        padding: 12px 16px;
        border-radius: 12px;
        border: 1px solid #e5e7eb;
        color: #1f2937;
        transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
      }

      .mode3-user-message .mode3-message-content {
        background: #dbeafe;
        border-color: #3b82f6;
        color: #1e40af;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šMode3 æ¶ˆæ¯å…§å®¹ - AI æ¶ˆæ¯æ”¹ç‚ºç´”ç™½è‰² */
      .theme-dark .mode3-message-content {
        background: var(--gradient-card) !important;
        color: #ffffff !important; /* æ”¹ç‚ºç´”ç™½è‰² */
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .mode3-user-message .mode3-message-content {
        background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%) !important;
        color: #dbeafe !important;
        border-color: rgba(59, 130, 246, 0.3) !important;
      }
      
      /* è¦†è“‹å…§è¯æ¨£å¼ */
      .theme-dark .mode3-message-content[style*="background: #f8fafc"],
      .theme-dark .mode3-message-content[style*="background:#f8fafc"],
      .theme-dark .mode3-message-content[style*="background: white"],
      .theme-dark .mode3-message-content[style*="background:white"] {
        background: var(--gradient-card) !important;
        color: #ffffff !important; /* æ”¹ç‚ºç´”ç™½è‰² */
      }
      
      .theme-dark .mode3-user-message .mode3-message-content[style*="background: #dbeafe"],
      .theme-dark .mode3-user-message .mode3-message-content[style*="background:#dbeafe"] {
        background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%) !important;
        color: #dbeafe !important;
      }
      
      /* è¦†è“‹ Mode3 å…§è¯æ¨£å¼ä¸­çš„æ·±è‰²æ–‡å­— - å¼·åˆ¶æ”¹ç‚ºç™½è‰² */
      .theme-dark .mode3-message-content[style*="color: #1f2937"],
      .theme-dark .mode3-message-content[style*="color:#1f2937"],
      .theme-dark .mode3-message-content[style*="color: #374151"],
      .theme-dark .mode3-message-content[style*="color:#374151"] {
        color: #ffffff !important; /* å¼·åˆ¶æ”¹ç‚ºç´”ç™½è‰² */
      }
      
      .theme-dark .mode3-user-message .mode3-message-content[style*="color: #1e40af"],
      .theme-dark .mode3-user-message .mode3-message-content[style*="color:#1e40af"] {
        color: #dbeafe !important;
      }
      
      /* Mode3 AI æ¶ˆæ¯å…§çš„æ‰€æœ‰æ–‡å­—å…ƒç´  - å¼·åˆ¶æ”¹ç‚ºç™½è‰² */
      .theme-dark .mode3-message-content p,
      .theme-dark .mode3-message-content li,
      .theme-dark .mode3-message-content span,
      .theme-dark .mode3-message-content div,
      .theme-dark .mode3-message-content h1,
      .theme-dark .mode3-message-content h2,
      .theme-dark .mode3-message-content h3,
      .theme-dark .mode3-message-content h4,
      .theme-dark .mode3-message-content h5,
      .theme-dark .mode3-message-content h6,
      .theme-dark .mode3-message-content strong,
      .theme-dark .mode3-message-content em,
      .theme-dark .mode3-message-content code,
      .theme-dark .mode3-message-content pre {
        color: #ffffff !important; /* å¼·åˆ¶æ”¹ç‚ºç´”ç™½è‰² */
      }
      
      .theme-dark .mode3-user-message .mode3-message-content p,
      .theme-dark .mode3-user-message .mode3-message-content li,
      .theme-dark .mode3-user-message .mode3-message-content span,
      .theme-dark .mode3-user-message .mode3-message-content div {
        color: #dbeafe !important;
      }

      .mode3-message-content p {
        margin: 0 0 8px 0;
        line-height: 1.5;
      }

      .mode3-message-content ul {
        margin: 8px 0;
        padding-left: 20px;
      }

      .mode3-message-content li {
        margin: 4px 0;
      }

      .mode3-message-content:last-child p:last-child {
        margin-bottom: 0;
      }

      /* å¿«é€ŸæŒ‰éˆ• */
      .mode3-quick-buttons {
        padding: 12px 16px;
        border-top: 1px solid #e5e7eb;
        background: #f8fafc;
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šMode3 å¿«é€ŸæŒ‰éˆ•å®¹å™¨ */
      .theme-dark .mode3-quick-buttons {
        background: var(--bg-secondary) !important;
        border-top-color: var(--border-color) !important;
      }
      
      .theme-dark .mode3-quick-buttons[style*="background: #f8fafc"],
      .theme-dark .mode3-quick-buttons[style*="background:#f8fafc"] {
        background: var(--bg-secondary) !important;
      }

      .mode3-quick-btn {
        background: white;
        border: 1px solid #d1d5db;
        color: #374151;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šMode3 å¿«é€ŸæŒ‰éˆ• - èˆ‡ Mode2 ä¸€è‡´ï¼Œæ–‡å­—æ”¹ç‚ºç´”ç™½è‰² */
      .theme-dark .mode3-quick-btn {
        background: var(--card-bg) !important;
        color: #ffffff !important; /* æ”¹ç‚ºç´”ç™½è‰² */
        border-color: var(--border-color) !important;
      }
      
      .theme-dark .mode3-quick-btn[style*="background: white"],
      .theme-dark .mode3-quick-btn[style*="background:white"],
      .theme-dark .mode3-quick-btn[style*="background: #ffffff"],
      .theme-dark .mode3-quick-btn[style*="background:#ffffff"] {
        background: var(--card-bg) !important;
        color: #ffffff !important; /* æ”¹ç‚ºç´”ç™½è‰² */
      }
      
      .theme-dark .mode3-quick-btn[style*="color: #374151"],
      .theme-dark .mode3-quick-btn[style*="color:#374151"],
      .theme-dark .mode3-quick-btn[style*="color: #1f2937"],
      .theme-dark .mode3-quick-btn[style*="color:#1f2937"] {
        color: #ffffff !important; /* å¼·åˆ¶æ”¹ç‚ºç´”ç™½è‰² */
      }

      .mode3-quick-btn:hover {
        background: #3b82f6;
        border-color: #3b82f6;
        color: white;
      }
      
      .theme-dark .mode3-quick-btn:hover {
        background: var(--accent-blue) !important;
        border-color: var(--accent-blue) !important;
        color: white !important;
      }

      /* è¼¸å…¥å€åŸŸ */
      .mode3-input-container {
        padding: 16px;
        border-top: 1px solid #e5e7eb;
        background: white;
      }

      .mode3-input-wrapper {
        display: flex;
        gap: 8px;
        align-items: flex-end;
      }

      .mode3-message-input {
        flex: 1;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        padding: 12px;
        font-size: 14px;
        resize: vertical;
        min-height: 44px;
        max-height: 120px;
        font-family: inherit;
      }

      .mode3-message-input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .mode3-send-btn {
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: background-color 0.2s;
        flex-shrink: 0;
      }

      .mode3-send-btn:hover {
        background: #2563eb;
      }

      .mode3-send-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
      }

      .mode3-send-icon {
        font-size: 16px;
      }

      /* çµæœé¢æ¿ */
      .mode3-results-header {
        padding: 16px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .mode3-results-header h3 {
        margin: 0;
        font-size: 16px;
        color: #374151;
      }

      .mode3-result-actions {
        display: flex;
        gap: 8px;
      }

      .mode3-action-btn {
        background: white;
        border: 1px solid #d1d5db;
        color: #6b7280;
        width: 32px;
        height: 32px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 14px;
      }

      .mode3-action-btn:hover {
        background: #f3f4f6;
        border-color: #9ca3af;
        color: #374151;
      }

      /* æ¨™ç±¤ */
      .mode3-tabs {
        display: flex;
        border-bottom: 1px solid #e5e7eb;
        background: white;
      }

      .mode3-tab {
        flex: 1;
        background: none;
        border: none;
        padding: 12px 16px;
        cursor: pointer;
        font-size: 13px;
        color: #6b7280;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
      }

      .mode3-tab:hover {
        background: #f8fafc;
        color: #374151;
      }

      .mode3-tab.active {
        color: #3b82f6;
        border-bottom-color: #3b82f6;
        background: #f8fafc;
      }

      /* çµæœå…§å®¹ */
      .mode3-results-content {
        flex: 1;
        overflow-y: auto;
        background: white;
      }

      .mode3-result-block {
        display: none;
        padding: 16px;
        height: 100%;
      }

      .mode3-result-block.active {
        display: block;
      }
      .mode3-result-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        text-align: center;
        color: #6b7280;
      }

      .mode3-placeholder-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .mode3-placeholder-icon h4 {
        margin: 0 0 8px 0;
        color: #374151;
        font-size: 18px;
      }

      .mode3-placeholder-icon p {
        margin: 0 0 24px 0;
        font-size: 14px;
        line-height: 1.5;
      }

      .mode3-generate-btn {
        background: #3b82f6;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .mode3-generate-btn:hover {
        background: #2563eb;
      }

      .mode3-generate-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
      }

      /* çµæœå…§å®¹æ¨£å¼ */
      .mode3-result-content {
        line-height: 1.6;
        color: #374151;
      }

      .mode3-result-content h1,
      .mode3-result-content h2,
      .mode3-result-content h3,
      .mode3-result-content h4 {
        color: #1f2937;
        margin: 16px 0 8px 0;
      }

      .mode3-result-content h1:first-child,
      .mode3-result-content h2:first-child,
      .mode3-result-content h3:first-child,
      .mode3-result-content h4:first-child {
        margin-top: 0;
      }

      .mode3-result-content p {
        margin: 8px 0;
      }

      .mode3-result-content ul,
      .mode3-result-content ol {
        margin: 8px 0;
        padding-left: 20px;
      }

      .mode3-result-content li {
        margin: 4px 0;
      }

      .mode3-result-content strong {
        color: #1f2937;
        font-weight: 600;
      }

      .mode3-result-content em {
        color: #6b7280;
        font-style: italic;
      }

      /* è¼‰å…¥å‹•ç•« */
      .mode3-loading {
        display: flex;
        align-items: center;
        gap: 8px;
        color: #6b7280;
        font-size: 14px;
      }

      .mode3-loading-dots {
        display: flex;
        gap: 4px;
      }

      .mode3-loading-dot {
        width: 6px;
        height: 6px;
        background: #3b82f6;
        border-radius: 50%;
        animation: mode3-bounce 1.4s infinite ease-in-out both;
      }

      .mode3-loading-dot:nth-child(1) { animation-delay: -0.32s; }
      .mode3-loading-dot:nth-child(2) { animation-delay: -0.16s; }

      @keyframes mode3-bounce {
        0%, 80%, 100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }

      /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
      @media (max-width: 768px) {
        .mode3-container {
          flex-direction: column;
          height: auto;
          padding-top: 70px;
        }

        .mode3-left-panel,
        .mode3-right-panel {
          min-height: 50vh;
        }

        .mode3-tabs {
          flex-wrap: wrap;
        }

        .mode3-tab {
          flex: none;
          min-width: 120px;
        }
      }
      
      /* æ¡Œé¢ç‰ˆæ¨£å¼ */
      @media (min-width: 769px) {
        .desktop-only {
          display: block !important;
        }
      }
      
      /* æ‰‹æ©Ÿç‰ˆæŠ½å±œå°èˆªæ¨£å¼ */
      .mobile-drawer-toggle {
        display: none;
        background: none;
        border: none;
        font-size: 20px;
        color: #374151;
        cursor: pointer;
        padding: 8px;
        margin-right: 12px;
        border-radius: 4px;
        transition: background-color 0.2s;
      }

      .mobile-drawer-toggle:hover {
        background-color: #f3f4f6;
      }

      .mobile-drawer-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
        display: none;
      }

      .mobile-drawer {
        position: fixed;
        top: 0;
        left: -300px;
        width: 280px;
        height: 100%;
        background: white;
        z-index: 1000;
        transition: left 0.3s ease;
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      }

      .mobile-drawer.open {
        left: 0;
      }

      .mobile-drawer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid #e5e7eb;
        background: #f8fafc;
      }

      .mobile-drawer-header h3 {
        margin: 0;
        font-size: 18px;
        font-weight: 600;
        color: #1f2937;
      }

      .mobile-drawer-close {
        background: none;
        border: none;
        font-size: 20px;
        color: #6b7280;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: background-color 0.2s;
      }

      .mobile-drawer-close:hover {
        background-color: #e5e7eb;
      }

      .mobile-drawer-content {
        padding: 20px 0;
      }

      .mobile-drawer-item {
        display: flex;
        align-items: center;
        padding: 16px 20px;
        color: #374151;
        text-decoration: none;
        transition: background-color 0.2s;
        border-left: 3px solid transparent;
      }

      .mobile-drawer-item:hover {
        background-color: #f8fafc;
        color: #1f2937;
      }

      .mobile-drawer-item.active {
        background-color: #eff6ff;
        color: #3b82f6;
        border-left-color: #3b82f6;
      }

      .mobile-drawer-icon {
        font-size: 20px;
        margin-right: 12px;
        width: 24px;
        text-align: center;
      }

      .mobile-drawer-text {
        font-size: 16px;
        font-weight: 500;
      }

      /* ChatGPT é¢¨æ ¼éŸ¿æ‡‰å¼è¨­è¨ˆ */
      @media (max-width: 768px) {
        /* æ‰‹æ©Ÿç‰ˆæŠ½å±œæŒ‰éˆ•é¡¯ç¤º */
        .mobile-drawer-toggle {
          display: block !important;
        }

        /* éš±è—æ¡Œé¢ç‰ˆå°èˆªæ¨™ç±¤ */
        .navbar-tabs {
          display: none !important;
        }

        /* éš±è—åº•éƒ¨å°è¦½åˆ— */
        .bottom-navbar {
          display: none !important;
        }

        .chat-container {
          max-width: 100% !important;
          margin: 0 !important;
          padding: 0 !important;
        }
        
        .message {
          padding: 15px 0 !important;
          margin-bottom: 0 !important;
        }
        
        .message-avatar {
          width: 28px !important;
          height: 28px !important;
          min-width: 28px !important;
          font-size: 14px !important;
          margin-right: 12px !important;
        }
        
        .message-content {
          max-width: calc(100% - 40px) !important;
          word-wrap: break-word !important;
          overflow-wrap: break-word !important;
        }
        
        .input-row {
          padding: 20px !important;
          background: #f7f7f8 !important;
          border: none !important;
          box-shadow: none !important;
          display: flex !important;
          flex-direction: column !important;
          gap: 6px !important;
          z-index: auto !important;
        }
        
        .input-container {
          background: white !important;
          border: 1px solid #e5e7eb !important;
          border-radius: 12px !important;
          padding: 8px 12px !important;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
        }
        
        .input-container textarea {
          font-size: 16px !important; /* é˜²æ­¢iOSç¸®æ”¾ */
          padding: 8px 0 !important;
          min-height: 24px !important;
          max-height: 120px !important;
          line-height: 1.5 !important;
          resize: none !important;
        }
        
        .input-container button {
          background: #3b82f6 !important;
          color: white !important;
          border: none !important;
          border-radius: 8px !important;
          padding: 8px 12px !important;
          font-size: 16px !important;
          min-width: 40px !important;
          height: 40px !important;
        }
        
        .quick-buttons {
          gap: 6px !important;
          padding: 20px !important;
          background: #f7f7f8 !important;
          border: none !important;
          z-index: auto !important;
          display: flex !important;
          flex-wrap: wrap !important;
          justify-content: center !important;
        }
        
        .quick-btn {
          padding: 8px 16px !important;
          font-size: 14px !important;
          border-radius: 12px !important;
          background: white !important;
          border: 1px solid #d1d5db !important;
          white-space: nowrap !important;
          min-width: fit-content !important;
          flex-shrink: 0 !important;
        }
        
        
        /* æ‰‹æ©Ÿç‰ˆèŠå¤©å®¹å™¨èª¿æ•´ */
        .chat-container {
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          right: 0 !important;
          bottom: 0 !important;
          max-width: 100% !important;
          margin: 0 !important;
          display: flex !important;
          flex-direction: column !important;
        }
        
        .chat-messages {
          flex: 1 !important;
          padding: 0 !important;
          padding-top: 80px !important; /* æ·»åŠ é ‚éƒ¨é–“è·é¿å…è¢«é é¦–é®ä½ */
          padding-bottom: 0 !important; /* ç§»é™¤åº•éƒ¨paddingï¼Œè®“è¨Šæ¯ç·Šè²¼è¼¸å…¥å€åŸŸ */
          overflow-y: auto !important;
          min-height: 0 !important;
          max-width: none !important;
          width: 100% !important;
        }
        
        /* æ‰‹æ©Ÿç‰ˆå¿«é€ŸæŒ‰éˆ•ç¨ç«‹é¡¯ç¤º - å·²åœ¨ä¸Šæ–¹å®šç¾© */
        
        .input-row {
          padding: 15px !important;
          margin-top: 0 !important;
          background: white !important;
          border: none !important;
          box-shadow: none !important;
          display: flex !important;
          flex-direction: column !important;
          gap: 6px !important;
          z-index: auto !important;
        }
        
        .message {
          padding: 15px 0 !important;
        }
        
        .message-content {
          padding: 15px 20px !important;
          max-width: none !important;
          width: 100% !important;
        }
        
        .message-avatar {
          width: 28px !important;
          height: 28px !important;
          min-width: 28px !important;
          font-size: 14px !important;
          margin-right: 12px !important;
        }
        
        .quick-btn {
          padding: 6px 12px !important;
          font-size: 13px !important;
        }
        
        
        .input-container {
          padding: 6px 10px !important;
          border-radius: 10px !important;
        }
        
        .chat-input {
          font-size: 16px !important; /* é˜²æ­¢iOSç¸®æ”¾ */
          padding: 6px 0 !important;
        }
        
        .send-btn {
          font-size: 16px !important;
          padding: 6px !important;
        }
      }
      
      @media (min-width: 769px) and (max-width: 1024px) {
        .chat-container {
          max-width: 700px;
        }
      }
      
      @media (min-width: 1025px) {
        .chat-container {
          max-width: 800px;
        }
      }

      /* æ¡Œé¢ç‰ˆæ¨£å¼ - éš±è—æ‰‹æ©Ÿç‰ˆæŠ½å±œ */
      @media (min-width: 769px) {
        .mobile-drawer-toggle {
          display: none !important;
        }
        
        .mobile-drawer {
          display: none !important;
        }
        
        .mobile-drawer-overlay {
          display: none !important;
        }
        
        .bottom-navbar {
          display: none !important;
        }
      }
      
      /* éŸ¿æ‡‰å¼è¨­è¨ˆ - æ‰‹æ©Ÿç‰ˆ */
      @media (max-width: 768px) {
        /* é ‚éƒ¨å°èˆªæ¬„æ‰‹æ©Ÿç‰ˆ */
        .top-navbar {
          padding: 12px 16px;
          padding-top: calc(12px + var(--safe-area-inset-top));
          flex-wrap: wrap;
          gap: 12px;
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1000;
        }
        
        .navbar-left {
          gap: 16px;
          flex: 1;
          min-width: 0;
        }
        
        .navbar-title {
          font-size: 25px;
          white-space: nowrap;
          overflow: hidden;
          text-overflow: ellipsis;
        }
        
        .navbar-tabs {
          display: none; /* æ‰‹æ©Ÿç‰ˆéš±è—æ¨™ç±¤ï¼Œæ”¹ç”¨åº•éƒ¨å°èˆª */
        }
        
        /* ä¸»å…§å®¹å€åŸŸç‚ºå›ºå®šé é¦–ç•™å‡ºç©ºé–“ */
        .main-content {
          padding-top: 80px;
          padding-bottom: 80px;
          height: calc(100vh - 80px - 80px);
          overflow: hidden;
        }
        
        /* é¦–é å…§å®¹å€åŸŸç¨ç«‹æ»¾å‹• */
        #homepage {
          height: 100%;
          overflow-y: auto;
          overflow-x: hidden !important; /* é˜²æ­¢é¦–é å·¦å³æ»‘å‹• */
          -webkit-overflow-scrolling: touch;
          padding: 20px 16px;
          width: 100%;
          max-width: 100vw;
          box-sizing: border-box;
        }
        
        /* é¦–é å¡ç‰‡å®¹å™¨èª¿æ•´ */
        #homepage .mode-cards {
          padding-top: 20px;
          padding-bottom: 20px;
        }
        
        /* é¦–é æ¨™é¡Œå€åŸŸèª¿æ•´ */
        #homepage .homepage-title {
          margin-top: 40px;
          margin-bottom: 16px;
        }
        
        #homepage .homepage-subtitle {
          margin-bottom: 20px;
        }
        
        .navbar-right {
          gap: 8px;
        }
        
        .user-info {
          padding: 6px 12px;
          font-size: 14px;
        }
        
        .user-avatar {
          width: 28px !important;
          height: 28px !important;
          object-fit: cover !important;
          object-position: center !important;
        }
        
        .user-name {
          font-size: 14px;
        }
        
        .login-btn, .logout-btn {
          padding: 8px 16px;
          font-size: 14px;
        }
        
        /* ä¸»å…§å®¹å€åŸŸæ‰‹æ©Ÿç‰ˆ - æ»¿ç‰ˆè¨­è¨ˆ */
        .main-content {
          width: 100% !important;
          margin: 0 !important;
          padding: 0 !important;
          height: auto !important;
          min-height: calc(100vh - 60px) !important;
          min-height: calc(100dvh - 60px) !important;
          overflow: visible !important;
        }
        
        .main-content.sidebar-open {
          margin-right: 0 !important;
        }
        
        /* é¦–é æ‰‹æ©Ÿç‰ˆ - æ»¿ç‰ˆè¨­è¨ˆ */
        .homepage {
          width: 100% !important;
          max-width: 100vw !important;
          height: auto !important;
          min-height: calc(100vh - 60px) !important;
          min-height: calc(100dvh - 60px) !important;
          margin: 0 !important;
          padding: 20px 0 !important;
          overflow-x: hidden !important; /* é˜²æ­¢æ°´å¹³æ»¾å‹• */
          overflow-y: auto !important; /* å…è¨±å‚ç›´æ»¾å‹• */
          display: flex !important;
          flex-direction: column !important;
          box-sizing: border-box !important;
        }
        
        .homepage-title {
          font-size: 24px !important;
          margin-bottom: 16px !important;
          text-align: center !important;
          padding: 0 20px !important;
          line-height: 1.2 !important;
          color: #1f2937 !important;
          font-weight: 700 !important;
          white-space: normal !important;
          word-wrap: break-word !important;
        }
        
        /* æ‰‹æ©Ÿç‰ˆæ¨™é¡Œæ›è¡Œæ•ˆæœ */
        .homepage-title .mobile-break {
          display: block;
          margin-top: 4px;
        }
        
        .homepage-subtitle {
          font-size: 16px !important;
          margin-bottom: 24px !important;
          text-align: center !important;
          padding: 0 20px !important;
          line-height: 1.5 !important;
          color: #6b7280 !important;
          font-weight: 400 !important;
          white-space: normal !important;
          word-wrap: break-word !important;
        }
        
        .mode-cards {
          display: flex !important;
          flex-direction: column !important;
          gap: 8px !important;
          padding: 0 16px !important;
          width: 100% !important;
          max-width: 100% !important;
          height: auto !important;
          overflow: hidden !important;
          flex: none !important;
          margin: 0 0 20px 0 !important;
          box-sizing: border-box !important;
        }
        
        .mode-card {
          width: 100% !important;
          max-width: 90% !important;
          height: auto !important;
          min-height: 100% !important;
          margin: 0 !important;
          padding: 16px 12px !important;
          border-radius: 12px !important;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
          background: white !important;
          border: 1px solid #e5e7eb !important;
          display: flex !important;
          flex-direction: column !important;
          justify-content: center !important;
          align-items: center !important;
          text-align: center !important;
          overflow: visible !important;
          cursor: pointer !important;
          position: relative !important;
          z-index: 1 !important;
          user-select: none !important;
          transition: all 0.2s ease !important;
        }
        
        .mode-card h3 {
          font-size: 14px !important;
          margin-bottom: 3px !important;
          font-weight: 600 !important;
          line-height: 1.1 !important;
          color: #1f2937 !important;
          text-align: center !important;
          width: 100% !important;
          white-space: normal !important;
          word-wrap: break-word !important;
        }
        
        .mode-card p {
          font-size: 11px !important;
          line-height: 1.2 !important;
          color: #374151 !important;
          text-align: center !important;
          width: 100% !important;
          white-space: normal !important;
          word-wrap: break-word !important;
          display: block !important;
          margin-bottom: 0 !important;
        }
        
        /* ç¢ºä¿æ¨¡å¼å¡ç‰‡æè¿°æ–‡å­—é¡¯ç¤º */
        .mode-card-desc {
          font-size: 11px !important;
          line-height: 1.2 !important;
          color: #374151 !important;
          text-align: center !important;
          width: 100% !important;
          white-space: normal !important;
          word-wrap: break-word !important;
          display: block !important;
          margin-bottom: 0 !important;
        }
        
        /* æ‰€æœ‰æ¨¡å¼å¡ç‰‡æ¨™é¡Œå­—é«”çµ±ä¸€èª¿æ•´ */
        .mode-card:nth-child(1) .mode-card-title {
          font-size: 20px !important;
          font-weight: 700 !important;
        }
        .mode-card:nth-child(2) .mode-card-title {
          font-size: 20px !important;
          font-weight: 700 !important;
        }
        .mode-card:nth-child(3) .mode-card-title {
          font-size: 20px !important;
          font-weight: 700 !important;
        }
        
        /* æ‰‹æ©Ÿç‰ˆæ¨¡å¼å¡ç‰‡æ‡¸åœæ•ˆæœ - æ›´éˆæ•çš„è¨­è¨ˆ */
        .mode-card {
          transition: all 0.1s ease !important;
        }
        .mode-card:active {
          transform: scale(0.95) !important;
          box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3) !important;
          border-color: #3b82f6 !important;
          background: #f0f9ff !important;
        }
        .mode-card:hover {
          transform: scale(1.02) !important;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2) !important;
          border-color: #3b82f6 !important;
        }
        
        /* ä¸€éµç”Ÿæˆæ‰‹æ©Ÿç‰ˆ */
        .mode1-page {
          flex-direction: column;
          gap: 20px;
          padding: 0 8px;
          max-width: 100%;
          overflow-x: hidden;
        }
        
        .mode1-left {
          width: 100%;
          max-width: 100%;
          padding: 16px;
          box-sizing: border-box;
        }
        
        .mode1-right {
          width: 100%;
          max-width: 100%;
          padding: 16px;
          box-sizing: border-box;
        }
        
        
        
        .results-section {
          width: 100%;
          max-width: 100%;
          overflow-x: hidden;
        }
        
        /* çµæœå€å¡Šæ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        .results-container {
          max-width: 100%;
          overflow-x: hidden;
        }
        
        .result-content {
          max-width: 100%;
          overflow-x: hidden;
          word-wrap: break-word;
        }
        
        .result-body {
          max-width: 100%;
          overflow-x: hidden;
          word-wrap: break-word;
        }
        
        
        .form-group {
          margin-bottom: 16px;
        }
        
        .form-group label {
          font-size: 14px;
          margin-bottom: 8px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
          padding: 10px;
          font-size: 16px; /* é˜²æ­¢iOSç¸®æ”¾ */
          width: 100%;
          max-width: 100%;
          box-sizing: border-box;
        }
        
        .generate-btn {
          padding: 10px 20px;
          font-size: 16px;
          width: 100%;
          max-width: 100%;
          box-sizing: border-box;
        }
        
        .result-content {
          padding: 12px;
          max-width: 100%;
          overflow-x: hidden;
          word-wrap: break-word;
        }
        
        .result-header h3 {
          font-size: 18px;
          max-width: 100%;
          overflow-x: hidden;
          word-wrap: break-word;
        }
        
        .result-body {
          font-size: 14px;
          line-height: 1.6;
          max-width: 100%;
          overflow-x: hidden;
          word-wrap: break-word;
        }
        
        .result-actions {
          flex-direction: column;
          gap: 8px;
          max-width: 100%;
        }
        
        .save-btn, .regenerate-btn {
          padding: 10px 16px;
          font-size: 14px;
          width: 100%;
          max-width: 100%;
          box-sizing: border-box;
        }
        
        /* AIé¡§å•æ‰‹æ©Ÿç‰ˆ */
        .mode2-container {
          padding: 16px;
          padding-top: 50px;
        }
        
        /* æ‰‹æ©Ÿç‰ˆèªªæ˜æŒ‰éˆ• */
        .instructions-toggle-btn {
          top: 80px;
          right: 16px;
          padding: 6px 12px;
          font-size: 13px;
        }
        
        .btn-text {
          font-size: 12px;
        }
        
        /* æ‰‹æ©Ÿç‰ˆæŠ½å±œèƒŒæ™¯é®ç½© */
        .drawer-overlay {
          z-index: 999;
        }
        
        /* æ‰‹æ©Ÿç‰ˆèªªæ˜æŠ½å±œ */
        .instructions-drawer {
          width: 100%;
          right: -100%;
          top: 70px;
          height: calc(100vh - 70px);
        }
        
        .drawer-header {
          padding: 16px;
        }
        
        .drawer-header h3 {
          font-size: 16px;
        }
        
        .drawer-content {
          padding: 16px;
        }
        
        .drawer-content p {
          font-size: 13px;
          margin-bottom: 12px;
        }
        
        .ai-instructions {
          margin-bottom: 20px;
        }
        
        .instructions-header {
          padding: 16px;
        }
        
        .instructions-header h3 {
          font-size: 16px;
        }
        
        .instruction-list {
          padding: 16px;
        }
        
        .instruction-list li {
          font-size: 14px;
          margin-bottom: 8px;
        }
        
        .chat-container {
          height: calc(100vh - 80px - 80px);
          min-height: 500px;
          display: flex !important;
          flex-direction: column !important;
          overflow: hidden !important;
          margin-bottom: 0;
          margin-top: 10px !important;
          position: fixed !important;
          top: 80px !important;
          left: 0 !important;
          right: 0 !important;
          z-index: 100 !important;
        }
        
        #chatContainer {
          display: flex !important;
          flex-direction: column !important;
          flex: 1 !important;
          height: 100% !important;
          overflow: visible !important;
        }
        
        .chat-messages {
          padding: 16px;
          flex: 1;
          overflow-y: auto;
          height: calc(100vh - 160px); /* ç°¡åŒ–é«˜åº¦è¨ˆç®— */
          min-height: 400px;
          max-height: calc(100vh - 160px);
          -webkit-overflow-scrolling: touch;
          scroll-behavior: smooth;
          overscroll-behavior: contain;
        }
        
        .message {
          margin-bottom: 16px;
          max-width: 85%;
        }
        
        .message.user {
          margin-left: auto;
        }
        
        .message-content {
          padding: 12px 16px;
          font-size: 14px;
          line-height: 1.5;
        }
        
        .chat-input-container {
          padding: 16px;
          flex-direction: column;
          gap: 12px;
        }
        
        .chat-input {
          width: 100%;
          padding: 12px 16px;
          font-size: 16px;
          border-radius: 25px;
        }
        
        .send-btn {
          padding: 12px 24px;
          font-size: 16px;
          border-radius: 25px;
          width: 100%;
        }
        
        /* AIé¡§å•æ¨¡å¼çš„è¼¸å…¥å€åŸŸæ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        .input-row {
          padding: 16px !important;
          flex-direction: column !important;
          gap: 12px !important;
          display: flex !important;
          border-top: 1px solid #e5e7eb !important;
          background: #f7f7f8 !important;
          border-radius: 0 !important;
          flex-shrink: 0 !important;
          position: sticky !important;
          bottom: 0 !important;
          z-index: 100 !important;
          visibility: visible !important;
          opacity: 1 !important;
          height: auto !important;
          min-height: auto !important;
          margin: 0 !important;
        }
        
        .input-row textarea {
          width: 100% !important;
          padding: 12px 16px !important;
          font-size: 16px !important;
          border-radius: 25px !important;
          resize: none !important;
          border: 1px solid #d1d5db !important;
          height: 44px !important; /* å›ºå®šé«˜åº¦èˆ‡é€å‡ºæŒ‰éˆ•ä¸€è‡´ */
          min-height: 44px !important;
          max-height: 44px !important; /* é™åˆ¶æœ€å¤§é«˜åº¦èˆ‡æœ€å°é«˜åº¦ä¸€è‡´ */
          line-height: 1.2 !important; /* èª¿æ•´è¡Œé«˜ç¢ºä¿æ–‡å­—å‚ç›´å±…ä¸­ */
        }
        
        .input-row .send-btn {
          padding: 12px 24px !important;
          font-size: 16px !important;
          border-radius: 25px !important;
          width: 100% !important;
          background: #3b82f6 !important;
          color: white !important;
          border: none !important;
        }
        
        /* æ‰‹æ©Ÿç‰ˆï¼šåªåœ¨ mode2 é é¢ä¸”ç‚º active æ™‚é¡¯ç¤ºå¿«é€ŸæŒ‰éˆ•å’Œè¼¸å…¥å€åŸŸ */
        #mode2.active .quick-buttons,
        #mode2.active .input-row {
          display: flex !important;
          visibility: visible !important;
          opacity: 1 !important;
          height: auto !important;
          position: relative !important;
          z-index: 100 !important;
        }
        
        #mode2.active .quick-buttons {
          min-height: auto !important;
          background: transparent !important;
          border: none !important;
          padding: 0 !important;
          flex-direction: row !important;
          gap: 8px !important;
          margin-bottom: 12px !important;
          position: relative !important;
          bottom: auto !important;
          left: auto !important;
          right: auto !important;
          z-index: auto !important;
          flex-wrap: wrap !important;
          justify-content: flex-start !important;
          height: auto !important;
        }
        
        /* æ‰‹æ©Ÿç‰ˆå¿«é€ŸæŒ‰éˆ•æ–‡å­—å°é½Šèª¿æ•´ */
        .mode2 .quick-btn {
          text-align: left !important; /* å¼·åˆ¶æ–‡å­—å·¦å°é½Š */
          padding: 8px 12px !important; /* èª¿æ•´å·¦å³paddingï¼Œå·¦é‚Šå°‘ä¸€é» */
        }
        
        /* æ‰‹æ©Ÿç‰ˆMode2é é¢å›ºå®šè¨­è¨ˆ - é˜²æ­¢å·¦å³æ»‘å‹• */
        .mode2 {
          width: 100% !important;
          max-width: 100vw !important;
          overflow-x: hidden !important;
          box-sizing: border-box !important;
        }
        
        /* æ‰‹æ©Ÿç‰ˆ Hero å€åŸŸæ¨£å¼ */
        .rm-hero {
          width: 100% !important;
          max-width: 100vw !important;
          overflow-x: hidden !important;
          box-sizing: border-box !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
        }
        
        .rm-hero-container {
          width: 100% !important;
          max-width: 100% !important;
          padding-left: 16px !important;
          padding-right: 16px !important;
          box-sizing: border-box !important;
        }
        
        .rm-hero-grid {
          grid-template-columns: 1fr !important;
          gap: 32px !important;
          width: 100% !important;
          max-width: 100% !important;
          box-sizing: border-box !important;
        }
        
        .rm-hero-grid > div {
          width: 100% !important;
          max-width: 100% !important;
          box-sizing: border-box !important;
          padding-left: 0 !important;
          padding-right: 0 !important;
        }
        
        /* æ‰‹æ©Ÿç‰ˆ åˆ¥äººæ€éº¼ç”¨ å€å¡Šæ¨£å¼ */
        .user-story-section {
          width: 100% !important;
          max-width: 100vw !important;
          overflow-x: hidden !important;
          box-sizing: border-box !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
          padding-left: 0 !important;
          padding-right: 0 !important;
        }
        
        .user-story-section > div {
          width: 100% !important;
          max-width: 100% !important;
          padding-left: 16px !important;
          padding-right: 16px !important;
          box-sizing: border-box !important;
        }
        
        .user-story-section div[style*="grid-template-columns"] {
          grid-template-columns: 1fr !important;
          gap: 24px !important;
          width: 100% !important;
          max-width: 100% !important;
          box-sizing: border-box !important;
        }
        
        .user-story-card {
          width: 100% !important;
          max-width: 100% !important;
          box-sizing: border-box !important;
          padding: 24px !important;
        }
        
        /* æ‰‹æ©Ÿç‰ˆï¼šæœªè¨‚é–±ç”¨æˆ¶é¦–é  - æ‰€æœ‰å€å¡Šå°é½Š */
        /* åˆ¥äººæ€éº¼ç”¨å€å¡Šä½œç‚ºå°é½ŠåŸºæº– */
        .user-story-section {
          padding-left: 0 !important;
          padding-right: 0 !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
          width: 100% !important;
          max-width: 100vw !important;
        }
        
        .user-story-section > div {
          padding-left: 16px !important;
          padding-right: 16px !important;
          max-width: 100% !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
        }
        
        /* AI çŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—å€å¡Šå°é½Š */
        .rm-guide-section {
          padding-left: 0 !important;
          padding-right: 0 !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
          width: 100% !important;
          max-width: 100vw !important;
        }
        
        .rm-guide-section > div {
          padding-left: 16px !important;
          padding-right: 16px !important;
          max-width: 100% !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
        }
        
        .rm-guide-section div[style*="grid-template-columns"] {
          grid-template-columns: 1fr !important;
          gap: 24px !important;
          width: 100% !important;
          max-width: 100% !important;
          padding-left: 0 !important;
          padding-right: 0 !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
        }
        
        .rm-guide-section a[onclick*="switchPage"] {
          width: 100% !important;
          max-width: 100% !important;
        }
        
        .rm-guide-section a[onclick*="switchPage"] > div {
          width: 100% !important;
          max-width: 100% !important;
          box-sizing: border-box !important;
        }
        
        /* é–‹å§‹ä½ çš„ AI å‰µä½œä¹‹æ—…å€å¡Šå°é½Š */
        .rm-pricing {
          padding-left: 0 !important;
          padding-right: 0 !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
          width: 100% !important;
          max-width: 100vw !important;
        }
        
        .rm-pricing > div {
          padding-left: 16px !important;
          padding-right: 16px !important;
          max-width: 100% !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
        }
        
        .rm-pricing-cards {
          padding-left: 0 !important;
          padding-right: 0 !important;
          width: 100% !important;
          max-width: 100% !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
        }
        
        /* æ‰€æœ‰ä½¿ç”¨ margin: -20px calc(-50vw + 50%) çš„å€å¡Šåœ¨æ‰‹æ©Ÿç‰ˆéƒ½è¦é‡ç½® */
        section[style*="calc(-50vw + 50%)"] {
          margin-left: 0 !important;
          margin-right: 0 !important;
          width: 100% !important;
          max-width: 100vw !important;
        }
        
        section[style*="calc(-50vw + 50%)"] > div {
          padding-left: 16px !important;
          padding-right: 16px !important;
        }
        
        /* é å°¾å°é½Š */
        .rm-footer {
          padding-left: 0 !important;
          padding-right: 0 !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
          width: 100% !important;
          max-width: 100vw !important;
        }
        
        .rm-footer > div {
          padding-left: 16px !important;
          padding-right: 16px !important;
          max-width: 100% !important;
          margin-left: 0 !important;
          margin-right: 0 !important;
          text-align: center !important;
          display: flex !important;
          flex-direction: column !important;
          align-items: center !important;
          justify-content: center !important;
        }
        
        .rm-footer > div > div {
          width: 100% !important;
          max-width: 100% !important;
          text-align: center !important;
        }
        
        /* å·²è¨‚é–±ç”¨æˆ¶é¦–é  - æ¨™é¡Œèª¿æ•´ */
        /* "æ­¡è¿ä½¿ç”¨AIJobçŸ­å½±éŸ³æ™ºèƒ½é«”" å­—é«”å¤§å°èˆ‡"ä»‹ç´¹å¦‚ä½•é–‹å§‹"ä¸€è‡´ */
        #mode-cards .homepage-title {
          font-size: clamp(2rem, 4vw, 2.8rem) !important;
          font-weight: 800 !important;
          margin-bottom: 16px !important;
          margin-top: -30px !important;
          color: #1E293B !important;
          line-height: 1.2 !important;
        }
        
        #mode-cards .homepage-subtitle {
          font-size: clamp(1rem, 2vw, 1.1rem) !important;
          margin-bottom: 48px !important;
        }
        
        /* ç¢ºä¿"ä»‹ç´¹å¦‚ä½•é–‹å§‹"å€å¡Šçš„æ¨™é¡Œæ¨£å¼ä¸€è‡´ */
        #introduction h2 {
          font-size: clamp(2rem, 4vw, 2.8rem) !important;
          font-weight: 800 !important;
          margin-bottom: 16px !important;
        }
        
        /* ä¸‰å¤§åŠŸèƒ½å¡ç‰‡ä¿æŒç½®ä¸­ */
        #mode-cards .mode-cards {
          display: flex !important;
          flex-direction: column !important;
          align-items: center !important;
          justify-content: center !important;
          width: 100% !important;
          max-width: 100% !important;
          padding-left: 0 !important;
          padding-right: 0 !important;
        }
        
        #mode-cards .mode-card {
          width: 100% !important;
          max-width: 100% !important;
          box-sizing: border-box !important;
        }
        
      .mode2-page {
        width: 100% !important;
        max-width: 100vw !important;
        overflow-x: hidden !important;
        box-sizing: border-box !important;
        margin: 0 !important;
        padding: 0 !important;
        display: flex !important;
        flex-direction: column !important;
      }
        
        .mode2 #chatMessages {
          width: 100% !important;
          max-width: 100% !important;
          overflow-x: hidden !important;
          box-sizing: border-box !important;
        }
        
        .mode2 .message {
          width: 100% !important;
          max-width: 100% !important;
          overflow-x: hidden !important;
          box-sizing: border-box !important;
          position: relative !important;
          z-index: 1 !important;
        }
        
        .mode2 .message-content {
          width: 100% !important;
          max-width: 90% !important;
          overflow-x: hidden !important;
          box-sizing: border-box !important;
        }
        
        /* ç¢ºä¿ç”¨æˆ¶è¨Šæ¯æ–‡å­—å¯è¦‹ */
        .mode2 .message.user {
          position: relative !important;
          z-index: 10 !important;
        }
        
        .mode2 .message.user .message-content {
          color: #000000 !important;
          background: #dbeafe !important;
          font-size: 14px !important;
          line-height: 1.5 !important;
          min-width: 200px !important;
          position: relative !important;
          z-index: 11 !important;
          padding: 20px 40px !important; /* èˆ‡ AI å›è¦†æ¡†ä¸€æ¨£çš„ padding */
          padding-left: 50px !important; /* å¢åŠ å·¦é‚Š paddingï¼Œé¿å…æ–‡å­—å¤ªè²¼é‚Šç•Œï¼Œèˆ‡ Mode3 ä¸€è‡´ */
        }
        
        /* ç¢ºä¿AIè¨Šæ¯æ–‡å­—å¯è¦‹ */
        .mode2 .message.ai {
          position: relative !important;
          z-index: 5 !important;
        }
        
        .mode2 .message.ai .message-content {
          color: #0c4a6e !important;
          background: #f0f9ff !important;
          font-size: 14px !important;
          line-height: 1.5 !important;
          position: relative !important;
          z-index: 6 !important;
        }
        
        /* è¦†è“‹èˆŠçš„æ‰‹æ©Ÿç‰ˆå›ºå®šå®šä½è¦å‰‡ï¼Œæ”¹ç”¨ flex å¸ƒå±€ */
        .mode2.fig1 .input-row {
          position: static !important; /* æ”¹ç‚º staticï¼Œä½¿ç”¨ flex å¸ƒå±€ */
          bottom: auto !important;
          left: auto !important;
          right: auto !important;
          z-index: auto !important;
          min-height: auto !important;
          background: transparent !important;
          border: none !important;
          padding: 8px 12px 16px 12px !important; /* ä½¿ç”¨çµ±ä¸€çš„ padding */
          flex-direction: row !important; /* æ©«å‘æ’åˆ— */
          gap: 12px !important;
          box-shadow: none !important;
          margin: 0 !important;
          height: auto !important;
          border-radius: 0 !important;
          max-height: none !important;
          flex-shrink: 0 !important; /* å›ºå®šåœ¨åº•éƒ¨ */
          display: flex !important;
          align-items: center !important;
          width: 100% !important;
          box-sizing: border-box !important;
        }
        
        /* ä¿ç•™èˆŠè¦å‰‡çµ¦æ²’æœ‰ fig1 çš„æƒ…æ³ */
        .mode2:not(.fig1) .input-row {
          min-height: auto !important;
          background: transparent !important;
          border: none !important;
          padding: 12px 16px !important;
          flex-direction: column !important;
          gap: 0 !important;
          position: fixed !important;
          bottom: 80px !important;
          left: 16px !important;
          right: 16px !important;
          z-index: 1001 !important;
          box-shadow: none !important;
          margin: 0 !important;
          height: auto !important;
          border-radius: 0 !important;
          max-height: none !important;
        }
        
        .mode2 .input-container {
          flex-direction: row !important;
          gap: 8px !important;
          align-items: flex-end !important;
        }
        
        .mode2 .input-container button {
          width: auto !important;
          min-width: 80px !important;
          flex-shrink: 0 !important;
        }
        
        .mode2 .input-container textarea {
          height: 44px !important; /* å›ºå®šé«˜åº¦èˆ‡é€å‡ºæŒ‰éˆ•ä¸€è‡´ */
          min-height: 44px !important;
          max-height: 44px !important; /* é™åˆ¶æœ€å¤§é«˜åº¦èˆ‡æœ€å°é«˜åº¦ä¸€è‡´ */
          resize: none !important; /* ç¦æ­¢èª¿æ•´å¤§å°ä¿æŒå›ºå®šé«˜åº¦ */
          line-height: 1.2 !important; /* èª¿æ•´è¡Œé«˜ç¢ºä¿æ–‡å­—å‚ç›´å±…ä¸­ */
        }
        
        /* å‰µä½œè€…è³‡æ–™åº«æ‰‹æ©Ÿç‰ˆ */
        .user-db-page {
          padding: 16px;
          padding-top: 50px;
          max-width: 100%;
          overflow-x: hidden;
        }
        
        .user-db-container {
          flex-direction: column;
          max-width: 100%;
          overflow-x: hidden;
        }
        
        .user-db-sidebar {
          width: 100%;
          margin-bottom: 20px;
          border-radius: 12px;
          max-width: 100%;
        }
        
        .user-db-content {
          width: 100%;
          max-width: 100%;
          overflow-x: hidden;
        }
        
        /* å€‹äººè³‡æ–™å¡ç‰‡æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        .db-section {
          max-width: 100%;
          overflow-x: hidden;
        }
        
        .section-content {
          max-width: 100%;
          overflow-x: hidden;
          word-wrap: break-word;
        }
        
        .user-info-detail {
          max-width: 100%;
          overflow-x: hidden;
          width: 100%;
          padding: 20px;
        }
        
        .info-item {
          max-width: 100%;
          overflow-x: hidden;
          white-space: nowrap;
          display: flex;
          align-items: center;
        }
        
        .info-item label {
          flex-shrink: 0;
          margin-right: 8px;
        }
        
        .info-item span {
          flex: 1;
          overflow: hidden;
          text-overflow: ellipsis;
        }
        
        /* å¼·åˆ¶é˜²æ­¢è³‡æ–™åº«é é¢æ°´å¹³æ»¾å‹• */
        #userDB {
          overflow-x: hidden !important;
          max-width: 100vw !important;
        }
        
        .user-db-page * {
          box-sizing: border-box !important;
        }
        
        .user-db-page input,
        .user-db-page span,
        .user-db-page div {
          max-width: 100% !important;
          overflow-x: hidden !important;
        }
        
        .user-db-page .info-item {
          white-space: nowrap !important;
          display: flex !important;
          align-items: center !important;
        }
        
        .user-db-page .info-item span {
          text-overflow: ellipsis !important;
          overflow: hidden !important;
        }
        
        /* å¼·åˆ¶æ‹‰é•·å€‹äººè³‡æ–™ç°åº•å¯¬åº¦ */
        .user-db-page .user-info-detail {
          width: 100% !important;
          max-width: 100% !important;
          padding: 50px !important;
          margin: 0 !important;
        }
        
        .user-db-page .section-content {
          width: 100% !important;
          max-width: 100% !important;
          padding: 0 !important;
        }
        
        .user-db-page .db-section {
          width: 100% !important;
          max-width: 100% !important;
        }
        
        /* å€‹äººè³‡æ–™ç°åº•å¯¬åº¦æ‰‹æ©Ÿç‰ˆ */
        .user-db-page .detail-item {
          width: 100% !important;
          max-width: 100% !important;
          padding: 16px !important;
        }
        
        .user-db-page .profile-details {
          width: 100% !important;
          max-width: 100% !important;
        }
        
        .sidebar-header {
          padding: 16px;
        }
        
        .user-profile {
          flex-direction: column;
          text-align: center;
          gap: 12px;
        }
        
        .profile-avatar {
          width: 60px;
          height: 60px;
        }
        
        .profile-info h3 {
          font-size: 18px;
        }
        
        .profile-info p {
          font-size: 14px;
        }
        
        .sidebar-menu {
          padding: 16px;
        }
        
        .menu-item {
          padding: 12px 16px;
          margin-bottom: 8px;
          border-radius: 8px;
        }
        
        .menu-text {
          font-size: 14px;
        }
        
        .user-db-content {
          width: 100%;
        }
        
        .db-section {
          padding: 16px;
        }
        
        .section-title {
          font-size: 18px;
          margin-bottom: 16px;
        }
        
        /* è…³æœ¬è¡¨æ ¼æ‰‹æ©Ÿç‰ˆ */
        /* æˆ‘çš„è…³æœ¬æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        .script-item {
          margin-bottom: 16px;
          border-radius: 12px;
        }
        
        .script-header {
          padding: 12px 16px;
          flex-wrap: wrap;
          gap: 8px;
        }
        
        .script-info {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
          width: 100%;
        }
        
        .script-name {
          font-size: 14px;
          word-break: break-word;
          max-width: 100%;
        }
        
        .script-date {
          font-size: 12px;
        }
        
        .script-table {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
          margin: 12px 0;
          border-radius: 8px;
          border: 1px solid #e5e7eb;
        }
        
        .script-table table {
          min-width: 800px;
          font-size: 11px;
          margin: 0;
        }
        
        .script-table th,
        .script-table td {
          padding: 10px 8px;
          white-space: normal;
          word-break: break-word;
          vertical-align: top;
        }
        
        .script-table th {
          font-size: 11px;
          font-weight: 600;
          background: #f8fafc;
          position: sticky;
          left: 0;
          z-index: 1;
        }
        
        .script-table td:first-child {
          position: sticky;
          left: 0;
          background: white;
          z-index: 1;
          font-weight: 500;
        }
        
        .script-table tr:nth-child(even) td:first-child {
          background: #f9fafb;
        }
        
        .script-actions {
          flex-direction: column;
          gap: 10px;
          padding: 12px;
          background: #f8fafc;
          border-top: 1px solid #e5e7eb;
        }
        
        .action-btn {
          padding: 12px 16px;
          font-size: 14px;
          width: 100%;
          border-radius: 8px;
          font-weight: 500;
          transition: all 0.2s;
        }
        
        .action-btn.view-btn {
          background: #3b82f6;
          color: white;
        }
        
        .action-btn.view-btn:active {
          background: #2563eb;
          transform: scale(0.98);
        }
        
        .action-btn.download-pdf-btn {
          background: #10b981;
          color: white;
        }
        
        .action-btn.download-pdf-btn:active {
          background: #059669;
          transform: scale(0.98);
        }
        
        .action-btn.download-csv-btn {
          background: #06b6d4;
          color: white;
        }
        
        .action-btn.download-csv-btn:active {
          background: #0891b2;
          transform: scale(0.98);
        }
        
        /* æ‰‹æ©Ÿç‰ˆå½ˆçª—å„ªåŒ– */
        @media (max-width: 768px) {
          .script-modal-overlay {
            padding: 10px !important;
          }
          
          .script-modal-overlay > div {
            max-width: 100% !important;
            max-height: 95vh !important;
            padding: 16px !important;
          }
          
          .script-modal-overlay table {
            font-size: 10px !important;
          }
          
          .script-modal-overlay th,
          .script-modal-overlay td {
            padding: 8px 6px !important;
          }
        }
        
        .action-btn.delete-btn {
          background: #ef4444;
          color: white;
        }
        
        .action-btn.delete-btn:active {
          background: #dc2626;
          transform: scale(0.98);
        }
        
        /* ç”¨æˆ¶æŠ½å±œæ‰‹æ©Ÿç‰ˆ */
        .user-drawer {
          width: 100%;
          max-width: 100vw;
          right: 0;
          border-radius: 0;
        }
        
        .user-drawer-header {
          padding: 20px 16px;
          padding-top: calc(20px + var(--safe-area-inset-top));
        }
        
        .user-drawer-content {
          padding: 16px;
        }
        
        .drawer-section h3 {
          font-size: 16px;
          margin-bottom: 12px;
        }
        
        .drawer-section p {
          font-size: 14px;
          margin-bottom: 8px;
        }
        
        /* åº•éƒ¨å°èˆªæ¬„ï¼ˆæ‰‹æ©Ÿç‰ˆå°ˆç”¨ï¼‰ */
        .bottom-navbar {
          display: flex !important;
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          background: white;
          border-top: 1px solid #e5e7eb;
          padding: 8px 0;
          padding-bottom: calc(8px + var(--safe-area-inset-bottom));
          z-index: 1000;
        }
        
        .bottom-nav-item {
          flex: 1;
          display: flex;
          flex-direction: column;
          align-items: center;
          padding: 8px 4px;
          text-decoration: none;
          color: #6b7280;
          font-size: 12px;
          transition: color 0.2s;
        }
        
        .bottom-nav-item.active {
          color: #3b82f6;
        }
        
        .bottom-nav-item span {
          margin-top: 4px;
        }
        
        /* éš±è—æ¡Œé¢ç‰ˆå°èˆª */
        .navbar-tabs {
          display: none;
        }
      }
      
      /* è¶…å°è¢å¹•æ‰‹æ©Ÿ */
      @media (max-width: 480px) {
        .homepage-title {
          font-size: 20px;
        }
        
        .homepage-subtitle {
          font-size: 14px;
        }
        
        .mode-card {
          padding: 20px 16px;
        }
        
        .mode-card h3 {
          font-size: 18px;
        }
        
        .mode-card p {
          font-size: 13px;
        }
        
        .chat-container {
          height: calc(100vh - 180px);
        }
        
        .script-table table {
          font-size: 11px;
        }
        
        .script-table th,
        .script-table td {
          padding: 6px 4px;
        }
      }
      
      /* iOS Safari ç‰¹æ®Šè™•ç† */
      @supports (-webkit-touch-callout: none) {
        .chat-container {
          height: calc(100vh - 220px);
          height: calc(100dvh - 220px);
        }
        
        .main-content {
          min-height: calc(100vh - 60px);
          min-height: calc(100dvh - 60px);
        }
        
        .app-container {
          min-height: 100vh;
          min-height: 100dvh;
        }
      }
      
      /* ç™»å…¥é é¢æ¨£å¼ */
      .login-page {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #ffffff;
        background-image: 
          radial-gradient(circle at 20% 20%, rgba(0, 0, 0, 0.1) 1px, transparent 1px),
          radial-gradient(circle at 40% 40%, rgba(0, 0, 0, 0.08) 1px, transparent 1px),
          radial-gradient(circle at 60% 60%, rgba(0, 0, 0, 0.06) 1px, transparent 1px),
          radial-gradient(circle at 80% 80%, rgba(0, 0, 0, 0.1) 1px, transparent 1px),
          radial-gradient(circle at 30% 70%, rgba(0, 0, 0, 0.05) 1px, transparent 1px),
          radial-gradient(circle at 70% 30%, rgba(0, 0, 0, 0.07) 1px, transparent 1px);
        background-size: 50px 50px, 60px 60px, 40px 40px, 70px 70px, 30px 30px, 80px 80px;
        animation: starField 15s linear infinite;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        overflow: hidden;
      }
      
      /* æ˜Ÿæ˜Ÿå‹•ç•« */
      @keyframes starField {
        0% {
          background-position: 0% 0%, 0% 0%, 0% 0%, 0% 0%, 0% 0%;
        }
        25% {
          background-position: 25% 25%, 25% 25%, 25% 25%, 25% 25%, 25% 25%;
        }
        50% {
          background-position: 50% 50%, 50% 50%, 50% 50%, 50% 50%, 50% 50%;
        }
        75% {
          background-position: 75% 75%, 75% 75%, 75% 75%, 75% 75%, 75% 75%;
        }
        100% {
          background-position: 100% 100%, 100% 100%, 100% 100%, 100% 100%, 100% 100%;
        }
      }
      
      /* ç™»å…¥å®¹å™¨å‹•ç•« */
      .login-container {
        background: white;
        border-radius: 16px;
        padding: 40px;
        border: 2px solid #e5e7eb;
        box-shadow: 
          0 25px 50px -12px rgba(0, 0, 0, 0.25),
          0 0 0 1px rgba(255, 255, 255, 0.8),
          inset 0 1px 0 rgba(255, 255, 255, 0.9),
          inset 0 -1px 0 rgba(0, 0, 0, 0.05);
        max-width: 400px;
        width: 90%;
        text-align: center;
        animation: fadeInUp 0.8s ease-out;
        position: relative;
        overflow: hidden;
      }
      
      .login-container:hover {
        transform: translateY(-2px);
        box-shadow: 
          0 32px 64px -12px rgba(0, 0, 0, 0.35),
          0 0 0 1px rgba(255, 255, 255, 0.9),
          inset 0 1px 0 rgba(255, 255, 255, 0.95),
          inset 0 -1px 0 rgba(0, 0, 0, 0.08);
        border-color: #d1d5db;
        transition: all 0.3s ease;
      }
      
      .login-container::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(59, 130, 246, 0.03), transparent);
        animation: shimmer 3s ease-in-out infinite;
        pointer-events: none;
      }
      
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      @keyframes shimmer {
        0% {
          transform: translateX(-100%) translateY(-100%) rotate(45deg);
        }
        100% {
          transform: translateX(100%) translateY(100%) rotate(45deg);
        }
      }
      
      .login-header {
        margin-bottom: 32px;
      }
      
      .login-title {
        font-size: 35px;
        font-weight: bold;
        color: #1f2937;
        margin: 0 0 8px 0;
        animation: titleGlow 2s ease-in-out infinite alternate;
      }
      
      @keyframes titleGlow {
        from {
          text-shadow: 0 0 5px rgba(59, 130, 246, 0.3);
        }
        to {
          text-shadow: 0 0 20px rgba(59, 130, 246, 0.6), 0 0 30px rgba(59, 130, 246, 0.4);
        }
      }
      
      .login-subtitle {
        font-size: 16px;
        color: #6b7280;
        margin: 0 0 16px 0;
      }
      
      .login-prompt {
        font-size: 14px;
        color: #9ca3af;
        margin: 0;
      }
      
      .login-buttons {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 24px;
      }
      
      .login-btn {
        padding: 12px 24px;
        border-radius: 8px;
        border: none;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }
      
      .skip-btn {
        background: #fbbf24;
        color: #1f2937;
      }
      
      .skip-btn:hover {
        background: #f59e0b;
      }
      
      .google-btn {
        background: #3b82f6;
        color: white;
        border: 2px solid #1d4ed8;
        box-shadow: 
          0 4px 8px rgba(0, 0, 0, 0.15),
          inset 0 1px 0 rgba(255, 255, 255, 0.2),
          inset 0 -1px 0 rgba(0, 0, 0, 0.1);
      }
      
      .google-btn:hover {
        background: #2563eb;
        border-color: #1e40af;
        transform: translateY(-2px);
        box-shadow: 
          0 8px 25px -5px rgba(59, 130, 246, 0.4),
          inset 0 1px 0 rgba(255, 255, 255, 0.3),
          inset 0 -1px 0 rgba(0, 0, 0, 0.15);
      }
      
      .google-btn:active {
        transform: translateY(0);
        background: #1d4ed8;
        border-color: #1e3a8a;
        box-shadow: 
          0 2px 4px rgba(0, 0, 0, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.1),
          inset 0 -1px 0 rgba(0, 0, 0, 0.2);
      }
      
      .line-btn {
        background: #f3f4f6;
        color: #9ca3af;
        cursor: not-allowed;
      }
      
      .google-icon, .line-icon {
        width: 18px;
        height: 18px;
      }
      
      .login-note {
        font-size: 12px;
        color: #9ca3af;
        margin: 0 0 24px 0;
      }
      
      .language-selector {
        display: flex;
        gap: 8px;
        justify-content: center;
      }
      
      .lang-btn {
        padding: 8px 16px;
        border-radius: 20px;
        border: 1px solid #d1d5db;
        background: white;
        color: #6b7280;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .lang-btn.active {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }
      
      .lang-btn:hover:not(.active) {
        background: #f9fafb;
      }
      
      /* æ‰‹æ©Ÿç‰ˆç™»å…¥é é¢ */
      @media (max-width: 768px) {
        .login-container {
          padding: 32px 24px;
          margin: 16px;
        }
        
        /* æ‰‹æ©Ÿç‰ˆéš±è—ç™»å‡ºæŒ‰éˆ• */
        .logout-btn {
          display: none !important;
        }
        
        /* é˜²æ­¢æ•´å€‹é é¢æ°´å¹³æ»¾å‹• */
        body {
          overflow-x: hidden !important;
        }
        
        .main-content {
          overflow-x: hidden !important;
        }
        
        /* ä¸€éµç”Ÿæˆæ¨¡å¼é˜²æ­¢æ°´å¹³æ»¾å‹• */
        #mode1 {
          overflow-x: hidden !important;
          max-width: 100vw !important;
        }
        
        .mode1-page {
          overflow-x: hidden !important;
          max-width: 100% !important;
        }
        
        .mode1-left,
        .mode1-right {
          overflow-x: hidden !important;
          word-wrap: break-word !important;
        }
        
        .login-title {
          font-size: 30px;
        }
        
        .login-subtitle {
          font-size: 14px;
        }
        
        .login-btn {
          padding: 14px 20px;
          font-size: 15px;
        }
      }
      
      /* Mode3 é é¢æ¨£å¼ï¼ˆå¾ index-ai-consultant.html é·ç§»ï¼‰ */
      .mode3-page {
        display: flex;
        flex-direction: column;
        height: calc(100vh - 60px);
        overflow: hidden;
        background: #f8fafc;
      }
      
      .mode3.fig1 {
        height: 100dvh !important;
        overflow: hidden !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        bottom: 0 !important;
        width: 100% !important;
        display: flex !important;
        flex-direction: column !important;
        z-index: 1 !important;
      }
      
      .mode3.fig1 .mode3-page {
        display: flex !important;
        flex-direction: column !important;
        flex: 1 !important;
        min-height: 0 !important;
        overflow: hidden !important;
        padding: 0 !important;
        padding-top: 60px !important;
        margin: 0 !important;
        box-sizing: border-box !important;
        position: relative !important;
      }
      
      body.mode3-active, html.mode3-active {
        overflow: hidden !important;
        height: 100% !important;
        position: fixed !important;
        width: 100% !important;
      }
      
      /* Mode3 èŠå¤©è¨Šæ¯å€åŸŸ - èˆ‡ Mode2 ä¸€è‡´ï¼Œç§»é™¤ç™½è‰²èƒŒæ™¯ */
      #mode3-chatMessages {
        margin: 0 !important;
        padding: 16px 24px !important;
        background: transparent !important; /* èˆ‡ Mode2 ä¸€è‡´ï¼Œä½¿ç”¨é€æ˜èƒŒæ™¯ */
        border: none !important;
        border-radius: 0 !important;
        flex: 1 !important;
        min-height: 0 !important;
        height: auto !important;
        -webkit-overflow-scrolling: touch !important;
        overscroll-behavior: contain !important;
        touch-action: pan-y !important;
        overflow-y: auto !important;
        position: relative !important;
        z-index: 1 !important;
        width: 100% !important;
        max-width: 100% !important;
        box-sizing: border-box !important;
      }
      
      /* Mode3 è¼¸å…¥å€åŸŸ */
      #mode3 .input-row,
      #mode3.active .input-row {
        display: flex !important;
        flex-direction: column !important;
        padding: 16px 24px;
        border-top: 1px solid #e5e7eb;
        background: transparent;
      }
      
      #mode3 .input-container,
      #mode3.active .input-container {
        display: flex !important;
        gap: 12px;
        align-items: flex-start;
        width: 100%;
      }
      
      #mode3 .input-wrapper,
      #mode3.active .input-wrapper {
        position: relative;
        flex: 1;
        display: flex !important;
        flex-direction: column !important;
        min-height: 120px !important;
        background: #ffffff !important;
        border: 1px solid #d1d5db !important;
        border-radius: 12px !important;
        padding: 12px !important;
        gap: 8px !important;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }
      
      #mode3 .input-wrapper:focus-within {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }
      
      /* æ·±è‰²æ¨¡å¼ï¼šMode3 è¼¸å…¥æ¬„ä½å®¹å™¨ */
      .theme-dark #mode3 .input-wrapper,
      .theme-dark #mode3.active .input-wrapper,
      .theme-dark .mode3.fig1 .input-wrapper {
        background: var(--gradient-card) !important;
        border-color: var(--border-color) !important;
      }
      
      .theme-dark #mode3 .input-wrapper:focus-within,
      .theme-dark .mode3.fig1 .input-wrapper:focus-within {
        border-color: var(--accent-blue) !important;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2) !important;
      }
      
      #mode3 .input-row-inner,
      #mode3.active .input-row-inner {
        display: flex !important;
        gap: 12px;
        align-items: flex-end;
        flex: 1;
      }
      
      #mode3 .chat-input,
      #mode3.active .chat-input {
        flex: 1;
        min-height: 44px;
        max-height: 100px;
        padding: 10px 12px;
        border: 1px solid transparent !important;
        background: transparent !important;
        border-radius: 8px;
        font-size: 14px;
        resize: vertical;
        outline: none;
        line-height: 1.5;
        font-family: inherit;
      }
      
      #mode3 .chat-input:focus,
      #mode3.active .chat-input:focus {
        border-color: transparent !important;
        box-shadow: none !important;
      }
      
      #mode3 .send-btn,
      #mode3.active .send-btn {
        height: 44px;
        min-width: 44px;
        padding: 0 18px;
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: background-color 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      #mode3 .send-btn:hover:not(:disabled),
      #mode3.active .send-btn:hover:not(:disabled) {
        background: #2563eb;
      }
      
      #mode3 .send-btn:disabled,
      #mode3.active .send-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
      }
      
      #mode3 .quick-buttons,
      #mode3.active .quick-buttons {
        display: flex !important;
        flex-wrap: wrap !important;
        gap: 8px;
        padding: 8px 0 0 0;
        margin: 0;
        border-top: 1px solid #e5e7eb;
        background: transparent;
      }
      
      #mode3 .quick-btn,
      #mode3.active .quick-btn {
        background: #ffffff !important;
        border: 1px solid #d1d5db !important;
        color: #1f2937 !important;
        padding: 6px 12px;
        border-radius: 16px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
        font-family: inherit;
        width: auto !important;
        min-width: fit-content !important;
        flex-shrink: 0;
        font-weight: 500;
      }
      
      #mode3 .quick-btn:hover,
      #mode3.active .quick-btn:hover {
        background: #f3f4f6 !important;
        border-color: #3b82f6 !important;
        color: #1f2937 !important;
      }
      
      /* Mode3 æ¡Œé¢ç‰ˆæ¨£å¼ - ç¢ºä¿å¿«é€ŸæŒ‰éˆ•å¤§å°åˆé© */
      @media (min-width: 769px) {
        #mode3 .quick-buttons,
        #mode3.active .quick-buttons {
          display: flex !important;
          flex-wrap: wrap !important;
          gap: 8px !important;
        }
        
        #mode3 .quick-btn,
        #mode3.active .quick-btn {
          width: auto !important;
          min-width: fit-content !important;
          max-width: none !important;
          flex: 0 0 auto !important;
        }
      }
      
      /* Mode3 æ‰‹æ©Ÿç‰ˆæ¨£å¼ - èˆ‡ Mode2 ä¸€è‡´ */
      @media (max-width: 768px) {
        body.mode3-active, html.mode3-active {
          overflow: hidden !important;
        }
        
        .mode3.fig1 .mode3-page {
          padding-top: 70px !important;
        }
        
        .mode3.fig1 #mode3-chatMessages {
          padding: 12px !important;
        }
        
        .mode3.fig1 .quick-btn {
          padding: 3px 6px !important;
          font-size: 10px !important;
        }
        
        .mode3.fig1 .input-row {
          padding: 8px 12px 16px 12px !important;
        }
        
        #mode3 .input-wrapper,
        #mode3.active .input-wrapper {
          min-height: 100px !important;
          padding: 8px !important;
        }
        
        /* Mode3 æ‰‹æ©Ÿç‰ˆè¼¸å…¥æ¡†æ¨£å¼ - èˆ‡ Mode2 ä¸€è‡´ */
        #mode3 .chat-input,
        #mode3.active .chat-input,
        .mode3.fig1 #mode3-messageInput {
          flex: 1 !important;
          min-height: 44px !important;
          max-height: 44px !important;
          height: 44px !important;
          border: 1px solid #d1d5db !important;
          border-radius: 10px !important;
          padding: 10px 12px !important;
          font-size: 14px !important;
          background: #ffffff !important;
          resize: none !important;
        }
        
        /* Mode3 æ‰‹æ©Ÿç‰ˆé€å‡ºæŒ‰éˆ•æ¨£å¼ - èˆ‡ Mode2 ä¸€è‡´ */
        #mode3 .send-btn,
        #mode3.active .send-btn,
        .mode3.fig1 #mode3-sendBtn {
          height: 44px !important;
          min-width: 44px !important;
          border-radius: 10px !important;
          background: #3b82f6 !important;
          color: #ffffff !important;
          border: none !important;
          padding: 0 18px !important;
          width: auto !important;
          flex-shrink: 0 !important;
        }
        
        /* Mode3 æ‰‹æ©Ÿç‰ˆè¼¸å…¥å€åŸŸå…§éƒ¨å¸ƒå±€ */
        #mode3 .input-row-inner,
        #mode3.active .input-row-inner,
        .mode3.fig1 .input-row-inner {
          display: flex !important;
          flex-direction: row !important;
          gap: 8px !important;
          align-items: center !important;
          width: 100% !important;
        }
      }
    </style>
  </head>
  <body data-subscribed="false">
    <!-- ç™»å…¥é é¢ -->
    <div id="loginPage" class="login-page">
      <div class="login-container">
        <div class="login-header">
          <h1 class="login-title">ReelMind</h1>
          <p class="login-subtitle">è®“ä½ çš„çŸ­å½±éŸ³ä¸å†é é‹æ°£ï¼Œè€Œé ç­–ç•¥ã€‚<br>AI çŸ­å½±éŸ³é¡§å•ï¼Œå¹«ä½ ç²¾æº–å®šä½ã€å¿«é€Ÿç”Ÿæˆã€‚</p>
        </div>
        
        <div class="login-buttons">
          <button class="login-btn google-btn" onclick="window.ReelMindCommon.goToLogin(); return false;">
            <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOCAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE3LjY0IDkuMjA0NTVDMTcuNjQgOC41NjY0MSAxNy41ODI3IDcuOTUyMjcgMTcuNDc3MyA3LjM2MzY0SDkuMTgzNjRWMTAuODQ1NUgxMy44NDA5QzEzLjYzNjQgMTIuMzI1IDEyLjgxODIgMTMuNTU0NSAxMS42MzY0IDE0LjM0NTVDMTEuNjM2NCAxNC4zNDU1IDExLjYzNjQgMTQuMzQ1NSAxMS42MzY0IDE0LjM0NTVMMTMuNDU0NSAxNS45OTU1QzE0LjkwOTEgMTQuNjU0NSAxNy42NCAxMi4zMjUgMTcuNjQgOS4yMDQ1NVoiIGZpbGw9IjQyODVGNCIvPgo8cGF0aCBkPSJNOS4xODM2NCAxOC4wMDAyQzExLjQzMTggMTguMDAwMiAxMy4yNzI3IDE3LjI3MjcgMTQuNjM2NCAxNi4wOTU1TDEyLjgxODIgMTQuNDQ1NUMxMi4wOTU1IDE1LjAwOTEgMTEuMTU0NSAxNS40MzE4IDEwLjAwOTEgMTUuNDMxOEM3Ljc0NTQ1IDE1LjQzMTggNS44NDU0NSAxMy45NTQ1IDUuMTU0NTUgMTEuOTU0NUwzLjI3MjczIDEzLjU0NTVDNC42MzYzNiAxNi4wOTU1IDYuNzI3MjcgMTguMDAwMiA5LjE4MzY0IDE4LjAwMDJaIiBmaWxsPSIzNEE4NTMiLz4KPHBhdGggZD0iTTMuMjcyNzMgMTEuOTU0NUMzLjAwOTA5IDExLjE4MTggMi44NzI3MyAxMC4zNjM2IDIuODcyNzMgOS41MDAwMkMyLjg3MjczIDguNjM2MzYgMy4wMDkwOSA3LjgxODE4IDMuMjcyNzMgNy4wNDU0NUw1LjE1NDU1IDguNjM2MzZDNC45NTQ1NSA5LjM2MzY0IDQuODcyNzMgMTAuMTM2NCA0Ljg3MjczIDEwLjk1NDVDNC44NzI3MyAxMS43NzI3IDQuOTU0NTUgMTIuNTQ1NSAzLjI3MjczIDEzLjU0NTVMMy4yNzI3MyAxMS45NTQ1WiIgZmlsbD0iRkJCQzA0Ii8+CjxwYXRoIGQ9Ik05LjE4MzY0IDMuNTY4MThDMTEuMTU0NSAzLjU2ODE4IDEyLjYzNjQgNC4zNDA5MSAxMy40NTQ1IDUuMDQ1NDVMMTQuNjM2NCAzLjkwOTA5QzEzLjI3MjcgMi42MzYzNiAxMS40MzE4IDEuOTk5OTggOS4xODM2NCAxLjk5OTk4QzYuNzI3MjcgMS45OTk5OCA0LjYzNjM2IDMuOTA5MDkgMy4yNzI3MyA2LjQ1OTA5TDUuMTU0NTUgOC4wNDU0NUM1Ljg0NTQ1IDYuMDQ1NDUgNy43NDU0NSA0LjU2ODE4IDkuMTgzNjQgMy41NjgxOFoiIGZpbGw9IjM0QTg1MyIvPgo8L3N2Zz4K" alt="Google" class="google-icon">
            ä½¿ç”¨ Google ç™»å…¥
          </button>
          <p class="login-prompt">è«‹ç™»å…¥ä»¥ç¹¼çºŒ</p>
        </div>
      </div>
    </div>

    <!-- ä¸»æ‡‰ç”¨ç¨‹å¼å®¹å™¨ -->
    <div id="appContainer" class="app-container" style="display: none;">
      <!-- ä¸»å…§å®¹å€åŸŸ -->
      <div class="main-content" id="mainContent">
        <!-- é ‚éƒ¨å°èˆªæ¬„ -->
        <div class="top-navbar">
          <div class="navbar-left">
            <!-- æ‰‹æ©Ÿç‰ˆæŠ½å±œæŒ‰éˆ• -->
            <button class="mobile-drawer-toggle" onclick="toggleMobileDrawer()">
              <span class="hamburger-icon">â˜°</span>
            </button>
            <div class="navbar-title clickable-title" onclick="switchPage('homepage')">ReelMind</div>
            <div class="navbar-tabs">
              <a href="#homepage" class="navbar-tab" onclick="switchPage('homepage'); return false;">é¦–é </a>
              <a href="mode1.html" class="navbar-tab">IPäººè¨­è¦åŠƒ</a>
              <a href="mode2.html" class="navbar-tab">AIé¡§å•</a>
              <a href="mode3.html" class="navbar-tab">ä¸€éµç”Ÿæˆ</a>
              <a href="#forum" class="navbar-tab" onclick="switchPage('forum'); return false;">è«–å£‡ä»‹ç´¹</a>
              <a href="#guide" class="navbar-tab" onclick="switchPage('guide'); return false;">å¯¦æˆ°æŒ‡å—</a>
              <a href="#" id="userDBTab" class="navbar-tab" style="display:none;" onclick="handleUserDBClick(); return false;">å‰µä½œè€…è³‡æ–™åº«</a>
            </div>
          </div>
          <div class="navbar-right">
            <div class="user-info" id="userInfo" style="display: none;" onclick="handleUserDBClick()">
              <img id="userAvatar" class="user-avatar" src="" alt="ç”¨æˆ¶é ­åƒ" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; object-position: center;">
            <span id="userName" class="user-name"></span>
          </div>
          <div class="auth-buttons" style="display: none;">
              <button id="loginBtn" class="login-btn" onclick="goToLogin()" style="padding: 8px 16px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ” ç™»å…¥</button>
          </div>
        </div>
      </div>

        <!-- é é¢å…§å®¹å€åŸŸ -->
        <div class="page-content">
          <!-- é¦–é  -->
          <div id="homepage" class="page active page-enter">
            <div class="homepage">
              <!-- æœªç™»å…¥ç”¨æˆ¶ï¼ˆè¨ªå®¢ï¼‰è¦–åœ– - é¡¯ç¤º index_unsubscribed.html çš„å…§å®¹ -->
              <div id="homepage-unsubscribed" class="homepage-view" style="display: none;">
              <!-- Hero Section: ç™½ï¼‹è—å†·ç³»ï½œæ»¿ç‰ˆå…¨å‡ºè¡€ -->
              <section class="rm-hero" style="position: relative; overflow: hidden; padding: 80px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw;">
                <!-- èƒŒæ™¯æ·¡è—å…‰æšˆï¼ˆå¢å¼·æ•ˆæœï¼‰ -->
                <div style="position: absolute; top: -100px; right: 0; width: 800px; height: 800px; background: radial-gradient(circle at 80% 20%, rgba(59,130,246,0.15), transparent 60%); pointer-events: none; z-index: 0;"></div>
                
                <div class="rm-hero-container" style="max-width: 1400px; margin: 0 auto; padding: 0 max(16px, env(safe-area-inset-left)) 0 max(16px, env(safe-area-inset-right)); position: relative; z-index: 1; width: 100%; box-sizing: border-box;">
                  <div class="rm-hero-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 60px; align-items: center; width: 100%; max-width: 100%; box-sizing: border-box;">
                    
                    <!-- å·¦å´ï¼šæ–‡æ¡ˆå€ -->
                    <div style="padding: 20px 0; width: 100%; max-width: 100%; box-sizing: border-box; word-wrap: break-word; word-break: break-word; overflow-wrap: break-word;">
                      <h1 id="hero-title-1" class="rm-hero-title typewriter-title" style="font-size: clamp(2rem, 5vw, 3.5rem); font-weight: 900; color: white; margin-bottom: 20px; line-height: 1.2; letter-spacing: -0.02em; width: 100%; max-width: 100%; box-sizing: border-box; word-wrap: break-word; word-break: break-word; overflow-wrap: break-word; text-shadow: 0 2px 15px rgba(0,0,0,0.15);">
                        <span class="typewriter-text"></span><span class="typewriter-cursor">|</span>
                      </h1>
                      <p style="font-size: clamp(1rem, 2vw, 1.25rem); color: white; margin-bottom: 32px; line-height: 1.7; width: 100%; max-width: 100%; box-sizing: border-box; word-wrap: break-word; word-break: break-word; overflow-wrap: break-word; text-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                        AI ç”Ÿæˆè…³æœ¬ã€AI å¸³è™Ÿå®šä½ï¼Œä¸€æ¬¡å®Œæˆã€‚
                      </p>
                      <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 24px;">
                        <a href="#" onclick="goToPricing(); return false;" style="padding: 16px 24px; background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; border-radius: 12px; font-weight: 700; text-decoration: none; box-shadow: 0 4px 20px rgba(16,185,129,0.3); transition: all 0.3s; font-size: 0.9rem; min-height: 48px; display: inline-flex; align-items: center; justify-content: center; flex: 1; position: relative; overflow: hidden;">
                          ç«‹å³å•Ÿç”¨<br>AI æ™ºèƒ½é«”
                        </a>
                        <a href="#rm-overview-v2" onclick="smoothScrollTo('rm-overview-v2'); return false;" style="padding: 16px 24px; background: rgba(255,255,255,0.95); color: #2563EB; border: 2px solid rgba(255,255,255,0.5); border-radius: 12px; font-weight: 600; text-decoration: none; transition: all 0.3s; font-size: 0.9rem; min-height: 48px; display: inline-flex; align-items: center; justify-content: center; flex: 1; position: relative; overflow: hidden; backdrop-filter: blur(10px);">
                          äº†è§£ä½¿ç”¨æ–¹å¼
                        </a>
                      </div>
                    </div>
                    
                    <!-- å³å´ï¼šå½±ç‰‡é è¦½ -->
                    <div style="position: relative;">
                      <div style="aspect-ratio: 16/9; background: #E2E8F0; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05);">
                        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/@AgentAi" title="ReelMind Demo" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="display: block;"></iframe>
                      </div>
                    </div>
                    
                  </div>
                </div>
              </section>

              <!-- ä¸‰åŠŸèƒ½å¡å€ï¼ˆä¿ç•™åŸæœ‰ DOM èˆ‡äº‹ä»¶ï¼‰ -->

              <!-- ReelMind èƒ½ç‚ºä½ åšä»€éº¼ï¼Ÿå…¨æ–°è¨­è¨ˆç‰ˆ -->
              <section id="rm-overview-v2" style="background: white; padding: 100px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw; position: relative; overflow: hidden;">
                <!-- èƒŒæ™¯è£é£¾ -->
                <div style="position: absolute; inset: 0; background: linear-gradient(to bottom right, #EFF6FF, white, #F0FDF4); opacity: 0.5;"></div>
                <div style="position: absolute; top: 0; left: 0; width: 384px; height: 384px; background: #DBEAFE; border-radius: 50%; filter: blur(96px); opacity: 0.3;"></div>
                <div style="position: absolute; bottom: 0; right: 0; width: 384px; height: 384px; background: #D1FAE5; border-radius: 50%; filter: blur(96px); opacity: 0.3;"></div>
                
                <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px; position: relative; z-index: 10;">
                  <!-- æ¨™é¡Œå€ - å…¨æ–°è¨­è¨ˆ -->
                  <div class="text-center mb-16 md:mb-24">
                    <!-- æ¨™ç±¤å¾½ç«  -->
                    <div class="inline-flex items-center gap-2.5 px-6 py-3 mb-6 bg-gradient-to-r from-blue-50 to-emerald-50 border border-blue-100 rounded-full">
                      <span class="text-xl animate-pulse">âœ¨</span>
                      <span class="text-sm md:text-base font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-emerald-600">
                        å››é …æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸€ç«™å¼çŸ­å½±éŸ³å‰µä½œ
                      </span>
                    </div>
                    
                    <!-- ä¸»æ¨™é¡Œ -->
                    <h2 class="text-4xl md:text-5xl lg:text-6xl font-extrabold mb-6 bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 bg-clip-text text-transparent leading-tight">
                      ReelMind èƒ½ç‚ºä½ åšä»€éº¼ï¼Ÿ
                    </h2>
                    
                    <!-- å‰¯æ¨™é¡Œ -->
                    <p class="text-lg md:text-xl text-gray-600 max-w-4xl mx-auto leading-relaxed px-4">
                      ä»¥ <strong class="text-blue-600">AI é¡§å•å°è©±</strong>ã€<strong class="text-emerald-600">ä¸€éµç”Ÿæˆ</strong>èˆ‡ <strong class="text-purple-600">IP äººè¨­è¦åŠƒ</strong>ï¼Œå”åŠ©å°ç£å‰µä½œè€…å»ºç«‹é«˜æ•ˆç‡çš„çŸ­å½±éŸ³å…§å®¹ç³»çµ±ã€‚è®“æ¯æ¬¡å‰µä½œéƒ½æœ‰ç­–ç•¥ã€æ¯æ¬¡ç™¼å¸ƒéƒ½æœ‰è½‰æ›ã€‚
                    </p>
                    
                    <!-- è£é£¾ç·š -->
                    <div class="flex items-center justify-center gap-4 mt-8">
                      <div class="w-16 h-0.5 bg-gradient-to-r from-transparent to-blue-400"></div>
                      <div class="w-2 h-2 rounded-full bg-blue-500"></div>
                      <div class="w-24 h-0.5 bg-gradient-to-r from-blue-400 to-emerald-400"></div>
                      <div class="w-2 h-2 rounded-full bg-emerald-500"></div>
                      <div class="w-16 h-0.5 bg-gradient-to-r from-emerald-400 to-transparent"></div>
                    </div>
                  </div>
                  
                  <!-- å››å¼µåŠŸèƒ½å¡ - å…¨æ–°ç¶²æ ¼è¨­è¨ˆ -->
                  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 md:gap-8 mb-16">
                    
                    <!-- å¡ç‰‡ 1: AI é¡§å• -->
                    <div class="group relative bg-white border-2 border-transparent hover:border-blue-200 rounded-3xl p-8 shadow-sm hover:shadow-2xl transition-all duration-500 hover:-translate-y-2 transform overflow-hidden">
                      <!-- èƒŒæ™¯å…‰æ•ˆ -->
                      <div class="absolute inset-0 bg-gradient-to-br from-blue-50/0 to-blue-50/100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                      
                      <!-- åœ–æ¨™å€ -->
                      <div class="relative z-10 flex items-center justify-center w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-blue-100 to-blue-200 rounded-2xl group-hover:scale-110 transition-transform duration-500">
                        <i class="fas fa-user-md text-4xl text-blue-600"></i>
                      </div>
                      
                      <!-- å…§å®¹å€ -->
                      <div class="relative z-10">
                        <!-- å°æ¨™ç±¤ -->
                        <div class="inline-block px-3 py-1 mb-4 bg-blue-100 text-blue-700 text-xs font-bold rounded-full">
                          AI é¡§å•
                        </div>
                        
                        <h3 class="text-xl font-bold text-gray-900 mb-3 leading-tight group-hover:text-blue-600 transition-colors">
                          å¾å•é¡Œåˆ°è§£æ³•
                        </h3>
                        
                        <p class="text-sm text-gray-600 mb-6 leading-relaxed">
                          èˆ‡ AI é¡§å•æ·±åº¦å°è©±ï¼Œé‡æ¸…ä½ çš„ç›®æ¨™ã€å—çœ¾ã€å…§å®¹æ–¹å‘èˆ‡è®Šç¾ç­–ç•¥ï¼›å³æ™‚çµ¦å‡ºå¯åŸ·è¡Œçš„ä¸‹ä¸€æ­¥ã€‚
                        </p>
                        
                        <!-- åˆ—è¡¨ -->
                        <ul class="space-y-3 mb-6">
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-blue-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">è¨ºæ–·ç—›é»èˆ‡ç›®æ¨™å°é½Šï¼ˆå°ç£å¸‚å ´èªæ°£ï¼‰</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-blue-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">æ‹†è§£å…§å®¹æ”¯æŸ±èˆ‡æµé‡ç¯€å¥</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-blue-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">ç”¢å‡ºå…·é«”è¡Œå‹•æ¸…å–®ï¼ˆä»Šå¤©å°±èƒ½åšï¼‰</span>
                          </li>
                        </ul>
                        
                        <!-- åº•éƒ¨é€£çµ -->
                        <div class="flex items-center gap-2 text-xs font-semibold text-blue-600 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                          <span>äº†è§£æ›´å¤š</span>
                          <span class="text-lg">â†’</span>
                        </div>
                      </div>
                    </div>
                    
                    <!-- å¡ç‰‡ 2: ä¸€éµç”Ÿæˆ -->
                    <div class="group relative bg-white border-2 border-transparent hover:border-emerald-200 rounded-3xl p-8 shadow-sm hover:shadow-2xl transition-all duration-500 hover:-translate-y-2 transform overflow-hidden">
                      <!-- èƒŒæ™¯å…‰æ•ˆ -->
                      <div class="absolute inset-0 bg-gradient-to-br from-emerald-50/0 to-emerald-50/100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                      
                      <!-- åœ–æ¨™å€ -->
                      <div class="relative z-10 flex items-center justify-center w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-emerald-100 to-emerald-200 rounded-2xl group-hover:scale-110 transition-transform duration-500">
                        <i class="fas fa-magic text-4xl text-emerald-600"></i>
                      </div>
                      
                      <!-- å…§å®¹å€ -->
                      <div class="relative z-10">
                        <!-- å°æ¨™ç±¤ -->
                        <div class="inline-block px-3 py-1 mb-4 bg-emerald-100 text-emerald-700 text-xs font-bold rounded-full">
                          ä¸€éµç”Ÿæˆ
                        </div>
                        
                        <h3 class="text-xl font-bold text-gray-900 mb-3 leading-tight group-hover:text-emerald-600 transition-colors">
                          ç›´æ¥å¯ç”¨çš„è…³æœ¬
                        </h3>
                        
                        <p class="text-sm text-gray-600 mb-6 leading-relaxed">
                          è¼¸å…¥å¹³å°èˆ‡ä¸»é¡Œï¼Œç«‹å³ç”¢å‡º<strong class="text-emerald-600">Hook é–‹å ´ã€å£æ’­æ–‡å­—ã€é¡é ­æŒ‡ç¤º</strong>èˆ‡ä¸Šç‰‡å»ºè­°ï¼›å¯é‡ç”Ÿç›´åˆ°æ»¿æ„ã€‚
                        </p>
                        
                        <!-- åˆ—è¡¨ -->
                        <ul class="space-y-3 mb-6">
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-emerald-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">60 ç§’å…§å®ŒæˆçŸ­å½±éŸ³è…³æœ¬</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-emerald-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">è‡ªå‹•é™„ CTA èˆ‡æƒ…ç·’ç¯€å¥</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-emerald-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">æ”¯æ´ IG / TikTok / Shorts è¦æ ¼</span>
                          </li>
                        </ul>
                        
                        <!-- åº•éƒ¨é€£çµ -->
                        <div class="flex items-center gap-2 text-xs font-semibold text-emerald-600 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                          <span>äº†è§£æ›´å¤š</span>
                          <span class="text-lg">â†’</span>
                        </div>
                      </div>
                    </div>
                    
                    <!-- å¡ç‰‡ 3: IP äººè¨­è¦åŠƒ -->
                    <div class="group relative bg-white border-2 border-transparent hover:border-purple-200 rounded-3xl p-8 shadow-sm hover:shadow-2xl transition-all duration-500 hover:-translate-y-2 transform overflow-hidden">
                      <!-- èƒŒæ™¯å…‰æ•ˆ -->
                      <div class="absolute inset-0 bg-gradient-to-br from-purple-50/0 to-purple-50/100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                      
                      <!-- åœ–æ¨™å€ -->
                      <div class="relative z-10 flex items-center justify-center w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-purple-100 to-purple-200 rounded-2xl group-hover:scale-110 transition-transform duration-500">
                        <i class="fas fa-id-card text-4xl text-purple-600"></i>
                      </div>
                      
                      <!-- å…§å®¹å€ -->
                      <div class="relative z-10">
                        <!-- å°æ¨™ç±¤ -->
                        <div class="inline-block px-3 py-1 mb-4 bg-purple-100 text-purple-700 text-xs font-bold rounded-full">
                          IP äººè¨­
                        </div>
                        
                        <h3 class="text-xl font-bold text-gray-900 mb-3 leading-tight group-hover:text-purple-600 transition-colors">
                          å»ºç«‹ä½ çš„å°ˆå±¬è²éŸ³
                        </h3>
                        
                        <p class="text-sm text-gray-600 mb-6 leading-relaxed">
                          é€éä¸€ç³»åˆ—è¨ªè«‡é¡Œï¼Œå»ºç«‹ IP Profileï¼ˆäººæ ¼ç‰¹è³ªã€èªæ°£è¨­å®šã€å…§å®¹é‚è¼¯ï¼‰ï¼Œä¸¦é™„ 14 å¤©å…§å®¹è¦åŠƒã€‚
                        </p>
                        
                        <!-- åˆ—è¡¨ -->
                        <ul class="space-y-3 mb-6">
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-purple-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">IP Profile + 14 å¤©è¦åŠƒ</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-purple-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">å“ç‰Œèªæ°£èˆ‡èªªè©±é¢¨æ ¼ç”Ÿæˆ</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-purple-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">å¯æŒçºŒå„ªåŒ–èˆ‡è¿­ä»£</span>
                          </li>
                        </ul>
                        
                        <!-- åº•éƒ¨é€£çµ -->
                        <div class="flex items-center gap-2 text-xs font-semibold text-purple-600 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                          <span>äº†è§£æ›´å¤š</span>
                          <span class="text-lg">â†’</span>
                        </div>
                      </div>
                    </div>
                    
                    <!-- å¡ç‰‡ 4: å‰µä½œè€…è³‡æ–™åº« -->
                    <div class="group relative bg-white border-2 border-transparent hover:border-orange-200 rounded-3xl p-8 shadow-sm hover:shadow-2xl transition-all duration-500 hover:-translate-y-2 transform overflow-hidden">
                      <!-- èƒŒæ™¯å…‰æ•ˆ -->
                      <div class="absolute inset-0 bg-gradient-to-br from-orange-50/0 to-orange-50/100 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                      
                      <!-- åœ–æ¨™å€ -->
                      <div class="relative z-10 flex items-center justify-center w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-orange-100 to-orange-200 rounded-2xl group-hover:scale-110 transition-transform duration-500">
                        <i class="fas fa-database text-4xl text-orange-600"></i>
                      </div>
                      
                      <!-- å…§å®¹å€ -->
                      <div class="relative z-10">
                        <!-- å°æ¨™ç±¤ -->
                        <div class="inline-block px-3 py-1 mb-4 bg-orange-100 text-orange-700 text-xs font-bold rounded-full">
                          å‰µä½œè€…è³‡æ–™åº«
                        </div>
                        
                        <h3 class="text-xl font-bold text-gray-900 mb-3 leading-tight group-hover:text-orange-600 transition-colors">
                          ä½œå“æ•´åˆèˆ‡å†åˆ©ç”¨
                        </h3>
                        
                        <p class="text-sm text-gray-600 mb-6 leading-relaxed">
                          ä½ çš„æ¯ä¸€æ¬¡ç”Ÿæˆï¼ˆè…³æœ¬ã€é¸é¡Œã€å®šä½ï¼‰éƒ½æœƒè‡ªå‹•æ­¸æª”æ–¼å€‹äººè³‡æ–™åº«ï¼›æ”¯æ´ PDF / CSV ä¸‹è¼‰ã€ç‰ˆæœ¬é‡ç”Ÿèˆ‡æ¨™è¨»ã€‚
                        </p>
                        
                        <!-- åˆ—è¡¨ -->
                        <ul class="space-y-3 mb-6">
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-orange-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">æˆ‘çš„è…³æœ¬ï¼šåˆ†é¡ã€å£æ’­ã€CTA ä¸€æ¬¡çœ‹</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-orange-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">ä¸€éµä¸‹è¼‰ï¼ˆPDFï¼CSVï¼‰èˆ‡é‡ç”Ÿ</span>
                          </li>
                          <li class="flex items-start gap-3 text-sm">
                            <span class="text-orange-500 text-lg mt-0 flex-shrink-0">âœ“</span>
                            <span class="text-gray-700">å¯è¦–åŒ–æ¸…å–®ï¼Œæ–¹ä¾¿æ•´ç†èˆ‡å›é¡§</span>
                          </li>
                        </ul>
                        
                        <!-- åº•éƒ¨é€£çµ -->
                        <div class="flex items-center gap-2 text-xs font-semibold text-orange-600 opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                          <span>äº†è§£æ›´å¤š</span>
                          <span class="text-lg">â†’</span>
                        </div>
                      </div>
                    </div>
                    
                  </div>
                  
                  <!-- åº•éƒ¨ CTA å€ - å…¨æ–°è¨­è¨ˆ -->
                  <div class="relative">
                    <div class="bg-gradient-to-r from-yellow-50 via-orange-50 to-yellow-50 rounded-3xl p-8 md:p-12 border-2 border-yellow-200 shadow-xl">
                      <!-- å»ºè­°æ–‡å­— -->
                      <div class="text-center mb-10">
                        <p class="text-base md:text-lg text-gray-800 mb-2">
                          <i class="fas fa-lightbulb text-2xl text-orange-600"></i>
                        </p>
                        <p class="text-base md:text-lg text-gray-800 font-medium">
                          <strong class="text-orange-700">å»ºè­°ä½¿ç”¨é †åºï¼š</strong>å…ˆåš IP äººè¨­ â†’ å–å¾— 14 å¤©è¦åŠƒ â†’ æ¯æ—¥ä½¿ç”¨ä¸€éµç”Ÿæˆã€‚AI æœƒè¨˜ä½ä½ ä¹‹å‰çš„å…§å®¹ä¸¦æŒçºŒå„ªåŒ–ã€‚
                        </p>
                      </div>
                      
                      <!-- CTA æŒ‰éˆ• -->
                      <div class="flex justify-center">
                        <a href="#" onclick="goToLogin(); return false;" class="group inline-flex items-center gap-4 px-10 md:px-14 py-5 md:py-6 bg-gradient-to-r from-orange-500 via-orange-500 to-yellow-500 text-white rounded-2xl font-bold text-lg md:text-xl shadow-lg hover:shadow-2xl hover:shadow-orange-500/50 hover:scale-105 transition-all duration-300 transform">
                          <i class="fas fa-lock-open text-2xl"></i>
                          <span>ç™»å…¥è§£é–ä½ çš„å°ˆå±¬ AI æ™ºèƒ½é«”</span>
                          <span class="text-3xl group-hover:translate-x-1 transition-transform">â†’</span>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </section>
              
              <!-- æ•™å­¸æ–‡ç«  / å¯¦æˆ°æŒ‡å—å€ï¼ˆå–ä»£ã€Œç²¾å½©ä½œå“å±•ç¤ºã€ï¼‰-->
              <section class="rm-guide-section" style="background: #F8FAFC; padding: 100px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw;">
                <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px;">
                  <div style="text-align: center; margin-bottom: 60px;">
                    <h2 style="font-size: clamp(2rem, 4vw, 2.8rem); font-weight: 800; color: #1E293B; margin-bottom: 16px;"><i class="fas fa-book-open" style="margin-right: 10px;"></i>AI çŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—</h2>
                    <p style="font-size: 1.1rem; color: #64748B; max-width: 600px; margin: 0 auto;">å­¸ç¿’å¦‚ä½•ç”¨ AI æ‰“é€ çˆ†æ¬¾çŸ­å½±éŸ³å…§å®¹</p>
                </div>
                  
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 32px; margin-top: 40px;">
                    <!-- æ–‡ç«  1 -->
                    <a onclick="switchPage('guide-article1'); return false;" style="text-decoration: none; display: block; cursor: pointer;">
                      <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; display: flex; flex-direction: column; height: 100%;">
                        <div style="padding: 32px; border-bottom: 1px solid #F1F5F9; flex: 1 1 auto;">
                          <div style="font-size: 1.25rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">ä¸‰æ­¥ç”Ÿæˆ 30 ç§’çŸ­å½±éŸ³è…³æœ¬</div>
                          <div style="font-size: 0.95rem; color: #64748B; line-height: 1.6;">
                            åªéœ€ä¸‰æ­¥ï¼šè¨­å®šå¹³å°èˆ‡ä¸»é¡Œã€AI ç”ŸæˆåŠ‡æœ¬å¤§ç¶±ã€ç¢ºèªä¸¦å„²å­˜ã€‚æœ¬æ•™å­¸å°‡ç¤ºç¯„å®Œæ•´æµç¨‹ï¼Œå¹«ä½ åœ¨ 5 åˆ†é˜å…§ç”¢å‡º Instagram Reels è…³æœ¬...
                </div>
                </div>
                        <div style="padding: 20px 32px; background: #F8FAFC;">
                          <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
              </div>
                      </div>
                    </a>
                    
                    <!-- æ–‡ç«  2 -->
                    <a onclick="switchPage('guide-article2'); return false;" style="text-decoration: none; display: block; cursor: pointer;">
                      <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; display: flex; flex-direction: column; height: 100%;">
                        <div style="padding: 32px; border-bottom: 1px solid #F1F5F9; flex: 1 1 auto;">
                          <div style="font-size: 1.25rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">AI å¸³è™Ÿå®šä½ï¼šå…§å®¹æ”¯æŸ±èˆ‡ 14 å¤©è¨ˆç•«</div>
                          <div style="font-size: 0.95rem; color: #64748B; line-height: 1.6;">
                            äº†è§£å¦‚ä½•ç”¨ AI åˆ†æä½ çš„å…§å®¹å®šä½ï¼Œä¸¦è‡ªå‹•ç”Ÿæˆ 14 å¤©ç™¼å¸ƒè¨ˆç•«ã€‚åŒ…å«å…§å®¹æ”¯æŸ±ï¼ˆæ•™è‚²ã€å¨›æ¨‚ã€å•Ÿç™¼ã€æˆäº¤ï¼‰èˆ‡æ’ç¨‹å»ºè­°...
                          </div>
                        </div>
                        <div style="padding: 20px 32px; background: #F8FAFC;">
                          <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                        </div>
                      </div>
                    </a>
                    
                    <!-- æ–‡ç«  3 -->
                    <a onclick="switchPage('guide-article3'); return false;" style="text-decoration: none; display: block; cursor: pointer;">
                      <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; display: flex; flex-direction: column; height: 100%;">
                        <div style="padding: 32px; border-bottom: 1px solid #F1F5F9; flex: 1 1 auto;">
                          <div style="font-size: 1.25rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">Reels / Shorts / TikTok<br>è…³æœ¬å·®ç•°</div>
                          <div style="font-size: 0.95rem; color: #64748B; line-height: 1.6;">
                            æ¯å€‹å¹³å°çš„çŸ­å½±éŸ³éƒ½æœ‰ä¸åŒç‰¹æ€§ï¼šIG Reels åé‡å“ç‰Œæ•˜äº‹ï¼ŒYouTube Shorts å¼·èª¿å¿«é€Ÿçˆ†é»ï¼ŒTikTok é‡è¦–å¨›æ¨‚æ€§ã€‚æœ¬æŒ‡å—è§£æ AI å¦‚ä½•è‡ªå‹•èª¿æ•´...
                          </div>
                        </div>
                        <div style="padding: 20px 32px; background: #F8FAFC;">
                          <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                        </div>
                      </div>
                    </a>
                  </div>
                </div>
              </section>

              <!-- åˆ¥äººæ€éº¼ç”¨ - å…©å€‹å€å¡Š -->
              <section class="user-story-section" style="background: white; padding: 100px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw;">
                <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px;">
                  <div style="text-align: center; margin-bottom: 60px;">
                    <h2 style="font-size: clamp(2rem, 4vw, 2.8rem); font-weight: 800; color: #1E293B; margin-bottom: 16px;">
                      <i class="fas fa-users" style="margin-right: 10px; color: #3B82F6;"></i>åˆ¥äººæ€éº¼ç”¨
                    </h2>
                    <p style="font-size: 1.1rem; color: #64748B; max-width: 600px; margin: 0 auto;">
                      çœ‹çœ‹å…¶ä»–å‰µä½œè€…å¦‚ä½•ç”¨ ReelMind æ‰“é€ çˆ†æ¬¾å…§å®¹
                    </p>
                  </div>
                  
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 32px; margin-top: 40px;">
                    <!-- ä½¿ç”¨æ¡ˆä¾‹ 1 -->
                    <div class="user-story-card">
                      <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                        <img src="https://ui-avatars.com/api/?name=Nick+Wu&background=3B82F6&color=fff&size=128&bold=true" alt="Nick Wu" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid #E5E7EB;" />
                        <div>
                          <div style="font-size: 1.1rem; font-weight: 700; color: #1E293B; margin-bottom: 4px;">Nick Wuï½œè¡ŒéŠ·é¡§å•</div>
                          <div style="font-size: 0.9rem; color: #64748B;">ä½¿ç”¨ ReelMind 3 å€‹æœˆ</div>
                        </div>
                      </div>
                      <div style="font-size: 1rem; color: #475569; line-height: 1.8; margin-bottom: 20px; word-wrap: break-word; word-break: break-word; overflow-wrap: break-word; width: 100%; max-width: 100%; box-sizing: border-box;">
                        ã€Œä¹‹å‰æ¯å¤©è¦èŠ± 2-3 å°æ™‚æƒ³è…³æœ¬ï¼Œç¾åœ¨ç”¨ ReelMind ä¸€éµç”Ÿæˆï¼Œ5 åˆ†é˜å°±æå®šã€‚æœ€æ£’çš„æ˜¯ AI æœƒè¨˜ä½æˆ‘çš„å“ç‰Œèª¿æ€§ï¼Œæ¯æ¬¡ç”Ÿæˆçš„å…§å®¹éƒ½å¾ˆç¬¦åˆæˆ‘çš„é¢¨æ ¼ã€‚ä¸Šå€‹æœˆ IG Reels çš„è§€çœ‹æ¬¡æ•¸æå‡äº† 180%ï¼ã€
                      </div>
                      <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <span style="padding: 6px 12px; background: #EFF6FF; color: #2563EB; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">#ä¸€éµç”Ÿæˆ</span>
                        <span style="padding: 6px 12px; background: #F0FDF4; color: #059669; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">#IG Reels</span>
                        <span style="padding: 6px 12px; background: #FEF3C7; color: #D97706; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">#è§€çœ‹æå‡ 180%</span>
                      </div>
                    </div>
                    
                    <!-- ä½¿ç”¨æ¡ˆä¾‹ 2 -->
                    <div class="user-story-card">
                      <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                        <img src="https://ui-avatars.com/api/?name=æç¾è¯&background=10B981&color=fff&size=128&bold=true" alt="æç¾è¯" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid #E5E7EB;" />
                        <div>
                          <div style="font-size: 1.1rem; font-weight: 700; color: #1E293B; margin-bottom: 4px;">æç¾è¯ï½œå…§å®¹å‰µä½œè€…</div>
                          <div style="font-size: 0.9rem; color: #64748B;">ä½¿ç”¨ ReelMind 6 å€‹æœˆ</div>
                        </div>
                      </div>
                      <div style="font-size: 1rem; color: #475569; line-height: 1.8; margin-bottom: 20px; word-wrap: break-word; word-break: break-word; overflow-wrap: break-word; width: 100%; max-width: 100%; box-sizing: border-box;">
                        ã€ŒIP äººè¨­è¦åŠƒåŠŸèƒ½å¹«æˆ‘å»ºç«‹äº†å®Œæ•´çš„å…§å®¹ç­–ç•¥ï¼Œ14 å¤©è¦åŠƒè®“æˆ‘çŸ¥é“æ¯å¤©è¦ç™¼ä»€éº¼ã€‚ç¾åœ¨æ¯é€±å›ºå®šä¸Šç‰‡ 5-7 æ”¯ï¼Œç²‰çµ²äº’å‹•ç‡æå‡äº† 3 å€ã€‚æœ€å–œæ­¡çš„æ˜¯ AI é¡§å•åŠŸèƒ½ï¼Œå¯ä»¥éš¨æ™‚è¨è«–å…§å®¹æ–¹å‘ï¼Œå°±åƒæœ‰å€‹å°ˆæ¥­é¡§å•åœ¨èº«é‚Šã€‚ã€
                      </div>
                      <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <span style="padding: 6px 12px; background: #F3E8FF; color: #7C3AED; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">#IPäººè¨­è¦åŠƒ</span>
                        <span style="padding: 6px 12px; background: #EFF6FF; color: #2563EB; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">#AIé¡§å•</span>
                        <span style="padding: 6px 12px; background: #FEF3C7; color: #D97706; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">#äº’å‹•ç‡æå‡ 3 å€</span>
                      </div>
                    </div>
                  </div>
                </div>
              </section>

              <!-- è¨‚é–± CTA å€ï¼ˆè—ç³»æ¼¸å±¤ï½œæ»¿ç‰ˆï½œæ¡Œæ©Ÿæ©«å¼ï½œæ‰‹æ©Ÿç›´å¼ï¼‰ -->
              <section id="subscription-cta" class="rm-pricing" style="background: linear-gradient(to bottom right, #3B82F6 0%, #1D4ED8 100%); padding: 100px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw; position: relative; overflow: hidden;">
                <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px;">
                  <div style="text-align: center; margin-bottom: 60px;">
                    <h2 class="subscription-title" style="font-size: clamp(2rem, 5vw, 3rem); font-weight: 800; color: white; margin-bottom: 20px; text-shadow: 0 2px 20px rgba(0,0,0,0.1);">
                      ç”¨ AI æ™ºèƒ½é«”ï¼Œæ‰“é€ ä½ çš„çˆ†æ¬¾çŸ­å½±éŸ³
                    </h2>
                    <p class="subscription-subtitle" style="font-size: 1.1rem; color: rgba(255,255,255,0.9); max-width: 600px; margin: 0 auto;">
                      æ¯å¤©ä¸åˆ° NT$66ï¼Œå…¨å¹´ AI å¹«ä½ å¸³è™Ÿå®šä½ã€ç”Ÿæˆéˆæ„Ÿé¸é¡Œèˆ‡çˆ†æ¬¾è…³æœ¬
                    </p>
                  </div>
                  
                  <!-- å®šåƒ¹å¡ç‰‡ï¼ˆæ¡Œæ©Ÿæ©«å¼ï¼æ‰‹æ©Ÿç›´å¼ï¼‰ -->
                  <div class="rm-pricing-cards" style="display: flex; gap: 32px; justify-content: center; flex-wrap: wrap; margin-bottom: 60px; padding: 0 20px;">
                    <!-- æœˆè²»å¡ -->
                    <div style="flex: 0 1 320px; max-width: 380px; padding: 40px; background: rgba(255,255,255,0.15); backdrop-filter: blur(20px); border-radius: 24px; border: 2px solid rgba(255,255,255,0.3); transition: all 0.3s; display: flex; flex-direction: column;">
                      <div style="font-size: 1rem; color: rgba(255,255,255,0.9); margin-bottom: 12px; font-weight: 600;">æœˆè²»æ–¹æ¡ˆ</div>
                      <div style="display: flex; align-items: flex-end; flex-wrap: nowrap; gap: 4px; margin-bottom: 8px;">
                        <div style="font-size: 2.5rem; font-weight: 800; color: white; line-height: 1;">NT$2,480</div>
                        <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8); flex-shrink: 0;">/æœˆ</div>
                      </div>
                      <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8); margin-bottom: 16px;">å½ˆæ€§æ–¹æ¡ˆï¼Œé©åˆçŸ­æœŸä½¿ç”¨è€…</div>
                      <a href="#" onclick="handleSubscriptionClick('monthly'); return false;" style="display: block; margin-top: auto; padding: 0 32px; background: white; color: #2563EB; border-radius: 12px; font-weight: 700; text-decoration: none; transition: all 0.3s; text-align: center; height: 56px; display: flex; align-items: center; justify-content: center;">
                        ç«‹å³è¨‚é–±
                      </a>
                    </div>
                    
                    <!-- å¹´è²»å¡ï¼ˆæœ€åˆ’ç®—ï¼‰ -->
                    <div style="flex: 0 1 320px; max-width: 380px; padding: 40px; background: rgba(255,255,255,0.95); border-radius: 24px; border: 2px solid rgba(255,255,255,0.5); box-shadow: 0 20px 60px rgba(0,0,0,0.2); position: relative; transition: all 0.3s; display: flex; flex-direction: column;">
                      <div style="position: absolute; top: -16px; left: 50%; transform: translateX(-50%); padding: 8px 24px; background: linear-gradient(135deg, #FBBF24 0%, #F59E0B 100%); color: white; border-radius: 20px; font-size: 0.9rem; font-weight: 700; box-shadow: 0 4px 12px rgba(251,191,36,0.3);">
                        ğŸ”¥ æœ€å¤šäººé¸æ“‡
                      </div>
                      <div style="font-size: 1rem; color: #64748B; margin-bottom: 12px; font-weight: 600; margin-top: 12px;">å¹´è²»æ–¹æ¡ˆ</div>
                      <div style="display: flex; align-items: flex-end; flex-wrap: nowrap; gap: 4px; margin-bottom: 8px;">
                        <div style="font-size: 2.5rem; font-weight: 800; background: linear-gradient(135deg, #10B981 0%, #059669 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1;">NT$23,760</div>
                        <div style="font-size: 0.9rem; color: #94A3B8; flex-shrink: 0; margin-bottom: 0.3rem;">/å¹´</div>
                      </div>
                      <div style="font-size: 0.9rem; color: #10B981; font-weight: 600; margin-bottom: 4px;">å¹³å‡æ¯æœˆ NT$1,980</div>
                      <div style="font-size: 0.9rem; color: #94A3B8; margin-bottom: 16px;">ç¯€çœ NT$5,000ï¼ˆ20% OFFï¼‰</div>
                      <a href="#" onclick="handleSubscriptionClick('yearly'); return false;" style="display: block; margin-top: auto; padding: 0 32px; background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; border-radius: 12px; font-weight: 700; text-decoration: none; box-shadow: 0 4px 20px rgba(16,185,129,0.3); transition: all 0.3s; text-align: center; height: 56px; display: flex; align-items: center; justify-content: center;">
                        ç«‹å³è¨‚é–±
                      </a>
                    </div>
                    
                    <!-- å®¢è£½åŒ–å¡ -->
                    <div style="flex: 0 1 320px; max-width: 380px; padding: 40px; background: rgba(255,255,255,0.15); backdrop-filter: blur(20px); border-radius: 24px; border: 2px solid rgba(255,255,255,0.3); transition: all 0.3s; display: flex; flex-direction: column;">
                      <div style="font-size: 1rem; color: rgba(255,255,255,0.9); margin-bottom: 12px; font-weight: 600; text-align: center;">å®¢è£½åŒ–æ–¹æ¡ˆ</div>
                      <div style="display: flex; align-items: flex-end; justify-content: center; flex-wrap: nowrap; gap: 4px; margin-bottom: 8px;">
                        <div style="font-size: 2rem; font-weight: 800; color: white; line-height: 1; text-align: center;">å®¢è£½å ±åƒ¹</div>
                      </div>
                      <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8); margin-bottom: 16px; text-align: center;">å“ç‰Œï¼åœ˜éšŠåˆä½œæ•´åˆæ–¹æ¡ˆ</div>
                      <a href="contact.html" style="display: block; margin-top: auto; padding: 0 32px; background: white; color: #2563EB; border-radius: 12px; font-weight: 700; text-decoration: none; transition: all 0.3s; text-align: center; height: 56px; display: flex; align-items: center; justify-content: center;">
                        è¯ç¹«æˆ‘å€‘
                      </a>
                    </div>
                  </div>
                  
                  <!-- åƒ¹å€¼æ‰¿è«¾ -->
                  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 32px; margin-top: 60px; padding: 0 20px;">
                    <div style="padding: 32px; background: rgba(255,255,255,0.15); backdrop-filter: blur(20px); border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">
                      <div style="font-size: 3rem; margin-bottom: 16px;">âš¡</div>
                      <div style="font-weight: 700; margin-bottom: 8px; color: white; font-size: 1.1rem;">ç”¢å‡ºæ™‚é–“æ¸›å°‘ 70%</div>
                      <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">AI è‡ªå‹•ç”Ÿæˆè…³æœ¬ï¼Œå¾å°æ™‚ç¸®çŸ­åˆ°åˆ†é˜</div>
                    </div>
                    <div style="padding: 32px; background: rgba(255,255,255,0.15); backdrop-filter: blur(20px); border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">
                      <div style="font-size: 3rem; margin-bottom: 16px;">ğŸ“ˆ</div>
                      <div style="font-weight: 700; margin-bottom: 8px; color: white; font-size: 1.1rem;">ä¸Šç‰‡é »ç‡æå‡ 200%</div>
                      <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">ä¸€éµç”Ÿæˆï¼Œä¸å†ç‚ºå…§å®¹ç™¼æ„</div>
                    </div>
                    <div style="padding: 32px; background: rgba(255,255,255,0.15); backdrop-filter: blur(20px); border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); text-align: center;">
                      <div style="font-size: 3rem; margin-bottom: 16px;">ğŸ§ </div>
                      <div style="font-weight: 700; margin-bottom: 8px; color: white; font-size: 1.1rem;">æ™ºèƒ½å­¸ç¿’</div>
                      <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">AI æœƒè¨˜ä½ä½ çš„å…§å®¹é¢¨æ ¼ä¸¦æŒçºŒå„ªåŒ–</div>
                    </div>
                  </div>
                </div>
              </section>
              
              <!-- Footerï¼ˆGEOï¼‹SEOï¼‰ -->
              <section class="rm-footer" style="background: #EFF6FF; padding: 60px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw;">
                <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                  <div style="font-size: 1.1rem; font-weight: 600; color: #1E293B; margin-bottom: 12px; text-align: center; width: 100%;">
                    AIJob æ™ºèƒ½é«” |  ReelMind |AIJobå­¸é™¢
                  </div>
                  <div style="font-size: 0.9rem; color: #94A3B8; font-weight: 500; text-align: center; width: 100%; margin-bottom: 16px;">
                    ReelMind â€” ç‚ºäºæ´²å‰µä½œè€…æ‰“é€ çš„ AI çŸ­å½±éŸ³æ™ºèƒ½é«”
                  </div>
                  
                </div>
              </section>

              </div>
              <!-- å·²ç™»å…¥ç”¨æˆ¶ï¼ˆå·²è¨‚é–±ï¼‰è¦–åœ– - é¡¯ç¤º index_subscribed.html çš„å…§å®¹ -->
              <div id="homepage-subscribed" class="homepage-view" style="display: none;">
                <!-- Hero Section: ç™½ï¼‹è—å†·ç³»ï½œæ»¿ç‰ˆå…¨å‡ºè¡€ -->
                <section class="rm-hero" style="position: relative; overflow: hidden; padding: 80px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw;">
                  <!-- èƒŒæ™¯æ·¡è—å…‰æšˆï¼ˆå¢å¼·æ•ˆæœï¼‰ -->
                  <div style="position: absolute; top: -100px; right: 0; width: 800px; height: 800px; background: radial-gradient(circle at 80% 20%, rgba(59,130,246,0.15), transparent 60%); pointer-events: none; z-index: 0;"></div>
                  
                  <div class="rm-hero-container" style="max-width: 1400px; margin: 0 auto; padding: 0 max(16px, env(safe-area-inset-left)) 0 max(16px, env(safe-area-inset-right)); position: relative; z-index: 1; width: 100%; box-sizing: border-box;">
                    <div class="rm-hero-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 60px; align-items: center; width: 100%; max-width: 100%; box-sizing: border-box;">
                      
                      <!-- å·¦å´ï¼šæ–‡æ¡ˆå€ -->
                      <div style="padding: 20px 0; width: 100%; max-width: 100%; box-sizing: border-box; word-wrap: break-word; word-break: break-word; overflow-wrap: break-word;">
                        <h1 id="hero-title-2" class="rm-hero-title typewriter-title" style="font-size: clamp(2rem, 5vw, 3.5rem); font-weight: 900; color: white; margin-bottom: 20px; line-height: 1.2; letter-spacing: -0.02em; width: 100%; max-width: 100%; box-sizing: border-box; word-wrap: break-word; word-break: break-word; overflow-wrap: break-word; text-shadow: 0 2px 15px rgba(0,0,0,0.15);">
                          <span class="typewriter-text"></span><span class="typewriter-cursor">|</span>
                        </h1>
                        <p style="font-size: clamp(1rem, 2vw, 1.25rem); color: white; margin-bottom: 32px; line-height: 1.7; width: 100%; max-width: 100%; box-sizing: border-box; word-wrap: break-word; word-break: break-word; overflow-wrap: break-word; text-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                          AI ç”Ÿæˆè…³æœ¬ã€AI å¸³è™Ÿå®šä½ï¼Œä¸€æ¬¡å®Œæˆã€‚<br/>
                          <span style="font-size: 0.9em; color: rgba(255,255,255,0.9);">é–‹å§‹ä½ çš„å‰µä½œä¹‹æ—…</span>
                        </p>
                        <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 24px;">
                          <a href="#mode-cards" onclick="smoothScrollTo('mode-cards'); return false;" style="padding: 16px 24px; background: linear-gradient(135deg, #10B981 0%, #059669 100%); color: white; border-radius: 12px; font-weight: 700; text-decoration: none; box-shadow: 0 4px 20px rgba(16,185,129,0.3); transition: all 0.3s; font-size: 0.9rem; min-height: 48px; display: inline-flex; align-items: center; justify-content: center; flex: 1; position: relative; overflow: hidden;">
                            é–‹å§‹ä½¿ç”¨
                          </a>
                          <a href="#introduction" onclick="smoothScrollTo('introduction'); return false;" style="padding: 16px 24px; background: rgba(255,255,255,0.95); color: #2563EB; border: 2px solid rgba(255,255,255,0.5); border-radius: 12px; font-weight: 600; text-decoration: none; transition: all 0.3s; font-size: 0.9rem; min-height: 48px; display: inline-flex; align-items: center; justify-content: center; flex: 1; position: relative; overflow: hidden; backdrop-filter: blur(10px);">
                            äº†è§£å¦‚ä½•é–‹å§‹
                          </a>
                        </div>
                      </div>
                      
                      <!-- å³å´ï¼šå½±ç‰‡é è¦½ -->
                      <div style="position: relative;">
                        <div style="aspect-ratio: 16/9; background: #E2E8F0; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.1); border: 1px solid rgba(0,0,0,0.05);">
                          <iframe width="100%" height="100%" src="https://www.youtube.com/embed/@AgentAi" title="ReelMind Demo" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="display: block;"></iframe>
                        </div>
                      </div>
                      
                    </div>
                  </div>
                </section>

                <!-- ä»‹ç´¹å¦‚ä½•é–‹å§‹ -->
                <section id="introduction" style="background: white; padding: 100px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw;">
                  <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px;">
                    <div style="text-align: center; margin-bottom: 60px;">
                      <h2 style="font-size: clamp(2rem, 4vw, 2.8rem); font-weight: 800; color: #1E293B; margin-bottom: 16px;">
                        <i class="fas fa-rocket" style="margin-right: 10px; color: #3B82F6;"></i>ä»‹ç´¹å¦‚ä½•é–‹å§‹
                      </h2>
                      <p style="font-size: 1.1rem; color: #64748B; max-width: 600px; margin: 0 auto;">
                        ä¸‰å€‹ç°¡å–®æ­¥é©Ÿï¼Œé–‹å§‹ä½ çš„ AI çŸ­å½±éŸ³å‰µä½œä¹‹æ—…
                      </p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 32px; margin-top: 40px;">
                      <!-- æ­¥é©Ÿ 1 -->
                      <div style="background: white; border-radius: 20px; padding: 40px; box-shadow: 0 8px 30px rgba(17,24,39,0.06); border: 1px solid #E2E8F0; text-align: center; position: relative;">
                        <div style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 50px; height: 50px; background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: 700; box-shadow: 0 4px 12px rgba(59,130,246,0.3);">
                          1
                        </div>
                        <div style="margin-top: 30px; margin-bottom: 24px;">
                          <i class="fas fa-magic" style="font-size: 3rem; color: #3B82F6; margin-bottom: 16px;"></i>
                        </div>
                        <h3 style="font-size: 1.5rem; font-weight: 700; color: #1E293B; margin-bottom: 16px;">ä¸€éµç”Ÿæˆè…³æœ¬</h3>
                        <p style="font-size: 1rem; color: #64748B; line-height: 1.7;">
                          ä½¿ç”¨ã€Œä¸€éµç”Ÿæˆæ¨¡å¼ã€ï¼Œè¼¸å…¥å¹³å°èˆ‡ä¸»é¡Œï¼ŒAI æœƒæ ¹æ“šä½ çš„ IP äººè¨­è‡ªå‹•ç”Ÿæˆç¬¦åˆé¢¨æ ¼çš„è…³æœ¬ã€é¸é¡Œèˆ‡å¸³è™Ÿå®šä½å»ºè­°ã€‚
                        </p>
                      </div>
                      
                      <!-- æ­¥é©Ÿ 2 -->
                      <div style="background: white; border-radius: 20px; padding: 40px; box-shadow: 0 8px 30px rgba(17,24,39,0.06); border: 1px solid #E2E8F0; text-align: center; position: relative;">
                        <div style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 50px; height: 50px; background: linear-gradient(135deg, #10B981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: 700; box-shadow: 0 4px 12px rgba(16,185,129,0.3);">
                          2
                        </div>
                        <div style="margin-top: 30px; margin-bottom: 24px;">
                          <i class="fas fa-user-tie" style="font-size: 3rem; color: #10B981; margin-bottom: 16px;"></i>
                        </div>
                        <h3 style="font-size: 1.5rem; font-weight: 700; color: #1E293B; margin-bottom: 16px;">å»ºç«‹ IP äººè¨­</h3>
                        <p style="font-size: 1rem; color: #64748B; line-height: 1.7;">
                          å…ˆä½¿ç”¨ã€ŒIPäººè¨­è¦åŠƒæ¨¡å¼ã€ï¼Œé€éèŠå¤©è¨˜éŒ„ä½ çš„äººç”Ÿæ›²ç·šèˆ‡å“ç‰Œæ•…äº‹ï¼ŒAI æœƒå”åŠ©å»ºç«‹å°ˆå±¬çš„ IP Profile å’Œ 14 å¤©å…§å®¹è¦åŠƒã€‚
                        </p>
                      </div>
                      
                      <!-- æ­¥é©Ÿ 3 -->
                      <div style="background: white; border-radius: 20px; padding: 40px; box-shadow: 0 8px 30px rgba(17,24,39,0.06); border: 1px solid #E2E8F0; text-align: center; position: relative;">
                        <div style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 50px; height: 50px; background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: 700; box-shadow: 0 4px 12px rgba(139,92,246,0.3);">
                          3
                        </div>
                        <div style="margin-top: 30px; margin-bottom: 24px;">
                          <i class="fas fa-video" style="font-size: 3rem; color: #8B5CF6; margin-bottom: 16px;"></i>
                        </div>
                        <h3 style="font-size: 1.5rem; font-weight: 700; color: #1E293B; margin-bottom: 16px;">é–‹å§‹å‰µä½œ</h3>
                        <p style="font-size: 1rem; color: #64748B; line-height: 1.7;">
                          å®Œæˆè…³æœ¬å¾Œï¼Œå¯ä»¥å„²å­˜åˆ°ã€Œå‰µä½œè€…è³‡æ–™åº«ã€ï¼Œéš¨æ™‚æŸ¥çœ‹ã€ä¸‹è¼‰æˆ–é‡æ–°ç”Ÿæˆã€‚AI æœƒè¨˜ä½ä½ çš„å…§å®¹é¢¨æ ¼ï¼ŒæŒçºŒå„ªåŒ–æ¯æ¬¡ç”Ÿæˆçš„å“è³ªã€‚
                        </p>
                      </div>
                    </div>
                    
                    <!-- å»ºè­°ä½¿ç”¨é †åºæç¤º -->
                    <div style="margin-top: 60px; padding: 32px; background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-radius: 20px; border: 2px solid #FCD34D; text-align: center;">
                      <p style="font-size: 1.1rem; color: #92400E; line-height: 1.7;">
                        <i class="fas fa-lightbulb" style="margin-right: 8px; color: #F59E0B;"></i>
                        <strong style="font-weight: 700;">å»ºè­°ä½¿ç”¨é †åºï¼š</strong>å…ˆä½¿ç”¨ä¸€éµç”Ÿæˆå¿«é€Ÿç”¢å‡ºå…§å®¹ â†’ å»ºç«‹ IP äººè¨­å–å¾— 14 å¤©è¦åŠƒ â†’ æŒçºŒå„ªåŒ–å…§å®¹ã€‚AI æœƒè¨˜ä½ä½ ä¹‹å‰çš„å…§å®¹ä¸¦æŒçºŒå„ªåŒ–ã€‚
                      </p>
                    </div>
                  </div>
                </section>

                <!-- ä¸‰å¤§åŠŸèƒ½å€å¡Šå¡ç‰‡ -->
                <section id="mode-cards" style="background: #F8FAFC; padding: 100px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw;">
                  <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px;">
                    <div style="text-align: center; margin-bottom: 60px;">
                      <h1 class="homepage-title" style="font-size: clamp(2rem, 4vw, 2.5rem); font-weight: 700; color: #1f2937; margin-bottom: 16px;">
                        æ­¡è¿ä½¿ç”¨AIJob<span class="mobile-break">çŸ­å½±éŸ³æ™ºèƒ½é«”</span>
                      </h1>
                      <p class="homepage-subtitle" style="font-size: clamp(1rem, 2vw, 1.1rem); color: #6b7280; margin-bottom: 48px; max-width: 600px; margin-left: auto; margin-right: auto; line-height: 1.6;">
                        é¸æ“‡æ‚¨åå¥½çš„ä½¿ç”¨æ¨¡å¼ï¼Œé–‹å§‹å‰µä½œç²¾å½©çš„çŸ­å½±éŸ³å…§å®¹
                      </p>
                    </div>
                    
                    <div class="mode-cards" style="position: relative; display: flex; justify-content: center; margin: 0 auto; max-width: 1200px;">
                      <div class="mode-card" onclick="handleModeCardClick('mode3');">
                        <div class="mode-card-icon"><i class="fas fa-user-tie"></i></div>
                        <h3 class="mode-card-title">IPäººè¨­è¦åŠƒæ¨¡å¼</h3>
                        <p class="mode-card-desc">é€éèŠå¤©è¨˜éŒ„äººç”Ÿæ›²ç·šï¼ŒAIå”åŠ©æ“¬å®šå€‹äººåŒ–IP Profileã€14å¤©è¦åŠƒå’Œè…³æœ¬</p>
                      </div>
                      <div class="mode-card" onclick="handleModeCardClick('mode2');">
                        <div class="mode-card-icon"><i class="fas fa-comments"></i></div>
                        <h3 class="mode-card-title">AIé¡§å•å°è©±æ¨¡å¼</h3>
                        <p class="mode-card-desc">èˆ‡AIé€²è¡Œæ·±åº¦å°è©±ï¼Œéˆæ´»è¨è«–å…§å®¹ç­–ç•¥ï¼Œé©åˆéœ€è¦å‰µæ„è¨è«–çš„ç”¨æˆ¶</p>
                      </div>
                      <div class="mode-card" onclick="handleModeCardClick('mode1');">
                        <div class="mode-card-icon"><i class="fas fa-magic"></i></div>
                        <h3 class="mode-card-title">ä¸€éµç”Ÿæˆæ¨¡å¼</h3>
                        <p class="mode-card-desc">å¿«é€Ÿè¨­å®šéœ€æ±‚ï¼Œä¾åºç”Ÿæˆå¸³è™Ÿå®šä½ã€é¸é¡Œå’Œè…³æœ¬ï¼Œé©åˆæ•ˆç‡å°å‘çš„ç”¨æˆ¶</p>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- AI çŸ­å½±éŸ³å¯¦æˆ°æŒ‡å— -->
                <section style="background: white; padding: 100px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw;">
                  <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px;">
                    <div style="text-align: center; margin-bottom: 60px;">
                      <h2 style="font-size: clamp(2rem, 4vw, 2.8rem); font-weight: 800; color: #1E293B; margin-bottom: 16px;"><i class="fas fa-book-open" style="margin-right: 10px;"></i>AI çŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—</h2>
                      <p style="font-size: 1.1rem; color: #64748B; max-width: 600px; margin: 0 auto;">å­¸ç¿’å¦‚ä½•ç”¨ AI æ‰“é€ çˆ†æ¬¾çŸ­å½±éŸ³å…§å®¹</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 32px; margin-top: 40px;">
                      <!-- æ–‡ç«  1 -->
                      <a href="#" onclick="switchPage('guide-article1'); return false;" style="text-decoration: none; display: block; cursor: pointer;">
                        <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; display: flex; flex-direction: column; height: 100%;">
                          <div style="padding: 32px; border-bottom: 1px solid #F1F5F9; flex: 1 1 auto;">
                            <div style="font-size: 1.25rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">ä¸‰æ­¥ç”Ÿæˆ 30 ç§’çŸ­å½±éŸ³è…³æœ¬</div>
                            <div style="font-size: 0.95rem; color: #64748B; line-height: 1.6;">
                              åªéœ€ä¸‰æ­¥ï¼šè¨­å®šå¹³å°èˆ‡ä¸»é¡Œã€AI ç”ŸæˆåŠ‡æœ¬å¤§ç¶±ã€ç¢ºèªä¸¦å„²å­˜ã€‚æœ¬æ•™å­¸å°‡ç¤ºç¯„å®Œæ•´æµç¨‹ï¼Œå¹«ä½ åœ¨ 5 åˆ†é˜å…§ç”¢å‡º Instagram Reels è…³æœ¬...
                            </div>
                          </div>
                          <div style="padding: 20px 32px; background: #F8FAFC;">
                            <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                          </div>
                        </div>
                      </a>
                      
                      <!-- æ–‡ç«  2 -->
                      <a href="#" onclick="switchPage('guide-article2'); return false;" style="text-decoration: none; display: block; cursor: pointer;">
                        <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; display: flex; flex-direction: column; height: 100%;">
                          <div style="padding: 32px; border-bottom: 1px solid #F1F5F9; flex: 1 1 auto;">
                            <div style="font-size: 1.25rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">AI å¸³è™Ÿå®šä½ï¼šå…§å®¹æ”¯æŸ±èˆ‡ 14 å¤©è¨ˆç•«</div>
                            <div style="font-size: 0.95rem; color: #64748B; line-height: 1.6;">
                              äº†è§£å¦‚ä½•ç”¨ AI åˆ†æä½ çš„å…§å®¹å®šä½ï¼Œä¸¦è‡ªå‹•ç”Ÿæˆ 14 å¤©ç™¼å¸ƒè¨ˆç•«ã€‚åŒ…å«å…§å®¹æ”¯æŸ±ï¼ˆæ•™è‚²ã€å¨›æ¨‚ã€å•Ÿç™¼ã€æˆäº¤ï¼‰èˆ‡æ’ç¨‹å»ºè­°...
                            </div>
                          </div>
                          <div style="padding: 20px 32px; background: #F8FAFC;">
                            <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                          </div>
                        </div>
                      </a>
                      
                      <!-- æ–‡ç«  3 -->
                      <a href="#" onclick="switchPage('guide-article3'); return false;" style="text-decoration: none; display: block; cursor: pointer;">
                        <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; display: flex; flex-direction: column; height: 100%;">
                          <div style="padding: 32px; border-bottom: 1px solid #F1F5F9; flex: 1 1 auto;">
                            <div style="font-size: 1.25rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">Reels / Shorts / TikTok<br>è…³æœ¬å·®ç•°</div>
                            <div style="font-size: 0.95rem; color: #64748B; line-height: 1.6;">
                              æ¯å€‹å¹³å°çš„çŸ­å½±éŸ³éƒ½æœ‰ä¸åŒç‰¹æ€§ï¼šIG Reels åé‡å“ç‰Œæ•˜äº‹ï¼ŒYouTube Shorts å¼·èª¿å¿«é€Ÿçˆ†é»ï¼ŒTikTok é‡è¦–å¨›æ¨‚æ€§ã€‚æœ¬æŒ‡å—è§£æ AI å¦‚ä½•è‡ªå‹•èª¿æ•´...
                            </div>
                          </div>
                          <div style="padding: 20px 32px; background: #F8FAFC;">
                            <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                          </div>
                        </div>
                      </a>
                    </div>
                  </div>
                </section>

                <!-- åˆ¥äººæ€éº¼ç”¨ - å…©å€‹å€å¡Š -->
                <section class="user-story-section">
                  <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px;">
                    <div style="text-align: center; margin-bottom: 60px;">
                      <h2 style="font-size: clamp(2rem, 4vw, 2.8rem); font-weight: 800; color: #1E293B; margin-bottom: 16px;">
                        <i class="fas fa-users" style="margin-right: 10px; color: #3B82F6;"></i>åˆ¥äººæ€éº¼ç”¨
                      </h2>
                      <p style="font-size: 1.1rem; color: #64748B; max-width: 600px; margin: 0 auto;">
                        çœ‹çœ‹å…¶ä»–å‰µä½œè€…å¦‚ä½•ç”¨ ReelMind æ‰“é€ çˆ†æ¬¾å…§å®¹
                      </p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 32px; margin-top: 40px;">
                      <!-- ä½¿ç”¨æ¡ˆä¾‹ 1 -->
                      <div class="user-story-card">
                        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                          <img src="https://ui-avatars.com/api/?name=Nick+Wu&background=3B82F6&color=fff&size=128&bold=true" alt="Nick Wu" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid #E5E7EB;" />
                          <div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: #1E293B; margin-bottom: 4px;">Nick Wuï½œè¡ŒéŠ·é¡§å•</div>
                            <div style="font-size: 0.9rem; color: #64748B;">ä½¿ç”¨ ReelMind 3 å€‹æœˆ</div>
                          </div>
                        </div>
                        <div style="font-size: 1rem; color: #475569; line-height: 1.8; margin-bottom: 20px;">
                          ã€Œä¹‹å‰æ¯å¤©è¦èŠ± 2-3 å°æ™‚æƒ³è…³æœ¬ï¼Œç¾åœ¨ç”¨ ReelMind ä¸€éµç”Ÿæˆï¼Œ5 åˆ†é˜å°±æå®šã€‚æœ€æ£’çš„æ˜¯ AI æœƒè¨˜ä½æˆ‘çš„å“ç‰Œèª¿æ€§ï¼Œæ¯æ¬¡ç”Ÿæˆçš„å…§å®¹éƒ½å¾ˆç¬¦åˆæˆ‘çš„é¢¨æ ¼ã€‚ä¸Šå€‹æœˆ IG Reels çš„è§€çœ‹æ¬¡æ•¸æå‡äº† 180%ï¼ã€
                        </div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                          <span style="padding: 6px 12px; background: #EFF6FF; color: #2563EB; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">#ä¸€éµç”Ÿæˆ</span>
                          <span style="padding: 6px 12px; background: #F0FDF4; color: #059669; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">#IG Reels</span>
                          <span style="padding: 6px 12px; background: #FEF3C7; color: #D97706; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">#è§€çœ‹æå‡ 180%</span>
                        </div>
                      </div>
                      
                      <!-- ä½¿ç”¨æ¡ˆä¾‹ 2 -->
                      <div class="user-story-card">
                        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px;">
                          <img src="https://ui-avatars.com/api/?name=æç¾è¯&background=10B981&color=fff&size=128&bold=true" alt="æç¾è¯" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid #E5E7EB;" />
                          <div>
                            <div style="font-size: 1.1rem; font-weight: 700; color: #1E293B; margin-bottom: 4px;">æç¾è¯ï½œå…§å®¹å‰µä½œè€…</div>
                            <div style="font-size: 0.9rem; color: #64748B;">ä½¿ç”¨ ReelMind 6 å€‹æœˆ</div>
                          </div>
                        </div>
                        <div style="font-size: 1rem; color: #475569; line-height: 1.8; margin-bottom: 20px;">
                          ã€ŒIP äººè¨­è¦åŠƒåŠŸèƒ½å¹«æˆ‘å»ºç«‹äº†å®Œæ•´çš„å…§å®¹ç­–ç•¥ï¼Œ14 å¤©è¦åŠƒè®“æˆ‘çŸ¥é“æ¯å¤©è¦ç™¼ä»€éº¼ã€‚ç¾åœ¨æ¯é€±å›ºå®šä¸Šç‰‡ 5-7 æ”¯ï¼Œç²‰çµ²äº’å‹•ç‡æå‡äº† 3 å€ã€‚æœ€å–œæ­¡çš„æ˜¯ AI é¡§å•åŠŸèƒ½ï¼Œå¯ä»¥éš¨æ™‚è¨è«–å…§å®¹æ–¹å‘ï¼Œå°±åƒæœ‰å€‹å°ˆæ¥­é¡§å•åœ¨èº«é‚Šã€‚ã€
                        </div>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                          <span style="padding: 6px 12px; background: #F3E8FF; color: #7C3AED; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">#IPäººè¨­è¦åŠƒ</span>
                          <span style="padding: 6px 12px; background: #EFF6FF; color: #2563EB; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">#AIé¡§å•</span>
                          <span style="padding: 6px 12px; background: #FEF3C7; color: #D97706; border-radius: 20px; font-size: 0.85rem; font-weight: 600;">#äº’å‹•ç‡æå‡ 3 å€</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </section>

                <!-- åˆ°Discordè«–å£‡åˆ†äº«ä½ çš„ä½¿ç”¨å¿ƒå¾—å§ï½ -->
                <section class="discord-share-section" style="background: linear-gradient(to bottom right, #8B5CF6 0%, #7C3AED 100%); padding: 100px 0; margin: 60px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw; position: relative; overflow: hidden;">
                  <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px; text-align: center; position: relative; z-index: 10;">
                    <div style="margin-bottom: 40px;">
                      <div style="font-size: 4rem; margin-bottom: 24px;">
                        ğŸ’¬
                      </div>
                      <h2 style="font-size: clamp(2rem, 4vw, 2.8rem); font-weight: 800; color: white; margin-bottom: 20px; text-shadow: 0 2px 20px rgba(0,0,0,0.1);">
                        åˆ°Discordè«–å£‡åˆ†äº«ä½ çš„ä½¿ç”¨å¿ƒå¾—å§ï½
                      </h2>
                      <p style="font-size: 1.2rem; color: rgba(255,255,255,0.95); max-width: 700px; margin: 0 auto 40px; line-height: 1.7;">
                        åŠ å…¥æˆ‘å€‘çš„ Discord ç¤¾ç¾¤ï¼Œèˆ‡å…¶ä»–å‰µä½œè€…äº¤æµä½¿ç”¨ç¶“é©—ã€åˆ†äº«æˆåŠŸæ¡ˆä¾‹ï¼Œä¸€èµ·æ‰“é€ çˆ†æ¬¾çŸ­å½±éŸ³å…§å®¹ï¼
                      </p>
                    </div>
                    
                    <div style="display: flex; gap: 16px; flex-wrap: wrap; justify-content: center; align-items: center;">
                      <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display: inline-flex; align-items: center; gap: 12px; padding: 18px 32px; background: white; color: #5865F2; border-radius: 12px; font-weight: 700; text-decoration: none; font-size: 1.1rem; box-shadow: 0 4px 20px rgba(0,0,0,0.2); transition: all 0.3s; transform: scale(1);" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                        <i class="fab fa-discord" style="font-size: 1.5rem;"></i>
                        <span>ç«‹å³åŠ å…¥ Discord ç¤¾ç¾¤</span>
                      </a>
                    </div>
                    
                    <div style="margin-top: 50px; padding: 30px; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); max-width: 800px; margin-left: auto; margin-right: auto;">
                      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; text-align: left;">
                        <div>
                          <div style="font-size: 1.5rem; margin-bottom: 8px;">ğŸ”¥</div>
                          <div style="font-weight: 700; color: white; margin-bottom: 4px; font-size: 1rem;">#ä¸€éµç”Ÿæˆå·¥ä½œå€</div>
                          <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">æ¯å¤©æ–°è²¼æ–‡ 30+</div>
                        </div>
                        <div>
                          <div style="font-size: 1.5rem; margin-bottom: 8px;">ğŸ§­</div>
                          <div style="font-weight: 700; color: white; margin-bottom: 4px; font-size: 1rem;">#IPäººè¨­è¦åŠƒ</div>
                          <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">çœŸå¯¦æ¡ˆä¾‹äº¤æµ</div>
                        </div>
                        <div>
                          <div style="font-size: 1.5rem; margin-bottom: 8px;">ğŸ¤–</div>
                          <div style="font-weight: 700; color: white; margin-bottom: 4px; font-size: 1rem;">#AIé¡§å•å•ç­”</div>
                          <div style="color: rgba(255,255,255,0.8); font-size: 0.9rem;">ç¯€å¥ / Hook / CTA</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </section>
                
                <!-- Footerï¼ˆGEOï¼‹SEOï¼‰ -->
                <section class="rm-footer" style="background: #EFF6FF; padding: 60px 0; margin: -20px calc(-50vw + 50%) 0 calc(-50vw + 50%); width: 100vw; max-width: 100vw;">
                  <div style="max-width: 1400px; margin: 0 auto; padding: 0 16px; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                    <div style="font-size: 1.1rem; font-weight: 600; color: #1E293B; margin-bottom: 12px; text-align: center; width: 100%;">
                      AIJob æ™ºèƒ½é«” |  ReelMind |AIJobå­¸é™¢
                    </div>
                    <div style="font-size: 0.9rem; color: #94A3B8; font-weight: 500; text-align: center; width: 100%; margin-bottom: 16px;">
                      ReelMind â€” ç‚ºäºæ´²å‰µä½œè€…æ‰“é€ çš„ AI çŸ­å½±éŸ³æ™ºèƒ½é«”
                    </div>
                    
                  </div>
                </section>

              </div>
            </div>
          </div>

          <!-- è«–å£‡ä»‹ç´¹ & è¯çµ¡æ–¹å¼é é¢ -->
          <div id="forum" class="page">
            <div style="max-width: 1200px; margin: 0 auto; padding: 0;">
              <!-- Hero å€å¡Š -->
              <div style="position: relative; overflow: hidden; padding: 60px 20px 40px; background: linear-gradient(135deg, #eff6ff 0%, #f0fdf4 50%, #fef3c7 100%); text-align: center;">
                <div style="display: inline-block; background: #e0f2fe; color: #075985; padding: 8px 16px; border-radius: 9999px; font-weight: 700; font-size: 14px; margin-bottom: 20px;">
                  ğŸš€ AIJob å­¸é™¢ Â· Discord ç¤¾ç¾¤
                </div>
                <h1 style="font-size: 2.8rem; font-weight: 800; color: #0f172a; margin: 12px 0; line-height: 1.2;">
                  ä¸€èµ·æŠŠçŸ­å½±éŸ³åšæˆã€Œå¯è¤‡è£½çš„ç³»çµ±ã€
                </h1>
                <p style="font-size: 1.25rem; color: #475569; max-width: 800px; margin: 0 auto 24px;">
                  ä¸€éµç”Ÿæˆåˆ†äº«ï½œAI é¡§å•å•ç­”ï½œIP äººè¨­è¦åŠƒï½œå‰µä½œè€…è³‡æ–™åº«æ•´åˆã€‚åŠ å…¥ Discordï¼Œé‚Šåšé‚Šå­¸é‚Šä¸Šç‰‡ã€‚
                </p>
                <div style="display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; margin-bottom: 30px;">
                  <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display: inline-flex; align-items: center; justify-content: center; padding: 14px 28px; background: #0ea5e9; color: white; border-radius: 9999px; font-weight: 800; text-decoration: none; transition: all 0.3s;">
                    ç«‹å³åŠ å…¥ Discord
                  </a>
                  <a href="#channels" style="display: inline-flex; align-items: center; justify-content: center; padding: 14px 28px; background: white; border: 1px solid #cbd5e1; color: #334155; border-radius: 9999px; font-weight: 800; text-decoration: none;">
                    ç†±é–€é »é“
                  </a>
                </div>
                
                <!-- è·‘é¦¬ç‡ˆ -->
                <div style="display: flex; gap: 32px; overflow: auto; white-space: nowrap; padding: 12px 0; color: #0ea5e9; font-weight: 800; border-top: 1px solid #cbd5e1;">
                  <span>ğŸ”¥ #ä¸€éµç”Ÿæˆå·¥ä½œå€ æ¯å¤©æ–°è²¼æ–‡ 30+</span>
                  <span>ğŸ§­ #IPäººè¨­è¦åŠƒ çœŸå¯¦æ¡ˆä¾‹äº¤æµ</span>
                  <span>ğŸ¤– #AIé¡§å•å•ç­” ç¯€å¥ / Hook / CTA</span>
                  <span>ğŸ“¦ ä½ çš„æˆæœå¯å­˜å›ã€Œå‰µä½œè€…è³‡æ–™åº«ã€</span>
                </div>
              </div>

              <!-- ç¤¾ç¾¤æ—¥å¸¸æ™‚é–“è»¸ -->
              <div style="padding: 60px 20px;">
                <h2 style="font-size: 1.75rem; font-weight: 900; margin: 0 0 32px; color: #0f172a;">ç¤¾ç¾¤æ—¥å¸¸ï½œä»Šå¤©åœ¨è¨è«–ä»€éº¼ï¼Ÿ</h2>
                
                <div style="position: relative; padding-left: 28px; max-width: 800px;">
                  <!-- Timeline ç·š -->
                  <div style="position: absolute; left: 12px; top: 8px; bottom: 8px; width: 2px; background: #cbd5e1;"></div>
                  
                  <!-- Timeline Item 1 -->
                  <div style="position: relative; padding: 14px 16px; background: white; border: 1px solid #e2e8f0; border-radius: 14px; margin: 10px 0; box-shadow: 0 12px 26px rgba(2,6,23,.06);">
                    <div style="position: absolute; left: -18px; top: 18px; width: 12px; height: 12px; border-radius: 50%; background: #0ea5e9; border: 3px solid white;"></div>
                    <div style="font-size: 12px; color: #64748b; margin-bottom: 6px;">09:32 Â· #ä¸€éµç”Ÿæˆå·¥ä½œå€</div>
                    <h3 style="font-weight: 900; margin: 0 0 4px; color: #0f172a;">ç¾è‚¡ç›¤å¾Œé€Ÿå ±ï¼šå¦‚ä½•åš 20 ç§’çŸ­è©•ï¼Ÿ</h3>
                    <p style="color: #475569; margin: 0;">ç”¨ 3 å¥è©±æ¡†ï¼ŒHookâ†’æ•¸æ“šâ†’CTAï¼Œä¸¦é™„ä¸Šä¸‹ä¸€æ”¯é å‘Šã€‚</p>
                  </div>
                  
                  <!-- Timeline Item 2 -->
                  <div style="position: relative; padding: 14px 16px; background: white; border: 1px solid #e2e8f0; border-radius: 14px; margin: 10px 0; box-shadow: 0 12px 26px rgba(2,6,23,.06);">
                    <div style="position: absolute; left: -18px; top: 18px; width: 12px; height: 12px; border-radius: 50%; background: #0ea5e9; border: 3px solid white;"></div>
                    <div style="font-size: 12px; color: #64748b; margin-bottom: 6px;">13:15 Â· #AIé¡§å•å•ç­”</div>
                    <h3 style="font-weight: 900; margin: 0 0 4px; color: #0f172a;">å°ç£å¥³æ€§å—çœ¾èªæ°£ï¼Œå“ªäº›è©æ›´è‡ªç„¶ï¼Ÿ</h3>
                    <p style="color: #475569; margin: 0;">æŠŠå£æ°£å¾ã€Œæ•™å°ã€æ”¹ç‚ºã€Œé™ªä¼´ã€ï¼Œä¸¦åŠ å…¥åœ¨åœ°å£èªè½‰å ´ã€‚</p>
                  </div>
                  
                  <!-- Timeline Item 3 -->
                  <div style="position: relative; padding: 14px 16px; background: white; border: 1px solid #e2e8f0; border-radius: 14px; margin: 10px 0; box-shadow: 0 12px 26px rgba(2,6,23,.06);">
                    <div style="position: absolute; left: -18px; top: 18px; width: 12px; height: 12px; border-radius: 50%; background: #0ea5e9; border: 3px solid white;"></div>
                    <div style="font-size: 12px; color: #64748b; margin-bottom: 6px;">20:41 Â· #IPäººè¨­è¦åŠƒ</div>
                    <h3 style="font-weight: 900; margin: 0 0 4px; color: #0f172a;">14 å¤©ä¸Šç‰‡ç¯€å¥ï¼šé€±ä¸€è…³æœ¬ã€é€±ä¸‰éŒ„å½±ã€é€±æœ«è¼ªæ’­</h3>
                    <p style="color: #475569; margin: 0;">å»ºç«‹å›ºå®šç¯€é»ï¼Œè³‡æ–™åº«ç‰ˆæœ¬ç®¡ç†æ›´å¥½æ‰¾ã€‚</p>
                  </div>
                </div>
              </div>

              <!-- é »é“åœ°åœ– -->
              <div id="channels" style="padding: 40px 20px 60px;">
                <h2 style="font-size: 1.75rem; font-weight: 900; margin: 0 0 32px; color: #0f172a;">é »é“åœ°åœ–ï½œå…ˆå¾é€™ä¸‰å€‹é–‹å§‹</h2>
                
                <div style="display: grid; gap: 20px; max-width: 900px;">
                  <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 20px; box-shadow: 0 10px 24px rgba(2,6,23,.06);">
                    <div style="display: grid; gap: 12px; grid-template-columns: repeat(2, 1fr); margin-bottom: 16px;">
                      <div style="display: flex; align-items: center; gap: 10px; border: 1px dashed #93c5fd; padding: 12px; border-radius: 12px;">
                        <span>ğŸ“Œ</span>
                        <div>
                          <div style="font-weight: 700; color: #1e293b;">#æ­¡è¿èˆ‡è¦å‰‡</div>
                          <div style="font-size: 12px; color: #64748b; margin-top: 2px;">è²¼æ–‡æ ¼å¼ã€å‹å–„äº¤æµ</div>
                        </div>
                      </div>
                      
                      <div style="display: flex; align-items: center; gap: 10px; border: 1px dashed #93c5fd; padding: 12px; border-radius: 12px;">
                        <span>âš¡</span>
                        <div>
                          <div style="font-weight: 700; color: #1e293b;">#ä¸€éµç”Ÿæˆå·¥ä½œå€</div>
                          <div style="font-size: 12px; color: #64748b; margin-top: 2px;">è²¼æˆæœæ‹¿å›é¥‹</div>
                        </div>
                      </div>
                      
                      <div style="display: flex; align-items: center; gap: 10px; border: 1px dashed #93c5fd; padding: 12px; border-radius: 12px;">
                        <span>ğŸ¤–</span>
                        <div>
                          <div style="font-weight: 700; color: #1e293b;">#AIé¡§å•å•ç­”</div>
                          <div style="font-size: 12px; color: #64748b; margin-top: 2px;">å®šä½/ç¯€å¥/è®Šç¾</div>
                        </div>
                      </div>
                      
                      <div style="display: flex; align-items: center; gap: 10px; border: 1px dashed #93c5fd; padding: 12px; border-radius: 12px;">
                        <span>ğŸ§­</span>
                        <div>
                          <div style="font-weight: 700; color: #1e293b;">#IPäººè¨­è¦åŠƒ</div>
                          <div style="font-size: 12px; color: #64748b; margin-top: 2px;">Profileï¼‹14å¤©</div>
                        </div>
                      </div>
                    </div>
                    
                    <div style="font-size: 12px; color: #64748b; margin-bottom: 12px;">
                      âœ… å»ºè­°é †åºï¼š#æ­¡è¿èˆ‡è¦å‰‡ â†’ #IPäººè¨­è¦åŠƒ â†’ #ä¸€éµç”Ÿæˆå·¥ä½œå€
                    </div>
                    
                    <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display: inline-block; padding: 12px 24px; background: #0ea5e9; color: white; border-radius: 9999px; font-weight: 800; text-decoration: none;">
                      åŠ å…¥ Discord
                    </a>
                  </div>
                </div>
              </div>

              <!-- è¯çµ¡æ–¹å¼ -->
              <div style="padding: 60px 20px; background: #f8fafc;">
                <h2 style="font-size: 1.75rem; font-weight: 900; margin: 0 0 32px; color: #0f172a; text-align: center;">è¯çµ¡æ–¹å¼</h2>
                
                <div style="display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); max-width: 1000px; margin: 0 auto;">
                  <!-- LINE å®˜æ–¹å¸³è™Ÿ -->
                  <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 24px; box-shadow: 0 10px 24px rgba(2,6,23,.06);">
                    <div style="font-weight: 700; margin-bottom: 8px; color: #0f172a;">LINE å®˜æ–¹å¸³è™Ÿ</div>
                    <a href="https://AIJobschool.short.gy/E49kA8" target="_blank" style="font-size: 14px; color: #06c755; text-decoration: none;">
                      åŠ å…¥ LINE å¥½å‹
                    </a>
                  </div>
                  
                  <!-- Discord -->
                  <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 24px; box-shadow: 0 10px 24px rgba(2,6,23,.06);">
                    <div style="font-weight: 700; margin-bottom: 8px; color: #0f172a;">Discord</div>
                    <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="font-size: 14px; color: #0ea5e9; text-decoration: none;">
                      AIJob å­¸é™¢
                    </a>
                  </div>
                  
                  <!-- ç¤¾ç¾¤ -->
                  <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 24px; box-shadow: 0 10px 24px rgba(2,6,23,.06);">
                    <div style="font-weight: 700; margin-bottom: 8px; color: #0f172a;">ç¤¾ç¾¤</div>
                    <div style="font-size: 14px; color: #64748b;">IG / YouTube æœå°‹ã€ŒReelMindã€</div>
                  </div>
                </div>
              </div>
              
              <!-- Footer -->
              <div style="padding: 28px 20px; text-align: center; color: #64748b; border-top: 1px solid #e2e8f0; font-size: 14px;">
                Â© 2025 ReelMind Â· AI çŸ­å½±éŸ³ Â· å°ç£
              </div>
            </div>
          </div>

          <!-- AIçŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—é é¢ -->
          <div id="guide" class="page">
            <div style="max-width: 1200px; margin: 0 auto; padding: 40px 20px;">
              <!-- æ¨™é¡Œå€ -->
              <div style="text-align: center; margin-bottom: 50px;">
                <h1 style="font-size: 2.5rem; font-weight: 800; color: #1E293B; margin-bottom: 20px;">
                  <i class="fas fa-book-open" style="margin-right: 15px; color: #3B82F6;"></i>AI çŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—
                </h1>
                <p style="font-size: 1.2rem; color: #64748B; max-width: 700px; margin: 0 auto;">
                  å­¸ç¿’å¦‚ä½•ç”¨ AI æ‰“é€ çˆ†æ¬¾çŸ­å½±éŸ³å…§å®¹ï¼Œå¾åŸºç¤åˆ°é€²éšæŠ€å·§
                </p>
              </div>

              <!-- æŒ‡å—æ–‡ç« åˆ—è¡¨ -->
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px;">
                <!-- æ–‡ç«  1 -->
                <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; cursor: pointer;" onclick="switchPage('guide-article1')">
                  <div style="padding: 32px; border-bottom: 1px solid #F1F5F9;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">ä¸‰æ­¥ç”Ÿæˆ 30 ç§’çŸ­å½±éŸ³è…³æœ¬</div>
                    <div style="font-size: 1rem; color: #64748B; line-height: 1.6;">
                      åªéœ€ä¸‰æ­¥ï¼šè¨­å®šå¹³å°èˆ‡ä¸»é¡Œã€AI ç”ŸæˆåŠ‡æœ¬å¤§ç¶±ã€ç¢ºèªä¸¦å„²å­˜ã€‚æœ¬æ•™å­¸å°‡ç¤ºç¯„å®Œæ•´æµç¨‹ï¼Œå¹«ä½ åœ¨ 5 åˆ†é˜å…§ç”¢å‡º Instagram Reels è…³æœ¬...
                    </div>
                  </div>
                  <div style="padding: 20px 32px; background: #F8FAFC;">
                    <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                  </div>
                </div>
                
                <!-- æ–‡ç«  2 -->
                <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; cursor: pointer;" onclick="switchPage('guide-article2')">
                  <div style="padding: 32px; border-bottom: 1px solid #F1F5F9;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">AI å¸³è™Ÿå®šä½ï¼šå…§å®¹æ”¯æŸ±èˆ‡ 14 å¤©è¨ˆç•«</div>
                    <div style="font-size: 1rem; color: #64748B; line-height: 1.6;">
                      äº†è§£å¦‚ä½•ç”¨ AI åˆ†æä½ çš„å…§å®¹å®šä½ï¼Œä¸¦è‡ªå‹•ç”Ÿæˆ 14 å¤©ç™¼å¸ƒè¨ˆç•«ã€‚åŒ…å«å…§å®¹æ”¯æŸ±ï¼ˆæ•™è‚²ã€å¨›æ¨‚ã€å•Ÿç™¼ã€æˆäº¤ï¼‰èˆ‡æ’ç¨‹å»ºè­°...
                    </div>
                  </div>
                  <div style="padding: 20px 32px; background: #F8FAFC;">
                    <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                  </div>
                </div>
                
                <!-- æ–‡ç«  3 -->
                <div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 8px 30px rgba(17,24,39,0.06); transition: all 0.3s; border: 1px solid #E2E8F0; cursor: pointer;" onclick="switchPage('guide-article3')">
                  <div style="padding: 32px; border-bottom: 1px solid #F1F5F9;">
                    <div style="font-size: 1.5rem; font-weight: 700; color: #1E293B; margin-bottom: 12px;">Reels / Shorts / TikTok<br>è…³æœ¬å·®ç•°</div>
                    <div style="font-size: 1rem; color: #64748B; line-height: 1.6;">
                      æ¯å€‹å¹³å°çš„çŸ­å½±éŸ³éƒ½æœ‰ä¸åŒç‰¹æ€§ï¼šIG Reels åé‡å“ç‰Œæ•˜äº‹ï¼ŒYouTube Shorts å¼·èª¿å¿«é€Ÿçˆ†é»ï¼ŒTikTok é‡è¦–å¨›æ¨‚æ€§ã€‚æœ¬æŒ‡å—è§£æ AI å¦‚ä½•è‡ªå‹•èª¿æ•´...
                    </div>
                  </div>
                  <div style="padding: 20px 32px; background: #F8FAFC;">
                    <span style="color: #2563EB; font-weight: 600; font-size: 0.95rem;">é–±è®€æ›´å¤š â†’</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- æ–‡ç« ï¼šä¸‰æ­¥ç”Ÿæˆ 30 ç§’çŸ­å½±éŸ³è…³æœ¬ -->
          <div id="guide-article1" class="page">
            <div>
              <!-- Header -->
              <header style="padding: 56px 0 18px; border-bottom: 1px solid #e2e8f0; background: linear-gradient(135deg, rgba(37,99,235,.10), transparent 60%), linear-gradient(135deg, rgba(59,130,246,.10), transparent 60%);">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                <div style="font-size: 12px; color: #64748b; margin-bottom: 10px;">
                  <a onclick="switchPage('homepage'); return false;" style="text-decoration: none; color: #64748b; cursor: pointer;">é¦–é </a> / 
                  <a onclick="switchPage('guide'); return false;" style="text-decoration: none; color: #64748b; cursor: pointer;">AI çŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—</a> / æ–‡ç« 
                </div>
                <h1 style="font-size: 30px; margin: 0 0 6px; color: #0f172a; font-weight: 800;">ä¸‰æ­¥ç”Ÿæˆ 30 ç§’çŸ­å½±éŸ³è…³æœ¬</h1>
                <p style="color: #475569; margin: 0 0 8px; line-height: 1.6;">
                  ç”¨ ReelMind ä¸€éµç”Ÿæˆï¼Œä¸‰æ­¥å®Œæˆ Hookã€å£æ’­èˆ‡åˆ†é¡ã€‚é©ç”¨ IG Reels / TikTok / YouTube Shortsï¼Œå«å°ç£å¸‚å ´åœ¨åœ°åŒ–èªæ°£å»ºè­°ã€‚
                </p>
                <div style="display: flex; gap: 12px; flex-wrap: wrap; color: #64748b; font-size: 12px; margin-top: 8px;">
                  <span>é–±è®€ç´„ 6 åˆ†é˜</span>
                  <span>é©ç”¨è§’è‰²ï¼šå‰µä½œè€… / è¡ŒéŠ·äºº / è€é—†</span>
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: nowrap; margin-top: 18px; margin-bottom: 32px;">
                  <button onclick="switchPage('homepage');" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; background: #2563eb; color: white; border: none; cursor: pointer; flex: 1;">
                    ç™»å…¥è§£é– AI ç”Ÿæˆ
                  </button>
                  <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; border: 1px solid #cbd5e1; color: #334155; background: white; text-decoration: none; cursor: pointer; flex: 1;">
                    åŠ å…¥ Discord è¨è«–
                  </a>
                </div>
                </div>
              </header>

              <!-- Article -->
              <article style="padding: 28px 0;">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                <!-- å¿«é€Ÿå°è¦½ -->
                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 14px; margin-bottom: 28px;">
                  <strong style="display: block; margin-bottom: 8px; color: #0f172a;">å¿«é€Ÿå°è¦½</strong>
                  <ol style="margin: 0; padding-left: 20px; color: #334155;">
                    <li><a href="#step1" style="color: #334155; text-decoration: none;">Step 1ï¼šè¨­å®šå¹³å°èˆ‡ä¸»é¡Œ</a></li>
                    <li><a href="#step2" style="color: #334155; text-decoration: none;">Step 2ï¼šä¸€éµç”Ÿæˆï¼ˆHookï¼å£æ’­ï¼åˆ†é¡ï¼‰</a></li>
                    <li><a href="#step3" style="color: #334155; text-decoration: none;">Step 3ï¼šå„ªåŒ–èˆ‡ä¸Šç‰‡ï¼ˆCTAï¼æ¨™é¡Œï¼Hashtagï¼‰</a></li>
                  </ol>
                </div>

                <h2 id="step1" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">Step 1ï¼šè¨­å®šå¹³å°èˆ‡ä¸»é¡Œ</h2>
                <p style="color: #475569; line-height: 1.8; margin: 10px 0;">
                  åœ¨ ReelMind çš„ã€Œä¸€éµç”Ÿæˆã€ä¸­ï¼Œé¸æ“‡ <strong>IG Reels / TikTok / Shorts</strong>ï¼Œå¡«å…¥ä½ çš„ä¸»é¡Œï¼ˆç”¢å“ï¼æœå‹™ï¼é¢¨æ ¼ï¼‰ï¼Œä»¥åŠå½±ç‰‡é•·åº¦ï¼ˆå»ºè­° 20â€“45 ç§’ï¼‰ã€‚
                </p>
                <div style="background: #eff6ff; border: 1px solid #dbeafe; border-radius: 12px; padding: 12px 14px; color: #1e3a8a; margin: 14px 0;">
                  å°æŠ€å·§ï¼šä¸»é¡Œè«‹å…·é«”åˆ°ã€Œæ—ç¾¤ï¼‹å ´æ™¯ï¼‹ç—›é»ã€ï¼ˆä¾‹ï¼šä¸Šç­æ—ï¼åˆä¼‘ï¼å¿«é€Ÿå‚™é¤ï¼‰ã€‚
                </div>

                <h2 id="step2" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">Step 2ï¼šä¸€éµç”Ÿæˆï¼ˆHookï¼å£æ’­ï¼åˆ†é¡ï¼‰</h2>
                <p style="color: #475569; line-height: 1.8; margin: 10px 0;">æŒ‰ä¸‹ã€Œç”Ÿæˆã€ï¼Œç³»çµ±æœƒè¼¸å‡ºï¼š</p>
                <ul style="color: #475569; line-height: 1.8;">
                  <li><strong>Hook é–‹å ´</strong>ï¼šå‰ 3â€“5 ç§’æŠ“ä½æ³¨æ„åŠ›ï¼ˆæ•¸æ“šï¼ç–‘å•ï¼åå·®ï¼‰ã€‚</li>
                  <li><strong>å£æ’­æ–‡å­—</strong>ï¼šä¸€å¥è©±ä¸€é‡é»ï¼Œé¿å…å†—é•·ã€‚</li>
                  <li><strong>é¡é ­æŒ‡ç¤º</strong>ï¼šç‰¹å¯«ï¼ä¸­æ™¯ï¼è½‰å ´ï¼Œæ­é…å‹•ä½œèˆ‡è¡¨æƒ…ã€‚</li>
                </ul>
                <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 16px; margin: 14px 0; position: relative;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-size: 14px; font-weight: 600; color: #64748b;">ä»£ç¢¼ç¤ºä¾‹</span>
                    <button onclick="copyCode()" style="background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer; transition: all 0.2s;">
                      <i class="fas fa-copy"></i> è¤‡è£½
                    </button>
                  </div>
                  <pre id="codeBlock" style="font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: #0f172a; color: white; border-radius: 8px; padding: 10px 12px; display: block; overflow: auto; margin: 0;"># ç”Ÿæˆç¤ºä¾‹ï¼ˆæ‘˜è¦ï¼‰
Hookï¼šä¸Šç­æ—åˆä¼‘ 30 åˆ†é˜ï¼Œä¸‰æ­¥åšå‡ºé«˜è›‹ç™½ä¾¿ç•¶ï¼Ÿ
å£æ’­ï¼šæ­¥é©Ÿä¸€â€¦ æ­¥é©ŸäºŒâ€¦ æ­¥é©Ÿä¸‰â€¦
åˆ†é¡ï¼š0-5s é–‹å ´ç‰¹å¯«ï¼›5-20s æ­¥é©Ÿç•«é¢ï¼›20-30s æˆå“ï¼‹CTA</pre>
                </div>

                <h2 id="step3" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">Step 3ï¼šå„ªåŒ–èˆ‡ä¸Šç‰‡ï¼ˆCTAï¼æ¨™é¡Œï¼Hashtagï¼‰</h2>
                <p style="color: #475569; line-height: 1.8; margin: 10px 0;">ç¢ºèªç¯€å¥å¾Œï¼ŒåŠ å…¥ <strong>CTA</strong>ï¼ˆç•™è¨€é—œéµå­—ã€ä¸‹è¼‰æ¸…å–®ã€ç§è¨Šé€£çµï¼‰ï¼Œä¸¦ä¾å¹³å°æœ€ä½³åšæ³•èª¿æ•´ï¼š</p>
                <ul style="color: #475569; line-height: 1.8;">
                  <li>IG Reelsï¼šå“ç‰Œæ„Ÿèˆ‡ä¸€è‡´è¦–è¦ºã€‚</li>
                  <li>Shortsï¼šå¼·ç¯€å¥èˆ‡é—œéµå­—æ¨™é¡Œã€‚</li>
                  <li>TikTokï¼šå¨›æ¨‚æ€§èˆ‡äº’å‹•èª˜ç™¼ã€‚</li>
                </ul>
                <div style="background: #eff6ff; border: 1px solid #dbeafe; border-radius: 12px; padding: 12px 14px; color: #1e3a8a; margin: 14px 0;">
                  è‹¥ä½ å·²è¨‚é–±ï¼Œç”¨ã€Œå‰µä½œè€…è³‡æ–™åº«ã€ä¸‹è¼‰ PDF/CSVã€é‡ç”Ÿä¸åŒç‰ˆæœ¬ï¼ŒæŒçºŒåš A/B æ¸¬è©¦ã€‚
                </div>

                <div style="display: flex; gap: 10px; flex-wrap: nowrap; margin: 18px 0;">
                  <button onclick="switchPage('homepage');" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; background: #2563eb; color: white; border: none; cursor: pointer; flex: 1;">
                    ç«‹å³ç™»å…¥ï¼Œç”Ÿæˆæˆ‘çš„ç¬¬ä¸€æ”¯è…³æœ¬
                  </button>
                  <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; border: 1px solid #cbd5e1; color: #334155; background: white; text-decoration: none; cursor: pointer; flex: 1;">
                    åˆ° Discord çœ‹å¤§å®¶æ€éº¼æ”¹è…³æœ¬
                  </a>
                </div>
                </div>
              </article>

              <!-- Footer -->
              <footer style="padding: 26px 0; color: #64748b; text-align: center; border-top: 1px solid #e2e8f0; font-size: 14px;">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                Â© 2025 ReelMind Â· AI çŸ­å½±éŸ³ï½œAI è…³æœ¬ç”Ÿæˆï½œAI é¡§å•ï½œIP äººè¨­è¦åŠƒ Â· å°ç£ / é¦™æ¸¯ / æ–°åŠ å¡
                </div>
              </footer>
            </div>
          </div>

          <!-- æ–‡ç« ï¼šAI å¸³è™Ÿå®šä½ï¼šå…§å®¹æ”¯æŸ±èˆ‡ 14 å¤©è¨ˆç•«ï¼ˆé€²éšç‰ˆï¼‰ -->
          <div id="guide-article2" class="page">
            <div>
              <!-- Header -->
              <header style="padding: 56px 0 18px; border-bottom: 1px solid #e2e8f0; background: linear-gradient(135deg, rgba(234,179,8,.12), transparent 60%), linear-gradient(135deg, rgba(245,158,11,.10), transparent 60%);">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                  <div style="font-size: 12px; color: #64748b; margin-bottom: 10px;">
                    <a onclick="switchPage('homepage'); return false;" style="text-decoration: none; color: #64748b; cursor: pointer;">é¦–é </a> / 
                    <a onclick="switchPage('guide'); return false;" style="text-decoration: none; color: #64748b; cursor: pointer;">AI çŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—</a> / æ–‡ç« 
                  </div>
                  <h1 style="font-size: 30px; margin: 0 0 6px; color: #0f172a; font-weight: 800;">AI å¸³è™Ÿå®šä½ï¼šå…§å®¹æ”¯æŸ±èˆ‡ 14 å¤©è¨ˆç•«</h1>
                  <p style="color: #475569; margin: 0 0 8px; line-height: 1.6;">å»ºç«‹ ICP èˆ‡è¨Šæ¯é‡‘å­—å¡” â†’ å…§å®¹æ”¯æŸ±èˆ‡çŸ©é™£ â†’ Hook/CTA åº« â†’ æ‹æ”æ¨¡æ¿ â†’ 14 å¤©ä¸Šç‰‡æ—¥æ›† â†’ KPI èˆ‡ A/B å¯¦é©— â†’ SEO/GEO åœ¨åœ°åŒ–ã€‚</p>
                  <div style="display: flex; gap: 12px; flex-wrap: wrap; color: #64748b; font-size: 12px; margin-top: 8px;">
                    <span>é–±è®€ç´„ 8 åˆ†é˜</span>
                    <span>é©ç”¨è§’è‰²ï¼šå‰µä½œè€… / è¡ŒéŠ·äºº / è€é—†</span>
                  </div>
                  <div style="display: flex; gap: 10px; flex-wrap: nowrap; margin-top: 18px; margin-bottom: 32px;">
                    <button onclick="goToLogin();" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; background: #2563eb; color: white; border: none; cursor: pointer; flex: 1;">ç™»å…¥è§£é– AI ç”Ÿæˆ</button>
                    <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; border: 1px solid #cbd5e1; color: #334155; background: white; text-decoration: none; cursor: pointer; flex: 1;">åŠ å…¥ Discord è¨è«–</a>
                  </div>
                </div>
              </header>

              <!-- Article -->
              <article style="padding: 28px 0;">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                  <!-- å¿«é€Ÿå°è¦½ -->
                  <div style="background: white; border: 1px solid #e2e8f0; border-radius: 16px; padding: 14px; margin-bottom: 28px;">
                    <strong style="display: block; margin-bottom: 8px; color: #0f172a;">å¿«é€Ÿå°è¦½</strong>
                    <ol style="margin: 0; padding-left: 20px; color: #334155;">
                      <li><a href="#icp" style="color: #334155; text-decoration: none;">ICP èˆ‡è¨Šæ¯é‡‘å­—å¡”</a></li>
                      <li><a href="#pillars" style="color: #334155; text-decoration: none;">å…§å®¹æ”¯æŸ±èˆ‡çŸ©é™£</a></li>
                      <li><a href="#hooks" style="color: #334155; text-decoration: none;">Hook / CTA åº«</a></li>
                      <li><a href="#script" style="color: #334155; text-decoration: none;">æ‹æ”è…³æœ¬æ¨¡æ¿</a></li>
                      <li><a href="#calendar" style="color: #334155; text-decoration: none;">14 å¤©æ—¥æ›†èˆ‡æ¯æ—¥ä»»å‹™</a></li>
                      <li><a href="#kpi" style="color: #334155; text-decoration: none;">KPI èˆ‡ A/B å¯¦é©—</a></li>
                      <li><a href="#seo" style="color: #334155; text-decoration: none;">SEO / GEO åœ¨åœ°åŒ–</a></li>
                      <li><a href="#prompts" style="color: #334155; text-decoration: none;">å¯è¤‡è£½çš„ AI æç¤ºè©</a></li>
                    </ol>
                  </div>

                  <h2 id="icp" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">ä¸€ã€ICP èˆ‡è¨Šæ¯é‡‘å­—å¡”</h2>
                  <div style="display:grid; gap:14px; grid-template-columns:1fr;">
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">1) ICPï¼ˆIdeal Customer Profileï¼‰</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li><b>æ—ç¾¤</b>ï¼šå¹´é½¡ / åœ°å€ï¼ˆå°ç£åŒ—ä¸­å—ï¼‰/ èº«åˆ†ï¼ˆä¸Šç­æ—ã€è‡ªç”±å·¥ä½œè€…ï¼‰</li>
                        <li><b>æƒ…å¢ƒ</b>ï¼šé€šå‹¤ã€åˆä¼‘ã€ä¸‹ç­å¾Œå‰ªç‰‡ã€é€±æœ«æ‰¹é‡æ‹æ”</li>
                        <li><b>ç—›é»</b>ï¼šç„¡æ³•ç©©å®šä¸Šç‰‡ã€è…³æœ¬å¡é—œã€è½‰æ›ç‡ä½</li>
                        <li><b>æœŸæœ›</b>ï¼šæ¯é€± 3 æ”¯ã€30 ç§’è…³æœ¬ã€å°æµåˆ° IG/Line</li>
                      </ul>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">2) è¨Šæ¯é‡‘å­—å¡”</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li><b>å“ç‰Œä¸»å¼µ</b>ï¼šç”¨ AI æŠŠçŸ­å½±éŸ³è®Šæˆå¯è¤‡è£½çš„ç³»çµ±</li>
                        <li><b>åƒ¹å€¼è­‰æ˜</b>ï¼šä¸€éµç”Ÿæˆè…³æœ¬ã€IP äººè¨­ã€è³‡æ–™åº«èˆ‡ A/B</li>
                        <li><b>åŠŸèƒ½èªªæ˜</b>ï¼šHook/CTA æ¨¡æ¿ã€14 å¤©ç¯€å¥ã€åœ¨åœ°åŒ–èªæ°£</li>
                      </ul>
                    </div>
                  </div>

                  <h2 id="pillars" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">äºŒã€å…§å®¹æ”¯æŸ±èˆ‡çŸ©é™£</h2>
                  <div style="display:grid; gap:14px; grid-template-columns:1fr;">
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">æ”¯æŸ± Ã— ç›®æ¨™</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li><b>æ•™è‚²</b>ï¼šæ•™æ–¹æ³• / æ‹†æ­¥é©Ÿï¼ˆå»ºç«‹å°ˆæ¥­æ„Ÿï¼‰</li>
                        <li><b>å¨›æ¨‚</b>ï¼šåå·® / æ¢—åŒ– / å¿«ç¯€å¥ï¼ˆæ“´è§¸åŠï¼‰</li>
                        <li><b>å•Ÿç™¼</b>ï¼šæ•…äº‹ / å¿ƒæ³• / è½‰æŠ˜ï¼ˆæƒ…æ„Ÿé€£çµï¼‰</li>
                        <li><b>æˆäº¤</b>ï¼šæ¡ˆä¾‹ / è¦åŠƒ / CTAï¼ˆå°æµè½‰æ›ï¼‰</li>
                      </ul>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">å…§å®¹çŸ©é™£å»ºè­°</h3>
                      <p style="color:#475569; line-height:1.8; margin:10px 0;">æ©«è»¸ï¼šæ”¯æŸ±ï¼›ç¸±è»¸ï¼šå½¢å¼ï¼ˆå£æ’­ / é–‹ç®± / éŒ„å¹• / é‡æ¼” / æ¸…å–®ï¼‰ã€‚å®Œæˆ 4Ã—5 çŸ©é™£ï¼20 é¡Œï¼Œè¶³å¤ å…©é€±ä¸Šç‰‡ã€‚</p>
                    </div>
                  </div>

                  <h2 id="hooks" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">ä¸‰ã€Hook / CTA åº«ï¼ˆå¯ç›´æ¥å¥—ç”¨ï¼‰</h2>
                  <div style="display:grid; gap:14px; grid-template-columns:1fr;">
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">20 ç¨® Hook æ¨¡æ¿</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li>åå·®ï¼šå…¶å¯¦æˆ‘ä¸€é–‹å§‹æ˜¯å¤±æ•—çš„â€¦</li>
                        <li>æ•¸æ“šï¼šç”¨ 30 ç§’å­¸æœƒ Xï¼Œè‡³å°‘å¿« 5 å€</li>
                        <li>æ¸…å–®ï¼šé€™ 3 ä»¶äº‹è®“æˆ‘ä¸Šç‰‡ç‡ç¿»å€</li>
                        <li>éŒ¯èª¤ï¼šä½ å¯èƒ½ä¸€ç›´åšéŒ¯äº†</li>
                        <li>æå•ï¼š3 ç§’å…§å‘Šè¨´æˆ‘ï¼Œä½ æœƒé¸å“ªå€‹ï¼Ÿ</li>
                        <li>æŒ‘æˆ°ï¼šæˆ‘ç”¨ 7 å¤©è­‰æ˜ä¸€ä»¶äº‹</li>
                        <li>ç¥•æŠ€ï¼š99% äººå¿½ç•¥çš„è¨­å®š</li>
                        <li>æ‹†è§£ï¼šæŠŠ X æ‹†æˆ 3 æ­¥</li>
                        <li>å°æ¯”ï¼šæ²’æœ‰ AI v.s. æœ‰ AI</li>
                        <li>æ•…äº‹ï¼šæˆ‘åœ¨åŒ—è»Šåœ°ä¸‹è¡—å­¸åˆ°çš„â€¦</li>
                      </ul>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">CTA ç¯„æœ¬ï¼ˆå°ç£èªæ°£ï¼‰</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li>ç•™è¨€é—œéµå­—ï¼šã€Œ<b>è…³æœ¬</b>ã€ï¼Œæˆ‘æŠŠæ¸…å–®å‚³çµ¦ä½ </li>
                        <li>å°æµï¼šæƒ³è¦æ¨¡æ¿ï¼Ÿé»ç°¡ä»‹é€£çµä¸‹è¼‰</li>
                        <li>äº’å‹•ï¼šä½ æœƒé¸ A é‚„æ˜¯ Bï¼Ÿç•™è¨€å‘Šè¨´æˆ‘</li>
                        <li>æ”¶è—ï¼šé€™æ‹›å¾ˆå¯¦ç”¨ï¼Œå…ˆå­˜èµ·ä¾†</li>
                      </ul>
                    </div>
                  </div>

                  <h2 id="script" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">å››ã€æ‹æ”è…³æœ¬æ¨¡æ¿</h2>
                  <div style="display:grid; gap:14px; grid-template-columns:1fr 1fr; max-width:100%;">
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">å£æ’­ï¼ˆSOVï¼‰</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li>0â€“3s Hookï¼ˆåå·®/æ•¸æ“š/æå•ï¼‰</li>
                        <li>3â€“20s æ­¥é©Ÿ 1/2/3ï¼ˆæ¯æ­¥ 5â€“7 ç§’ï¼‰</li>
                        <li>20â€“27s æˆæœç•«é¢ï¼ˆå‰/å¾Œå°æ¯”ï¼‰</li>
                        <li>27â€“30s CTAï¼ˆå–®ä¸€è¡Œå‹•ï¼‰</li>
                      </ul>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">B-Roll æ¸…å–®</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li>å™¨æç‰¹å¯«ã€æ‰‹éƒ¨æ“ä½œã€ç•«é¢è·³åˆ‡</li>
                        <li>è¢å¹•éŒ„å½±ï¼ˆå¿«æ·éµé¡¯ç¤ºï¼‰</li>
                        <li>è¡¨æƒ…åæ‡‰é¡é ­ã€é»é ­ã€æŒ‡é»</li>
                        <li>åŸå¸‚/é€šå‹¤æƒ…å¢ƒåšè½‰å ´</li>
                      </ul>
                    </div>
                  </div>

                  <h2 id="calendar" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">äº”ã€14 å¤©æ—¥æ›†èˆ‡æ¯æ—¥ä»»å‹™</h2>
                  <div style="display:grid; gap:14px; grid-template-columns:1fr 1fr; max-width:100%;">
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">æ—¥æ›†ï¼ˆå»ºè­°æ™‚æ®µï¼š12:00 / 20:00ï¼‰</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li><b>Day 1â€“2ï¼š</b>å—çœ¾/æ”¯æŸ±ç¢ºèªï¼‹é¡Œåº« 20 é¡Œ</li>
                        <li><b>Day 3â€“4ï¼š</b>ä¸€éµç”Ÿæˆè…³æœ¬ 8 æ”¯</li>
                        <li><b>Day 5â€“6ï¼š</b>éŒ„å½±ï¼‹å‰ªè¼¯</li>
                        <li><b>Day 7ï¼š</b>ä¸Šç‰‡ 2 æ”¯ï¼‹è¨˜éŒ„æ•¸æ“š</li>
                        <li><b>Day 8â€“9ï¼š</b>å†ç”¢ 8 æ”¯ï¼ˆå„ªåŒ– Hookï¼‰</li>
                        <li><b>Day 10â€“11ï¼š</b>éŒ„å½±ï¼‹å‰ªè¼¯ï¼ˆæ‰¹é‡ï¼‰</li>
                        <li><b>Day 12â€“13ï¼š</b>ä¸Šç‰‡ 4 æ”¯ï¼‹A/B æ¸¬è©¦</li>
                        <li><b>Day 14ï¼š</b>åŒ¯ç¸½èˆ‡é¡Œç›®æº–å‚™</li>
                      </ul>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                      <h3 style="font-size:18px;margin:0 0 6px;color:#0f172a;">æ¯æ—¥ä»»å‹™ï¼ˆ15â€“30 åˆ†é˜ï¼‰</h3>
                      <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                        <li>10 åˆ†é˜é¸é¡Œï¼‹è…³æœ¬å¾®èª¿</li>
                        <li>10 åˆ†é˜å›è¦†ç•™è¨€ã€è’é›†ç—›é»</li>
                        <li>5 åˆ†é˜è¨˜éŒ„ï¼šæ’­æ”¾ / å®Œæ’­ / äº’å‹•</li>
                        <li>æ¯æ™šå®‰æ’æ˜æ—¥ç´ æï¼ˆæœè£ã€å ´æ™¯ï¼‰</li>
                      </ul>
                    </div>
                  </div>

                  <h2 id="kpi" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">å…­ã€KPI èˆ‡ A/B å¯¦é©—</h2>
                  <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                    <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                      <li>å®Œæ’­ç‡ â‰¥ 35%ï¼ˆ30 ç§’ç‰‡ï¼‰</li>
                      <li>3 ç§’ç•™å­˜ â‰¥ 70%</li>
                      <li>äº’å‹•ç‡ â‰¥ 3%ï¼ˆæŒ‰è®š+ç•™è¨€+æ”¶è— / è§€çœ‹ï¼‰</li>
                      <li>æ¯è¼ªåªæ”¹ã€Œä¸€ä»¶äº‹ã€ï¼Œè¨˜éŒ„ç‰ˆæœ¬å·®ç•°</li>
                    </ul>
                  </div>

                  <h2 id="seo" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">ä¸ƒã€SEO / GEO åœ¨åœ°åŒ–ï¼ˆç¹ä¸­ï¼‰</h2>
                  <div style="background:#fff;border:1px solid #e2e8f0;border-radius:18px;padding:16px;">
                    <ul style="margin:0; padding-left:20px; color:#475569; line-height:1.8;">
                      <li>ä¿ç•™å°ç£å£èªï¼ˆä¾‹ï¼šå…ˆå­˜èµ·ä¾†ã€é€™æ‹›ï¼‰</li>
                      <li>æ¨™é¡Œå«é—œéµè©ï¼šå¹³å°ï¼‹å‹•è©ï¼‹ç›®æ¨™</li>
                      <li>æè¿°å‰ 80 å­—æ”¾ä¸»é—œéµè©ï¼‹CTAï¼›Hashtag 3â€“7 å€‹</li>
                    </ul>
                  </div>

                  <h2 id="prompts" style="font-size: 22px; margin: 22px 0 8px; color: #0f172a; font-weight: 700;">å…«ã€å¯è¤‡è£½çš„ AI æç¤ºè©</h2>
                  <div style="background:#0f172a;color:#fff;border-radius:12px;padding:12px;overflow:auto;">
ç³»çµ±ï¼šä½ æ˜¯çŸ­å½±éŸ³è…³æœ¬æ•™ç·´ï¼Œè¼¸å‡ºç¹ä¸­ï¼ˆå°ç£ï¼‰ï¼Œå­—æ•¸ç²¾ç…‰ã€‚
ä½¿ç”¨è€…ï¼šå¹³å°ï¼IG Reelsï¼›æ”¯æŸ±ï¼æ•™è‚²ï¼›é¡Œç›®ï¼ã€Œç§Ÿå±‹æˆ¿é–“ä¹Ÿèƒ½æ‹å‡ºæ¸…æ™°äººåƒã€ï¼›é•·åº¦ï¼30 ç§’ã€‚
è«‹è¼¸å‡ºï¼š1) Hook 3 ç¨® 2) å£æ’­é€å¥ 3) åˆ†é¡ï¼ˆSOV/B-roll/å­—å¹•ï¼‰4) å–®ä¸€ CTAï¼ˆç•™è¨€é—œéµå­—ï¼‰ã€‚
                  </div>

                  <div style="display: flex; gap: 10px; flex-wrap: nowrap; margin: 18px 0;">
                    <button onclick="goToLogin();" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; background: #2563eb; color: white; border: none; cursor: pointer; flex: 1;">ç«‹å³ç™»å…¥ï¼Œç”Ÿæˆæˆ‘çš„ 14 å¤©è¨ˆç•«</button>
                    <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display: inline-flex; align-items: center; justify-content: center; height: 46px; padding: 0 14px; border-radius: 999px; font-weight: 700; font-size: 14px; border: 1px solid #cbd5e1; color: #334155; background: white; text-decoration: none; cursor: pointer; flex: 1;">åŠ å…¥ Discordï¼Œå’Œå¤§å®¶ä¸€èµ·åŸ·è¡Œ</a>
                  </div>
                </div>
              </article>

              <!-- Footer -->
              <footer style="padding: 26px 0; color: #64748b; text-align: center; border-top: 1px solid #e2e8f0; font-size: 14px;">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">Â© 2025 ReelMind Â· AI çŸ­å½±éŸ³ Â· å°ç£</div>
              </footer>
            </div>
          </div>

          <!-- æ–‡ç« ï¼šReels / Shorts / TikTok è…³æœ¬å·®ç•° -->
          <div id="guide-article3" class="page">
            <div>
              <!-- Header -->
              <header style="padding: 56px 0 18px; border-bottom: 1px solid #e2e8f0; background: linear-gradient(135deg, rgba(14,165,233,.10), transparent 60%), linear-gradient(135deg, rgba(167,139,250,.10), transparent 60%);">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                  <div style="font-size: 12px; color: #64748b; margin-bottom: 10px;">
                    <a onclick="switchPage('homepage'); return false;" style="text-decoration: none; color: #64748b; cursor: pointer;">é¦–é </a> / 
                    <a onclick="switchPage('guide'); return false;" style="text-decoration: none; color: #64748b; cursor: pointer;">AI çŸ­å½±éŸ³å¯¦æˆ°æŒ‡å—</a> / æ–‡ç« 
                  </div>
                  <h1 style="font-size: 30px; margin: 0 0 6px; color: #0f172a; font-weight: 800;">Reels / Shorts / TikTok è…³æœ¬å·®ç•°</h1>
                  <p style="color: #475569; margin: 0 0 8px; line-height: 1.6;">ä¸‰å¹³å°åŒé¡Œç›®ã€Œä¸åŒå¯«æ³•ã€ï¼šReels é‡å“ç‰Œæ•˜äº‹ã€Shorts å¼·å¿«è³‡è¨Šã€TikTok é‡å¨›æ¨‚äº’å‹•ã€‚æŠŠåŒä¸€æ”¯ç´ ææ”¹å¯«å‡ºä¸‰ç¨®æ‰“æ³•ã€‚</p>
                </div>
              </header>

              <!-- Article -->
              <article style="padding: 28px 0;">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">
                  <section style="background:#0f172a;border:1px solid #1f2937;border-radius:16px;padding:16px;color:#e5e7eb;">
                    <h2 style="font-size: 22px; margin: 0 0 8px; color:#e5e7eb;">ä¸€ã€å·®ç•°é€Ÿè¦½</h2>
                    <div style="overflow:auto;">
                      <table style="width:100%; border-collapse:separate; border-spacing:0 10px;">
                        <tr style="background:#111827;">
                          <td style="padding:10px 12px; font-weight:700; color:#94a3b8;">é‡é»</td>
                          <td style="padding:10px 12px;">Reelsï¼šå“ç‰Œèª¿æ€§ã€ç•«é¢ä¸€è‡´</td>
                          <td style="padding:10px 12px;">Shortsï¼šå¿«è¨Šæ¯ã€å¯æª¢ç´¢æ¨™é¡Œ</td>
                          <td style="padding:10px 12px;">TikTokï¼šå¨›æ¨‚æ€§ã€äº’å‹•èª˜ç™¼</td>
                        </tr>
                        <tr style="background:#0f172a;">
                          <td style="padding:10px 12px; font-weight:700; color:#94a3b8;">Hook</td>
                          <td style="padding:10px 12px;">æ•˜äº‹å¼ï¼šä½ ä¹Ÿé‡åˆ°é€™å•é¡Œå—ï¼Ÿ</td>
                          <td style="padding:10px 12px;">æ•¸æ“šå¼ï¼š30 ç§’æ•™æœƒä½ â€¦</td>
                          <td style="padding:10px 12px;">åå·®å¼ï¼šå…¶å¯¦æˆ‘ä¸€é–‹å§‹æ˜¯å¤±æ•—çš„â€¦</td>
                        </tr>
                        <tr style="background:#111827;">
                          <td style="padding:10px 12px; font-weight:700; color:#94a3b8;">CTA</td>
                          <td style="padding:10px 12px;">å­˜èµ·ä¾†ï¼‹é—œæ³¨å“ç‰Œ</td>
                          <td style="padding:10px 12px;">çœ‹æè¿°é€£çµ / æ–‡ç« </td>
                          <td style="padding:10px 12px;">ç•™è¨€é—œéµå­—é ˜æª”æ¡ˆ</td>
                        </tr>
                      </table>
                    </div>
                  </section>

                  <section style="display:grid; gap:14px; grid-template-columns:1fr; margin-top:14px;">
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:16px;padding:16px;">
                      <span style="display:inline-block;padding:6px 10px;border-radius:999px;background:#ecfeff;border:1px solid #cffafe;color:#06b6d4;font-weight:800;font-size:12px;margin-bottom:6px;">Reels</span>
                      <div style="height:1px;background:linear-gradient(90deg,transparent,#e5e7eb,transparent);margin:10px 0"></div>
                      <div style="font-weight:700;color:#0f172a;">å¯«æ³•å»ºè­°</div>
                      <p style="color:#475569;">èªæ°£ç©©é‡ã€é¡é ­ä¹¾æ·¨ã€å­—å¹•å°‘è€Œæº–ã€‚ç”¨å“ç‰Œè‰²å°é¢èˆ‡å›ºå®šæ¨¡æ¿ã€‚</p>
                      <div style="font-weight:700;color:#0f172a;">ç¯„ä¾‹ Hook</div>
                      <p style="color:#475569;">ã€Œå¦‚æœä»Šå¤©é‡ä¾†ï¼Œæˆ‘åªä¿ç•™ä¸‰å€‹å‹•ä½œâ€¦ã€</p>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:16px;padding:16px;">
                      <span style="display:inline-block;padding:6px 10px;border-radius:999px;background:#f5f3ff;border:1px solid #ede9fe;color:#7c3aed;font-weight:800;font-size:12px;margin-bottom:6px;">Shorts</span>
                      <div style="height:1px;background:linear-gradient(90deg,transparent,#e5e7eb,transparent);margin:10px 0"></div>
                      <div style="font-weight:700;color:#0f172a;">å¯«æ³•å»ºè­°</div>
                      <p style="color:#475569;">å‰ 3 ç§’å°±çµ¦çµè«–ï¼Œæ¨™é¡Œå«é—œéµè©ï¼Œå­—å¹•ç¯€å¥å¿«ã€‚</p>
                      <div style="font-weight:700;color:#0f172a;">ç¯„ä¾‹ Hook</div>
                      <p style="color:#475569;">ã€Œ90 ç§’æ•™ä½ å®Œæˆ Xï¼Œæ­¥é©Ÿéƒ½åœ¨é€™è£¡ã€‚ã€</p>
                    </div>
                    <div style="background:#fff;border:1px solid #e2e8f0;border-radius:16px;padding:16px;">
                      <span style="display:inline-block;padding:6px 10px;border-radius:999px;background:#ecfccb;border:1px solid #d9f99d;color:#65a30d;font-weight:800;font-size:12px;margin-bottom:6px;">TikTok</span>
                      <div style="height:1px;background:linear-gradient(90deg,transparent,#e5e7eb,transparent);margin:10px 0"></div>
                      <div style="font-weight:700;color:#0f172a;">å¯«æ³•å»ºè­°</div>
                      <p style="color:#475569;">è¡¨æƒ…å¤šã€äº’å‹•è©å¼·ã€å¯ç”¨æ¢—éŸ³æ¨‚æˆ–æŒ‘æˆ°æ ¼å¼ã€‚</p>
                      <div style="font-weight:700;color:#0f172a;">ç¯„ä¾‹ Hook</div>
                      <p style="color:#475569;">ã€Œæˆ‘ä¿è­‰çœ‹å®Œä½ ä¸€å®šæœƒè©¦ä¸€æ¬¡ã€‚ã€</p>
                    </div>
                  </section>

                  <div style="display:flex;gap:10px;flex-wrap:wrap;margin:18px 0 0 0;">
                    <a class="btn sky" onclick="goToLogin();" style="display:inline-flex;height:46px;align-items:center;justify-content:center;padding:0 18px;border-radius:999px;font-weight:900;background:#06b6d4;color:#001018;text-decoration:none;cursor:pointer;">ç™»å…¥è§£é– AI ç”Ÿæˆ</a>
                    <a class="btn alt" href="https://AIJobschool.short.gy/UUwpEG" target="_blank" style="display:inline-flex;height:46px;align-items:center;justify-content:center;padding:0 18px;border-radius:999px;font-weight:900;border:1px solid #cbd5e1;color:#334155;background:#fff;text-decoration:none;">åˆ° Discord çœ‹ç¯„ä¾‹</a>
                  </div>
                </div>
              </article>

              <!-- Footer -->
              <footer style="padding: 26px 0; color: #64748b; text-align: center; border-top: 1px solid #e2e8f0; font-size: 14px;">
                <div style="max-width: 880px; margin: 0 auto; padding: 0 40px;">Â© 2025 ReelMind Â· AI çŸ­å½±éŸ³ Â· å°ç£</div>
              </footer>
            </div>
          </div>

<!-- æ¨¡å¼1ï¼šä¸€éµç”Ÿæˆé é¢ -->
          <div id="mode1" class="page">
            <div class="mode1-page">
              <!-- å·¦åŠéƒ¨ï¼šç”¨æˆ¶éœ€æ±‚è¨­å®š -->
              <div class="mode1-left">
                <h2 class="section-title">
                  <span>âš™ï¸</span>
                  ç”¨æˆ¶éœ€æ±‚è¨­å®š
                </h2>
                <!-- é€™è£¡å°‡æ”¾ç½®åŸæœ‰çš„ç”¨æˆ¶éœ€æ±‚è¨­å®šè¡¨å–® -->
                <div id="userSettingsContainer">
                  <!-- åŸæœ‰çš„ç”¨æˆ¶éœ€æ±‚è¨­å®šå…§å®¹å°‡ç§»å‹•åˆ°é€™è£¡ -->
                </div>
                
                <!-- ä¸€éµç”Ÿæˆä½¿ç”¨èªªæ˜ -->
                <div class="one-click-instructions" id="oneClickInstructions" style="display: none;">
                  <h3>ğŸš€ ä¸€éµç”Ÿæˆä½¿ç”¨èªªæ˜</h3>
                  <div class="instruction-steps">
                    <div class="step">
                      <div class="step-number">1</div>
                      <div class="step-content">
                        <strong>è¨­å®šéœ€æ±‚</strong>
                        <p>é¸æ“‡å¹³å°ã€è¼¸å…¥ä¸»é¡Œã€è¨­å®šç§’æ•¸å’Œå¸³è™Ÿå®šä½ï¼Œç„¶å¾Œé»æ“Šã€Œå¥—ç”¨è¨­å®šã€</p>
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">2</div>
                      <div class="step-content">
                        <strong>ç”Ÿæˆå¸³è™Ÿå®šä½</strong>
                        <p>é»æ“Šå³å´ã€Œä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½ã€æŒ‰éˆ•ï¼ŒAIå°‡åˆ†ææ‚¨çš„å¸³è™Ÿå®šä½</p>
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">3</div>
                      <div class="step-content">
                        <strong>ç”Ÿæˆé¸é¡Œ</strong>
                        <p>é»æ“Šã€Œä¸€éµç”Ÿæˆé¸é¡Œã€æŒ‰éˆ•ï¼ŒAIå°‡ç‚ºæ‚¨æ¨è–¦é©åˆçš„è…³æœ¬ä¸»é¡Œ</p>
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">4</div>
                      <div class="step-content">
                        <strong>ç”Ÿæˆè…³æœ¬</strong>
                        <p>é»æ“Šã€Œä¸€éµç”Ÿæˆè…³æœ¬ã€æŒ‰éˆ•ï¼ŒAIå°‡ç”Ÿæˆå®Œæ•´çš„çŸ­å½±éŸ³è…³æœ¬</p>
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">5</div>
                      <div class="step-content">
                        <strong>å„²å­˜æˆ–é‡æ–°ç”Ÿæˆ</strong>
                        <p>æ»¿æ„çµæœå¯é»æ“Šã€Œå„²å­˜ã€ï¼Œä¸æ»¿æ„å¯é»æ“Šã€Œå†æ›ä¸€å€‹ã€é‡æ–°ç”Ÿæˆ</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- å³åŠéƒ¨ï¼šä¸€éµç”Ÿæˆçµæœå€å¡Š -->
              <div class="mode1-right">
                <h2 class="section-title">
                  <span>ğŸš€</span>
                  ä¸€éµç”Ÿæˆè…³æœ¬
                </h2>
                <!-- é€™è£¡å°‡æ”¾ç½®åŸæœ‰çš„ä¸€éµç”ŸæˆåŠŸèƒ½ -->
                <div id="oneClickGenerationContainer">
                  <!-- åŸæœ‰çš„ä¸€éµç”Ÿæˆå…§å®¹å°‡ç§»å‹•åˆ°é€™è£¡ -->
                </div>
              </div>
            </div>
          </div>

          <!-- æ¨¡å¼2ï¼šAIé¡§å•å°è©±é é¢ -->
          <div id="mode2" class="page mode2 fig1">
            <div class="mode2-page">
              <!-- èªªæ˜æŒ‰éˆ• -->
              <div class="instructions-toggle-btn" onclick="toggleInstructionsDrawer()">
                <span class="btn-icon">ğŸ“‹</span>
                <span class="btn-text">ä½¿ç”¨èªªæ˜</span>
              </div>
              
              <!-- èªªæ˜æŠ½å±œèƒŒæ™¯é®ç½© -->
              <div id="drawerOverlay" class="drawer-overlay" onclick="toggleInstructionsDrawer()"></div>
              
              <!-- èªªæ˜æŠ½å±œ -->
              <div id="instructionsDrawer" class="instructions-drawer">
                <div class="drawer-header">
                  <h3>å¦‚ä½•ä½¿ç”¨ AI çŸ­å½±éŸ³é¡§å• ğŸš€</h3>
                  <button class="drawer-close-btn" onclick="toggleInstructionsDrawer()">âœ•</button>
                </div>
                <div class="drawer-content">
                  <p><strong>ğŸ¯ AIçŸ­å½±éŸ³é¡§å•æ¨¡å¼</strong></p>
                  <p>é€éèˆ‡AIæ·±åº¦å°è©±ï¼Œç²å¾—å°ˆæ¥­çš„çŸ­å½±éŸ³å‰µä½œæŒ‡å°å’Œç­–ç•¥å»ºè­°ã€‚</p>
                  
                  <p><strong>ğŸš€ æ“ä½œæ­¥é©Ÿï¼š</strong></p>
                  <div class="step-guide">
                    <div class="step">
                      <div class="step-number">1</div>
                      <div class="step-content">
                        <strong>æè¿°éœ€æ±‚</strong><br>
                        å‘Šè¨´AIä½ çš„ç›®æ¨™ã€å—çœ¾ã€å…§å®¹æ–¹å‘æˆ–é‡åˆ°çš„å•é¡Œ
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">2</div>
                      <div class="step-content">
                        <strong>æ·±åº¦å°è©±</strong><br>
                        èˆ‡AIé€²è¡Œå¤šè¼ªå°è©±ï¼Œæ·±å…¥æ¢è¨å‰µä½œç­–ç•¥å’ŒåŸ·è¡Œæ–¹æ¡ˆ
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">3</div>
                      <div class="step-content">
                        <strong>ç²å¾—å»ºè­°</strong><br>
                        AIæä¾›å°ˆæ¥­çš„å¸³è™Ÿå®šä½ã€é¸é¡Œå»ºè­°ã€è…³æœ¬å‰µä½œæŒ‡å°
                      </div>
                    </div>
                    <div class="step">
                      <div class="step-number">4</div>
                      <div class="step-content">
                        <strong>æŒçºŒå„ªåŒ–</strong><br>
                        æ ¹æ“šAIå»ºè­°èª¿æ•´å…§å®¹ï¼Œç›´åˆ°é”åˆ°ç†æƒ³æ•ˆæœ
                      </div>
                    </div>
                  </div>
                  
                  <p><strong>ğŸ’¡ å°ˆæ¥­æœå‹™ï¼š</strong></p>
                  <ul>
                    <li>ğŸ¯ å¸³è™Ÿå®šä½ç­–ç•¥åˆ†æ</li>
                    <li>ğŸ“ å…§å®¹é¸é¡Œå»ºè­°</li>
                    <li>âœï¸ è…³æœ¬å‰µä½œæŒ‡å°</li>
                    <li>ğŸ“Š æ•¸æ“šåˆ†æè§£è®€</li>
                    <li>ğŸš€ çˆ†æ¬¾å…§å®¹ç­–ç•¥</li>
                    <li>ğŸ‘¥ å—çœ¾åˆ†ææ´å¯Ÿ</li>
                  </ul>
                  
                  <p><strong>ğŸ’¬ ä½¿ç”¨æŠ€å·§ï¼š</strong></p>
                  <p>â€¢ è©³ç´°æè¿°ä½ çš„èƒŒæ™¯å’Œç›®æ¨™<br>
                  â€¢ æå‡ºå…·é«”å•é¡Œç²å¾—ç²¾æº–å»ºè­°<br>
                  â€¢ å¤šè¼ªå°è©±æ·±å…¥æ¢è¨ç´°ç¯€<br>
                  â€¢ å–„ç”¨å¿«é€ŸæŒ‰éˆ•å¿«é€Ÿé–‹å§‹å°è©±</p>
                </div>
              </div>
              
              <!-- èŠå¤©è¨Šæ¯å€åŸŸ -->
              <div id="chatMessages" class="chat-messages">
                <!-- èŠå¤©è¨Šæ¯å°‡åœ¨é€™è£¡å‹•æ…‹æ’å…¥ -->
              </div>
              
              <!-- è¼¸å…¥å€åŸŸ -->
              <div class="input-row">
                <div class="input-container">
                  <!-- è¼¸å…¥æ¡†åŒ…è£å™¨ï¼ˆç”¨æ–¼æ”¾ç½®å¿«é€ŸæŒ‰éˆ•ï¼‰ -->
                  <div class="input-wrapper">
                    <!-- è¼¸å…¥æ¡†å’Œç™¼é€æŒ‰éˆ•åœ¨åŒä¸€è¡Œ -->
                    <div class="input-row-inner">
                      <textarea id="messageInput" class="chat-input" placeholder="å‘AIé¡§å•æå•..." rows="1"></textarea>
                      <button id="sendBtn" class="send-btn" disabled>
                        <i class="fas fa-paper-plane"></i>
                      </button>
                    </div>
                    <!-- å¿«é€ŸæŒ‰éˆ•å€åŸŸ - æ”¾åœ¨è¼¸å…¥æ¡†å…§åº•éƒ¨ -->
                    <div class="quick-buttons" id="quickButtons">
                      <button class="quick-btn" data-text="æˆ‘è¦å¦‚ä½•é–‹å§‹ï¼Ÿ">æˆ‘è¦å¦‚ä½•é–‹å§‹ï¼Ÿ</button>
                      <button class="quick-btn" data-text="æˆ‘è¦æ€éº¼å¸³è™Ÿå®šä½">æˆ‘è¦æ€éº¼å¸³è™Ÿå®šä½</button>
                      <button class="quick-btn" data-text="ä»€éº¼æ˜¯è…³æœ¬é¸é¡Œ">ä»€éº¼æ˜¯è…³æœ¬é¸é¡Œ</button>
                    </div>
                  </div>
                </div>
              </div>
              
              </div>
            </div>
          </div>

          <!-- æ¨¡å¼3ï¼šIPäººè¨­è¦åŠƒé é¢ -->
          <div id="mode3" class="page mode3-fixed mode3 fig1">
              <!-- ä½¿ç”¨èªªæ˜æŒ‰éˆ• -->
              <div class="mode3-instructions-btn-container">
                <button class="mode3-instructions-btn" onclick="toggleMode3InstructionsDrawer()">
                  <span class="mode3-instructions-icon">ğŸ“‹</span>
                  <span class="mode3-instructions-text">ä½¿ç”¨èªªæ˜</span>
                </button>
                    </div>
              
              <!-- ç”ŸæˆçµæœæŒ‰éˆ• -->
              <div class="mode3-results-btn-container">
                <button class="mode3-results-btn" onclick="toggleMode3ResultsDrawer()">
                  <span class="mode3-results-icon">ğŸ“Š</span>
                  <span class="mode3-results-text">ç”Ÿæˆçµæœ</span>
                </button>
                  </div>

            <div class="mode3-page">
              <!-- èŠå¤©è¨Šæ¯å€åŸŸ -->
              <div id="mode3-chatMessages" class="chat-messages">
                <!-- æ­¡è¿è¨Šæ¯å·²ç§»é™¤ -->
                    </div>

              <!-- è¼¸å…¥å€åŸŸ -->
                    <div class="input-row">
                      <div class="input-container">
                        <div class="input-wrapper">
                          <div class="input-row-inner">
                      <textarea id="mode3-messageInput" class="chat-input" placeholder="å‘AIé¡§å•æå•..." rows="1"></textarea>
                      <button id="mode3-sendBtn" class="send-btn" disabled>
                              <i class="fas fa-paper-plane"></i>
                            </button>
                          </div>
                    <!-- å¿«é€ŸæŒ‰éˆ•å€åŸŸ - IPäººè¨­è¦åŠƒçš„æŒ‰éˆ• -->
                          <div class="quick-buttons" id="mode3-quickButtons">
                      <button class="quick-btn" data-text="æˆ‘æƒ³åˆ†äº«æˆ‘çš„å°ˆæ¥­ç¶“é©—">å°ˆæ¥­ç¶“é©—</button>
                      <button class="quick-btn" data-text="æˆ‘æƒ³å»ºç«‹å€‹äººå“ç‰Œ">å€‹äººå“ç‰Œ</button>
                      <button class="quick-btn" data-text="æˆ‘æƒ³åˆ†äº«ç”Ÿæ´»æ•…äº‹">ç”Ÿæ´»æ•…äº‹</button>
                      <button class="quick-btn" data-text="æˆ‘æƒ³åšçŸ¥è­˜åˆ†äº«">çŸ¥è­˜åˆ†äº«</button>
                        </div>
                      </div>
                    </div>
                  </div>
            </div>
          </div>

          <!-- å‰µä½œè€…è³‡æ–™åº«é é¢ -->
          <div id="userDB" class="page">
            <div class="user-db-page">
              <h2 class="page-title">ğŸ‘¤ å‰µä½œè€…è³‡æ–™åº«</h2>
              <div class="user-db-container">
                <!-- å·¦å´åŠŸèƒ½é¸å–® -->
                <div class="user-db-sidebar">
                  <div class="sidebar-header">
                    <div class="user-profile">
                      <img id="dbUserAvatar" class="profile-avatar" src="" alt="ç”¨æˆ¶é ­åƒ">
                      <div class="profile-info">
                        <h3 id="dbUserName">ç”¨æˆ¶åç¨±</h3>
                        <p id="dbUserEmail">user@example.com</p>
                      </div>
                    </div>
                  </div>
                  <nav class="sidebar-menu">
                    <div class="menu-item" onclick="showDbSection('personalInfo')">
                      <span class="menu-icon">ğŸ‘¤</span>
                      <span class="menu-text">å€‹äººè³‡æ–™</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('myScripts')">
                      <span class="menu-icon">ğŸ’¾</span>
                      <span class="menu-text">æˆ‘çš„è…³æœ¬</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('accountPositioning')">
                      <span class="menu-icon">ğŸ¯</span>
                      <span class="menu-text">å¸³è™Ÿå®šä½</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('topicRecords')">
                      <span class="menu-icon">ğŸ’¡</span>
                      <span class="menu-text">é¸é¡Œå…§å®¹</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('ipPlanning')">
                      <span class="menu-icon">ğŸ­</span>
                      <span class="menu-text">IPäººè¨­è¦åŠƒ</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('myOrders')">
                      <span class="menu-icon">ğŸ’³</span>
                      <span class="menu-text">æˆ‘çš„è¨‚å–®</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('settings')">
                      <span class="menu-icon">âš™ï¸</span>
                      <span class="menu-text">è¨­å®š</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('usageStats')">
                      <span class="menu-icon">ğŸ“Š</span>
                      <span class="menu-text">ä½¿ç”¨çµ±è¨ˆ</span>
                    </div>
                    <div class="menu-item" onclick="showDbSection('helpCenter')">
                      <span class="menu-icon">â“</span>
                      <span class="menu-text">å¹«åŠ©ä¸­å¿ƒ</span>
                    </div>
                    <div class="menu-divider"></div>
                    <div class="menu-item logout-item" onclick="logout()">
                      <span class="menu-icon">ğŸšª</span>
                      <span class="menu-text">ç™»å‡º</span>
                    </div>
                  </nav>
                </div>
                <!-- å³å´å…§å®¹å€åŸŸ -->
                <div class="user-db-content">
                  <!-- å€‹äººè³‡æ–™ -->
                  <div id="db-personalInfo" class="db-section active">
                    <h3 class="section-title">ğŸ‘¤ å€‹äººè³‡æ–™</h3>
                    <div class="section-content">
                      <p>å€‹äººè³‡æ–™åŠŸèƒ½é–‹ç™¼ä¸­...</p>
                    </div>
                  </div>
                  <!-- æˆ‘çš„è…³æœ¬ -->
                  <div id="db-myScripts" class="db-section">
                    <h3 class="section-title">ğŸ’¾ æˆ‘çš„è…³æœ¬</h3>
                    <div class="section-content">
                      <p>æˆ‘çš„è…³æœ¬åŠŸèƒ½é–‹ç™¼ä¸­...</p>
                    </div>
                  </div>
                  <!-- å¸³è™Ÿå®šä½ -->
                  <div id="db-accountPositioning" class="db-section">
                    <h3 class="section-title">ğŸ¯ å¸³è™Ÿå®šä½</h3>
                    <div class="section-content">
                      <p>å¸³è™Ÿå®šä½åŠŸèƒ½é–‹ç™¼ä¸­...</p>
                    </div>
                  </div>
                  <!-- é¸é¡Œå…§å®¹ -->
                  <div id="db-topicRecords" class="db-section">
                    <h3 class="section-title">ğŸ’¡ é¸é¡Œå…§å®¹</h3>
                    <div class="section-content">
                      <p>æ­£åœ¨è¼‰å…¥é¸é¡Œå…§å®¹...</p>
                    </div>
                  </div>
                  <!-- IPäººè¨­è¦åŠƒ -->
                  <div id="db-ipPlanning" class="db-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 12px;">
                      <h3 class="section-title">ğŸ­ IPäººè¨­è¦åŠƒ</h3>
                      <button onclick="exportIpPlanningResults()" style="padding: 8px 16px; background: #3B82F6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; font-weight: 500;">ğŸ“¥ åŒ¯å‡º</button>
                    </div>
                    <div class="section-content">
                      <div class="ip-planning-tabs" style="display: flex; gap: 8px; margin-bottom: 20px; border-bottom: 2px solid #E5E7EB;">
                        <button class="ip-planning-tab active" onclick="showIpPlanningType('profile')" style="padding: 8px 16px; border: none; background: transparent; cursor: pointer; border-bottom: 2px solid #3B82F6; color: #3B82F6; font-weight: 600;">IP Profile</button>
                        <button class="ip-planning-tab" onclick="showIpPlanningType('plan')" style="padding: 8px 16px; border: none; background: transparent; cursor: pointer; color: #6B7280;">14å¤©è¦åŠƒ</button>
                        <button class="ip-planning-tab" onclick="showIpPlanningType('scripts')" style="padding: 8px 16px; border: none; background: transparent; cursor: pointer; color: #6B7280;">ä»Šæ—¥è…³æœ¬</button>
                      </div>
                      <div id="ip-planning-content" class="ip-planning-content">
                        <div class="loading-text">è¼‰å…¥ä¸­...</div>
                      </div>
                    </div>
                  </div>
                  <!-- æˆ‘çš„è¨‚å–® -->
                  <div id="db-myOrders" class="db-section">
                    <h3 class="section-title">ğŸ’³ æˆ‘çš„è¨‚å–®</h3>
                    <div class="section-content" id="myOrdersContent">
                      <div class="loading-text">è¼‰å…¥ä¸­...</div>
                    </div>
                  </div>
                  <!-- è¨­å®š -->
                  <div id="db-settings" class="db-section">
                    <h3 class="section-title">âš™ï¸ è¨­å®š</h3>
                    <div class="section-content" id="settingsContent">
                      <div class="settings-container">
                        <!-- BYOK èªªæ˜ï¼ˆæ”¾åœ¨æœ€ä¸Šé¢ï¼‰ -->
                        <div class="byok-notice" style="margin-bottom: 24px; padding: 16px; background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px; transition: background-color 0.3s ease, border-color 0.3s ease;">
                          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                            <span style="font-size: 24px;">ğŸ”‘</span>
                            <h4 style="margin: 0; color: #0369a1; font-size: 16px; font-weight: 600; transition: color 0.3s ease;">å¤§å‹èªè¨€æ¨¡å‹(LLM) API é‡‘é‘°ç®¡ç†</h4>
                          </div>
                          <p style="margin: 0; color: #0c4a6e; font-size: 14px; line-height: 1.6; transition: color 0.3s ease;">
                            ä½¿ç”¨æ‚¨è‡ªå·±çš„ API é‡‘é‘°å¯ä»¥ç²å¾—æ›´é«˜çš„ä½¿ç”¨é¡åº¦å’Œæ›´ç©©å®šçš„æœå‹™
                          </p>
                        </div>
                        
                        <style>
                          /* æ·±è‰²æ¨¡å¼ï¼šBYOK èªªæ˜å€å¡Š */
                          .theme-dark .byok-notice {
                            background: linear-gradient(135deg, #1e3a5f 0%, #2563eb 100%) !important;
                            border-color: rgba(59, 130, 246, 0.3) !important;
                          }
                          
                          .theme-dark .byok-notice h4 {
                            color: #dbeafe !important;
                          }
                          
                          .theme-dark .byok-notice p {
                            color: #bfdbfe !important;
                          }
                        </style>
                        
                        <div class="setting-group">
                          <h4>ğŸ”‘ å¤§å‹èªè¨€æ¨¡å‹(LLM) API é‡‘é‘°ç®¡ç†</h4>
                          <div class="setting-item">
                            <label for="llmProvider">é¸æ“‡å¤§å‹èªè¨€æ¨¡å‹(LLM) æä¾›å•†</label>
                            <select id="llmProvider" style="margin-bottom: 12px;">
                              <option value="gemini">Google Gemini</option>
                              <option value="openai">OpenAI (GPT)</option>
                            </select>
                          </div>
                          <div class="setting-item" id="llmKeyContainer">
                            <label for="llmApiKey">API é‡‘é‘°</label>
                            <div style="display: flex; gap: 8px; align-items: center;">
                              <input 
                                type="password" 
                                id="llmApiKey" 
                                placeholder="è¼¸å…¥æ‚¨çš„ API é‡‘é‘°"
                                style="flex: 1; padding: 8px 12px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                              />
                              <button 
                                type="button" 
                                class="btn btn-secondary" 
                                onclick="toggleApiKeyVisibility()"
                                style="padding: 8px 12px;"
                              >
                                <span id="toggleKeyIcon">ğŸ‘ï¸</span>
                              </button>
                            </div>
                            <div id="savedKeyDisplay" style="display: none; margin-top: 8px;">
                              <span style="color: #6b7280; font-size: 12px;">å·²ä¿å­˜çš„é‡‘é‘°: <span id="savedKeyLast4"></span></span>
                              <button 
                                type="button" 
                                class="btn btn-link" 
                                onclick="clearSavedApiKey()"
                                style="margin-left: 8px; padding: 4px 8px; font-size: 12px; color: #ef4444;"
                              >
                                æ¸…é™¤
                              </button>
                            </div>
                            <span class="setting-desc" style="margin-top: 8px; display: block;">
                              æ‚¨çš„ API é‡‘é‘°å°‡ä»¥åŠ å¯†æ–¹å¼å®‰å…¨å­˜å„²åœ¨ä¼ºæœå™¨ä¸Šï¼Œåƒ…ç”¨æ–¼ç”Ÿæˆ AI å…§å®¹
                            </span>
                          </div>
                          <div class="setting-item">
                            <button class="btn btn-primary" onclick="saveApiKey()" style="margin-right: 8px;">ğŸ’¾ ä¿å­˜é‡‘é‘°</button>
                            <button class="btn btn-secondary" onclick="testApiKey()">ğŸ§ª æ¸¬è©¦é‡‘é‘°</button>
                            <span class="setting-desc" style="display: block; margin-top: 8px;">
                              ä¿å­˜å‰å»ºè­°å…ˆæ¸¬è©¦é‡‘é‘°æ˜¯å¦æœ‰æ•ˆ
                            </span>
                            <!-- æ¸¬è©¦çµæœè¨Šæ¯æ¡† -->
                            <div id="testKeyResult" style="display: none; margin-top: 12px; padding: 12px; border-radius: 6px; font-size: 14px;"></div>
                          </div>
                        </div>
                        
                        <div class="setting-group">
                          <h4>ğŸ“Š æ•¸æ“šç®¡ç†</h4>
                          <div class="setting-item">
                            <button class="btn btn-secondary" onclick="exportUserData()">ğŸ“¥ åŒ¯å‡ºæˆ‘çš„è³‡æ–™</button>
                            <span class="setting-desc">åŒ¯å‡ºæ‰€æœ‰è…³æœ¬ã€å°è©±ã€å®šä½è¨˜éŒ„ç‚º CSV æª”æ¡ˆ</span>
                          </div>
                          <div class="setting-item">
                            <button class="btn btn-danger" onclick="clearUserData()">ğŸ—‘ï¸ æ¸…é™¤æœ¬åœ°å¿«å–</button>
                            <span class="setting-desc">æ¸…é™¤æœ¬åœ°æš«å­˜æ•¸æ“š</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- ä½¿ç”¨çµ±è¨ˆ -->
                  <div id="db-usageStats" class="db-section">
                    <h3 class="section-title">ğŸ“Š ä½¿ç”¨çµ±è¨ˆ</h3>
                    <div class="section-content" id="usageStatsContent">
                      <div class="stats-overview">
                        <div class="stat-card">
                          <div class="stat-number" id="totalScripts">0</div>
                          <div class="stat-label">å·²ç”Ÿæˆè…³æœ¬</div>
                        </div>
                        <div class="stat-card">
                          <div class="stat-number" id="totalPositioning">0</div>
                          <div class="stat-label">å¸³è™Ÿå®šä½è¨˜éŒ„</div>
                        </div>
                        <div class="stat-card">
                          <div class="stat-number" id="totalTopics">0</div>
                          <div class="stat-label">é¸é¡Œè¨˜éŒ„</div>
                        </div>
                        <div class="stat-card">
                          <div class="stat-number" id="totalConversations">0</div>
                          <div class="stat-label">å°è©±æ¬¡æ•¸</div>
                        </div>
                      </div>
                      <div class="stats-chart">
                        <canvas id="usageChart"></canvas>
                      </div>
                    </div>
                  </div>
                  <!-- å¹«åŠ©ä¸­å¿ƒ -->
                  <div id="db-helpCenter" class="db-section">
                    <h3 class="section-title">â“ å¹«åŠ©ä¸­å¿ƒ</h3>
                    <div class="section-content" id="helpContent">
                      <div class="help-container">
                        <div class="help-section">
                          <h4>ğŸš€ å¿«é€Ÿé–‹å§‹</h4>
                          <ul>
                            <li>é¦–æ¬¡ä½¿ç”¨å»ºè­°å…ˆå˜—è©¦ã€Œä¸€éµç”Ÿæˆã€åŠŸèƒ½</li>
                            <li>é»æ“Šã€Œé–‹å§‹ã€æŒ‰éˆ•å³å¯ç”Ÿæˆå¸³è™Ÿå®šä½ã€é¸é¡Œã€è…³æœ¬</li>
                            <li>æ‰€æœ‰ç”Ÿæˆå…§å®¹æœƒè‡ªå‹•ä¿å­˜åˆ°ã€Œæˆ‘çš„è…³æœ¬ã€</li>
                          </ul>
                        </div>
                        <div class="help-section">
                          <h4>ğŸ“ ä¸‰å¤§ä½¿ç”¨æ¨¡å¼</h4>
                          <ul>
                            <li><strong>ä¸€éµç”Ÿæˆï¼š</strong>å¿«é€Ÿç”Ÿæˆå®šä½ã€é¸é¡Œã€è…³æœ¬</li>
                            <li><strong>AIé¡§å•ï¼š</strong>æ·±åº¦å°è©±ï¼Œå…·å‚™è¨˜æ†¶åŠŸèƒ½</li>
                            <li><strong>IPäººè¨­è¦åŠƒï¼š</strong>14å¤©è¦åŠƒèˆ‡å€‹äººåŒ–è³‡æ–™åº«</li>
                          </ul>
                        </div>
                        <div class="help-section">
                          <h4>ğŸ’¾ è³‡æ–™åº«åŠŸèƒ½</h4>
                          <ul>
                            <li>æ‰€æœ‰ç”Ÿæˆå…§å®¹è‡ªå‹•ä¿å­˜</li>
                            <li>å¯åœ¨ã€Œå‰µä½œè€…è³‡æ–™åº«ã€æŸ¥çœ‹æ­·å²è¨˜éŒ„</li>
                            <li>æ”¯æŒé‡å‘½åã€åˆªé™¤ã€æŸ¥çœ‹è©³æƒ…</li>
                          </ul>
                        </div>
                        <div class="help-section">
                          <h4>â“ å¸¸è¦‹å•é¡Œ</h4>
                          <div class="faq-item">
                            <strong>Q: å¦‚ä½•ä¿å­˜è…³æœ¬ï¼Ÿ</strong>
                            <p>A: é»æ“Šç”Ÿæˆçµæœå³ä¸Šè§’çš„ã€Œä¿å­˜ã€æŒ‰éˆ•å³å¯ã€‚</p>
                          </div>
                          <div class="faq-item">
                            <strong>Q: å¯ä»¥åŒ¯å‡ºè³‡æ–™å—ï¼Ÿ</strong>
                            <p>A: å¯ä»¥ï¼Œåœ¨ã€Œè¨­å®šã€â†’ã€Œè³‡æ–™ç®¡ç†ã€ä¸­é¸æ“‡åŒ¯å‡ºã€‚</p>
                          </div>
                          <div class="faq-item">
                            <strong>Q: å¦‚ä½•åˆªé™¤è¨˜éŒ„ï¼Ÿ</strong>
                            <p>A: åœ¨ã€Œå‰µä½œè€…è³‡æ–™åº«ã€ä¸­æ‰¾åˆ°å°æ‡‰è¨˜éŒ„ï¼Œé»æ“Šåˆªé™¤æŒ‰éˆ•ã€‚</p>
                          </div>
                        </div>
                        <div class="help-section">
                          <h4>ğŸ“ è¯çµ¡æˆ‘å€‘</h4>
                          <p>å¦‚æœ‰å•é¡Œï¼Œè«‹è¯ç¹«å®¢æœï¼š</p>
                          <ul>
                            <li>Email: support@aijob.com</li>
                            <li>Discord: <a href="https://AIJobschool.short.gy/UUwpEG" target="_blank">åŠ å…¥ç¤¾ç¾¤</a></li>
                          </ul>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- å´é‚Šæ¬„ -->
      <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <h3 class="sidebar-title">åŠŸèƒ½é¸å–®</h3>
          <button class="sidebar-close" onclick="toggleSidebar()">Ã—</button>
        </div>
        <div class="sidebar-menu">
          <button class="sidebar-item" onclick="showSidebarPage('profile')">ğŸ‘¤ å€‹äººè³‡æ–™</button>
          <button class="sidebar-item" onclick="showSidebarPage('scripts')">ğŸ“ æˆ‘çš„è…³æœ¬</button>
          <button class="sidebar-item" onclick="showSidebarPage('positioning')">ğŸ¯ å¸³è™Ÿå®šä½</button>
          <button class="sidebar-item" onclick="showSidebarPage('topics')">ğŸ’¡ é¸é¡Œè¨˜éŒ„</button>
          <button class="sidebar-item" onclick="showSidebarPage('settings')">âš™ï¸ è¨­å®š</button>
          <button class="sidebar-item" onclick="showSidebarPage('statistics')">ğŸ“Š ä½¿ç”¨çµ±è¨ˆ</button>
          <button class="sidebar-item" onclick="showSidebarPage('help')">â“ å¹«åŠ©ä¸­å¿ƒ</button>
        </div>
      </div>

      <!-- å´é‚Šæ¬„é é¢å®¹å™¨ -->
      <div class="sidebar-page-overlay" id="sidebarPageOverlay" style="display: none;">
        <div class="sidebar-page-container">
          <div class="sidebar-page-header">
            <h2 id="sidebarPageTitle">é é¢æ¨™é¡Œ</h2>
            <button class="sidebar-page-close" onclick="closeSidebarPage()">Ã—</button>
          </div>
          <div class="sidebar-page-content" id="sidebarPageContent">
            <!-- é é¢å…§å®¹å°‡å‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
          </div>
        </div>
      </div>

    </div>
          <div class="left-content">
            <!-- ç”¨æˆ¶éœ€æ±‚è¨­å®šå€å¡Š -->
      <div class="settings-block">
              <h3 id="settingsToggle">ğŸ“‹ ç”¨æˆ¶éœ€æ±‚è¨­å®š <span class="settings-toggle">â–¼</span></h3>
        <div class="settings-content" id="settingsContent">
          <div class="settings-grid">
          <div class="setting-item">
            <label>å¹³å°</label>
                    <select id="platformSelect">
              <option value="">é¸æ“‡å¹³å°</option>
              <option value="TikTok">TikTok</option>
                      <option value="Instagram">Instagram Reels</option>
                      <option value="YouTube">YouTube Shorts</option>
                      <option value="Facebook">Facebook Reels</option>
            </select>
          </div>
          <div class="setting-item">
            <label>ä¸»é¡Œ</label>
                    <input type="text" id="topicInput" placeholder="ä¾‹å¦‚:å¤å­£è®Šç™½æŒ‘æˆ°/ç¾ç™½ä¿é¤Š">
          </div>
          <div class="setting-item">
            <label>è…³æœ¬ç§’æ•¸</label>
                    <select id="durationInput">
                      <option value="15ç§’">15ç§’</option>
                      <option value="30ç§’" selected>30ç§’</option>
                      <option value="45ç§’">45ç§’</option>
                      <option value="60ç§’">60ç§’</option>
            </select>
          </div>
          <div class="setting-item">
            <label>å¸³è™Ÿå®šä½</label>
                    <input type="text" id="positioningInput" placeholder="å¦‚:å¥åº·Ã—åŠ å¯†,è¼•é¬†å¹½é»˜">
          </div>
        </div>
                <button id="applyBtn" class="apply-btn">å¥—ç”¨è¨­å®š</button>
          </div>
            </div>

          </div>
        </div>

        <!-- å³å´é¢æ¿ï¼šçµæœå€å¡Šï¼ˆå¯åˆ‡æ›ï¼‰ -->
        <div class="right-panel">
          <!-- çµæœæ¨™ç±¤åˆ‡æ› -->
          <div class="result-tabs">
            <button class="result-tab active" data-tab="positioning">ğŸ¯ å¸³è™Ÿå®šä½</button>
            <button class="result-tab" data-tab="topics">ğŸ’¡ è…³æœ¬é¸é¡Œ</button>
            <button class="result-tab" data-tab="script">ğŸ“ çŸ­å½±éŸ³è…³æœ¬</button>
          </div>
          
          <!-- çµæœå€å¡Šå®¹å™¨ -->
          <div class="results-container">
            <!-- å¸³è™Ÿå®šä½çµæœ -->
            <div id="positioningResult" class="result-content" style="display: block;">
              <div class="result-header">
                <h3>å¸³è™Ÿå®šä½åˆ†æ</h3>
                <button class="generate-btn" onclick="generatePositioning()">ä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½</button>
              </div>
              <div id="positioningContent" class="result-body">
                è«‹é»é¸ã€Œä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½ã€æŒ‰éˆ•é–‹å§‹
              </div>
              <div class="result-actions" id="positioningActions" style="display: none;">
                <button class="save-btn" onclick="saveResult('positioning')">å„²å­˜</button>
                <button class="regenerate-btn" onclick="regenerateResult('positioning')">å†æ›ä¸€å€‹</button>
              </div>
            </div>
            
            <!-- è…³æœ¬é¸é¡Œçµæœ -->
            <div id="topicSelectionResult" class="result-content" style="display: none;">
              <div class="result-header">
                <h3>è…³æœ¬é¸é¡Œæ¨è–¦</h3>
                <button class="generate-btn" onclick="generateTopics()">ä¸€éµç”Ÿæˆé¸é¡Œ</button>
              </div>
              <div id="topicContent" class="result-body">
                è«‹é»é¸ã€Œä¸€éµç”Ÿæˆé¸é¡Œã€æŒ‰éˆ•é–‹å§‹
              </div>
              <div class="result-actions" id="topicActions" style="display: none;">
                <button class="save-btn" onclick="saveResult('topics')">å„²å­˜</button>
                <button class="regenerate-btn" onclick="regenerateResult('topics')">å†æ›ä¸€å€‹</button>
              </div>
            </div>
            
            <!-- çŸ­å½±éŸ³è…³æœ¬çµæœ -->
            <div id="scriptResult" class="result-content" style="display: none;">
              <div class="result-header">
                <h3>çŸ­å½±éŸ³è…³æœ¬ç”Ÿæˆ</h3>
                <button class="generate-btn" onclick="generateScript()">ä¸€éµç”Ÿæˆè…³æœ¬</button>
              </div>
              <div id="scriptContent" class="result-body">
                è«‹é»é¸ã€Œä¸€éµç”Ÿæˆè…³æœ¬ã€æŒ‰éˆ•é–‹å§‹
              </div>
              <div class="result-actions" id="scriptActions" style="display: none;">
                <button class="save-btn" onclick="saveScript()">å„²å­˜</button>
                <button class="regenerate-btn" onclick="regenerateResult('script')">å†æ›ä¸€å€‹</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ç”¨æˆ¶æŠ½å±œ -->
      <div id="userDrawerOverlay" class="user-drawer-overlay" onclick="closeUserDrawer()"></div>
      <div id="userDrawer" class="user-drawer">
        <!-- æ¨™é¡Œæ¬„ -->
        <div class="user-drawer-header">
          <div class="user-drawer-title">
            <div class="app-logo">AIJob</div>
            <span class="app-name">çŸ­å½±éŸ³é¡§å•</span>
          </div>
          <button class="user-drawer-close" onclick="closeUserDrawer()">Ã—</button>
        </div>
        
        <!-- å·¦å³å…©æ¬„å¸ƒå±€ -->
        <div class="user-drawer-body">
          <!-- å·¦å´é¸å–® -->
          <div class="user-drawer-sidebar">
            <div class="user-profile">
              <img id="drawerAvatar" class="user-drawer-avatar" src="" alt="ç”¨æˆ¶é ­åƒ">
              <div class="user-drawer-info">
                <h3 id="drawerName">ç”¨æˆ¶åç¨±</h3>
                <p id="drawerEmail">user@example.com</p>
              </div>
            </div>
            
            <ul class="user-drawer-menu">
              <li><a href="#" class="active" data-section="personalInfo" onclick="switchDrawerContent('personalInfo')"><span class="icon">ğŸ‘¤</span>å€‹äººè³‡æ–™</a></li>
              <li><a href="#" data-section="myScripts" onclick="switchDrawerContent('myScripts')"><span class="icon">ğŸ’¾</span>æˆ‘çš„è…³æœ¬</a></li>
              <li><a href="#" data-section="accountPositioning" onclick="switchDrawerContent('accountPositioning')"><span class="icon">ğŸ¯</span>å¸³è™Ÿå®šä½</a></li>
              <li><a href="#" data-section="topicHistory" onclick="switchDrawerContent('topicHistory')"><span class="icon">ğŸ’¡</span>é¸é¡Œè¨˜éŒ„</a></li>
              <li><a href="#" data-section="settings" onclick="switchDrawerContent('settings')"><span class="icon">âš™ï¸</span>è¨­å®š</a></li>
              <li><a href="#" data-section="usageStats" onclick="switchDrawerContent('usageStats')"><span class="icon">ğŸ“Š</span>ä½¿ç”¨çµ±è¨ˆ</a></li>
              <li><a href="#" data-section="helpCenter" onclick="switchDrawerContent('helpCenter')"><span class="icon">â“</span>å¹«åŠ©ä¸­å¿ƒ</a></li>
            </ul>
          </div>
          
          <!-- å³å´å…§å®¹å€åŸŸ -->
          <div class="user-drawer-content">
            <!-- å€‹äººè³‡æ–™ -->
            <div id="personalInfo" class="content-section active">
              <h2>å€‹äººè³‡æ–™</h2>
              <div class="user-info-detail">
                <div class="info-item">
                  <label>å§“åï¼š</label>
                  <span id="userNameDetail">-</span>
                </div>
                <div class="info-item">
                  <label>ä¿¡ç®±ï¼š</label>
                  <span id="userEmailDetail">-</span>
                </div>
                <div class="info-item">
                  <label>ç”¨æˆ¶IDï¼š</label>
                  <span id="userIdDetail">-</span>
                </div>
              </div>
            </div>
            
            <!-- æˆ‘çš„è…³æœ¬ -->
            <div id="myScripts" class="content-section">
              <h2>æˆ‘çš„è…³æœ¬</h2>
              <div id="generationsList" class="generations-list">
                <div class="loading-text">è¼‰å…¥ä¸­...</div>
              </div>
            </div>
            
            <!-- å¸³è™Ÿå®šä½ -->
            <div id="accountPositioning" class="content-section">
              <h2>å¸³è™Ÿå®šä½è¨˜éŒ„</h2>
              <div id="positioningHistoryContent" class="positioning-history-content">
                <div class="loading-text">è¼‰å…¥ä¸­...</div>
              </div>
            </div>
            
            <!-- é¸é¡Œè¨˜éŒ„ -->
            <div id="topicHistory" class="content-section">
              <h2>é¸é¡Œè¨˜éŒ„</h2>
              <div id="conversationsList" class="conversations-list">
                <div class="loading-text">è¼‰å…¥ä¸­...</div>
              </div>
            </div>
            
            <!-- è¨­å®š -->
            <div id="settings" class="content-section">
              <h2>è¨­å®š</h2>
              <div class="settings-content">
                <p>è¨­å®šåŠŸèƒ½é–‹ç™¼ä¸­...</p>
              </div>
            </div>
            
            <!-- ä½¿ç”¨çµ±è¨ˆ -->
            <div id="usageStats" class="content-section">
              <h2>ä½¿ç”¨çµ±è¨ˆ</h2>
              <div class="stats-content">
                <p>çµ±è¨ˆåŠŸèƒ½é–‹ç™¼ä¸­...</p>
              </div>
            </div>
            
            <!-- å¹«åŠ©ä¸­å¿ƒ -->
            <div id="helpCenter" class="content-section">
              <h2>å¹«åŠ©ä¸­å¿ƒ</h2>
              <div class="help-content">
                <p>å¹«åŠ©åŠŸèƒ½é–‹ç™¼ä¸­...</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- å½ˆè·³è¦–çª—ç™»å…¥è¦†è“‹å±¤ -->
      <div id="popupOverlay" class="popup-overlay">
        <div class="popup-content">
          <div id="popupSpinner" class="popup-spinner"></div>
          <div id="popupMessage" class="popup-message">æ­£åœ¨é–‹å•Ÿ Google ç™»å…¥è¦–çª—...</div>
          <div id="popupButtons" style="display: none;">
            <button id="popupRetry" class="popup-btn">é‡è©¦</button>
            <button id="popupCancel" class="popup-btn secondary">å–æ¶ˆ</button>
          </div>
        </div>
      </div>


      <div id="status" class="small"></div>
      
      <!-- çµæœå€å¡Š -->
      <div id="results" class="results-block">
        <h3>ğŸ“ çŸ­å½±éŸ³è…³æœ¬çµæœ</h3>
        <div class="result-item">
          <h4>ğŸ¯ ä¸»é¡Œ</h4>
          <div id="result-title" class="content">å°šæœªç”Ÿæˆ</div>
        </div>
        <div class="result-item">
          <h4>ğŸ“œ è…³æœ¬å…§å®¹</h4>
          <div id="result-script" class="content">å°šæœªç”Ÿæˆ</div>
        </div>
        <div class="result-item">
          <h4>ğŸ¬ ç•«é¢æ„Ÿ</h4>
          <div id="result-visual" class="content">å°šæœªç”Ÿæˆ</div>
        </div>
        <div class="result-item">
          <h4>ğŸ“± æ–‡æ¡ˆ</h4>
          <div id="result-copy" class="content">å°šæœªç”Ÿæˆ</div>
        </div>
      </div>
      
      
    </div>

    <!-- å½ˆå‡ºæç¤ºæ¡† -->
    <div id="toast" class="toast" style="display: none;"></div>
    <script>
      // é é¢æ§åˆ¶å‡½æ•¸
      // ===== XSS é˜²è­·å‡½æ•¸ =====
      /**
       * å®‰å…¨çš„ HTML è½‰ç¾©å‡½æ•¸
       * é˜²æ­¢ XSS æ”»æ“Š
       */
      function escapeHtml(text) {
        if (text == null || text === undefined) {
          return '';
        }
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
      
      /**
       * å®‰å…¨åœ°è¨­ç½®å…ƒç´ å…§å®¹ï¼ˆç´”æ–‡å­—ï¼‰
       * ä½¿ç”¨ textContent ä»£æ›¿ innerHTML
       */
      function safeSetText(element, text) {
        if (!element) return;
        if (text == null || text === undefined) {
          element.textContent = '';
          return;
        }
        element.textContent = String(text);
      }
      
      /**
       * å®‰å…¨åœ°è¨­ç½®å…ƒç´  HTMLï¼ˆéœ€è¦æ™‚ä½¿ç”¨ï¼‰
       * åªå…è¨±ä¿¡ä»»çš„ HTMLï¼Œå¦å‰‡è½‰ç¾©
       */
      function safeSetHtml(element, html, allowHtml = false) {
        if (!element) return;
        if (html == null || html === undefined) {
          element.innerHTML = '';
          return;
        }
        
        if (allowHtml) {
          // å¦‚æœå…è¨± HTMLï¼Œä½¿ç”¨ DOMPurifyï¼ˆå¦‚æœå¯ç”¨ï¼‰æˆ–åŸºæœ¬æ¸…ç†
          if (typeof DOMPurify !== 'undefined') {
            element.innerHTML = DOMPurify.sanitize(String(html));
          } else {
            // åŸºæœ¬æ¸…ç†ï¼šåªå…è¨±å®‰å…¨çš„æ¨™ç±¤
            const temp = document.createElement('div');
            temp.textContent = html;
            element.innerHTML = temp.innerHTML;
          }
        } else {
          // ä¸å…è¨± HTMLï¼Œç›´æ¥è½‰ç¾©
          element.textContent = String(html);
        }
      }
      
      /**
       * å®‰å…¨åœ°æ¸²æŸ“ Markdownï¼ˆå·²æ¸…ç†ï¼‰
       * ä½¿ç”¨ marked æ¸²æŸ“å¾Œå†æ¸…ç†
       */
      function safeRenderMarkdown(markdown) {
        if (!markdown || typeof markdown !== 'string') {
          return '';
        }
        
        try {
          if (typeof marked !== 'undefined') {
            const html = marked.parse(markdown);
            // ä½¿ç”¨ DOMPurify æ¸…ç†ï¼ˆå¦‚æœå¯ç”¨ï¼‰
            if (typeof DOMPurify !== 'undefined') {
              return DOMPurify.sanitize(html);
            }
            return html;
          }
          // å¦‚æœ marked ä¸å¯ç”¨ï¼Œè¿”å›è½‰ç¾©çš„æ–‡å­—
          return escapeHtml(markdown);
        } catch (e) {
          console.error('Markdown æ¸²æŸ“éŒ¯èª¤:', e);
          return escapeHtml(markdown);
        }
      }
      
      async function switchPage(pageId) {
        console.log('switchPage called with:', pageId);
        
        // éœ€è¦è¨‚é–±æ‰èƒ½è¨ªå•çš„é é¢åˆ—è¡¨
        const protectedPages = ['mode1', 'mode2', 'mode3', 'userDB'];
        
        // æª¢æŸ¥æ˜¯å¦ç‚ºå—ä¿è­·çš„é é¢
        if (protectedPages.includes(pageId)) {
          // ä½¿ç”¨ checkFeatureAccess æª¢æŸ¥ç™»å…¥å’Œè¨‚é–±ç‹€æ…‹
          if (window.ReelMindCommon && window.ReelMindCommon.checkFeatureAccess) {
            // userDB å…è¨±æœªè¨‚é–±ç”¨æˆ¶è¨ªå•ï¼ˆè‡³å°‘å¯æŸ¥çœ‹å€‹äººè³‡è¨Šå’Œç™»å‡ºï¼‰
            const featureType = pageId === 'userDB' ? 'userDB' : null;
            const canAccess = await window.ReelMindCommon.checkFeatureAccess(featureType);
            if (!canAccess) {
              // éœ€è¦ç™»å…¥æˆ–è¨‚é–±ï¼Œå·²ç”± checkFeatureAccess è™•ç†
              // ä¿æŒé¦–é é¡¯ç¤º
              const homepage = document.getElementById('homepage');
              if (homepage) {
                homepage.classList.add('active');
              }
              return;
            }
          } else {
            // é™ç´šè™•ç†ï¼šä½¿ç”¨åŸæœ‰é‚è¼¯
            const isSubscribed = document.body.dataset.subscribed === 'true';
            const isLoggedIn = ipPlanningToken && ipPlanningUser;
            
            // userDB å…è¨±æœªè¨‚é–±ç”¨æˆ¶è¨ªå•ï¼ˆè‡³å°‘å¯æŸ¥çœ‹å€‹äººè³‡è¨Šå’Œç™»å‡ºï¼‰
            if (pageId === 'userDB') {
              if (!isLoggedIn) {
                // æœªç™»å…¥ï¼Œå°å‘ç™»å…¥
                if (typeof goToLogin === 'function') {
                  goToLogin();
                }
                return;
              }
              // å·²ç™»å…¥å³å¯è¨ªå• userDBï¼Œä¸éœ€è¦è¨‚é–±æª¢æŸ¥
            } else {
              // å…¶ä»–é é¢éœ€è¦è¨‚é–±
              console.log('å˜—è©¦è¨ªå•å—ä¿è­·é é¢:', pageId);
            console.log('è¨‚é–±ç‹€æ…‹:', isSubscribed);
            console.log('ç™»å…¥ç‹€æ…‹:', isLoggedIn);
            
            // æœªç™»å…¥ï¼Œé¡¯ç¤ºç™»å…¥æç¤º
            if (!isLoggedIn) {
              console.warn('æœªç™»å…¥ - éœ€è¦ç™»å…¥');
              if (typeof goToLogin === 'function') {
                goToLogin();
              } else {
                alert('è«‹å…ˆç™»å…¥ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½ï¼');
              }
              // ä¿æŒé¦–é é¡¯ç¤º
              const homepage = document.getElementById('homepage');
              if (homepage) {
                homepage.classList.add('active');
              }
              return;
            }
            
            // å·²ç™»å…¥ä½†æœªè¨‚é–±ï¼Œå°å‘è¨‚é–±é 
            if (isLoggedIn && !isSubscribed) {
              console.warn('å·²ç™»å…¥ä½†æœªè¨‚é–± - å°å‘è¨‚é–±é ');
              window.location.href = '/subscription.html';
              return;
            }
          }
        }
        
        // ç§»é™¤æ‰€æœ‰é é¢çš„ mode2-active å’Œ mode3-active é¡ï¼ˆé˜²æ­¢ body æ»¾å‹•è¢«é–å®šï¼‰
        document.body.classList.remove('mode2-active', 'mode3-active');
        document.documentElement.classList.remove('mode2-active', 'mode3-active');
        
        // éš±è—æ‰€æœ‰é é¢
        document.querySelectorAll('.page').forEach(page => {
          page.classList.remove('active');
          // ç§»é™¤ mode2 å’Œ mode3 é é¢çš„ fig1 é¡ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
          if (page.id === 'mode2' || page.id === 'mode3') {
            page.classList.remove('fig1');
          }
        });
        
        // éš±è— AI é¡§å•çš„è¼¸å…¥æ¬„ä½å’Œå¿«é€ŸæŒ‰éˆ•ï¼ˆç•¶åˆ‡æ›åˆ°å…¶ä»–é é¢æ™‚ï¼‰
        const quickButtons = document.getElementById('quickButtons');
        const inputRow = document.querySelector('#mode2 .input-row');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        
        if (pageId !== 'mode2') {
          // åˆ‡æ›åˆ°å…¶ä»–é é¢æ™‚ï¼Œç§»é™¤ inline style è®“ CSS è¦å‰‡ç”Ÿæ•ˆï¼ˆéš±è—ï¼‰
          if (quickButtons) {
            quickButtons.style.display = 'none';
            quickButtons.removeAttribute('style');
          }
          if (inputRow) {
            inputRow.style.display = 'none';
            inputRow.removeAttribute('style');
          }
          if (messageInput) {
            messageInput.style.display = 'none';
            messageInput.removeAttribute('style');
          }
          if (sendBtn) {
            sendBtn.style.display = 'none';
            sendBtn.removeAttribute('style');
          }
        }
        
        // é¡¯ç¤ºé¸ä¸­çš„é é¢
        const targetPage = document.getElementById(pageId);
        if (targetPage) {
          targetPage.classList.add('active');
          console.log('Switched to page:', pageId);
          
          // å¦‚æœæ˜¯ mode2ï¼Œæ·»åŠ  mode2-active é¡ä¸¦ç¢ºä¿æœ‰ fig1 é¡
          if (pageId === 'mode2') {
            targetPage.classList.add('fig1');
            document.body.classList.add('mode2-active');
            document.documentElement.classList.add('mode2-active');
            console.log('Mode2 activated, body scroll locked');
            
            // é¡¯ç¤º AI é¡§å•çš„è¼¸å…¥æ¬„ä½å’Œå¿«é€ŸæŒ‰éˆ•
            // ç§»é™¤ inline styleï¼Œè®“ CSS è¦å‰‡ç”Ÿæ•ˆï¼ˆå› ç‚º #mode2.active å·²ç¶“æœ‰ active é¡ï¼‰
            if (quickButtons) {
              quickButtons.removeAttribute('style');
            }
            if (inputRow) {
              inputRow.removeAttribute('style');
            }
            if (messageInput) {
              messageInput.removeAttribute('style');
            }
            if (sendBtn) {
              sendBtn.removeAttribute('style');
            }
            
            // åˆå§‹åŒ– ChatGPT åŠŸèƒ½ï¼ˆåŒ…æ‹¬ Enter éµç™¼é€ï¼‰
            setTimeout(() => {
              if (typeof initChatGPTFeatures === 'function') {
                initChatGPTFeatures();
              }
              // è¼‰å…¥æ­·å²å°è©±è¨˜éŒ„
              if (typeof loadMode2History === 'function') {
                loadMode2History();
              }
            }, 100);
          }
          
          // å¦‚æœæ˜¯ mode3ï¼Œæ·»åŠ  mode3-active é¡ä¸¦ç¢ºä¿æœ‰ fig1 é¡
          if (pageId === 'mode3') {
            targetPage.classList.add('fig1');
            document.body.classList.add('mode3-active');
            document.documentElement.classList.add('mode3-active');
            console.log('Mode3 activated, body scroll locked');
            
            // åˆå§‹åŒ– Mode3 èŠå¤©åŠŸèƒ½ï¼ˆåŒ…æ‹¬ Enter éµç™¼é€ï¼‰
            setTimeout(() => {
              if (typeof initMode3Chat === 'function') {
                initMode3Chat();
              }
            }, 100);
          }
          
          // å¦‚æœæ˜¯ userDBï¼Œè‡ªå‹•é¡¯ç¤ºå€‹äººè³‡æ–™åˆ†å€
          if (pageId === 'userDB') {
            // å»¶é²åŸ·è¡Œï¼Œç¢ºä¿ DOM å·²å®Œå…¨æ¸²æŸ“
            setTimeout(() => {
              if (typeof showDbSection === 'function') {
                showDbSection('personalInfo');
              }
            }, 100);
          }
        } else {
          console.error('Page not found:', pageId);
        }
        
        // æ›´æ–°å°èˆªæ¨™ç±¤ç‹€æ…‹
        document.querySelectorAll('.navbar-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        
        // æ ¹æ“šé é¢IDè¨­ç½®å°æ‡‰æ¨™ç±¤ç‚ºactive
        const tabMap = {
          'homepage': 0,
          'mode1': 1,
          'mode2': 2,
          'mode3': 3,
          'forum': 4,
          'guide': 5,
          'userDB': 6,
          'guide-article1': null, // æ–‡ç« é é¢ä¸éœ€è¦å°èˆªåˆ—è®Šäº®
          'guide-article2': null,
          'guide-article3': null
        };
        
        if (tabMap[pageId] !== undefined && tabMap[pageId] !== null) {
          document.querySelectorAll('.navbar-tab')[tabMap[pageId]].classList.add('active');
        }
      }
      
      
      // AIèªªæ˜å€å¡Šæ§åˆ¶å‡½æ•¸ï¼ˆèˆŠç‰ˆï¼Œä¿ç•™ä»¥é˜²éœ€è¦ï¼‰
      function toggleInstructions() {
        const instructionList = document.querySelector('.instruction-list');
        const toggleIcon = document.querySelector('.instructions-toggle');
        const chatMessages = document.getElementById('chatMessages');
        
        if (instructionList && toggleIcon) {
          instructionList.classList.toggle('show');
          
          if (instructionList.classList.contains('show')) {
            toggleIcon.textContent = 'â–¼';
            // é¡¯ç¤ºæ™‚æ¢å¾©åŸå§‹é«˜åº¦
            if (chatMessages) chatMessages.style.minHeight = '600px';
          } else {
            toggleIcon.textContent = 'â–¶';
            // éš±è—æ™‚å»¶é•·èŠå¤©è¨Šæ¯å€é«˜åº¦
            if (chatMessages) chatMessages.style.minHeight = '800px';
          }
        }
      }
      
      // æŠ½å±œå¼èªªæ˜æ¬„ä½æ§åˆ¶å‡½æ•¸
      function toggleInstructionsDrawer() {
        const drawer = document.getElementById('instructionsDrawer');
        const overlay = document.getElementById('drawerOverlay');
        
        if (drawer && overlay) {
          const isOpen = drawer.classList.contains('open');
          
          if (isOpen) {
            // é—œé–‰æŠ½å±œ
            drawer.classList.remove('open');
            overlay.classList.remove('show');
          } else {
            // æ‰“é–‹æŠ½å±œ
            drawer.classList.add('open');
            overlay.classList.add('show');
          }
        }
      }
      
      // å´é‚Šæ¬„é é¢é¡¯ç¤ºå‡½æ•¸
      function showSidebarPage(pageType) {
        const overlay = document.getElementById('sidebarPageOverlay');
        const title = document.getElementById('sidebarPageTitle');
        const content = document.getElementById('sidebarPageContent');
        
        // è¨­ç½®é é¢æ¨™é¡Œ
        const pageTitles = {
          'profile': 'å€‹äººè³‡æ–™',
          'scripts': 'æˆ‘çš„è…³æœ¬',
          'positioning': 'å¸³è™Ÿå®šä½è¨˜éŒ„',
          'topics': 'é¸é¡Œè¨˜éŒ„',
          'settings': 'ç³»çµ±è¨­å®š',
          'statistics': 'ä½¿ç”¨çµ±è¨ˆ',
          'help': 'å¹«åŠ©ä¸­å¿ƒ'
        };
        
        title.textContent = pageTitles[pageType] || 'åŠŸèƒ½é é¢';
        
        // æ ¹æ“šé é¢é¡å‹è¼‰å…¥ç›¸æ‡‰å…§å®¹
        switch(pageType) {
          case 'profile':
            loadProfilePage(content);
            break;
          case 'scripts':
            loadScriptsPage(content);
            break;
          case 'positioning':
            loadPositioningPage(content);
            break;
          case 'topics':
            loadTopicsPage(content);
            break;
          case 'settings':
            loadSettingsPage(content);
            break;
          case 'statistics':
            loadStatisticsPage(content);
            break;
          case 'help':
            loadHelpPage(content);
            break;
          default:
            content.innerHTML = '<p>åŠŸèƒ½é–‹ç™¼ä¸­...</p>';
        }
        
        // é¡¯ç¤ºé é¢
        overlay.style.display = 'flex';
        
        // é—œé–‰å´é‚Šæ¬„
        toggleSidebar();
      }
      
      // é—œé–‰å´é‚Šæ¬„é é¢
      function closeSidebarPage() {
        document.getElementById('sidebarPageOverlay').style.display = 'none';
      }
      
      // è¼‰å…¥å€‹äººè³‡æ–™é é¢
      function loadProfilePage(container) {
        // æ ¼å¼åŒ–æ³¨å†Œæ—¶é—´
        let registrationTime = 'æœªçŸ¥';
        if (ipPlanningUser?.created_at) {
          try {
            const date = new Date(ipPlanningUser.created_at);
            if (!isNaN(date.getTime())) {
              registrationTime = date.toLocaleString('zh-TW', {
                timeZone: 'Asia/Taipei',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
              });
            }
          } catch (e) {
            registrationTime = ipPlanningUser.created_at;
          }
        }
        
        // ä½¿ç”¨å®‰å…¨çš„ HTML è¨­ç½®æ–¹å¼
        const profileName = escapeHtml(ipPlanningUser?.name || 'æœªè¨­å®š');
        const profileEmail = escapeHtml(ipPlanningUser?.email || 'æœªè¨­å®š');
        const profileDate = escapeHtml(registrationTime);
        const scriptCount = getLocalScripts().length;
        
        container.innerHTML = `
          <div class="profile-content">
            <div class="profile-section">
              <h3>ç”¨æˆ¶è³‡è¨Š</h3>
              <div class="user-details">
                <div class="detail-item">
                  <label>å§“åï¼š</label>
                  <span id="profileName">${profileName}</span>
                </div>
                <div class="detail-item">
                  <label>Emailï¼š</label>
                  <span id="profileEmail">${profileEmail}</span>
                </div>
                <div class="detail-item">
                  <label>è¨»å†Šæ™‚é–“ï¼š</label>
                  <span id="profileDate">${profileDate}</span>
                </div>
              </div>
            </div>
            <div class="profile-section">
              <h3>ä½¿ç”¨çµ±è¨ˆ</h3>
              <div class="stats-grid">
                <div class="stat-item">
                  <div class="stat-number">${scriptCount}</div>
                  <div class="stat-label">å·²ç”Ÿæˆè…³æœ¬</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number">${getLocalPositioning().length}</div>
                  <div class="stat-label">å¸³è™Ÿå®šä½</div>
                </div>
                <div class="stat-item">
                  <div class="stat-number">${getLocalTopics().length}</div>
                  <div class="stat-label">é¸é¡Œè¨˜éŒ„</div>
                </div>
              </div>
            </div>
          </div>
        `;
      }
      
      // è¼‰å…¥æˆ‘çš„è…³æœ¬é é¢
      function loadScriptsPage(container) {
        const scripts = getLocalScripts();
        if (scripts.length === 0) {
          container.innerHTML = '<p>å°šæœªç”Ÿæˆä»»ä½•è…³æœ¬</p>';
          return;
        }
        
        let html = '<div class="scripts-list">';
        scripts.forEach(script => {
          const date = formatTaiwanTime(script.created_at).split(' ')[0]; // åªå–æ—¥æœŸéƒ¨åˆ†
          html += `
            <div class="script-item">
              <div class="script-header">
                <h4>${script.name || 'æœªå‘½åè…³æœ¬'}</h4>
                <span class="script-date">${date}</span>
              </div>
              <div class="script-preview">${script.content ? script.content.substring(0, 100) + '...' : 'ç„¡å…§å®¹'}</div>
              <div class="script-actions">
                <button onclick="viewScript(${script.id})" class="btn-primary">æŸ¥çœ‹</button>
                <button onclick="deleteScript(${script.id})" class="btn-danger">åˆªé™¤</button>
              </div>
            </div>
          `;
        });
        html += '</div>';
        container.innerHTML = html;
      }
      
      // è¼‰å…¥å¸³è™Ÿå®šä½é é¢
      function loadPositioningPage(container) {
        container.innerHTML = '<p>å¸³è™Ÿå®šä½è¨˜éŒ„åŠŸèƒ½é–‹ç™¼ä¸­...</p>';
      }
      
      // è¼‰å…¥é¸é¡Œè¨˜éŒ„é é¢
      function loadTopicsPage(container) {
        container.innerHTML = '<p>é¸é¡Œè¨˜éŒ„åŠŸèƒ½é–‹ç™¼ä¸­...</p>';
      }
      
      // è¼‰å…¥è¨­å®šé é¢
      function loadSettingsPage(container) {
        container.innerHTML = '<p>ç³»çµ±è¨­å®šåŠŸèƒ½é–‹ç™¼ä¸­...</p>';
      }
      
      // è¼‰å…¥çµ±è¨ˆé é¢
      function loadStatisticsPage(container) {
        container.innerHTML = '<p>ä½¿ç”¨çµ±è¨ˆåŠŸèƒ½é–‹ç™¼ä¸­...</p>';
      }
      
      // è¼‰å…¥å¹«åŠ©é é¢
      function loadHelpPage(container) {
        container.innerHTML = `
          <div class="help-content">
            <h3>ä½¿ç”¨æŒ‡å—</h3>
            <div class="help-section">
              <h4>ä¸€éµç”Ÿæˆæ¨¡å¼</h4>
              <p>1. åœ¨å·¦å´è¨­å®šæ‚¨çš„éœ€æ±‚ï¼ˆå¹³å°ã€ä¸»é¡Œã€ç§’æ•¸ã€å¸³è™Ÿå®šä½ï¼‰</p>
              <p>2. é»æ“Šã€Œå¥—ç”¨è¨­å®šã€</p>
              <p>3. åœ¨å³å´ä¾åºé»æ“Šç”ŸæˆæŒ‰éˆ•</p>
              <p>4. å„²å­˜æˆ–é‡æ–°ç”Ÿæˆ</p>
            </div>
            <div class="help-section">
              <h4>AIé¡§å•å°è©±æ¨¡å¼</h4>
              <p>1. ç›´æ¥èˆ‡AIé€²è¡Œå°è©±</p>
              <p>2. è¨è«–å…§å®¹ç­–ç•¥å’Œå‰µæ„</p>
              <p>3. AIå”åŠ©ç”Ÿæˆè…³æœ¬</p>
            </div>
            <div class="help-section">
              <h4>å¸¸è¦‹å•é¡Œ</h4>
              <p><strong>Q: å¦‚ä½•å„²å­˜è…³æœ¬ï¼Ÿ</strong></p>
              <p>A: ç”Ÿæˆå®Œæˆå¾Œé»æ“Šã€Œå„²å­˜ã€æŒ‰éˆ•å³å¯</p>
              <p><strong>Q: å¦‚ä½•æŸ¥çœ‹å·²å„²å­˜çš„è…³æœ¬ï¼Ÿ</strong></p>
              <p>A: é»æ“Šå³å´åŠŸèƒ½æŒ‰éˆ•ï¼Œé¸æ“‡ã€Œæˆ‘çš„è…³æœ¬ã€</p>
            </div>
          </div>
        `;
      }
      
      // å®šæœŸæª¢æŸ¥ token ç‹€æ…‹ï¼ˆæ¯åˆ†é˜æª¢æŸ¥ä¸€æ¬¡ï¼‰
      function startTokenMonitor() {
        setInterval(() => {
          const token = localStorage.getItem('ipPlanningToken');
          if (token) {
            // æª¢æŸ¥æ˜¯å¦éæœŸ
            if (isTokenExpired(token)) {
              // Token å·²éæœŸï¼Œå˜—è©¦åˆ·æ–°ï¼ˆæœƒè‡ªå‹•ç™»å‡ºå¦‚æœåˆ·æ–°å¤±æ•—ï¼‰
              tryRefreshTokenSafe().catch(err => {
                console.error('è‡ªå‹•åˆ·æ–° Token å¤±æ•—:', err);
              });
            }
          }
        }, 60000); // æ¯åˆ†é˜æª¢æŸ¥ä¸€æ¬¡
      }

      // çµ±ä¸€çš„å®‰å…¨ fetch å‡½æ•¸ï¼ˆç”¨æ–¼éœ€è¦èªè­‰çš„ API å‘¼å«ï¼‰
      async function safeFetch(url, options = {}) {
        const token = localStorage.getItem('ipPlanningToken');
        
        // æª¢æŸ¥ token æ˜¯å¦å­˜åœ¨
        if (!token) {
          // å¦‚æœæ²’æœ‰ tokenï¼Œä½†ç”¨æˆ¶èªç‚ºå·²ç™»å…¥ï¼Œå¯èƒ½éœ€è¦ç™»å‡º
          if (ipPlanningUser) {
            forceLogout('è«‹å…ˆç™»å…¥');
          }
          throw new Error('éœ€è¦ç™»å…¥');
        }
        
        // æª¢æŸ¥ token æ˜¯å¦éæœŸ
        if (isTokenExpired(token)) {
          // Token å·²éæœŸï¼Œå˜—è©¦åˆ·æ–°
          const refreshed = await tryRefreshTokenSafe();
          if (!refreshed) {
            // åˆ·æ–°å¤±æ•—ï¼Œå·²è‡ªå‹•ç™»å‡º
            throw new Error('Token å·²éæœŸä¸”ç„¡æ³•åˆ·æ–°');
          }
        }
        
        // æº–å‚™ headers
        const headers = {
          ...options.headers,
          'Authorization': `Bearer ${localStorage.getItem('ipPlanningToken')}`
        };
        
        try {
          const response = await fetch(url, { ...options, headers });
          
          // å¦‚æœæ”¶åˆ° 401 æˆ– 403ï¼Œå˜—è©¦åˆ·æ–°æˆ–ç™»å‡º
          if (response.status === 401) {
            const refreshed = await tryRefreshTokenSafe();
            if (refreshed) {
              // åˆ·æ–°æˆåŠŸï¼Œä½¿ç”¨æ–° token é‡è©¦
              headers['Authorization'] = `Bearer ${localStorage.getItem('ipPlanningToken')}`;
              return await fetch(url, { ...options, headers });
            }
            // åˆ·æ–°å¤±æ•—ï¼Œå·²è‡ªå‹•ç™»å‡º
            throw new Error('èªè­‰å¤±æ•—');
          }
          
          if (response.status === 403) {
            let errorMessage = 'èªè­‰å¤±æ•—ï¼Œè«‹é‡æ–°ç™»å…¥';
            try {
              const errorData = await response.clone().json();
              if (errorData.detail) {
                errorMessage = errorData.detail;
              }
            } catch (e) {
              // å¦‚æœç„¡æ³•è§£æ JSONï¼Œä½¿ç”¨é è¨­è¨Šæ¯
            }
            forceLogout(errorMessage);
            throw new Error(errorMessage);
          }
          
          return response;
        } catch (error) {
          // å¦‚æœæ˜¯ç¶²è·¯éŒ¯èª¤ï¼Œä¸è¦ç™»å‡ºï¼ˆå¯èƒ½æ˜¯æš«æ™‚çš„ç¶²è·¯å•é¡Œï¼‰
          if (error.name === 'TypeError' && error.message.includes('fetch')) {
            throw error;
          }
          
          // å…¶ä»–éŒ¯èª¤ï¼ˆåŒ…æ‹¬æˆ‘å€‘è‡ªå·±æ‹‹å‡ºçš„ï¼‰ç¹¼çºŒå‚³æ’­
          throw error;
        }
      }

      // è™•ç†æˆæ¬Šé€£çµé©—è­‰
      async function handleActivationToken(token) {
        if (!token) return;
        
        const currentToken = localStorage.getItem('ipPlanningToken');
        
        if (!currentToken) {
          // æœªç™»å…¥ï¼Œå°å‘ç™»å…¥é ï¼ˆå¸¶ä¸Š activation_tokenï¼‰
          // ç¢ºä¿åœ¨ index.html é é¢è™•ç†ï¼Œè€Œä¸æ˜¯ subscription.html
          if (window.location.pathname.includes('subscription.html')) {
            // å¦‚æœåœ¨ subscription.htmlï¼Œå…ˆè·³è½‰åˆ° index.html
            window.location.href = `/#login?activation_token=${token}`;
          } else {
            const hash = window.location.hash;
            const separator = hash.includes('?') ? '&' : '?';
            window.location.href = `/#login${separator}activation_token=${token}`;
          }
          return;
        }
        
        // å·²ç™»å…¥ï¼Œç›´æ¥é©—è­‰æˆæ¬Š
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/license/verify?token=${token}`, {
            headers: {
              'Authorization': `Bearer ${currentToken}`
            },
            redirect: 'manual'  // ä¸è‡ªå‹•è·Ÿéš¨ redirect
          });
          
          if (response.ok || response.status === 302) {
            // é©—è­‰æˆåŠŸï¼Œå¾Œç«¯æœƒ redirectï¼Œä½†æˆ‘å€‘åœ¨å‰ç«¯è™•ç†
            // å˜—è©¦å¾ response ç²å–æ–¹æ¡ˆè³‡è¨Šï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
            let planType = 'yearly';
            try {
              if (response.ok && response.headers.get('content-type')?.includes('application/json')) {
                const responseData = await response.json();
                planType = responseData.plan_type || planType;
              }
            } catch (e) {
              // å¦‚æœç„¡æ³•è§£æ JSONï¼ˆä¾‹å¦‚ 302 redirectï¼‰ï¼Œä½¿ç”¨é è¨­å€¼
              console.log('ç„¡æ³•å¾ response ç²å–æ–¹æ¡ˆè³‡è¨Šï¼Œä½¿ç”¨é è¨­å€¼');
            }
            
            // é‡æ–°æª¢æŸ¥è¨‚é–±ç‹€æ…‹
            await checkSubscriptionStatus();
            
            // ç¢ºä¿é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼ï¼ˆè€Œä¸æ˜¯è¨‚é–±é é¢ï¼‰
            if (window.location.pathname.includes('subscription.html')) {
              // å¦‚æœåœ¨ subscription.htmlï¼Œè·³è½‰åˆ° index.html
              window.location.href = '/';
            } else {
              // é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼
              showMainApp();
              // æ›´æ–°é¦–é è¦–åœ–ï¼ˆç¢ºä¿é¡¯ç¤ºå·²è¨‚é–±è¦–åœ–ï¼‰
              updateHomepageView();
            }
            
            // é¡¯ç¤ºæˆåŠŸé€šçŸ¥ï¼ˆåŒ…å«æ–¹æ¡ˆè³‡è¨Šï¼‰
            const planName = planType === 'yearly' ? 'å¹´è²»' : 'æœˆè²»';
            showToast(`âœ… è¨‚é–±å•Ÿç”¨æˆåŠŸï¼æ–¹æ¡ˆï¼š${planName}`, 5000);
            
            // æ¸…é™¤ URL åƒæ•¸
            window.history.replaceState({}, document.title, window.location.pathname);
          } else {
            // å˜—è©¦ç²å–è©³ç´°éŒ¯èª¤è¨Šæ¯
            let errorMessage = 'å•Ÿç”¨å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦';
            try {
              const errorData = await response.json();
              errorMessage = errorData.error || errorMessage;
              
              // æ ¹æ“šéŒ¯èª¤é¡å‹é¡¯ç¤ºä¸åŒçš„æç¤º
              if (errorMessage.includes('å·²ä½¿ç”¨') || errorMessage.includes('å·²å•Ÿç”¨')) {
                errorMessage = 'âš ï¸ æ­¤æˆæ¬Šé€£çµå·²ä½¿ç”¨é';
              } else if (errorMessage.includes('éæœŸ')) {
                errorMessage = 'âš ï¸ æˆæ¬Šé€£çµå·²éæœŸï¼ˆ7å¤©å…§æœ‰æ•ˆï¼‰';
              } else if (errorMessage.includes('ç„¡æ•ˆ')) {
                errorMessage = 'âš ï¸ ç„¡æ•ˆçš„æˆæ¬Šé€£çµ';
              }
            } catch (e) {
              // å¦‚æœç„¡æ³•è§£æ JSONï¼Œä½¿ç”¨é è¨­éŒ¯èª¤è¨Šæ¯
            }
            showToast(errorMessage, 5000);
          }
        } catch (error) {
          console.error('å•Ÿç”¨å¤±æ•—:', error);
          showToast('âš ï¸ å•Ÿç”¨å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 5000);
        }
      }
      
      // åˆå§‹åŒ–é é¢
      document.addEventListener('DOMContentLoaded', function() {
        // âš ï¸ å„ªå…ˆè™•ç†æˆæ¬Šé€£çµï¼ˆå¿…é ˆåœ¨å…¶ä»–åˆå§‹åŒ–ä¹‹å‰ï¼‰
        // æª¢æŸ¥ URL åƒæ•¸ä¸­æ˜¯å¦æœ‰ activation_tokenï¼ˆæˆæ¬Šé€£çµï¼‰
        const urlParams = new URLSearchParams(window.location.search);
        const hashParams = new URLSearchParams(window.location.hash.slice(1));
        const activationToken = urlParams.get('token') || hashParams.get('token');
        const activationSuccess = urlParams.get('activation') || hashParams.get('activation');
        
        // è™•ç†æˆæ¬ŠæˆåŠŸé é¢ï¼ˆå¾å¾Œç«¯ redirect å›ä¾†ï¼‰
        if (activationSuccess === 'success') {
          const plan = urlParams.get('plan') || hashParams.get('plan') || 'yearly';
          showToast(`âœ… è¨‚é–±å•Ÿç”¨æˆåŠŸï¼æ–¹æ¡ˆï¼š${plan === 'yearly' ? 'å¹´è²»' : 'æœˆè²»'}`, 5000);
          // é‡æ–°æª¢æŸ¥è¨‚é–±ç‹€æ…‹
          checkSubscriptionStatus().then(() => {
            // æ¸…é™¤ URL åƒæ•¸
            window.history.replaceState({}, document.title, window.location.pathname);
          });
        }
        
        // è™•ç†æˆæ¬Šé€£çµï¼ˆ/activate?token=xxx æˆ–æ ¹è·¯å¾‘ ?token=xxxï¼‰
        if (activationToken) {
          // æª¢æŸ¥æ˜¯å¦ç‚ºæˆæ¬Šé€£çµï¼ˆè·¯å¾‘æ˜¯ /activate æˆ–æ ¹è·¯å¾‘æœ‰ token åƒæ•¸ï¼‰
          const isActivatePath = window.location.pathname === '/activate' || 
                                 window.location.pathname === '/activate.html' ||
                                 window.location.pathname === '/' ||
                                 window.location.pathname === '';
          
          // å¦‚æœæ˜¯æˆæ¬Šé€£çµï¼Œç«‹å³è™•ç†ï¼ˆå„ªå…ˆæ–¼å…¶ä»–åˆå§‹åŒ–é‚è¼¯ï¼‰
          if (isActivatePath) {
            // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
            const currentToken = localStorage.getItem('ipPlanningToken');
            if (!currentToken) {
              // æœªç™»å…¥ï¼Œç«‹å³è·³è½‰åˆ°ç™»å…¥é ï¼ˆä¸åŸ·è¡Œå…¶ä»–åˆå§‹åŒ–ï¼‰
              console.log('ğŸ” æª¢æ¸¬åˆ°æˆæ¬Šé€£çµä½†æœªç™»å…¥ï¼Œç«‹å³è·³è½‰åˆ°ç™»å…¥é ');
              // ä½¿ç”¨ replace è€Œä¸æ˜¯ hrefï¼Œé¿å…æ­·å²è¨˜éŒ„å•é¡Œ
              window.location.replace(`/#login?activation_token=${activationToken}`);
              return; // åœæ­¢åŸ·è¡Œå¾ŒçºŒåˆå§‹åŒ–
            } else {
              // å·²ç™»å…¥ï¼Œè™•ç†æˆæ¬Š
              console.log('âœ… æª¢æ¸¬åˆ°æˆæ¬Šé€£çµä¸”å·²ç™»å…¥ï¼Œé–‹å§‹é©—è­‰æˆæ¬Š');
              handleActivationToken(activationToken);
            }
          }
        }
        
        // å•Ÿå‹•æ‰“å­—æ©Ÿå‹•ç•«
        if (typeof initTypewriterAnimation === 'function') {
          initTypewriterAnimation();
        }
        
        // å•Ÿå‹• token ç›£æ§ï¼ˆæ¯åˆ†é˜æª¢æŸ¥ä¸€æ¬¡ï¼‰
        startTokenMonitor();
        
        // æª¢æŸ¥ URL åƒæ•¸ä¸­æ˜¯å¦æœ‰ tokenï¼ˆOAuth callback fallbackï¼‰
        const tokenParam = urlParams.get('token');
        if (tokenParam && !activationToken) {  // é¿å…èˆ‡æˆæ¬Š token è¡çª
          console.log('DEBUG: Found token in URL params, processing OAuth callback...');
          const userId = urlParams.get('user_id');
          const email = urlParams.get('email');
          const name = urlParams.get('name');
          const picture = urlParams.get('picture');
          
          if (tokenParam && userId) {
            ipPlanningToken = tokenParam;
            ipPlanningUser = {
              user_id: userId,
              email: email || '',
              name: name || '',
              picture: picture || ''
            };
            localStorage.setItem('ipPlanningToken', ipPlanningToken);
            localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
            
            // æ¸…é™¤ URL åƒæ•¸
            window.history.replaceState({}, document.title, window.location.pathname);
            
            console.log('DEBUG: Token processed from URL params, updating UI');
            updateAuthUI(true);
            showMainApp();
          }
        }
        
        // æª¢æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰æ–°çš„ tokenï¼ˆæ‰‹æ©Ÿç‰ˆè·³è½‰å›ä¾†å¾Œçš„è™•ç†ï¼‰
        // å¦‚æœç™¼ç¾ ipPlanningTokenUpdated æ¨™è¨˜ï¼Œè¡¨ç¤ºå‰›å‰›å®Œæˆç™»å…¥
        const tokenUpdatedFlag = localStorage.getItem('ipPlanningTokenUpdated');
        const storedToken = localStorage.getItem('ipPlanningToken');
        const storedUserStr = localStorage.getItem('ipPlanningUser');
        
        if (tokenUpdatedFlag && storedToken) {
          // æª¢æŸ¥é€™å€‹ token æ˜¯å¦æ˜¯æ–°çš„ï¼ˆèˆ‡ç•¶å‰å…¨åŸŸè®Šæ•¸ä¸åŒï¼‰
          // æ³¨æ„ï¼šæ­¤æ™‚å…¨åŸŸè®Šæ•¸å¯èƒ½é‚„æ²’å¾ localStorage è¼‰å…¥ï¼ˆcheckLoginStatus å°šæœªåŸ·è¡Œï¼‰
          // æ‰€ä»¥åªè¦æœ‰ tokenUpdatedFlagï¼Œå°±è¡¨ç¤ºæ˜¯æ–°çš„ç™»å…¥
          const currentToken = ipPlanningToken || localStorage.getItem('ipPlanningToken');
          const isNewToken = !currentToken || storedToken !== currentToken;
          
          if (isNewToken) {
            console.log('DEBUG: âœ… New token found in localStorage (likely from mobile redirect)');
            console.log('DEBUG: Token updated flag timestamp:', tokenUpdatedFlag);
            
            // æ›´æ–°å…¨åŸŸè®Šæ•¸
            ipPlanningToken = storedToken;
            if (storedUserStr) {
              try {
                ipPlanningUser = JSON.parse(storedUserStr);
              } catch (e) {
                console.warn('DEBUG: Failed to parse stored user data:', e);
              }
            }
            
            // æ¸…é™¤æ¨™è¨˜ï¼ˆé¿å…é‡è¤‡è™•ç†ï¼‰
            localStorage.removeItem('ipPlanningTokenUpdated');
            
            // æ›´æ–° UI
            updateAuthUI(true);
            showMainApp();
            checkSubscriptionStatus();
            
            console.log('DEBUG: âœ… Login state updated from localStorage');
          }
        }
        
        // æª¢æŸ¥æ˜¯å¦å·²ç¶“ç™»å…¥
        checkLoginStatus();
        
        // åˆå§‹åŒ–é¦–é è¦–åœ–ï¼ˆåœ¨ checkLoginStatus ä¹‹å¾Œï¼Œå› ç‚ºå®ƒæœƒæ›´æ–°è¨‚é–±ç‹€æ…‹ï¼‰
        setTimeout(() => {
          updateHomepageView();
        }, 100);
        
        // æª¢æŸ¥è¨‚é–±ç‹€æ…‹
        checkSubscriptionStatus();
        
        // ç¢ºä¿ Highlight.js è¼‰å…¥å¾Œåˆå§‹åŒ–ï¼ˆå› ç‚ºä½¿ç”¨äº† deferï¼‰
        function initializeHighlightJS() {
          if (typeof hljs !== 'undefined') {
            console.log('DEBUG: Highlight.js loaded, initializing...');
            try {
              hljs.highlightAll();
              // åˆå§‹åŒ– Markdown æ¸²æŸ“å™¨
              initMarkdownRenderer();
            } catch (e) {
              console.warn('DEBUG: Highlight.js initialization error:', e);
            }
          } else {
            // å¦‚æœé‚„æ²’è¼‰å…¥ï¼Œå»¶é²é‡è©¦
            setTimeout(initializeHighlightJS, 100);
          }
        }
        initializeHighlightJS();
        
        // ç§»å‹•åŸæœ‰å…§å®¹åˆ°æ–°å®¹å™¨
        moveExistingContent();
        
        // åˆå§‹åŒ–æ‰‹æ©Ÿç‰ˆä¸€éµç”Ÿæˆæ¨™ç±¤åˆ‡æ›
        initializeMode1MobileTabs();
        
        // èª¿è©¦AIé¡§å•æ¨¡å¼å…ƒç´ 
        setTimeout(debugAIConsultantElements, 2000);
        
        // æ§åˆ¶è¨‚é–±é–å®šæµ®å±¤é¡¯ç¤º
        updateSubscriptionLock();
      });

      // ===== è¨‚é–±å°é–èˆ‡å°è³¼ï¼šæœªè¨‚é–±ä½¿ç”¨è€…ç¦æ­¢é€²å…¥ä¸‰å¤§æ¨¡å¼ =====
      function isSubscribed() {
        try {
          // å„ªå…ˆæª¢æŸ¥ document.body.dataset.subscribedï¼ˆå¾å¾Œç«¯ API ç²å–çš„ç‹€æ…‹ï¼Œæœ€æº–ç¢ºï¼‰
          const backendSubscribed = document.body.dataset.subscribed === 'true';
          if (backendSubscribed) {
            return true;
          }
          
          // æª¢æŸ¥ localStorage ä¸­çš„ subscriptionStatus
          const subscriptionStatus = localStorage.getItem('subscriptionStatus');
          if (subscriptionStatus === 'active') {
            return true;
          }
          
          // æœ€å¾Œæª¢æŸ¥ localStorage ä¸­çš„ç”¨æˆ¶è³‡æ–™
          const userStr = localStorage.getItem('ipPlanningUser');
          if (userStr) {
          const user = JSON.parse(userStr);
          // å¾Œç«¯/å‰ç«¯ä¸€ç‡ä»¥ falsy è¦–ç‚ºæœªè¨‚é–±
            const userSubscribed = !!(user && (user.is_subscribed === true || user.is_subscribed === 1 || user.is_subscribed === '1'));
            if (userSubscribed) {
              return true;
            }
          }
          
          return false;
        } catch (_) {
          return false;
        }
      }

      function showSubscriptionPaywall(plan) {
        // è‹¥å‚³å…¥æ–¹æ¡ˆï¼Œå°‡åƒæ•¸é™„åœ¨å°è³¼é é¢
        const planParam = plan ? `?plan=${encodeURIComponent(plan)}` : '';
        // é¡¯ç¤ºå°è³¼æç¤ºï¼ˆè¼•é‡ä½œæ³•ï¼šæç¤º + å°å‘ï¼‰
        try { showToast('æ­¤åŠŸèƒ½éœ€è¨‚é–±æ‰èƒ½ä½¿ç”¨ï¼Œå°‡å‰å¾€è³¼è²·é é¢', 3000); } catch (_) {}
        setTimeout(() => {
          window.location.href = `subscription.html${planParam}`;
        }, 300);
      }

      // åŒ…è£é é¢åˆ‡æ›ï¼Œå°ä¸‰å¤§æ¨¡å¼é€²è¡Œå°é–
      const originalSwitchPage = typeof switchPage === 'function' ? switchPage : null;
      window.switchPage = async function(page) {
        // ä¸‰å¤§æ¨¡å¼ä»£ç¨±ï¼šmode1(ä¸€éµç”Ÿæˆ)ã€mode2(AIé¡§å•)ã€mode3(IPäººè¨­è¦åŠƒ)
        const isModePage = page === 'mode1' || page === 'mode2' || page === 'mode3';
        if (isModePage) {
          // ä½¿ç”¨ checkFeatureAccess æª¢æŸ¥ç™»å…¥å’Œè¨‚é–±ç‹€æ…‹
          if (window.ReelMindCommon && window.ReelMindCommon.checkFeatureAccess) {
            const canAccess = await window.ReelMindCommon.checkFeatureAccess();
            if (!canAccess) {
              // éœ€è¦ç™»å…¥æˆ–è¨‚é–±ï¼Œå·²ç”± checkFeatureAccess è™•ç†
              return;
            }
          } else {
            // é™ç´šè™•ç†ï¼šä½¿ç”¨åŸæœ‰é‚è¼¯
            if (!isSubscribed()) {
              // é è¨­å°åˆ°è¨‚é–±é ï¼ˆä¸å¸¶æ–¹æ¡ˆï¼›å¦‚éœ€å¯æ”¹ 'monthly' æˆ– 'yearly'ï¼‰
              return showSubscriptionPaywall();
            }
          }
        }
        // å…¶ä»–é é¢æ­£å¸¸åˆ‡æ›
        if (originalSwitchPage) {
          return originalSwitchPage(page);
        }
      };

      // è™•ç† mode-card é»æ“Š
      async function handleModeCardClick(modeId) {
        console.log('Mode card clicked:', modeId);
        
        // ä½¿ç”¨ checkFeatureAccess æª¢æŸ¥ç™»å…¥å’Œè¨‚é–±ç‹€æ…‹
        if (window.ReelMindCommon && window.ReelMindCommon.checkFeatureAccess) {
          const canAccess = await window.ReelMindCommon.checkFeatureAccess();
          if (canAccess) {
            // å¯ä»¥è¨ªå•ï¼Œè·³è½‰åˆ°å°æ‡‰çš„ç¨ç«‹é é¢
            const pageMap = {
              'mode1': 'mode3.html',  // ä¸€éµç”Ÿæˆæ¨¡å¼ â†’ mode3.html
              'mode2': 'mode2.html',  // AIé¡§å•æ¨¡å¼ â†’ mode2.html
              'mode3': 'mode1.html',  // IPäººè¨­è¦åŠƒæ¨¡å¼ â†’ mode1.html
              'userDB': 'userDB.html'
            };
            
            const targetPage = pageMap[modeId];
            if (targetPage) {
              window.location.href = targetPage;
            } else {
              // å¦‚æœæ²’æœ‰å°æ‡‰çš„ç¨ç«‹é é¢ï¼Œä½¿ç”¨åŸæœ‰çš„ switchPage
              switchPage(modeId);
            }
          }
          // å¦‚æœç„¡æ³•è¨ªå•ï¼ŒcheckFeatureAccess å·²ç¶“è™•ç†äº†ç™»å…¥/è¨‚é–±æµç¨‹
        } else {
          // é™ç´šè™•ç†ï¼šç›´æ¥è·³è½‰åˆ°ç¨ç«‹é é¢ï¼ˆä½¿ç”¨ç›¸åŒçš„æ˜ å°„é—œä¿‚ï¼‰
          const pageMap = {
            'mode1': 'mode3.html',  // ä¸€éµç”Ÿæˆæ¨¡å¼ â†’ mode3.html
            'mode2': 'mode2.html',  // AIé¡§å•æ¨¡å¼ â†’ mode2.html
            'mode3': 'mode1.html',  // IPäººè¨­è¦åŠƒæ¨¡å¼ â†’ mode1.html
            'userDB': 'userDB.html'
          };
          
          const targetPage = pageMap[modeId];
          if (targetPage) {
            window.location.href = targetPage;
          } else {
            switchPage(modeId);
          }
        }
      }
      
      // è™•ç†å‰µä½œè€…è³‡æ–™åº«é»æ“Š
      async function handleUserDBClick() {
        // ä½¿ç”¨ checkFeatureAccess æª¢æŸ¥ç™»å…¥ç‹€æ…‹ï¼ˆå‰µä½œè€…è³‡æ–™åº«å…è¨±æœªè¨‚é–±ç”¨æˆ¶è¨ªå•ï¼‰
        if (window.ReelMindCommon && window.ReelMindCommon.checkFeatureAccess) {
          const canAccess = await window.ReelMindCommon.checkFeatureAccess('userDB');
          if (canAccess) {
            // å¯ä»¥è¨ªå•ï¼Œè·³è½‰åˆ°å‰µä½œè€…è³‡æ–™åº«
            window.location.href = 'userDB.html';
          }
          // å¦‚æœç„¡æ³•è¨ªå•ï¼ˆæœªç™»å…¥ï¼‰ï¼ŒcheckFeatureAccess å·²ç¶“è™•ç†äº†ç™»å…¥æµç¨‹
        } else {
          // é™ç´šè™•ç†ï¼šç›´æ¥è·³è½‰
          window.location.href = 'userDB.html';
        }
      }
      
      // è™•ç†è¨‚é–±æŒ‰éˆ•é»æ“Š
      async function handleSubscriptionClick(plan) {
        console.log('Subscription button clicked:', plan);
        
        // å…ˆæª¢æŸ¥ç™»å…¥ç‹€æ…‹
        if (window.ReelMindCommon && window.ReelMindCommon.checkLoginStatus) {
          const loggedIn = await window.ReelMindCommon.checkLoginStatus();
          
          if (!loggedIn) {
            // æœªç™»å…¥ï¼Œå…ˆè·³è½‰ç™»å…¥
            if (typeof goToLogin === 'function') {
              // ä¿å­˜ç›®æ¨™æ–¹æ¡ˆåˆ° sessionStorageï¼Œç™»å…¥æˆåŠŸå¾Œä½¿ç”¨
              sessionStorage.setItem('pendingSubscriptionPlan', plan);
              goToLogin();
            } else {
              alert('è«‹å…ˆç™»å…¥ä»¥è¨‚é–±æœå‹™ï¼');
            }
            return;
          }
        }
        
        // å·²ç™»å…¥ï¼Œç›´æ¥è·³è½‰åˆ°è¨‚é–±é 
        window.location.href = `subscription.html?plan=${plan}`;
      }
      
      // åœ¨ç™»å…¥æˆåŠŸå¾Œèˆ‡è¨‚é–±ç‹€æ…‹è¼‰å…¥æ™‚ï¼ŒåŒæ­¥æœ¬åœ° user.is_subscribed æ¬„ä½
      function markUnsubscribedByDefault() {
        try {
          const userStr = localStorage.getItem('ipPlanningUser');
          if (!userStr) return;
          const user = JSON.parse(userStr);
          if (!('is_subscribed' in user)) {
            user.is_subscribed = false;
            localStorage.setItem('ipPlanningUser', JSON.stringify(user));
          }
        } catch (_) {}
      }
      // ç«‹å³åŸ·è¡Œä¸€æ¬¡ï¼Œç¢ºä¿ç›®å‰ç€è¦½ä½¿ç”¨è€…ç‚ºæœªè¨‚é–±é è¨­ï¼ˆå¾Œç«¯äº¦æœƒé è¨­æœªè¨‚é–±ï¼‰
      markUnsubscribedByDefault();
      
      // æ§åˆ¶è¨‚é–±é–å®šæµ®å±¤é¡¯ç¤º
      function updateSubscriptionLock() {
        const overlay = document.getElementById('subscription-lock-overlay');
        
        // æª¢æŸ¥è¨‚é–±ç‹€æ…‹å’Œç™»å…¥ç‹€æ…‹
        const isSubscribed = document.body.dataset.subscribed === 'true';
        const isLoggedIn = ipPlanningToken && ipPlanningUser;
        
        if (overlay) {
          if (isSubscribed && isLoggedIn) {
            // å·²ç™»å…¥ä¸”æœ‰è¨‚é–±ï¼Œéš±è—æµ®å±¤
            overlay.style.display = 'none';
          } else {
            // æœªç™»å…¥æˆ–æœªè¨‚é–±ï¼Œé¡¯ç¤ºæµ®å±¤
            overlay.style.display = 'flex';
            
            // æ ¹æ“šç™»å…¥ç‹€æ…‹æ›´æ–°æŒ‰éˆ•æ–‡å­—
            const loginButton = overlay.querySelector('a[href="/login"]');
            if (loginButton) {
              if (isLoggedIn) {
                // å·²ç™»å…¥ä½†æœªè¨‚é–±ï¼Œé¡¯ç¤ºè¨‚é–±æç¤º
                overlay.querySelector('h3').textContent = 'ğŸ”’ è§£é–å®Œæ•´åŠŸèƒ½';
                overlay.querySelector('p').textContent = 'ç«‹å³è¨‚é–±å³å¯ä½¿ç”¨æ‰€æœ‰ AI çŸ­å½±éŸ³åŠŸèƒ½';
                // éš±è—ç™»å…¥æŒ‰éˆ•ï¼Œå› ç‚ºå·²ç¶“ç™»å…¥äº†
                loginButton.style.display = 'none';
              } else {
                // æœªç™»å…¥ï¼Œä¿æŒåŸä¾†çš„æç¤º
                overlay.querySelector('h3').textContent = 'ğŸ”’ è§£é–å®Œæ•´åŠŸèƒ½';
                overlay.querySelector('p').textContent = 'è«‹å…ˆç™»å…¥ä¸¦è¨‚é–±å³å¯ä½¿ç”¨æ‰€æœ‰ AI çŸ­å½±éŸ³åŠŸèƒ½';
                loginButton.style.display = 'block';
              }
            }
          }
        }
      }
      
      // åˆå§‹åŒ–æ‰‹æ©Ÿç‰ˆä¸€éµç”Ÿæˆæ¨™ç±¤åˆ‡æ›åŠŸèƒ½
      function initializeMode1MobileTabs() {
        const tabs = document.querySelectorAll('.mode1-mobile-tab');
        const panels = document.querySelectorAll('.mode1-mobile-panel');
        
        tabs.forEach(tab => {
          tab.addEventListener('click', () => {
            const targetTab = tab.getAttribute('data-tab');
            
            // ç§»é™¤æ‰€æœ‰activeé¡
            tabs.forEach(t => t.classList.remove('active'));
            panels.forEach(p => p.classList.remove('show'));
            
            // æ·»åŠ activeé¡åˆ°é»æ“Šçš„æ¨™ç±¤
            tab.classList.add('active');
            
            // é¡¯ç¤ºå°æ‡‰çš„é¢æ¿
            const targetPanel = document.getElementById(`mode1-mobile-${targetTab}`);
            if (targetPanel) {
              targetPanel.classList.add('show');
            }
          });
        });
      }
      
      // å…¨åŸŸè®Šæ•¸
      let ipPlanningUser = null;
      let ipPlanningToken = null;
      let isRefreshingToken = false; // é˜²æ­¢é‡è¤‡åˆ·æ–°
      let lastRefreshAttempt = 0; // ä¸Šæ¬¡åˆ·æ–°å˜—è©¦çš„æ™‚é–“
      let handleAuthMessage = null; // èªè­‰è¨Šæ¯è™•ç†å‡½æ•¸ï¼ˆåœ¨ login() ä¸­å‹•æ…‹å‰µå»ºï¼‰
      
      // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
      async function checkLoginStatus() {
        // å¾ localStorage ç²å–æœ€æ–°çš„ token å’Œç”¨æˆ¶è³‡è¨Š
        const storedToken = localStorage.getItem('ipPlanningToken');
        const storedUserStr = localStorage.getItem('ipPlanningUser');
        
        // æ›´æ–°å…¨å±€è®Šæ•¸ï¼ˆç¢ºä¿ä½¿ç”¨æœ€æ–°çš„è³‡æ–™ï¼‰
        if (storedToken) {
          ipPlanningToken = storedToken;
        }
        if (storedUserStr) {
          try {
            ipPlanningUser = JSON.parse(storedUserStr);
          } catch (e) {
            console.warn('ç„¡æ³•è§£æç”¨æˆ¶è³‡æ–™:', e);
            ipPlanningUser = null;
          }
        }
        
        // ç„¡è«–æ˜¯å¦ç™»å…¥ï¼Œéƒ½å…ˆé¡¯ç¤ºé¦–é 
        showMainApp();
        
        // æ ¹æ“šç™»å…¥ç‹€æ…‹æ›´æ–° UI
        if (ipPlanningToken && ipPlanningUser) {
          // æª¢æŸ¥ token æ˜¯å¦å·²éæœŸ
          if (isTokenExpired(ipPlanningToken)) {
            // Token å·²éæœŸï¼Œå˜—è©¦åˆ·æ–°
            console.log('Token å·²éæœŸï¼Œå˜—è©¦åˆ·æ–°...');
            const refreshed = await tryRefreshTokenSafe();
            if (!refreshed) {
              // åˆ·æ–°å¤±æ•—ï¼Œå·²è‡ªå‹•ç™»å‡ºï¼ˆåœ¨ tryRefreshTokenSafe ä¸­è™•ç†ï¼‰
              return;
            }
            // åˆ·æ–°æˆåŠŸå¾Œï¼Œé‡æ–°å¾ localStorage ç²å–æœ€æ–°çš„ token
            const newToken = localStorage.getItem('ipPlanningToken');
            if (newToken) {
              ipPlanningToken = newToken;
            }
          } else if (isTokenExpiringSoon(ipPlanningToken)) {
            // Token å³å°‡éæœŸï¼Œä¸»å‹•åˆ·æ–°
            await proactiveRefreshToken();
            // åˆ·æ–°å¾Œé‡æ–°ç²å–æœ€æ–°çš„ token
            const newToken = localStorage.getItem('ipPlanningToken');
            if (newToken) {
              ipPlanningToken = newToken;
            }
          }
          updateUserInfo();
        } else {
          // æœªç™»å…¥æ™‚é¡¯ç¤ºç™»å…¥æŒ‰éˆ•
          showLoginButton();
        }
      }
      
      // é¡¯ç¤ºç™»å…¥é é¢
      function showLoginPage() {
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('appContainer').style.display = 'none';
      }
      
      // é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼
      function showMainApp() {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('appContainer').style.display = 'block';
        
        // è¨­ç½®é»˜èªé é¢ç‚ºé¦–é 
        switchPage('homepage');
      }
      
      // é¡¯ç¤ºç™»å…¥æŒ‰éˆ•
      function showLoginButton() {
        const authButtons = document.querySelector('.auth-buttons');
        const userInfo = document.getElementById('userInfo');
        if (authButtons) authButtons.style.display = 'flex';
        if (userInfo) userInfo.style.display = 'none';
      }
      
      // é¡¯ç¤ºç”¨æˆ¶è³‡è¨Š
      async function updateUserInfo() {
        const authButtons = document.querySelector('.auth-buttons');
        const userInfo = document.getElementById('userInfo');
        if (authButtons) authButtons.style.display = 'none';
        if (userInfo && ipPlanningUser) {
          userInfo.style.display = 'flex';
          const userNameEl = document.getElementById('userName');
          const userAvatarEl = document.getElementById('userAvatar');
          if (userNameEl) userNameEl.textContent = ipPlanningUser.name || 'ç”¨æˆ¶';
          if (userAvatarEl && ipPlanningUser.picture) {
            userAvatarEl.src = ipPlanningUser.picture;
          }
        }
        // æ›´æ–°ç”¨æˆ¶è³‡è¨Šå¾Œï¼Œæª¢æŸ¥è¨‚é–±ç‹€æ…‹
        await checkSubscriptionStatus();
        
        // æ›´æ–°é¦–é è¦–åœ–
        updateHomepageView();
      }
      
      // è·³éç™»å…¥
      function skipLogin() {
        showMainApp();
        showLoginButton();
      }
      
      // å‰å¾€ç™»å…¥é é¢
      function goToLogin() {
        // è·³è½‰åˆ°ç™»å…¥é é¢ï¼ˆåœ–1ï¼‰
        document.getElementById('loginPage').style.display = 'flex';
        document.getElementById('appContainer').style.display = 'none';
      }
      
      // æª¢æŸ¥è¨‚é–±ç‹€æ…‹ä¸¦æ›´æ–°æµ®å±¤
      async function checkSubscriptionStatus() {
        // å¦‚æœæœ‰ç™»å…¥è³‡è¨Šï¼Œå¾å¾Œç«¯ API ç²å–è¨‚é–±ç‹€æ…‹
        if (ipPlanningToken && ipPlanningUser && ipPlanningUser.user_id) {
          try {
            let response = await fetch('https://aivideobackend.zeabur.app/api/auth/me', {
              headers: {
                'Authorization': `Bearer ${ipPlanningToken}`
              }
            });
            
            // å¦‚æœæ”¶åˆ° 401ï¼Œå˜—è©¦åˆ·æ–° token å¾Œé‡è©¦
            if (response.status === 401) {
              const refreshed = await tryRefreshTokenSafe();
              if (refreshed) {
                // Token åˆ·æ–°æˆåŠŸï¼Œä½¿ç”¨æ–° token é‡è©¦
                response = await fetch('https://aivideobackend.zeabur.app/api/auth/me', {
                  headers: {
                    'Authorization': `Bearer ${ipPlanningToken}`
                  }
                });
              }
            }
            
            if (response.ok) {
              const userInfo = await response.json();
              console.log('ç”¨æˆ¶è³‡è¨Š:', userInfo);
              console.log('è¨‚é–±ç‹€æ…‹:', userInfo.is_subscribed);
              
              // æ›´æ–°è¨‚é–±ç‹€æ…‹
              // è™•ç†å„ç¨®å¯èƒ½çš„è¿”å›é¡å‹
              const isSubscribed = userInfo.is_subscribed === true || 
                                  userInfo.is_subscribed === 1 || 
                                  userInfo.is_subscribed === 'true' ||
                                  userInfo.is_subscribed === '1' ||
                                  userInfo.is_subscribed === undefined;
              
              if (isSubscribed) {
                document.body.dataset.subscribed = 'true';
                localStorage.setItem('subscriptionStatus', 'active');
                console.log('è¨­ç‚ºå·²è¨‚é–±ï¼Œè¨‚é–±ç‹€æ…‹:', userInfo.is_subscribed);
              } else {
                document.body.dataset.subscribed = 'false';
                localStorage.setItem('subscriptionStatus', 'inactive');
                console.log('è¨­ç‚ºæœªè¨‚é–±ï¼Œè¨‚é–±ç‹€æ…‹:', userInfo.is_subscribed);
              }
            } else {
              // API å¤±æ•—ï¼ˆåŒ…æ‹¬ 401 åˆ·æ–°å¤±æ•—ï¼‰ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜æˆ–é è¨­å·²è¨‚é–±
              const localSubscriptionStatus = localStorage.getItem('subscriptionStatus');
              const localIsSubscribed = ipPlanningUser.is_subscribed !== false; // é è¨­ç‚ºå·²è¨‚é–±
              
              if (localSubscriptionStatus === 'active' || localIsSubscribed) {
              document.body.dataset.subscribed = 'true';
              localStorage.setItem('subscriptionStatus', 'active');
              } else {
                document.body.dataset.subscribed = 'false';
                localStorage.setItem('subscriptionStatus', 'inactive');
              }
              // éœé»˜è™•ç†ï¼Œä¸é¡¯ç¤ºéŒ¯èª¤æ—¥èªŒ
            }
          } catch (error) {
            // ç¶²è·¯éŒ¯èª¤ç­‰ç•°å¸¸ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜æˆ–é è¨­å·²è¨‚é–±
            const localSubscriptionStatus = localStorage.getItem('subscriptionStatus');
            const localIsSubscribed = ipPlanningUser && ipPlanningUser.is_subscribed !== false;
            
            if (localSubscriptionStatus === 'active' || localIsSubscribed) {
            document.body.dataset.subscribed = 'true';
            localStorage.setItem('subscriptionStatus', 'active');
            } else {
              document.body.dataset.subscribed = 'false';
              localStorage.setItem('subscriptionStatus', 'inactive');
            }
            // ä¸è¼¸å‡ºéŒ¯èª¤æ—¥èªŒï¼Œé¿å…æ§åˆ¶å°å™ªéŸ³
          }
        } else {
          // æœªç™»å…¥ï¼Œå¾æœ¬åœ°å­˜å„²æª¢æŸ¥è¨‚é–±ç‹€æ…‹
          const subscriptionStatus = localStorage.getItem('subscriptionStatus');
          
          if (subscriptionStatus === 'active') {
            document.body.dataset.subscribed = 'true';
          } else {
            document.body.dataset.subscribed = 'false';
          }
        }
        
        console.log('ç•¶å‰è¨‚é–±ç‹€æ…‹:', document.body.dataset.subscribed);
        console.log('ç™»å…¥ç‹€æ…‹:', ipPlanningToken && ipPlanningUser ? 'å·²ç™»å…¥' : 'æœªç™»å…¥');
        
        // æ›´æ–°é–å®šæµ®å±¤
        updateSubscriptionLock();
        
        // æ›´æ–°é¦–é è¦–åœ–
        updateHomepageView();
      }
      
      // æ ¹æ“šç”¨æˆ¶æ¬Šé™é¡¯ç¤ºå°æ‡‰çš„é¦–é è¦–åœ–
      function updateHomepageView() {
        // æª¢æŸ¥ç™»å…¥ç‹€æ…‹
        const token = localStorage.getItem('ipPlanningToken');
        const userStr = localStorage.getItem('ipPlanningUser');
        const isLoggedIn = !!(token && userStr);
        
        // æª¢æŸ¥è¨‚é–±ç‹€æ…‹
        let userSubscribed = false;
        if (isLoggedIn && userStr) {
          try {
            const user = JSON.parse(userStr);
            userSubscribed = !!(user && (user.is_subscribed === true || user.is_subscribed === 1 || user.is_subscribed === '1'));
          } catch (e) {
            console.warn('ç„¡æ³•è§£æç”¨æˆ¶è³‡æ–™:', e);
          }
        }
        
        // åŒæ™‚æª¢æŸ¥ document.body.dataset.subscribedï¼ˆå¾å¾Œç«¯ API ç²å–çš„ç‹€æ…‹ï¼‰
        const backendSubscribed = document.body.dataset.subscribed === 'true';
        const isSubscribed = userSubscribed || backendSubscribed;
        
        // ç²å–è¦–åœ–å…ƒç´ 
        const unsubscribedView = document.getElementById('homepage-unsubscribed');
        const subscribedView = document.getElementById('homepage-subscribed');
        
        if (!unsubscribedView || !subscribedView) {
          console.warn('é¦–é è¦–åœ–å…ƒç´ æœªæ‰¾åˆ°');
          return;
        }
        
        // éš±è—æ‰€æœ‰è¦–åœ–
        unsubscribedView.style.display = 'none';
        subscribedView.style.display = 'none';
        
        // æ ¹æ“šæ¬Šé™é¡¯ç¤ºå°æ‡‰è¦–åœ–
        if (!isLoggedIn) {
          // æœªç™»å…¥ç”¨æˆ¶ â†’ é¡¯ç¤ºæœªè¨‚é–±è¦–åœ–
          unsubscribedView.style.display = 'block';
          console.log('é¡¯ç¤ºæœªç™»å…¥è¦–åœ–');
        } else if (isLoggedIn && !isSubscribed) {
          // å·²ç™»å…¥ä½†æœªè¨‚é–± â†’ é¡¯ç¤ºæœªè¨‚é–±è¦–åœ–
          unsubscribedView.style.display = 'block';
          console.log('é¡¯ç¤ºå·²ç™»å…¥æœªè¨‚é–±è¦–åœ–');
        } else if (isLoggedIn && isSubscribed) {
          // å·²ç™»å…¥ä¸”å·²è¨‚é–± â†’ é¡¯ç¤ºå·²è¨‚é–±è¦–åœ–
          subscribedView.style.display = 'block';
          console.log('é¡¯ç¤ºå·²ç™»å…¥å·²è¨‚é–±è¦–åœ–');
        }
      }
      
      // è¨­ç½®èªè¨€
      function setLanguage(lang) {
        // æ›´æ–°èªè¨€æŒ‰éˆ•ç‹€æ…‹
        document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // é€™è£¡å¯ä»¥æ·»åŠ èªè¨€åˆ‡æ›é‚è¼¯
        console.log('Language set to:', lang);
      }
      
      // èª¿è©¦å‡½æ•¸ï¼šæª¢æŸ¥AIé¡§å•æ¨¡å¼å…ƒç´ ç‹€æ…‹
      function debugAIConsultantElements() {
        console.log('=== èª¿è©¦AIé¡§å•æ¨¡å¼å…ƒç´  ===');
        
        const quickButtons = document.querySelector('.quick-buttons');
        const inputRow = document.querySelector('.input-row');
        const chatContainer = document.querySelector('#chatContainer');
        
        console.log('å¿«é€ŸæŒ‰éˆ•å…ƒç´ :', quickButtons);
        console.log('è¼¸å…¥å€åŸŸå…ƒç´ :', inputRow);
        console.log('èŠå¤©å®¹å™¨å…ƒç´ :', chatContainer);
        
        if (quickButtons) {
          console.log('å¿«é€ŸæŒ‰éˆ•æ¨£å¼:', {
            display: getComputedStyle(quickButtons).display,
            visibility: getComputedStyle(quickButtons).visibility,
            opacity: getComputedStyle(quickButtons).opacity,
            height: getComputedStyle(quickButtons).height,
            position: getComputedStyle(quickButtons).position,
            zIndex: getComputedStyle(quickButtons).zIndex
          });
        }
        
        if (inputRow) {
          console.log('è¼¸å…¥å€åŸŸæ¨£å¼:', {
            display: getComputedStyle(inputRow).display,
            visibility: getComputedStyle(inputRow).visibility,
            opacity: getComputedStyle(inputRow).opacity,
            height: getComputedStyle(inputRow).height,
            position: getComputedStyle(inputRow).position,
            zIndex: getComputedStyle(inputRow).zIndex
          });
        }
        
        if (chatContainer) {
          console.log('èŠå¤©å®¹å™¨æ¨£å¼:', {
            display: getComputedStyle(chatContainer).display,
            height: getComputedStyle(chatContainer).height,
            overflow: getComputedStyle(chatContainer).overflow,
            flexDirection: getComputedStyle(chatContainer).flexDirection
          });
        }
      }
      
      // ç§»å‹•ç¾æœ‰å…§å®¹åˆ°æ–°å®¹å™¨
      function moveExistingContent() {
        // ç§»å‹•ç”¨æˆ¶éœ€æ±‚è¨­å®šå…§å®¹
        const settingsBlock = document.querySelector('.settings-block');
        if (settingsBlock) {
          const container = document.getElementById('userSettingsContainer');
          if (container) {
            container.appendChild(settingsBlock);
            
            // è¨­ç½®ä½¿ç”¨èªªæ˜é¡¯ç¤ºæ§åˆ¶
            setupInstructionsToggle();
          }
          
          // è¤‡è£½åˆ°æ‰‹æ©Ÿç‰ˆå®¹å™¨
          const mobileSettingsContainer = document.querySelector('#mode1-mobile-setup #userSettingsContainer');
          if (mobileSettingsContainer) {
            const mobileSettingsBlock = settingsBlock.cloneNode(true);
            mobileSettingsContainer.appendChild(mobileSettingsBlock);
          }
        }
        
        // ç§»å‹•ä¸€éµç”Ÿæˆå…§å®¹
        const resultTabs = document.querySelector('.result-tabs');
        const resultsContainer = document.querySelector('.results-container');
        if (resultTabs && resultsContainer) {
          const container = document.getElementById('oneClickGenerationContainer');
          if (container) {
            container.appendChild(resultTabs);
            container.appendChild(resultsContainer);
          }
          
          // è¤‡è£½åˆ°æ‰‹æ©Ÿç‰ˆå®¹å™¨
          const mobileContainer = document.getElementById('oneClickGenerationContainerMobile');
          if (mobileContainer) {
            const mobileResultTabs = resultTabs.cloneNode(true);
            const mobileResultsContainer = resultsContainer.cloneNode(true);
            
            // ä¿®æ­£æ‰‹æ©Ÿç‰ˆæŒ‰éˆ•çš„onclickäº‹ä»¶
            const mobileButtons = mobileResultsContainer.querySelectorAll('.generate-btn');
            mobileButtons.forEach(btn => {
              const text = btn.textContent.trim();
              if (text.includes('å¸³è™Ÿå®šä½')) {
                btn.setAttribute('onclick', 'generatePositioning()');
              } else if (text.includes('é¸é¡Œ')) {
                btn.setAttribute('onclick', 'generateTopics()');
              } else if (text.includes('è…³æœ¬')) {
                btn.setAttribute('onclick', 'generateScript()');
              }
            });
            
            mobileContainer.appendChild(mobileResultTabs);
            mobileContainer.appendChild(mobileResultsContainer);
          }
        }
        
        // èŠå¤©å…§å®¹å·²ç¶“åœ¨æ­£ç¢ºä½ç½®ï¼Œä¸éœ€è¦ç§»å‹•
        // åªéœ€è¦ç¢ºä¿å¿«é€ŸæŒ‰éˆ•åŠŸèƒ½æ­£å¸¸
        setupQuickButtons();
      }
      
      // è¨­ç½®ä½¿ç”¨èªªæ˜é¡¯ç¤ºæ§åˆ¶
      function setupInstructionsToggle() {
        const settingsToggle = document.getElementById('settingsToggle');
        const settingsContent = document.getElementById('settingsContent');
        const instructions = document.getElementById('oneClickInstructions');
        
        if (settingsToggle && settingsContent && instructions) {
          // ç›£è½è¨­å®šå€å¡Šçš„å±•é–‹/æ”¶åˆ
          const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
              if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                const isExpanded = settingsContent.style.display !== 'none';
                instructions.style.display = isExpanded ? 'block' : 'none';
              }
            });
          });
          
          observer.observe(settingsContent, { attributes: true });
          
          // åˆå§‹ç‹€æ…‹æª¢æŸ¥
          const isExpanded = settingsContent.style.display !== 'none';
          instructions.style.display = isExpanded ? 'block' : 'none';
        }
      }
      
      // è¨­ç½®å¿«é€ŸæŒ‰éˆ•åŠŸèƒ½
      function setupQuickButtons() {
        // å¿«é€ŸæŒ‰éˆ•åŠŸèƒ½
        document.querySelectorAll('.quick-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const text = btn.getAttribute('data-text');
            if (text) {
              const messageInput = document.getElementById('messageInput');
              if (messageInput) {
                messageInput.value = text;
                messageInput.focus();
                
                // æ·»åŠ è¦–è¦ºåé¥‹
                btn.style.transform = 'scale(0.95)';
                setTimeout(() => {
                  btn.style.transform = 'scale(1)';
                }, 150);
              }
            }
          });
        });
      }

      // æ–°çš„å…ƒç´ å¼•ç”¨
      const chatEl = document.getElementById('chatMessages');
      const messageInput = document.getElementById('messageInput');
      const sendBtn = document.getElementById('sendBtn');
      const applyBtn = document.getElementById('applyBtn');
      const platformSelect = document.getElementById('platformSelect');
      const topicInput = document.getElementById('topicInput');
      const durationInput = document.getElementById('durationInput');
      const positioningInput = document.getElementById('positioningInput');
      
      // çµæœå€å¡Šå…ƒç´ 
      const resultsEl = document.getElementById('results');
      const resultTitleEl = document.getElementById('result-title');
      const resultScriptEl = document.getElementById('result-script');
      const resultVisualEl = document.getElementById('result-visual');
      const resultCopyEl = document.getElementById('result-copy');
      const scriptResult = document.getElementById('scriptResult');
      const positioningResult = document.getElementById('positioningResult');
      const topicSelectionResult = document.getElementById('topicSelectionResult');
      
      // æ§åˆ¶æŒ‰éˆ•ï¼ˆå·²ç§»é™¤ï¼ŒåŠŸèƒ½æ•´åˆåˆ°å¿«é€ŸæŒ‰éˆ•ä¸­ï¼‰
      
      // ç”¨æˆ¶æŠ½å±œå…ƒç´ 
      const userDrawer = document.getElementById('userDrawer');
      const userDrawerOverlay = document.getElementById('userDrawerOverlay');
      const drawerAvatar = document.getElementById('drawerAvatar');
      const drawerName = document.getElementById('drawerName');
      const drawerEmail = document.getElementById('drawerEmail');
      
      // èªè­‰ç›¸é—œå…ƒç´ 
      const userInfo = document.getElementById('userInfo');
      const userAvatar = document.getElementById('userAvatar');
      const userName = document.getElementById('userName');
      const loginBtn = document.getElementById('loginBtn');
      const logoutBtn = document.getElementById('logoutBtn');
      
      // å½ˆè·³è¦–çª—å…ƒç´ 
      const popupOverlay = document.getElementById('popupOverlay');
      const popupSpinner = document.getElementById('popupSpinner');
      const popupMessage = document.getElementById('popupMessage');
      const popupButtons = document.getElementById('popupButtons');
      const popupRetry = document.getElementById('popupRetry');
      const popupCancel = document.getElementById('popupCancel');
      
      // æç¤ºæ¡†
      const toastEl = document.getElementById('toast');
      
      // è¨­å®šå€å¡Šå…ƒç´ 
      const settingsToggleEl = document.getElementById('settingsToggle');
      const settingsContentEl = document.getElementById('settingsContent');
      
      // å…¨å±€è®Šæ•¸
      let currentPlatform = null;
      let currentTopic = null;
      let currentProfile = null;
      const styleInstruction = 'æ ¼å¼è¦æ±‚ï¼šåˆ†æ®µæ¸…æ¥šï¼ŒçŸ­å¥ï¼Œæ¯æ®µæ›è¡Œï¼Œé©åº¦åŠ å…¥è¡¨æƒ…ç¬¦è™Ÿï¼ˆå¦‚ï¼šâœ…âœ¨ğŸ”¥ğŸ“Œï¼‰ï¼Œé¿å…å£é ­ç¦ªã€‚çµ•å°ä¸è¦ä½¿ç”¨ ** æˆ–ä»»ä½• Markdown æ ¼å¼ç¬¦è™Ÿï¼Œæ‰€æœ‰å…§å®¹å¿…é ˆæ˜¯ç´”æ–‡å­—æ ¼å¼ã€‚';
      
      // ç”Ÿæˆéš¨æ©Ÿç”¨æˆ¶ID
      function generateUserId() {
        const timestamp = Date.now().toString(36);
        const randomStr = Math.random().toString(36).substring(2, 8);
        return `user_${timestamp}_${randomStr}`;
      }
      
      // ç”¨æˆ¶æŠ½å±œåŠŸèƒ½
      function toggleUserDrawer() {
        userDrawer.classList.toggle('open');
        userDrawerOverlay.classList.toggle('open');
        
        // å¦‚æœæŠ½å±œæ‰“é–‹ï¼Œè¼‰å…¥ç”¨æˆ¶æ­·å²è³‡è¨Š
        if (userDrawer.classList.contains('open') && ipPlanningUser) {
          loadUserHistory();
        }
      }
      
      function closeUserDrawer() {
        userDrawer.classList.remove('open');
        userDrawerOverlay.classList.remove('open');
      }
      
      // æ›´æ–°ç”¨æˆ¶æŠ½å±œè³‡è¨Š
      function updateUserDrawer(user) {
        if (user) {
          // ç¢ºä¿ç”¨æˆ¶æœ‰ID
          if (!user.user_id) {
            user.user_id = generateUserId();
            ipPlanningUser = user; // æ›´æ–°ç•¶å‰ç”¨æˆ¶
            localStorage.setItem('ipPlanningUser', JSON.stringify(user));
            console.log('åœ¨updateUserDrawerä¸­ç‚ºç”¨æˆ¶ç”Ÿæˆæ–°ID:', user.user_id);
          }
          
          // æ›´æ–°æŠ½å±œå…§çš„è³‡è¨Š
          drawerAvatar.src = user.picture || 'https://via.placeholder.com/50';
          drawerName.textContent = user.name || 'ç”¨æˆ¶';
          drawerEmail.textContent = user.email || '';
          
          // æ›´æ–°é ‚éƒ¨ header ä¸­çš„ç”¨æˆ¶è³‡è¨Š
          userAvatar.src = user.picture || 'https://via.placeholder.com/32';
          userName.textContent = user.name || 'ç”¨æˆ¶';
          
          // æ›´æ–°å€‹äººè³‡æ–™é¡¯ç¤º
          updatePersonalInfo();
          
          // è¼‰å…¥ç”¨æˆ¶çš„éå¾€è³‡è¨Š
          loadUserHistory();
        }
      }

      // è¼‰å…¥ç”¨æˆ¶æ­·å²è³‡è¨Š
      async function loadUserHistory() {
        // ç¢ºä¿ç”¨æˆ¶æœ‰ID
        if (!ipPlanningUser?.user_id) {
          console.log('æ²’æœ‰ç”¨æˆ¶IDï¼Œå˜—è©¦ç”Ÿæˆ...');
          if (ipPlanningUser) {
            ipPlanningUser.user_id = generateUserId();
            localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
            console.log('ç‚ºç”¨æˆ¶ç”Ÿæˆæ–°ID:', ipPlanningUser.user_id);
          } else {
            console.log('æ²’æœ‰ç•¶å‰ç”¨æˆ¶ï¼Œè·³éè¼‰å…¥æ­·å²');
            return;
          }
        }
        
        console.log('é–‹å§‹è¼‰å…¥ç”¨æˆ¶æ­·å²ï¼Œç”¨æˆ¶ID:', ipPlanningUser.user_id);
        
        try {
          // è¼‰å…¥å°è©±è¨˜éŒ„
          console.log('æ­£åœ¨è¼‰å…¥å°è©±è¨˜éŒ„...');
          const conversationsResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/conversations/${ipPlanningUser.user_id}`);
          console.log('å°è©±è¨˜éŒ„éŸ¿æ‡‰ç‹€æ…‹:', conversationsResponse.status);
          if (conversationsResponse.ok) {
            const conversationsData = await conversationsResponse.json();
            console.log('å°è©±è¨˜éŒ„æ•¸æ“š:', conversationsData);
            updateConversationsDisplay(conversationsData.conversations);
          } else {
            console.error('è¼‰å…¥å°è©±è¨˜éŒ„å¤±æ•—:', conversationsResponse.status, conversationsResponse.statusText);
          }
          
          // è¼‰å…¥ç”Ÿæˆè¨˜éŒ„
          console.log('æ­£åœ¨è¼‰å…¥ç”Ÿæˆè¨˜éŒ„...');
          const generationsResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/generations/${ipPlanningUser.user_id}`);
          console.log('ç”Ÿæˆè¨˜éŒ„éŸ¿æ‡‰ç‹€æ…‹:', generationsResponse.status);
          if (generationsResponse.ok) {
            const generationsData = await generationsResponse.json();
            console.log('ç”Ÿæˆè¨˜éŒ„æ•¸æ“š:', generationsData);
            updateGenerationsDisplay(generationsData.generations);
          } else {
            console.error('è¼‰å…¥ç”Ÿæˆè¨˜éŒ„å¤±æ•—:', generationsResponse.status, generationsResponse.statusText);
          }
          
          // è¼‰å…¥å¸³è™Ÿå®šä½è¨˜éŒ„
          console.log('æ­£åœ¨è¼‰å…¥å¸³è™Ÿå®šä½è¨˜éŒ„...');
          await loadPositioningRecords();
          
          // è¼‰å…¥ç”¨æˆ¶è¨˜æ†¶
          console.log('æ­£åœ¨è¼‰å…¥ç”¨æˆ¶è¨˜æ†¶...');
          const memoryResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/memory/${ipPlanningUser.user_id}`);
          console.log('ç”¨æˆ¶è¨˜æ†¶éŸ¿æ‡‰ç‹€æ…‹:', memoryResponse.status);
          if (memoryResponse.ok) {
            const memoryData = await memoryResponse.json();
            console.log('ç”¨æˆ¶è¨˜æ†¶æ•¸æ“š:', memoryData);
            updateMemoryDisplay(memoryData.memory);
          } else {
            console.error('è¼‰å…¥ç”¨æˆ¶è¨˜æ†¶å¤±æ•—:', memoryResponse.status, memoryResponse.statusText);
          }
          
        } catch (error) {
          console.error('è¼‰å…¥ç”¨æˆ¶æ­·å²è³‡è¨Šæ™‚å‡ºéŒ¯:', error);
        }
      }

      // æ›´æ–°å°è©±è¨˜éŒ„é¡¯ç¤º
      function updateConversationsDisplay(conversations) {
        const conversationsList = document.getElementById('conversationsList');
        if (!conversationsList) return;
        
        conversationsList.innerHTML = '';
        conversations.forEach(conv => {
          const item = document.createElement('div');
          item.className = 'conversation-item';
          item.innerHTML = `
            <div class="conversation-summary">${conv.summary}</div>
            <div class="conversation-date">${formatTaiwanTime(conv.created_at).split(' ')[0]}</div>
          `;
          conversationsList.appendChild(item);
        });
      }

      // æ›´æ–°ç”Ÿæˆè¨˜éŒ„é¡¯ç¤º
      function updateGenerationsDisplay(generations) {
        const generationsList = document.getElementById('generationsList');
        if (!generationsList) return;
        
        generationsList.innerHTML = '';
        generations.forEach(gen => {
          const item = document.createElement('div');
          item.className = 'generation-item';
          item.innerHTML = `
            <div class="generation-header">
              <span class="generation-platform">${gen.platform}</span>
              <span class="generation-topic">${gen.topic}</span>
            </div>
            <div class="generation-content">${gen.content}</div>
            <div class="generation-date">${formatTaiwanTime(gen.created_at).split(' ')[0]}</div>
          `;
          generationsList.appendChild(item);
        });
      }

      // æ›´æ–°è¨˜æ†¶é¡¯ç¤º
      function updateMemoryDisplay(memory) {
        const memoryContent = document.getElementById('memoryContent');
        if (!memoryContent) return;
        
        memoryContent.innerHTML = memory || 'æš«ç„¡è¨˜æ†¶è³‡è¨Š';
      }
      
      // è¼‰å…¥å¸³è™Ÿå®šä½è¨˜éŒ„
      async function loadPositioningRecords() {
        if (!ipPlanningUser?.user_id) return;
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${ipPlanningUser.user_id}`, {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            updatePositioningDisplay(data.records || []);
          }
        } catch (error) {
          console.error('è¼‰å…¥å¸³è™Ÿå®šä½è¨˜éŒ„å¤±æ•—:', error);
        }
      }
      
      // æ›´æ–°å¸³è™Ÿå®šä½é¡¯ç¤º
      function updatePositioningDisplay(records) {
        const positioningContent = document.getElementById('positioningHistoryContent');
        if (!positioningContent) return;
        
        if (records.length === 0) {
          positioningContent.innerHTML = '<p style="color: #666;">å°šç„¡å¸³è™Ÿå®šä½è¨˜éŒ„</p>';
          return;
        }
        
        let html = '<div class="positioning-records">';
        records.forEach(record => {
          const date = new Date(record.created_at).toLocaleString('zh-TW', {
            timeZone: 'Asia/Taipei',
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          });
          const preview = record.content.substring(0, 50) + (record.content.length > 50 ? '...' : '');
          
          html += `
            <div class="positioning-record-item">
              <div class="record-header">
                <span class="record-number">ç·¨è™Ÿ ${record.record_number}</span>
                <span class="record-date">${date}</span>
              </div>
              <div class="record-preview">${preview}</div>
              <div class="record-actions">
                <button class="view-btn" onclick="viewPositioningDetail(${record.id}, '${record.record_number}')">æŸ¥çœ‹å®Œæ•´çµæœ</button>
                <button class="delete-btn" onclick="deletePositioningRecord(${record.id})">åˆªé™¤</button>
              </div>
            </div>
          `;
        });
        html += '</div>';
        
        positioningContent.innerHTML = html;
      }
      
      // æŸ¥çœ‹å¸³è™Ÿå®šä½è©³ç´°å…§å®¹
      async function viewPositioningDetail(recordId, recordNumber) {
        if (!ipPlanningUser?.user_id) return;
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${ipPlanningUser.user_id}`, {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            const record = data.records.find(r => r.id === recordId);
            
            if (record) {
              // é¡¯ç¤ºè©³ç´°å…§å®¹åœ¨å½ˆå‡ºè¦–çª—
              showDetailModal(recordNumber, record.created_at, record.content);
            }
          }
        } catch (error) {
          console.error('è¼‰å…¥è©³ç´°å…§å®¹å¤±æ•—:', error);
          showToast('è¼‰å…¥å¤±æ•—', 3000);
        }
      }
      
      // é¡¯ç¤ºè©³ç´°å…§å®¹å½ˆå‡ºè¦–çª—
      function showDetailModal(recordNumber, createdAt, content) {
        const date = formatTaiwanTime(createdAt);
        const modal = document.createElement('div');
        modal.className = 'detail-modal-overlay';
        modal.innerHTML = `
          <div class="detail-modal">
            <div class="detail-modal-header">
              <h3>å¸³è™Ÿå®šä½è©³ç´°å…§å®¹</h3>
              <button class="close-detail-btn" onclick="this.closest('.detail-modal-overlay').remove()">âœ•</button>
            </div>
            <div class="detail-modal-body">
              <div class="detail-info">
                <span><strong>ç·¨è™Ÿï¼š</strong>${recordNumber}</span>
                <span><strong>ç”Ÿæˆæ—¥æœŸï¼š</strong>${date}</span>
              </div>
              <div class="detail-content">
                ${content.replace(/\n/g, '<br>')}
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
        
        // é»æ“ŠèƒŒæ™¯é—œé–‰
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
          }
        });
      }
      
      // åˆªé™¤å¸³è™Ÿå®šä½è¨˜éŒ„
      async function deletePositioningRecord(recordId) {
        if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†è¨˜éŒ„å—ï¼Ÿ')) return;
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${recordId}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            showToast('è¨˜éŒ„å·²åˆªé™¤', 2000);
            await loadPositioningRecords();
          } else {
            throw new Error('åˆªé™¤å¤±æ•—');
          }
        } catch (error) {
          console.error('åˆªé™¤éŒ¯èª¤:', error);
          showToast('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }

      // åˆ‡æ›æŠ½å±œå…§å®¹å€åŸŸ
      function switchDrawerContent(sectionId) {
        // éš±è—æ‰€æœ‰å…§å®¹å€åŸŸ
        const allSections = document.querySelectorAll('.content-section');
        allSections.forEach(section => {
          section.classList.remove('active');
        });
        
        // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ active ç‹€æ…‹
        const allMenuItems = document.querySelectorAll('.user-drawer-menu a');
        allMenuItems.forEach(item => {
          item.classList.remove('active');
        });
        
        // é¡¯ç¤ºé¸ä¸­çš„å…§å®¹å€åŸŸ
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
          targetSection.classList.add('active');
        }
        
        // æ·»åŠ å°æ‡‰æŒ‰éˆ•çš„ active ç‹€æ…‹
        const targetMenuItem = document.querySelector(`[data-section="${sectionId}"]`);
        if (targetMenuItem) {
          targetMenuItem.classList.add('active');
        }
        
        // æ ¹æ“šä¸åŒçš„å€åŸŸè¼‰å…¥ç›¸æ‡‰çš„æ•¸æ“š
        switch(sectionId) {
          case 'myScripts':
            loadMyScripts();
            break;
          case 'accountPositioning':
            loadPositioningRecords();
            break;
          case 'topicHistory':
            loadTopicHistory();
            break;
        }
      }

      // æ›´æ–°å€‹äººè³‡æ–™é¡¯ç¤º
      function updatePersonalInfo() {
        if (ipPlanningUser) {
          // ç¢ºä¿ç”¨æˆ¶æœ‰IDï¼Œå¦‚æœæ²’æœ‰å‰‡ç”Ÿæˆä¸€å€‹
          if (!ipPlanningUser.user_id) {
            ipPlanningUser.user_id = generateUserId();
            localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
            console.log('åœ¨updatePersonalInfoä¸­ç‚ºç”¨æˆ¶ç”Ÿæˆæ–°ID:', ipPlanningUser.user_id);
          }
          
          const userNameDetail = document.getElementById('userNameDetail');
          const userEmailDetail = document.getElementById('userEmailDetail');
          const userIdDetail = document.getElementById('userIdDetail');
          
          if (userNameDetail) userNameDetail.textContent = ipPlanningUser.name || ipPlanningUser.displayName || 'æœªè¨­å®š';
          if (userEmailDetail) userEmailDetail.textContent = ipPlanningUser.email || 'æœªè¨­å®š';
          if (userIdDetail) userIdDetail.textContent = ipPlanningUser.user_id || 'æœªç”Ÿæˆ';
          
          console.log('æ›´æ–°å€‹äººè³‡æ–™:', {
            name: ipPlanningUser.name,
            email: ipPlanningUser.email,
            user_id: ipPlanningUser.user_id
          });
        }
      }
      
      // æ›´æ–°ç”¨æˆ¶è³‡è¨Šé¡¯ç¤º
      function updateUserInfo() {
        if (ipPlanningUser) {
          // æ›´æ–°é ­åƒ
          if (userAvatar) {
            userAvatar.src = ipPlanningUser.picture || 'https://via.placeholder.com/32';
          }
          // æ›´æ–°ç”¨æˆ¶å
          if (userName) {
            userName.textContent = ipPlanningUser.name || ipPlanningUser.displayName || 'ç”¨æˆ¶';
          }
          // é¡¯ç¤ºç”¨æˆ¶è³‡è¨Šå€åŸŸ
          if (userInfo) {
            userInfo.style.display = 'flex';
          }
          console.log('ç”¨æˆ¶è³‡è¨Šå·²æ›´æ–°:', ipPlanningUser);
        }
      }
      
      // æ›´æ–°èªè­‰ UI
      function updateAuthUI(isLoggedIn) {
        if (isLoggedIn) {
          // æ›´æ–°ç”¨æˆ¶è³‡è¨Šé¡¯ç¤º
          updateUserInfo();
          loginBtn.style.display = 'none';
          updateUserDrawer(ipPlanningUser);
          // é¡¯ç¤ºå€‹äººè³‡æ–™åº«åˆ†é 
          const userDBTab = document.getElementById('userDBTab');
          if (userDBTab) {
            userDBTab.style.display = 'inline-block';
          }
          // åŒæ™‚æ›´æ–°åº•éƒ¨å°èˆªæ¬„
          const bottomUserDBTab = document.getElementById('bottomUserDBTab');
          if (bottomUserDBTab) {
            bottomUserDBTab.style.display = 'flex';
          }
          // æ›´æ–°å€‹äººè³‡æ–™åº«ç”¨æˆ¶è³‡è¨Š
          updateDbUserInfo();
        } else {
          userInfo.style.display = 'none';
          loginBtn.style.display = 'block';
          closeUserDrawer();
          // éš±è—å€‹äººè³‡æ–™åº«åˆ†é 
          const userDBTab = document.getElementById('userDBTab');
          if (userDBTab) {
            userDBTab.style.display = 'none';
          }
          // åŒæ™‚éš±è—åº•éƒ¨å°èˆªæ¬„
          const bottomUserDBTab = document.getElementById('bottomUserDBTab');
          if (bottomUserDBTab) {
            bottomUserDBTab.style.display = 'none';
          }
        }
      }
      
      // å–æ¶ˆè¨‚é–±åŠŸèƒ½
      async function cancelSubscription() {
        if (!confirm('ç¢ºå®šè¦å–æ¶ˆè‡ªå‹•çºŒè²»å—ï¼Ÿå–æ¶ˆå¾Œå°‡åœ¨ç•¶æœŸçµæŸæ™‚åœæ­¢æœå‹™ã€‚')) {
          return;
        }
        
        if (!ipPlanningToken || !ipPlanningUser) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        try {
          // èª¿ç”¨å¾Œç«¯APIå–æ¶ˆè¨‚é–±
          const response = await fetch(`https://aivideobackend.zeabur.app/api/auth/me`, {
            method: 'PUT',
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              is_subscribed: false
            })
          });
          
          if (response.ok) {
            // æ›´æ–°æœ¬åœ°ç‹€æ…‹
            ipPlanningUser.is_subscribed = false;
            localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
            document.body.dataset.subscribed = 'false';
            
            showToast('å·²å–æ¶ˆè‡ªå‹•çºŒè²»', 3000);
            
            // é‡æ–°è¼‰å…¥å€‹äººè³‡æ–™
            setTimeout(() => {
              loadPersonalInfoForUserDB();
              closeUserDrawer();
            }, 1000);
          } else {
            showToast('æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
          }
        } catch (error) {
          console.error('å–æ¶ˆè¨‚é–±å¤±æ•—:', error);
          showToast('æ“ä½œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // ç™»å‡ºåŠŸèƒ½
      function logout() {
        // ç™»å‡ºæ™‚æ›´æ–°é¦–é è¦–åœ–
        updateHomepageView();
        ipPlanningToken = null;
        ipPlanningUser = null;
        localStorage.removeItem('ipPlanningToken');
        localStorage.removeItem('ipPlanningUser');
        localStorage.removeItem('subscriptionStatus');
        
        // æ¸…ç©ºèŠå¤©è¨˜éŒ„ï¼ˆä½†å¾Œç«¯é•·æœŸè¨˜æ†¶æœƒä¿ç•™ï¼‰
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
          chatMessages.innerHTML = '';
        }
        const mode3ChatMessages = document.getElementById('mode3-chatMessages');
        if (mode3ChatMessages) {
          mode3ChatMessages.innerHTML = '';
        }
        
        updateAuthUI(false);
        showToast('å·²ç™»å‡º', 3000);
        closeUserDrawer();
        
        // é¡¯ç¤ºé¦–é ï¼ˆä¸è·³è½‰åˆ°ç™»å…¥é é¢ï¼‰
        showMainApp();
        
        // é¡¯ç¤ºç™»å…¥æŒ‰éˆ•
        showLoginButton();
        
        // æ›´æ–°è¨‚é–±ç‹€æ…‹ç‚ºæœªè¨‚é–±
        document.body.dataset.subscribed = 'false';
        updateSubscriptionLock();
        
        // æ›´æ–°é¦–é è¦–åœ–ï¼ˆåœ¨æ¸…ç†ç‹€æ…‹å¾Œï¼‰
        setTimeout(() => {
          updateHomepageView();
        }, 100);
      }
      // æ›´æ–°å€‹äººè³‡æ–™åº«ç”¨æˆ¶è³‡è¨Š
      function updateDbUserInfo() {
        if (ipPlanningUser) {
          const dbUserAvatar = document.getElementById('dbUserAvatar');
          const dbUserName = document.getElementById('dbUserName');
          const dbUserEmail = document.getElementById('dbUserEmail');
          
          if (dbUserAvatar) dbUserAvatar.src = ipPlanningUser.picture || 'https://via.placeholder.com/48';
          if (dbUserName) dbUserName.textContent = ipPlanningUser.name || 'ç”¨æˆ¶';
          if (dbUserEmail) dbUserEmail.textContent = ipPlanningUser.email || 'user@example.com';
        }
      }
      
      // é¡¯ç¤ºå€‹äººè³‡æ–™åº«åˆ†å€
      function showDbSection(sectionName) {
        // éš±è—æ‰€æœ‰åˆ†å€
        document.querySelectorAll('.db-section').forEach(section => {
          section.classList.remove('active');
        });
        
        // ç§»é™¤æ‰€æœ‰é¸å–®é …çš„activeç‹€æ…‹
        document.querySelectorAll('.menu-item').forEach(item => {
          item.classList.remove('active');
        });
        
        // é¡¯ç¤ºé¸ä¸­çš„åˆ†å€
        const targetSection = document.getElementById(`db-${sectionName}`);
        if (targetSection) {
          targetSection.classList.add('active');
        }
        
        // æ·»åŠ å°æ‡‰é¸å–®é …çš„activeç‹€æ…‹
        const targetMenuItem = document.querySelector(`[onclick="showDbSection('${sectionName}')"]`);
        if (targetMenuItem) {
          targetMenuItem.classList.add('active');
        }
        
        // æ ¹æ“šåˆ†å€è¼‰å…¥ç›¸æ‡‰æ•¸æ“š
        switch(sectionName) {
          case 'personalInfo':
            loadPersonalInfoForUserDB();
            break;
          case 'myScripts':
            loadMyScriptsForUserDB();
            break;
          case 'settings':
            loadSavedApiKey();
            loadDisplayPreferences();
            // æ¸…é™¤æ¸¬è©¦çµæœé¡¯ç¤º
            const testResultDiv = document.getElementById('testKeyResult');
            if (testResultDiv) {
              testResultDiv.style.display = 'none';
            }
            break;
          case 'accountPositioning':
            loadPositioningRecordsForUserDB();
            break;
          case 'topicRecords':
            loadTopicHistoryForUserDB();
            break;
          case 'ipPlanning':
            loadIpPlanningResultsForUserDB();
            break;
          case 'myOrders':
            loadMyOrdersForUserDB();
            break;
          case 'settings':
            // è¨­å®šé é¢å…§å®¹å·²åœ¨HTMLä¸­å®šç¾©ï¼Œç„¡éœ€å‹•æ…‹è¼‰å…¥
            break;
          case 'usageStats':
            loadUsageStatsForUserDB();
            break;
          case 'helpCenter':
            // å¹«åŠ©ä¸­å¿ƒå…§å®¹å·²åœ¨HTMLä¸­å®šç¾©ï¼Œç„¡éœ€å‹•æ…‹è¼‰å…¥
            break;
        }
      }
      
      // çµ±ä¸€çš„è¼‰å…¥å‹•ç•«å‡½æ•¸
      function showLoadingAnimation(container, message = 'è¼‰å…¥ä¸­...') {
        if (!container) return;
        container.innerHTML = `
          <div style="display: flex; align-items: center; justify-content: center; padding: 40px; gap: 12px; flex-direction: column;">
            <div class="spinner" style="width: 24px; height: 24px; border: 3px solid #e5e7eb; border-top: 3px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 8px;"></div>
            <span style="color: #6b7280; font-size: 14px;">${message}</span>
          </div>
        `;
      }
      
      // æ¸²æŸ“å€‹äººè³‡æ–™å…§å®¹ï¼ˆç¨ç«‹å‡½æ•¸ï¼Œé¿å…éè¿´å•é¡Œï¼‰
      async function renderPersonalInfoContent() {
        const content = document.querySelector('#db-personalInfo .section-content');
        if (!content || !ipPlanningUser) return;
        
        // å¦‚æœæœ‰æœ¬åœ°å„²å­˜çš„ç”¨æˆ¶è³‡è¨Šï¼Œç›´æ¥ä½¿ç”¨ï¼ˆå³ä½¿ API å¤±æ•—ä¹Ÿèƒ½é¡¯ç¤ºï¼‰
          // æ ¼å¼åŒ–æ—¥æœŸé¡¯ç¤º
          let registrationTime = 'æœªçŸ¥';
          if (ipPlanningUser.created_at) {
            try {
              const date = new Date(ipPlanningUser.created_at);
              if (!isNaN(date.getTime())) {
                registrationTime = date.toLocaleString('zh-TW', {
                  timeZone: 'Asia/Taipei',
                  year: 'numeric',
                  month: '2-digit',
                  day: '2-digit',
                  hour: '2-digit',
                  minute: '2-digit'
                });
              }
            } catch (e) {
              // å¦‚æœæ ¼å¼åŒ–å¤±æ•—ï¼Œä½¿ç”¨åŸå§‹å€¼
              registrationTime = ipPlanningUser.created_at;
            }
          }
          
          // è¨‚é–±ç‹€æ…‹ï¼ˆé è¨­ç‚ºå·²è¨‚é–±ï¼Œé™¤éæ˜ç¢ºè¨­ç‚º falseï¼‰
          const isSubscribed = ipPlanningUser.is_subscribed !== false; // é è¨­ç‚ºå·²è¨‚é–±
          const subscriptionStatus = isSubscribed ? 
            '<span style="color: #10b981; font-weight: bold;">âœ… å·²è¨‚é–±</span>' : 
            '<span style="color: #ef4444; font-weight: bold;">âŒ æœªè¨‚é–±</span>';
          
          // è¼‰å…¥è©³ç´°è¨‚é–±è³‡è¨Šï¼ˆä½¿ç”¨æ–°çš„ APIï¼‰
          let expiresAt = null;
          let daysLeft = null;
          let expiresAtText = 'æœªçŸ¥';
          let daysLeftText = '';
          let expirationWarning = '';
          
          // å˜—è©¦å¾ API ç²å–è©³ç´°è¨‚é–±è³‡è¨Š
          if (ipPlanningToken && ipPlanningUser?.user_id) {
            try {
              const subResponse = await fetch('https://aivideobackend.zeabur.app/api/user/subscription', {
                headers: {
                  'Authorization': `Bearer ${ipPlanningToken}`
                }
              });
              
              if (subResponse.ok) {
                const subData = await subResponse.json();
                if (subData.expires_at) {
                  expiresAt = new Date(subData.expires_at);
                  const now = new Date();
                  daysLeft = Math.ceil((expiresAt - now) / (1000 * 60 * 60 * 24));
                  
                  expiresAtText = expiresAt.toLocaleString('zh-TW', {
                    timeZone: 'Asia/Taipei',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                  });
                  
                  if (daysLeft < 0) {
                    daysLeftText = `<span style="color: #ef4444; font-weight: bold;">ï¼ˆå·²éæœŸ ${Math.abs(daysLeft)} å¤©ï¼‰</span>`;
                    expirationWarning = '<div style="margin-top: 12px; padding: 12px; background: #fee2e2; border: 1px solid #fca5a5; border-radius: 8px; color: #991b1b;"><strong>âš ï¸ è¨‚é–±å·²éæœŸ</strong><br>è«‹å‰å¾€è¨‚é–±é é¢çºŒè²»ä»¥ç¹¼çºŒä½¿ç”¨æœå‹™ã€‚</div>';
                  } else if (daysLeft <= 3) {
                    daysLeftText = `<span style="color: #ef4444; font-weight: bold;">ï¼ˆå‰©é¤˜ ${daysLeft} å¤©ï¼‰</span>`;
                    expirationWarning = '<div style="margin-top: 12px; padding: 12px; background: #fef3c7; border: 1px solid #fde68a; border-radius: 8px; color: #92400e;"><strong>âš ï¸ è¨‚é–±å³å°‡åˆ°æœŸ</strong><br>è«‹ç›¡å¿«å‰å¾€è¨‚é–±é é¢çºŒè²»ã€‚</div>';
                  } else if (daysLeft <= 7) {
                    daysLeftText = `<span style="color: #f59e0b; font-weight: bold;">ï¼ˆå‰©é¤˜ ${daysLeft} å¤©ï¼‰</span>`;
                    expirationWarning = '<div style="margin-top: 12px; padding: 12px; background: #fffbeb; border: 1px solid #fde68a; border-radius: 8px; color: #92400e;"><strong>æé†’</strong><br>æ‚¨çš„è¨‚é–±å°‡åœ¨ 7 å¤©å…§åˆ°æœŸï¼Œè«‹è¨˜å¾—çºŒè²»ã€‚</div>';
                  } else {
                    daysLeftText = `<span style="color: #10b981;">ï¼ˆå‰©é¤˜ ${daysLeft} å¤©ï¼‰</span>`;
                  }
                }
              }
            } catch (e) {
              console.warn('è¼‰å…¥è¨‚é–±è©³æƒ…å¤±æ•—:', e);
              // å¦‚æœ API å¤±æ•—ï¼Œä½¿ç”¨èˆŠçš„è¨ˆç®—æ–¹å¼
              if (ipPlanningUser.created_at && isSubscribed) {
                try {
                  const createdDate = new Date(ipPlanningUser.created_at);
                  const renewal = new Date(createdDate);
                  renewal.setMonth(renewal.getMonth() + 1);
                  expiresAtText = renewal.toLocaleString('zh-TW', {
                    timeZone: 'Asia/Taipei',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                  });
                } catch (e2) {
                  expiresAtText = 'æœªçŸ¥';
                }
              }
            }
          }
          
          content.innerHTML = `
            <div class="profile-details">
              <div class="detail-item">
                <label>å§“åï¼š</label>
                <span>${ipPlanningUser.name || 'æœªè¨­å®š'}</span>
              </div>
              <div class="detail-item">
                <label>Emailï¼š</label>
                <span>${ipPlanningUser.email || 'æœªè¨­å®š'}</span>
              </div>
              <div class="detail-item">
                <label>ç”¨æˆ¶IDï¼š</label>
                <span>${ipPlanningUser.user_id || 'æœªç”Ÿæˆ'}</span>
              </div>
              <div class="detail-item">
                <label>è¨»å†Šæ™‚é–“ï¼š</label>
                <span>${registrationTime}</span>
              </div>
              <div class="detail-item">
                <label>è¨‚é–±ç‹€æ…‹ï¼š</label>
                <span>${subscriptionStatus}</span>
              </div>
              ${isSubscribed ? `
              <div class="detail-item">
                <label>åˆ°æœŸæ—¥æœŸï¼š</label>
                <span>${expiresAtText} ${daysLeftText}</span>
              </div>
              ${expirationWarning}
              <div class="detail-actions" style="margin-top: 16px;">
                <a href="/subscription.html" style="display: inline-block; padding: 8px 16px; background: #3B82F6; color: white; border-radius: 6px; text-decoration: none; font-weight: 500; margin-right: 8px;">
                  ğŸ’³ çºŒè²»è¨‚é–±
                </a>
                <button class="btn btn-danger" onclick="cancelSubscription()" style="padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; background: #ef4444; color: white;">
                  ğŸ”´ å–æ¶ˆè‡ªå‹•çºŒè²»
                </button>
              </div>
              ` : `
              <div class="detail-actions">
                <button class="btn btn-success" onclick="window.open('https://aivideonew.zeabur.app/', '_blank')" style="padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; background: #10b981; color: white;">
                  âœ¨ å•Ÿç”¨è¨‚é–±
                </button>
              </div>
              `}
            </div>
          `;
      }
      
      // è¼‰å…¥å€‹äººè³‡æ–™åº«çš„å€‹äººè³‡æ–™
      async function loadPersonalInfoForUserDB() {
        const content = document.querySelector('#db-personalInfo .section-content');
        if (!content) return;
        
        // å¦‚æœæ²’æœ‰æœ¬åœ°ç”¨æˆ¶è³‡è¨Šï¼Œé¡¯ç¤ºæç¤º
        if (!ipPlanningUser) {
          content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥ä»¥æŸ¥çœ‹å€‹äººè³‡æ–™</div>';
          return;
        }
        
        // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
        showLoadingAnimation(content, 'è¼‰å…¥å€‹äººè³‡æ–™ä¸­...');
        
        // å¦‚æœæœ‰æœ¬åœ°è³‡è¨Šï¼Œå…ˆç«‹å³æ¸²æŸ“ï¼ˆç¢ºä¿é é¢æœ‰å…§å®¹ï¼‰
        if (ipPlanningUser && (ipPlanningUser.name || ipPlanningUser.email)) {
          // çŸ­æš«å»¶é²å¾Œé¡¯ç¤ºå…§å®¹ï¼Œè®“ç”¨æˆ¶çœ‹åˆ°è¼‰å…¥å‹•ç•«
          setTimeout(async () => {
            await renderPersonalInfoContent();
          }, 300);
        }
        
        // å¦‚æœæœ‰ token ä½†ç¼ºå°‘ created_at ç­‰é—œéµè³‡è¨Šï¼Œåœ¨èƒŒæ™¯ä¸­å˜—è©¦æ›´æ–°
        if (ipPlanningToken && !ipPlanningUser.created_at) {
            try {
              await fetchUserInfo();
            // å¦‚æœæ›´æ–°æˆåŠŸï¼Œé‡æ–°æ¸²æŸ“
              if (ipPlanningUser && ipPlanningUser.created_at) {
                renderPersonalInfoContent();
              }
            } catch (error) {
            // å¦‚æœ API å¤±æ•—ï¼Œä»ç„¶é¡¯ç¤ºæœ¬åœ°è³‡è¨Šï¼ˆå·²åœ¨ä¸Šé¢çš„ setTimeout ä¸­æ¸²æŸ“ï¼‰
            console.warn('ç„¡æ³•å¾ä¼ºæœå™¨ç²å–æœ€æ–°è³‡è¨Šï¼Œä½¿ç”¨æœ¬åœ°è³‡æ–™');
            }
        }
      }
      
      // è¼‰å…¥å‰µä½œè€…è³‡æ–™åº«çš„æˆ‘çš„è…³æœ¬
      async function loadMyScriptsForUserDB() {
        const content = document.querySelector('#db-myScripts .section-content');
        
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥ä»¥æŸ¥çœ‹è…³æœ¬è¨˜éŒ„</div>';
          return;
        }
        
        // æ¨™é¡Œå·²æ”¹ç‚ºå›ºå®šã€Œæˆ‘çš„è…³æœ¬ã€ï¼Œä¸å†éœ€è¦ç·¨è¼¯åŠŸèƒ½
        
        // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
        showLoadingAnimation(content, 'è¼‰å…¥è…³æœ¬è¨˜éŒ„ä¸­...');
        
        console.log('æ­£åœ¨è¼‰å…¥è…³æœ¬åˆ—è¡¨...', {
          ipPlanningToken: ipPlanningToken ? 'present' : 'missing',
          userId: ipPlanningUser.user_id
        });
        
        // å…ˆæª¢æŸ¥æœ¬åœ°å„²å­˜çš„è…³æœ¬ï¼ˆåƒ…ç”¨æ–¼å¿«é€Ÿé¡¯ç¤ºï¼Œä»æœƒå¾å¾Œç«¯ç²å–æœ€æ–°è³‡æ–™ï¼‰
        const localScripts = getLocalScripts();
        console.log('æœ¬åœ°è…³æœ¬æ•¸é‡:', localScripts.length);
        console.log('æœ¬åœ°è…³æœ¬å…§å®¹:', localScripts);
        
        // å¦‚æœæœ‰æœ¬åœ°è…³æœ¬ï¼ŒçŸ­æš«å»¶é²å¾Œé¡¯ç¤ºï¼Œè®“ç”¨æˆ¶çœ‹åˆ°è¼‰å…¥å‹•ç•«
        if (localScripts.length > 0) {
          console.log('å…ˆé¡¯ç¤ºæœ¬åœ°è…³æœ¬:', localScripts);
          setTimeout(() => {
          displayScriptsForUserDB(localScripts);
          }, 300);
          // ç¹¼çºŒåŸ·è¡Œ API èª¿ç”¨ä»¥ç²å–æœ€æ–°è³‡æ–™
        }
        
        // å¾å¾Œç«¯ API ç²å–è…³æœ¬åˆ—è¡¨
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/scripts/my', {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            }
          });
          
          console.log('è…³æœ¬åˆ—è¡¨éŸ¿æ‡‰ç‹€æ…‹:', response.status);
          
          if (response.ok) {
            const data = await response.json();
            console.log('è…³æœ¬åˆ—è¡¨æ•¸æ“š:', data);
            const serverScripts = data.scripts || [];
            
            // åˆä½µæœ¬åœ°å’Œå¾Œç«¯è…³æœ¬ï¼Œé¿å…è¦†è“‹
            // ä½¿ç”¨ Map ä¾†å»é‡ï¼ˆæ ¹æ“š IDï¼‰ï¼Œä¿ç•™æœ€æ–°çš„ç‰ˆæœ¬
            const scriptMap = new Map();
            
            // å…ˆæ·»åŠ æœ¬åœ°è…³æœ¬
            localScripts.forEach(script => {
              if (script.id) {
                scriptMap.set(script.id, script);
              }
            });
            
            // å†æ·»åŠ å¾Œç«¯è…³æœ¬ï¼ˆæœƒè¦†è“‹åŒ ID çš„æœ¬åœ°è…³æœ¬ï¼Œç¢ºä¿ä½¿ç”¨æœ€æ–°çš„ï¼‰
            serverScripts.forEach(script => {
              if (script.id) {
                scriptMap.set(script.id, script);
              } else {
                // å¦‚æœå¾Œç«¯è…³æœ¬æ²’æœ‰ IDï¼Œä½¿ç”¨ created_at ä½œç‚ºå”¯ä¸€æ¨™è­˜
                const uniqueKey = script.created_at || Date.now();
                scriptMap.set(uniqueKey, script);
              }
            });
            
            // è½‰æ›ç‚ºé™£åˆ—ä¸¦é¡¯ç¤º
            const mergedScripts = Array.from(scriptMap.values());
            console.log('åˆä½µå¾Œçš„è…³æœ¬æ•¸é‡:', mergedScripts.length);
            
            if (mergedScripts.length > 0) {
              displayScriptsForUserDB(mergedScripts);
            } else {
              content.innerHTML = '<div class="loading-text">é‚„æ²’æœ‰å„²å­˜çš„è…³æœ¬ï¼Œè«‹å…ˆä½¿ç”¨ä¸€éµç”ŸæˆåŠŸèƒ½å‰µå»ºè…³æœ¬</div>';
            }
          } else if (response.status === 401) {
            console.log('è…³æœ¬è¼‰å…¥å¤±æ•—: èªè­‰éŒ¯èª¤');
            // å¦‚æœæ²’æœ‰æœ¬åœ°è…³æœ¬ï¼Œé¡¯ç¤ºéŒ¯èª¤ï¼›å¦å‰‡ä¿æŒé¡¯ç¤ºæœ¬åœ°è…³æœ¬
            if (localScripts.length === 0) {
              // å˜—è©¦åˆ·æ–° token å¾Œé‡è©¦
              const refreshed = await tryRefreshTokenSafe();
              if (refreshed) {
                // Token åˆ·æ–°æˆåŠŸï¼Œé‡è©¦ä¸€æ¬¡
                return loadMyScriptsForUserDB();
              }
              content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
            } else {
              console.warn('API èªè­‰å¤±æ•—ï¼Œä½†å·²æœ‰æœ¬åœ°è…³æœ¬ï¼Œç¹¼çºŒä½¿ç”¨æœ¬åœ°è…³æœ¬');
            }
          } else if (response.status === 404) {
            console.log('è…³æœ¬è¼‰å…¥å¤±æ•—: APIä¸å­˜åœ¨');
            // å¦‚æœæ²’æœ‰æœ¬åœ°è…³æœ¬ï¼Œé¡¯ç¤ºéŒ¯èª¤ï¼›å¦å‰‡ä¿æŒé¡¯ç¤ºæœ¬åœ°è…³æœ¬
            if (localScripts.length === 0) {
              content.innerHTML = '<div class="loading-text">è…³æœ¬åŠŸèƒ½å³å°‡ä¸Šç·šï¼Œè«‹ç¨å¾Œå†è©¦</div>';
            } else {
              console.warn('API ä¸å­˜åœ¨ï¼Œä½†å·²æœ‰æœ¬åœ°è…³æœ¬ï¼Œç¹¼çºŒä½¿ç”¨æœ¬åœ°è…³æœ¬');
            }
          } else {
            const errorData = await response.json().catch(() => ({}));
            console.log('è…³æœ¬è¼‰å…¥å¤±æ•—:', errorData);
            // å¦‚æœæ²’æœ‰æœ¬åœ°è…³æœ¬ï¼Œé¡¯ç¤ºéŒ¯èª¤ï¼›å¦å‰‡ä¿æŒé¡¯ç¤ºæœ¬åœ°è…³æœ¬
            if (localScripts.length === 0) {
              content.innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
            } else {
              console.warn('API è¼‰å…¥å¤±æ•—ï¼Œä½†å·²æœ‰æœ¬åœ°è…³æœ¬ï¼Œç¹¼çºŒä½¿ç”¨æœ¬åœ°è…³æœ¬');
            }
          }
        } catch (error) {
          console.error('Load scripts error:', error);
          // å¦‚æœæ²’æœ‰æœ¬åœ°è…³æœ¬ï¼Œé¡¯ç¤ºéŒ¯èª¤ï¼›å¦å‰‡ä¿æŒé¡¯ç¤ºæœ¬åœ°è…³æœ¬
          if (localScripts.length === 0) {
            content.innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
          } else {
            console.warn('API èª¿ç”¨ç•°å¸¸ï¼Œä½†å·²æœ‰æœ¬åœ°è…³æœ¬ï¼Œç¹¼çºŒä½¿ç”¨æœ¬åœ°è…³æœ¬');
          }
        }
      }
      
      // ===== ChatGPT é¢¨æ ¼åŠŸèƒ½å‡½æ•¸ =====
      
      // åˆå§‹åŒ– Markdown æ¸²æŸ“å™¨
      function initMarkdownRenderer() {
        if (typeof marked !== 'undefined') {
          marked.setOptions({
            highlight: function(code, lang) {
              if (typeof hljs !== 'undefined' && lang && hljs.getLanguage(lang)) {
                return hljs.highlight(code, { language: lang }).value;
              }
              return code;
            },
            breaks: true,
            gfm: true
          });
        }
      }
      
      // Markdown æ¸²æŸ“å‡½æ•¸
      function renderMarkdown(text) {
        if (typeof marked !== 'undefined') {
          return marked.parse(text);
        }
        return text.replace(/\n/g, '<br>');
      }
      
      // å‰µå»º ChatGPT é¢¨æ ¼çš„è¨Šæ¯å…ƒç´ 
      function createChatGPTMessage(role, content) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${role}`;
        
        const avatarDiv = document.createElement('div');
        avatarDiv.className = 'message-avatar';
        
        if (role === 'user') {
          // è¼‰å…¥Googleç”¨æˆ¶é ­åƒ
          const userAvatarImg = document.getElementById('userAvatar');
          if (userAvatarImg && userAvatarImg.src && userAvatarImg.src !== '') {
            const img = document.createElement('img');
            img.src = userAvatarImg.src;
            img.alt = 'ç”¨æˆ¶é ­åƒ';
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.borderRadius = '50%';
            img.style.objectFit = 'cover';
            avatarDiv.appendChild(img);
          } else {
            avatarDiv.textContent = 'ğŸ‘¤';
          }
        } else {
          avatarDiv.textContent = 'ğŸ¤–';
        }
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        
        if (role === 'assistant') {
          // ä½¿ç”¨å®‰å…¨çš„ Markdown æ¸²æŸ“
          contentDiv.innerHTML = safeRenderMarkdown(content);
        } else {
          // ç”¨æˆ¶è¼¸å…¥ä½¿ç”¨ textContentï¼ˆæ›´å®‰å…¨ï¼‰
          safeSetText(contentDiv, content);
        }
        
        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);
        
        return messageDiv;
      }
      
      // å‰µå»ºè¼‰å…¥å‹•ç•«
      function createTypingIndicator() {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message assistant';
        
        const avatarDiv = document.createElement('div');
        avatarDiv.className = 'message-avatar';
        avatarDiv.textContent = 'ğŸ¤–';
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        contentDiv.innerHTML = `
          <div class="typing-indicator">
            <span>AIæ­£åœ¨æ€è€ƒä¸­</span>
            <div class="typing-dots">
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
            </div>
          </div>
        `;
        
        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);
        
        return messageDiv;
      }
      
      // ä¸²æµé¡¯ç¤ºæ–‡å­—
      function streamText(element, text, speed = 30) {
        return new Promise((resolve) => {
          let index = 0;
          element.innerHTML = '';
          
          const stream = () => {
            if (index < text.length) {
              element.innerHTML += text[index];
              index++;
              setTimeout(stream, speed);
            } else {
              // æ·»åŠ é–ƒçˆæ¸¸æ¨™
              const cursor = document.createElement('span');
              cursor.className = 'streaming-cursor';
              element.appendChild(cursor);
              resolve();
            }
          };
          
          stream();
        });
      }
      
      // è‡ªå‹•èª¿æ•´è¼¸å…¥æ¡†é«˜åº¦
      function autoResizeTextarea(textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
      }
      
      // ç™¼é€è¨Šæ¯å‡½æ•¸ï¼ˆChatGPT é¢¨æ ¼ï¼Œå…¼å®¹ç¾æœ‰å¾Œç«¯ï¼‰
      async function sendMessageChatGPT(message) {
        const chatMessages = document.getElementById('chatMessages');
        if (!chatMessages) return;
        
        // æ·»åŠ ç”¨æˆ¶è¨Šæ¯
        const userMessage = createChatGPTMessage('user', message);
        chatMessages.appendChild(userMessage);
        // è¨˜éŒ„é•·æœŸè¨˜æ†¶
        console.log('ğŸ“ æº–å‚™å„²å­˜é•·æœŸè¨˜æ†¶ (IP äººè¨­è¦åŠƒ - user)');
        try { 
          await recordConversationMessage('ip_planning', 'user', message); 
        } catch (error) {
          console.error('âŒ é•·æœŸè¨˜æ†¶å„²å­˜ç•°å¸¸ (IP äººè¨­è¦åŠƒ - user):', error);
        }
        
        // æ·»åŠ è¼‰å…¥å‹•ç•«
        const typingIndicator = createTypingIndicator();
        chatMessages.appendChild(typingIndicator);
        
        // æ»¾å‹•åˆ°åº•éƒ¨
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        try {
          // ä½¿ç”¨ç¾æœ‰çš„å¾Œç«¯APIç«¯é»å’Œåƒæ•¸
          const endpoint = 'https://aivideobackend.zeabur.app/api/chat/stream';
          const headers = { 'Content-Type': 'application/json' };
          if (ipPlanningToken) {
            headers['Authorization'] = `Bearer ${ipPlanningToken}`;
          }
          
          // å®‰å…¨åœ°ç²å–è¨­å®šå€¼ï¼Œé¿å…æœªå®šç¾©è®Šæ•¸éŒ¯èª¤
          const safeSettingsApplied = typeof settingsApplied !== 'undefined' ? settingsApplied : false;
          const safeAppliedSettings = typeof appliedSettings !== 'undefined' ? appliedSettings : {};
          const safeStyleInstruction = typeof styleInstruction !== 'undefined' ? styleInstruction : null;
          
          const response = await fetch(endpoint, {
            method: 'POST',
            headers,
            body: JSON.stringify({
              message: message,
              platform: safeSettingsApplied ? safeAppliedSettings.platform : null,
              topic: safeSettingsApplied ? safeAppliedSettings.topic : null,
              duration: safeSettingsApplied ? safeAppliedSettings.duration : null,
              style: safeStyleInstruction,
              profile: safeSettingsApplied ? safeAppliedSettings.positioning : null,
              history: [], // ä¿æŒç¾æœ‰çš„æ­·å²è¨˜éŒ„æ ¼å¼
              user_id: ipPlanningUser?.user_id || null
            })
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          // ç§»é™¤è¼‰å…¥å‹•ç•«
          chatMessages.removeChild(typingIndicator);
          
          // å‰µå»ºAIå›æ‡‰å®¹å™¨
          const aiMessage = createChatGPTMessage('assistant', '');
          chatMessages.appendChild(aiMessage);
          
          const contentDiv = aiMessage.querySelector('.message-content');
          
          // è™•ç†ä¸²æµå›æ‡‰
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          let buffer = '';
          let fullContent = '';
          
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += decoder.decode(value, { stream: true });
            const lines = buffer.split('\n');
            buffer = lines.pop(); // ä¿ç•™æœ€å¾Œä¸€è¡Œï¼ˆå¯èƒ½ä¸å®Œæ•´ï¼‰
            
            for (const line of lines) {
              if (line.startsWith('data: ')) {
                const data = line.slice(6);
                if (data === '[DONE]') {
                  // ç§»é™¤é–ƒçˆæ¸¸æ¨™
                  const cursor = contentDiv.querySelector('.streaming-cursor');
                  if (cursor) cursor.remove();
                  
                  // æª¢æŸ¥æ˜¯å¦éœ€è¦é¡¯ç¤ºçµæœå€å¡Š
                  if (fullContent) {
                    checkIfScriptRequest(fullContent);
                  }
                  // è¨˜éŒ„é•·æœŸè¨˜æ†¶
                  console.log('ğŸ“ æº–å‚™å„²å­˜é•·æœŸè¨˜æ†¶ (IP äººè¨­è¦åŠƒ - assistant)');
                  try { 
                    await recordConversationMessage('ip_planning', 'assistant', fullContent); 
                  } catch (error) {
                    console.error('âŒ é•·æœŸè¨˜æ†¶å„²å­˜ç•°å¸¸ (IP äººè¨­è¦åŠƒ - assistant):', error);
                  }
                  return;
                }
                
                try {
                  const parsed = JSON.parse(data);
                  if (parsed.content) {
                    fullContent += parsed.content;
                    contentDiv.innerHTML = renderMarkdown(fullContent);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                  }
                } catch (e) {
                  // å¿½ç•¥è§£æéŒ¯èª¤
                }
              }
            }
          }
          
        } catch (error) {
          console.error('ç™¼é€è¨Šæ¯éŒ¯èª¤:', error);
          
          // ç§»é™¤è¼‰å…¥å‹•ç•«
          if (chatMessages.contains(typingIndicator)) {
            chatMessages.removeChild(typingIndicator);
          }
          
          // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
          const errorMessage = createChatGPTMessage('assistant', `æŠ±æ­‰ï¼Œç™¼ç”Ÿäº†éŒ¯èª¤ï¼š${error.message}`);
          chatMessages.appendChild(errorMessage);
        }
        
        // æ»¾å‹•åˆ°åº•éƒ¨
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
      
      // å¼·åˆ¶æ¸…é™¤å¿«å–ä¸¦é‡æ–°è¼‰å…¥æ¨£å¼
      function forceReloadStyles() {
        // å¼·åˆ¶é‡æ–°è¼‰å…¥CSS
        const links = document.querySelectorAll('link[rel="stylesheet"]');
        links.forEach(link => {
          const href = link.href;
          link.href = href + '?v=' + Date.now();
        });
        
        // å¼·åˆ¶é‡æ–°è¼‰å…¥å…§è¯æ¨£å¼
        const style = document.querySelector('style');
        if (style) {
          style.innerHTML = style.innerHTML;
        }
      }
      
      // ===== ChatGPT é¢¨æ ¼ AI é¡§å•åŠŸèƒ½ =====
      
      // åˆå§‹åŒ– Markdown æ¸²æŸ“å™¨
      function initMarkdownRenderer() {
        if (typeof marked !== 'undefined') {
          marked.setOptions({
            renderer: new marked.Renderer(),
            gfm: true,
            breaks: true,
            sanitize: false,
            langPrefix: 'hljs language-',
            highlight: function(code, lang) {
              if (typeof hljs !== 'undefined' && hljs.getLanguage(lang)) {
                return hljs.highlight(code, { language: lang }).value;
              }
              return code;
            }
          });
        }
      }

      // æ¸²æŸ“ Markdown å…§å®¹
      function renderMarkdown(text) {
        if (typeof marked !== 'undefined') {
          return marked.parse(text);
        }
        return text.replace(/\n/g, '<br>');
      }

      // å‰µå»ºèŠå¤©è¨Šæ¯å…ƒç´ 
      function createMessage(role, content) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${role}`;
        
        const avatarDiv = document.createElement('div');
        avatarDiv.className = 'message-avatar';
        
        if (role === 'user') {
          // å˜—è©¦è¼‰å…¥Googleç”¨æˆ¶é ­åƒ
          const userAvatarImg = document.getElementById('userAvatar');
          if (userAvatarImg && userAvatarImg.src && userAvatarImg.src !== '') {
            const img = document.createElement('img');
            img.src = userAvatarImg.src;
            img.alt = 'ç”¨æˆ¶é ­åƒ';
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.borderRadius = '50%';
            img.style.objectFit = 'cover';
            avatarDiv.appendChild(img);
          } else {
            avatarDiv.textContent = 'ğŸ‘¤';
          }
        } else {
          avatarDiv.textContent = 'ğŸ¤–';
        }
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        
        if (role === 'assistant' && content) {
          contentDiv.innerHTML = safeRenderMarkdown(content);
          // å°ä»£ç¢¼å¡Šé€²è¡Œèªæ³•é«˜äº®
          if (typeof hljs !== 'undefined') {
            contentDiv.querySelectorAll('pre code').forEach((block) => {
              hljs.highlightElement(block);
            });
          }
        } else if (role === 'user') {
          contentDiv.textContent = content;
        }
        
        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);
        
        return messageDiv;
      }

      // å‰µå»ºè¼‰å…¥å‹•ç•«
      function createTypingIndicator() {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'message assistant';
        
        const avatarDiv = document.createElement('div');
        avatarDiv.className = 'message-avatar';
        avatarDiv.textContent = 'ğŸ¤–';
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        contentDiv.innerHTML = `
          <div class="typing-indicator">
            <span>AIæ­£åœ¨æ€è€ƒä¸­</span>
            <div class="typing-dots">
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
              <div class="typing-dot"></div>
            </div>
          </div>
        `;
        
        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);
        
        return messageDiv;
      }

      // è‡ªå‹•èª¿æ•´è¼¸å…¥æ¡†é«˜åº¦
      function autoResizeTextarea() {
        const textarea = document.getElementById('messageInput');
        if (textarea) {
          textarea.style.height = 'auto';
          textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
          
          // æ›´æ–°ç™¼é€æŒ‰éˆ•ç‹€æ…‹
          const sendBtn = document.getElementById('sendBtn');
          if (sendBtn) {
            sendBtn.disabled = textarea.value.trim() === '';
          }
        }
      }

      // ç™¼é€è¨Šæ¯ï¼ˆæ•´åˆåŸæœ‰å¾Œç«¯å’ŒLLMè¨­å®šï¼‰
      async function sendMessage(message) {
        if (!message || !message.trim()) return;
        
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const quickButtons = document.getElementById('quickButtons');
        
        // æ·»åŠ ç”¨æˆ¶è¨Šæ¯
        const userMessage = createMessage('user', message);
        chatMessages.appendChild(userMessage);
        
        // è¨˜éŒ„é•·æœŸè¨˜æ†¶ï¼ˆç”¨æˆ¶è¨Šæ¯ï¼‰
        console.log('ğŸ“ğŸ“ğŸ“ æº–å‚™å„²å­˜é•·æœŸè¨˜æ†¶ (AI é¡§å• - user) - sendMessage å‡½æ•¸ ğŸ“ğŸ“ğŸ“');
        console.log('ğŸ“ è¨Šæ¯å…§å®¹:', message);
        console.log('ğŸ“ èª¿ç”¨ recordConversationMessage...');
        try { 
          await recordConversationMessage('ai_advisor', 'user', message); 
          console.log('ğŸ“ recordConversationMessage èª¿ç”¨å®Œæˆ');
        } catch (error) {
          console.error('âŒâŒâŒ é•·æœŸè¨˜æ†¶å„²å­˜ç•°å¸¸ (AI é¡§å• - user) âŒâŒâŒ', error);
          console.error('éŒ¯èª¤å †ç–Š:', error.stack);
        }
        
        // éš±è—å¿«é€ŸæŒ‰éˆ•
        if (quickButtons) {
          quickButtons.style.display = 'none';
        }
        
        // æ¸…ç©ºè¼¸å…¥æ¡†ä¸¦ç¦ç”¨
        messageInput.value = '';
        messageInput.disabled = true;
        sendBtn.disabled = true;
        autoResizeTextarea();
        
        // æ·»åŠ è¼‰å…¥å‹•ç•«
        const typingIndicator = createTypingIndicator();
        chatMessages.appendChild(typingIndicator);
        
        // æ»¾å‹•åˆ°åº•éƒ¨
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        try {
          // ä½¿ç”¨åŸæœ‰çš„å¾Œç«¯APIå’ŒLLMè¨­å®š
          const endpoint = 'https://aivideobackend.zeabur.app/api/chat/stream';
          const headers = { 'Content-Type': 'application/json' };
          if (ipPlanningToken) {
            headers['Authorization'] = `Bearer ${ipPlanningToken}`;
          }
          
          // å®‰å…¨åœ°ç²å–è¨­å®šå€¼
          const safeSettingsApplied = typeof settingsApplied !== 'undefined' ? settingsApplied : false;
          const safeAppliedSettings = typeof appliedSettings !== 'undefined' ? appliedSettings : {};
          const safeStyleInstruction = typeof styleInstruction !== 'undefined' ? styleInstruction : null;
          
          const response = await fetch(endpoint, {
            method: 'POST',
            headers,
            body: JSON.stringify({
              message: message,
              platform: safeSettingsApplied ? safeAppliedSettings.platform : null,
              topic: safeSettingsApplied ? safeAppliedSettings.topic : null,
              duration: safeSettingsApplied ? safeAppliedSettings.duration : null,
              style: safeStyleInstruction,
              profile: safeSettingsApplied ? safeAppliedSettings.positioning : null,
              history: [], // ä¿æŒç¾æœ‰çš„æ­·å²è¨˜éŒ„æ ¼å¼
              user_id: ipPlanningUser?.user_id || null
            })
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          
          // ç§»é™¤è¼‰å…¥å‹•ç•«
          chatMessages.removeChild(typingIndicator);
          
          // å‰µå»ºAIå›æ‡‰å®¹å™¨
          const aiMessage = createMessage('assistant', '');
          chatMessages.appendChild(aiMessage);
          
          const contentDiv = aiMessage.querySelector('.message-content');
          
          // è™•ç†ä¸²æµå›æ‡‰
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          let buffer = '';
          let fullContent = '';
          
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += decoder.decode(value, { stream: true });
            const lines = buffer.split('\n');
            buffer = lines.pop();
            
            for (const line of lines) {
              if (line.startsWith('data: ')) {
                const data = line.slice(6);
                if (data === '[DONE]') {
                  // è¨˜éŒ„é•·æœŸè¨˜æ†¶ï¼ˆAI å›è¦†ï¼‰
                  console.log('ğŸ“ğŸ“ğŸ“ æº–å‚™å„²å­˜é•·æœŸè¨˜æ†¶ (AI é¡§å• - assistant) - sendMessage å‡½æ•¸ ğŸ“ğŸ“ğŸ“');
                  console.log('ğŸ“ AI å›è¦†å…§å®¹é•·åº¦:', fullContent.length);
                  console.log('ğŸ“ èª¿ç”¨ recordConversationMessage...');
                  try { 
                    await recordConversationMessage('ai_advisor', 'assistant', fullContent); 
                    console.log('ğŸ“ recordConversationMessage èª¿ç”¨å®Œæˆ');
                  } catch (error) {
                    console.error('âŒâŒâŒ é•·æœŸè¨˜æ†¶å„²å­˜ç•°å¸¸ (AI é¡§å• - assistant) âŒâŒâŒ', error);
                    console.error('éŒ¯èª¤å †ç–Š:', error.stack);
                  }
                  
                  // æª¢æŸ¥æ˜¯å¦éœ€è¦é¡¯ç¤ºçµæœå€å¡Š
                  if (fullContent) {
                    checkIfScriptRequest(fullContent);
                  }
                  break;
                }
                
                try {
                  const parsed = JSON.parse(data);
                  if (parsed.content) {
                    fullContent += parsed.content;
                    contentDiv.innerHTML = renderMarkdown(fullContent);
                    
                    // å°ä»£ç¢¼å¡Šé€²è¡Œèªæ³•é«˜äº®
                    if (typeof hljs !== 'undefined') {
                      contentDiv.querySelectorAll('pre code').forEach((block) => {
                        if (!block.classList.contains('hljs')) {
                          hljs.highlightElement(block);
                        }
                      });
                    }
                    
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                  }
                } catch (e) {
                  // å¿½ç•¥è§£æéŒ¯èª¤
                }
              }
            }
          }
          
        } catch (error) {
          console.error('ç™¼é€è¨Šæ¯éŒ¯èª¤:', error);
          
          // ç§»é™¤è¼‰å…¥å‹•ç•«
          if (chatMessages.contains(typingIndicator)) {
            chatMessages.removeChild(typingIndicator);
          }
          
          // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
          const errorMessage = createMessage('assistant', `æŠ±æ­‰ï¼Œç™¼ç”Ÿäº†éŒ¯èª¤ï¼š${error.message}`);
          chatMessages.appendChild(errorMessage);
        }
        
        // æ¢å¾©è¼¸å…¥æ¡†å’ŒæŒ‰éˆ•
        if (messageInput) {
        messageInput.disabled = false;
          messageInput.value = ''; // ç¢ºä¿è¼¸å…¥æ¡†æ˜¯ç©ºçš„
          messageInput.style.height = 'auto'; // é‡ç½®é«˜åº¦
          autoResizeTextarea(); // é‡æ–°èª¿æ•´é«˜åº¦
        }
        if (sendBtn) {
        sendBtn.disabled = false;
        }
        
        // æ»¾å‹•åˆ°åº•éƒ¨
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      // åˆå§‹åŒ– ChatGPT é¢¨æ ¼åŠŸèƒ½
      function initChatGPTFeatures() {
        try {
          // åªåœ¨AIé¡§å•æ¨¡å¼é é¢æ‰åˆå§‹åŒ–
          const currentPage = document.querySelector('.page.active');
          if (!currentPage || currentPage.id !== 'mode2') {
            return;
          }
          
          
          // å¼·åˆ¶æ¸…é™¤å¿«å–
          forceReloadStyles();
          
          // åˆå§‹åŒ– Markdown æ¸²æŸ“å™¨
          initMarkdownRenderer();
        
          // è¨­ç½®è¼¸å…¥æ¡†äº‹ä»¶ç›£è½å™¨
          const messageInput = document.getElementById('messageInput');
          const sendBtn = document.getElementById('sendBtn');
          
          if (messageInput) {
            // è‡ªå‹•èª¿æ•´é«˜åº¦
            messageInput.addEventListener('input', autoResizeTextarea);
            
            // éµç›¤äº‹ä»¶ï¼šEnterç™¼é€ï¼ŒShift+Enteræ›è¡Œ
            messageInput.addEventListener('keydown', (e) => {
              if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault(); // é˜»æ­¢é»˜èªçš„æ›è¡Œè¡Œç‚º
                const message = messageInput.value.trim();
                if (message) {
                  sendMessage(message);
                }
              }
              // Shift+Enter æœƒè®“é»˜èªæ›è¡Œè¡Œç‚ºç”Ÿæ•ˆï¼Œä¸éœ€è¦ç‰¹åˆ¥è™•ç†
            });
          }
          
          // è¨­ç½®ç™¼é€æŒ‰éˆ•äº‹ä»¶
          if (sendBtn) {
            sendBtn.addEventListener('click', () => {
              const message = messageInput.value.trim();
              if (message) {
                sendMessage(message);
              }
            });
          }
          
          // ä¸è‡ªå‹•è¼‰å…¥æ­·å²å°è©±è¨˜éŒ„ï¼ˆé‡æ–°æ•´ç†æ™‚å·²æ¸…ç©ºï¼Œç”¨æˆ¶å¯é€šéæŒ‰éˆ•ä¸»å‹•è¼‰å…¥ï¼‰
          // loadMode2History();
          
          // è¨­ç½®å¿«é€ŸæŒ‰éˆ•äº‹ä»¶ - åªç¶å®šåˆ° mode2 çš„å¿«é€ŸæŒ‰éˆ•å®¹å™¨
          const quickButtons = document.getElementById('quickButtons');
          if (quickButtons && quickButtons.closest('#mode2')) {
            const quickBtns = quickButtons.querySelectorAll('.quick-btn');
            quickBtns.forEach(btn => {
              // å‰µå»ºæ–°çš„äº‹ä»¶è™•ç†å‡½æ•¸ï¼Œç¢ºä¿åªè™•ç† mode2 çš„æŒ‰éˆ•
              const handler = (e) => {
                e.stopPropagation(); // é˜²æ­¢äº‹ä»¶å†’æ³¡
                const text = btn.getAttribute('data-text');
                if (text) {
                  sendMessage(text);
                }
              };
              // ç§»é™¤èˆŠçš„äº‹ä»¶ç›£è½å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
              btn.removeEventListener('click', handler);
              btn.addEventListener('click', handler);
            });
          }
        } catch (error) {
          console.error('ChatGPTåŠŸèƒ½åˆå§‹åŒ–éŒ¯èª¤:', error);
        }
      }
      
      // é¡¯ç¤ºè…³æœ¬åˆ—è¡¨ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      function displayScriptsForUserDB(scripts) {
        const container = document.querySelector('#db-myScripts .section-content');
        
        if (scripts.length === 0) {
          container.innerHTML = '<div class="loading-text">é‚„æ²’æœ‰å„²å­˜çš„è…³æœ¬</div>';
          return;
        }
        
        // æŒ‰æ™‚é–“æ’åºï¼šç”±èˆŠåˆ°æ–°ï¼ˆæœ€æ—©çš„ç‚ºç·¨è™Ÿ01ï¼Œæœ€æ–°çš„ç·¨è™Ÿæœ€å¤§ï¼‰
        const sortedScripts = [...scripts].sort((a, b) => {
          const timeA = new Date(a.created_at || a.id || 0).getTime();
          const timeB = new Date(b.created_at || b.id || 0).getTime();
          return timeA - timeB; // å‡åºï¼šå°çš„ï¼ˆèˆŠçš„ï¼‰åœ¨å‰ï¼Œç·¨è™Ÿ01æ˜¯æœ€æ—©çš„
        });
        
        container.innerHTML = sortedScripts.map((script, index) => `
          <div class="script-item" data-script-id="${script.id}">
            <div class="script-header" onclick="toggleScriptForUserDB(${script.id})">
              <div class="script-info">
                <span class="script-number">ç·¨è™Ÿ${String(index + 1).padStart(2, '0')}</span>
                <span class="script-name" onclick="editScriptNameForUserDB(${script.id}, event)">${script.name || script.title || 'æœªå‘½åè…³æœ¬'}</span>
                <span class="script-date">${formatTaiwanTime(script.created_at)}</span>
              </div>
              <div class="script-toggle">
                <span class="toggle-icon">â–¼</span>
              </div>
            </div>
            <div class="script-content" id="script-${script.id}" style="display: none;">
              <div class="script-details">
                <div class="script-table">
                  <table>
                    <thead>
                      <tr>
                        <th>æ™‚é–“</th>
                        <th>æ®µè½</th>
                        <th>é¡é ­/ç•«é¢</th>
                        <th>å°è© (æ¼”å“¡å£ç™½)</th>
                        <th>å­—å¹•æ–‡å­— (å¯å‹•ç•«)</th>
                        <th>éŸ³æ•ˆèˆ‡è½‰å ´</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${generateScriptTable(script.script_data || script.content || script)}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="script-actions" id="actions-${script.id}" style="display: none;">
              <button class="action-btn view-btn" onclick="viewFullScriptForUserDB(${script.id})">æŸ¥çœ‹å®Œæ•´çµæœ</button>
              <button class="action-btn download-pdf-btn" onclick="downloadScriptPDF(${script.id})">ä¸‹è¼‰PDFæª”æ¡ˆ</button>
              <button class="action-btn download-csv-btn" onclick="downloadScriptCSV(${script.id})">ä¸‹è¼‰CSVæª”æ¡ˆ</button>
              <button class="action-btn delete-btn" onclick="deleteScriptForUserDB(${script.id})">åˆªé™¤</button>
            </div>
          </div>
        `).join('');
      }
      
      // åˆ‡æ›è…³æœ¬é¡¯ç¤ºï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      window.toggleScriptForUserDB = function(scriptId) {
        const scriptContent = document.getElementById(`script-${scriptId}`);
        const scriptActions = document.getElementById(`actions-${scriptId}`);
        const toggleIcon = document.querySelector(`[data-script-id="${scriptId}"] .toggle-icon`);
        const scriptHeader = document.querySelector(`[data-script-id="${scriptId}"] .script-header`);
        const scriptNumber = document.querySelector(`[data-script-id="${scriptId}"] .script-number`);
        
        if (!scriptContent || !scriptActions) {
          console.error('æ‰¾ä¸åˆ°è…³æœ¬å…ƒç´ :', scriptId);
          return;
        }
        
        // åˆ‡æ›é¡¯ç¤ºç‹€æ…‹
        if (scriptContent.style.display === 'none' || !scriptContent.style.display) {
          scriptContent.style.display = 'block';
          scriptActions.style.display = 'flex';
          if (toggleIcon) toggleIcon.textContent = 'â–²';
          // æ·»åŠ æ¿€æ´»ç‹€æ…‹æ¨£å¼
          if (scriptHeader) scriptHeader.style.background = '#f0f9ff';
          if (scriptNumber) scriptNumber.style.background = '#2563eb';
        } else {
          scriptContent.style.display = 'none';
          scriptActions.style.display = 'none';
          if (toggleIcon) toggleIcon.textContent = 'â–¼';
          // ç§»é™¤æ¿€æ´»ç‹€æ…‹æ¨£å¼
          if (scriptHeader) scriptHeader.style.background = '';
          if (scriptNumber) scriptNumber.style.background = '#3b82f6';
        }
      }
      
      // ç·¨è¼¯è…³æœ¬åç¨±ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      window.editScriptNameForUserDB = function(scriptId, event) {
        if (event) event.stopPropagation();
        const scriptNameElement = document.querySelector(`[data-script-id="${scriptId}"] .script-name`);
        if (!scriptNameElement) {
          console.error('æ‰¾ä¸åˆ°è…³æœ¬åç¨±å…ƒç´ :', scriptId);
          return;
        }
        const currentName = scriptNameElement.textContent;
        
        const newName = prompt('è«‹è¼¸å…¥æ–°çš„è…³æœ¬åç¨±:', currentName);
        if (newName && newName.trim() !== '' && newName !== currentName) {
          updateScriptNameForUserDB(scriptId, newName.trim());
        }
      }
      
      // æ›´æ–°è…³æœ¬åç¨±ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      async function updateScriptNameForUserDB(scriptId, newName) {
        try {
          // å…ˆæ›´æ–°æœ¬åœ°é¡¯ç¤º
          const scriptNameElement = document.querySelector(`[data-script-id="${scriptId}"] .script-name`);
          scriptNameElement.textContent = newName;
          
          // æ›´æ–°æœ¬åœ°å„²å­˜
          const localScripts = getLocalScripts();
          const scriptIndex = localScripts.findIndex(script => script.id == scriptId);
          if (scriptIndex !== -1) {
            localScripts[scriptIndex].name = newName;
            localStorage.setItem('user_scripts', JSON.stringify(localScripts));
          }
          
          // å˜—è©¦æ›´æ–°å¾Œç«¯ï¼ˆå¦‚æœAPIå­˜åœ¨ï¼‰
          try {
            const response = await fetch(`https://aivideobackend.zeabur.app/api/scripts/${scriptId}/name`, {
              method: 'PUT',
              headers: {
                'Authorization': `Bearer ${ipPlanningToken}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ name: newName })
            });
            
            if (response.ok) {
              showToast('è…³æœ¬åç¨±å·²æ›´æ–°', 3000);
            } else {
              console.log('å¾Œç«¯æ›´æ–°å¤±æ•—ï¼Œä½†æœ¬åœ°å·²æ›´æ–°');
              showToast('è…³æœ¬åç¨±å·²æ›´æ–°ï¼ˆæœ¬åœ°ï¼‰', 3000);
            }
          } catch (apiError) {
            console.log('APIä¸å­˜åœ¨æˆ–ç¶²è·¯éŒ¯èª¤ï¼Œä½†æœ¬åœ°å·²æ›´æ–°');
            showToast('è…³æœ¬åç¨±å·²æ›´æ–°ï¼ˆæœ¬åœ°ï¼‰', 3000);
          }
          
        } catch (error) {
          console.error('Update script name error:', error);
          showToast('æ›´æ–°å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // æŸ¥çœ‹å®Œæ•´è…³æœ¬ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      window.viewFullScriptForUserDB = function(scriptId) {
        // ç²å–è…³æœ¬æ•¸æ“šï¼ˆå¾æœ¬åœ°æˆ–ä¼ºæœå™¨ï¼‰
        const scripts = getLocalScripts();
        let script = scripts.find(s => s.id == scriptId);
        
        // å¦‚æœæœ¬åœ°æ‰¾ä¸åˆ°ï¼Œå˜—è©¦å¾ DOM ç²å–
        if (!script) {
          const scriptItem = document.querySelector(`[data-script-id="${scriptId}"]`);
          if (scriptItem) {
            const scriptName = scriptItem.querySelector('.script-name')?.textContent || 'æœªå‘½åè…³æœ¬';
            const scriptDate = scriptItem.querySelector('.script-date')?.textContent || '';
            const scriptTable = scriptItem.querySelector('table');
            
            // å¾è¡¨æ ¼ä¸­æå–æ•¸æ“š
            if (scriptTable) {
              const rows = Array.from(scriptTable.querySelectorAll('tbody tr'));
              const scriptData = {
                rows: rows.map(row => {
                  const cells = row.querySelectorAll('td');
                  return {
                    time: cells[0]?.textContent || '-',
                    section: cells[1]?.textContent || '-',
                    shot_desc: cells[2]?.textContent || '-',
                    dialogue: cells[3]?.textContent || '-',
                    subtitle: cells[4]?.textContent || '-',
                    sfx: cells[5]?.textContent || '-'
                  };
                })
              };
              
              script = {
                id: scriptId,
                name: scriptName,
                created_at: scriptDate,
                script_data: scriptData
              };
            }
          }
        }
        
        if (!script) {
          showToast('æ‰¾ä¸åˆ°è…³æœ¬æ•¸æ“š', 3000);
          return;
        }
        
        // å‰µå»ºå½ˆå‡ºè¦–çª—
        const modal = document.createElement('div');
        modal.className = 'script-modal-overlay';
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 10000;
          padding: 20px;
          box-sizing: border-box;
        `;
        
        const modalContent = document.createElement('div');
        modalContent.style.cssText = `
          background: white;
          border-radius: 12px;
          padding: 24px;
          max-width: 95%;
          max-height: 95%;
          overflow-y: auto;
          box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
          position: relative;
        `;
        
        // ç”Ÿæˆå®Œæ•´è…³æœ¬å…§å®¹
        let fullContent = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #e5e7eb; padding-bottom: 16px; flex-wrap: wrap; gap: 12px;">
            <div>
              <h2 style="margin: 0; color: #1f2937; font-size: 20px; font-weight: 600;">${script.name || 'æœªå‘½åè…³æœ¬'}</h2>
              ${script.created_at ? `<p style="margin: 4px 0 0 0; color: #6b7280; font-size: 14px;">${script.created_at}</p>` : ''}
            </div>
            <button onclick="this.closest('.script-modal-overlay').remove()" style="background: none; border: none; font-size: 28px; cursor: pointer; color: #6b7280; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">Ã—</button>
          </div>
        `;
        
        // è™•ç†æ–°æ ¼å¼ï¼ˆæœ‰rowsæ¬„ä½ï¼‰
        if (script.script_data && script.script_data.rows && script.script_data.rows.length > 0) {
          fullContent += `
            <div style="overflow-x: auto;">
              <table style="width: 100%; border-collapse: collapse; margin-top: 16px;">
                <thead>
                  <tr style="background: #f8fafc; border-bottom: 2px solid #e5e7eb;">
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151; white-space: nowrap;">æ™‚é–“</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151;">æ®µè½</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151;">é¡é ­/ç•«é¢</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151;">å°è© (æ¼”å“¡å£ç™½)</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151;">å­—å¹•æ–‡å­— (å¯å‹•ç•«)</th>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151;">éŸ³æ•ˆèˆ‡è½‰å ´</th>
                  </tr>
                </thead>
                <tbody>
          `;
          
          script.script_data.rows.forEach((row, index) => {
            const bgColor = index % 2 === 0 ? '#ffffff' : '#f9fafb';
            // æ­£ç¢ºè™•ç†æ™‚é–“æ¬„ä½ï¼šå„ªå…ˆä½¿ç”¨ timeï¼Œå…¶æ¬¡ä½¿ç”¨ start_sec-end_secï¼Œæœ€å¾Œä½¿ç”¨ DOM æå–çš„ time
            let timeDisplay = '-';
            if (row.time && row.time !== 'undefined-undefineds' && row.time !== '-') {
              timeDisplay = row.time;
            } else if (row.start_sec !== undefined && row.end_sec !== undefined) {
              timeDisplay = `${row.start_sec}-${row.end_sec}s`;
            } else if (row.time && typeof row.time === 'string' && row.time.includes('-') && row.time.includes('s')) {
              timeDisplay = row.time;
            }
            fullContent += `
              <tr style="background: ${bgColor}; border-bottom: 1px solid #e5e7eb;">
                <td style="padding: 12px; color: #1f2937; white-space: nowrap; font-weight: 500;">${timeDisplay}</td>
                <td style="padding: 12px; color: #4b5563;">${row.section || '-'}</td>
                <td style="padding: 12px; color: #4b5563; max-width: 200px;">${row.shot_desc || '-'}</td>
                <td style="padding: 12px; color: #4b5563; max-width: 300px;">${row.dialogue || '-'}</td>
                <td style="padding: 12px; color: #4b5563; max-width: 300px;">${row.subtitle || '-'}</td>
                <td style="padding: 12px; color: #4b5563;">${row.sfx || '-'}</td>
              </tr>
            `;
          });
          
          fullContent += `
                </tbody>
              </table>
            </div>
          `;
        } else if (script.script_data && script.script_data.sections && script.script_data.sections.length > 0) {
          // è™•ç†èˆŠæ ¼å¼ï¼ˆæœ‰sectionsæ¬„ä½ï¼‰
          fullContent += '<div style="margin-top: 16px;">';
          script.script_data.sections.forEach((section, index) => {
            fullContent += `
              <div style="margin-bottom: 16px; padding: 16px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #3b82f6;">
                <h3 style="margin: 0 0 12px 0; color: #374151; font-size: 16px; font-weight: 600;">${section.type || 'å…§å®¹æ®µè½'}</h3>
                <div style="color: #4b5563; line-height: 1.8;">
                  ${section.content ? section.content.map(content => `<p style="margin: 8px 0;">${content}</p>`).join('') : '<p>ç„¡å…§å®¹</p>'}
                </div>
              </div>
            `;
          });
          fullContent += '</div>';
        } else {
          // å¦‚æœæ²’æœ‰çµæ§‹åŒ–æ•¸æ“šï¼Œé¡¯ç¤ºåŸå§‹å…§å®¹
          fullContent += `
            <div style="background: #f8fafc; padding: 16px; border-radius: 8px; white-space: pre-wrap; line-height: 1.8; color: #4b5563; margin-top: 16px;">
              ${script.content || script.script_data || 'ç„¡å…§å®¹'}
            </div>
          `;
        }
        
        modalContent.innerHTML = fullContent;
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        // é»æ“ŠèƒŒæ™¯é—œé–‰
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
          }
        });
        
        // ESC éµé—œé–‰
        const handleEsc = (e) => {
          if (e.key === 'Escape') {
            modal.remove();
            document.removeEventListener('keydown', handleEsc);
          }
        };
        document.addEventListener('keydown', handleEsc);
      }
      
      // åˆªé™¤è…³æœ¬ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      window.deleteScriptForUserDB = async function(scriptId) {
        if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è…³æœ¬å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
          return;
        }
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/scripts/${scriptId}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            }
          });
        
          if (response.ok) {
            // å¾æœ¬åœ°å„²å­˜ä¸­ç§»é™¤
        const localScripts = getLocalScripts();
        const updatedScripts = localScripts.filter(script => script.id != scriptId);
        localStorage.setItem('user_scripts', JSON.stringify(updatedScripts));
        
        // é‡æ–°è¼‰å…¥è…³æœ¬åˆ—è¡¨
        loadMyScriptsForUserDB();
            showToast('è…³æœ¬å·²åˆªé™¤', 3000);
          } else {
            throw new Error('åˆªé™¤å¤±æ•—');
          }
        } catch (error) {
          console.error('Delete script error:', error);
          showToast('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // è¼‰å…¥å€‹äººè³‡æ–™åº«çš„å¸³è™Ÿå®šä½è¨˜éŒ„
      async function loadPositioningRecordsForUserDB() {
        const content = document.querySelector('#db-accountPositioning .section-content');
        
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥ä»¥æŸ¥çœ‹å¸³è™Ÿå®šä½è¨˜éŒ„</div>';
          return;
        }
        
        // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
        showLoadingAnimation(content, 'è¼‰å…¥å¸³è™Ÿå®šä½è¨˜éŒ„ä¸­...');
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${ipPlanningUser.user_id}`, {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            displayPositioningRecordsForUserDB(data.records || []);
          } else if (response.status === 401) {
            content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          } else if (response.status === 404) {
            content.innerHTML = '<div class="loading-text">å¸³è™Ÿå®šä½åŠŸèƒ½å³å°‡ä¸Šç·šï¼Œè«‹ç¨å¾Œå†è©¦</div>';
          } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'è¼‰å…¥å¤±æ•—');
          }
        } catch (error) {
          console.error('Load positioning records error:', error);
          content.innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
        }
      }
      
      // é¡¯ç¤ºå¸³è™Ÿå®šä½è¨˜éŒ„ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      function displayPositioningRecordsForUserDB(records) {
        const container = document.querySelector('#db-accountPositioning .section-content');
        
        if (records.length === 0) {
          container.innerHTML = '<div class="loading-text">å°šç„¡å¸³è™Ÿå®šä½è¨˜éŒ„</div>';
          return;
        }
        
        // æŒ‰æ™‚é–“æ’åºï¼šç”±æ–°åˆ°èˆŠï¼ˆæœ€æ–°çš„åœ¨æœ€ä¸Šé¢ï¼‰
        const sortedRecords = [...records].sort((a, b) => {
          const timeA = new Date(a.created_at || 0).getTime();
          const timeB = new Date(b.created_at || 0).getTime();
          return timeB - timeA; // é™åºï¼šå¤§çš„ï¼ˆæ–°çš„ï¼‰åœ¨å‰
        });
        
        container.innerHTML = sortedRecords.map((record, index) => {
          // ç·¨è™Ÿå¾1é–‹å§‹ï¼ˆæœ€æ–°çš„ç‚ºç·¨è™Ÿ01ï¼‰
          const recordNumber = String(index + 1).padStart(2, '0');
          const date = new Date(record.created_at).toLocaleString('zh-TW', {
            timeZone: 'Asia/Taipei',
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          });
          const preview = record.content.substring(0, 100) + (record.content.length > 100 ? '...' : '');
          
          return `
            <div class="positioning-record-item" data-record-id="${record.id}">
              <div class="record-header">
                <span class="record-number">ç·¨è™Ÿ ${recordNumber}</span>
                <span class="record-date">${date}</span>
              </div>
              <div class="record-preview">${preview}</div>
              <div class="record-actions">
                <button class="action-btn view-btn" onclick="viewPositioningDetailForUserDB(${record.id}, '${recordNumber}')">æŸ¥çœ‹å®Œæ•´çµæœ</button>
                <button class="action-btn delete-btn" onclick="deletePositioningRecordForUserDB(${record.id})">åˆªé™¤</button>
              </div>
            </div>
          `;
        }).join('');
      }
      
      // æŸ¥çœ‹å¸³è™Ÿå®šä½è©³ç´°å…§å®¹ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      async function viewPositioningDetailForUserDB(recordId, recordNumber) {
        if (!ipPlanningUser?.user_id) return;
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${ipPlanningUser.user_id}`, {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            const record = data.records.find(r => r.id === recordId);
            
            if (record) {
              // å‰µå»ºå½ˆå‡ºè¦–çª—é¡¯ç¤ºå®Œæ•´å…§å®¹
              const modal = document.createElement('div');
              modal.className = 'modal-overlay';
              modal.innerHTML = `
                <div class="modal-content">
                  <div class="modal-header">
                    <h3>å¸³è™Ÿå®šä½è©³ç´°å…§å®¹ - ç·¨è™Ÿ ${recordNumber}</h3>
                    <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">Ã—</button>
                  </div>
                  <div class="modal-body">
                    <div class="record-detail">
                      <div class="detail-meta">
                        <span class="detail-label">å»ºç«‹æ™‚é–“ï¼š</span>
                        <span class="detail-value">${new Date(record.created_at).toLocaleString('zh-TW', {
                          timeZone: 'Asia/Taipei',
                          year: 'numeric',
                          month: '2-digit',
                          day: '2-digit',
                          hour: '2-digit',
                          minute: '2-digit'
                        })}</span>
                      </div>
                      <div class="detail-content">
                        <div class="content-text">${record.content.replace(/\n/g, '<br>')}</div>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button class="action-btn" onclick="this.closest('.modal-overlay').remove()">é—œé–‰</button>
                  </div>
                </div>
              `;
              
              document.body.appendChild(modal);
            } else {
              showToast('æ‰¾ä¸åˆ°è©²è¨˜éŒ„', 3000);
            }
          } else {
            throw new Error('è¼‰å…¥å¤±æ•—');
          }
        } catch (error) {
          console.error('View positioning detail error:', error);
          showToast('è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // åˆªé™¤å¸³è™Ÿå®šä½è¨˜éŒ„ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      async function deletePositioningRecordForUserDB(recordId) {
        if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™ç­†å¸³è™Ÿå®šä½è¨˜éŒ„å—ï¼Ÿ')) return;
        
        // æ¸…ç† recordIdï¼Œç§»é™¤å¯èƒ½çš„é¡å¤–å­—ç¬¦ï¼ˆå¦‚ :1 ç­‰ï¼‰
        const cleanRecordId = String(recordId).split(':')[0].trim();
        
        if (!cleanRecordId) {
          console.error('ç„¡æ•ˆçš„è¨˜éŒ„ID:', recordId);
          showToast('åˆªé™¤å¤±æ•—ï¼šç„¡æ•ˆçš„è¨˜éŒ„ID', 3000);
          return;
        }
        
        try {
          // ä½¿ç”¨æ­£ç¢ºçš„ API ç«¯é»ï¼š/api/user/positioning/{recordId}
          const url = `https://aivideobackend.zeabur.app/api/user/positioning/${cleanRecordId}`;
          console.log('åˆªé™¤è«‹æ±‚ URL:', url);
          
          const response = await fetch(url, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            }
          });
          
          if (response.ok) {
            showToast('è¨˜éŒ„å·²åˆªé™¤', 2000);
            // é‡æ–°è¼‰å…¥åˆ—è¡¨
            await loadPositioningRecordsForUserDB();
          } else {
            const errorData = await response.json().catch(() => ({}));
            console.error('åˆªé™¤å¤±æ•—ï¼Œç‹€æ…‹ç¢¼:', response.status, 'URL:', url, 'éŒ¯èª¤:', errorData);
            throw new Error(errorData.error || `åˆªé™¤å¤±æ•— (${response.status})`);
          }
        } catch (error) {
          console.error('Delete positioning record error:', error);
          showToast('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // è¼‰å…¥å€‹äººè³‡æ–™åº«çš„é¸é¡Œå…§å®¹ï¼ˆå¾ generations è¡¨ç²å–å¯¦éš›é¸é¡Œå…§å®¹ï¼‰
      async function loadTopicHistoryForUserDB() {
        const content = document.querySelector('#db-topicRecords .section-content');
        
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥ä»¥æŸ¥çœ‹é¸é¡Œå…§å®¹</div>';
          return;
        }
        
        // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
        showLoadingAnimation(content, 'è¼‰å…¥é¸é¡Œå…§å®¹ä¸­...');
        
        try {
          // å¾å¾Œç«¯ç²å–é¸é¡Œç”Ÿæˆè¨˜éŒ„ï¼ˆgenerations è¡¨ï¼‰
          const response = await fetch(`https://aivideobackend.zeabur.app/api/generations/${ipPlanningUser.user_id}?limit=100`, {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            // éæ¿¾å‡ºé¸é¡Œç›¸é—œçš„ç”Ÿæˆå…§å®¹ï¼ˆæ ¹æ“š topic æ¬„ä½æˆ– content å…§å®¹åˆ¤æ–·ï¼‰
            const topicGenerations = (data.generations || []).filter(gen => {
              // å¦‚æœ topic æ¬„ä½æœ‰å€¼ï¼Œæˆ–è€… content åŒ…å«é¸é¡Œç›¸é—œé—œéµå­—
              return gen.topic || 
                     (gen.content && (
                       gen.content.includes('é¸é¡Œ') || 
                       gen.content.includes('ä¸»é¡Œ') ||
                       gen.content.includes('æ¨è–¦') ||
                       gen.content.includes('ç†±é–€')
                     ));
            });
            displayTopicRecordsForUserDB(topicGenerations);
          } else if (response.status === 401) {
            content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          } else {
            content.innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
          }
        } catch (error) {
          console.error('è¼‰å…¥é¸é¡Œå…§å®¹éŒ¯èª¤:', error);
          content.innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
        }
      }
      
      // è¼‰å…¥ IP äººè¨­è¦åŠƒçµæœ
      async function loadIpPlanningResultsForUserDB() {
        const content = document.getElementById('ip-planning-content');
        
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥ä»¥æŸ¥çœ‹ IP äººè¨­è¦åŠƒçµæœ</div>';
          return;
        }
        
        // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
        showLoadingAnimation(content, 'è¼‰å…¥ IP äººè¨­è¦åŠƒçµæœä¸­...');
        
        try {
          // å…ˆç²å–å¸³è™Ÿå®šä½åç¨±
          let positioningName = 'å¸³è™Ÿå®šä½';
          try {
            const positioningResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${ipPlanningUser.user_id}`, {
              headers: {
                'Authorization': `Bearer ${ipPlanningToken}`,
                'Content-Type': 'application/json'
              }
            });
            if (positioningResponse.ok) {
              const positioningData = await positioningResponse.json();
              if (positioningData.records && positioningData.records.length > 0) {
                // å¾æœ€æ–°çš„å¸³è™Ÿå®šä½è¨˜éŒ„ä¸­æå–åç¨±
                const latestRecord = positioningData.records[0];
                const contentText = latestRecord.content || '';
                // å˜—è©¦æå–å¸³è™Ÿå®šä½åç¨±ï¼ˆé€šå¸¸åœ¨å…§å®¹é–‹é ­æˆ–æ¨™é¡Œä¸­ï¼‰
                const nameMatch = contentText.match(/(?:å¸³è™Ÿå®šä½|å®šä½åç¨±|IPå®šä½)[ï¼š:]\s*([^\n]+)/i) || 
                                 contentText.match(/(?:^|\n)([^ï¼š:\n]+)[ï¼š:]\s*å¸³è™Ÿå®šä½/i) ||
                                 contentText.match(/^([^ï¼š:\n]+)/);
                if (nameMatch && nameMatch[1]) {
                  positioningName = nameMatch[1].trim().substring(0, 30);
                }
              }
            }
          } catch (e) {
            console.log('ç„¡æ³•ç²å–å¸³è™Ÿå®šä½åç¨±ï¼Œä½¿ç”¨é è¨­å€¼:', e);
          }
          
          // ä¸»æ¨™é¡Œå·²æ”¹ç‚ºå›ºå®šã€ŒIPäººè¨­è¦åŠƒã€ï¼Œä¸å†éœ€è¦ç·¨è¼¯åŠŸèƒ½
          
          // ç²å– IP äººè¨­è¦åŠƒçµæœ
          const response = await fetch('https://aivideobackend.zeabur.app/api/ip-planning/my', {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            if (data.success && data.results) {
              // ä¿å­˜çµæœä¾›åŒ¯å‡ºä½¿ç”¨
              window.currentIpPlanningResults = data.results;
              displayIpPlanningResultsForUserDB(data.results);
            } else {
              content.innerHTML = '<div class="loading-text">å°šç„¡ IP äººè¨­è¦åŠƒçµæœ</div>';
            }
          } else if (response.status === 401) {
            content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          } else {
            content.innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
          }
        } catch (error) {
          console.error('è¼‰å…¥ IP äººè¨­è¦åŠƒçµæœéŒ¯èª¤:', error);
          content.innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
        }
      }
      
      // ä¸»æ¨™é¡Œå·²æ”¹ç‚ºå›ºå®šã€ŒIPäººè¨­è¦åŠƒã€ï¼Œä¸å†éœ€è¦ç·¨è¼¯åŠŸèƒ½
      // editIpPlanningTitle å’Œ saveIpPlanningTitle å‡½æ•¸å·²ç§»é™¤
      
      // ç·¨è¼¯ IP äººè¨­è¦åŠƒé …ç›®æ¨™é¡Œï¼ˆæ¯å€‹æ¬„ä½çš„æ¨™é¡Œï¼‰
      window.editIpPlanningItemTitle = function(resultId, event) {
        if (event) event.stopPropagation();
        
        const titleElement = document.querySelector(`.ip-planning-item-title[data-result-id="${resultId}"]`);
        const inputElement = document.querySelector(`.ip-planning-item-title-input[data-result-id="${resultId}"]`);
        const editIcon = document.querySelector(`.ip-planning-item-edit-icon[data-result-id="${resultId}"]`);
        
        if (titleElement && inputElement) {
          // ç²å–ç•¶å‰æ¨™é¡Œ
          const currentTitle = titleElement.textContent.trim();
          inputElement.value = currentTitle;
          
          // åˆ‡æ›é¡¯ç¤º
          titleElement.style.display = 'none';
          if (editIcon) editIcon.style.display = 'none';
          inputElement.style.display = 'block';
          
          // èšç„¦ä¸¦é¸ä¸­æ–‡å­—
          inputElement.focus();
          inputElement.select();
        }
      }
      
      // ä¿å­˜ IP äººè¨­è¦åŠƒé …ç›®æ¨™é¡Œ
      window.saveIpPlanningItemTitle = function(resultId) {
        const titleElement = document.querySelector(`.ip-planning-item-title[data-result-id="${resultId}"]`);
        const inputElement = document.querySelector(`.ip-planning-item-title-input[data-result-id="${resultId}"]`);
        const editIcon = document.querySelector(`.ip-planning-item-edit-icon[data-result-id="${resultId}"]`);
        
        if (titleElement && inputElement) {
          const newTitle = inputElement.value.trim();
          
          // å¦‚æœç‚ºç©ºï¼Œä½¿ç”¨é è¨­æ¨™é¡Œï¼ˆæ ¹æ“šé¡å‹ï¼‰
          const item = document.querySelector(`.ip-planning-item[data-result-id="${resultId}"]`);
          let defaultTitle = 'IP Profile';
          if (item) {
            const activeTab = document.querySelector('.ip-planning-tab.active');
            if (activeTab) {
              if (activeTab.textContent.includes('è¦åŠƒ')) {
                defaultTitle = '14å¤©è¦åŠƒ';
              } else if (activeTab.textContent.includes('è…³æœ¬')) {
                defaultTitle = 'ä»Šæ—¥è…³æœ¬';
              }
            }
          }
          
          const finalTitle = newTitle || defaultTitle;
          
          // æ›´æ–°æ¨™é¡Œé¡¯ç¤º
          titleElement.textContent = finalTitle;
          
          // ä¿å­˜åˆ° localStorage
          if (ipPlanningUser && ipPlanningUser.user_id) {
            localStorage.setItem(`ip-planning-item-title-${ipPlanningUser.user_id}-${resultId}`, finalTitle);
          }
          
          if (newTitle) {
            showToast('âœ… æ¨™é¡Œå·²æ›´æ–°', 2000);
          }
          
          // åˆ‡æ›é¡¯ç¤º
          titleElement.style.display = '';
          if (editIcon) {
            editIcon.style.display = 'none';
            editIcon.style.opacity = '0.6';
          }
          inputElement.style.display = 'none';
        }
      }
      
      // ç·¨è¼¯æˆ‘çš„è…³æœ¬æ¨™é¡Œ
      function editMyScriptsTitle() {
        const titleElement = document.getElementById('my-scripts-title');
        const inputElement = document.getElementById('my-scripts-title-input');
        const editIcon = document.getElementById('my-scripts-edit-icon');
        
        if (titleElement && inputElement) {
          // ç²å–ç•¶å‰æ¨™é¡Œï¼ˆå»é™¤ emojiï¼‰
          const currentTitle = titleElement.textContent.replace(/^ğŸ’¾\s*/, '');
          inputElement.value = currentTitle;
          
          // åˆ‡æ›é¡¯ç¤º
          titleElement.style.display = 'none';
          editIcon.style.display = 'none';
          inputElement.style.display = 'block';
          
          // èšç„¦ä¸¦é¸ä¸­æ–‡å­—
          inputElement.focus();
          inputElement.select();
        }
      }
      
      // ä¿å­˜æˆ‘çš„è…³æœ¬æ¨™é¡Œ
      function saveMyScriptsTitle() {
        const titleElement = document.getElementById('my-scripts-title');
        const inputElement = document.getElementById('my-scripts-title-input');
        const editIcon = document.getElementById('my-scripts-edit-icon');
        
        if (titleElement && inputElement) {
          const newTitle = inputElement.value.trim();
          
          // å¦‚æœç‚ºç©ºï¼Œä½¿ç”¨é è¨­æ¨™é¡Œ
          const finalTitle = newTitle || 'åœ¨æ­¤è¼¸å…¥ä½ çš„æ¨™é¡Œ';
          
            // æ›´æ–°æ¨™é¡Œé¡¯ç¤º
          titleElement.textContent = `ğŸ’¾ ${finalTitle}`;
            
            // ä¿å­˜åˆ° localStorage
            if (ipPlanningUser && ipPlanningUser.user_id) {
            localStorage.setItem(`my-scripts-title-${ipPlanningUser.user_id}`, finalTitle);
            }
            
          if (newTitle) {
            showToast('âœ… æ¨™é¡Œå·²æ›´æ–°', 2000);
          }
          
          // åˆ‡æ›é¡¯ç¤º
          titleElement.style.display = '';
          editIcon.style.display = '';
          inputElement.style.display = 'none';
        }
      }
      
      // åŒ¯å‡º IP äººè¨­è¦åŠƒçµæœ
      function exportIpPlanningResults() {
        if (!window.currentIpPlanningResults || window.currentIpPlanningResults.length === 0) {
          showToast('æ²’æœ‰å¯åŒ¯å‡ºçš„å…§å®¹', 3000);
          return;
        }
        
        try {
          // ç²å–ç•¶å‰é¸ä¸­çš„é¡å‹
          const activeTab = document.querySelector('.ip-planning-tab.active');
          let currentType = 'all';
          if (activeTab) {
            if (activeTab.textContent.includes('Profile')) {
              currentType = 'profile';
            } else if (activeTab.textContent.includes('è¦åŠƒ')) {
              currentType = 'plan';
            } else if (activeTab.textContent.includes('è…³æœ¬')) {
              currentType = 'scripts';
            }
          }
          
          // ç¯©é¸ç•¶å‰é¡å‹çš„çµæœ
          const filteredResults = currentType === 'all' 
            ? window.currentIpPlanningResults 
            : window.currentIpPlanningResults.filter(r => r.result_type === currentType);
          
          if (filteredResults.length === 0) {
            showToast('ç•¶å‰é¡å‹æ²’æœ‰å¯åŒ¯å‡ºçš„å…§å®¹', 3000);
            return;
          }
          
          // ç”Ÿæˆ CSV å…§å®¹
          let csvContent = 'é¡å‹,æ¨™é¡Œ,å…§å®¹,å‰µå»ºæ™‚é–“\n';
          filteredResults.forEach(result => {
            const typeName = result.result_type === 'profile' ? 'IP Profile' : 
                           result.result_type === 'plan' ? '14å¤©è¦åŠƒ' : 'ä»Šæ—¥è…³æœ¬';
            const textContent = (result.content || '').replace(/<[^>]*>/g, '').replace(/"/g, '""').replace(/\n/g, ' ');
            const title = (result.title || typeName).replace(/"/g, '""');
            const date = result.created_at ? new Date(result.created_at).toLocaleString('zh-TW', {
              timeZone: 'Asia/Taipei',
              year: 'numeric',
              month: '2-digit',
              day: '2-digit',
              hour: '2-digit',
              minute: '2-digit'
            }) : '';
            csvContent += `"${typeName}","${title}","${textContent}","${date}"\n`;
          });
          
          // å‰µå»º CSV æª”æ¡ˆ
          const csvBlob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
          const csvUrl = URL.createObjectURL(csvBlob);
          const csvLink = document.createElement('a');
          csvLink.href = csvUrl;
          csvLink.download = `ip-planning-${currentType}-${Date.now()}.csv`;
          csvLink.click();
          URL.revokeObjectURL(csvUrl);
          
          showToast('âœ… çµæœå·²åŒ¯å‡ºç‚º CSV æª”æ¡ˆ', 3000);
        } catch (error) {
          console.error('åŒ¯å‡ºå¤±æ•—:', error);
          showToast('âŒ åŒ¯å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // é¡¯ç¤º IP äººè¨­è¦åŠƒçµæœ
      function displayIpPlanningResultsForUserDB(results) {
        const content = document.getElementById('ip-planning-content');
        
        if (results.length === 0) {
          content.innerHTML = '<div class="loading-text">å°šç„¡ IP äººè¨­è¦åŠƒçµæœ</div>';
          return;
        }
        
        // å…ˆæŒ‰æ™‚é–“æ’åºï¼šç”±æ–°åˆ°èˆŠï¼ˆæœ€æ–°çš„åœ¨æœ€ä¸Šé¢ï¼‰
        const sortedResults = [...results].sort((a, b) => {
          const timeA = new Date(a.created_at || 0).getTime();
          const timeB = new Date(b.created_at || 0).getTime();
          return timeB - timeA; // é™åºï¼šå¤§çš„ï¼ˆæ–°çš„ï¼‰åœ¨å‰
        });
        
        // æŒ‰é¡å‹åˆ†çµ„ï¼ˆå·²æ’åºï¼‰
        const groupedResults = {
          profile: sortedResults.filter(r => r.result_type === 'profile'),
          plan: sortedResults.filter(r => r.result_type === 'plan'),
          scripts: sortedResults.filter(r => r.result_type === 'scripts')
        };
        
        // é¡¯ç¤ºç•¶å‰é¸ä¸­çš„é¡å‹
        const activeTab = document.querySelector('.ip-planning-tab.active');
        let currentType = 'profile';
        if (activeTab) {
          if (activeTab.textContent.includes('Profile')) {
            currentType = 'profile';
          } else if (activeTab.textContent.includes('è¦åŠƒ')) {
            currentType = 'plan';
          } else if (activeTab.textContent.includes('è…³æœ¬')) {
            currentType = 'scripts';
          }
        }
        
        const currentResults = groupedResults[currentType] || [];
        
        if (currentResults.length === 0) {
          const typeText = currentType === 'profile' ? 'IP Profile' : currentType === 'plan' ? '14å¤©è¦åŠƒ' : 'ä»Šæ—¥è…³æœ¬';
          const safeTypeText = escapeHtml(typeText);
          content.innerHTML = `<div class="loading-text">å°šç„¡${safeTypeText}è¨˜éŒ„</div>`;
          return;
        }
        
        content.innerHTML = currentResults.map((result, index) => {
          const date = formatTaiwanTime(result.created_at);
          // æª¢æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„è‡ªå®šç¾©æ¨™é¡Œ
          let savedTitle = '';
          if (ipPlanningUser && ipPlanningUser.user_id) {
            savedTitle = localStorage.getItem(`ip-planning-item-title-${ipPlanningUser.user_id}-${result.id}`);
          }
          const defaultTitle = currentType === 'profile' ? 'IP Profile' : currentType === 'plan' ? '14å¤©è¦åŠƒ' : 'ä»Šæ—¥è…³æœ¬';
          const title = savedTitle || result.title || defaultTitle;
          return `
            <div class="ip-planning-item" data-result-id="${result.id}" style="background: white; border-radius: 8px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              <div class="ip-planning-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                  <h4 class="ip-planning-item-title" data-result-id="${result.id}" style="margin: 0; color: #1F2937; font-size: 1.1rem; cursor: pointer; position: relative; padding-right: 24px;" onclick="editIpPlanningItemTitle(${result.id}, event)" title="é»æ“Šç·¨è¼¯æ¨™é¡Œ">${title}</h4>
                  <span class="ip-planning-item-edit-icon" data-result-id="${result.id}" style="cursor: pointer; color: #6B7280; font-size: 0.9rem; opacity: 0.6; transition: opacity 0.2s; display: none;" onclick="editIpPlanningItemTitle(${result.id}, event)" title="ç·¨è¼¯æ¨™é¡Œ" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.6'">âœï¸</span>
                  <input type="text" class="ip-planning-item-title-input" data-result-id="${result.id}" style="display: none; flex: 1; padding: 6px 12px; border: 2px solid #3B82F6; border-radius: 6px; font-size: 1.1rem; font-weight: 600; outline: none; max-width: 300px;" onblur="saveIpPlanningItemTitle(${result.id})" onkeypress="if(event.key === 'Enter') saveIpPlanningItemTitle(${result.id})">
                </div>
                <span style="color: #6B7280; font-size: 0.9rem;">${date}</span>
              </div>
              <div class="ip-planning-content-item" style="color: #374151; line-height: 1.6; max-height: 300px; overflow-y: auto;">
                ${result.content}
              </div>
            </div>
          `;
        }).join('');
        
        // ç‚ºæ¯å€‹é …ç›®æ·»åŠ  hover æ•ˆæœé¡¯ç¤ºç·¨è¼¯åœ–æ¨™
        document.querySelectorAll('.ip-planning-item').forEach(item => {
          const titleEl = item.querySelector('.ip-planning-item-title');
          const editIcon = item.querySelector('.ip-planning-item-edit-icon');
          if (titleEl && editIcon) {
            item.addEventListener('mouseenter', () => {
              editIcon.style.display = 'inline-block';
            });
            item.addEventListener('mouseleave', () => {
              const inputEl = item.querySelector('.ip-planning-item-title-input');
              if (!inputEl || inputEl.style.display === 'none') {
                editIcon.style.display = 'none';
              }
            });
          }
        });
      }
      
      // åˆ‡æ› IP äººè¨­è¦åŠƒé¡å‹
      function showIpPlanningType(type) {
        // æ›´æ–°æ¨™ç±¤ç‹€æ…‹
        document.querySelectorAll('.ip-planning-tab').forEach(tab => {
          tab.classList.remove('active');
          tab.style.borderBottom = 'none';
          tab.style.color = '#6B7280';
          tab.style.fontWeight = 'normal';
        });
        
        // æ‰¾åˆ°å°æ‡‰çš„æ¨™ç±¤
        const tabs = document.querySelectorAll('.ip-planning-tab');
        let targetTab = null;
        if (type === 'profile') {
          targetTab = Array.from(tabs).find(tab => tab.textContent.includes('Profile'));
        } else if (type === 'plan') {
          targetTab = Array.from(tabs).find(tab => tab.textContent.includes('è¦åŠƒ'));
        } else if (type === 'scripts') {
          targetTab = Array.from(tabs).find(tab => tab.textContent.includes('è…³æœ¬'));
        }
        
        if (targetTab) {
          targetTab.classList.add('active');
          targetTab.style.borderBottom = '2px solid #3B82F6';
          targetTab.style.color = '#3B82F6';
          targetTab.style.fontWeight = '600';
        }
        
        // é‡æ–°è¼‰å…¥ä¸¦é¡¯ç¤ºè©²é¡å‹çš„çµæœ
        loadIpPlanningResultsForUserDB();
      }
      
      // è§£æé¸é¡Œå…§å®¹ç‚º5å€‹æ¬„ä½
      function parseTopicContent(content) {
        if (!content) {
          return {
            hotTopics: '',
            specificSuggestions: '',
            strategies: '',
            contentPlanning: '',
            timeline: ''
          };
        }
        
        const sections = {
          hotTopics: '',
          specificSuggestions: '',
          strategies: '',
          contentPlanning: '',
          timeline: ''
        };
        
        // ä½¿ç”¨æ­£å‰‡è¡¨é”å¼åŒ¹é…å„å€‹æ¬„ä½
        const patterns = {
          hotTopics: /(ç†±é–€é¸é¡Œæ–¹å‘|é¸é¡Œæ–¹å‘|ç†±é–€è©±é¡Œ|ç†±é–€é¸é¡Œ)[:ï¼š]?\s*([\s\S]*?)(?=(é¸é¡Œçš„å…·é«”å»ºè­°|é¸é¡Œç­–ç•¥|å…§å®¹è¦åŠƒ|åŸ·è¡Œæ™‚ç¨‹|$))/i,
          specificSuggestions: /(é¸é¡Œçš„å…·é«”å»ºè­°|å…·é«”å»ºè­°|æ¯å€‹é¸é¡Œçš„å…·é«”å»ºè­°|é¸é¡Œå»ºè­°)[:ï¼š]?\s*([\s\S]*?)(?=(é¸é¡Œç­–ç•¥|å…§å®¹è¦åŠƒ|åŸ·è¡Œæ™‚ç¨‹|$))/i,
          strategies: /(é¸é¡Œç­–ç•¥å’ŒæŠ€å·§|é¸é¡Œç­–ç•¥|ç­–ç•¥å’ŒæŠ€å·§|é¸é¡ŒæŠ€å·§)[:ï¼š]?\s*([\s\S]*?)(?=(å…§å®¹è¦åŠƒ|åŸ·è¡Œæ™‚ç¨‹|$))/i,
          contentPlanning: /(å…§å®¹è¦åŠƒå»ºè­°|å…§å®¹è¦åŠƒ|è¦åŠƒå»ºè­°)[:ï¼š]?\s*([\s\S]*?)(?=(åŸ·è¡Œæ™‚ç¨‹|æ™‚ç¨‹å»ºè­°|$))/i,
          timeline: /(åŸ·è¡Œæ™‚ç¨‹å»ºè­°|æ™‚ç¨‹å»ºè­°|åŸ·è¡Œæ™‚ç¨‹|æ™‚ç¨‹)[:ï¼š]?\s*([\s\S]*?)$/i
        };
        
        // å˜—è©¦åŒ¹é…å„å€‹æ¬„ä½
        for (const [key, pattern] of Object.entries(patterns)) {
          const match = content.match(pattern);
          if (match && match[2]) {
            let extracted = match[2].trim();
            
            // æ¸…ç†æå–çš„å…§å®¹ï¼šç§»é™¤é–‹é ­çš„æ¨™é¡Œé‡è¤‡å’Œæ ¼å¼ç¬¦è™Ÿ
            // ç§»é™¤å¯èƒ½é‡è¤‡çš„æ¨™é¡Œï¼ˆå¦‚ "1. ç†±é–€é¸é¡Œæ–¹å‘ï¼š"ï¼‰
            extracted = extracted.replace(/^(1|ä¸€)[\.ã€]?\s*(ç†±é–€é¸é¡Œæ–¹å‘|é¸é¡Œæ–¹å‘|ç†±é–€è©±é¡Œ|ç†±é–€é¸é¡Œ)[:ï¼š]?\s*/i, '');
            extracted = extracted.replace(/^(2|äºŒ)[\.ã€]?\s*(å…·é«”å»ºè­°|é¸é¡Œçš„å…·é«”å»ºè­°|é¸é¡Œå»ºè­°)[:ï¼š]?\s*/i, '');
            extracted = extracted.replace(/^(3|ä¸‰)[\.ã€]?\s*(ç­–ç•¥|é¸é¡Œç­–ç•¥|æŠ€å·§)[:ï¼š]?\s*/i, '');
            extracted = extracted.replace(/^(4|å››)[\.ã€]?\s*(å…§å®¹è¦åŠƒ)[:ï¼š]?\s*/i, '');
            extracted = extracted.replace(/^(5|äº”)[\.ã€]?\s*(æ™‚ç¨‹|åŸ·è¡Œæ™‚ç¨‹)[:ï¼š]?\s*/i, '');
            
            // ç§»é™¤é–‹é ­çš„æ•¸å­—æ¨™è¨˜ï¼ˆå¦‚ "1. "ã€"2. "ï¼‰
            extracted = extracted.replace(/^\d+[\.ã€]\s*/, '');
            
            // ç§»é™¤å¤šé¤˜çš„ç©ºç™½è¡Œ
            extracted = extracted.replace(/\n{3,}/g, '\n\n');
            
            // ç§»é™¤é–‹é ­å’Œçµå°¾çš„ç©ºç™½
            extracted = extracted.trim();
            
            sections[key] = extracted;
          }
        }
        
        // å¦‚æœæ²’æœ‰åŒ¹é…åˆ°ï¼Œå˜—è©¦æŒ‰æ•¸å­—æ¨™è¨˜åˆ†å‰²ï¼ˆ1. 2. 3. ç­‰ï¼‰
        if (!sections.hotTopics && !sections.specificSuggestions) {
          const lines = content.split(/\n/);
          let currentSection = '';
          let currentKey = '';
          
          for (const line of lines) {
            if (/^(1|ä¸€)[\.ã€]?\s*(ç†±é–€é¸é¡Œ|é¸é¡Œæ–¹å‘)/i.test(line)) {
              currentKey = 'hotTopics';
              currentSection = line.replace(/^(1|ä¸€)[\.ã€]?\s*(ç†±é–€é¸é¡Œ|é¸é¡Œæ–¹å‘)[:ï¼š]?\s*/i, '').trim() + '\n';
            } else if (/^(2|äºŒ)[\.ã€]?\s*(å…·é«”å»ºè­°|é¸é¡Œçš„å…·é«”)/i.test(line)) {
              currentKey = 'specificSuggestions';
              currentSection = line.replace(/^(2|äºŒ)[\.ã€]?\s*(å…·é«”å»ºè­°|é¸é¡Œçš„å…·é«”)[:ï¼š]?\s*/i, '').trim() + '\n';
            } else if (/^(3|ä¸‰)[\.ã€]?\s*(ç­–ç•¥|æŠ€å·§)/i.test(line)) {
              currentKey = 'strategies';
              currentSection = line.replace(/^(3|ä¸‰)[\.ã€]?\s*(ç­–ç•¥|æŠ€å·§)[:ï¼š]?\s*/i, '').trim() + '\n';
            } else if (/^(4|å››)[\.ã€]?\s*(å…§å®¹è¦åŠƒ)/i.test(line)) {
              currentKey = 'contentPlanning';
              currentSection = line.replace(/^(4|å››)[\.ã€]?\s*(å…§å®¹è¦åŠƒ)[:ï¼š]?\s*/i, '').trim() + '\n';
            } else if (/^(5|äº”)[\.ã€]?\s*(æ™‚ç¨‹|åŸ·è¡Œ)/i.test(line)) {
              currentKey = 'timeline';
              currentSection = line.replace(/^(5|äº”)[\.ã€]?\s*(æ™‚ç¨‹|åŸ·è¡Œ)[:ï¼š]?\s*/i, '').trim() + '\n';
            } else if (currentKey && line.trim()) {
              currentSection += line + '\n';
            }
            
            if (currentKey && currentSection) {
              sections[currentKey] = currentSection.trim();
            }
          }
        }
        
        // å¦‚æœé‚„æ˜¯æ²’æœ‰åŒ¹é…åˆ°ï¼Œå°±å°‡å…¨éƒ¨å…§å®¹æ”¾åœ¨ç¬¬ä¸€å€‹æ¬„ä½
        if (!sections.hotTopics && !sections.specificSuggestions && !sections.strategies && !sections.contentPlanning && !sections.timeline) {
          sections.hotTopics = content;
        }
        
        return sections;
      }
      
      // é¡¯ç¤ºé¸é¡Œå…§å®¹ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰- æŒ‰ç…§5å€‹æ¬„ä½åˆ†é¡é¡¯ç¤º
      function displayTopicRecordsForUserDB(generations) {
        const container = document.querySelector('#db-topicRecords .section-content');
        
        if (generations.length === 0) {
          container.innerHTML = '<div class="loading-text">å°šç„¡é¸é¡Œå…§å®¹</div>';
          return;
        }
        
        // æŒ‰æ™‚é–“æ’åºï¼šç”±æ–°åˆ°èˆŠï¼ˆæœ€æ–°çš„åœ¨æœ€ä¸Šé¢ï¼‰
        const sortedGenerations = [...generations].sort((a, b) => {
          const timeA = new Date(a.created_at || 0).getTime();
          const timeB = new Date(b.created_at || 0).getTime();
          return timeB - timeA; // é™åºï¼šå¤§çš„ï¼ˆæ–°çš„ï¼‰åœ¨å‰
        });
        
        container.innerHTML = sortedGenerations.map((gen, index) => {
          const date = formatTaiwanTime(gen.created_at);
          const platform = gen.platform || '';
          const topic = gen.topic || '';
          
          // è§£æé¸é¡Œå…§å®¹ç‚º5å€‹æ¬„ä½
          const sections = parseTopicContent(gen.content);
          
          // ç²å–è©²é …ç›®çš„æ¨™é¡Œï¼ˆå¾localStorageæˆ–ä½¿ç”¨é è¨­ï¼‰
          const itemTitleKey = `topic-item-title-${gen.id || gen.created_at || index}`;
          const savedItemTitle = localStorage.getItem(itemTitleKey);
          const itemTitle = savedItemTitle || 'åœ¨æ­¤è¼¸å…¥ä½ çš„æ¨™é¡Œ';
          
          // æ ¼å¼åŒ–å…§å®¹é¡¯ç¤ºï¼ˆæ¸…ç† Markdown å’Œæ ¼å¼ç¬¦è™Ÿï¼‰
          const formatText = (text) => {
            if (!text) return 'ç„¡å…§å®¹';
            
            // æ¸…ç†å…§å®¹ï¼šç§»é™¤å¤šé¤˜çš„æ ¼å¼ç¬¦è™Ÿå’Œæ¨™è¨˜
            let cleaned = text;
            
            // 1. ç§»é™¤å¤šé¤˜çš„ç©ºç™½è¡Œï¼ˆ3å€‹ä»¥ä¸Šé€£çºŒæ›è¡Œï¼‰
            cleaned = cleaned.replace(/\n{3,}/g, '\n\n');
            
            // 2. æ¸…ç† Markdown æ ¼å¼
            // ç§»é™¤å–®ç¨çš„ ** æˆ– * ç¬¦è™Ÿï¼ˆä½†ä¿ç•™ç”¨æ–¼å¼·èª¿çš„ï¼‰
            cleaned = cleaned.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>'); // **æ–‡å­—** â†’ <strong>æ–‡å­—</strong>
            cleaned = cleaned.replace(/\*([^*\n]+)\*/g, '<em>$1</em>'); // *æ–‡å­—* â†’ <em>æ–‡å­—</em>
            cleaned = cleaned.replace(/`([^`]+)`/g, '<code>$1</code>'); // `æ–‡å­—` â†’ <code>æ–‡å­—</code>
            
            // 3. æ¸…ç† Markdown æ¨™é¡Œæ ¼å¼
            cleaned = cleaned.replace(/^#{1,6}\s*(.+)$/gm, '<strong>$1</strong>'); // # æ¨™é¡Œ â†’ <strong>æ¨™é¡Œ</strong>
            
            // 4. æ¸…ç†åˆ—è¡¨æ ¼å¼ï¼Œçµ±ä¸€ç‚ºæœ‰åºåˆ—è¡¨
            // è™•ç†æ•¸å­—åˆ—è¡¨ï¼ˆ1. 2. 3.ï¼‰
            cleaned = cleaned.replace(/^(\d+)[\.ã€]\s*(.+)$/gm, '<div style="margin: 6px 0; padding-left: 8px;">$1. $2</div>');
            // è™•ç†é …ç›®ç¬¦è™Ÿåˆ—è¡¨ï¼ˆ- * â€¢ï¼‰
            cleaned = cleaned.replace(/^[-*â€¢]\s*(.+)$/gm, '<div style="margin: 6px 0; padding-left: 8px;">â€¢ $1</div>');
            
            // 5. æ¸…ç†å¤šé¤˜çš„æ¨™è¨˜ç¬¦è™Ÿå’Œåˆ†éš”ç·š
            cleaned = cleaned.replace(/^[-=*]{3,}$/gm, ''); // ç§»é™¤åˆ†éš”ç·š
            cleaned = cleaned.replace(/^[â—â—‹â– â–¡]\s*/gm, ''); // ç§»é™¤é–‹é ­çš„é …ç›®ç¬¦è™Ÿï¼ˆå¦‚æœå·²ç¶“è™•ç†éï¼‰
            
            // 6. æ¸…ç†å¤šé¤˜çš„ç©ºç™½
            cleaned = cleaned.replace(/[ \t]+/g, ' '); // å¤šå€‹ç©ºç™½è®Šä¸€å€‹
            cleaned = cleaned.trim();
            
            // 7. è™•ç†æ›è¡Œï¼šä¿ç•™æ®µè½çµæ§‹
            cleaned = cleaned.replace(/\n\n+/g, '</p><p style="margin: 8px 0;">'); // å¤šå€‹æ›è¡Œ â†’ æ®µè½åˆ†éš”
            cleaned = cleaned.replace(/\n/g, '<br>'); // å–®æ›è¡Œ â†’ æ›è¡Œæ¨™ç±¤
            
            // 8. åŒ…è£åœ¨æ®µè½æ¨™ç±¤ä¸­
            if (cleaned && !cleaned.startsWith('<')) {
              cleaned = '<p style="margin: 4px 0;">' + cleaned + '</p>';
            }
            
            return cleaned;
          };
          
          return `
            <div class="topic-item" data-topic-id="${gen.id || gen.created_at || index}" style="background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
              <div class="topic-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 2px solid #e5e7eb;">
                <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                  <span class="topic-number" style="background: #3b82f6; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600; width: 60px; min-width: 60px; max-width: 60px; text-align: center; white-space: nowrap; display: inline-block; box-sizing: border-box;">ç·¨è™Ÿ${String(index + 1).padStart(2, '0')}</span>
                  <div style="display: flex; align-items: center; gap: 8px; flex: 1;">
                    <h4 class="topic-item-title" data-title-key="${itemTitleKey}" style="margin: 0; color: #1f2937; font-size: 1rem; font-weight: 600; cursor: pointer; padding: 4px 8px; border-radius: 4px; transition: background 0.2s;" onclick="editTopicItemTitle(this, '${itemTitleKey}')" title="é»æ“Šç·¨è¼¯æ¨™é¡Œ">${itemTitle}</h4>
                    <span class="topic-edit-icon" style="cursor: pointer; color: #6B7280; font-size: 0.8rem; opacity: 0.6; transition: opacity 0.2s;" onclick="editTopicItemTitle(this.previousElementSibling, '${itemTitleKey}')" title="ç·¨è¼¯æ¨™é¡Œ" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.6'">âœï¸</span>
              </div>
                </div>
                <span class="topic-date" style="color: #6b7280; font-size: 14px;">${date}</span>
              </div>
              ${platform || topic ? `
              <div class="topic-meta" style="display: flex; gap: 12px; margin-bottom: 16px; flex-wrap: wrap;">
                ${platform ? `<span style="background: #f3f4f6; color: #374151; padding: 4px 12px; border-radius: 4px; font-size: 12px;">å¹³å°ï¼š${platform}</span>` : ''}
                ${topic ? `<span style="background: #f3f4f6; color: #374151; padding: 4px 12px; border-radius: 4px; font-size: 12px;">ä¸»é¡Œï¼š${topic}</span>` : ''}
              </div>
              ` : ''}
              <div class="topic-content-sections" style="display: flex; flex-direction: column; gap: 16px;">
                ${sections.hotTopics ? `
                <div class="topic-section" data-section-id="hotTopics-${gen.id || index}" style="background: #f9fafb; border-left: 3px solid #3b82f6; border-radius: 4px; overflow: hidden;">
                  <div class="topic-section-header" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; cursor: pointer; user-select: none;" onclick="toggleTopicSection('hotTopics-${gen.id || index}')">
                    <h5 style="margin: 0; color: #1f2937; font-size: 14px; font-weight: 600;">ğŸ”¥ ç†±é–€é¸é¡Œæ–¹å‘</h5>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <span class="topic-section-toggle" style="font-size: 12px; color: #6b7280;">â–¼</span>
                    </div>
                  </div>
                  <div class="topic-section-content" id="hotTopics-${gen.id || index}-content" style="padding: 0 12px 12px 12px; color: #374151; line-height: 1.6; font-size: 14px; display: block;">${formatText(sections.hotTopics)}</div>
                </div>
                ` : ''}
                ${sections.specificSuggestions ? `
                <div class="topic-section" data-section-id="specificSuggestions-${gen.id || index}" style="background: #f9fafb; border-left: 3px solid #10b981; border-radius: 4px; overflow: hidden;">
                  <div class="topic-section-header" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; cursor: pointer; user-select: none;" onclick="toggleTopicSection('specificSuggestions-${gen.id || index}')">
                    <h5 style="margin: 0; color: #1f2937; font-size: 14px; font-weight: 600;">ğŸ’¡ é¸é¡Œçš„å…·é«”å»ºè­°</h5>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <span class="topic-section-toggle" style="font-size: 12px; color: #6b7280;">â–¼</span>
                    </div>
                  </div>
                  <div class="topic-section-content" id="specificSuggestions-${gen.id || index}-content" style="padding: 0 12px 12px 12px; color: #374151; line-height: 1.6; font-size: 14px; display: block;">${formatText(sections.specificSuggestions)}</div>
                </div>
                ` : ''}
                ${sections.strategies ? `
                <div class="topic-section" data-section-id="strategies-${gen.id || index}" style="background: #f9fafb; border-left: 3px solid #f59e0b; border-radius: 4px; overflow: hidden;">
                  <div class="topic-section-header" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; cursor: pointer; user-select: none;" onclick="toggleTopicSection('strategies-${gen.id || index}')">
                    <h5 style="margin: 0; color: #1f2937; font-size: 14px; font-weight: 600;">ğŸ“‹ é¸é¡Œç­–ç•¥å’ŒæŠ€å·§</h5>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <span class="topic-section-toggle" style="font-size: 12px; color: #6b7280;">â–¼</span>
                    </div>
                  </div>
                  <div class="topic-section-content" id="strategies-${gen.id || index}-content" style="padding: 0 12px 12px 12px; color: #374151; line-height: 1.6; font-size: 14px; display: block;">${formatText(sections.strategies)}</div>
                </div>
                ` : ''}
                ${sections.contentPlanning ? `
                <div class="topic-section" data-section-id="contentPlanning-${gen.id || index}" style="background: #f9fafb; border-left: 3px solid #8b5cf6; border-radius: 4px; overflow: hidden;">
                  <div class="topic-section-header" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; cursor: pointer; user-select: none;" onclick="toggleTopicSection('contentPlanning-${gen.id || index}')">
                    <h5 style="margin: 0; color: #1f2937; font-size: 14px; font-weight: 600;">ğŸ“… å…§å®¹è¦åŠƒå»ºè­°</h5>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <span class="topic-section-toggle" style="font-size: 12px; color: #6b7280;">â–¼</span>
                    </div>
                  </div>
                  <div class="topic-section-content" id="contentPlanning-${gen.id || index}-content" style="padding: 0 12px 12px 12px; color: #374151; line-height: 1.6; font-size: 14px; display: block;">${formatText(sections.contentPlanning)}</div>
                </div>
                ` : ''}
                ${sections.timeline ? `
                <div class="topic-section" data-section-id="timeline-${gen.id || index}" style="background: #f9fafb; border-left: 3px solid #ef4444; border-radius: 4px; overflow: hidden;">
                  <div class="topic-section-header" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; cursor: pointer; user-select: none;" onclick="toggleTopicSection('timeline-${gen.id || index}')">
                    <h5 style="margin: 0; color: #1f2937; font-size: 14px; font-weight: 600;">â° åŸ·è¡Œæ™‚ç¨‹å»ºè­°</h5>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <span class="topic-section-toggle" style="font-size: 12px; color: #6b7280;">â–¼</span>
                    </div>
                  </div>
                  <div class="topic-section-content" id="timeline-${gen.id || index}-content" style="padding: 0 12px 12px 12px; color: #374151; line-height: 1.6; font-size: 14px; display: block;">${formatText(sections.timeline)}</div>
                </div>
                ` : ''}
                ${!sections.hotTopics && !sections.specificSuggestions && !sections.strategies && !sections.contentPlanning && !sections.timeline ? `
                <div class="topic-section" data-section-id="default-${gen.id || index}" style="background: #f9fafb; border-left: 3px solid #6b7280; border-radius: 4px; overflow: hidden;">
                  <div class="topic-section-header" style="display: flex; justify-content: space-between; align-items: center; padding: 12px; cursor: pointer; user-select: none;" onclick="toggleTopicSection('default-${gen.id || index}')">
                    <h5 style="margin: 0; color: #1f2937; font-size: 14px; font-weight: 600;">ğŸ“„ å…§å®¹</h5>
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <span class="topic-section-toggle" style="font-size: 12px; color: #6b7280;">â–¼</span>
                    </div>
                  </div>
                  <div class="topic-section-content" id="default-${gen.id || index}-content" style="padding: 0 12px 12px 12px; color: #374151; line-height: 1.6; font-size: 14px; display: block;">${formatText(gen.content)}</div>
                </div>
                ` : ''}
              </div>
              <div class="topic-item-actions" style="display: flex; justify-content: flex-end; gap: 8px; margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb;">
                <button class="action-btn delete-btn" onclick="deleteTopicRecordForUserDB('${gen.id || gen.created_at || index}', '${itemTitle}')" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 500; transition: background 0.2s;" onmouseover="this.style.background='#dc2626'" onmouseout="this.style.background='#ef4444'">ğŸ—‘ï¸ åˆªé™¤</button>
              </div>
            </div>
          `;
        }).join('');
      }
      
      // ç·¨è¼¯é¸é¡Œé …ç›®æ¨™é¡Œ
      window.editTopicItemTitle = function(titleElement, titleKey) {
        if (!titleElement || !titleKey) return;
        
        const currentTitle = titleElement.textContent.trim();
        const input = document.createElement('input');
        input.type = 'text';
        input.value = currentTitle;
        input.style.cssText = 'padding: 4px 8px; border: 2px solid #3B82F6; border-radius: 4px; font-size: 1rem; font-weight: 600; outline: none; width: 100%; max-width: 300px;';
        
        const saveTitle = () => {
          const newTitle = input.value.trim() || 'åœ¨æ­¤è¼¸å…¥ä½ çš„æ¨™é¡Œ';
          titleElement.textContent = newTitle;
          localStorage.setItem(titleKey, newTitle);
          input.replaceWith(titleElement);
          if (input.value.trim()) {
            showToast('âœ… æ¨™é¡Œå·²æ›´æ–°', 2000);
          }
        };
        
        input.addEventListener('blur', saveTitle);
        input.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            saveTitle();
          }
        });
        
        titleElement.replaceWith(input);
        input.focus();
        input.select();
      };
      
      // åˆ‡æ›é¸é¡Œæ¬„ä½çš„å±•é–‹/æ”¶èµ·ç‹€æ…‹
      window.toggleTopicSection = function(sectionId) {
        const contentElement = document.getElementById(`${sectionId}-content`);
        const toggleElement = document.querySelector(`[data-section-id="${sectionId}"] .topic-section-toggle`);
        
        if (!contentElement || !toggleElement) return;
        
        const isExpanded = contentElement.style.display !== 'none';
        
        if (isExpanded) {
          contentElement.style.display = 'none';
          toggleElement.textContent = 'â–¶';
        } else {
          contentElement.style.display = 'block';
          toggleElement.textContent = 'â–¼';
        }
      };
      
      // åˆªé™¤é¸é¡Œè¨˜éŒ„ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      window.deleteTopicRecordForUserDB = async function(genId, itemTitle) {
        const confirmMessage = `ç¢ºå®šè¦åˆªé™¤ã€Œ${itemTitle}ã€é€™å€‹é¸é¡Œè¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚`;
        if (!confirm(confirmMessage)) {
          return;
        }
        
        try {
          // å˜—è©¦å¾å¾Œç«¯åˆªé™¤ï¼ˆå¦‚æœå¾Œç«¯æœ‰APIï¼‰
          if (ipPlanningToken && ipPlanningUser && ipPlanningUser.user_id) {
            const response = await fetch(`https://aivideobackend.zeabur.app/api/generations/${genId}`, {
              method: 'DELETE',
              headers: {
                'Authorization': `Bearer ${ipPlanningToken}`,
                'Content-Type': 'application/json'
              }
            });
            
            if (response.ok) {
              showToast('é¸é¡Œè¨˜éŒ„å·²åˆªé™¤', 3000);
              // é‡æ–°è¼‰å…¥é¸é¡Œåˆ—è¡¨
              await loadTopicHistoryForUserDB();
              return;
            } else if (response.status !== 404) {
              // å¦‚æœå¾Œç«¯æ²’æœ‰é€™å€‹APIï¼Œå‰‡åªå¾å‰ç«¯ç§»é™¤
              console.warn('å¾Œç«¯åˆªé™¤APIä¸å­˜åœ¨æˆ–å¤±æ•—ï¼Œåƒ…å¾å‰ç«¯ç§»é™¤');
            }
          }
          
          // å¦‚æœå¾Œç«¯æ²’æœ‰APIæˆ–åˆªé™¤å¤±æ•—ï¼Œåƒ…å¾å‰ç«¯ç§»é™¤è©²é …ç›®
          const topicItem = document.querySelector(`[data-topic-id="${genId}"]`) || 
                           document.querySelector(`.topic-item:has([onclick*="${genId}"])`);
          
          if (topicItem) {
            topicItem.remove();
            showToast('é¸é¡Œè¨˜éŒ„å·²å¾åˆ—è¡¨ä¸­ç§»é™¤', 3000);
          } else {
            // å¦‚æœæ‰¾ä¸åˆ°å…ƒç´ ï¼Œé‡æ–°è¼‰å…¥åˆ—è¡¨
            await loadTopicHistoryForUserDB();
            showToast('é¸é¡Œè¨˜éŒ„å·²åˆªé™¤', 3000);
          }
        } catch (error) {
          console.error('Delete topic record error:', error);
          // å³ä½¿å‡ºéŒ¯ï¼Œä¹Ÿå˜—è©¦å¾å‰ç«¯ç§»é™¤
          const topicItem = document.querySelector(`[data-topic-id="${genId}"]`) || 
                           document.querySelector(`.topic-item:has([onclick*="${genId}"])`);
          if (topicItem) {
            topicItem.remove();
            showToast('é¸é¡Œè¨˜éŒ„å·²å¾åˆ—è¡¨ä¸­ç§»é™¤', 3000);
          } else {
            showToast('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
          }
        }
      };
      
      // è¼‰å…¥ä½¿ç”¨çµ±è¨ˆ
      async function loadUsageStatsForUserDB() {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          return;
        }
        
        try {
          // ç²å–è…³æœ¬æ•¸
          const scripts = getLocalScripts();
          document.getElementById('totalScripts').textContent = scripts.length;
          
          // ç²å–å¸³è™Ÿå®šä½æ•¸
          const positioningResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${ipPlanningUser.user_id}`, {
            headers: {'Authorization': `Bearer ${ipPlanningToken}`}
          });
          if (positioningResponse.ok) {
            const positioningData = await positioningResponse.json();
            document.getElementById('totalPositioning').textContent = positioningData.records?.length || 0;
          }
          
          // ç²å–å°è©±æ•¸
          const convResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/conversations/${ipPlanningUser.user_id}`, {
            headers: {'Authorization': `Bearer ${ipPlanningToken}`}
          });
          if (convResponse.ok) {
            const convData = await convResponse.json();
            const topicRecords = convData.conversations?.filter(c => c.mode?.includes('é¸é¡Œ') || c.conversation_type === 'topic_selection') || [];
            document.getElementById('totalTopics').textContent = topicRecords.length;
            document.getElementById('totalConversations').textContent = convData.conversations?.length || 0;
          }
        } catch (error) {
          console.error('è¼‰å…¥çµ±è¨ˆå¤±æ•—:', error);
        }
      }
      
      // è¼‰å…¥æˆ‘çš„è¨‚å–®ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      async function loadMyOrdersForUserDB() {
        const content = document.querySelector('#myOrdersContent');
        if (!content) return;
        
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥ä»¥æŸ¥çœ‹è¨‚å–®è¨˜éŒ„</div>';
          return;
        }
        
        // é¡¯ç¤ºè¼‰å…¥å‹•ç•«
        showLoadingAnimation(content, 'è¼‰å…¥è¨‚å–®è¨˜éŒ„ä¸­...');
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/user/orders', {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            const orders = data.orders || [];
            displayOrdersForUserDB(orders);
          } else if (response.status === 401) {
            content.innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          } else {
            const errorData = await response.json().catch(() => ({ error: 'è¼‰å…¥å¤±æ•—' }));
            throw new Error(errorData.error || 'è¼‰å…¥å¤±æ•—');
          }
        } catch (error) {
          console.error('è¼‰å…¥è¨‚å–®å¤±æ•—:', error);
          content.innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
        }
      }
      
      // é¡¯ç¤ºè¨‚å–®åˆ—è¡¨ï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      function displayOrdersForUserDB(orders) {
        const container = document.querySelector('#myOrdersContent');
        if (!container) return;
        
        if (orders.length === 0) {
          container.innerHTML = `
            <div style="text-align: center; padding: 40px;">
              <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“¦</div>
              <p style="color: #6b7280; font-size: 16px; margin-bottom: 24px;">å°šç„¡è¨‚å–®è¨˜éŒ„</p>
              <a href="/subscription.html" style="display: inline-block; padding: 12px 24px; background: #3B82F6; color: white; border-radius: 8px; text-decoration: none; font-weight: 600;">
                å‰å¾€è¨‚é–±
              </a>
            </div>
          `;
          return;
        }
        
        // æŒ‰æ™‚é–“æ’åºï¼šç”±æ–°åˆ°èˆŠ
        const sortedOrders = [...orders].sort((a, b) => {
          const timeA = new Date(a.created_at || 0).getTime();
          const timeB = new Date(b.created_at || 0).getTime();
          return timeB - timeA; // é™åºï¼šæ–°çš„åœ¨å‰
        });
        
        container.innerHTML = `
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden;">
              <thead>
                <tr style="background: #f3f4f6;">
                  <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">è¨‚å–®ç·¨è™Ÿ</th>
                  <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">æ–¹æ¡ˆ</th>
                  <th style="padding: 12px; text-align: right; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">é‡‘é¡</th>
                  <th style="padding: 12px; text-align: center; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">ç‹€æ…‹</th>
                  <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">ä»˜æ¬¾æ™‚é–“</th>
                  <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">åˆ°æœŸæ—¥æœŸ</th>
                  <th style="padding: 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb;">ç™¼ç¥¨è™Ÿç¢¼</th>
                </tr>
              </thead>
              <tbody>
                ${sortedOrders.map(order => {
                  const orderDate = order.created_at ? new Date(order.created_at).toLocaleString('zh-TW', {
                    timeZone: 'Asia/Taipei',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                  }) : '-';
                  
                  const paidDate = order.paid_at ? new Date(order.paid_at).toLocaleString('zh-TW', {
                    timeZone: 'Asia/Taipei',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                  }) : '-';
                  
                  const expiresDate = order.expires_at ? new Date(order.expires_at).toLocaleString('zh-TW', {
                    timeZone: 'Asia/Taipei',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit'
                  }) : '-';
                  
                  const statusBadge = order.payment_status === 'paid' 
                    ? '<span style="display: inline-block; padding: 4px 12px; background: #d1fae5; color: #065f46; border-radius: 12px; font-size: 12px; font-weight: 600;">âœ… å·²ä»˜æ¬¾</span>'
                    : '<span style="display: inline-block; padding: 4px 12px; background: #fee2e2; color: #991b1b; border-radius: 12px; font-size: 12px; font-weight: 600;">â³ å¾…ä»˜æ¬¾</span>';
                  
                  const planText = order.plan_type === 'monthly' ? 'æœˆè²»æ–¹æ¡ˆ' : order.plan_type === 'yearly' ? 'å¹´è²»æ–¹æ¡ˆ' : order.plan_type || '-';
                  
                  return `
                    <tr style="border-bottom: 1px solid #e5e7eb; transition: background-color 0.2s; cursor: pointer;" onclick="showOrderDetail('${order.order_id || order.id}')" onmouseover="this.style.backgroundColor='#f9fafb'" onmouseout="this.style.backgroundColor='transparent'">
                      <td style="padding: 12px; color: #1f2937; font-weight: 500;">${order.order_id || order.id || '-'}</td>
                      <td style="padding: 12px; color: #4b5563;">${planText}</td>
                      <td style="padding: 12px; text-align: right; color: #1f2937; font-weight: 600;">NT$${order.amount?.toLocaleString() || 0}</td>
                      <td style="padding: 12px; text-align: center;">${statusBadge}</td>
                      <td style="padding: 12px; color: #6b7280; font-size: 14px;">${paidDate}</td>
                      <td style="padding: 12px; color: #6b7280; font-size: 14px;">${expiresDate}</td>
                      <td style="padding: 12px; color: #6b7280; font-size: 14px;">${order.invoice_number || '-'}</td>
                    </tr>
                  `;
                }).join('')}
              </tbody>
            </table>
          </div>
        `;
      }
      
      // é¡¯ç¤ºè¨‚å–®è©³æƒ…
      async function showOrderDetail(orderId) {
        if (!ipPlanningToken || !orderId) {
          showToast('ç„¡æ³•è¼‰å…¥è¨‚å–®è©³æƒ…', 3000);
          return;
        }
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/orders/${orderId}`, {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (!response.ok) {
            const errorData = await response.json().catch(() => ({ error: 'è¼‰å…¥å¤±æ•—' }));
            throw new Error(errorData.error || 'è¼‰å…¥è¨‚å–®è©³æƒ…å¤±æ•—');
          }
          
          const data = await response.json();
          const order = data.order;
          
          if (!order) {
            showToast('è¨‚å–®ä¸å­˜åœ¨', 3000);
            return;
          }
          
          // æ ¼å¼åŒ–æ—¥æœŸ
          const formatDate = (dateStr) => {
            if (!dateStr) return '-';
            try {
              return new Date(dateStr).toLocaleString('zh-TW', {
                timeZone: 'Asia/Taipei',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
              });
            } catch (e) {
              return dateStr;
            }
          };
          
          const formatDateOnly = (dateStr) => {
            if (!dateStr) return '-';
            try {
              return new Date(dateStr).toLocaleDateString('zh-TW', {
                timeZone: 'Asia/Taipei',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
              });
            } catch (e) {
              return dateStr;
            }
          };
          
          // ä»˜æ¬¾æ–¹å¼é¡¯ç¤º
          const paymentMethodText = {
            'ecpay': 'ECPay ç¶ ç•Œ',
            'credit': 'ä¿¡ç”¨å¡',
            'atm': 'ATM è½‰å¸³',
            'cvs': 'è¶…å•†ä»£ç¢¼',
            'barcode': 'è¶…å•†æ¢ç¢¼'
          }[order.payment_method] || order.payment_method || '-';
          
          // æ–¹æ¡ˆé¡¯ç¤º
          const planText = order.plan_type === 'monthly' ? 'æœˆè²»æ–¹æ¡ˆ' : 
                          order.plan_type === 'yearly' ? 'å¹´è²»æ–¹æ¡ˆ' : 
                          order.plan_type || '-';
          
          // ç‹€æ…‹é¡¯ç¤º
          const statusText = order.payment_status === 'paid' ? 'âœ… å·²ä»˜æ¬¾' : 
                            order.payment_status === 'pending' ? 'â³ å¾…ä»˜æ¬¾' : 
                            order.payment_status || '-';
          
          const statusColor = order.payment_status === 'paid' ? '#065f46' : 
                             order.payment_status === 'pending' ? '#991b1b' : '#6b7280';
          
          // ç™¼ç¥¨é¡å‹é¡¯ç¤º
          const invoiceTypeText = order.invoice_type === 'personal' ? 'å€‹äºº' : 
                                 order.invoice_type === 'company' ? 'å…¬å¸' : 
                                 order.invoice_type || '-';
          
          // å»ºç«‹è©³æƒ… HTML
          const detailHTML = `
            <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px;" onclick="closeOrderDetail(event)">
              <div style="background: white; border-radius: 16px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
                <div style="padding: 24px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                  <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">ğŸ“‹ è¨‚å–®è©³æƒ…</h2>
                  <button onclick="closeOrderDetail()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 6px; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">Ã—</button>
                </div>
                <div style="padding: 24px;">
                  <div style="display: grid; gap: 20px;">
                    <!-- è¨‚å–®åŸºæœ¬è³‡è¨Š -->
                    <div>
                      <h3 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px;">è¨‚å–®è³‡è¨Š</h3>
                      <div style="display: grid; gap: 12px;">
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">è¨‚å–®ç·¨è™Ÿï¼š</span>
                          <span style="color: #1f2937; font-weight: 600;">${order.order_id || '-'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">æ–¹æ¡ˆé¡å‹ï¼š</span>
                          <span style="color: #1f2937; font-weight: 600;">${planText}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">é‡‘é¡ï¼š</span>
                          <span style="color: #1f2937; font-weight: 700; font-size: 18px;">NT$${order.amount?.toLocaleString() || 0}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">ä»˜æ¬¾ç‹€æ…‹ï¼š</span>
                          <span style="color: ${statusColor}; font-weight: 600;">${statusText}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">ä»˜æ¬¾æ–¹å¼ï¼š</span>
                          <span style="color: #1f2937;">${paymentMethodText}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">å»ºç«‹æ™‚é–“ï¼š</span>
                          <span style="color: #1f2937;">${formatDate(order.created_at)}</span>
                        </div>
                        ${order.paid_at ? `
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">ä»˜æ¬¾æ™‚é–“ï¼š</span>
                          <span style="color: #1f2937;">${formatDate(order.paid_at)}</span>
                        </div>
                        ` : ''}
                        ${order.expires_at ? `
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">åˆ°æœŸæ—¥æœŸï¼š</span>
                          <span style="color: #1f2937;">${formatDateOnly(order.expires_at)}</span>
                        </div>
                        ` : ''}
                      </div>
                    </div>
                    
                    <!-- å¸³å‹™è³‡è¨Š -->
                    ${order.name || order.email || order.phone ? `
                    <div>
                      <h3 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px;">å¸³å‹™è³‡è¨Š</h3>
                      <div style="display: grid; gap: 12px;">
                        ${order.name ? `
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">å§“åï¼š</span>
                          <span style="color: #1f2937;">${order.name}</span>
                        </div>
                        ` : ''}
                        ${order.email ? `
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">Emailï¼š</span>
                          <span style="color: #1f2937;">${order.email}</span>
                        </div>
                        ` : ''}
                        ${order.phone ? `
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">é›»è©±ï¼š</span>
                          <span style="color: #1f2937;">${order.phone}</span>
                        </div>
                        ` : ''}
                      </div>
                    </div>
                    ` : ''}
                    
                    <!-- ç™¼ç¥¨è³‡è¨Š -->
                    ${order.invoice_number || order.invoice_type || order.vat_number ? `
                    <div>
                      <h3 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px;">ç™¼ç¥¨è³‡è¨Š</h3>
                      <div style="display: grid; gap: 12px;">
                        ${order.invoice_type ? `
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">ç™¼ç¥¨é¡å‹ï¼š</span>
                          <span style="color: #1f2937;">${invoiceTypeText}</span>
                        </div>
                        ` : ''}
                        ${order.vat_number ? `
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">çµ±ä¸€ç·¨è™Ÿï¼š</span>
                          <span style="color: #1f2937; font-weight: 600;">${order.vat_number}</span>
                        </div>
                        ` : ''}
                        ${order.invoice_number ? `
                        <div style="display: flex; justify-content: space-between;">
                          <span style="color: #6b7280;">ç™¼ç¥¨è™Ÿç¢¼ï¼š</span>
                          <span style="color: #1f2937; font-weight: 600;">${order.invoice_number}</span>
                        </div>
                        ` : ''}
                      </div>
                    </div>
                    ` : ''}
                    
                    <!-- å‚™è¨» -->
                    ${order.note ? `
                    <div>
                      <h3 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; padding-bottom: 8px;">å‚™è¨»</h3>
                      <p style="margin: 0; color: #1f2937; padding: 12px; background: #f9fafb; border-radius: 8px; white-space: pre-wrap;">${order.note}</p>
                    </div>
                    ` : ''}
                  </div>
                  
                  <!-- æ“ä½œæŒ‰éˆ• -->
                  <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid #e5e7eb; display: flex; gap: 12px; justify-content: flex-end;">
                    <button onclick="closeOrderDetail()" style="padding: 10px 20px; background: #f3f4f6; color: #374151; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">é—œé–‰</button>
                    ${order.payment_status === 'pending' ? `
                    <a href="/subscription.html" style="padding: 10px 20px; background: #3B82F6; color: white; border: none; border-radius: 8px; font-weight: 600; text-decoration: none; display: inline-block; transition: background 0.2s;" onmouseover="this.style.background='#2563EB'" onmouseout="this.style.background='#3B82F6'">å‰å¾€ä»˜æ¬¾</a>
                    ` : ''}
                  </div>
                </div>
              </div>
            </div>
          `;
          
          // é¡¯ç¤ºè©³æƒ…å½ˆçª—
          document.body.insertAdjacentHTML('beforeend', detailHTML);
        } catch (error) {
          console.error('è¼‰å…¥è¨‚å–®è©³æƒ…å¤±æ•—:', error);
          showToast(error.message || 'è¼‰å…¥è¨‚å–®è©³æƒ…å¤±æ•—', 3000);
        }
      }
      
      // é—œé–‰è¨‚å–®è©³æƒ…
      function closeOrderDetail(event) {
        if (event && event.target !== event.currentTarget) {
          return; // é»æ“Šå…§å®¹å€åŸŸä¸é—œé–‰
        }
        const modal = document.querySelector('[style*="z-index: 10000"]');
        if (modal) {
          modal.remove();
        }
      }
      
      // åŒ¯å‡ºç”¨æˆ¶è³‡æ–™ï¼ˆCSV æ ¼å¼ï¼‰
      async function exportUserData() {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        try {
          showToast('æ­£åœ¨åŒ¯å‡ºè³‡æ–™...', 3000);
          
          // æ”¶é›†æ‰€æœ‰ç”¨æˆ¶æ•¸æ“š
          const allData = {
            scripts: [],
            positioning: [],
            topics: [],
            conversations: []
          };
          
          // 1. ç²å–è…³æœ¬æ•¸æ“š
          try {
            const scriptsResponse = await fetch(`https://aivideobackend.zeabur.app/api/scripts/my`, {
              headers: { 'Authorization': `Bearer ${ipPlanningToken}` }
            });
            if (scriptsResponse.ok) {
              const scriptsData = await scriptsResponse.json();
              allData.scripts = scriptsData.scripts || [];
            }
          } catch (e) {
            console.warn('ç²å–è…³æœ¬å¤±æ•—:', e);
          }
          
          // 2. ç²å–å¸³è™Ÿå®šä½æ•¸æ“š
          try {
            const positioningResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/positioning/${ipPlanningUser.user_id}`, {
              headers: { 'Authorization': `Bearer ${ipPlanningToken}` }
            });
            if (positioningResponse.ok) {
              const positioningData = await positioningResponse.json();
              allData.positioning = positioningData.records || [];
            }
          } catch (e) {
            console.warn('ç²å–å¸³è™Ÿå®šä½å¤±æ•—:', e);
          }
          
          // 3. ç²å–é¸é¡Œæ•¸æ“š
          try {
            const generationsResponse = await fetch(`https://aivideobackend.zeabur.app/api/generations/${ipPlanningUser.user_id}`, {
              headers: { 'Authorization': `Bearer ${ipPlanningToken}` }
            });
            if (generationsResponse.ok) {
              const generationsData = await generationsResponse.json();
              allData.topics = generationsData.generations || [];
            }
          } catch (e) {
            console.warn('ç²å–é¸é¡Œæ•¸æ“šå¤±æ•—:', e);
          }
          
          // 4. ç²å–å°è©±æ•¸æ“š
          try {
            const convResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/conversations/${ipPlanningUser.user_id}`, {
              headers: { 'Authorization': `Bearer ${ipPlanningToken}` }
            });
            if (convResponse.ok) {
              const convData = await convResponse.json();
              allData.conversations = convData.conversations || [];
            }
          } catch (e) {
            console.warn('ç²å–å°è©±æ•¸æ“šå¤±æ•—:', e);
          }
          
          // ç”Ÿæˆ CSV å…§å®¹
          const csvContent = generateUserDataCSV(allData, ipPlanningUser);
          
          // ä¸‹è¼‰ CSV
          const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
          const timestamp = new Date().toISOString().split('T')[0];
          a.download = `aijob_user_data_${timestamp}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
          showToast('è³‡æ–™å·²åŒ¯å‡ºç‚º CSV æª”æ¡ˆ', 3000);
        } catch (error) {
          console.error('åŒ¯å‡ºè³‡æ–™å¤±æ•—:', error);
          showToast('åŒ¯å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // ç”Ÿæˆç”¨æˆ¶æ•¸æ“š CSV
      function generateUserDataCSV(data, userInfo) {
        const rows = [];
        
        // CSV æ¨™é¡Œè¡Œ
        rows.push('è³‡æ–™é¡å‹,ID,ç·¨è™Ÿ,æ¨™é¡Œ/ä¸»é¡Œ,å…§å®¹é è¦½,å¹³å°,å‰µå»ºæ™‚é–“\n');
        
        // è…³æœ¬æ•¸æ“š
        data.scripts.forEach(script => {
          const title = (script.title || script.script_name || 'æœªå‘½å').replace(/"/g, '""');
          const content = (script.content || '').substring(0, 100).replace(/"/g, '""').replace(/\n/g, ' ');
          const platform = (script.platform || '').replace(/"/g, '""');
          const createdAt = formatTaiwanTime(script.created_at || '').split(' ')[0];
          rows.push(`è…³æœ¬,${script.id || ''},${script.id || ''},"${title}","${content}","${platform}",${createdAt}\n`);
        });
        
        // å¸³è™Ÿå®šä½æ•¸æ“š
        data.positioning.forEach(record => {
          const content = (record.content || '').substring(0, 100).replace(/"/g, '""').replace(/\n/g, ' ');
          const createdAt = formatTaiwanTime(record.created_at || '').split(' ')[0];
          rows.push(`å¸³è™Ÿå®šä½,${record.id || ''},${record.record_number || ''},"","${content}","",${createdAt}\n`);
        });
        
        // é¸é¡Œæ•¸æ“š
        data.topics.forEach(topic => {
          const topicName = (topic.topic || '').replace(/"/g, '""');
          const content = (topic.content || '').substring(0, 100).replace(/"/g, '""').replace(/\n/g, ' ');
          const platform = (topic.platform || '').replace(/"/g, '""');
          const createdAt = formatTaiwanTime(topic.created_at || '').split(' ')[0];
          rows.push(`é¸é¡Œ,${topic.id || ''},${topic.id || ''},"${topicName}","${content}","${platform}",${createdAt}\n`);
        });
        
        // å°è©±æ•¸æ“š
        data.conversations.forEach(conv => {
          const summary = (conv.summary || '').substring(0, 100).replace(/"/g, '""').replace(/\n/g, ' ');
          const createdAt = formatTaiwanTime(conv.created_at || '').split(' ')[0];
          rows.push(`å°è©±,${conv.id || ''},${conv.id || ''},"${conv.conversation_type || ''}","${summary}","",${createdAt}\n`);
        });
        
        return rows.join('');
      }
      
      // æ¸…é™¤æœ¬åœ°å¿«å–
      function clearUserData() {
        if (!confirm('ç¢ºå®šè¦æ¸…é™¤æœ¬åœ°å¿«å–å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
          return;
        }
        
        // æ¸…é™¤æœ¬åœ°å­˜å„²ï¼ˆä¿ç•™ç™»å…¥ä¿¡æ¯ï¼‰
        const token = localStorage.getItem('ipPlanningToken');
        const user = localStorage.getItem('ipPlanningUser');
        
        localStorage.clear();
        
        // æ¢å¾©ç™»å…¥ä¿¡æ¯
        if (token) localStorage.setItem('ipPlanningToken', token);
        if (user) localStorage.setItem('ipPlanningUser', user);
        
        showToast('æœ¬åœ°å¿«å–å·²æ¸…é™¤', 3000);
        
        // é‡æ–°è¼‰å…¥é é¢
        setTimeout(() => {
          location.reload();
        }, 1000);
      }
      
      // ===== é¡¯ç¤ºåå¥½åŠŸèƒ½ =====
      
      // è¼‰å…¥é¡¯ç¤ºåå¥½
      function loadDisplayPreferences() {
        try {
          const theme = localStorage.getItem('user_theme') || 'light';
          const language = localStorage.getItem('user_language') || 'zh-TW';
          
          const themeSelect = document.getElementById('theme');
          const languageSelect = document.getElementById('language');
          
          if (themeSelect) {
            themeSelect.value = theme;
            applyTheme(theme);
          }
          if (languageSelect) {
            languageSelect.value = language;
            applyLanguage(language);
          }
        } catch (error) {
          console.error('è¼‰å…¥é¡¯ç¤ºåå¥½å¤±æ•—:', error);
        }
      }
      
      // ä¿å­˜é¡¯ç¤ºåå¥½
      function saveDisplayPreferences() {
        try {
          const themeSelect = document.getElementById('theme');
          const languageSelect = document.getElementById('language');
          
          if (themeSelect) {
            const theme = themeSelect.value;
            localStorage.setItem('user_theme', theme);
            applyTheme(theme);
          }
          if (languageSelect) {
            const language = languageSelect.value;
            localStorage.setItem('user_language', language);
            applyLanguage(language);
          }
          
          const currentLang = localStorage.getItem('user_language') || 'zh-TW';
          const messages = getLanguageMessages(currentLang);
          showToast(messages.preferencesSaved || 'é¡¯ç¤ºåå¥½å·²ä¿å­˜', 2000);
        } catch (error) {
          console.error('ä¿å­˜é¡¯ç¤ºåå¥½å¤±æ•—:', error);
          showToast('ä¿å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 2000);
        }
      }
      
      // å¥—ç”¨ä¸»é¡Œ
      function applyTheme(theme) {
        try {
          const root = document.documentElement;
          
          // ç§»é™¤ç¾æœ‰ä¸»é¡Œé¡åˆ¥
          root.classList.remove('theme-light', 'theme-dark');
          
          if (theme === 'dark') {
            root.classList.add('theme-dark');
            root.style.colorScheme = 'dark';
          } else if (theme === 'auto') {
            // è‡ªå‹•æ¨¡å¼ï¼šæ ¹æ“šç³»çµ±è¨­å®š
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
              root.classList.add('theme-dark');
              root.style.colorScheme = 'dark';
            } else {
              root.classList.add('theme-light');
              root.style.colorScheme = 'light';
            }
          } else {
            root.classList.add('theme-light');
            root.style.colorScheme = 'light';
          }
        } catch (error) {
          console.error('å¥—ç”¨ä¸»é¡Œå¤±æ•—:', error);
        }
      }
      
      // ===== å¤šèªè¨€åŠŸèƒ½ =====
      
      // èªè¨€åŒ…
      const languagePack = {
        'zh-TW': {
          // è¨­å®šé é¢
          settingsTitle: 'è¨­å®š',
          displayPreferences: 'é¡¯ç¤ºåå¥½',
          theme: 'ä¸»é¡Œ',
          lightMode: 'æ·ºè‰²æ¨¡å¼',
          darkMode: 'æ·±è‰²æ¨¡å¼',
          autoMode: 'è‡ªå‹•',
          language: 'èªè¨€',
          traditionalChinese: 'ç¹é«”ä¸­æ–‡',
          simplifiedChinese: 'ç®€ä½“ä¸­æ–‡',
          english: 'English',
          switchTheme: 'åˆ‡æ›æ·ºè‰²/æ·±è‰²ä¸»é¡Œæ¨¡å¼',
          selectLanguage: 'é¸æ“‡ä»‹é¢é¡¯ç¤ºèªè¨€',
          preferencesSaved: 'é¡¯ç¤ºåå¥½å·²ä¿å­˜',
          saveFailed: 'ä¿å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦',
          // é€šç”¨
          loading: 'è¼‰å…¥ä¸­...',
          save: 'ä¿å­˜',
          cancel: 'å–æ¶ˆ',
          confirm: 'ç¢ºå®š',
          // å°èˆªæ¬„
          home: 'é¦–é ',
          mode1: 'ä¸€éµç”Ÿæˆ',
          mode2: 'AI é¡§å•',
          mode3: 'IPäººè¨­è¦åŠƒ',
          userDB: 'å‰µä½œè€…è³‡æ–™åº«',
          // BYOK
          byokTitle: 'å¤§å‹èªè¨€æ¨¡å‹(LLM) API é‡‘é‘°ç®¡ç†',
          byokDescription: 'ä½¿ç”¨æ‚¨è‡ªå·±çš„ API é‡‘é‘°å¯ä»¥ç²å¾—æ›´é«˜çš„ä½¿ç”¨é¡åº¦å’Œæ›´ç©©å®šçš„æœå‹™',
          selectProvider: 'é¸æ“‡å¤§å‹èªè¨€æ¨¡å‹(LLM) æä¾›å•†',
          apiKey: 'API é‡‘é‘°',
          enterApiKey: 'è¼¸å…¥æ‚¨çš„ API é‡‘é‘°',
          saveKey: 'ä¿å­˜é‡‘é‘°',
          testKey: 'æ¸¬è©¦é‡‘é‘°',
          // æ•¸æ“šç®¡ç†
          dataManagement: 'æ•¸æ“šç®¡ç†',
          exportData: 'åŒ¯å‡ºæˆ‘çš„è³‡æ–™',
          exportDataDesc: 'åŒ¯å‡ºæ‰€æœ‰è…³æœ¬ã€å°è©±ã€å®šä½è¨˜éŒ„ç‚º CSV æª”æ¡ˆ',
          clearCache: 'æ¸…é™¤æœ¬åœ°å¿«å–',
          clearCacheDesc: 'æ¸…é™¤æœ¬åœ°æš«å­˜æ•¸æ“š'
        },
        'zh-CN': {
          settingsTitle: 'è®¾ç½®',
          displayPreferences: 'æ˜¾ç¤ºåå¥½',
          theme: 'ä¸»é¢˜',
          lightMode: 'æµ…è‰²æ¨¡å¼',
          darkMode: 'æ·±è‰²æ¨¡å¼',
          autoMode: 'è‡ªåŠ¨',
          language: 'è¯­è¨€',
          traditionalChinese: 'ç¹é«”ä¸­æ–‡',
          simplifiedChinese: 'ç®€ä½“ä¸­æ–‡',
          english: 'English',
          switchTheme: 'åˆ‡æ¢æµ…è‰²/æ·±è‰²ä¸»é¢˜æ¨¡å¼',
          selectLanguage: 'é€‰æ‹©ç•Œé¢æ˜¾ç¤ºè¯­è¨€',
          preferencesSaved: 'æ˜¾ç¤ºåå¥½å·²ä¿å­˜',
          saveFailed: 'ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åå†è¯•',
          loading: 'åŠ è½½ä¸­...',
          save: 'ä¿å­˜',
          cancel: 'å–æ¶ˆ',
          confirm: 'ç¡®å®š',
          home: 'é¦–é¡µ',
          mode1: 'ä¸€é”®ç”Ÿæˆ',
          mode2: 'AI é¡¾é—®',
          mode3: 'IPäººè®¾è§„åˆ’',
          userDB: 'åˆ›ä½œè€…æ•°æ®åº“',
          byokTitle: 'å¤§å‹èªè¨€æ¨¡å‹(LLM) API å¯†é’¥ç®¡ç†',
          byokDescription: 'ä½¿ç”¨æ‚¨è‡ªå·±çš„ API å¯†é’¥å¯ä»¥è·å¾—æ›´é«˜çš„ä½¿ç”¨é¢åº¦å’Œæ›´ç¨³å®šçš„æœåŠ¡',
          selectProvider: 'é€‰æ‹©å¤§å‹èªè¨€æ¨¡å‹(LLM) æä¾›å•†',
          apiKey: 'API å¯†é’¥',
          enterApiKey: 'è¾“å…¥æ‚¨çš„ API å¯†é’¥',
          saveKey: 'ä¿å­˜å¯†é’¥',
          testKey: 'æµ‹è¯•å¯†é’¥',
          dataManagement: 'æ•°æ®ç®¡ç†',
          exportData: 'å¯¼å‡ºæˆ‘çš„èµ„æ–™',
          exportDataDesc: 'å¯¼å‡ºæ‰€æœ‰è„šæœ¬ã€å¯¹è¯ã€å®šä½è®°å½•ä¸º CSV æ–‡ä»¶',
          clearCache: 'æ¸…é™¤æœ¬åœ°ç¼“å­˜',
          clearCacheDesc: 'æ¸…é™¤æœ¬åœ°æš‚å­˜æ•°æ®'
        },
        'en': {
          settingsTitle: 'Settings',
          displayPreferences: 'Display Preferences',
          theme: 'Theme',
          lightMode: 'Light Mode',
          darkMode: 'Dark Mode',
          autoMode: 'Auto',
          language: 'Language',
          traditionalChinese: 'ç¹é«”ä¸­æ–‡',
          simplifiedChinese: 'ç®€ä½“ä¸­æ–‡',
          english: 'English',
          switchTheme: 'Switch Light/Dark Theme Mode',
          selectLanguage: 'Select Interface Display Language',
          preferencesSaved: 'Display preferences saved',
          saveFailed: 'Save failed, please try again later',
          loading: 'Loading...',
          save: 'Save',
          cancel: 'Cancel',
          confirm: 'Confirm',
          home: 'Home',
          mode1: 'One-Click Generate',
          mode2: 'AI Advisor',
          mode3: 'IP Persona Planning',
          userDB: 'Creator Database',
          byokTitle: 'Large Language Model(LLM) API Key Management',
          byokDescription: 'Using your own API key can get higher usage quotas and more stable services',
          selectProvider: 'Select Large Language Model(LLM) Provider',
          apiKey: 'API Key',
          enterApiKey: 'Enter your API key',
          saveKey: 'Save Key',
          testKey: 'Test Key',
          dataManagement: 'Data Management',
          exportData: 'Export My Data',
          exportDataDesc: 'Export all scripts, conversations, and positioning records as CSV file',
          clearCache: 'Clear Local Cache',
          clearCacheDesc: 'Clear local temporary data'
        }
      };
      
      // ç²å–èªè¨€è¨Šæ¯
      function getLanguageMessages(lang) {
        return languagePack[lang] || languagePack['zh-TW'];
      }
      
      // å¥—ç”¨èªè¨€
      function applyLanguage(language) {
        try {
          const messages = getLanguageMessages(language);
          
          // æ›´æ–°è¨­å®šé é¢æ–‡å­—
          const settingsTitle = document.querySelector('#db-settings .section-title');
          if (settingsTitle) {
            settingsTitle.textContent = `âš™ï¸ ${messages.settingsTitle}`;
          }
          
          // æ›´æ–°é¡¯ç¤ºåå¥½æ¨™é¡Œ
          const allH4s = document.querySelectorAll('#db-settings h4');
          allH4s.forEach(h4 => {
            const text = h4.textContent;
            if (text.includes('é¡¯ç¤ºåå¥½') || text.includes('æ˜¾ç¤ºåå¥½') || text.includes('Display Preferences')) {
              h4.textContent = `ğŸ¨ ${messages.displayPreferences}`;
            }
          });
          
          // æ›´æ–°ä¸»é¡Œé¸é …
          const themeSelect = document.getElementById('theme');
          if (themeSelect) {
            themeSelect.options[0].text = messages.lightMode;
            themeSelect.options[1].text = messages.darkMode;
            themeSelect.options[2].text = messages.autoMode;
            
            // æŸ¥æ‰¾labelï¼ˆåœ¨setting-itemçš„ç¬¬ä¸€å€‹å­å…ƒç´ ï¼‰
            const themeItem = themeSelect.closest('.setting-item');
            if (themeItem) {
              const themeLabel = themeItem.querySelector('label[for="theme"]');
              if (themeLabel) {
                themeLabel.textContent = messages.theme;
              }
              
              // æŸ¥æ‰¾èªªæ˜æ–‡å­—ï¼ˆåœ¨labelä¹‹å¾Œï¼Œselectä¹‹å‰ï¼‰
              const themeDesc = themeSelect.previousElementSibling;
              if (themeDesc && themeDesc.classList.contains('setting-desc')) {
                themeDesc.textContent = messages.switchTheme;
              }
            }
          }
          
          // æ›´æ–°èªè¨€é¸é …
          const langSelect = document.getElementById('language');
          if (langSelect) {
            langSelect.options[0].text = messages.traditionalChinese;
            langSelect.options[1].text = messages.simplifiedChinese;
            langSelect.options[2].text = messages.english;
            
            // æŸ¥æ‰¾labelï¼ˆåœ¨setting-itemçš„ç¬¬ä¸€å€‹å­å…ƒç´ ï¼‰
            const langItem = langSelect.closest('.setting-item');
            if (langItem) {
              const langLabel = langItem.querySelector('label[for="language"]');
              if (langLabel) {
                langLabel.textContent = messages.language;
              }
              
              // æŸ¥æ‰¾èªªæ˜æ–‡å­—ï¼ˆåœ¨labelä¹‹å¾Œï¼Œselectä¹‹å‰ï¼‰
              const langDesc = langSelect.previousElementSibling;
              if (langDesc && langDesc.classList.contains('setting-desc')) {
                langDesc.textContent = messages.selectLanguage;
              }
            }
          }
          
          // æ›´æ–° BYOK èªªæ˜
          const byokTitles = document.querySelectorAll('#db-settings h4');
          byokTitles.forEach(title => {
            const text = title.textContent;
            if (text.includes('å¤§å‹èªè¨€æ¨¡å‹') || text.includes('å¤§å‹è¯­è¨€æ¨¡å‹') || text.includes('Large Language Model') || 
                text.includes('LLM API') || text.includes('é‡‘é‘°ç®¡ç†') || text.includes('å¯†é’¥ç®¡ç†') || text.includes('Key Management')) {
              title.textContent = `ğŸ”‘ ${messages.byokTitle}`;
            }
          });
          
          const byokDesc = document.querySelector('#db-settings p');
          if (byokDesc && (byokDesc.textContent.includes('ä½¿ç”¨æ‚¨è‡ªå·±çš„') || byokDesc.textContent.includes('ä½¿ç”¨ä½ è‡ªå·±çš„') || byokDesc.textContent.includes('Using your own'))) {
            byokDesc.textContent = messages.byokDescription;
          }
          
          // æ›´æ–°å…¶ä»–å…ƒç´ 
          updatePageLanguage(messages);
          
        } catch (error) {
          console.error('å¥—ç”¨èªè¨€å¤±æ•—:', error);
        }
      }
      
      // æ›´æ–°é é¢èªè¨€
      function updatePageLanguage(messages) {
        // æ›´æ–°æ‰€æœ‰å¸¶æœ‰ data-i18n å±¬æ€§çš„å…ƒç´ 
        document.querySelectorAll('[data-i18n]').forEach(element => {
          const key = element.getAttribute('data-i18n');
          if (messages[key]) {
            element.textContent = messages[key];
          }
        });
      }
      
      // ç›£è½ç³»çµ±ä¸»é¡Œè®ŠåŒ–ï¼ˆè‡ªå‹•æ¨¡å¼ï¼‰
      if (window.matchMedia) {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
          const theme = localStorage.getItem('user_theme') || 'light';
          if (theme === 'auto') {
            applyTheme('auto');
          }
        });
      }
      
      // é é¢è¼‰å…¥æ™‚å¥—ç”¨ä¸»é¡Œå’Œèªè¨€
      function initializeDisplayPreferences() {
        const theme = localStorage.getItem('user_theme') || 'light';
        const language = localStorage.getItem('user_language') || 'zh-TW';
        applyTheme(theme);
        applyLanguage(language);
      }
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeDisplayPreferences);
      } else {
        initializeDisplayPreferences();
      }
      
      // ===== BYOK (Bring Your Own Key) åŠŸèƒ½ =====
      
      // è¼‰å…¥å·²ä¿å­˜çš„ API Keyï¼ˆåƒ…é¡¯ç¤ºæœ€å¾Œ4ä½ï¼‰
      async function loadSavedApiKey() {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          return;
        }
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/llm-keys/${ipPlanningUser.user_id}`, {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            const savedKeyDisplay = document.getElementById('savedKeyDisplay');
            const savedKeyLast4 = document.getElementById('savedKeyLast4');
            const llmProvider = document.getElementById('llmProvider');
            
            if (data.keys && data.keys.length > 0) {
              // é¡¯ç¤ºå·²ä¿å­˜çš„é‡‘é‘°ï¼ˆåªé¡¯ç¤ºæœ€å¾Œ4ä½ï¼‰
              const key = data.keys[0]; // å‡è¨­æ¯å€‹æä¾›å•†åªæœ‰ä¸€å€‹é‡‘é‘°
              if (key.provider) {
                llmProvider.value = key.provider;
              }
              if (key.last4) {
                savedKeyLast4.textContent = `****${key.last4}`;
                savedKeyDisplay.style.display = 'block';
              }
            }
          }
        } catch (error) {
          console.error('è¼‰å…¥å·²ä¿å­˜çš„ API Key å¤±æ•—:', error);
          // ä¸é¡¯ç¤ºéŒ¯èª¤ï¼Œå› ç‚ºå¯èƒ½æ˜¯é¦–æ¬¡ä½¿ç”¨
        }
      }
      
      // ä¿å­˜ API Key
      async function saveApiKey() {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        const apiKey = document.getElementById('llmApiKey').value.trim();
        const provider = document.getElementById('llmProvider').value;
        
        if (!apiKey) {
          showToast('è«‹è¼¸å…¥ API é‡‘é‘°', 3000);
          return;
        }
        
        // åŸºæœ¬é©—è­‰
        if (provider === 'gemini' && !apiKey.startsWith('AI')) {
          if (!confirm('Gemini API Key é€šå¸¸ä»¥ "AI" é–‹é ­ï¼Œæ‚¨ç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ')) {
            return;
          }
        }
        
        if (provider === 'openai' && !apiKey.startsWith('sk-')) {
          if (!confirm('OpenAI API Key é€šå¸¸ä»¥ "sk-" é–‹é ­ï¼Œæ‚¨ç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ')) {
            return;
          }
        }
        
        try {
          showToast('æ­£åœ¨ä¿å­˜é‡‘é‘°...', 2000);
          
          const response = await fetch('https://aivideobackend.zeabur.app/api/user/llm-keys', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              user_id: ipPlanningUser.user_id,
              provider: provider,
              api_key: apiKey
            })
          });
          
          if (response.ok) {
            const result = await response.json();
            showToast('âœ… API é‡‘é‘°å·²å®‰å…¨ä¿å­˜', 3000);
            
            // æ¸…ç©ºè¼¸å…¥æ¡†
            document.getElementById('llmApiKey').value = '';
            
            // æ›´æ–°é¡¯ç¤º
            await loadSavedApiKey();
          } else if (response.status === 401) {
            showToast('è«‹å…ˆç™»å…¥', 3000);
          } else {
            const errorData = await response.json();
            showToast(`ä¿å­˜å¤±æ•—: ${errorData.error || 'æœªçŸ¥éŒ¯èª¤'}`, 3000);
          }
        } catch (error) {
          console.error('ä¿å­˜ API Key éŒ¯èª¤:', error);
          showToast('ä¿å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // æ¸¬è©¦ API Key
      async function testApiKey() {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        const apiKey = document.getElementById('llmApiKey').value.trim();
        const provider = document.getElementById('llmProvider').value;
        const testResultDiv = document.getElementById('testKeyResult');
        
        if (!apiKey) {
          showToast('è«‹å…ˆè¼¸å…¥ API é‡‘é‘°', 3000);
          testResultDiv.style.display = 'none';
          return;
        }
        
        // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        testResultDiv.style.display = 'block';
        testResultDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 8px;">
            <div class="spinner" style="width: 16px; height: 16px; border: 2px solid #e5e7eb; border-top-color: #3b82f6; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            <span style="color: #6b7280;">æ­£åœ¨æ¸¬è©¦é‡‘é‘°...</span>
          </div>
        `;
        testResultDiv.style.background = '#f3f4f6';
        testResultDiv.style.border = '1px solid #e5e7eb';
        testResultDiv.style.color = '#6b7280';
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/user/llm-keys/test', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              provider: provider,
              api_key: apiKey
            })
          });
          
          if (response.ok) {
            const result = await response.json();
            if (result.valid) {
              // æ¸¬è©¦æˆåŠŸ
              testResultDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px;">
                  <span style="color: #10b981; font-size: 18px;">âœ…</span>
                  <div>
                    <div style="font-weight: 500; color: #10b981; margin-bottom: 4px;">API é‡‘é‘°æ¸¬è©¦æˆåŠŸ</div>
                    <div style="color: #6b7280; font-size: 13px;">${result.message || 'é‡‘é‘°æœ‰æ•ˆï¼Œå¯ä»¥ä½¿ç”¨'}</div>
                  </div>
                </div>
              `;
              testResultDiv.style.background = '#ecfdf5';
              testResultDiv.style.border = '1px solid #10b981';
              showToast('âœ… API é‡‘é‘°æ¸¬è©¦æˆåŠŸï¼Œé‡‘é‘°æœ‰æ•ˆï¼', 3000);
            } else {
              // æ¸¬è©¦å¤±æ•—
              testResultDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px;">
                  <span style="color: #ef4444; font-size: 18px;">âŒ</span>
                  <div>
                    <div style="font-weight: 500; color: #ef4444; margin-bottom: 4px;">API é‡‘é‘°æ¸¬è©¦å¤±æ•—</div>
                    <div style="color: #6b7280; font-size: 13px;">${result.error || 'é‡‘é‘°ç„¡æ•ˆï¼Œè«‹æª¢æŸ¥æ˜¯å¦æ­£ç¢º'}</div>
                  </div>
                </div>
              `;
              testResultDiv.style.background = '#fef2f2';
              testResultDiv.style.border = '1px solid #ef4444';
              showToast('âŒ API é‡‘é‘°æ¸¬è©¦å¤±æ•—: ' + (result.error || 'é‡‘é‘°ç„¡æ•ˆ'), 3000);
            }
          } else {
            const errorData = await response.json();
            testResultDiv.innerHTML = `
              <div style="display: flex; align-items: center; gap: 8px;">
                <span style="color: #ef4444; font-size: 18px;">âŒ</span>
                <div>
                  <div style="font-weight: 500; color: #ef4444; margin-bottom: 4px;">æ¸¬è©¦å¤±æ•—</div>
                  <div style="color: #6b7280; font-size: 13px;">${errorData.error || 'æœªçŸ¥éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦'}</div>
                </div>
              </div>
            `;
            testResultDiv.style.background = '#fef2f2';
            testResultDiv.style.border = '1px solid #ef4444';
            showToast(`æ¸¬è©¦å¤±æ•—: ${errorData.error || 'æœªçŸ¥éŒ¯èª¤'}`, 3000);
          }
        } catch (error) {
          console.error('æ¸¬è©¦ API Key éŒ¯èª¤:', error);
          testResultDiv.innerHTML = `
            <div style="display: flex; align-items: center; gap: 8px;">
              <span style="color: #ef4444; font-size: 18px;">âŒ</span>
              <div>
                <div style="font-weight: 500; color: #ef4444; margin-bottom: 4px;">æ¸¬è©¦å¤±æ•—</div>
                <div style="color: #6b7280; font-size: 13px;">ç¶²è·¯éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥é€£ç·šå¾Œå†è©¦</div>
              </div>
            </div>
          `;
          testResultDiv.style.background = '#fef2f2';
          testResultDiv.style.border = '1px solid #ef4444';
          showToast('æ¸¬è©¦å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // åˆ‡æ› API Key é¡¯ç¤º/éš±è—
      function toggleApiKeyVisibility() {
        const apiKeyInput = document.getElementById('llmApiKey');
        const toggleIcon = document.getElementById('toggleKeyIcon');
        
        if (apiKeyInput.type === 'password') {
          apiKeyInput.type = 'text';
          toggleIcon.textContent = 'ğŸ™ˆ';
        } else {
          apiKeyInput.type = 'password';
          toggleIcon.textContent = 'ğŸ‘ï¸';
        }
      }
      
      // æ¸…é™¤å·²ä¿å­˜çš„ API Key
      async function clearSavedApiKey() {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        const provider = document.getElementById('llmProvider').value;
        
        if (!confirm(`ç¢ºå®šè¦æ¸…é™¤ ${provider === 'gemini' ? 'Google Gemini' : 'OpenAI'} çš„ API é‡‘é‘°å—ï¼Ÿ`)) {
          return;
        }
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/user/llm-keys/${ipPlanningUser.user_id}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              provider: provider
            })
          });
          
          if (response.ok) {
            showToast('âœ… API é‡‘é‘°å·²æ¸…é™¤', 3000);
            
            // æ›´æ–°é¡¯ç¤º
            document.getElementById('savedKeyDisplay').style.display = 'none';
            document.getElementById('llmApiKey').value = '';
          } else {
            const errorData = await response.json();
            showToast(`æ¸…é™¤å¤±æ•—: ${errorData.error || 'æœªçŸ¥éŒ¯èª¤'}`, 3000);
          }
        } catch (error) {
          console.error('æ¸…é™¤ API Key éŒ¯èª¤:', error);
          showToast('æ¸…é™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // çµæœå€å¡ŠåŠŸèƒ½
      function updateResultBlock(blockId, content, hasContent = true) {
        const block = document.getElementById(blockId);
        if (block) {
          block.textContent = content;
          if (hasContent) {
            block.classList.add('has-content');
          } else {
            block.classList.remove('has-content');
          }
        }
      }
      
      // æ¨™ç±¤åˆ‡æ›åŠŸèƒ½
      function switchTab(tabName) {
        // ç§»é™¤æ‰€æœ‰æ¨™ç±¤çš„ active é¡åˆ¥
        document.querySelectorAll('.result-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        
        // éš±è—æ‰€æœ‰çµæœå…§å®¹
        document.querySelectorAll('.result-content').forEach(content => {
          content.style.display = 'none';
        });
        
        // æ¿€æ´»é¸ä¸­çš„æ¨™ç±¤
        const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
        if (activeTab) {
          activeTab.classList.add('active');
        }
        
        // é¡¯ç¤ºå°æ‡‰çš„çµæœå…§å®¹
        let contentId = '';
        if (tabName === 'positioning') {
          contentId = 'positioningResult';
        } else if (tabName === 'topics') {
          contentId = 'topicSelectionResult';
        } else if (tabName === 'script') {
          contentId = 'scriptResult';
        }
        
        const activeContent = document.getElementById(contentId);
        if (activeContent) {
          activeContent.style.display = 'block';
        }
      }
      
      // æ·»åŠ èŠå¤©è¨Šæ¯ï¼ˆå¥—ç”¨IPæ¨¡å¼è¨­è¨ˆï¼‰
      function addMessage(content, isUser = false) {
        const chatMessages = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
        
        // æ·»åŠ é ­åƒ
        const avatar = document.createElement('div');
        avatar.className = 'message-avatar';
        
        if (isUser) {
          // ç”¨æˆ¶é ­åƒï¼šä½¿ç”¨ Gmail é ­åƒæˆ–é»˜èªé ­åƒ
          const userAvatarImg = document.getElementById('userAvatar');
          if (userAvatarImg && userAvatarImg.src && userAvatarImg.src !== '') {
            const img = document.createElement('img');
            img.src = userAvatarImg.src;
            img.alt = 'ç”¨æˆ¶é ­åƒ';
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.borderRadius = '50%';
            img.style.objectFit = 'cover';
            avatar.appendChild(img);
          } else {
            avatar.textContent = 'ğŸ‘¤';
          }
        } else {
          // AI é ­åƒï¼šä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿ
          avatar.textContent = 'ğŸ¤–';
        }
        
        messageDiv.appendChild(avatar);
        
        // æ·»åŠ è¨Šæ¯å…§å®¹
        const messageContent = document.createElement('div');
        messageContent.className = 'message-content';
        
        // å¦‚æœæ˜¯ AI å›è¦†ï¼Œæ¸…ç† Markdown æ ¼å¼
        if (!isUser) {
          const cleanText = cleanMarkdownFormat(content);
          messageContent.innerHTML = cleanText;
        } else {
          messageContent.textContent = content;
        }
        
        messageDiv.appendChild(messageContent);
        chatMessages.appendChild(messageDiv);
        
        // ç¢ºä¿æ»¾å‹•åˆ°åº•éƒ¨ï¼Œè€ƒæ…®åˆ°åº•éƒ¨å›ºå®šå…ƒç´ çš„é«˜åº¦
        setTimeout(() => {
        chatMessages.scrollTop = chatMessages.scrollHeight;
          // å†æ¬¡æ»¾å‹•ç¢ºä¿åˆ°é”æ­£ç¢ºä½ç½®
          setTimeout(() => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 50);
        }, 10);
        
        // é€šç”¨æ»¾å‹•è™•ç†ï¼šç¢ºä¿æ»¾å‹•åˆ°å®Œå…¨å¯è¦‹çš„ä½ç½®ï¼ˆé›»è…¦ç‰ˆå’Œæ‰‹æ©Ÿç‰ˆéƒ½é©ç”¨ï¼‰
        setTimeout(() => {
          // ç›´æ¥æ»¾å‹•åˆ°åº•éƒ¨ï¼Œè®“CSSçš„padding-bottomè™•ç†åº•éƒ¨ç©ºé–“
          chatMessages.scrollTop = chatMessages.scrollHeight;
          
          // å†æ¬¡ç¢ºä¿æ»¾å‹•åˆ°æ­£ç¢ºä½ç½®
          setTimeout(() => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 50);
          
          // æœ€çµ‚ç¢ºä¿æ»¾å‹•åˆ°åº•éƒ¨
          setTimeout(() => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 150);
        }, 100);
      }
      
      // ç™¼é€èŠå¤©è¨Šæ¯
      async function sendMessage() {
        const message = messageInput.value.trim();
        if (!message) return;
        
        // æ·»åŠ ç”¨æˆ¶è¨Šæ¯
        addMessage(message, true);
        messageInput.value = '';
        
        // é¡¯ç¤º AI å›è¦†ä¸­çš„è¼‰å…¥ç‹€æ…‹
        const thinkingDiv = document.createElement('div');
        thinkingDiv.className = 'message ai';
        thinkingDiv.id = 'thinking-message';
        
        // æ·»åŠ  AI é ­åƒ
        const avatar = document.createElement('div');
        avatar.className = 'message-avatar';
        avatar.textContent = 'ğŸ¤–';
        thinkingDiv.appendChild(avatar);
        
        // æ·»åŠ è¼‰å…¥å‹•ç•«å…§å®¹
        const messageContent = document.createElement('div');
        messageContent.className = 'message-content';
        
        const loadingDiv = document.createElement('div');
        loadingDiv.className = 'ai-loading';
        loadingDiv.innerHTML = `
          <span>AIæ­£åœ¨æ€è€ƒä¸­</span>
          <div class="ai-loading-dots">
            <div class="ai-loading-dot"></div>
            <div class="ai-loading-dot"></div>
            <div class="ai-loading-dot"></div>
          </div>
        `;
        messageContent.appendChild(loadingDiv);
        thinkingDiv.appendChild(messageContent);
        
        document.getElementById('chatMessages').appendChild(thinkingDiv);
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/chat/stream', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: message,
              platform: platformSelect.value || null,
              topic: topicInput.value || null,
              duration: durationInput.value || '30',
              style: styleInstruction,
              profile: positioningInput.value || null,
              history: [],
              user_id: ipPlanningUser?.user_id || null
            })
          });
          
          if (!response.ok) {
            throw new Error('ç™¼é€å¤±æ•—');
          }
          
          // æº–å‚™æ¥æ”¶ AI å›æ‡‰
          const reader = response.body.getReader();
          let aiResponse = '';
          let aiDiv = null;
          let bubble = null;
          
          let buffer = '';
          
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += new TextDecoder().decode(value, { stream: true });
            
            // è™•ç†å®Œæ•´çš„ JSON è¡Œ
            let idx;
            while ((idx = buffer.indexOf('\n\n')) !== -1) {
              const frame = buffer.slice(0, idx).trim();
              buffer = buffer.slice(idx + 2);
              
              if (!frame.startsWith('data:')) continue;
              
              try {
                const jsonStr = frame.slice(5).trim();
                const data = JSON.parse(jsonStr);
                
                if (data.type === 'token' && data.content) {
                  // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æ”¶åˆ° tokenï¼Œå‰µå»º AI å›æ‡‰ div ä¸¦ç§»é™¤è¼‰å…¥å‹•ç•«
                  if (!aiDiv) {
                    const thinkingMsg = document.getElementById('thinking-message');
                    if (thinkingMsg) {
                      thinkingMsg.remove();
                    }
                    
                    // å‰µå»º AI å›æ‡‰ div
                    aiDiv = document.createElement('div');
                    aiDiv.className = 'msg assistant';
                    aiDiv.id = 'ai-response';
                    
                    // æ·»åŠ  AI é ­åƒ
                    const aiAvatar = document.createElement('div');
                    aiAvatar.className = 'msg-avatar';
                    aiAvatar.textContent = 'ğŸ¤–';
                    aiDiv.appendChild(aiAvatar);
                    
                    // æ·»åŠ æ°£æ³¡
                    bubble = document.createElement('div');
                    bubble.className = 'msg-bubble';
                    aiDiv.appendChild(bubble);
                    
                    document.getElementById('chatMessages').appendChild(aiDiv);
                  }
                  
                  aiResponse += data.content;
                  bubble.innerHTML = cleanMarkdownFormat(aiResponse);
                } else if (data.type === 'end') {
                  // å›æ‡‰çµæŸ
                  // æ–°å¢ï¼šæ™ºèƒ½åˆ¤æ–· AI å›æ‡‰é¡å‹ä¸¦é¡¯ç¤ºåˆ°çµæœå€å¡Š
                  if (aiResponse && ipPlanningUser?.user_id) {
                    detectAndDisplayResult(message, aiResponse);
                  }
                  break;
                }
              } catch (e) {
                // å¿½ç•¥è§£æéŒ¯èª¤
                continue;
              }
            }
            
            document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
          }
        } catch (error) {
          // ç§»é™¤è¼‰å…¥å‹•ç•«ï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
          const thinkingMsg = document.getElementById('thinking-message');
          if (thinkingMsg) {
            thinkingMsg.remove();
          }
          
          addMessage('æŠ±æ­‰ï¼Œç™¼é€å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', false);
        }
      }
      
      // ç”Ÿæˆè…³æœ¬åŠŸèƒ½
      async function generateScript() {
        // å‹•æ…‹æŸ¥æ‰¾è¼¸å…¥å…ƒç´ ï¼Œå„ªå…ˆä½¿ç”¨æ‰‹æ©Ÿç‰ˆ
        const platformEl = document.querySelector('#mode1-mobile-setup #platformSelect') || document.getElementById('platformSelect');
        const topicEl = document.querySelector('#mode1-mobile-setup #topicInput') || document.getElementById('topicInput');
        const positioningEl = document.querySelector('#mode1-mobile-setup #positioningInput') || document.getElementById('positioningInput');
        
        const platform = platformEl ? platformEl.value : '';
        const topic = topicEl ? topicEl.value : '';
        const positioning = positioningEl ? positioningEl.value : '';
        
        // æª¢æŸ¥æ˜¯å¦å·²å®Œæˆå¸³è™Ÿå®šä½å’Œé¸é¡Œï¼ˆåªæª¢æŸ¥æ˜¯å¦ç‚ºé è¨­æç¤ºæ–‡å­—ï¼‰
        const positioningContent = document.getElementById('positioningContent').textContent.trim();
        const topicContent = document.getElementById('topicContent').textContent.trim();
        
        const isPositioningDefault = positioningContent.includes('è«‹é»é¸ã€Œä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½ã€æŒ‰éˆ•é–‹å§‹') || 
                                     positioningContent.includes('é»æ“Šã€Œä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½ã€') || 
                                     positioningContent.includes('é–‹å§‹åˆ†æ');
        const isTopicDefault = topicContent.includes('è«‹é»é¸ã€Œä¸€éµç”Ÿæˆé¸é¡Œã€æŒ‰éˆ•é–‹å§‹') ||
                              topicContent.includes('å®Œæˆå¸³è™Ÿå®šä½') || 
                              topicContent.includes('é€²è¡Œé¸é¡Œ') ||
                              topicContent.includes('é»æ“Šã€Œä¸€éµç”Ÿæˆé¸é¡Œã€');
        
        if (!positioningContent || isPositioningDefault) {
          showToast('è«‹å…ˆå®Œæˆå¸³è™Ÿå®šä½', 3000);
          return;
        }
        
        if (!topicContent || isTopicDefault) {
          showToast('è«‹å…ˆå®Œæˆé¸é¡Œæ¨è–¦', 3000);
          return;
        }
        
        if (!platform) {
          showToast('è«‹å…ˆé¸æ“‡å¹³å°', 3000);
          return;
        }
        
        updateResultBlock('scriptContent', 'æ­£åœ¨ç”Ÿæˆè…³æœ¬...', false);
        
        // ç«‹å³é¡¯ç¤ºæ“ä½œæŒ‰éˆ•
        document.getElementById('scriptActions').style.display = 'flex';
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/generate/script', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: 'è«‹å¹«æˆ‘ç”Ÿæˆå®Œæ•´è…³æœ¬',
              platform: platform,
              topic: topic,
              duration: durationInput.value || '30',
              style: styleInstruction,
              profile: positioning,
              history: [],
              user_id: ipPlanningUser?.user_id || null
            })
          });
          
          if (!response.ok) {
            throw new Error('ç”Ÿæˆå¤±æ•—');
          }
          
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          let buffer = '';
          let result = '';
          
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += decoder.decode(value, { stream: true });
            const lines = buffer.split('\n');
            buffer = lines.pop() || '';
            
            for (const line of lines) {
              if (line.startsWith('data: ')) {
                try {
                  const data = JSON.parse(line.slice(6));
                  if (data.type === 'token' && data.content) {
                    result += data.content;
                    updateResultBlock('scriptContent', result, true);
                  } else if (data.type === 'end') {
                    break;
                  } else if (data.type === 'error') {
                    throw new Error(data.message || 'ç”Ÿæˆå¤±æ•—');
                  }
                } catch (e) {
                  console.error('è§£æéŒ¯èª¤:', e);
                }
              }
            }
          }
          
          // è‡ªå‹•åˆ‡æ›åˆ°è…³æœ¬æ¨™ç±¤
          switchTab('script');
          
        } catch (error) {
          updateResultBlock('scriptContent', 'ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', false);
          showToast('ç”Ÿæˆè…³æœ¬å¤±æ•—', 3000);
        }
      }
      // ä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½
      async function generatePositioning() {
        // å‹•æ…‹æŸ¥æ‰¾è¼¸å…¥å…ƒç´ ï¼Œå„ªå…ˆä½¿ç”¨æ‰‹æ©Ÿç‰ˆ
        const platformEl = document.querySelector('#mode1-mobile-setup #platformSelect') || document.getElementById('platformSelect');
        const topicEl = document.querySelector('#mode1-mobile-setup #topicInput') || document.getElementById('topicInput');
        const positioningEl = document.querySelector('#mode1-mobile-setup #positioningInput') || document.getElementById('positioningInput');
        
        const platform = platformEl ? platformEl.value : '';
        const topic = topicEl ? topicEl.value : '';
        const positioning = positioningEl ? positioningEl.value : '';
        
        if (!platform) {
          showToast('è«‹å…ˆé¸æ“‡å¹³å°', 3000);
          return;
        }
        
        updateResultBlock('positioningContent', 'æ­£åœ¨åˆ†æå¸³è™Ÿå®šä½...', false);
        
        // ç«‹å³é¡¯ç¤ºæ“ä½œæŒ‰éˆ•
        document.getElementById('positioningActions').style.display = 'flex';
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/generate/positioning', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: 'è«‹å¹«æˆ‘é€²è¡Œå¸³è™Ÿå®šä½åˆ†æ',
              platform: platform,
              topic: topic,
              duration: '30',
              style: styleInstruction,
              profile: positioning,
              history: [],
              user_id: ipPlanningUser?.user_id || null
            })
          });
          
          if (!response.ok) {
            throw new Error('ç”Ÿæˆå¤±æ•—');
          }
          
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          let buffer = '';
          let result = '';
          
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += decoder.decode(value, { stream: true });
            const lines = buffer.split('\n');
            buffer = lines.pop() || '';
            
            for (const line of lines) {
              if (line.startsWith('data: ')) {
                try {
                  const data = JSON.parse(line.slice(6));
                  if (data.type === 'token' && data.content) {
                    result += data.content;
                    updateResultBlock('positioningContent', result, true);
                  } else if (data.type === 'end') {
                    break;
                  } else if (data.type === 'error') {
                    throw new Error(data.message || 'ç”Ÿæˆå¤±æ•—');
                  }
                } catch (e) {
                  console.error('è§£æéŒ¯èª¤:', e);
                }
              }
            }
          }
          
          // è‡ªå‹•åˆ‡æ›åˆ°å¸³è™Ÿå®šä½æ¨™ç±¤
          switchTab('positioning');
          
          // è‡ªå‹•ä¿å­˜å¸³è™Ÿå®šä½åˆ°å¾Œç«¯
          if (result && ipPlanningToken && ipPlanningUser) {
            try {
              const saveResponse = await fetch('https://aivideobackend.zeabur.app/api/user/positioning/save', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${ipPlanningToken}`
                },
                body: JSON.stringify({
                  user_id: ipPlanningUser.user_id,
                  content: result
                })
              });
              
              if (saveResponse.ok) {
                const saveData = await saveResponse.json();
                showToast(`å¸³è™Ÿå®šä½å·²è‡ªå‹•å„²å­˜ï¼ˆç·¨è™Ÿï¼š${saveData.record_number}ï¼‰`, 2000);
              }
            } catch (saveError) {
              console.error('è‡ªå‹•å„²å­˜å¤±æ•—:', saveError);
            }
          }
          
        } catch (error) {
          updateResultBlock('positioningContent', 'ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', false);
          showToast('ç”Ÿæˆå¸³è™Ÿå®šä½å¤±æ•—', 3000);
        }
      }
      
      // æ™ºèƒ½åˆ¤æ–· AI å›æ‡‰é¡å‹ä¸¦é¡¯ç¤ºåˆ°çµæœå€å¡Š
      function detectAndDisplayResult(userMessage, aiResponse) {
        // åˆ¤æ–·æ˜¯å¦ç‚ºæ˜ç¢ºçš„å¸³è™Ÿå®šä½ç¸½çµ
        const isPositioningSummary = aiResponse.includes('ğŸ“Œ ä½ çš„å¸³è™Ÿå®šä½å»ºè­°') ||
                                     aiResponse.includes('å¸³è™Ÿå®šä½å»ºè­°ï¼š') ||
                                     aiResponse.includes('å®šä½ç¸½çµï¼š') ||
                                     (aiResponse.includes('å®šä½å»ºè­°') && aiResponse.length > 200);
        
        // åˆ¤æ–·æ˜¯å¦ç‚ºæ˜ç¢ºçš„é¸é¡Œæ¨è–¦çµæœ
        const isTopicsSummary = aiResponse.includes('ğŸ“Œ é¸é¡Œæ¨è–¦') ||
                               aiResponse.includes('é¸é¡Œå»ºè­°ï¼š') ||
                               aiResponse.includes('æ¨è–¦é¸é¡Œï¼š') ||
                               (aiResponse.includes('é¸é¡Œ') && 
                                (aiResponse.includes('1.') || aiResponse.includes('ä¸€ã€')) &&
                                aiResponse.length > 200);
        
        // åˆ¤æ–·æ˜¯å¦ç‚ºå®Œæ•´è…³æœ¬ï¼ˆå¿…é ˆåŒ…å«çµæ§‹åŒ–å…§å®¹ï¼‰
        const isCompletScript = (aiResponse.includes('Hook') || aiResponse.includes('é–‹å ´')) && 
                               (aiResponse.includes('Value') || aiResponse.includes('æ ¸å¿ƒ')) && 
                               (aiResponse.includes('CTA') || aiResponse.includes('è¡Œå‹•å‘¼ç±²')) &&
                               aiResponse.length > 300;
        
        // æ ¹æ“šåˆ¤æ–·çµæœé¡¯ç¤ºåˆ°å°æ‡‰å€å¡Šï¼ˆåªé¡¯ç¤ºæ˜ç¢ºçš„ç¸½çµ/çµæœï¼‰
        if (isCompletScript) {
          // å®Œæ•´è…³æœ¬ï¼šé¡¯ç¤ºåˆ°è…³æœ¬å€å¡Š
          updateResultBlock('scriptContent', aiResponse, true);
          document.getElementById('scriptActions').style.display = 'flex';
          switchTab('script');
        } else if (isTopicsSummary) {
          // é¸é¡Œæ¨è–¦ï¼šé¡¯ç¤ºåˆ°é¸é¡Œå€å¡Š
          updateResultBlock('topicContent', aiResponse, true);
          document.getElementById('topicActions').style.display = 'flex';
          switchTab('topics');
        } else if (isPositioningSummary) {
          // å¸³è™Ÿå®šä½ç¸½çµï¼šé¡¯ç¤ºåˆ°å®šä½å€å¡Š
          updateResultBlock('positioningContent', aiResponse, true);
          document.getElementById('positioningActions').style.display = 'flex';
          switchTab('positioning');
        }
        // å¦‚æœéƒ½ä¸ç¬¦åˆï¼ˆä¸€èˆ¬è¨è«–ã€å•ç­”ï¼‰ï¼Œå°±ä¸é¡¯ç¤ºåˆ°çµæœå€ï¼ˆä¿ç•™åœ¨å°è©±æ¡†ä¸­ï¼‰
      }
      
      // ä¸€éµç”Ÿæˆé¸é¡Œ
      async function generateTopics() {
        // å‹•æ…‹æŸ¥æ‰¾è¼¸å…¥å…ƒç´ ï¼Œå„ªå…ˆä½¿ç”¨æ‰‹æ©Ÿç‰ˆ
        const platformEl = document.querySelector('#mode1-mobile-setup #platformSelect') || document.getElementById('platformSelect');
        const topicEl = document.querySelector('#mode1-mobile-setup #topicInput') || document.getElementById('topicInput');
        const positioningEl = document.querySelector('#mode1-mobile-setup #positioningInput') || document.getElementById('positioningInput');
        
        const platform = platformEl ? platformEl.value : '';
        const topic = topicEl ? topicEl.value : '';
        const positioning = positioningEl ? positioningEl.value : '';
        
        // æª¢æŸ¥æ˜¯å¦å·²å®Œæˆå¸³è™Ÿå®šä½ï¼ˆåªæª¢æŸ¥æ˜¯å¦ç‚ºé è¨­æç¤ºæ–‡å­—ï¼‰
        const positioningContent = document.getElementById('positioningContent').textContent.trim();
        const isDefaultText = positioningContent.includes('è«‹é»é¸ã€Œä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½ã€æŒ‰éˆ•é–‹å§‹') ||
                             positioningContent.includes('é»æ“Šã€Œä¸€éµç”Ÿæˆå¸³è™Ÿå®šä½ã€') || 
                             positioningContent.includes('é–‹å§‹åˆ†æ');
        
        if (!positioningContent || isDefaultText) {
          showToast('è«‹å…ˆå®Œæˆå¸³è™Ÿå®šä½', 3000);
          return;
        }
        
        if (!platform) {
          showToast('è«‹å…ˆé¸æ“‡å¹³å°', 3000);
          return;
        }
        
        updateResultBlock('topicContent', 'æ­£åœ¨æ¨è–¦é¸é¡Œ...', false);
        
        // ç«‹å³é¡¯ç¤ºæ“ä½œæŒ‰éˆ•
        document.getElementById('topicActions').style.display = 'flex';
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/generate/topics', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: 'è«‹å¹«æˆ‘æ¨è–¦é¸é¡Œ',
              platform: platform,
              topic: topic,
              duration: '30',
              style: styleInstruction,
              profile: positioning,
              history: [],
              user_id: ipPlanningUser?.user_id || null
            })
          });
          
          if (!response.ok) {
            throw new Error('ç”Ÿæˆå¤±æ•—');
          }
          
          const reader = response.body.getReader();
          const decoder = new TextDecoder();
          let buffer = '';
          let result = '';
          let generationEnded = false;
          
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += decoder.decode(value, { stream: true });
            const lines = buffer.split('\n');
            buffer = lines.pop() || '';
            
            for (const line of lines) {
              if (line.startsWith('data: ')) {
                try {
                  const data = JSON.parse(line.slice(6));
                  if (data.type === 'token' && data.content) {
                    result += data.content;
                    updateResultBlock('topicContent', result, true);
                  } else if (data.type === 'end') {
                    generationEnded = true;
                    break;
                  } else if (data.type === 'error') {
                    throw new Error(data.message || 'ç”Ÿæˆå¤±æ•—');
                  }
                } catch (e) {
                  console.error('è§£æéŒ¯èª¤:', e);
                }
              }
            }
            
            if (generationEnded) break;
          }
          
          // è‡ªå‹•åˆ‡æ›åˆ°é¸é¡Œæ¨™ç±¤
          switchTab('topics');
          
          // è‡ªå‹•ä¿å­˜é¸é¡Œå…§å®¹åˆ° generations è¡¨ï¼ˆç”Ÿæˆå®Œæˆå¾Œï¼‰
          if (generationEnded && result && result.trim() && ipPlanningToken && ipPlanningUser && ipPlanningUser.user_id) {
            try {
              const saveResponse = await fetch('https://aivideobackend.zeabur.app/api/generations', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${ipPlanningToken}`
                },
                body: JSON.stringify({
                  user_id: ipPlanningUser.user_id,
                  content: result,
                  platform: platform,
                  topic: topic || 'é¸é¡Œæ¨è–¦'
                })
              });
              
              if (saveResponse.ok) {
                const saveData = await saveResponse.json();
                console.log('é¸é¡Œå·²è‡ªå‹•å„²å­˜:', saveData);
                // é‡æ–°è¼‰å…¥é¸é¡Œå…§å®¹åˆ—è¡¨ï¼ˆå¦‚æœç”¨æˆ¶åœ¨å‰µä½œè€…è³‡æ–™åº«é é¢ï¼‰
                const topicRecordsSection = document.querySelector('#db-topicRecords');
                if (topicRecordsSection && topicRecordsSection.style.display !== 'none') {
                  loadTopicHistoryForUserDB();
                }
              } else {
                console.warn('é¸é¡Œä¿å­˜å¤±æ•—ï¼Œä½†ä¸å½±éŸ¿ä½¿ç”¨');
              }
            } catch (saveError) {
              console.error('è‡ªå‹•å„²å­˜é¸é¡Œå¤±æ•—:', saveError);
              // éœé»˜å¤±æ•—ï¼Œä¸å½±éŸ¿ç”¨æˆ¶é«”é©—
            }
          }
          
        } catch (error) {
          updateResultBlock('topicContent', 'ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', false);
          showToast('ç”Ÿæˆé¸é¡Œå¤±æ•—', 3000);
        }
      }
      
      // å„²å­˜çµæœ
      async function saveResult(type) {
        if (!ipPlanningUser || !ipPlanningUser.user_id) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        let content = '';
        let contentElement = null;
        
        switch(type) {
          case 'positioning':
            contentElement = document.getElementById('positioningContent');
            break;
          case 'topics':
            contentElement = document.getElementById('topicContent');
            break;
          case 'script':
            contentElement = document.getElementById('scriptContent');
            break;
        }
        
        if (contentElement) {
          content = contentElement.textContent;
          
          // åªæœ‰å¸³è™Ÿå®šä½éœ€è¦ä¿å­˜åˆ°è³‡æ–™åº«
          if (type === 'positioning') {
            try {
              const response = await fetch('https://aivideobackend.zeabur.app/api/user/positioning/save', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${ipPlanningToken}`
                },
                body: JSON.stringify({
                  user_id: ipPlanningUser.user_id,
                  content: content
                })
              });
              
              if (response.ok) {
                const data = await response.json();
                showToast(`å¸³è™Ÿå®šä½å·²å„²å­˜ï¼ˆç·¨è™Ÿï¼š${data.record_number}ï¼‰`, 3000);
                // é‡æ–°è¼‰å…¥å¸³è™Ÿå®šä½åˆ—è¡¨
                await loadPositioningRecords();
              } else {
                throw new Error('å„²å­˜å¤±æ•—');
              }
            } catch (error) {
              console.error('å„²å­˜éŒ¯èª¤:', error);
              showToast('å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
            }
          } else {
            // å…¶ä»–é¡å‹æš«æ™‚å„²å­˜åˆ° localStorage
            localStorage.setItem(`saved_${type}`, content);
            showToast(`${type === 'topics' ? 'é¸é¡Œ' : 'è…³æœ¬'}å·²å„²å­˜`, 2000);
          }
        }
      }
      
      // è…³æœ¬å„²å­˜åŠŸèƒ½
      async function saveScript() {
        if (!ipPlanningUser || !ipPlanningUser.user_id || !ipPlanningToken) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        const content = document.getElementById('scriptContent').textContent;
        if (!content || content.includes('è«‹é»é¸ã€Œä¸€éµç”Ÿæˆè…³æœ¬ã€æŒ‰éˆ•é–‹å§‹') || content.includes('è«‹å…ˆå®Œæˆ')) {
          showToast('æ²’æœ‰å¯å„²å­˜çš„å…§å®¹', 3000);
          return;
        }
        
        console.log('é–‹å§‹å„²å­˜è…³æœ¬...', {
          userId: ipPlanningUser.user_id,
          contentLength: content.length
        });
        
        try {
          // æå–è…³æœ¬å…§å®¹çš„çµæ§‹åŒ–æ•¸æ“š
          const scriptData = extractScriptData(content);
          console.log('æå–çš„è…³æœ¬æ•¸æ“š:', scriptData);
          
          const response = await fetch('https://aivideobackend.zeabur.app/api/scripts/save', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              user_id: ipPlanningUser.user_id,
              content: content,
              script_data: scriptData,
              platform: currentPlatform || 'æœªè¨­å®š',
              topic: currentTopic || 'æœªè¨­å®š',
              profile: currentProfile || 'æœªè¨­å®š'
            })
          });
          
          console.log('è…³æœ¬å„²å­˜éŸ¿æ‡‰ç‹€æ…‹:', response.status);
          
          if (response.ok) {
            const result = await response.json();
            console.log('è…³æœ¬å„²å­˜æˆåŠŸ:', result);
            
            // åŒæ™‚å„²å­˜åˆ°æœ¬åœ°
            const localScriptData = {
              name: scriptData.title || 'æœªå‘½åè…³æœ¬',
              title: scriptData.title || '',
              content: content,
              script_data: scriptData,
              platform: currentPlatform || 'æœªè¨­å®š',
              topic: currentTopic || 'æœªè¨­å®š',
              profile: currentProfile || 'æœªè¨­å®š'
            };
            saveScriptToLocal(localScriptData);
            
            showToast('è…³æœ¬å„²å­˜æˆåŠŸï¼', 3000);
            // å»¶é²ä¸€ä¸‹å†è¼‰å…¥è…³æœ¬åˆ—è¡¨ï¼Œç¢ºä¿å¾Œç«¯è™•ç†å®Œæˆ
            setTimeout(() => {
              loadMyScripts();
              loadMyScriptsForUserDB(); // åŒæ™‚è¼‰å…¥è³‡æ–™åº«é é¢çš„è…³æœ¬
            }, 1000);
          } else if (response.status === 401) {
            console.log('è…³æœ¬å„²å­˜å¤±æ•—: èªè­‰éŒ¯èª¤');
            showToast('è«‹å…ˆç™»å…¥', 3000);
          } else if (response.status === 404) {
            console.log('è…³æœ¬å„²å­˜å¤±æ•—: APIä¸å­˜åœ¨ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜');
            // å¾Œç«¯APIä¸å­˜åœ¨æ™‚ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜
            const localScriptData = {
              name: scriptData.title || 'æœªå‘½åè…³æœ¬',
              title: scriptData.title || '',
              content: content,
              script_data: scriptData,
              platform: currentPlatform || 'æœªè¨­å®š',
              topic: currentTopic || 'æœªè¨­å®š',
              profile: currentProfile || 'æœªè¨­å®š'
            };
            saveScriptToLocal(localScriptData);
            showToast('è…³æœ¬å·²å„²å­˜åˆ°æœ¬åœ°ï¼', 3000);
            setTimeout(() => {
              loadMyScripts();
              loadMyScriptsForUserDB(); // åŒæ™‚è¼‰å…¥è³‡æ–™åº«é é¢çš„è…³æœ¬
            }, 500);
          } else {
            const errorData = await response.json();
            console.log('è…³æœ¬å„²å­˜å¤±æ•—:', errorData);
            throw new Error(errorData.error || 'å„²å­˜å¤±æ•—');
          }
        } catch (error) {
          console.error('Save script error:', error);
          // ç¶²è·¯éŒ¯èª¤æ™‚ï¼Œä¹Ÿä½¿ç”¨æœ¬åœ°å„²å­˜
          console.log('ç¶²è·¯éŒ¯èª¤ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜');
          const localScriptData = {
            name: scriptData.title || 'æœªå‘½åè…³æœ¬',
            title: scriptData.title || '',
            content: content,
            script_data: scriptData,
            platform: currentPlatform || 'æœªè¨­å®š',
            topic: currentTopic || 'æœªè¨­å®š',
            profile: currentProfile || 'æœªè¨­å®š'
          };
          saveScriptToLocal(localScriptData);
          showToast('è…³æœ¬å·²å„²å­˜åˆ°æœ¬åœ°ï¼', 3000);
          setTimeout(() => {
            loadMyScripts();
            loadMyScriptsForUserDB(); // åŒæ™‚è¼‰å…¥è³‡æ–™åº«é é¢çš„è…³æœ¬
          }, 500);
        }
      }
      
      // æå–è…³æœ¬æ•¸æ“š - æŒ‰ç…§è¦ç¯„æ ¼å¼è§£æ
      function extractScriptData(content) {
        console.log('é–‹å§‹è§£æè…³æœ¬å…§å®¹:', content);
        
        try {
          // æ¸…ç†å…§å®¹ï¼Œç§»é™¤HTMLæ¨™ç±¤
          const cleanContent = content.replace(/<[^>]*>/g, '').trim();
          console.log('æ¸…ç†å¾Œçš„å…§å®¹:', cleanContent);
          
          // æŒ‰ç…§è¦ç¯„è§£æè…³æœ¬
          const scriptData = parseScriptToJSON(cleanContent);
          console.log('è§£æçµæœ:', scriptData);
          return scriptData;
          
        } catch (error) {
          console.error('è…³æœ¬è§£æå¤±æ•—:', error);
          return {
            error: "PARSE_FAILED",
            message: "è…³æœ¬æ ¼å¼è§£æå¤±æ•—ï¼Œè«‹æª¢æŸ¥å…§å®¹æ ¼å¼"
          };
        }
      }
      
      // æŒ‰ç…§è¦ç¯„å°‡è…³æœ¬è§£æç‚ºJSONæ ¼å¼
      function parseScriptToJSON(content) {
        const lines = content.split('\n').map(line => line.trim()).filter(line => line);
        
        // 1. æå–ä¸»é¡Œæ¨™é¡Œ
        let title = '';
        for (let line of lines) {
          if (line.includes('ä¸»é¡Œ') || line.includes('æ¨™é¡Œ') || line.match(/^[1-9]\.?\s*[^0-9]/)) {
            title = line.replace(/^[1-9]\.?\s*/, '').replace(/[ï¼š:]\s*/, '').trim();
            break;
          }
        }
        
        // å¦‚æœæ²’æ‰¾åˆ°ä¸»é¡Œï¼Œä½¿ç”¨ç¬¬ä¸€è¡Œ
        if (!title && lines.length > 0) {
          title = lines[0].replace(/^[1-9]\.?\s*/, '').replace(/[ï¼š:]\s*/, '').trim();
        }
        
        // 2. è§£æè…³æœ¬åˆ†æ®µ
        const rows = [];
        let currentSegment = null;
        let valueCount = 0;
        
        for (let i = 0; i < lines.length; i++) {
          const line = lines[i];
          
          // æª¢æŸ¥æ™‚é–“æ¨¡å¼
          const timeMatch = line.match(/(\d+)-(\d+)s?/i);
          if (timeMatch) {
            // ä¿å­˜ä¸Šä¸€å€‹æ®µè½
            if (currentSegment) {
              rows.push(currentSegment);
            }
            
            // é–‹å§‹æ–°æ®µè½
            const startSec = parseInt(timeMatch[1]);
            const endSec = parseInt(timeMatch[2]);
            
            // ç¢ºå®šæ®µè½é¡å‹
            let section = '';
            if (line.toLowerCase().includes('hook')) {
              section = 'Hook';
            } else if (line.toLowerCase().includes('value') || line.toLowerCase().includes('åƒ¹å€¼')) {
              valueCount++;
              section = `Value ${valueCount}`;
            } else if (line.toLowerCase().includes('cta') || line.toLowerCase().includes('è¡Œå‹•å‘¼ç±²')) {
              section = 'CTA';
            } else {
              // æ ¹æ“šæ™‚é–“æ¨æ¸¬æ®µè½é¡å‹
              if (startSec === 0) {
                section = 'Hook';
              } else if (valueCount < 3) {
                valueCount++;
                section = `Value ${valueCount}`;
              } else {
                section = 'CTA';
              }
            }
            
            currentSegment = {
              start_sec: startSec,
              end_sec: endSec,
              section: section,
              shot_desc: '',
              dialogue: '',
              subtitle: '',
              sfx: ''
            };
            
            continue;
          }
          
          // è§£ææ®µè½å…§å®¹
          if (currentSegment) {
            // æª¢æŸ¥æ˜¯å¦ç‚ºå°è©
            if (line.includes('å°è©') || line.includes('å£ç™½') || line.match(/^ã€Œ.*ã€$/) || line.match(/^".*"$/)) {
              currentSegment.dialogue = line.replace(/^[å°è©å£ç™½ï¼š:]\s*/, '').replace(/^["ã€Œ]|["ã€]$/g, '').trim();
            }
            // æª¢æŸ¥æ˜¯å¦ç‚ºé¡é ­æè¿°
            else if (line.includes('é¡é ­') || line.includes('ç•«é¢') || line.includes('CU') || line.includes('MS') || line.includes('LS')) {
              currentSegment.shot_desc = line.replace(/^[é¡é ­ç•«é¢ï¼š:]\s*/, '').trim();
            }
            // æª¢æŸ¥æ˜¯å¦ç‚ºå­—å¹•
            else if (line.includes('å­—å¹•') || line.includes('å¤§å­—å¡')) {
              currentSegment.subtitle = line.replace(/^[å­—å¹•å¤§å­—å¡ï¼š:]\s*/, '').trim();
            }
            // æª¢æŸ¥æ˜¯å¦ç‚ºéŸ³æ•ˆ
            else if (line.includes('éŸ³æ•ˆ') || line.includes('è½‰å ´') || line.includes('éŸ³æ¨‚')) {
              currentSegment.sfx = line.replace(/^[éŸ³æ•ˆè½‰å ´éŸ³æ¨‚ï¼š:]\s*/, '').trim();
            }
            // å¦‚æœæ²’æœ‰æ¨™ç±¤ï¼Œæ ¹æ“šå…§å®¹æ¨æ¸¬
            else if (line.length > 0) {
              // å¦‚æœå°è©ç‚ºç©ºï¼Œå¯èƒ½æ˜¯å°è©
              if (!currentSegment.dialogue) {
                currentSegment.dialogue = line;
              }
              // å¦‚æœé¡é ­æè¿°ç‚ºç©ºï¼Œå¯èƒ½æ˜¯é¡é ­æè¿°
              else if (!currentSegment.shot_desc) {
                currentSegment.shot_desc = line;
              }
            }
          }
        }
        
        // ä¿å­˜æœ€å¾Œä¸€å€‹æ®µè½
        if (currentSegment) {
          rows.push(currentSegment);
        }
        
        // 3. æ’åºä¸¦ç¢ºä¿æ™‚é–“æ­£ç¢º
        rows.sort((a, b) => a.start_sec - b.start_sec);
        
        // 4. æ¸…ç†æ•¸æ“š
        rows.forEach(row => {
          // ç§»é™¤æœ«å°¾ç©ºç™½å’Œæ¨™é»ç¬¦è™Ÿï¼ˆä¿ç•™è¡¨æƒ…ç¬¦è™Ÿï¼‰
          row.dialogue = cleanText(row.dialogue);
          row.shot_desc = cleanText(row.shot_desc);
          row.subtitle = cleanText(row.subtitle);
          row.sfx = cleanText(row.sfx);
          
          // ç¢ºä¿end_sec > start_sec
          if (row.end_sec <= row.start_sec) {
            row.end_sec = row.start_sec + 1;
          }
        });
        
        // 5. æ§‹å»ºæœ€çµ‚JSON
        const result = {
          creator_id: ipPlanningUser ? ipPlanningUser.user_id : 'unknown',
          project_id: null,
          title: title,
          rows: rows
        };
        
        return result;
      }
      
      // æ¸…ç†æ–‡æœ¬æ•¸æ“š
      function cleanText(text) {
        if (!text) return '';
        
        // ç§»é™¤æœ«å°¾ç©ºç™½å’Œæ¨™é»ç¬¦è™Ÿï¼ˆä¿ç•™è¡¨æƒ…ç¬¦è™Ÿï¼‰
        return text.replace(/\s+$/, '').replace(/[ã€‚ï¼Œã€ï¼›ï¼šï¼ï¼Ÿ]$/, '');
      }
      
      // è¼‰å…¥æˆ‘çš„è…³æœ¬
      async function loadMyScripts() {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          document.getElementById('generationsList').innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          return;
        }
        
        console.log('æ­£åœ¨è¼‰å…¥è…³æœ¬åˆ—è¡¨...', {
          ipPlanningToken: ipPlanningToken ? 'present' : 'missing',
          userId: ipPlanningUser.user_id
        });
        
        // å…ˆæª¢æŸ¥æœ¬åœ°å„²å­˜çš„è…³æœ¬
        const localScripts = getLocalScripts();
        if (localScripts.length > 0) {
          console.log('è¼‰å…¥æœ¬åœ°è…³æœ¬:', localScripts);
          displayScripts(localScripts);
          return;
        }
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/scripts/my', {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            }
          });
          
          console.log('è…³æœ¬åˆ—è¡¨éŸ¿æ‡‰ç‹€æ…‹:', response.status);
          
          if (response.ok) {
            const data = await response.json();
            console.log('è…³æœ¬åˆ—è¡¨æ•¸æ“š:', data);
            displayScripts(data.scripts || []);
          } else if (response.status === 401) {
            console.log('è…³æœ¬è¼‰å…¥å¤±æ•—: èªè­‰éŒ¯èª¤');
            document.getElementById('generationsList').innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          } else if (response.status === 404) {
            console.log('è…³æœ¬è¼‰å…¥å¤±æ•—: APIä¸å­˜åœ¨');
            document.getElementById('generationsList').innerHTML = '<div class="loading-text">è…³æœ¬åŠŸèƒ½å³å°‡ä¸Šç·šï¼Œè«‹ç¨å¾Œå†è©¦</div>';
          } else {
            const errorData = await response.json();
            console.log('è…³æœ¬è¼‰å…¥å¤±æ•—:', errorData);
            throw new Error(errorData.error || 'è¼‰å…¥å¤±æ•—');
          }
        } catch (error) {
          console.error('Load scripts error:', error);
          document.getElementById('generationsList').innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
        }
      }
      
      // ç²å–æœ¬åœ°å„²å­˜çš„è…³æœ¬
      function getLocalScripts() {
        try {
          const scripts = localStorage.getItem('user_scripts');
          return scripts ? JSON.parse(scripts) : [];
        } catch (error) {
          console.error('Error loading local scripts:', error);
          return [];
        }
      }
      
      // å„²å­˜è…³æœ¬åˆ°æœ¬åœ°
      function saveScriptToLocal(scriptData) {
        try {
          const scripts = getLocalScripts();
          
          // ç¢ºä¿æ¯å€‹è…³æœ¬éƒ½æœ‰å”¯ä¸€çš„ ID
          // ä½¿ç”¨æ™‚é–“æˆ³ + éš¨æ©Ÿæ•¸ä¾†ç¢ºä¿å”¯ä¸€æ€§
          const uniqueId = `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
          
          const newScript = {
            id: uniqueId,
            ...scriptData,
            created_at: new Date().toISOString()
          };
          
          // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒ ID çš„è…³æœ¬ï¼ˆé¿å…é‡è¤‡ï¼‰
          const existingIndex = scripts.findIndex(s => s.id === uniqueId);
          if (existingIndex === -1) {
            // æ–°è…³æœ¬ï¼Œæ·»åŠ åˆ°é–‹é ­
          scripts.unshift(newScript);
            console.log('æ–°è…³æœ¬å·²æ·»åŠ åˆ°æœ¬åœ°:', newScript);
          } else {
            // å¦‚æœå·²å­˜åœ¨ï¼ˆä¸å¤ªå¯èƒ½ï¼‰ï¼Œæ›´æ–°å®ƒ
            scripts[existingIndex] = newScript;
            console.log('è…³æœ¬å·²æ›´æ–°åˆ°æœ¬åœ°:', newScript);
          }
          
          localStorage.setItem('user_scripts', JSON.stringify(scripts));
          console.log('æœ¬åœ°è…³æœ¬ç¸½æ•¸:', scripts.length);
        } catch (error) {
          console.error('Error saving script locally:', error);
        }
      }
      
      // è¼‰å…¥é¸é¡Œè¨˜éŒ„
      async function loadTopicHistory() {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          document.getElementById('generationsList').innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          return;
        }
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/generations', {
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`,
              'Content-Type': 'application/json'
            }
          });
          
          if (response.ok) {
            const data = await response.json();
            displayTopicHistory(data.generations || []);
          } else if (response.status === 401) {
            document.getElementById('generationsList').innerHTML = '<div class="loading-text">è«‹å…ˆç™»å…¥</div>';
          } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'è¼‰å…¥å¤±æ•—');
          }
        } catch (error) {
          console.error('Load topic history error:', error);
          document.getElementById('generationsList').innerHTML = '<div class="loading-text">è¼‰å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</div>';
        }
      }
      
      // é¡¯ç¤ºé¸é¡Œè¨˜éŒ„
      function displayTopicHistory(topics) {
        const container = document.getElementById('generationsList');
        
        if (topics.length === 0) {
          container.innerHTML = '<div class="loading-text">é‚„æ²’æœ‰é¸é¡Œè¨˜éŒ„</div>';
          return;
        }
        
        container.innerHTML = topics.map((topic, index) => `
          <div class="generation-item">
            <div class="generation-header">
              <span class="generation-number">è¨˜éŒ„ ${index + 1}</span>
              <span class="generation-date">${formatTaiwanTime(topic.created_at)}</span>
            </div>
            <div class="generation-content">${topic.content}</div>
          </div>
        `).join('');
      }
      
      // é¡¯ç¤ºè…³æœ¬åˆ—è¡¨
      function displayScripts(scripts) {
        const container = document.getElementById('generationsList');
        
        if (scripts.length === 0) {
          container.innerHTML = '<div class="loading-text">é‚„æ²’æœ‰å„²å­˜çš„è…³æœ¬</div>';
          return;
        }
        
        container.innerHTML = scripts.map((script, index) => `
          <div class="script-item" data-script-id="${script.id}">
            <div class="script-header" onclick="toggleScript(${script.id})">
              <div class="script-info">
                <span class="script-number">ç·¨è™Ÿ${String(index + 1).padStart(2, '0')}</span>
                <span class="script-name" onclick="editScriptName(${script.id}, event)">${script.name || script.title || 'æœªå‘½åè…³æœ¬'}</span>
                <span class="script-date">${formatTaiwanTime(script.created_at)}</span>
              </div>
              <div class="script-toggle">
                <span class="toggle-icon">â–¼</span>
              </div>
            </div>
            <div class="script-content" id="script-${script.id}" style="display: none;">
              <div class="script-details">
                <div class="script-table">
                  <table>
                    <thead>
                      <tr>
                        <th>æ™‚é–“</th>
                        <th>æ®µè½</th>
                        <th>é¡é ­/ç•«é¢</th>
                        <th>å°è© (æ¼”å“¡å£ç™½)</th>
                        <th>å­—å¹•æ–‡å­— (å¯å‹•ç•«)</th>
                        <th>éŸ³æ•ˆèˆ‡è½‰å ´</th>
                      </tr>
                    </thead>
                    <tbody>
                      ${generateScriptTable(script.script_data)}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="script-actions" id="actions-${script.id}" style="display: none;">
              <button class="action-btn view-btn" onclick="viewFullScript(${script.id})">æŸ¥çœ‹å®Œæ•´çµæœ</button>
              <button class="action-btn download-pdf-btn" onclick="downloadScriptPDF(${script.id})">ä¸‹è¼‰PDFæª”æ¡ˆ</button>
              <button class="action-btn download-csv-btn" onclick="downloadScriptCSV(${script.id})">ä¸‹è¼‰CSVæª”æ¡ˆ</button>
              <button class="action-btn delete-btn" onclick="deleteScript(${script.id})">åˆªé™¤</button>
            </div>
          </div>
        `).join('');
      }
      // æ ¹æ“šå°è©å…§å®¹ç”Ÿæˆç•«é¢æè¿°
      function generateVisualDescription(dialogue) {
        if (!dialogue || dialogue.trim() === '') return '-';
        
        const content = dialogue.toLowerCase();
        
        // æ™‚é–“ç›¸é—œ
        if (content.includes('æ™‚é–“') || content.includes('â³') || content.includes('æ™‚é˜')) {
          return 'æ™‚é˜ç‰¹å¯«ï¼ŒæŒ‡é‡å¿«é€Ÿè½‰å‹•';
        }
        
        // å·¥ä½œ/åŠ ç­ç›¸é—œ
        if (content.includes('åŠ ç­') || content.includes('å·¥ä½œ') || content.includes('ç–²æ†Š')) {
          return 'ç–²æ†Šçš„ä¸Šç­æ—åœ¨è¾¦å…¬å®¤åŠ ç­';
        }
        
        // AI/ç§‘æŠ€ç›¸é—œ
        if (content.includes('ai') || content.includes('æ™ºèƒ½') || content.includes('âœ¨')) {
          return 'é«˜æ•ˆå·¥ä½œè€…ä½¿ç”¨AIå·¥å…·ï¼Œè¢å¹•ç™¼å…‰';
        }
        
        // é©šè¨/éœ‡é©šç›¸é—œ
        if (content.includes('ğŸ˜²') || content.includes('ä¸çŸ¥é“') || content.includes('out')) {
          return 'é©šè¨è¡¨æƒ…ç‰¹å¯«';
        }
        
        // æ±ºç­–/æ€è€ƒç›¸é—œ
        if (content.includes('æ±ºç­–') || content.includes('è°æ˜') || content.includes('ğŸ§ ')) {
          return 'å¤§è…¦åœ–æ¡ˆèˆ‡æ•¸æ“šåˆ†æåœ–è¡¨çµåˆ';
        }
        
        // æ©Ÿæœƒ/ç›®æ¨™ç›¸é—œ
        if (content.includes('æ©Ÿæœƒ') || content.includes('æŠ“ä½') || content.includes('ğŸ¯')) {
          return 'ç®­é ­å°„ä¸­é¶å¿ƒ';
        }
        
        // ç«¶çˆ­ç›¸é—œ
        if (content.includes('ç«¶çˆ­') || content.includes('è¶…è»Š') || content.includes('ğŸ”¥')) {
          return 'è³½è»Šè¶…è¶Šå°æ‰‹ï¼Œç«ç„°ç‰¹æ•ˆ';
        }
        
        // æœªä¾†/è¶¨å‹¢ç›¸é—œ
        if (content.includes('æœªä¾†') || content.includes('è¶¨å‹¢') || content.includes('å…¥å ´åˆ¸')) {
          return 'ä¸€å¼µé€šå¾€æœªä¾†ä¸–ç•Œçš„é–€ç¥¨';
        }
        
        // æˆåŠŸ/æˆå°±ç›¸é—œ
        if (content.includes('æˆåŠŸ') || content.includes('æŒæ¡') || content.includes('ğŸ†')) {
          return 'ä¸€äººè‡ªä¿¡åœ°æ“ä½œAIå·¥å…·ï¼Œçç›ƒç‰¹å¯«';
        }
        
        // è§’è‰²ç›¸é—œ
        if (content.includes('å­¸ç”Ÿ') || content.includes('ä¸Šç­æ—') || content.includes('å‰µæ¥­è€…')) {
          return 'å­¸ç”Ÿã€ä¸Šç­æ—ã€å‰µæ¥­è€…ä¸‰ç¨®ä¸åŒè§’è‰²çš„è’™å¤ªå¥‡ç•«é¢';
        }
        
        // ä¸Šå‡/é€²æ­¥ç›¸é—œ
        if (content.includes('ä¸Šå‡') || content.includes('æ­ä¸Š') || content.includes('åˆ—è»Š')) {
          return 'ä¸€äººç™»ä¸Šå¿«é€Ÿè¡Œé§›çš„åˆ—è»Šæˆ–é›»æ¢¯';
        }
        
        // é‡‘éŒ¢ç›¸é—œ
        if (content.includes('é‡‘éŒ¢') || content.includes('ğŸ’°') || content.includes('çœä¸‹')) {
          return 'æ™‚é˜èˆ‡é‡‘éŒ¢ç¬¦è™Ÿçš„ç–ŠåŠ å‹•ç•«';
        }
        
        // æ–‡ä»¶/è³‡æ–™ç›¸é—œ
        if (content.includes('æ–‡ä»¶') || content.includes('è³‡æ–™') || content.includes('åˆ†æ')) {
          return 'å‹•ç•«å±•ç¤ºæ–‡ä»¶è‡ªå‹•æ­¸é¡ã€æ•¸æ“šåœ–è¡¨è‡ªå‹•ç”Ÿæˆ';
        }
        
        // æ“ä½œç›¸é—œ
        if (content.includes('æŒ‡ä»¤') || content.includes('ä¸‹æŒ‡ä»¤') || content.includes('ğŸ’¡')) {
          return 'æ‰‹æŒ‡è¼•é»è¢å¹•ï¼Œä»»å‹™å¿«é€Ÿå®Œæˆçš„é€²åº¦æ¢';
        }
        
        // å•é¡Œ/ç–‘å•ç›¸é—œ
        if (content.includes('?') || content.includes('ï¼Ÿ') || content.includes('å¦‚ä½•') || content.includes('ä»€éº¼')) {
          return 'ç–‘å•è¡¨æƒ…ç‰¹å¯«ï¼Œæ€è€ƒç‹€æ…‹';
        }
        
        // å¼·èª¿/é‡è¦ç›¸é—œ
        if (content.includes('é‡è¦') || content.includes('é—œéµ') || content.includes('æ³¨æ„')) {
          return 'é‡è¦è³‡è¨Šé«˜äº®é¡¯ç¤ºï¼Œå¼·èª¿æ•ˆæœ';
        }
        
        // å°æ¯”ç›¸é—œ
        if (content.includes('vs') || content.includes('å°æ¯”') || content.includes('æ¯”è¼ƒ')) {
          return 'å·¦å³åˆ†å±å°æ¯”ç•«é¢';
        }
        
        // æ­¥é©Ÿ/æµç¨‹ç›¸é—œ
        if (content.includes('æ­¥é©Ÿ') || content.includes('æµç¨‹') || content.includes('ç¬¬ä¸€') || content.includes('ç¬¬äºŒ')) {
          return 'æ­¥é©ŸæŒ‡ç¤ºåœ–ï¼Œæµç¨‹å‹•ç•«';
        }
        
        // é è¨­æè¿°
        return 'æ ¹æ“šå°è©å…§å®¹çš„ç›¸é—œç•«é¢';
      }
      
      // ç”Ÿæˆè…³æœ¬è¡¨æ ¼
      function generateScriptTable(scriptData) {
        console.log('ç”Ÿæˆè…³æœ¬è¡¨æ ¼ï¼Œæ•¸æ“š:', scriptData);
        
        // æª¢æŸ¥æ˜¯å¦æœ‰éŒ¯èª¤
        if (scriptData && scriptData.error) {
          console.log('è…³æœ¬æ•¸æ“šæœ‰éŒ¯èª¤:', scriptData.message);
          return `<tr><td colspan="6">è§£æå¤±æ•—: ${scriptData.message}</td></tr>`;
        }
        
        // è™•ç†æ–°æ ¼å¼ï¼ˆæœ‰rowsæ¬„ä½ï¼‰
        if (scriptData && scriptData.rows && scriptData.rows.length > 0) {
          let tableRows = '';
          
          // æŒ‰ç…§è¦ç¯„æ ¼å¼ç”Ÿæˆè¡¨æ ¼è¡Œ
          scriptData.rows.forEach((row, index) => {
            const timeRange = `${row.start_sec}-${row.end_sec}s`;
            const section = row.section || '-';
            const shotDesc = row.shot_desc || '-';
            const dialogue = row.dialogue || '-';
            const subtitle = row.subtitle || '-';
            const sfx = row.sfx || '-';
            
            tableRows += `
              <tr>
                <td>${timeRange}</td>
                <td>${section}</td>
                <td title="${shotDesc}">${shotDesc}</td>
                <td title="${dialogue}">${dialogue}</td>
                <td title="${subtitle}">${subtitle}</td>
                <td title="${sfx}">${sfx}</td>
              </tr>
            `;
          });
          
          console.log('ç”Ÿæˆçš„è¡¨æ ¼è¡Œ:', tableRows);
          return tableRows || '<tr><td colspan="6">ç„¡æ•¸æ“š</td></tr>';
        }
        
        // è™•ç†èˆŠæ ¼å¼ï¼ˆæœ‰sectionsæ¬„ä½ï¼‰
        if (scriptData && scriptData.sections && scriptData.sections.length > 0) {
        let tableRows = '';
        let timeIndex = 0;
        const timeRanges = ['0-3s', '3-7s', '7-15s', '15-25s', '25-30s'];
        
          // æª¢æŸ¥æ˜¯å¦æœ‰ç•«é¢æ„Ÿè³‡æ–™
          const hasVisualData = scriptData.visual && scriptData.visual.trim() !== '';
          let visualLines = [];
          
          if (hasVisualData) {
            // è§£æç•«é¢æ„Ÿå…§å®¹ï¼ŒæŒ‰è¡Œåˆ†å‰²
            visualLines = scriptData.visual.split('\n').map(line => line.trim()).filter(line => line);
            console.log('ç•«é¢æ„Ÿè³‡æ–™:', visualLines);
          }
          
          scriptData.sections.forEach((section, sectionIndex) => {
            console.log(`è™•ç†æ®µè½ ${sectionIndex}:`, section);
            
            // å¦‚æœæ®µè½æœ‰å…§å®¹
            if (section.content && section.content.length > 0) {
          section.content.forEach((content, contentIndex) => {
            const timeRange = timeRanges[timeIndex] || '-';
            const sectionType = section.type || 'å…§å®¹æ®µè½';
                
                // æ¸…ç†å…§å®¹ï¼Œç§»é™¤å¤šé¤˜çš„ç©ºç™½
                const cleanContent = content.trim();
                
                // é™åˆ¶é¡¯ç¤ºé•·åº¦ï¼Œè¶…é30å€‹å­—ç¬¦å°±æˆªæ–·ä¸¦åŠ ä¸Šçœç•¥è™Ÿ
                const displayContent = cleanContent.length > 30 ? 
                  cleanContent.substring(0, 30) + '...' : cleanContent;
              
                // ç²å–å°æ‡‰çš„ç•«é¢æè¿°
                let visualDescription = '-';
                if (hasVisualData && visualLines[timeIndex]) {
                  // ä½¿ç”¨å¯¦éš›çš„ç•«é¢æ„Ÿå…§å®¹
                  visualDescription = visualLines[timeIndex].length > 50 ? 
                    visualLines[timeIndex].substring(0, 50) + '...' : visualLines[timeIndex];
                } else {
                  // å¦‚æœæ²’æœ‰ç•«é¢æ„Ÿè³‡æ–™ï¼Œä½¿ç”¨æ™ºèƒ½ç”Ÿæˆ
                  visualDescription = generateVisualDescription(cleanContent);
                }
            
            tableRows += `
              <tr>
                <td>${timeRange}</td>
                <td>${sectionType}</td>
                    <td title="${hasVisualData && visualLines[timeIndex] ? visualLines[timeIndex] : visualDescription}">${visualDescription}</td>
                    <td title="${cleanContent}">${displayContent}</td>
                <td>-</td>
                    <td>-</td>
                  </tr>
                `;
                timeIndex++;
              });
            } else {
              // å¦‚æœæ®µè½æ²’æœ‰å…§å®¹ï¼Œä½†æ®µè½é¡å‹å­˜åœ¨
              const timeRange = timeRanges[timeIndex] || '-';
              const sectionType = section.type || 'å…§å®¹æ®µè½';
              
              // ç²å–å°æ‡‰çš„ç•«é¢æè¿°
              let visualDescription = '-';
              if (hasVisualData && visualLines[timeIndex]) {
                visualDescription = visualLines[timeIndex].length > 50 ? 
                  visualLines[timeIndex].substring(0, 50) + '...' : visualLines[timeIndex];
              }
              
              tableRows += `
                <tr>
                  <td>${timeRange}</td>
                  <td>${sectionType}</td>
                  <td title="${hasVisualData && visualLines[timeIndex] ? visualLines[timeIndex] : ''}">${visualDescription}</td>
                  <td>-</td>
                <td>-</td>
                <td>-</td>
              </tr>
            `;
            timeIndex++;
            }
        });
        
          console.log('ç”Ÿæˆçš„è¡¨æ ¼è¡Œ:', tableRows);
        return tableRows || '<tr><td colspan="6">ç„¡æ•¸æ“š</td></tr>';
        }
        
        // å¦‚æœéƒ½æ²’æœ‰ï¼Œè¿”å›ç„¡æ•¸æ“š
        console.log('æ²’æœ‰è…³æœ¬æ•¸æ“šï¼Œè¿”å›ç„¡æ•¸æ“šè¡Œ');
        return '<tr><td colspan="6">ç„¡æ•¸æ“š</td></tr>';
      }
      
      // åˆ‡æ›è…³æœ¬å±•é–‹/æ”¶èµ·
      function toggleScript(scriptId) {
        const content = document.getElementById(`script-${scriptId}`);
        const actions = document.getElementById(`actions-${scriptId}`);
        const toggleIcon = document.querySelector(`[data-script-id="${scriptId}"] .toggle-icon`);
        
        if (content.style.display === 'none') {
          content.style.display = 'block';
          actions.style.display = 'flex';
          toggleIcon.textContent = 'â–²';
        } else {
          content.style.display = 'none';
          actions.style.display = 'none';
          toggleIcon.textContent = 'â–¼';
        }
      }
      
      // ç·¨è¼¯è…³æœ¬åç¨±
      function editScriptName(scriptId, event) {
        event.stopPropagation();
        const nameElement = event.target;
        const currentName = nameElement.textContent;
        
        const newName = prompt('è«‹è¼¸å…¥æ–°çš„è…³æœ¬åç¨±:', currentName);
        if (newName && newName !== currentName) {
          updateScriptName(scriptId, newName);
        }
      }
      
      // æ›´æ–°è…³æœ¬åç¨±
      async function updateScriptName(scriptId, newName) {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/scripts/${scriptId}/name`, {
            method: 'PUT',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({ name: newName })
          });
          
          if (response.ok) {
            showToast('è…³æœ¬åç¨±æ›´æ–°æˆåŠŸï¼', 3000);
            loadMyScripts(); // é‡æ–°è¼‰å…¥åˆ—è¡¨
          } else if (response.status === 401) {
            showToast('è«‹å…ˆç™»å…¥', 3000);
          } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'æ›´æ–°å¤±æ•—');
          }
        } catch (error) {
          console.error('Update script name error:', error);
          showToast('æ›´æ–°å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // æŸ¥çœ‹å®Œæ•´è…³æœ¬
      function viewFullScript(scriptId) {
        // æ‰¾åˆ°å°æ‡‰çš„è…³æœ¬æ•¸æ“š
        const scripts = getLocalScripts();
        const script = scripts.find(s => s.id == scriptId);
        
        if (!script) {
          showToast('æ‰¾ä¸åˆ°è…³æœ¬æ•¸æ“š', 3000);
          return;
        }
        
        // å‰µå»ºå½ˆå‡ºè¦–çª—
        const modal = document.createElement('div');
        modal.className = 'script-modal-overlay';
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 10000;
        `;
        
        const modalContent = document.createElement('div');
        modalContent.style.cssText = `
          background: white;
          border-radius: 12px;
          padding: 24px;
          max-width: 90%;
          max-height: 90%;
          overflow-y: auto;
          box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        `;
        
        // ç”Ÿæˆå®Œæ•´è…³æœ¬å…§å®¹
        let fullContent = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #e5e7eb; padding-bottom: 16px;">
            <h2 style="margin: 0; color: #1f2937; font-size: 20px;">${script.name || 'æœªå‘½åè…³æœ¬'}</h2>
            <button onclick="this.closest('.script-modal-overlay').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">Ã—</button>
          </div>
        `;
        
        if (script.script_data && script.script_data.sections) {
          fullContent += '<div style="margin-bottom: 20px;">';
          script.script_data.sections.forEach((section, index) => {
            fullContent += `
              <div style="margin-bottom: 16px; padding: 16px; background: #f8fafc; border-radius: 8px;">
                <h3 style="margin: 0 0 12px 0; color: #374151; font-size: 16px; font-weight: 600;">${section.type || 'å…§å®¹æ®µè½'}</h3>
                <div style="color: #4b5563; line-height: 1.6;">
                  ${section.content ? section.content.map(content => `<p style="margin: 8px 0;">${content}</p>`).join('') : '<p>ç„¡å…§å®¹</p>'}
                </div>
              </div>
            `;
          });
          fullContent += '</div>';
        } else {
          // å¦‚æœæ²’æœ‰çµæ§‹åŒ–æ•¸æ“šï¼Œé¡¯ç¤ºåŸå§‹å…§å®¹
          fullContent += `
            <div style="background: #f8fafc; padding: 16px; border-radius: 8px; white-space: pre-wrap; line-height: 1.6; color: #4b5563;">
              ${script.content || 'ç„¡å…§å®¹'}
            </div>
          `;
        }
        
        modalContent.innerHTML = fullContent;
        modal.appendChild(modalContent);
        document.body.appendChild(modal);
        
        // é»æ“ŠèƒŒæ™¯é—œé–‰
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
          }
        });
      }
      
      // ä¸‹è¼‰PDFï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      window.downloadScriptPDF = function(scriptId) {
        // ç²å–è…³æœ¬æ•¸æ“š
        const scripts = getLocalScripts();
        let script = scripts.find(s => s.id == scriptId);
        
        // å¦‚æœæœ¬åœ°æ‰¾ä¸åˆ°ï¼Œå˜—è©¦å¾ DOM ç²å–
        if (!script) {
          const scriptItem = document.querySelector(`[data-script-id="${scriptId}"]`);
          if (scriptItem) {
            const scriptName = scriptItem.querySelector('.script-name')?.textContent || 'æœªå‘½åè…³æœ¬';
            const scriptDate = scriptItem.querySelector('.script-date')?.textContent || '';
            const scriptTable = scriptItem.querySelector('table');
            
            if (scriptTable) {
              const rows = Array.from(scriptTable.querySelectorAll('tbody tr'));
              const scriptData = {
                rows: rows.map(row => {
                  const cells = row.querySelectorAll('td');
                  return {
                    time: cells[0]?.textContent || '-',
                    section: cells[1]?.textContent || '-',
                    shot_desc: cells[2]?.textContent || '-',
                    dialogue: cells[3]?.textContent || '-',
                    subtitle: cells[4]?.textContent || '-',
                    sfx: cells[5]?.textContent || '-'
                  };
                })
              };
              
              script = {
                id: scriptId,
                name: scriptName,
                created_at: scriptDate,
                script_data: scriptData
              };
            }
          }
        }
        
        if (!script) {
          showToast('æ‰¾ä¸åˆ°è…³æœ¬æ•¸æ“š', 3000);
          return;
        }
        
        // å‰µå»ºå¯åˆ—å°çš„ HTML å…§å®¹
        let printContent = `
          <!DOCTYPE html>
          <html>
          <head>
            <meta charset="UTF-8">
            <title>${script.name || 'æœªå‘½åè…³æœ¬'}</title>
            <style>
              @media print {
                body { margin: 0; padding: 20px; }
                .no-print { display: none; }
              }
              body { font-family: Arial, sans-serif; padding: 20px; }
              h1 { color: #1f2937; margin-bottom: 10px; }
              .meta { color: #6b7280; margin-bottom: 20px; }
              table { width: 100%; border-collapse: collapse; margin-top: 20px; }
              th { background: #f8fafc; padding: 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; }
              td { padding: 10px; border-bottom: 1px solid #e5e7eb; color: #4b5563; }
              tr:nth-child(even) { background: #f9fafb; }
            </style>
          </head>
          <body>
            <h1>${script.name || 'æœªå‘½åè…³æœ¬'}</h1>
            ${script.created_at ? `<div class="meta">å»ºç«‹æ™‚é–“ï¼š${script.created_at}</div>` : ''}
        `;
        
        // ç”Ÿæˆè¡¨æ ¼å…§å®¹
        if (script.script_data && script.script_data.rows && script.script_data.rows.length > 0) {
          printContent += `
            <table>
              <thead>
                <tr>
                  <th>æ™‚é–“</th>
                  <th>æ®µè½</th>
                  <th>é¡é ­/ç•«é¢</th>
                  <th>å°è© (æ¼”å“¡å£ç™½)</th>
                  <th>å­—å¹•æ–‡å­— (å¯å‹•ç•«)</th>
                  <th>éŸ³æ•ˆèˆ‡è½‰å ´</th>
                </tr>
              </thead>
              <tbody>
          `;
          
          script.script_data.rows.forEach(row => {
            // æ­£ç¢ºè™•ç†æ™‚é–“æ¬„ä½
            let timeDisplay = '-';
            if (row.time && row.time !== 'undefined-undefineds' && row.time !== '-') {
              timeDisplay = row.time;
            } else if (row.start_sec !== undefined && row.end_sec !== undefined) {
              timeDisplay = `${row.start_sec}-${row.end_sec}s`;
            } else if (row.time && typeof row.time === 'string' && row.time.includes('-') && row.time.includes('s')) {
              timeDisplay = row.time;
            }
            printContent += `
              <tr>
                <td>${timeDisplay}</td>
                <td>${row.section || '-'}</td>
                <td>${row.shot_desc || '-'}</td>
                <td>${row.dialogue || '-'}</td>
                <td>${row.subtitle || '-'}</td>
                <td>${row.sfx || '-'}</td>
              </tr>
            `;
          });
          
          printContent += `
              </tbody>
            </table>
          `;
        } else if (script.script_data && script.script_data.sections) {
          script.script_data.sections.forEach(section => {
            printContent += `
              <div style="margin-bottom: 20px; padding: 16px; background: #f8fafc; border-left: 4px solid #3b82f6;">
                <h3 style="margin: 0 0 12px 0; color: #374151;">${section.type || 'å…§å®¹æ®µè½'}</h3>
                <div style="color: #4b5563; line-height: 1.8;">
                  ${section.content ? section.content.map(content => `<p style="margin: 8px 0;">${content}</p>`).join('') : '<p>ç„¡å…§å®¹</p>'}
                </div>
              </div>
            `;
          });
        } else {
          printContent += `<div style="padding: 16px; background: #f8fafc; white-space: pre-wrap;">${script.content || 'ç„¡å…§å®¹'}</div>`;
        }
        
        printContent += `
          </body>
          </html>
        `;
        
        // å‰µå»ºæ–°çª—å£ä¸¦åˆ—å°
        const printWindow = window.open('', '_blank');
        printWindow.document.write(printContent);
        printWindow.document.close();
        
        // ç­‰å¾…å…§å®¹è¼‰å…¥å¾Œåˆ—å°
        printWindow.onload = () => {
          setTimeout(() => {
            printWindow.print();
            showToast('PDF æº–å‚™å°±ç·’ï¼Œè«‹ä½¿ç”¨ç€è¦½å™¨çš„åˆ—å°åŠŸèƒ½å„²å­˜ç‚º PDF', 3000);
          }, 250);
        };
      }
      
      // ä¸‹è¼‰CSVï¼ˆå‰µä½œè€…è³‡æ–™åº«ç‰ˆæœ¬ï¼‰
      window.downloadScriptCSV = function(scriptId) {
        // ç²å–è…³æœ¬æ•¸æ“š
        const scripts = getLocalScripts();
        let script = scripts.find(s => s.id == scriptId);
        
        // å¦‚æœæœ¬åœ°æ‰¾ä¸åˆ°ï¼Œå˜—è©¦å¾ DOM ç²å–
        if (!script) {
          const scriptItem = document.querySelector(`[data-script-id="${scriptId}"]`);
          if (scriptItem) {
            const scriptName = scriptItem.querySelector('.script-name')?.textContent || 'æœªå‘½åè…³æœ¬';
            const scriptDate = scriptItem.querySelector('.script-date')?.textContent || '';
            const scriptTable = scriptItem.querySelector('table');
            
            if (scriptTable) {
              const rows = Array.from(scriptTable.querySelectorAll('tbody tr'));
              const scriptData = {
                rows: rows.map(row => {
                  const cells = row.querySelectorAll('td');
                  return {
                    time: cells[0]?.textContent || '-',
                    section: cells[1]?.textContent || '-',
                    shot_desc: cells[2]?.textContent || '-',
                    dialogue: cells[3]?.textContent || '-',
                    subtitle: cells[4]?.textContent || '-',
                    sfx: cells[5]?.textContent || '-'
                  };
                })
              };
              
              script = {
                id: scriptId,
                name: scriptName,
                created_at: scriptDate,
                script_data: scriptData
              };
            }
          }
        }
        
        if (!script) {
          showToast('æ‰¾ä¸åˆ°è…³æœ¬æ•¸æ“š', 3000);
          return;
        }
        
        // ç”Ÿæˆ CSV å…§å®¹
        let csvContent = '\uFEFF'; // BOM for Excel UTF-8 support
        csvContent += `è…³æœ¬åç¨±,${script.name || 'æœªå‘½åè…³æœ¬'}\n`;
        csvContent += `å»ºç«‹æ™‚é–“,${script.created_at || '-'}\n`;
        csvContent += '\n';
        csvContent += 'æ™‚é–“,æ®µè½,é¡é ­/ç•«é¢,å°è© (æ¼”å“¡å£ç™½),å­—å¹•æ–‡å­— (å¯å‹•ç•«),éŸ³æ•ˆèˆ‡è½‰å ´\n';
        
        // è™•ç† CSV ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆé€—è™Ÿã€å¼•è™Ÿã€æ›è¡Œï¼‰
        const escapeCSV = (str) => {
          if (!str) return '-';
          const s = String(str);
          if (s.includes(',') || s.includes('"') || s.includes('\n')) {
            return `"${s.replace(/"/g, '""')}"`;
          }
          return s;
        };
        
        if (script.script_data && script.script_data.rows && script.script_data.rows.length > 0) {
          script.script_data.rows.forEach(row => {
            // æ­£ç¢ºè™•ç†æ™‚é–“æ¬„ä½
            let timeDisplay = '-';
            if (row.time && row.time !== 'undefined-undefineds' && row.time !== '-') {
              timeDisplay = row.time;
            } else if (row.start_sec !== undefined && row.end_sec !== undefined) {
              timeDisplay = `${row.start_sec}-${row.end_sec}s`;
            } else if (row.time && typeof row.time === 'string' && row.time.includes('-') && row.time.includes('s')) {
              timeDisplay = row.time;
            }
            csvContent += `${escapeCSV(timeDisplay)},${escapeCSV(row.section)},${escapeCSV(row.shot_desc)},${escapeCSV(row.dialogue)},${escapeCSV(row.subtitle)},${escapeCSV(row.sfx)}\n`;
          });
        } else if (script.script_data && script.script_data.sections) {
          script.script_data.sections.forEach(section => {
            if (section.content && section.content.length > 0) {
              section.content.forEach(content => {
                csvContent += `-,${escapeCSV(section.type || 'å…§å®¹æ®µè½')},-,${escapeCSV(content)},-,-\n`;
              });
            }
          });
        } else {
          csvContent += `-,å…¨éƒ¨å…§å®¹,,-,${escapeCSV(script.content || 'ç„¡å…§å®¹')},-\n`;
        }
        
        // å‰µå»ºä¸‹è¼‰é€£çµ
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `${script.name || 'è…³æœ¬'}_${Date.now()}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
        
        showToast('CSV æª”æ¡ˆä¸‹è¼‰æˆåŠŸï¼', 2000);
      }
      
      // åˆªé™¤è…³æœ¬
      async function deleteScript(scriptId) {
        if (!ipPlanningToken || !ipPlanningUser || !ipPlanningUser.user_id) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è…³æœ¬å—ï¼Ÿ')) {
          return;
        }
        
        try {
          const response = await fetch(`https://aivideobackend.zeabur.app/api/scripts/${scriptId}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${ipPlanningToken}`
            }
          });
          
          if (response.ok) {
            showToast('è…³æœ¬åˆªé™¤æˆåŠŸï¼', 3000);
            loadMyScripts(); // é‡æ–°è¼‰å…¥åˆ—è¡¨
          } else if (response.status === 401) {
            showToast('è«‹å…ˆç™»å…¥', 3000);
          } else {
            const errorData = await response.json();
            throw new Error(errorData.error || 'åˆªé™¤å¤±æ•—');
          }
        } catch (error) {
          console.error('Delete script error:', error);
          showToast('åˆªé™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }
      
      // æ ¼å¼åŒ–å°ç£æ™‚é–“
      function formatTaiwanTime(dateString) {
        if (!dateString) return '-';
        try {
        const date = new Date(dateString);
          if (isNaN(date.getTime())) {
            return dateString; // å¦‚æœæ—¥æœŸç„¡æ•ˆï¼Œè¿”å›åŸå§‹å­—ç¬¦ä¸²
          }
        return date.toLocaleString('zh-TW', {
          timeZone: 'Asia/Taipei',
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        });
        } catch (error) {
          console.error('æ ¼å¼åŒ–å°ç£æ™‚å€æ™‚é–“éŒ¯èª¤:', error);
          return dateString; // ç™¼ç”ŸéŒ¯èª¤æ™‚è¿”å›åŸå§‹å­—ç¬¦ä¸²
        }
      }
      
      // é‡æ–°ç”Ÿæˆçµæœ
      async function regenerateResult(type) {
        switch(type) {
          case 'positioning':
            await generatePositioning();
            break;
          case 'topics':
            await generateTopics();
            break;
          case 'script':
            await generateScript();
            break;
        }
      }
      
      // æ›´æ–°çµæœå€å¡Šå…§å®¹
      function updateResultBlock(elementId, content, hasContent) {
        const element = document.getElementById(elementId);
        if (element) {
          element.textContent = content;
          if (hasContent) {
            element.classList.add('has-content');
          } else {
            element.classList.remove('has-content');
          }
        }
      }
      
      // å¸³è™Ÿå®šä½åŠŸèƒ½
      async function analyzePositioning() {
        const positioning = positioningInput.value;
        
        if (!positioning) {
          showToast('è«‹å…ˆè¼¸å…¥å¸³è™Ÿå®šä½', 3000);
          return;
        }
        
        updateResultBlock('positioningResult', 'æ­£åœ¨åˆ†æå¸³è™Ÿå®šä½...', false);
        
        try {
          // é€™è£¡å¯ä»¥èª¿ç”¨å¾Œç«¯ API é€²è¡Œå¸³è™Ÿå®šä½åˆ†æ
          // æš«æ™‚ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š
          setTimeout(() => {
            const analysis = `æ ¹æ“šæ‚¨çš„å¸³è™Ÿå®šä½"${positioning}"ï¼Œå»ºè­°ï¼š\n\n1. å…§å®¹é¢¨æ ¼ï¼šè¼•é¬†å¹½é»˜\n2. ç›®æ¨™å—çœ¾ï¼šå¥åº·æ„›å¥½è€…\n3. å…§å®¹ä¸»é¡Œï¼šåŠ å¯†è²¨å¹£èˆ‡å¥åº·çµåˆ\n4. ç™¼å¸ƒæ™‚é–“ï¼šæ™šä¸Š8-10é»\n5. äº’å‹•ç­–ç•¥ï¼šå¤šä½¿ç”¨å•ç­”å½¢å¼`;
            updateResultBlock('positioningResult', analysis, true);
          }, 2000);
        } catch (error) {
          updateResultBlock('positioningResult', 'åˆ†æå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', false);
          showToast('åˆ†æå¤±æ•—', 3000);
        }
      }
      
      // è…³æœ¬é¸é¡ŒåŠŸèƒ½
      async function selectTopics() {
        const platform = platformSelect.value;
        const topic = topicInput.value;
        
        if (!platform) {
          showToast('è«‹å…ˆé¸æ“‡å¹³å°', 3000);
          return;
        }
        
        updateResultBlock('topicSelectionResult', 'æ­£åœ¨ç‚ºæ‚¨é¸é¡Œ...', false);
        
        try {
          // é€™è£¡å¯ä»¥èª¿ç”¨å¾Œç«¯ API é€²è¡Œé¸é¡Œ
          // æš«æ™‚ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š
          setTimeout(() => {
            const topics = `ç‚º${platform}å¹³å°æ¨è–¦ä»¥ä¸‹é¸é¡Œ${topic ? `ï¼ˆåŸºæ–¼"${topic}"ä¸»é¡Œï¼‰` : ''}ï¼š\n\n1. å¤å­£ç¾ç™½ä¿é¤Šçš„5å€‹å°æŠ€å·§\n2. 30å¤©ç¾ç™½æŒ‘æˆ°å¯¦æ¸¬\n3. ç¾ç™½ç”¢å“æˆåˆ†å¤§è§£æ\n4. å¤©ç„¶ç¾ç™½æ–¹æ³•åˆ†äº«\n5. ç¾ç™½èª¤å€ä½ ä¸­äº†å¹¾å€‹ï¼Ÿ`;
            updateResultBlock('topicSelectionResult', topics, true);
          }, 2000);
        } catch (error) {
          updateResultBlock('topicSelectionResult', 'é¸é¡Œå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', false);
          showToast('é¸é¡Œå¤±æ•—', 3000);
        }
      }
      
      // äº‹ä»¶ç›£è½å™¨
      document.addEventListener('DOMContentLoaded', async () => {
        // é é¢é‡æ–°æ•´ç†æ™‚ï¼Œæ¸…ç©ºèŠå¤©å€åŸŸï¼ˆä½†å¾Œç«¯é•·æœŸè¨˜æ†¶æœƒä¿ç•™ï¼‰
        const chatMessages = document.getElementById('chatMessages');
        const mode3ChatMessages = document.getElementById('mode3-chatMessages');
        if (chatMessages) {
          chatMessages.innerHTML = '';
          console.log('é é¢é‡æ–°æ•´ç†ï¼šå·²æ¸…ç©º AI é¡§å•èŠå¤©å€åŸŸ');
        }
        if (mode3ChatMessages) {
          mode3ChatMessages.innerHTML = '';
          console.log('é é¢é‡æ–°æ•´ç†ï¼šå·²æ¸…ç©º IP äººè¨­è¦åŠƒèŠå¤©å€åŸŸ');
        }
        
        // ç¢ºä¿æŠ½å±œåˆå§‹ç‹€æ…‹ç‚ºé—œé–‰
        closeUserDrawer();
        
        // æª¢æŸ¥æ˜¯å¦æœ‰èªè­‰å›èª¿
        await handleAuthCallback();
        
        // æª¢æŸ¥æœ¬åœ°å­˜å„²çš„èªè­‰è³‡è¨Š
        ipPlanningToken = localStorage.getItem('ipPlanningToken');
        ipPlanningUser = JSON.parse(localStorage.getItem('ipPlanningUser') || 'null');
        
        if (ipPlanningToken && ipPlanningUser) {
          updateAuthUI(true);
        } else {
          updateAuthUI(false);
        }
        
        // æŒ‰éˆ•åŠŸèƒ½å·²æ•´åˆåˆ°å¿«é€ŸæŒ‰éˆ•ä¸­
        
        // æ¨™ç±¤åˆ‡æ›äº‹ä»¶
        document.querySelectorAll('.result-tab').forEach(tab => {
          tab.addEventListener('click', () => {
            const tabName = tab.getAttribute('data-tab');
            switchTab(tabName);
          });
        });
        
        // è¨­å®šå€å¡Šæ‘ºç–Š/å±•é–‹åŠŸèƒ½
        settingsToggleEl.addEventListener('click', () => {
          const isCollapsed = settingsContentEl.classList.contains('collapsed');
          const toggleIcon = settingsToggleEl.querySelector('.settings-toggle');
          
          if (isCollapsed) {
            settingsContentEl.classList.remove('collapsed');
            toggleIcon.textContent = 'â–¼';
          } else {
            settingsContentEl.classList.add('collapsed');
            toggleIcon.textContent = 'â–¶';
          }
        });
        
        // ç™»å…¥æŒ‰éˆ•åŠŸèƒ½ - å·²ç¶“åœ¨ HTML ä¸­è¨­å®š onclick="goToLogin()"ï¼Œä¸éœ€è¦å†æ¬¡ç¶å®š
        // loginBtn.addEventListener('click', login);
        
        // èŠå¤©åŠŸèƒ½
        sendBtn.addEventListener('click', sendMessage);
        
        // è¼¸å…¥æ¡†äº‹ä»¶ç›£è½å™¨
        messageInput.addEventListener('input', autoResizeTextarea);
        
        // åˆå§‹åŒ–ç™¼é€æŒ‰éˆ•ç‹€æ…‹
        autoResizeTextarea();
        
        // å¿«é€ŸæŒ‰éˆ•åŠŸèƒ½ - åªç¶å®šåˆ° mode1 çš„å¿«é€ŸæŒ‰éˆ•ï¼ˆå¦‚æœå­˜åœ¨çš„è©±ï¼‰
        // æ³¨æ„ï¼šmode2 å’Œ mode3 çš„å¿«é€ŸæŒ‰éˆ•æœ‰å„è‡ªç¨ç«‹çš„äº‹ä»¶ç›£è½å™¨
        // åªè™•ç† mode1 æˆ–æ²’æœ‰ç‰¹å®šå®¹å™¨æ¨™è¨˜çš„å¿«é€ŸæŒ‰éˆ•
        const mode1QuickButtons = document.querySelectorAll('#mode1 .quick-btn, .mode1-container .quick-btn');
        mode1QuickButtons.forEach(btn => {
          btn.addEventListener('click', () => {
            const text = btn.getAttribute('data-text');
            if (text && messageInput && sendMessage) {
              messageInput.value = text;
              messageInput.focus();
              
              // æ·»åŠ è¦–è¦ºåé¥‹
              btn.style.transform = 'scale(0.95)';
              setTimeout(() => {
                btn.style.transform = '';
              }, 150);
              
              // æ ¹æ“šæŒ‰éˆ•é¡å‹åˆ‡æ›åˆ°å°æ‡‰çš„çµæœæ¨™ç±¤
              if (text.includes('ç”Ÿæˆè…³æœ¬')) {
                switchTab('script');
              } else if (text.includes('è…³æœ¬é¸é¡Œ')) {
                switchTab('topics');
              } else if (text.includes('å¸³è™Ÿå®šä½')) {
                switchTab('positioning');
              }
              
              // è‡ªå‹•ç™¼é€è¨Šæ¯
              setTimeout(() => {
                sendMessage();
              }, 500);
            }
          });
        });
        
        // è¨­å®šå·²å¥—ç”¨çš„æ¨™è¨˜
        let settingsApplied = false;
        let appliedSettings = {
          platform: null,
          topic: null,
          duration: null,
          positioning: null
        };

        applyBtn.addEventListener('click', () => {
          const platform = platformSelect.value;
          const topic = topicInput.value;
          const positioning = positioningInput.value;
          const duration = durationInput.value;
          
          if (platform) {
            // è¨˜éŒ„å·²å¥—ç”¨çš„è¨­å®š
            settingsApplied = true;
            appliedSettings = {
              platform: platform,
              topic: topic,
              duration: duration,
              positioning: positioning
            };
            
            showToast('è¨­å®šå·²å¥—ç”¨', 2000);
            
            // è‡ªå‹•æ”¶åˆè¨­å®šå€å¡Š
            settingsContentEl.classList.add('collapsed');
            const toggleIcon = settingsToggleEl.querySelector('.settings-toggle');
            toggleIcon.textContent = 'â–¶';
          } else {
            showToast('è«‹é¸æ“‡å¹³å°', 3000);
          }
        });
        
        // æ¸¬è©¦é€£ç·šå’Œé¡¯ç¤ºçµæœåŠŸèƒ½å·²æ•´åˆåˆ°å…¶ä»–æŒ‰éˆ•ä¸­
        
        // ç¶å®šå½ˆè·³è¦–çª—æŒ‰éˆ•äº‹ä»¶
        popupRetry.addEventListener('click', () => {
          hidePopupOverlay();
          login();
        });
        
        popupCancel.addEventListener('click', () => {
          hidePopupOverlay();
        });
        
        // éµç›¤å¿«æ·éµ - å·²ç§»è‡³ initChatGPTFeatures ä¸­è™•ç†
      });
      
      // ç™»å…¥åŠŸèƒ½
      async function login() {
        try {
          console.log('DEBUG: Login function called');
          
          // å¾å¾Œç«¯å–å¾— Google èªè­‰ URLï¼ˆéœ€è¦å¾Œç«¯ CORS å…è¨± http://localhost:5173ï¼‰
          console.log('DEBUG: Fetching auth URL from backend...');
          let authUrl = null;
          const fbParam = encodeURIComponent(window.location.origin);
          try {
            const response = await fetch(`https://aivideobackend.zeabur.app/api/auth/google?fb=${fbParam}`);
            const data = await response.json();
            authUrl = data && data.auth_url;
            console.log('DEBUG: Auth URL received:', authUrl);
          } catch (corsErr) {
            console.warn('DEBUG: Fetch auth_url failed (likely CORS). Fallback to direct navigate.', corsErr);
            authUrl = `https://aivideobackend.zeabur.app/api/auth/google?fb=${fbParam}`;
          }
          
          // æª¢æ¸¬æ˜¯å¦ç‚ºæ‰‹æ©Ÿç‰ˆ
          const isMobile = window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
          
          // ä¸€å¾‹æ¡ç”¨ä¸»è¦–çª—è·³è½‰ï¼ˆé¿å…å½ˆçª—è¢«æ“‹èˆ‡é«”é©—ä¸ä¸€è‡´ï¼‰
          console.log('DEBUG: Redirecting to Google auth (main window)');
          window.location.href = authUrl;
          return;

          // ä»¥ä¸‹èˆŠçš„å½ˆçª—æµç¨‹ä¿ç•™æ–¼æ­·å²ï¼Œä¸å†åŸ·è¡Œ
          let popup = null;
          let popupTimeout = null;
          
          // å®šç¾©èªè­‰è¨Šæ¯è™•ç†å‡½æ•¸
          const authMessageHandler = function(event) {
            // å…ˆè¨˜éŒ„æ‰€æœ‰æ”¶åˆ°çš„è¨Šæ¯ï¼ˆç”¨æ–¼èª¿è©¦ï¼‰
            console.log('DEBUG: ğŸ“¥ Received ANY message event:', {
              origin: event.origin,
              source: event.source ? 'window' : 'null',
              data: event.data,
              dataType: typeof event.data,
              currentOrigin: window.location.origin
            });
            
            // æª¢æŸ¥è¨Šæ¯é¡å‹æ˜¯å¦ç‚ºèªè­‰ç›¸é—œ
            const isAuthMessage = event.data && typeof event.data === 'object' && (
              event.data.type === 'GOOGLE_AUTH_SUCCESS' || 
              event.data.type === 'GOOGLE_AUTH_ERROR'
            );
            
            if (!isAuthMessage) {
              console.log('DEBUG: â­ï¸ Ignoring non-auth message. Type:', event.data?.type, 'Data:', event.data);
              return;
            }
            
            console.log('DEBUG: âœ… Auth message detected! Type:', event.data.type);
            console.log('DEBUG: Message origin:', event.origin);
            console.log('DEBUG: Current window origin:', window.location.origin);
            console.log('DEBUG: Full message data:', JSON.stringify(event.data, null, 2));
            
            // æ¥å—ä¾†è‡ªæ‰€æœ‰ origin çš„èªè­‰è¨Šæ¯ï¼ˆå› ç‚ºä½¿ç”¨ '*' targetOriginï¼‰
            // ä½†è¨˜éŒ„ origin ä»¥èª¿è©¦
            const allowedOrigins = [
              'https://aivideobackend.zeabur.app',
              'http://aivideobackend.zeabur.app',
              'https://aivideonew.zeabur.app',
              'http://aivideonew.zeabur.app',
              window.location.origin,
              window.location.protocol + '//' + window.location.host,
              'null'  // æŸäº›æƒ…æ³ä¸‹ origin å¯èƒ½æ˜¯ 'null'
            ];
            
            if (!allowedOrigins.includes(event.origin) && event.origin !== 'null') {
              console.warn('DEBUG: âš ï¸ Message from unexpected origin:', event.origin);
              console.warn('DEBUG: Allowed origins:', allowedOrigins);
              console.warn('DEBUG: But processing anyway since it is auth message with targetOrigin "*"');
            } else {
              console.log('DEBUG: âœ… Origin check passed:', event.origin);
            }
            
            // æ¸…é™¤é€¾æ™‚
            if (popupTimeout) {
              clearTimeout(popupTimeout);
              popupTimeout = null;
            }
            
            // postMessage å·²æˆåŠŸè™•ç†
            
            // é—œé–‰å½ˆè·³è¦–çª—ï¼ˆå¤šç­–ç•¥ + é‡è©¦ï¼‰
            function tryClosePopupNow(){
              try { if (popup) popup.close(); } catch(_) {}
              try { window.open('', 'googleAuth').close(); } catch(_) {}
            }
            tryClosePopupNow();
            let closeRetry = 0;
            const closeTimer = setInterval(() => {
              closeRetry++;
              tryClosePopupNow();
              if (closeRetry >= 6) clearInterval(closeTimer);
            }, 300);
            
              // æ¸…é™¤å®šæœŸæª¢æŸ¥å’Œç§»é™¤äº‹ä»¶ç›£è½å™¨
              if (typeof localStorageCheckInterval !== 'undefined') {
                clearInterval(localStorageCheckInterval);
              }
              window.removeEventListener('message', authMessageHandler);
              window.removeEventListener('storage', storageHandler);
            
            if (event.data.type === 'GOOGLE_AUTH_SUCCESS') {
              console.log('DEBUG: Auth success message received');
              console.log('DEBUG: Full event.data:', JSON.stringify(event.data, null, 2));
              
              // èªè­‰æˆåŠŸï¼Œæ›´æ–° UI
              // å¾Œç«¯ç™¼é€çš„æ˜¯ accessTokenï¼Œéœ€è¦æ˜ å°„åˆ° ipPlanningToken
              ipPlanningToken = event.data.accessToken || event.data.ipPlanningToken;
              
              // è™•ç† user å°è±¡
              if (event.data.user) {
                ipPlanningUser = {
                  user_id: event.data.user.id || event.data.user.user_id,
                  email: event.data.user.email || '',
                  name: event.data.user.name || '',
                  picture: event.data.user.picture || ''
                };
              } else {
                // å¦‚æœæ²’æœ‰ user å°è±¡ï¼Œå˜—è©¦å¾å…¶ä»–å­—æ®µæ§‹å»º
                ipPlanningUser = {
                  user_id: event.data.user_id || event.data.user?.id,
                  email: event.data.email || event.data.user?.email || '',
                  name: event.data.name || event.data.user?.name || '',
                  picture: event.data.picture || event.data.user?.picture || ''
                };
              }
              
              console.log('DEBUG: Processed user data:', ipPlanningUser);
              
              // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
              if (ipPlanningToken) {
                localStorage.setItem('ipPlanningToken', ipPlanningToken);
                console.log('DEBUG: Token saved to localStorage');
              }
              if (ipPlanningUser) {
                localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
                console.log('DEBUG: User data saved to localStorage');
              }
              
              // éš±è—å½ˆçª—è¦†è“‹å±¤
              hidePopupOverlay();
              console.log('DEBUG: Popup overlay hidden');
              
              // æ›´æ–°èªè­‰ UIï¼ˆå¼·åˆ¶æ›´æ–°ï¼‰
              updateAuthUI(true);
              console.log('DEBUG: Auth UI updated');
              
              // é‡æ–°æª¢æŸ¥ç™»å…¥ç‹€æ…‹ï¼ˆç¢ºä¿å…¨åŸŸè®Šæ•¸åŒæ­¥ï¼‰
              ipPlanningToken = localStorage.getItem('ipPlanningToken');
              ipPlanningUser = JSON.parse(localStorage.getItem('ipPlanningUser') || 'null');
              console.log('DEBUG: Global variables synced, token:', ipPlanningToken ? 'present' : 'missing');
              
              // æª¢æŸ¥ä¸¦æ›´æ–°è¨‚é–±ç‹€æ…‹ï¼ˆå…ˆæ›´æ–°è¨‚é–±ç‹€æ…‹ï¼Œå†é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼ï¼‰
              checkSubscriptionStatus().then(async () => {
                // æª¢æŸ¥æ˜¯å¦æœ‰ activation_tokenï¼ˆæˆæ¬Šé€£çµï¼‰
                const hashParams = new URLSearchParams(window.location.hash.slice(1));
                const activationToken = hashParams.get('activation_token');
                if (activationToken) {
                  // ç™»å…¥æˆåŠŸå¾Œï¼Œè‡ªå‹•é©—è­‰æˆæ¬Šï¼ˆç­‰å¾…å®Œæˆï¼‰
                  await handleActivationToken(activationToken);
                  // æ¸…é™¤ hash ä¸­çš„ activation_token
                  const newHash = window.location.hash.replace(/[?&]activation_token=[^&]*/, '').replace(/^#/, '');
                  window.history.replaceState({}, document.title, window.location.pathname + (newHash ? '#' + newHash : ''));
                  // æˆæ¬Šè™•ç†å®Œæˆå¾Œï¼Œå†æ¬¡æª¢æŸ¥è¨‚é–±ç‹€æ…‹ä¸¦é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼
                  await checkSubscriptionStatus();
                  showMainApp();
                  updateHomepageView();
                } else {
                  // æ²’æœ‰æˆæ¬Šé€£çµï¼Œç›´æ¥é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼
                  showMainApp();
                  updateHomepageView();
                }
                console.log('DEBUG: Main app shown after subscription status updated');
              });
              console.log('DEBUG: Subscription status check initiated');
              
              // é¡¯ç¤ºæˆåŠŸæç¤º
              showToast('ç™»å…¥æˆåŠŸï¼', 2000);
              console.log('DEBUG: Login success flow completed');
            } else if (event.data.type === 'GOOGLE_AUTH_ERROR') {
              console.log('DEBUG: Auth error message received:', event.data.error);
              hidePopupOverlay();
              showToast('èªè­‰å¤±æ•—ï¼š' + (event.data.error || 'æœªçŸ¥éŒ¯èª¤'), 5000);
            }
          };
          
          // è™•ç† localStorage æ›´æ–°çš„å‡½æ•¸ï¼ˆä½œç‚º postMessage çš„å‚™ç”¨æ–¹æ¡ˆï¼‰
          const storageHandler = function(event) {
            console.log('DEBUG: ğŸ“¦ Storage event received:', {
              key: event.key,
              newValue: event.newValue,
              oldValue: event.oldValue,
              url: event.url
            });
            
            // æª¢æŸ¥æ˜¯å¦æ˜¯ token æ›´æ–°
            if (event.key === 'ipPlanningTokenUpdated' && event.newValue) {
              console.log('DEBUG: âœ… Token updated in localStorage detected!');
              
              // å¾ localStorage è®€å– token å’Œç”¨æˆ¶è³‡è¨Š
              const newToken = localStorage.getItem('ipPlanningToken');
              const newUserStr = localStorage.getItem('ipPlanningUser');
              
              if (newToken && newToken !== ipPlanningToken) {
                console.log('DEBUG: New token found in localStorage, processing...');
                
                // æ¸…é™¤é€¾æ™‚
                if (popupTimeout) {
                  clearTimeout(popupTimeout);
                  popupTimeout = null;
                }
                
                // æ›´æ–°å…¨åŸŸè®Šæ•¸
                ipPlanningToken = newToken;
                if (newUserStr) {
                  try {
                    ipPlanningUser = JSON.parse(newUserStr);
                  } catch (e) {
                    console.warn('DEBUG: Failed to parse user data:', e);
                  }
                }
                
                // é—œé–‰å½ˆçª—ï¼šé¿å…åœ¨ storage äº‹ä»¶ä¸­è§¸ç™¼ COOP éŒ¯èª¤ï¼Œæ”¹ç”± message handler ä¸»è²¬
                // é€™è£¡ä¸å†å˜—è©¦é—œé–‰ï¼Œä»¥æ¸›å°‘ "Cross-Origin-Opener-Policy would block window.close" çš„è­¦å‘Š
                
                // æ¸…é™¤å®šæœŸæª¢æŸ¥å’Œç§»é™¤ç›£è½å™¨
                if (typeof localStorageCheckInterval !== 'undefined') {
                  clearInterval(localStorageCheckInterval);
                }
                window.removeEventListener('storage', storageHandler);
                window.removeEventListener('message', authMessageHandler);
                
                // éš±è—å½ˆçª—è¦†è“‹å±¤
                hidePopupOverlay();
                console.log('DEBUG: Popup overlay hidden');
                
                // æ›´æ–°èªè­‰ UI
                updateAuthUI(true);
                console.log('DEBUG: Auth UI updated');
                
                // é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼
                showMainApp();
                console.log('DEBUG: Main app shown');
                
              // å…ˆå¼·åˆ¶ refresh ä¸€æ¬¡ï¼Œç¢ºä¿æœå‹™ç«¯èˆ‡å‰ç«¯ token å®Œå…¨åŒæ­¥ï¼Œå†è®€å– me
              (async () => {
                try {
                  console.log('DEBUG: Forcing one refresh after login to sync token...');
                  const t0 = localStorage.getItem('ipPlanningToken') || '';
                  await fetch('https://aivideobackend.zeabur.app/api/auth/refresh', { method: 'POST', headers: t0 ? { 'Authorization': `Bearer ${t0}` } : {} });
                } catch (e) { console.warn('DEBUG: refresh after login failed (can ignore if CORS):', e); }
                try {
                  console.log('DEBUG: Probing /api/auth/me after refresh...');
                  const meRes = await fetch('https://aivideobackend.zeabur.app/api/auth/me');
                  console.log('DEBUG: /api/auth/me status:', meRes.status);
                } catch (e) { console.warn('DEBUG: me probe failed:', e); }
                // æª¢æŸ¥ä¸¦æ›´æ–°è¨‚é–±ç‹€æ…‹ï¼ˆå†ç•¥å¾®å»¶é²ï¼‰
                setTimeout(() => { 
                  try { 
                    checkSubscriptionStatus().then(async () => {
                      // æª¢æŸ¥æ˜¯å¦æœ‰ activation_tokenï¼ˆæˆæ¬Šé€£çµï¼‰
                      const hashParams = new URLSearchParams(window.location.hash.slice(1));
                      const activationToken = hashParams.get('activation_token');
                      if (activationToken) {
                        // ç™»å…¥æˆåŠŸå¾Œï¼Œè‡ªå‹•é©—è­‰æˆæ¬Šï¼ˆç­‰å¾…å®Œæˆï¼‰
                        await handleActivationToken(activationToken);
                        // æ¸…é™¤ hash ä¸­çš„ activation_token
                        const newHash = window.location.hash.replace(/[?&]activation_token=[^&]*/, '').replace(/^#/, '');
                        window.history.replaceState({}, document.title, window.location.pathname + (newHash ? '#' + newHash : ''));
                        // æˆæ¬Šè™•ç†å®Œæˆå¾Œï¼Œå†æ¬¡æª¢æŸ¥è¨‚é–±ç‹€æ…‹ä¸¦é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼
                        await checkSubscriptionStatus();
                        showMainApp();
                        updateHomepageView();
                      } else {
                        // æ²’æœ‰æˆæ¬Šé€£çµï¼Œç›´æ¥é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼
                        showMainApp();
                        updateHomepageView();
                      }
                    }); 
                  } catch(_){} 
                }, 150);
              })();
                console.log('DEBUG: Subscription status checked');
                
                // é¡¯ç¤ºæˆåŠŸæç¤º
                showToast('ç™»å…¥æˆåŠŸï¼', 2000);
                console.log('DEBUG: Login success flow completed (via localStorage)');
              }
            }
          };
          
          // å…ˆè¨»å†Šç›£è½å™¨ï¼ˆé—œéµï¼šåœ¨é–‹å½ˆçª—å‰è¨»å†Šï¼Œç¢ºä¿ä¸æœƒéºæ¼è¨Šæ¯ï¼‰
          console.log('DEBUG: Registering message and storage listeners before opening popup');
          window.addEventListener('message', authMessageHandler, false);
          window.addEventListener('storage', storageHandler, false);
          
          // é¡å¤–çš„å®šæœŸæª¢æŸ¥æ©Ÿåˆ¶ï¼ˆæ¯ 500ms æª¢æŸ¥ä¸€æ¬¡ localStorageï¼Œä½œç‚º storage äº‹ä»¶çš„å‚™ç”¨ï¼‰
          let localStorageCheckInterval = setInterval(function() {
            const checkToken = localStorage.getItem('ipPlanningToken');
            const checkUpdatedFlag = localStorage.getItem('ipPlanningTokenUpdated');
            
            if (checkToken && checkUpdatedFlag && checkToken !== ipPlanningToken) {
              console.log('DEBUG: âœ… Token found in localStorage via polling check');
              clearInterval(localStorageCheckInterval);
              
              // è§¸ç™¼èˆ‡ storageHandler ç›¸åŒçš„è™•ç†é‚è¼¯
              const checkUserStr = localStorage.getItem('ipPlanningUser');
              
              if (popupTimeout) {
                clearTimeout(popupTimeout);
                popupTimeout = null;
              }
              
              ipPlanningToken = checkToken;
              if (checkUserStr) {
                try {
                  ipPlanningUser = JSON.parse(checkUserStr);
                } catch (e) {
                  console.warn('DEBUG: Failed to parse user data:', e);
                }
              }
              
              try {
                if (popup) {
                  popup.close();
                }
              } catch (e) {
                console.warn('DEBUG: Error closing popup:', e);
              }
              
              window.removeEventListener('message', authMessageHandler);
              window.removeEventListener('storage', storageHandler);
              
              hidePopupOverlay();
              updateAuthUI(true);
              showMainApp();
              checkSubscriptionStatus();
              showToast('ç™»å…¥æˆåŠŸï¼', 2000);
              console.log('DEBUG: Login success flow completed (via localStorage polling)');
            }
          }, 500);
          
          // è¨­å®šé€¾æ™‚è™•ç†ï¼ˆ90ç§’ï¼‰
          popupTimeout = setTimeout(() => {
            console.warn('DEBUG: Popup timeout after 90 seconds');
            
            // æ¸…é™¤å®šæœŸæª¢æŸ¥
            clearInterval(localStorageCheckInterval);
            
            // æª¢æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰ tokenï¼ˆæœ€å¾Œçš„å‚™ç”¨æª¢æŸ¥ï¼‰
            const finalToken = localStorage.getItem('ipPlanningToken');
            const finalUserStr = localStorage.getItem('ipPlanningUser');
            
            if (finalToken && finalToken !== ipPlanningToken) {
              console.log('DEBUG: Found token in localStorage during timeout, processing...');
              
              // è™•ç† tokenï¼ˆèˆ‡ storageHandler ç›¸åŒçš„é‚è¼¯ï¼‰
              ipPlanningToken = finalToken;
              if (finalUserStr) {
                try {
                  ipPlanningUser = JSON.parse(finalUserStr);
                } catch (e) {
                  console.warn('DEBUG: Failed to parse user data:', e);
                }
              }
              
              hidePopupOverlay();
              updateAuthUI(true);
              showMainApp();
              checkSubscriptionStatus();
              showToast('ç™»å…¥æˆåŠŸï¼', 2000);
              console.log('DEBUG: Login success flow completed (via localStorage timeout check)');
            } else {
              showPopupError('ç™»å…¥é€¾æ™‚ï¼Œè«‹é‡è©¦', true);
            }
            
            try {
              if (popup) {
                popup.close();
              }
            } catch (e) {
              console.warn('DEBUG: Error closing popup:', e);
            }
            window.removeEventListener('message', authMessageHandler);
            window.removeEventListener('storage', storageHandler);
            popupTimeout = null;
          }, 90000);
          
          // ç¾åœ¨æ‰æ‰“é–‹å½ˆçª—
          console.log('DEBUG: Opening popup window with URL:', authUrl);
          popup = window.open(
            authUrl,
            'googleAuth',
            'width=500,height=600,scrollbars=yes,resizable=yes,status=yes,location=yes,toolbar=no,menubar=no'
          );
          window.__loginWindow = popup;
          
          console.log('DEBUG: Popup window object:', popup);
          
          if (!popup) {
            console.error('DEBUG: Popup window blocked or failed to open');
            hidePopupOverlay();
            showPopupError('è«‹å…è¨±å½ˆè·³è¦–çª—ä»¥å®Œæˆç™»å…¥', true);
            window.removeEventListener('message', authMessageHandler);
            window.removeEventListener('storage', storageHandler);
            if (popupTimeout) {
              clearTimeout(popupTimeout);
            }
            return;
          }
          
          console.log('DEBUG: Popup window opened successfully');
          
          // æ›´æ–°è¦†è“‹å±¤è¨Šæ¯
          updatePopupMessage('è«‹åœ¨å½ˆè·³è¦–çª—ä¸­å®Œæˆ Google ç™»å…¥...');
        } catch (error) {
          console.error('Login error:', error);
          hidePopupOverlay();
          showToast('ç™»å…¥å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 5000);
        }
      }
      
      function showPopupOverlay(message) {
        popupMessage.textContent = message;
        popupSpinner.style.display = 'block';
        popupButtons.style.display = 'none';
        popupOverlay.style.display = 'flex';
      }
      
      function updatePopupMessage(message) {
        popupMessage.textContent = message;
      }
      
      function showPopupError(message, showRetry = false) {
        popupMessage.textContent = message;
        popupSpinner.style.display = 'none';
        if (showRetry) {
          popupButtons.style.display = 'block';
        } else {
          popupButtons.style.display = 'none';
        }
        popupOverlay.style.display = 'flex';
      }
      
      function hidePopupOverlay() {
        popupOverlay.style.display = 'none';
      }
      
      // handleAuthMessage ç¾åœ¨åœ¨ login() å‡½æ•¸ä¸­å‹•æ…‹å‰µå»ºï¼Œä»¥ä¾¿è¨ªå• popup å’Œ timeout å¼•ç”¨
      
      async function checkAuthResult() {
        // æª¢æŸ¥æœ¬åœ°å­˜å„²ä¸­æ˜¯å¦æœ‰æ–°çš„èªè­‰è³‡è¨Š
        const storedToken = localStorage.getItem('ipPlanningToken');
        const storedUser = localStorage.getItem('ipPlanningUser');
        
        if (storedToken && storedUser && storedToken !== ipPlanningToken) {
          ipPlanningToken = storedToken;
          ipPlanningUser = JSON.parse(storedUser);
          
          // ç‚ºç”¨æˆ¶ç”Ÿæˆéš¨æ©ŸIDï¼ˆå¦‚æœæ²’æœ‰ï¼‰
          if (!ipPlanningUser.user_id) {
            ipPlanningUser.user_id = generateUserId();
            localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
            console.log('é é¢è¼‰å…¥æ™‚ç‚ºç”¨æˆ¶ç”Ÿæˆæ–°ID:', ipPlanningUser.user_id);
          }
          
          updateAuthUI(true);
          updatePersonalInfo();
        }
      }
      async function handleAuthCallback() {
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        const userId = urlParams.get('user_id');
        const email = urlParams.get('email');
        const name = urlParams.get('name');
        const picture = urlParams.get('picture');
        const error = urlParams.get('error');
        
        console.log('DEBUG: Checking auth callback parameters:', {
          token: token ? 'present' : 'missing',
          userId: userId ? 'present' : 'missing',
          email: email ? 'present' : 'missing',
          name: name ? 'present' : 'missing',
          picture: picture ? 'present' : 'missing',
          error: error || 'none'
        });
        
        // è™•ç†éŒ¯èª¤
        if (error) {
          console.error('DEBUG: Auth error received:', error);
          showToast('èªè­‰å¤±æ•—ï¼š' + decodeURIComponent(error), 5000);
          updateAuthUI(false);
          // æ¸…é™¤ URL ä¸­çš„éŒ¯èª¤åƒæ•¸
          window.history.replaceState({}, document.title, window.location.pathname);
          return;
        }
        
        // è™•ç†æˆåŠŸèªè­‰
        if (token && userId && email && name) {
          console.log('DEBUG: Auth success parameters received');
          
          // æ§‹å»ºç”¨æˆ¶ç‰©ä»¶
          ipPlanningUser = {
            id: userId,
            email: email,
            name: name,
            picture: picture || ''
          };
          ipPlanningToken = token;
          
          // ä¿å­˜åˆ°æœ¬åœ°å­˜å„²
          localStorage.setItem('ipPlanningToken', ipPlanningToken);
          localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
          
          updateAuthUI(true);
          
          // é¡¯ç¤ºä¸»æ‡‰ç”¨ç¨‹å¼ï¼ˆæœƒéš±è—ç™»å…¥é é¢ã€é¡¯ç¤ºé¦–é ï¼‰
          showMainApp();
          
          // æª¢æŸ¥ä¸¦æ›´æ–°è¨‚é–±ç‹€æ…‹
          await checkSubscriptionStatus();
          
          // æ¸…é™¤ guestMode æ¨™è¨˜ï¼ˆå¦‚æœæœ‰ï¼‰
          localStorage.removeItem('guestMode');
          
          // æ¸…é™¤ URL ä¸­çš„èªè­‰åƒæ•¸
          window.history.replaceState({}, document.title, window.location.pathname);
          
          console.log('DEBUG: Auth completed successfully');
        }
      }

      async function fetchUserInfo() {
        if (!ipPlanningToken) return;
        
        try {
          let response = await fetch('https://aivideobackend.zeabur.app/api/auth/me', {
          headers: { 'Authorization': `Bearer ${ipPlanningToken}` }
        });
          
          // å¦‚æœæ”¶åˆ° 401ï¼Œå˜—è©¦åˆ·æ–° token å¾Œé‡è©¦
          if (response.status === 401) {
            console.log('æ”¶åˆ° 401ï¼Œå˜—è©¦åˆ·æ–° token...');
            const refreshed = await tryRefreshTokenSafe();
            if (refreshed) {
              // Token åˆ·æ–°æˆåŠŸï¼Œä½¿ç”¨æ–° token é‡è©¦
              response = await fetch('https://aivideobackend.zeabur.app/api/auth/me', {
                headers: { 'Authorization': `Bearer ${ipPlanningToken}` }
              });
            } else {
              // Token åˆ·æ–°å¤±æ•—ï¼Œå·²è‡ªå‹•ç™»å‡ºï¼ˆåœ¨ tryRefreshTokenSafe ä¸­è™•ç†ï¼‰
              return;
            }
          }
          
          // å¦‚æœæ”¶åˆ° 403ï¼Œç›´æ¥ç™»å‡º
          if (response.status === 403) {
            let errorMessage = 'èªè­‰å¤±æ•—ï¼Œè«‹é‡æ–°ç™»å…¥';
            try {
              const errorData = await response.clone().json();
              if (errorData.detail) {
                errorMessage = errorData.detail;
              }
            } catch (e) {
              // å¦‚æœç„¡æ³•è§£æ JSONï¼Œä½¿ç”¨é è¨­è¨Šæ¯
            }
            forceLogout(errorMessage);
            return;
          }
        
        if (response.ok) {
          const userData = await response.json();
          ipPlanningUser = userData;
          
          // ç‚ºç”¨æˆ¶ç”Ÿæˆéš¨æ©ŸIDï¼ˆå¦‚æœæ²’æœ‰ï¼‰
          if (!ipPlanningUser.user_id) {
            ipPlanningUser.user_id = generateUserId();
            console.log('ç‚ºç”¨æˆ¶ç”Ÿæˆæ–°ID:', ipPlanningUser.user_id);
          }
          
          localStorage.setItem('ipPlanningUser', JSON.stringify(ipPlanningUser));
          updateAuthUI(true);
          
          // ç«‹å³æ›´æ–°å€‹äººè³‡æ–™é¡¯ç¤º
          updatePersonalInfo();
        } else {
            // å…¶ä»–éŒ¯èª¤ç‹€æ…‹ï¼Œéœé»˜è™•ç†
            console.warn('ç²å–ç”¨æˆ¶è³‡è¨Šå¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜çš„è³‡è¨Š');
            return;
          }
        } catch (error) {
          // ç¶²è·¯éŒ¯èª¤ç­‰ç•°å¸¸ï¼Œéœé»˜è™•ç†ï¼Œä¸æ‹‹å‡ºéŒ¯èª¤
          console.warn('ç²å–ç”¨æˆ¶è³‡è¨Šæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œä½¿ç”¨æœ¬åœ°å„²å­˜çš„è³‡è¨Š');
          return;
        }
      }

      // å½ˆå‡ºæç¤ºæ¡†å‡½æ•¸
      function showToast(message, duration = 3000) {
        toastEl.textContent = message;
        toastEl.style.display = 'block';
        toastEl.className = 'toast show';
        
        setTimeout(() => {
          toastEl.className = 'toast hide';
          setTimeout(() => {
            toastEl.style.display = 'none';
          }, 300);
        }, duration);
      }

      // é€™å€‹äº‹ä»¶ç›£è½å™¨å·²ç¶“åˆä½µåˆ°ä¸Šé¢çš„ DOMContentLoaded ä¸­

      // æ»¾å‹•åˆ°åº•éƒ¨çš„å‡½æ•¸
      function scrollToBottom() {
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
          // ä½¿ç”¨ requestAnimationFrame ç¢ºä¿ DOM æ›´æ–°å¾Œå†æ»¾å‹•
          requestAnimationFrame(() => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
            // å¼·åˆ¶æ»¾å‹•åˆ°æœ€åº•éƒ¨
            setTimeout(() => {
              chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
          });
        }
      }

      // å¼·åˆ¶æ»¾å‹•åˆ°åº•éƒ¨çš„å‡½æ•¸
      function forceScrollToBottom() {
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
          // ç«‹å³æ»¾å‹•åˆ°åº•éƒ¨
          chatMessages.scrollTop = chatMessages.scrollHeight;
          // å»¶é²å†æ¬¡æ»¾å‹•ç¢ºä¿åˆ°é”åº•éƒ¨
          setTimeout(() => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 50);
          setTimeout(() => {
            chatMessages.scrollTop = chatMessages.scrollHeight;
          }, 200);
        }
      }

      // åˆå§‹åŒ–èŠå¤©æ»¾å‹•åŠŸèƒ½
      function initChatScroll() {
        const chatMessages = document.getElementById('chatMessages');
        if (chatMessages) {
          // ç¢ºä¿èŠå¤©å€åŸŸå¯ä»¥æ»¾å‹•
          chatMessages.style.overflowY = 'auto';
          chatMessages.style.scrollBehavior = 'smooth';
          
          // æ·»åŠ æ»¾å‹•äº‹ä»¶ç›£è½å™¨
          chatMessages.addEventListener('scroll', function() {
            // å¯ä»¥æ·»åŠ æ»¾å‹•ç›¸é—œçš„é‚è¼¯ï¼Œæ¯”å¦‚é¡¯ç¤º/éš±è—æ»¾å‹•åˆ°åº•éƒ¨æŒ‰éˆ•
          });
          
          // ç¢ºä¿åˆå§‹ç‹€æ…‹æ»¾å‹•åˆ°åº•éƒ¨
          forceScrollToBottom();
          
          // å»¶é²å†æ¬¡æ»¾å‹•ç¢ºä¿åˆ°é”åº•éƒ¨
          setTimeout(() => {
            forceScrollToBottom();
          }, 500);
        }
      }

      function append(role, text) {
        const div = document.createElement('div');
        div.className = 'msg ' + (role === 'user' ? 'user' : 'assistant');
        
        // å‰µå»ºé ­åƒå…ƒç´ 
        const avatar = document.createElement('div');
        avatar.className = 'msg-avatar';
        
        if (role === 'user') {
          // ç”¨æˆ¶é ­åƒï¼šä½¿ç”¨ Gmail é ­åƒæˆ–é»˜èªé ­åƒ
          const userAvatarImg = document.getElementById('userAvatar');
          if (userAvatarImg && userAvatarImg.src && userAvatarImg.src !== '') {
            avatar.innerHTML = `<img src="${userAvatarImg.src}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;" alt="ç”¨æˆ¶é ­åƒ">`;
          } else {
            avatar.textContent = 'ä½ ';
          }
        } else {
          avatar.textContent = 'ğŸ¤–';
        }
        
        const bubble = document.createElement('div');
        bubble.className = 'msg-bubble';
        
        // å¦‚æœæ˜¯ AI å›è¦†ï¼Œæ¸…ç† Markdown æ ¼å¼
        if (role === 'assistant') {
          const cleanText = cleanMarkdownFormat(text);
          // ä½¿ç”¨å®‰å…¨çš„ HTML è¨­ç½®
          const safeText = escapeHtml(cleanText);
          bubble.innerHTML = `<p>${safeText}</p>`;
        } else {
          // ä½¿ç”¨å®‰å…¨çš„ HTML è¨­ç½®
          const safeText = escapeHtml(text);
          bubble.innerHTML = `<p>${safeText}</p>`;
        }
        
        div.appendChild(avatar);
        div.appendChild(bubble);
        chatEl.appendChild(div);
        
        // ç¢ºä¿æ»¾å‹•åˆ°åº•éƒ¨
        scrollToBottom();
        return { container: div, bubble: bubble };
      }

      // æ¸…ç† Markdown æ ¼å¼ä¸¦è½‰æ›ç‚º HTML
      function cleanMarkdownFormat(text) {
        if (!text) return '';
        
        // è™•ç† Markdown æ¨™é¡Œæ ¼å¼
        text = text.replace(/^###\s*(.+)$/gm, '<strong>$1</strong>'); // ### æ¨™é¡Œ â†’ **æ¨™é¡Œ**
        text = text.replace(/^##\s*(.+)$/gm, '<strong>$1</strong>');  // ## æ¨™é¡Œ â†’ **æ¨™é¡Œ**
        text = text.replace(/^#\s*(.+)$/gm, '<strong>$1</strong>');   // # æ¨™é¡Œ â†’ **æ¨™é¡Œ**
        
        // å°‡ **æ–‡å­—** è½‰æ›ç‚º <strong>æ–‡å­—</strong>
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        
        // è™•ç†å…¶ä»–å¸¸è¦‹çš„ Markdown æ ¼å¼
        text = text.replace(/\*([^*]+)\*/g, '<em>$1</em>');           // *æ–œé«”* â†’ æ–œé«”
        text = text.replace(/`([^`]+)`/g, '<code>$1</code>');         // `ä»£ç¢¼` â†’ ä»£ç¢¼
        
        // ç§»é™¤å–®ç¨çš„ Markdown ç¬¦è™Ÿ
        text = text.replace(/\*\*/g, '');                             // ç§»é™¤å–®ç¨çš„ **
        text = text.replace(/^#{1,6}\s*/gm, '');                      // ç§»é™¤è¡Œé¦–çš„ # ç¬¦è™Ÿ
        
        // è™•ç†åˆ—è¡¨æ ¼å¼
        text = text.replace(/^\d+\.\s*(.+)$/gm, '<div style="margin: 4px 0; padding-left: 16px;">$1</div>'); // æ•¸å­—åˆ—è¡¨
        text = text.replace(/^[-*]\s*(.+)$/gm, '<div style="margin: 4px 0; padding-left: 16px;">â€¢ $1</div>'); // é …ç›®ç¬¦è™Ÿåˆ—è¡¨
        
        // è™•ç†æ›è¡Œç¬¦è™Ÿï¼Œä¿æŒæ®µè½çµæ§‹
        text = text.replace(/\n\n+/g, '</p><p>');                     // å¤šå€‹æ›è¡Œ â†’ æ®µè½åˆ†éš”
        text = text.replace(/\n/g, '<br>');                           // å–®æ›è¡Œ â†’ æ›è¡Œæ¨™ç±¤
        
        // åŒ…è£åœ¨æ®µè½æ¨™ç±¤ä¸­
        if (text && !text.startsWith('<p>')) {
          text = '<p>' + text + '</p>';
        }
        
        return text;
      }

      function updateAssistantNode(nodeObj, text) {
        // æ¸…ç† Markdown æ ¼å¼
        const cleanText = cleanMarkdownFormat(text);
        
        if (nodeObj.bubble) {
          // ä½¿ç”¨ innerHTML ä¾†æ”¯æ´ HTML æ¨™ç±¤ï¼ˆå¦‚ <strong>ï¼‰
          nodeObj.bubble.innerHTML = cleanText;
        } else {
          nodeObj.innerHTML = cleanText;
        }
        
        // ç¢ºä¿æ»¾å‹•åˆ°åº•éƒ¨
        scrollToBottom();
      }

      function canSubmit() {
        if (isSending) return false;
        const now = Date.now();
        if (now - lastSubmitAt < 600) return false; // 600ms ç¯€æµ
        lastSubmitAt = now;
        return true;
      }

      async function send(message) {
        if (!message) return;
        if (!canSubmit()) return;
        lastMessage = message;
        const userNode = append('user', message);
        // è¨˜éŒ„é•·æœŸè¨˜æ†¶
        console.log('ğŸ“ğŸ“ğŸ“ æº–å‚™å„²å­˜é•·æœŸè¨˜æ†¶ (AI é¡§å• - user) ğŸ“ğŸ“ğŸ“');
        console.log('ğŸ“ è¨Šæ¯å…§å®¹:', message);
        console.log('ğŸ“ èª¿ç”¨ recordConversationMessage...');
        try { 
          await recordConversationMessage('ai_advisor', 'user', message); 
          console.log('ğŸ“ recordConversationMessage èª¿ç”¨å®Œæˆ');
        } catch (error) {
          console.error('âŒâŒâŒ é•·æœŸè¨˜æ†¶å„²å­˜ç•°å¸¸ (AI é¡§å• - user) âŒâŒâŒ', error);
          console.error('éŒ¯èª¤å †ç–Š:', error.stack);
        }
        const assistantNode = append('assistant', '');

        // é¡¯ç¤º AI å›è¦†ä¸­çš„è¼‰å…¥ç‹€æ…‹
        const loadingDiv = document.createElement('div');
        loadingDiv.className = 'ai-loading';
        loadingDiv.innerHTML = `
          <span>AIæ­£åœ¨æ€è€ƒä¸­</span>
          <div class="ai-loading-dots">
            <div class="ai-loading-dot"></div>
            <div class="ai-loading-dot"></div>
            <div class="ai-loading-dot"></div>
          </div>
        `;
        assistantNode.bubble.appendChild(loadingDiv);

        sendBtn.disabled = true;
        isSending = true;
        statusEl.textContent = 'æ­£åœ¨é€å‡ºâ€¦';

        try {
          // è‡ªå‹•åµæ¸¬ç’°å¢ƒï¼Œé–‹ç™¼æ™‚ä½¿ç”¨ localhostï¼Œéƒ¨ç½²æ™‚ä½¿ç”¨ç’°å¢ƒè®Šæ•¸æˆ–é è¨­å¾Œç«¯ç¶²åŸŸ
          const isDevelopment = window.location.hostname === 'localhost' || 
                                window.location.hostname === '127.0.0.1' ||
                                window.location.hostname === '0.0.0.0';
          
          // å¦‚æœæ˜¯é–‹ç™¼ç’°å¢ƒï¼Œä½¿ç”¨ localhost:8000ï¼›éƒ¨ç½²ç’°å¢ƒä½¿ç”¨æ­£ç¢ºçš„å¾Œç«¯ç¶²åŸŸ
          let endpoint;
          if (isDevelopment) {
            endpoint = 'https://aivideobackend.zeabur.app/api/chat/stream';
          } else {
            // éƒ¨ç½²ç’°å¢ƒï¼šä½¿ç”¨æ‚¨æä¾›çš„æ­£ç¢ºå¾Œç«¯ç¶²åŸŸ
            endpoint = 'https://aivideobackend.zeabur.app/api/chat/stream';
          }
          // æ·»åŠ èª¿è©¦ä¿¡æ¯
          console.log('API ç«¯é»:', endpoint);
          console.log('ç•¶å‰ä½ç½®:', window.location.href);
          console.log('Hostname:', window.location.hostname);
          console.log('Port:', window.location.port);
          
          // æº–å‚™è«‹æ±‚é ­
          const headers = { 'Content-Type': 'application/json' };
          if (ipPlanningToken) {
            headers['Authorization'] = `Bearer ${ipPlanningToken}`;
          }
          
          const res = await fetch(endpoint, {
            method: 'POST',
            headers,
            body: JSON.stringify({
              message,
              platform: settingsApplied ? appliedSettings.platform : null,
              topic: settingsApplied ? appliedSettings.topic : null,
              duration: settingsApplied ? appliedSettings.duration : null,
              style: styleInstruction,
              profile: settingsApplied ? appliedSettings.positioning : null,
              history,
              user_id: ipPlanningUser?.user_id || null
            })
          });

          if (!res.ok) {
            const text = await res.text().catch(() => '');
            console.error('API è«‹æ±‚å¤±æ•—:', res.status, text);
            
            let errorMessage = `[è«‹æ±‚å¤±æ•— ${res.status}] `;
            try {
              const errorData = JSON.parse(text);
              if (errorData.error) {
                errorMessage += errorData.error;
                if (errorData.error.includes('GEMINI_API_KEY')) {
                  errorMessage += '\n\nğŸ’¡ è§£æ±ºæ–¹æ¡ˆï¼šè«‹åœ¨ Zeabur å¾Œç«¯æœå‹™çš„ç’°å¢ƒè®Šæ•¸ä¸­è¨­å®š GEMINI_API_KEY';
                }
              } else {
                errorMessage += text || 'ç„¡å›æ‡‰å…§å®¹';
              }
            } catch {
              errorMessage += text || 'ç„¡å›æ‡‰å…§å®¹';
            }
            
            updateAssistantNode(assistantNode, errorMessage);
            return;
          }

          const reader = res.body.getReader();
          const decoder = new TextDecoder('utf-8');
          let aiText = '';
          let buffer = '';

          while (true) {
            const { value, done } = await reader.read();
            if (done) break;
            buffer += decoder.decode(value, { stream: true });

            let idx;
            while ((idx = buffer.indexOf('\n\n')) !== -1) {
              const frame = buffer.slice(0, idx).trim();
              buffer = buffer.slice(idx + 2);
              if (!frame.startsWith('data:')) continue;
              try {
                const jsonStr = frame.slice(5).trim();
                const evt = JSON.parse(jsonStr);
                if (evt.type === 'token') {
                  // ç§»é™¤è¼‰å…¥å‹•ç•«ï¼Œé–‹å§‹é¡¯ç¤º AI å›è¦†
                  const loadingDiv = assistantNode.bubble.querySelector('.loading');
                  if (loadingDiv) {
                    loadingDiv.remove();
                  }
                  aiText += evt.content;
                  updateAssistantNode(assistantNode, aiText);
                } else if (evt.type === 'end') {
                  history.push({ role: 'user', content: message });
                  history.push({ role: 'assistant', content: aiText });
                  // è¨˜éŒ„é•·æœŸè¨˜æ†¶
                  console.log('ğŸ“ğŸ“ğŸ“ æº–å‚™å„²å­˜é•·æœŸè¨˜æ†¶ (AI é¡§å• - assistant) ğŸ“ğŸ“ğŸ“');
                  console.log('ğŸ“ AI å›è¦†å…§å®¹é•·åº¦:', aiText.length);
                  console.log('ğŸ“ èª¿ç”¨ recordConversationMessage...');
                  try { 
                    await recordConversationMessage('ai_advisor', 'assistant', aiText); 
                    console.log('ğŸ“ recordConversationMessage èª¿ç”¨å®Œæˆ');
                  } catch (error) {
                    console.error('âŒâŒâŒ é•·æœŸè¨˜æ†¶å„²å­˜ç•°å¸¸ (AI é¡§å• - assistant) âŒâŒâŒ', error);
                    console.error('éŒ¯èª¤å †ç–Š:', error.stack);
                  }
                  
                  // æª¢æŸ¥æ˜¯å¦åŒ…å«è…³æœ¬çµæœï¼Œè‡ªå‹•é¡¯ç¤ºçµæœå€å¡Š
                  checkAndUpdateResults(aiText);
                }
              } catch (e) { /* ignore parse errors */ }
            }
          }
        } catch (e) {
          // ç§»é™¤è¼‰å…¥å‹•ç•«ï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
          const loadingDiv = assistantNode.bubble.querySelector('.loading');
          if (loadingDiv) {
            loadingDiv.remove();
          }
          console.error('è«‹æ±‚éŒ¯èª¤:', e);
          console.error('éŒ¯èª¤è©³æƒ…:', {
            message: e?.message,
            name: e?.name,
            stack: e?.stack,
            endpoint: endpoint,
            location: window.location.href
          });
          
          // æä¾›æ›´è©³ç´°çš„éŒ¯èª¤è¨Šæ¯
          let errorMsg = `[éŒ¯èª¤] ${e?.message || e}`;
          if (e?.name === 'TypeError' && e?.message.includes('fetch')) {
            errorMsg = '[é€£ç·šéŒ¯èª¤] ç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦';
          } else if (e?.name === 'TypeError' && e?.message.includes('Failed to fetch')) {
            errorMsg = '[ç¶²è·¯éŒ¯èª¤] è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–é‡æ–°æ•´ç†é é¢';
          } else if (e?.message?.includes('CORS')) {
            errorMsg = '[è·¨åŸŸéŒ¯èª¤] è«‹å˜—è©¦é‡æ–°æ•´ç†é é¢';
          }
          
          // æ·»åŠ æ›´å¤šèª¿è©¦ä¿¡æ¯
          errorMsg += `\n\nèª¿è©¦ä¿¡æ¯ï¼š\nç«¯é»: ${endpoint}\nä½ç½®: ${window.location.href}`;
          updateAssistantNode(assistantNode, errorMsg);
        } finally {
          sendBtn.disabled = false;
          isSending = false;
          statusEl.textContent = '';
        }
      }

      // é€™äº›äº‹ä»¶ç›£è½å™¨å·²ç¶“åœ¨æ–°çš„ DOMContentLoaded ä¸­è™•ç†

      // è¨­å®šå€å¡Šæ‘ºç–Š/å±•é–‹åŠŸèƒ½
      // è¨­å®šå€å¡Šæ‘ºç–Š/å±•é–‹åŠŸèƒ½å·²ç§»é™¤

      // é€™å€‹äº‹ä»¶ç›£è½å™¨å·²ç¶“åœ¨æ–°çš„ DOMContentLoaded ä¸­è™•ç†

      function updateBadge(badgeEl, label, value) {
        if (value) {
          badgeEl.style.display = 'inline-block';
          badgeEl.textContent = label + 'ï¼š' + value;
        } else {
          badgeEl.style.display = 'none';
          badgeEl.textContent = '';
        }
      }

      // æ¸¬è©¦é€£ç·šåŠŸèƒ½
      async function testConnection() {
        const testNode = append('assistant', 'ğŸ”§ æ­£åœ¨æ¸¬è©¦é€£ç·š...');
        
        try {
          // æ¸¬è©¦å¾Œç«¯æ ¹è·¯å¾‘
          const rootResponse = await fetch('https://aivideobackend.zeabur.app/');
          const rootText = await rootResponse.text();
          
          let testResult = `ğŸ” é€£ç·šæ¸¬è©¦çµæœï¼š\n\n`;
          testResult += `1ï¸âƒ£ å¾Œç«¯æ ¹è·¯å¾‘ï¼š${rootResponse.ok ? 'âœ… æ­£å¸¸' : 'âŒ ç•°å¸¸'} (ç‹€æ…‹ç¢¼: ${rootResponse.status})\n`;
          
          // æ¸¬è©¦å¥åº·æª¢æŸ¥
          try {
            const healthResponse = await fetch('https://aivideobackend.zeabur.app/api/health');
            const healthData = await healthResponse.json();
            
            testResult += `2ï¸âƒ£ å¥åº·æª¢æŸ¥ï¼š${healthResponse.ok ? 'âœ… æ­£å¸¸' : 'âŒ ç•°å¸¸'}\n`;
            testResult += `   - çŸ¥è­˜åº«ï¼š${healthData.kb_status}\n`;
            testResult += `   - Geminié…ç½®ï¼š${healthData.gemini_configured ? 'âœ… å·²é…ç½®' : 'âŒ æœªé…ç½®'}\n`;
            testResult += `   - Geminiæ¸¬è©¦ï¼š${healthData.gemini_test}\n`;
            testResult += `   - æ¨¡å‹ï¼š${healthData.model_name}\n`;
            
            if (!healthData.gemini_configured) {
              testResult += `\nâš ï¸ å•é¡Œï¼šGemini API Key æœªé…ç½®\n`;
              testResult += `ğŸ’¡ è§£æ±ºæ–¹æ¡ˆï¼šè«‹åœ¨ Zeabur å¾Œç«¯ç’°å¢ƒè®Šæ•¸ä¸­è¨­å®š GEMINI_API_KEY\n`;
            } else if (healthData.gemini_test !== 'working') {
              testResult += `\nâš ï¸ å•é¡Œï¼šGemini API é€£ç·šç•°å¸¸\n`;
              testResult += `ğŸ’¡ éŒ¯èª¤ï¼š${healthData.gemini_test}\n`;
            }
            
          } catch (healthError) {
            testResult += `2ï¸âƒ£ å¥åº·æª¢æŸ¥ï¼šâŒ ç„¡æ³•é€£ç·š (${healthError.message})\n`;
          }
          
          // æ¸¬è©¦èŠå¤©API
          try {
            const chatResponse = await fetch('https://aivideobackend.zeabur.app/api/chat/stream', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ message: 'test', platform: null, topic: null, duration: '30' })
            });
            
            testResult += `3ï¸âƒ£ èŠå¤©APIï¼š${chatResponse.ok ? 'âœ… æ­£å¸¸' : 'âŒ ç•°å¸¸'} (ç‹€æ…‹ç¢¼: ${chatResponse.status})\n`;
            
            if (!chatResponse.ok) {
              const errorText = await chatResponse.text();
              testResult += `   éŒ¯èª¤ï¼š${errorText}\n`;
            }
            
          } catch (chatError) {
            testResult += `3ï¸âƒ£ èŠå¤©APIï¼šâŒ ç„¡æ³•é€£ç·š (${chatError.message})\n`;
          }
          
          updateAssistantNode(testNode, testResult);
          
        } catch (error) {
          updateAssistantNode(testNode, `âŒ é€£ç·šæ¸¬è©¦å¤±æ•—ï¼š${error.message}`);
        }
      }

      // æ¸¬è©¦é€£ç·šæŒ‰éˆ•å·²ç§»é™¤

      // æ·»åŠ å…¨å±€æ¸¬è©¦å‡½æ•¸ï¼ˆç”¨æ–¼èª¿è©¦ï¼‰
      window.testDOM = function() {
        console.log('=== DOMå…ƒç´ æ¸¬è©¦ ===');
        console.log('resultTitleEl:', resultTitleEl);
        console.log('resultScriptEl:', resultScriptEl);
        console.log('resultVisualEl:', resultVisualEl);
        console.log('resultCopyEl:', resultCopyEl);
        
        if (resultTitleEl) {
          resultTitleEl.innerHTML = 'æ¸¬è©¦æ¨™é¡Œ';
          console.log('æ¸¬è©¦æ¨™é¡Œè¨­ç½®æˆåŠŸ');
        }
        if (resultScriptEl) {
          resultScriptEl.innerHTML = 'æ¸¬è©¦è…³æœ¬å…§å®¹';
          console.log('æ¸¬è©¦è…³æœ¬å…§å®¹è¨­ç½®æˆåŠŸ');
        }
        if (resultVisualEl) {
          resultVisualEl.innerHTML = 'æ¸¬è©¦ç•«é¢æ„Ÿ';
          console.log('æ¸¬è©¦ç•«é¢æ„Ÿè¨­ç½®æˆåŠŸ');
        }
        if (resultCopyEl) {
          resultCopyEl.innerHTML = 'æ¸¬è©¦ç™¼ä½ˆæ–‡æ¡ˆ';
          console.log('æ¸¬è©¦ç™¼ä½ˆæ–‡æ¡ˆè¨­ç½®æˆåŠŸ');
        }
      };
      
      // æ·»åŠ AIå…§å®¹æ¸¬è©¦å‡½æ•¸
      window.testAIContent = function(aiText) {
        console.log('=== AIå…§å®¹æ¸¬è©¦ ===');
        console.log('æ¸¬è©¦æ–‡æœ¬:', aiText);
        
        const isScript = detectScriptContent(aiText);
        console.log('æ˜¯å¦ç‚ºè…³æœ¬å…§å®¹:', isScript);
        
        if (isScript) {
          const sections = parseAIContent(aiText);
          console.log('è§£æçµæœ:', sections);
          
          // æ›´æ–°DOMå…ƒç´ 
          if (sections.title && resultTitleEl) {
            resultTitleEl.innerHTML = safeRenderMarkdown(sections.title);
            console.log('âœ… ä¸»é¡Œæ¨™é¡Œå·²è¨­ç½®');
          }
          if (sections.script && resultScriptEl) {
            resultScriptEl.innerHTML = safeRenderMarkdown(sections.script);
            console.log('âœ… è…³æœ¬å…§å®¹å·²è¨­ç½®');
          }
          if (sections.visual && resultVisualEl) {
            resultVisualEl.innerHTML = safeRenderMarkdown(sections.visual);
            console.log('âœ… ç•«é¢æ„Ÿå·²è¨­ç½®');
          }
          if (sections.copy && resultCopyEl) {
            resultCopyEl.innerHTML = safeRenderMarkdown(sections.copy);
            console.log('âœ… ç™¼ä½ˆæ–‡æ¡ˆå·²è¨­ç½®');
          }
          
          // é¡¯ç¤ºçµæœå€å¡Š
          resultsEl.style.display = 'block';
          console.log('âœ… çµæœå€å¡Šå·²é¡¯ç¤º');
        }
      };
      
      // æ·»åŠ å¼·åˆ¶æ›´æ–°å‡½æ•¸
      window.forceUpdateResults = function() {
        console.log('=== å¼·åˆ¶æ›´æ–°çµæœå€å¡Š ===');
        
        // å¾èŠå¤©è¨˜éŒ„ä¸­ç²å–æœ€å¾Œä¸€æ¢AIå›æ‡‰
        const chatMessages = document.querySelectorAll('.message.ai');
        if (chatMessages.length > 0) {
          const lastAIMessage = chatMessages[chatMessages.length - 1];
          const aiText = lastAIMessage.textContent || lastAIMessage.innerText;
          
          console.log('ç²å–AIæ–‡æœ¬:', aiText.substring(0, 200) + '...');
          
          const isScript = detectScriptContent(aiText);
          console.log('æ˜¯å¦ç‚ºè…³æœ¬å…§å®¹:', isScript);
          
          if (isScript) {
            const sections = parseAIContent(aiText);
            console.log('è§£æçµæœ:', sections);
            
            // å¼·åˆ¶æ›´æ–°DOMå…ƒç´ 
            if (resultTitleEl) {
              resultTitleEl.innerHTML = safeRenderMarkdown(sections.title || 'æœªæ‰¾åˆ°ä¸»é¡Œæ¨™é¡Œ');
              console.log('âœ… ä¸»é¡Œæ¨™é¡Œå·²å¼·åˆ¶è¨­ç½®');
            }
            if (resultScriptEl) {
              resultScriptEl.innerHTML = safeRenderMarkdown(sections.script || 'æœªæ‰¾åˆ°è…³æœ¬å…§å®¹');
              console.log('âœ… è…³æœ¬å…§å®¹å·²å¼·åˆ¶è¨­ç½®');
            }
            if (resultVisualEl) {
              resultVisualEl.innerHTML = safeRenderMarkdown(sections.visual || 'æœªæ‰¾åˆ°ç•«é¢æ„Ÿ');
              console.log('âœ… ç•«é¢æ„Ÿå·²å¼·åˆ¶è¨­ç½®');
            }
            if (resultCopyEl) {
              resultCopyEl.innerHTML = safeRenderMarkdown(sections.copy || 'æœªæ‰¾åˆ°ç™¼ä½ˆæ–‡æ¡ˆ');
              console.log('âœ… ç™¼ä½ˆæ–‡æ¡ˆå·²å¼·åˆ¶è¨­ç½®');
            }
            
            // é¡¯ç¤ºçµæœå€å¡Š
            resultsEl.style.display = 'block';
            console.log('âœ… çµæœå€å¡Šå·²å¼·åˆ¶é¡¯ç¤º');
          } else {
            console.log('âŒ æª¢æ¸¬å¤±æ•—ï¼Œä¸æ˜¯è…³æœ¬å…§å®¹');
          }
        } else {
          console.log('âŒ æœªæ‰¾åˆ°AIå›æ‡‰');
        }
      };
      
      // æ·»åŠ ç°¡å–®æ¸¬è©¦å‡½æ•¸
      window.testCurrentContent = function() {
        console.log('=== æ¸¬è©¦ç•¶å‰å…§å®¹ ===');
        
        // å¾èŠå¤©è¨˜éŒ„ä¸­ç²å–æœ€å¾Œä¸€æ¢AIå›æ‡‰
        const chatMessages = document.querySelectorAll('.message.ai');
        if (chatMessages.length > 0) {
          const lastAIMessage = chatMessages[chatMessages.length - 1];
          const aiText = lastAIMessage.textContent || lastAIMessage.innerText;
          
          console.log('AIæ–‡æœ¬é•·åº¦:', aiText.length);
          console.log('AIæ–‡æœ¬å‰500å­—ç¬¦:', aiText.substring(0, 500));
          
          // æ¸¬è©¦ä¸»é¡Œæ¨™é¡Œæå–
          const titleMatch = aiText.match(/ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i);
          console.log('ä¸»é¡Œæ¨™é¡ŒåŒ¹é…çµæœ:', titleMatch);
          
          // æ¸¬è©¦è…³æœ¬å…§å®¹æå–
          const scriptMatch = aiText.match(/è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i);
          console.log('è…³æœ¬å…§å®¹åŒ¹é…çµæœ:', scriptMatch ? 'åŒ¹é…' : 'ç„¡åŒ¹é…');
          
          // æ¸¬è©¦ç•«é¢æ„Ÿæå–
          const visualMatch = aiText.match(/ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i);
          console.log('ç•«é¢æ„ŸåŒ¹é…çµæœ:', visualMatch ? 'åŒ¹é…' : 'ç„¡åŒ¹é…');
          
          // æ¸¬è©¦ç™¼ä½ˆæ–‡æ¡ˆæå–
          const copyMatch = aiText.match(/ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i);
          console.log('ç™¼ä½ˆæ–‡æ¡ˆåŒ¹é…çµæœ:', copyMatch ? 'åŒ¹é…' : 'ç„¡åŒ¹é…');
          
          // ç›´æ¥æ›´æ–°çµæœå€å¡Š
          if (titleMatch && titleMatch[1]) {
            resultTitleEl.innerHTML = cleanMarkdownFormat(titleMatch[1].trim());
            console.log('âœ… ç›´æ¥è¨­ç½®ä¸»é¡Œæ¨™é¡Œ');
          }
          if (scriptMatch && scriptMatch[1]) {
            resultScriptEl.innerHTML = cleanMarkdownFormat(scriptMatch[1].trim());
            console.log('âœ… ç›´æ¥è¨­ç½®è…³æœ¬å…§å®¹');
          }
          if (visualMatch && visualMatch[1]) {
            resultVisualEl.innerHTML = cleanMarkdownFormat(visualMatch[1].trim());
            console.log('âœ… ç›´æ¥è¨­ç½®ç•«é¢æ„Ÿ');
          }
          if (copyMatch && copyMatch[1]) {
            resultCopyEl.innerHTML = cleanMarkdownFormat(copyMatch[1].trim());
            console.log('âœ… ç›´æ¥è¨­ç½®ç™¼ä½ˆæ–‡æ¡ˆ');
          }
          
          // é¡¯ç¤ºçµæœå€å¡Š
          resultsEl.style.display = 'block';
          console.log('âœ… çµæœå€å¡Šå·²é¡¯ç¤º');
        } else {
          console.log('âŒ æœªæ‰¾åˆ°AIå›æ‡‰');
        }
      };
      
      // æ·»åŠ è¶…å¼·åŠ›æ¸¬è©¦å‡½æ•¸
      window.forceExtractContent = function() {
        console.log('=== è¶…å¼·åŠ›å…§å®¹æå– ===');
        
        // å¾èŠå¤©è¨˜éŒ„ä¸­ç²å–æœ€å¾Œä¸€æ¢AIå›æ‡‰
        const chatMessages = document.querySelectorAll('.message.ai');
        if (chatMessages.length > 0) {
          const lastAIMessage = chatMessages[chatMessages.length - 1];
          const aiText = lastAIMessage.textContent || lastAIMessage.innerText;
          
          console.log('AIæ–‡æœ¬é•·åº¦:', aiText.length);
          console.log('AIæ–‡æœ¬å‰1000å­—ç¬¦:', aiText.substring(0, 1000));
          
          // å¼·åˆ¶æå–ä¸»é¡Œæ¨™é¡Œ
          let title = '';
          const titlePatterns = [
            /\*\*ä¸»é¡Œæ¨™é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
            /ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /\d+\.\s*\*\*ä¸»é¡Œæ¨™é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
            /\d+\.\s*ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i
          ];
          
          for (const pattern of titlePatterns) {
            const match = aiText.match(pattern);
            if (match && match[1]) {
              title = cleanMarkdownFormat(match[1].trim());
              console.log('âœ… æ‰¾åˆ°ä¸»é¡Œæ¨™é¡Œ:', title);
              break;
            }
          }
          
          // å¼·åˆ¶æå–è…³æœ¬å…§å®¹
          let script = '';
          const scriptPatterns = [
            /\*\*è…³æœ¬å…§å®¹\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*\*\*è…³æœ¬å…§å®¹\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç•«é¢æ„Ÿ|\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç•«é¢æ„Ÿ|\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i
          ];
          
          for (const pattern of scriptPatterns) {
            const match = aiText.match(pattern);
            if (match && match[1]) {
              script = cleanMarkdownFormat(match[1].trim());
              console.log('âœ… æ‰¾åˆ°è…³æœ¬å…§å®¹:', script.substring(0, 100) + '...');
              break;
            }
          }
          
          // å¼·åˆ¶æå–ç•«é¢æ„Ÿ
          let visual = '';
          const visualPatterns = [
            /\*\*ç•«é¢æ„Ÿ\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*\*\*ç•«é¢æ„Ÿ\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i
          ];
          
          for (const pattern of visualPatterns) {
            const match = aiText.match(pattern);
            if (match && match[1]) {
              visual = cleanMarkdownFormat(match[1].trim());
              console.log('âœ… æ‰¾åˆ°ç•«é¢æ„Ÿ:', visual.substring(0, 100) + '...');
              break;
            }
          }
          
          // å¼·åˆ¶æå–ç™¼ä½ˆæ–‡æ¡ˆ
          let copy = '';
          const copyPatterns = [
            /\*\*ç™¼ä½ˆæ–‡æ¡ˆ\*\*[ï¼š:]\s*([\s\S]*?)$/i,
            /ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
            /\d+\.\s*\*\*ç™¼ä½ˆæ–‡æ¡ˆ\*\*[ï¼š:]\s*([\s\S]*?)$/i,
            /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i
          ];
          
          for (const pattern of copyPatterns) {
            const match = aiText.match(pattern);
            if (match && match[1]) {
              copy = cleanMarkdownFormat(match[1].trim());
              console.log('âœ… æ‰¾åˆ°ç™¼ä½ˆæ–‡æ¡ˆ:', copy.substring(0, 100) + '...');
              break;
            }
          }
          
          // å¼·åˆ¶æ›´æ–°çµæœå€å¡Š
          if (title) {
            resultTitleEl.innerHTML = title;
            console.log('âœ… å¼·åˆ¶è¨­ç½®ä¸»é¡Œæ¨™é¡Œ');
          }
          if (script) {
            resultScriptEl.innerHTML = script;
            console.log('âœ… å¼·åˆ¶è¨­ç½®è…³æœ¬å…§å®¹');
          }
          if (visual) {
            resultVisualEl.innerHTML = visual;
            console.log('âœ… å¼·åˆ¶è¨­ç½®ç•«é¢æ„Ÿ');
          }
          if (copy) {
            resultCopyEl.innerHTML = copy;
            console.log('âœ… å¼·åˆ¶è¨­ç½®ç™¼ä½ˆæ–‡æ¡ˆ');
          }
          
          // é¡¯ç¤ºçµæœå€å¡Š
          resultsEl.style.display = 'block';
          console.log('âœ… çµæœå€å¡Šå·²å¼·åˆ¶é¡¯ç¤º');
          
          // å¦‚æœé‚„æ˜¯æ²’æœ‰å…§å®¹ï¼Œé¡¯ç¤ºåŸå§‹æ–‡æœ¬
          if (!title && !script && !visual && !copy) {
            console.log('âš ï¸ æ‰€æœ‰æå–éƒ½å¤±æ•—ï¼Œé¡¯ç¤ºåŸå§‹æ–‡æœ¬');
            resultTitleEl.innerHTML = escapeHtml('åŸå§‹AIå›æ‡‰');
            resultScriptEl.innerHTML = escapeHtml(aiText.substring(0, 500) + '...');
            resultVisualEl.innerHTML = escapeHtml('è«‹æª¢æŸ¥æ§åˆ¶å°æ—¥èªŒ');
            resultCopyEl.innerHTML = escapeHtml('è§£æå¤±æ•—');
          }
        } else {
          console.log('âŒ æœªæ‰¾åˆ°AIå›æ‡‰');
        }
      };
      // æ·»åŠ çµ‚æ¥µè§£æ±ºæ–¹æ¡ˆï¼šç›´æ¥å¾é é¢æå–
      window.extractFromPage = function() {
        console.log('=== çµ‚æ¥µè§£æ±ºæ–¹æ¡ˆï¼šå¾é é¢ç›´æ¥æå– ===');
        
        // æ–¹æ³•1ï¼šå¾èŠå¤©è¨˜éŒ„ä¸­æå–
        const chatMessages = document.querySelectorAll('.message.ai');
        if (chatMessages.length > 0) {
          const lastAIMessage = chatMessages[chatMessages.length - 1];
          const aiText = lastAIMessage.textContent || lastAIMessage.innerText;
          
          console.log('å¾èŠå¤©è¨˜éŒ„æå–ï¼Œæ–‡æœ¬é•·åº¦:', aiText.length);
          
          // ç°¡å–®ç²—æš´çš„æå–æ–¹æ³•
          const lines = aiText.split('\n').filter(line => line.trim().length > 0);
          console.log('ç¸½è¡Œæ•¸:', lines.length);
          
          let title = '';
          let script = '';
          let visual = '';
          let copy = '';
          
          // é€è¡Œæƒæï¼Œæ‰¾åˆ°é—œéµè©å°±æå–
          for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();
            
            // æå–ä¸»é¡Œæ¨™é¡Œ
            if (line.includes('ä¸»é¡Œæ¨™é¡Œ') && line.includes('ï¼š')) {
              const match = line.match(/ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*(.+)/i);
              if (match && match[1]) {
                title = cleanMarkdownFormat(match[1].trim());
                console.log('âœ… æ‰¾åˆ°ä¸»é¡Œæ¨™é¡Œ:', title);
              }
            }
            
            // æå–è…³æœ¬å…§å®¹
            if (line.includes('è…³æœ¬å…§å®¹') && line.includes('ï¼š')) {
              let scriptLines = [];
              for (let j = i + 1; j < lines.length; j++) {
                const nextLine = lines[j].trim();
                if (nextLine.includes('ç•«é¢æ„Ÿ') || nextLine.includes('ç™¼ä½ˆæ–‡æ¡ˆ') || nextLine.includes('3.') || nextLine.includes('4.')) {
                  break;
                }
                if (nextLine.length > 0) {
                  scriptLines.push(nextLine);
                }
              }
              if (scriptLines.length > 0) {
                script = cleanMarkdownFormat(scriptLines.join('\n'));
                console.log('âœ… æ‰¾åˆ°è…³æœ¬å…§å®¹:', script.substring(0, 100) + '...');
              }
            }
            
            // æå–ç•«é¢æ„Ÿ
            if (line.includes('ç•«é¢æ„Ÿ') && line.includes('ï¼š')) {
              let visualLines = [];
              for (let j = i + 1; j < lines.length; j++) {
                const nextLine = lines[j].trim();
                if (nextLine.includes('ç™¼ä½ˆæ–‡æ¡ˆ') || nextLine.includes('4.')) {
                  break;
                }
                if (nextLine.length > 0) {
                  visualLines.push(nextLine);
                }
              }
              if (visualLines.length > 0) {
                visual = cleanMarkdownFormat(visualLines.join('\n'));
                console.log('âœ… æ‰¾åˆ°ç•«é¢æ„Ÿ:', visual.substring(0, 100) + '...');
              }
            }
            
            // æå–ç™¼ä½ˆæ–‡æ¡ˆ
            if (line.includes('ç™¼ä½ˆæ–‡æ¡ˆ') && line.includes('ï¼š')) {
              let copyLines = [];
              for (let j = i + 1; j < lines.length; j++) {
                const nextLine = lines[j].trim();
                if (nextLine.length > 0) {
                  copyLines.push(nextLine);
                }
              }
              if (copyLines.length > 0) {
                copy = cleanMarkdownFormat(copyLines.join('\n'));
                console.log('âœ… æ‰¾åˆ°ç™¼ä½ˆæ–‡æ¡ˆ:', copy.substring(0, 100) + '...');
              }
            }
          }
          
          // æ›´æ–°çµæœå€å¡Š
          if (title) {
            resultTitleEl.innerHTML = title;
            console.log('âœ… è¨­ç½®ä¸»é¡Œæ¨™é¡Œ');
          }
          if (script) {
            resultScriptEl.innerHTML = script;
            console.log('âœ… è¨­ç½®è…³æœ¬å…§å®¹');
          }
          if (visual) {
            resultVisualEl.innerHTML = visual;
            console.log('âœ… è¨­ç½®ç•«é¢æ„Ÿ');
          }
          if (copy) {
            resultCopyEl.innerHTML = copy;
            console.log('âœ… è¨­ç½®ç™¼ä½ˆæ–‡æ¡ˆ');
          }
          
          // é¡¯ç¤ºçµæœå€å¡Š
          resultsEl.style.display = 'block';
          console.log('âœ… çµæœå€å¡Šå·²é¡¯ç¤º');
          
          // å¦‚æœé‚„æ˜¯æ²’æœ‰å…§å®¹ï¼Œé¡¯ç¤ºåŸå§‹æ–‡æœ¬
          if (!title && !script && !visual && !copy) {
            console.log('âš ï¸ æ‰€æœ‰æå–éƒ½å¤±æ•—ï¼Œé¡¯ç¤ºåŸå§‹æ–‡æœ¬');
            resultTitleEl.innerHTML = escapeHtml('åŸå§‹AIå›æ‡‰');
            resultScriptEl.innerHTML = escapeHtml(aiText.substring(0, 500) + '...');
            resultVisualEl.innerHTML = escapeHtml('è«‹æª¢æŸ¥æ§åˆ¶å°æ—¥èªŒ');
            resultCopyEl.innerHTML = escapeHtml('è§£æå¤±æ•—');
          }
        } else {
          console.log('âŒ æœªæ‰¾åˆ°AIå›æ‡‰');
        }
      };

      // å¿«é€ŸæŒ‰éˆ•åŠŸèƒ½å·²ç§»åˆ° DOMContentLoaded äº‹ä»¶ä¸­

      // æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦è¦æ±‚ç”Ÿæˆè…³æœ¬
      function checkIfScriptRequest(aiText) {
        console.log('=== æª¢æŸ¥æ˜¯å¦ç‚ºè…³æœ¬ç”Ÿæˆè«‹æ±‚ ===');
        
        // æª¢æŸ¥AIå›æ‡‰ä¸­æ˜¯å¦åŒ…å«è…³æœ¬ç”Ÿæˆç›¸é—œçš„é—œéµè©
        const scriptRequestKeywords = [
          'çŸ­å½±éŸ³è…³æœ¬',
          'ç”Ÿæˆè…³æœ¬',
          'è…³æœ¬ç”Ÿæˆ',
          'è…³æœ¬å…§å®¹',
          'ä¸»é¡Œæ¨™é¡Œ',
          'ç•«é¢æ„Ÿ',
          'ç™¼ä½ˆæ–‡æ¡ˆ',
          'Hook',
          'Value',
          'CTA',
          'çŸ­å½±éŸ³',
          'è…³æœ¬',
          'Reels',
          'TikTok',
          'å°ç´…æ›¸'
        ];
        
        const hasScriptKeywords = scriptRequestKeywords.some(keyword => 
          aiText.toLowerCase().includes(keyword.toLowerCase())
        );
        
        // æª¢æŸ¥æ˜¯å¦åŒ…å«è…³æœ¬çµæ§‹æ¨™è¨˜
        const hasScriptStructure = [
          /ä¸»é¡Œæ¨™é¡Œ[ï¼š:]/i,
          /è…³æœ¬å…§å®¹[ï¼š:]/i,
          /ç•«é¢æ„Ÿ[ï¼š:]/i,
          /ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]/i,
          /\d+\.\s*ä¸»é¡Œæ¨™é¡Œ/i,
          /\d+\.\s*è…³æœ¬å…§å®¹/i,
          /\d+\.\s*ç•«é¢æ„Ÿ/i,
          /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ/i,
          /Hook\s*\(\d+-\d+ç§’\)/i,
          /Value\s*\d+\s*\(\d+-\d+ç§’\)/i,
          /CTA\s*\(\d+-\d+ç§’\)/i
        ].some(pattern => pattern.test(aiText));
        
        const isScriptRequest = hasScriptKeywords || hasScriptStructure;
        
        console.log('åŒ…å«è…³æœ¬é—œéµè©:', hasScriptKeywords);
        console.log('åŒ…å«è…³æœ¬çµæ§‹:', hasScriptStructure);
        console.log('åˆ¤æ–·ç‚ºè…³æœ¬è«‹æ±‚:', isScriptRequest);
        
        return isScriptRequest;
      }

      // ====== é•·æœŸè¨˜æ†¶èˆ‡æœƒè©±ï¼šæœ€å°å¢é‡å¯¦ä½œï¼ˆä¸å½±éŸ¿æ—¢æœ‰åŠŸèƒ½ï¼‰ ======
      function getCurrentSessionId(conversationType) {
        const key = `session_${conversationType}`;
        let sid = localStorage.getItem(key);
        if (!sid) {
          sid = `${conversationType}_${Date.now().toString(36)}_${Math.random().toString(36).slice(2, 8)}`;
          localStorage.setItem(key, sid);
        }
        return sid;
      }

      async function recordConversationMessage(conversationType, role, content) {
        // å¼·åˆ¶è¼¸å‡ºæ—¥èªŒï¼Œç¢ºä¿å‡½æ•¸è¢«èª¿ç”¨æ™‚ä¸€å®šæœƒçœ‹åˆ°
        console.log('ğŸ”ğŸ”ğŸ” recordConversationMessage å‡½æ•¸è¢«èª¿ç”¨ ğŸ”ğŸ”ğŸ”');
        console.log('ğŸ“‹ åƒæ•¸:', { conversationType, role, hasContent: !!content, contentLength: content?.length || 0 });
        console.log('ğŸ“‹ å…§å®¹é è¦½:', content ? content.substring(0, 50) + '...' : 'ç„¡å…§å®¹');
        
        try {
          if (!content) {
            console.warn('âš ï¸ é•·æœŸè¨˜æ†¶å„²å­˜è·³éï¼šå…§å®¹ç‚ºç©º');
            console.log('âŒ å‡½æ•¸æå‰è¿”å›ï¼šå…§å®¹ç‚ºç©º');
            return;
          }
          
          // å„ªå…ˆå¾ localStorage ç²å–æœ€æ–°çš„ tokenï¼ˆç¢ºä¿ä½¿ç”¨ç•¶å‰ç™»å…¥ç”¨æˆ¶çš„ tokenï¼‰
          let token = localStorage.getItem('ipPlanningToken');
          
          // å¦‚æœ localStorage æ²’æœ‰ï¼Œå˜—è©¦å¾ window.Auth ç²å–
          if (!token && typeof window.Auth !== 'undefined' && window.Auth.getToken) {
            token = window.Auth.getToken();
          }
          
          // å¦‚æœé‚„æ˜¯æ²’æœ‰ï¼Œå˜—è©¦å¾å…¨å±€è®Šæ•¸ç²å–ï¼ˆä½†é€™å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ï¼‰
          if (!token) {
            token = ipPlanningToken;
          }
          
          // å¦‚æœé‚„æ˜¯æ²’æœ‰ tokenï¼Œç„¡æ³•å„²å­˜é•·æœŸè¨˜æ†¶
          if (!token) {
            console.error('âŒâŒâŒ é•·æœŸè¨˜æ†¶å„²å­˜å¤±æ•—ï¼šæœªæ‰¾åˆ°æœ‰æ•ˆçš„èªè­‰ token âŒâŒâŒ');
            console.error('è©³ç´°è³‡è¨Š:', {
              conversationType,
              role,
              contentLength: content.length,
              localStorageToken: !!localStorage.getItem('ipPlanningToken'),
              windowAuth: typeof window.Auth !== 'undefined',
              globalToken: !!ipPlanningToken
            });
            console.log('âŒ å‡½æ•¸æå‰è¿”å›ï¼šæ²’æœ‰ token');
            return;
          }
          
          // èª¿è©¦ï¼šè¨˜éŒ„ token ç²å–æƒ…æ³
          console.log('é•·æœŸè¨˜æ†¶å„²å­˜é–‹å§‹:', {
            conversationType,
            role,
            hasToken: !!token,
            tokenPrefix: token ? token.substring(0, 20) + '...' : 'ç„¡'
          });
          
          // åŒæ­¥æ›´æ–°å…¨å±€è®Šæ•¸ï¼ˆç¢ºä¿ä¸€è‡´æ€§ï¼‰
          if (token !== ipPlanningToken) {
            ipPlanningToken = token;
          }
          
          // ç²å–ç”¨æˆ¶è³‡è¨Šï¼ˆå„ªå…ˆå¾ localStorage ç²å–æœ€æ–°è³‡æ–™ï¼‰
          let user = null;
          try {
            const userStr = localStorage.getItem('ipPlanningUser');
            if (userStr) {
              user = JSON.parse(userStr);
            }
          } catch (e) {
            console.warn('ç„¡æ³•è§£æç”¨æˆ¶è³‡æ–™:', e);
          }
          
          // å¦‚æœ localStorage æ²’æœ‰ï¼Œä½¿ç”¨å…¨å±€è®Šæ•¸
          if (!user) {
            user = ipPlanningUser || {};
          }
          
          // ç¢ºä¿ user_id å­˜åœ¨
          if (!user.user_id) {
            if (user.id) {
              user.user_id = user.id;
              console.log('å¾ user.id ç²å– user_id:', user.user_id);
            } else {
              // å˜—è©¦å¾ token ä¸­è§£æ user_idï¼ˆJWT payloadï¼‰
              try {
                const parts = token.split('.');
                if (parts.length === 3) {
                  const payload = JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/')));
                  console.log('JWT Payload:', payload);
                  if (payload.sub) {
                    user.user_id = payload.sub;
                    console.log('å¾ payload.sub ç²å– user_id:', user.user_id);
                  } else if (payload.user_id) {
                    user.user_id = payload.user_id;
                    console.log('å¾ payload.user_id ç²å– user_id:', user.user_id);
                  } else {
                    console.warn('JWT payload ä¸­æ²’æœ‰æ‰¾åˆ° user_idï¼Œpayload keys:', Object.keys(payload));
                  }
                }
              } catch (e) {
                console.warn('ç„¡æ³•å¾ token è§£æ user_id:', e);
              }
            }
            
            // å¦‚æœé‚„æ˜¯æ²’æœ‰ user_idï¼Œç„¡æ³•å„²å­˜
            if (!user.user_id) {
              console.error('é•·æœŸè¨˜æ†¶å„²å­˜å¤±æ•—ï¼šç„¡æ³•ç²å– user_id', {
                conversationType,
                role,
                user: user,
                hasToken: !!token
              });
              return;
            }
            
            // æ›´æ–°å…¨å±€è®Šæ•¸å’Œ localStorage
            ipPlanningUser = user;
            try {
              localStorage.setItem('ipPlanningUser', JSON.stringify(user));
            } catch (_) {}
          } else {
            console.log('ä½¿ç”¨ç¾æœ‰çš„ user_id:', user.user_id);
          }
          
          const sessionId = getCurrentSessionId(conversationType);
          
          // ç™¼é€é•·æœŸè¨˜æ†¶å„²å­˜è«‹æ±‚
          const res = await fetch('https://aivideobackend.zeabur.app/api/memory/long-term', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
              conversation_type: conversationType,
              session_id: sessionId,
              message_role: role,
              message_content: content
            })
          });
          
          // èª¿è©¦ï¼šè¨˜éŒ„ API è«‹æ±‚è©³æƒ…
          console.log('é•·æœŸè¨˜æ†¶ API è«‹æ±‚:', {
            url: 'https://aivideobackend.zeabur.app/api/memory/long-term',
            conversationType,
            role,
            sessionId,
            user_id: user.user_id,
            contentLength: content.length
          });
          
          if (!res.ok && res.status !== 422) {
            // ä¸è™•ç† 422ï¼ˆé‡è¤‡è¨˜éŒ„ï¼‰ï¼Œå…¶ä»–éŒ¯èª¤å˜—è©¦è™•ç†
            const errorText = await res.text().catch(() => '');
            console.error('é•·æœŸè¨˜æ†¶å„²å­˜å¤±æ•—:', {
              status: res.status,
              statusText: res.statusText,
              error: errorText,
              conversationType,
              role,
              user_id: user.user_id
            });
            
            if (res.status === 401) {
              // Token å¯èƒ½å·²éæœŸï¼Œå˜—è©¦åˆ·æ–°
              console.log('é•·æœŸè¨˜æ†¶å„²å­˜å¤±æ•—ï¼šToken å¯èƒ½å·²éæœŸï¼Œå˜—è©¦åˆ·æ–°...');
              const ok = await tryRefreshTokenSafe();
              if (ok) {
                // åˆ·æ–°æˆåŠŸå¾Œé‡æ–°ç²å–æœ€æ–°çš„ token ä¸¦é‡è©¦
                const newToken = localStorage.getItem('ipPlanningToken') || 
                               (window.Auth && window.Auth.getToken ? window.Auth.getToken() : null);
                if (newToken) {
                  console.log('Token åˆ·æ–°æˆåŠŸï¼Œé‡æ–°å˜—è©¦å„²å­˜é•·æœŸè¨˜æ†¶...');
                  return recordConversationMessage(conversationType, role, content);
                }
              } else {
                console.error('é•·æœŸè¨˜æ†¶å„²å­˜å¤±æ•—ï¼šToken åˆ·æ–°å¤±æ•—');
              }
            } else if (res.status === 403) {
              console.error('é•·æœŸè¨˜æ†¶å„²å­˜å¤±æ•—ï¼šæ¬Šé™ä¸è¶³ (403)');
            } else if (res.status >= 500) {
              console.error('é•·æœŸè¨˜æ†¶å„²å­˜å¤±æ•—ï¼šä¼ºæœå™¨éŒ¯èª¤ (500+)');
            }
          } else if (res.ok) {
            // æˆåŠŸå„²å­˜
            console.log('âœ… é•·æœŸè¨˜æ†¶å„²å­˜æˆåŠŸ:', {
              conversationType,
              role,
              user_id: user.user_id,
              sessionId
            });
          } else if (res.status === 422) {
            // 422 è¡¨ç¤ºé‡è¤‡è¨˜éŒ„ï¼Œé€™æ˜¯æ­£å¸¸çš„
            console.log('é•·æœŸè¨˜æ†¶å„²å­˜ï¼šé‡è¤‡è¨˜éŒ„ (422)ï¼Œå·²è·³é');
          }
        } catch (error) {
          // è¨˜éŒ„éŒ¯èª¤ä½†ä¸å½±éŸ¿ä½¿ç”¨è€…é«”é©—
          console.error('é•·æœŸè¨˜æ†¶å„²å­˜æ™‚ç™¼ç”ŸéŒ¯èª¤:', {
            error: error.message,
            stack: error.stack,
            conversationType,
            role
          });
        }
      }

      // æª¢æŸ¥ token æ˜¯å¦å·²éæœŸ
      function isTokenExpired(token) {
        if (!token) return true;
        try {
          // è§£æ JWT tokenï¼ˆç°¡å–®æ ¼å¼ï¼šheader.payload.signatureï¼‰
          const parts = token.split('.');
          if (parts.length !== 3) return true;
          
          // è§£ç¢¼ payload
          const payload = JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/')));
          
          // æª¢æŸ¥éæœŸæ™‚é–“
          if (payload.exp) {
            const now = Math.floor(Date.now() / 1000);
            return payload.exp < now; // å·²éæœŸ
          }
          return true; // å¦‚æœæ²’æœ‰ expï¼Œèªç‚ºå·²éæœŸ
        } catch (e) {
          console.error('æª¢æŸ¥ token éæœŸæ™‚å‡ºéŒ¯:', e);
          return true; // å¦‚æœç„¡æ³•è§£æï¼Œè¦–ç‚ºéæœŸ
        }
      }

      // æª¢æŸ¥ token æ˜¯å¦å³å°‡éæœŸæˆ–å·²éæœŸ
      function isTokenExpiringSoon(token) {
        if (!token) return true;
        try {
          // è§£æ JWT tokenï¼ˆç°¡å–®æ ¼å¼ï¼šheader.payload.signatureï¼‰
          const parts = token.split('.');
          if (parts.length !== 3) return true;
          
          // è§£ç¢¼ payload
          const payload = JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/')));
          
          // æª¢æŸ¥éæœŸæ™‚é–“
          if (payload.exp) {
            const now = Math.floor(Date.now() / 1000);
            const expiresIn = payload.exp - now;
            // å¦‚æœå·²ç¶“éæœŸï¼Œæˆ–å°‡åœ¨ 5 åˆ†é˜å…§éæœŸï¼Œå‰‡è¿”å› true
            return expiresIn < 300; // 5 åˆ†é˜ = 300 ç§’
          }
          return true; // å¦‚æœæ²’æœ‰ expï¼Œèªç‚ºå·²éæœŸ
        } catch (e) {
          // è§£æå¤±æ•—ï¼Œèªç‚ºå·²éæœŸ
          return true;
        }
      }

      // å¼·åˆ¶ç™»å‡ºä¸¦æ¸…é™¤æ‰€æœ‰ç‹€æ…‹
      function forceLogout(reason = 'ç™»å…¥å·²éæœŸï¼Œè«‹é‡æ–°ç™»å…¥') {
        // æ¸…é™¤ token å’Œç”¨æˆ¶è³‡æ–™
        ipPlanningToken = null;
        ipPlanningUser = null;
        localStorage.removeItem('ipPlanningToken');
        localStorage.removeItem('ipPlanningUser');
        localStorage.removeItem('subscriptionStatus');
        
        // æ›´æ–° UI
        updateAuthUI(false);
        showLoginButton();
        
        // é¡¯ç¤ºæç¤º
        showToast(reason || 'ç™»å…¥å·²éæœŸï¼Œè«‹é‡æ–°ç™»å…¥', 5000);
        
        // é—œé–‰ç”¨æˆ¶æŠ½å±œ
        closeUserDrawer();
        
        // æ›´æ–°è¨‚é–±ç‹€æ…‹
        document.body.dataset.subscribed = 'false';
        
        console.log('å·²è‡ªå‹•ç™»å‡º:', reason);
      }

      // ä¸»å‹•åˆ·æ–° tokenï¼ˆåœ¨é é¢è¼‰å…¥æ™‚èª¿ç”¨ï¼‰
      async function proactiveRefreshToken() {
        if (!ipPlanningToken || !ipPlanningUser) return false;
        
        // æª¢æŸ¥ token æ˜¯å¦å³å°‡éæœŸ
        if (!isTokenExpiringSoon(ipPlanningToken)) {
          return false; // token é‚„æœ‰æ•ˆï¼Œä¸éœ€è¦åˆ·æ–°
        }
        
        console.log('Token å³å°‡éæœŸæˆ–å·²éæœŸï¼Œå˜—è©¦åˆ·æ–°...');
        return await tryRefreshTokenSafe();
      }

      async function tryRefreshTokenSafe() {
        // é˜²æ­¢é‡è¤‡åˆ·æ–°ï¼šå¦‚æœæ­£åœ¨åˆ·æ–°æˆ–æœ€è¿‘ 30 ç§’å…§å˜—è©¦éï¼Œç›´æ¥è¿”å›
        if (isRefreshingToken) {
          return false;
        }
        
        const now = Date.now();
        if (lastRefreshAttempt > 0 && (now - lastRefreshAttempt) < 30000) {
          // 30 ç§’å…§å˜—è©¦éï¼Œç›´æ¥è¿”å›ä¸Šæ¬¡çµæœ
          return false;
        }
        
        try {
          if (!ipPlanningToken) return false;
          
          isRefreshingToken = true;
          lastRefreshAttempt = now;
          
          // å¦‚æœ token å·²ç¶“éæœŸï¼Œå¯èƒ½ç„¡æ³•é€šéé©—è­‰ï¼Œä½†ä»å˜—è©¦åˆ·æ–°
          const r = await fetch('https://aivideobackend.zeabur.app/api/auth/refresh', {
            method: 'POST',
            headers: { 'Authorization': `Bearer ${ipPlanningToken}` }
          });
          
          if (!r.ok) {
            // 401 ä»£è¡¨ refresh å¤±æ•ˆï¼ˆtoken å·²éæœŸä¸”ç„¡æ³•åˆ·æ–°ï¼‰
            // å˜—è©¦å¾å›æ‡‰ä¸­ç²å–éŒ¯èª¤è¨Šæ¯
            let errorMessage = 'ç™»å…¥å·²éæœŸï¼Œè«‹é‡æ–°ç™»å…¥';
            try {
              const errorData = await r.clone().json();
              if (errorData.detail) {
                errorMessage = errorData.detail;
              }
            } catch (e) {
              // å¦‚æœç„¡æ³•è§£æ JSONï¼Œä½¿ç”¨é è¨­è¨Šæ¯
            }
            
            // Token ç„¡æ³•åˆ·æ–°ï¼Œå¼·åˆ¶ç™»å‡º
            isRefreshingToken = false;
            forceLogout(errorMessage);
            return false;
          }
          
          const data = await r.json();
          if (data?.access_token) {
            ipPlanningToken = data.access_token;
            localStorage.setItem('ipPlanningToken', ipPlanningToken);
            isRefreshingToken = false;
            lastRefreshAttempt = 0; // æˆåŠŸå¾Œé‡ç½®
            return true;
          }
          
          isRefreshingToken = false;
          return false;
        } catch (error) {
          // ç¶²è·¯éŒ¯èª¤ï¼šå¦‚æœæ˜¯ç¶²è·¯éŒ¯èª¤ï¼Œä¸ç™»å‡ºï¼ˆå¯èƒ½æ˜¯æš«æ™‚çš„é€£ç·šå•é¡Œï¼‰
          if (error.name === 'TypeError' && error.message.includes('fetch')) {
            isRefreshingToken = false;
            return false;
          }
          
          // å…¶ä»–éŒ¯èª¤ï¼šå¼·åˆ¶ç™»å‡º
          isRefreshingToken = false;
          forceLogout('åˆ·æ–°ç™»å…¥ç‹€æ…‹å¤±æ•—ï¼Œè«‹é‡æ–°ç™»å…¥');
          return false;
        }
      }

      // æœƒè©±èˆ‡æ­·å²ï¼šåƒ…æä¾›æœ€å°å¯ç”¨ APIï¼ˆå¯ç”± UI è§¸ç™¼ï¼‰
      async function getSessionList(conversationType) {
        if (!ipPlanningUser?.user_id) {
          console.warn('å°šæœªå»ºç«‹ user_idï¼Œè·³éæœƒè©±åˆ—è¡¨');
          return [];
        }
        try {
          const res = await fetch(`https://aivideobackend.zeabur.app/api/memory/sessions?conversation_type=${encodeURIComponent(conversationType)}`, {
            headers: ipPlanningToken ? { 'Authorization': `Bearer ${ipPlanningToken}` } : {}
          });
          if (res.ok) return (await res.json()).sessions || [];
          // 401 ä»£è¡¨èªè­‰å¤±æ•—æˆ– API ç«¯é»ä¸å­˜åœ¨ï¼Œéœé»˜è¿”å›ç©ºé™£åˆ—
          if (res.status === 401 || res.status === 404) {
            return [];
          }
        } catch (_) {}
        return [];
      }

      async function loadChatHistory(conversationType, sessionId) {
        if (!ipPlanningUser?.user_id) {
          console.warn('å°šæœªå»ºç«‹ user_idï¼Œè·³éæ­·å²è¼‰å…¥');
          return [];
        }
        try {
          const url = new URL('https://aivideobackend.zeabur.app/api/memory/long-term');
          url.searchParams.set('conversation_type', conversationType);
          if (sessionId) url.searchParams.set('session_id', sessionId);
          const res = await fetch(url.toString(), {
            headers: ipPlanningToken ? { 'Authorization': `Bearer ${ipPlanningToken}` } : {}
          });
          if (res.ok) return (await res.json()).records || [];
          // 401/404 ä»£è¡¨èªè­‰å¤±æ•—æˆ– API ç«¯é»ä¸å­˜åœ¨ï¼Œéœé»˜è¿”å›ç©ºé™£åˆ—
          if (res.status === 401 || res.status === 404) {
            return [];
          }
        } catch (_) {}
        return [];
      }

      // å°‡æ­·å²è¨Šæ¯å›çŒåˆ°èŠå¤©å€ï¼ˆä¸å½±éŸ¿ç¾æœ‰è¨Šæ¯æ¨£å¼ï¼‰
      function renderHistoryToChat(records) {
        const chat = document.getElementById('chatMessages');
        if (!chat || !Array.isArray(records)) return;
        chat.innerHTML = '';
        const byTime = [...records].sort((a,b) => new Date(a.created_at||0) - new Date(b.created_at||0));
        byTime.forEach(r => {
          const role = r.message_role === 'assistant' ? 'assistant' : 'user';
          // å„ªå…ˆä½¿ç”¨ ChatGPT é¢¨æ ¼è¨Šæ¯
          if (typeof createChatGPTMessage === 'function') {
            const node = createChatGPTMessage(role, r.message_content || '');
            chat.appendChild(node);
          } else {
            // å¾Œå‚™æ¨£å¼ï¼ˆAI é¡§å•æ¨£å¼ï¼‰
            const div = document.createElement('div');
            div.className = 'msg ' + (role === 'assistant' ? 'assistant' : 'user');
            const bubble = document.createElement('div');
            bubble.className = 'msg-bubble';
            bubble.textContent = r.message_content || '';
            div.appendChild(bubble);
            chat.appendChild(div);
          }
        });
        // æ²åˆ°æœ€åº•
        chat.scrollTop = chat.scrollHeight;
      }

      // å‹•æ…‹æ’å…¥æ¥µç°¡æœƒè©±UIï¼ˆä¸æ”¹å‹•æ—¢æœ‰ HTMLï¼‰
      document.addEventListener('DOMContentLoaded', () => {
        const inject = (pageId, type) => {
          const page = document.getElementById(pageId);
          if (!page || page.querySelector('.session-mini')) return;
          const box = document.createElement('div');
          box.className = 'session-mini';
          box.style.cssText = 'margin:12px 0 8px;padding:8px;border:1px solid #e5e7eb;border-radius:8px;background:#f8fafc;display:flex;gap:8px;flex-wrap:wrap;';
          box.innerHTML = `
            <button id="${pageId}-new" style="padding:6px 10px;border:1px solid #cbd5e1;border-radius:6px;background:white;cursor:pointer;">ğŸ†• æ–°æœƒè©±</button>
            <button id="${pageId}-list" style="padding:6px 10px;border:1px solid #cbd5e1;border-radius:6px;background:white;cursor:pointer;">ğŸ“‹ æœƒè©±åˆ—è¡¨</button>
            <button id="${pageId}-load" style="padding:6px 10px;border:1px solid #cbd5e1;border-radius:6px;background:white;cursor:pointer;">ğŸ”„ è¼‰å…¥æœ¬æœƒè©±</button>
          `;
          const container = page.querySelector('.page') || page; // ä¿å®ˆæ’å…¥
          container.insertBefore(box, container.firstChild);
          document.getElementById(`${pageId}-new`).onclick = () => {
            localStorage.removeItem(`session_${type}`);
            showToast('å·²å»ºç«‹æ–°æœƒè©±');
          };
          document.getElementById(`${pageId}-list`).onclick = async () => {
            const list = await getSessionList(type);
            if (!list.length) { alert('å°šç„¡æœƒè©±'); return; }
            const lines = list.map((s, i) => `${i+1}. ${s.session_id}  (${s.count||0})`).join('\n');
            const pick = prompt(`é¸æ“‡è¦è¼‰å…¥çš„æœƒè©±åºè™Ÿ:\n${lines}\n\nè¼¸å…¥æ•¸å­—ï¼š`);
            const idx = Number(pick) - 1;
            if (!Number.isFinite(idx) || idx < 0 || idx >= list.length) return;
            const chosen = list[idx]?.session_id;
            const records = await loadChatHistory(type, chosen);
            renderHistoryToChat(records);
            showToast(`å·²è¼‰å…¥ ${records.length} ç­†æ­·å²`);
          };
          document.getElementById(`${pageId}-load`).onclick = async () => {
            const sid = getCurrentSessionId(type);
            const records = await loadChatHistory(type, sid);
            renderHistoryToChat(records);
            showToast(`å·²è¼‰å…¥ ${records.length} ç­†æ­·å²`);
          };
        };
        inject('mode2', 'ai_advisor');
        // inject('mode3', 'ip_planning'); // å·²ç§»é™¤ IPäººè¨­è¦åŠƒçš„ä¸‰å€‹åŠŸèƒ½æŒ‰éˆ•
      });

      function checkAndUpdateResults(aiText) {
        console.log('=== é–‹å§‹è§£æAIå›æ‡‰ ===');
        console.log('AIå›æ‡‰é•·åº¦:', aiText.length);
        console.log('AIå›æ‡‰å‰300å­—ç¬¦:', aiText.substring(0, 300));
        
        // æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦è¦æ±‚ç”Ÿæˆè…³æœ¬ï¼ˆåªæœ‰é€™ç¨®æƒ…æ³æ‰é¡¯ç¤ºè…³æœ¬çµæœå€å¡Šï¼‰
        const isScriptRequest = checkIfScriptRequest(aiText);
        console.log('æ˜¯å¦ç‚ºè…³æœ¬ç”Ÿæˆè«‹æ±‚:', isScriptRequest);
        
        if (!isScriptRequest) {
          console.log('âŒ ä¸æ˜¯è…³æœ¬ç”Ÿæˆè«‹æ±‚ï¼Œä¸é¡¯ç¤ºè…³æœ¬çµæœå€å¡Š');
          return;
        }
        
        // æ›´ç²¾ç¢ºçš„è…³æœ¬å…§å®¹æª¢æ¸¬
        const isScriptContent = detectScriptContent(aiText);
        
        console.log('æ˜¯å¦ç‚ºè…³æœ¬å…§å®¹:', isScriptContent);
        
        if (isScriptContent) {
          // é¡¯ç¤ºçµæœå€å¡Š
          resultsEl.style.display = 'block';
          console.log('çµæœå€å¡Šå·²é¡¯ç¤ºï¼Œé–‹å§‹è§£æå…§å®¹...');
          
          // ç¢ºä¿DOMå…ƒç´ å­˜åœ¨
          if (!resultTitleEl || !resultScriptEl || !resultVisualEl || !resultCopyEl) {
            console.error('DOMå…ƒç´ ä¸å­˜åœ¨:', {
              resultTitleEl: !!resultTitleEl,
              resultScriptEl: !!resultScriptEl,
              resultVisualEl: !!resultVisualEl,
              resultCopyEl: !!resultCopyEl
            });
            return;
          }
          
          try {
            // ä½¿ç”¨æ›´éˆæ´»çš„è§£ææ–¹æ³•
            const sections = parseAIContent(aiText);
            
            // æ›´æ–°DOMå…ƒç´ 
            if (sections.title) {
              // ä½¿ç”¨å®‰å…¨çš„ Markdown æ¸²æŸ“
              resultTitleEl.innerHTML = safeRenderMarkdown(sections.title);
              console.log('âœ… ä¸»é¡Œæ¨™é¡Œå·²è¨­ç½®:', sections.title);
            }
            
            if (sections.script) {
              // ä½¿ç”¨å®‰å…¨çš„ Markdown æ¸²æŸ“
              resultScriptEl.innerHTML = safeRenderMarkdown(sections.script);
              console.log('âœ… è…³æœ¬å…§å®¹å·²è¨­ç½®:', sections.script.substring(0, 100) + '...');
            }
            
            if (sections.visual) {
              // ä½¿ç”¨å®‰å…¨çš„ Markdown æ¸²æŸ“
              resultVisualEl.innerHTML = safeRenderMarkdown(sections.visual);
              console.log('âœ… ç•«é¢æ„Ÿå·²è¨­ç½®:', sections.visual.substring(0, 100) + '...');
            }
            
            if (sections.copy) {
              // ä½¿ç”¨å®‰å…¨çš„ Markdown æ¸²æŸ“
              resultCopyEl.innerHTML = safeRenderMarkdown(sections.copy);
              console.log('âœ… ç™¼ä½ˆæ–‡æ¡ˆå·²è¨­ç½®:', sections.copy.substring(0, 100) + '...');
            }
            
            // å»¶é²æª¢æŸ¥å…§å®¹æ˜¯å¦æ­£ç¢ºè¨­ç½®
            setTimeout(() => {
              console.log('=== å»¶é²æª¢æŸ¥DOMå…§å®¹ ===');
              console.log('ä¸»é¡Œæ¨™é¡Œ:', resultTitleEl.innerHTML);
              console.log('è…³æœ¬å…§å®¹:', resultScriptEl.innerHTML.substring(0, 100) + '...');
              console.log('ç•«é¢æ„Ÿ:', resultVisualEl.innerHTML.substring(0, 100) + '...');
              console.log('ç™¼ä½ˆæ–‡æ¡ˆ:', resultCopyEl.innerHTML.substring(0, 100) + '...');
            }, 500);
            
          } catch (e) {
            console.error('è§£æçµæœæ™‚å‡ºéŒ¯:', e);
          }
        } else {
          console.log('æœªæª¢æ¸¬åˆ°è…³æœ¬å…§å®¹ï¼Œä¸é¡¯ç¤ºçµæœå€å¡Š');
        }
      }
      
      // æ–°å¢ï¼šç²¾ç¢ºçš„è…³æœ¬å…§å®¹æª¢æ¸¬å‡½æ•¸
      function detectScriptContent(aiText) {
        console.log('=== é–‹å§‹è…³æœ¬å…§å®¹æª¢æ¸¬ ===');
        console.log('æª¢æ¸¬æ–‡æœ¬é•·åº¦:', aiText.length);
        console.log('æª¢æ¸¬æ–‡æœ¬å‰200å­—ç¬¦:', aiText.substring(0, 200));
        
        // 1. æª¢æŸ¥æ˜¯å¦åŒ…å«è…³æœ¬ç›¸é—œçš„çµæ§‹æ¨™è¨˜ï¼ˆæ›´éˆæ´»çš„æª¢æ¸¬ï¼‰
        const structureMarkers = [
          /ä¸»é¡Œæ¨™é¡Œ[ï¼š:]/i,
          /è…³æœ¬å…§å®¹[ï¼š:]/i,
          /ç•«é¢æ„Ÿ[ï¼š:]/i,
          /ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]/i,
          /\d+\.\s*ä¸»é¡Œæ¨™é¡Œ/i,
          /\d+\.\s*è…³æœ¬å…§å®¹/i,
          /\d+\.\s*ç•«é¢æ„Ÿ/i,
          /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ/i,
          /Hook\s*\(\d+-\d+ç§’\)/i,
          /Value\s*\d+\s*\(\d+-\d+ç§’\)/i,
          /CTA\s*\(\d+-\d+ç§’\)/i
        ];
        
        const hasStructureMarkers = structureMarkers.some(pattern => pattern.test(aiText));
        console.log('æ˜¯å¦åŒ…å«è…³æœ¬çµæ§‹æ¨™è¨˜:', hasStructureMarkers);
        
        // 2. æª¢æŸ¥æ˜¯å¦åŒ…å«çŸ­å½±éŸ³è…³æœ¬çš„é—œéµå…ƒç´ 
        const scriptElements = [
          /Hook\s*\(\d+-\d+ç§’\)/i,
          /Value\s*\d+\s*\(\d+-\d+ç§’\)/i,
          /CTA\s*\(\d+-\d+ç§’\)/i,
          /ç•«é¢æ„Ÿ[ï¼š:]/i,
          /ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]/i,
          /\d+\.\s*ç•«é¢æ„Ÿ/i,
          /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ/i,
          /é¡é ­[ï¼š:]/i,
          /éŸ³æ•ˆ[ï¼š:]/i,
          /å­—å¹•[ï¼š:]/i,
          /å°è©[ï¼š:]/i
        ];
        
        const scriptElementCount = scriptElements.filter(pattern => pattern.test(aiText)).length;
        console.log('è…³æœ¬å…ƒç´ æ•¸é‡:', scriptElementCount);
        
        // æª¢æŸ¥æ˜¯å¦åŒ…å«æ™‚é–“æ¨™è¨˜ï¼ˆHookã€Valueã€CTAæ ¼å¼ï¼‰
        const timeMarkersPatterns = [
          /\(\d+-\d+ç§’\)\s*Hook/i,
          /\(\d+-\d+ç§’\)\s*Value/i,
          /\(\d+-\d+ç§’\)\s*CTA/i,
          /Hook\s*\(\d+-\d+ç§’\)/i,
          /Value\s*\d+\s*\(\d+-\d+ç§’\)/i,
          /CTA\s*\(\d+-\d+ç§’\)/i
        ];
        const hasTimeMarkers = timeMarkersPatterns.some(pattern => pattern.test(aiText));
        console.log('æ˜¯å¦åŒ…å«æ™‚é–“æ¨™è¨˜:', hasTimeMarkers);
        
        // æª¢æŸ¥æ˜¯å¦åŒ…å«çŸ­å½±éŸ³ç›¸é—œå…§å®¹
        const videoContent = [
          /ç•«é¢æ„Ÿ/i,
          /ç™¼ä½ˆæ–‡æ¡ˆ/i,
          /å°è©[ï¼š:]/i,
          /é¡é ­[ï¼š:]/i,
          /éŸ³æ•ˆ[ï¼š:]/i,
          /å­—å¹•[ï¼š:]/i
        ];
        const hasVideoContent = videoContent.some(pattern => pattern.test(aiText));
        console.log('æ˜¯å¦åŒ…å«çŸ­å½±éŸ³å…§å®¹:', hasVideoContent);
        
        // æ›´éˆæ´»çš„åˆ¤æ–·æ¢ä»¶
        const hasAnyScriptContent = hasStructureMarkers || scriptElementCount >= 3 || hasTimeMarkers || hasVideoContent;
        console.log('æ˜¯å¦æœ‰ä»»ä½•è…³æœ¬å…§å®¹:', hasAnyScriptContent);
        
        if (!hasAnyScriptContent) {
          console.log('âŒ æœªåŒ…å«è¶³å¤ çš„è…³æœ¬å…§å®¹æ¨™è¨˜ï¼Œä¸é¡¯ç¤ºçµæœå€å¡Š');
          console.log('æª¢æ¸¬çµæœè©³æƒ…:', {
            hasStructureMarkers,
            scriptElementCount,
            hasTimeMarkers,
            hasVideoContent
          });
          return false;
        }
        
        // 2. æª¢æŸ¥æ˜¯å¦åŒ…å«è…³æœ¬ç›¸é—œçš„é—œéµè©çµ„åˆ
        const scriptKeywords = ['ä¸»é¡Œæ¨™é¡Œ', 'è…³æœ¬å…§å®¹', 'ç•«é¢æ„Ÿ', 'ç™¼ä½ˆæ–‡æ¡ˆ', 'Hook', 'Value', 'CTA'];
        const keywordCount = scriptKeywords.filter(keyword => aiText.includes(keyword)).length;
        console.log('è…³æœ¬é—œéµè©æ•¸é‡:', keywordCount);
        
        // 3. æª¢æŸ¥æ˜¯å¦åŒ…å«çŸ­å½±éŸ³ç›¸é—œçš„å…§å®¹æŒ‡ç¤ºè©
        const videoIndicators = [
          'çŸ­å½±éŸ³è…³æœ¬',
          'çŸ­å½±éŸ³è…³æœ¬çµæœ',
          'ç”Ÿæˆè…³æœ¬',
          'è…³æœ¬ç”Ÿæˆ',
          'Reels',
          'TikTok',
          'å°ç´…æ›¸',
          'ç§’è…³æœ¬',
          'å½±éŸ³å…§å®¹',
          'çŸ­å½±éŸ³',
          'è…³æœ¬'
        ];
        const hasVideoIndicators = videoIndicators.some(indicator => aiText.includes(indicator));
        console.log('æ˜¯å¦åŒ…å«çŸ­å½±éŸ³æŒ‡ç¤ºè©:', hasVideoIndicators);
        
        // 4. æª¢æŸ¥æ–‡æœ¬é•·åº¦ï¼ˆè…³æœ¬å…§å®¹é€šå¸¸è¼ƒé•·ï¼‰
        const isLongEnough = aiText.length > 300; // æé«˜é•·åº¦è¦æ±‚
        console.log('æ–‡æœ¬æ˜¯å¦è¶³å¤ é•·:', isLongEnough);
        
        // 5. æª¢æŸ¥æ˜¯å¦åŒ…å«å¤šå€‹æ®µè½ï¼ˆè…³æœ¬é€šå¸¸æœ‰å¤šå€‹éƒ¨åˆ†ï¼‰
        const paragraphCount = aiText.split('\n\n').filter(p => p.trim().length > 0).length;
        const hasMultipleParagraphs = paragraphCount >= 4; // æé«˜æ®µè½è¦æ±‚
        console.log('æ®µè½æ•¸é‡:', paragraphCount, 'æ˜¯å¦å¤šæ®µè½:', hasMultipleParagraphs);
        
        // 6. æ’é™¤æ˜é¡¯çš„éè…³æœ¬å…§å®¹
        const nonScriptIndicators = [
          'ä½ å¥½',
          'è¬è¬',
          'ä¸å®¢æ°£',
          'è«‹å•',
          'ä¸å¥½æ„æ€',
          'æŠ±æ­‰',
          'æˆ‘ä¾†å¹«ä½ ',
          'è®“æˆ‘ç‚ºä½ ',
          'å¾ˆé«˜èˆˆç‚ºæ‚¨',
          'æ­¡è¿',
          'å†è¦‹',
          'æ‹œæ‹œ',
          'æœ‰ä»€éº¼å¯ä»¥å¹«ä½ ',
          'éœ€è¦ä»€éº¼å¹«åŠ©',
          'è«‹å‘Šè¨´æˆ‘',
          'è«‹è¼¸å…¥',
          'è«‹é¸æ“‡',
          'è«‹é»æ“Š',
          'è«‹æŸ¥çœ‹',
          'è«‹æ³¨æ„',
          'æé†’',
          'å»ºè­°',
          'æ¨è–¦',
          'ä»‹ç´¹',
          'èªªæ˜',
          'è§£é‡‹',
          'å›ç­”',
          'å›è¦†',
          'å›æ‡‰'
        ];
        const hasNonScriptIndicators = nonScriptIndicators.some(indicator => 
          aiText.toLowerCase().includes(indicator.toLowerCase())
        );
        console.log('æ˜¯å¦åŒ…å«éè…³æœ¬æŒ‡ç¤ºè©:', hasNonScriptIndicators);
        
        // 7. æª¢æŸ¥æ˜¯å¦åŒ…å«å®Œæ•´çš„è…³æœ¬çµæ§‹ï¼ˆè‡³å°‘åŒ…å«3å€‹å€å¡Šï¼‰
        const requiredStructureMarkers = [
          /ä¸»é¡Œæ¨™é¡Œ[ï¼š:]/i,
          /è…³æœ¬å…§å®¹[ï¼š:]/i,
          /ç•«é¢æ„Ÿ[ï¼š:]/i,
          /ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]/i,
          /\d+\.\s*ä¸»é¡Œæ¨™é¡Œ/i,
          /\d+\.\s*è…³æœ¬å…§å®¹/i,
          /\d+\.\s*ç•«é¢æ„Ÿ/i,
          /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ/i
        ];
        const structureCount = requiredStructureMarkers.filter(pattern => pattern.test(aiText)).length;
        const hasCompleteStructure = structureCount >= 3;
        console.log('çµæ§‹å€å¡Šæ•¸é‡:', structureCount, 'æ˜¯å¦å®Œæ•´çµæ§‹:', hasCompleteStructure);
        
        // 8. æª¢æŸ¥æ˜¯å¦åŒ…å«æ™‚é–“æ¨™è¨˜ï¼ˆè…³æœ¬é€šå¸¸æœ‰æ™‚é–“æ¨™è¨˜ï¼‰
        const timeMarkersGeneral = [
          /\d+[-\s]*\d*\s*ç§’/i,
          /\d+[-\s]*\d*\s*åˆ†é˜/i,
          /0-\d+\s*ç§’/i,
          /\d+-\d+\s*ç§’/i
        ];
        const hasTimeMarkersGeneral = timeMarkersGeneral.some(pattern => pattern.test(aiText));
        console.log('æ˜¯å¦åŒ…å«ä¸€èˆ¬æ™‚é–“æ¨™è¨˜:', hasTimeMarkersGeneral);
        
        // ç¶œåˆåˆ¤æ–·
        const score = {
          structureMarkers: hasStructureMarkers ? 3 : 0,
          scriptElements: Math.min(scriptElementCount, 4), // è…³æœ¬å…ƒç´ æ•¸é‡
          keywordCount: Math.min(keywordCount, 3),
          videoIndicators: hasVideoIndicators ? 2 : 0,
          length: isLongEnough ? 1 : 0,
          paragraphs: hasMultipleParagraphs ? 1 : 0,
          completeStructure: hasCompleteStructure ? 2 : 0,
          timeMarkers: hasTimeMarkers ? 1 : 0,
          timeMarkersGeneral: hasTimeMarkersGeneral ? 1 : 0,
          videoContent: hasVideoContent ? 1 : 0,
          nonScript: hasNonScriptIndicators ? -5 : 0 // é«˜æ‡²ç½°
        };
        
        const totalScore = Object.values(score).reduce((sum, val) => sum + val, 0);
        
        console.log('è…³æœ¬æª¢æ¸¬è©•åˆ†:', score);
        console.log('ç¸½åˆ†:', totalScore);
        
        // æ›´éˆæ´»çš„åˆ¤æ–·æ¢ä»¶
        const isScriptContent = totalScore >= 4 && (hasStructureMarkers || scriptElementCount >= 3);
        
        // å¦‚æœåŒ…å«éè…³æœ¬æŒ‡ç¤ºè©ï¼Œé™ä½è©•åˆ†ä½†ä¸å®Œå…¨æ‹’çµ•
        if (hasNonScriptIndicators) {
          console.log('âš ï¸ åŒ…å«éè…³æœ¬æŒ‡ç¤ºè©ï¼Œä½†å…§å®¹çµæ§‹å®Œæ•´ï¼Œä»è¦–ç‚ºè…³æœ¬å…§å®¹');
        }
        
        console.log('æ˜¯å¦ç‚ºè…³æœ¬å…§å®¹:', isScriptContent);
        console.log('=== è…³æœ¬å…§å®¹æª¢æ¸¬çµæŸ ===');
        
        return isScriptContent;
      }
      // æ–°å¢ï¼šæ›´ç²¾ç¢ºçš„AIå…§å®¹è§£æå‡½æ•¸
      function parseAIContent(aiText) {
        const sections = {
          title: '',
          script: '',
          visual: '',
          copy: ''
        };
        
        console.log('é–‹å§‹è§£æAIå…§å®¹...');
        console.log('åŸå§‹AIæ–‡æœ¬é•·åº¦:', aiText.length);
        console.log('åŸå§‹AIæ–‡æœ¬å‰500å­—ç¬¦:', aiText.substring(0, 500));
        
        // ä½¿ç”¨æ­£å‰‡è¡¨é”å¼ç²¾ç¢ºæå–æ¯å€‹å€å¡Šçš„å…§å®¹
        try {
          // é€šç”¨å…§å®¹æå–ç­–ç•¥ - æ‡‰å°æ‰€æœ‰å¯èƒ½çš„AIæ ¼å¼è®ŠåŒ–
          let scriptContent = aiText;
          let extractionMethod = 'full';
          
          // ç­–ç•¥1: æª¢æŸ¥æ˜¯å¦æœ‰ --- åˆ†éš”ç¬¦
          const dashSections = aiText.split(/---/);
          if (dashSections.length > 1) {
            const contentSections = dashSections.slice(1);
            scriptContent = contentSections.join('---').trim();
            extractionMethod = 'dash-separated';
            console.log('âœ… ä½¿ç”¨ --- åˆ†éš”ç­–ç•¥');
          }
          // ç­–ç•¥2: æª¢æŸ¥æ˜¯å¦æœ‰æ˜ç¢ºçš„çµæ§‹æ¨™è¨˜
          else if (aiText.includes('ä¸»é¡Œæ¨™é¡Œ') || aiText.includes('è…³æœ¬å…§å®¹') || aiText.includes('ç•«é¢æ„Ÿ') || aiText.includes('ç™¼ä½ˆæ–‡æ¡ˆ')) {
            scriptContent = aiText;
            extractionMethod = 'structured';
            console.log('âœ… ä½¿ç”¨çµæ§‹åŒ–æ¨™è¨˜ç­–ç•¥');
          }
          // ç­–ç•¥3: æª¢æŸ¥æ˜¯å¦æœ‰ Hook/Value/CTA çµæ§‹
          else if (aiText.includes('Hook') || aiText.includes('Value') || aiText.includes('CTA')) {
            scriptContent = aiText;
            extractionMethod = 'hook-value-cta';
            console.log('âœ… ä½¿ç”¨ Hook/Value/CTA ç­–ç•¥');
          }
          // ç­–ç•¥4: æª¢æŸ¥æ˜¯å¦æœ‰æ™‚é–“æ¨™è¨˜
          else if (aiText.match(/\d+-\d+ç§’/) || aiText.match(/\d+ç§’/)) {
            scriptContent = aiText;
            extractionMethod = 'time-marked';
            console.log('âœ… ä½¿ç”¨æ™‚é–“æ¨™è¨˜ç­–ç•¥');
          }
          // ç­–ç•¥5: é»˜èªä½¿ç”¨å®Œæ•´å…§å®¹
          else {
            scriptContent = aiText;
            extractionMethod = 'full';
            console.log('âœ… ä½¿ç”¨å®Œæ•´å…§å®¹ç­–ç•¥');
          }
          
          console.log('æå–æ–¹æ³•:', extractionMethod);
            console.log('è…³æœ¬å…§å®¹é•·åº¦:', scriptContent.length);
            console.log('è…³æœ¬å…§å®¹å‰200å­—ç¬¦:', scriptContent.substring(0, 200));
          
          // è¶…ç´šæ™ºèƒ½ä¸»é¡Œæ¨™é¡Œæå–å™¨ - æ‡‰å°æ‰€æœ‰å¯èƒ½çš„AIæ ¼å¼
          function extractTitle(scriptContent) {
          const titlePatterns = [
              // 1. è¡¨æƒ…ç¬¦è™Ÿ + æ¨™é¡Œæ ¼å¼
              /[ğŸ¬ğŸ“ğŸ¯âœ¨ğŸ”¥ğŸ“Œ]\s*ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /[ğŸ¬ğŸ“ğŸ¯âœ¨ğŸ”¥ğŸ“Œ]\s*ä¸»é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /[ğŸ¬ğŸ“ğŸ¯âœ¨ğŸ”¥ğŸ“Œ]\s*æ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              
              // 2. æ¨™æº–æ¨™é¡Œæ ¼å¼
            /ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /ä¸»é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /æ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              
              // 3. ç·¨è™Ÿ + æ¨™é¡Œæ ¼å¼
            /\d+\.\s*ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /\d+\.\s*ä¸»é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /\d+\.\s*æ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              
              // 4. ç²—é«”æ¨™é¡Œæ ¼å¼
            /\*\*ä¸»é¡Œæ¨™é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
            /\*\*ä¸»é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
            /\*\*æ¨™é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
              
              // 5. æ··åˆæ ¼å¼
            /\d+\.\s*\*\*ä¸»é¡Œæ¨™é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
            /\d+\.\s*\*\*ä¸»é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
            /\d+\.\s*\*\*æ¨™é¡Œ\*\*[ï¼š:]\s*([^\n]+)/i,
              
              // 6. Markdown æ¨™é¡Œæ ¼å¼
            /###\s*ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /###\s*ä¸»é¡Œ[ï¼š:]\s*([^\n]+)/i,
            /###\s*æ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /##\s*ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /##\s*ä¸»é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /##\s*æ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              
              // 7. è¡Œé¦–æ¨™é¡Œæ ¼å¼ï¼ˆ--- åˆ†éš”å¾Œï¼‰
              /^ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /^æ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i,
              /^ä¸»é¡Œ[ï¼š:]\s*([^\n]+)/i,
              
              // 8. AI ç‹¡çŒ¾æ ¼å¼ï¼šç›´æ¥çµ¦æ¨™é¡Œï¼Œæ²’æœ‰å‰ç¶´
            /^ä½ çš„.*ä¾†äº†.*å°ç´…æ›¸.*éƒ½åœ¨.*ç”¨çš„.*AIæ™ºèƒ½é«”.*$/i,
            /^.*AIæ™ºèƒ½é«”.*ä¾†äº†.*$/i,
            /^.*å°ç´…æ›¸.*åšä¸».*éƒ½åœ¨.*ç”¨çš„.*$/i,
              /^.*æ•ˆç‡.*çˆ†æ£š.*$/i,
              /^.*AI.*æ™ºèƒ½é«”.*é€™æ¨£ç©.*$/i,
              
              // 9. å¼•è™Ÿæ¨™é¡Œæ ¼å¼
              /ã€Œ([^ã€]+)ã€/,
              /"([^"]+)"/,
              /'([^']+)'/,
              
              // 10. ç‰¹æ®Šæ¨™é¡Œæ¨¡å¼
              /^.*ä½ é‚„åœ¨.*æ–¹æ³•.*AIæ™ºèƒ½é«”.*æ•ˆç‡.*çˆ†æ£š.*$/i,
              /^.*AIæ™ºèƒ½é«”.*æ•ˆç‡.*ç¿»å€.*$/i,
              /^.*è¶…ç´š.*å­¸ä¼´.*$/i
          ];
          
          for (const pattern of titlePatterns) {
            const match = scriptContent.match(pattern);
            if (match) {
              // è™•ç†æœ‰æ•ç²çµ„çš„æƒ…æ³
              if (match[1] && match[1].trim()) {
                  const title = cleanMarkdownFormat(match[1].trim());
                  if (title.length > 5 && title.length < 100) { // åˆç†çš„æ¨™é¡Œé•·åº¦
                    console.log('âœ… æ‰¾åˆ°ä¸»é¡Œæ¨™é¡Œ(æœ‰å‰ç¶´):', title);
                    return title;
                  }
              }
              // è™•ç†æ²’æœ‰å‰ç¶´ï¼Œç›´æ¥åŒ¹é…æ•´è¡Œçš„æƒ…æ³
              else if (match[0] && match[0].trim()) {
                  const title = cleanMarkdownFormat(match[0].trim());
                  if (title.length > 5 && title.length < 100) {
                    console.log('âœ… æ‰¾åˆ°ä¸»é¡Œæ¨™é¡Œ(ç„¡å‰ç¶´):', title);
                    return title;
                  }
                }
              }
            }
            
            // å¦‚æœæ²’æœ‰æ‰¾åˆ°æ˜ç¢ºçš„æ¨™é¡Œï¼Œå˜—è©¦æå–ç¬¬ä¸€è¡Œä½œç‚ºæ¨™é¡Œ
            const lines = scriptContent.split('\n').filter(line => line.trim().length > 0);
            for (const line of lines) {
              const trimmedLine = line.trim();
              // è·³éæ˜é¡¯ä¸æ˜¯æ¨™é¡Œçš„è¡Œ
              if (trimmedLine.match(/^(Hook|Value|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|\d+\.|\(|å°è©|é¡é ­|éŸ³æ•ˆ|å­—å¹•|ä¸»é¡Œå»ºè­°|ç›®æ¨™|åˆ‡å…¥é»|å…§å®¹æ–¹å‘|å¥½çš„|æ²’å•é¡Œ|è®“æˆ‘)/i)) {
                continue;
              }
              // æª¢æŸ¥æ˜¯å¦ç‚ºåˆç†çš„æ¨™é¡Œ
              if (trimmedLine.length > 5 && trimmedLine.length < 100 && !trimmedLine.includes('ï¼š') && !trimmedLine.includes(':')) {
                console.log('ä½¿ç”¨ç¬¬ä¸€è¡Œä½œç‚ºä¸»é¡Œæ¨™é¡Œ:', trimmedLine);
                return cleanMarkdownFormat(trimmedLine);
              }
            }
            
            return '';
          }
          
          // æå–ä¸»é¡Œæ¨™é¡Œ
          sections.title = extractTitle(scriptContent);
          
          // è¶…ç´šæ™ºèƒ½è…³æœ¬å…§å®¹æå–å™¨ - æ‡‰å°æ‰€æœ‰å¯èƒ½çš„AIæ ¼å¼
          function extractScript(scriptContent) {
          const scriptPatterns = [
              // 1. æ¨™æº–è…³æœ¬å…§å®¹æ ¼å¼
            /è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /è…³æœ¬[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 2. è¡¨æƒ…ç¬¦è™Ÿ + è…³æœ¬å…§å®¹æ ¼å¼
              /[ğŸ“ğŸ¬ğŸ“œâœ¨ğŸ”¥]\s*è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /[ğŸ“ğŸ¬ğŸ“œâœ¨ğŸ”¥]\s*è…³æœ¬[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 3. ç·¨è™Ÿ + è…³æœ¬å…§å®¹æ ¼å¼
            /\d+\.\s*è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç•«é¢æ„Ÿ|\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*è…³æœ¬[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç•«é¢æ„Ÿ|\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 4. ç²—é«”è…³æœ¬å…§å®¹æ ¼å¼
            /\*\*è…³æœ¬å…§å®¹\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\*\*è…³æœ¬\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 5. æ··åˆæ ¼å¼
            /\d+\.\s*\*\*è…³æœ¬å…§å®¹\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç•«é¢æ„Ÿ|\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*\*\*è…³æœ¬\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç•«é¢æ„Ÿ|\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 6. Markdown æ¨™é¡Œæ ¼å¼
              /###\s*è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:###\s*ç•«é¢æ„Ÿ|###\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /###\s*è…³æœ¬[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:###\s*ç•«é¢æ„Ÿ|###\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /##\s*è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:##\s*ç•«é¢æ„Ÿ|##\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /##\s*è…³æœ¬[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:##\s*ç•«é¢æ„Ÿ|##\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 7. è¡Œé¦–è…³æœ¬å…§å®¹æ ¼å¼ï¼ˆ--- åˆ†éš”å¾Œï¼‰
            /^è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /^è…³æœ¬[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 8. Hook/Value/CTA çµæ§‹æ ¼å¼
              /Hook\s*\(\d+-\d+ç§’\)[\s\S]*?(?=ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /\(\d+-\d+ç§’\)\s*Hook[\s\S]*?(?=ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /Hook\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /Hook\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value\s*\d+|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              
              // 9. å°è©æ ¼å¼
              /å°è©[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /å°è©\s*\(\d+-\d+ç§’\)[\s\S]*?(?=ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              
              // 10. ç‰¹æ®Šè…³æœ¬æ¨¡å¼
              /^.*ä½ é‚„åœ¨.*æ‰‹å‹•.*å ±å‘Š.*å¯«æ–‡æ¡ˆ.*è½ä¼.*è¶…ç´šåŠ©ç†.*AIæ™ºèƒ½é«”.*$/i,
              /^.*å®ƒä¸åªæ˜¯.*ç¨‹å¼.*çœŸäºº.*æ€è€ƒ.*å­¸ç¿’.*$/i,
              /^.*æƒ³åƒä¸€ä¸‹.*å°ˆå±¬åœ˜éšŠ.*24å°æ™‚.*å¾…å‘½.*$/i,
              /^.*é‡é»æ˜¯.*è¶Šä¾†è¶Šè°æ˜.*ä¸æ–·é€²åŒ–.*$/i,
              /^.*æƒ³çŸ¥é“.*æ€éº¼é–‹å§‹.*AIæ™ºèƒ½é«”.*$/i
          ];
          
          for (const pattern of scriptPatterns) {
            const match = scriptContent.match(pattern);
              if (match) {
                let scriptText = '';
                if (match[1] && match[1].trim()) {
                  scriptText = match[1].trim();
                } else if (match[0] && match[0].trim()) {
                  scriptText = match[0].trim();
                }
                
                if (scriptText && scriptText.length > 10) {
                  console.log('âœ… æ‰¾åˆ°è…³æœ¬å…§å®¹:', scriptText.substring(0, 100) + '...');
                  return cleanMarkdownFormat(scriptText);
                }
            }
          }
          
          // å¦‚æœæ²’æœ‰æ‰¾åˆ°æ˜ç¢ºçš„è…³æœ¬å…§å®¹æ¨™è¨˜ï¼Œå˜—è©¦æå– Hookã€Valueã€CTA éƒ¨åˆ†
            console.log('å˜—è©¦æå– Hook/Value/CTA å…§å®¹...');
            
            // æ”¯æ´å¤šç¨®æ™‚é–“æ¨™è¨˜æ ¼å¼
            const hookPatterns = [
              /Hook\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /\(\d+-\d+ç§’\)\s*Hook[\s\S]*?(?=Value|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /Hook\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /Hook\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value\s*\d+|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i
            ];
            const valuePatterns = [
              /Value\s*\d+\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /\(\d+-\d+ç§’\)\s*Value\s*\d+[\s\S]*?(?=Value|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /Value\s*\(\d+-\d+ç§’\)[\s\S]*?(?=Value|CTA|ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i
            ];
            const ctaPatterns = [
              /CTA\s*\(\d+-\d+ç§’\)[\s\S]*?(?=ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i,
              /\(\d+-\d+ç§’\)\s*CTA[\s\S]*?(?=ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i
            ];
            
            let extractedScriptContent = '';
            
            // æå– Hook
            for (const pattern of hookPatterns) {
              const match = scriptContent.match(pattern);
              if (match) {
                console.log('æ‰¾åˆ° Hook:', match[0].substring(0, 100) + '...');
                extractedScriptContent += match[0] + '\n\n';
                break;
              }
            }
            
            // æå– Value
            for (const pattern of valuePatterns) {
              const matches = scriptContent.match(new RegExp(pattern.source, 'gi'));
              if (matches) {
                console.log('æ‰¾åˆ° Value æ•¸é‡:', matches.length);
                extractedScriptContent += matches.join('\n\n');
                break;
              }
            }
            
            // æå– CTA
            for (const pattern of ctaPatterns) {
              const match = scriptContent.match(pattern);
              if (match) {
                console.log('æ‰¾åˆ° CTA:', match[0].substring(0, 100) + '...');
                extractedScriptContent += '\n\n' + match[0];
                break;
              }
            }
            
            if (extractedScriptContent.trim()) {
              console.log('ä½¿ç”¨ Hook/Value/CTA ä½œç‚ºè…³æœ¬å…§å®¹:', extractedScriptContent.substring(0, 100) + '...');
              return cleanMarkdownFormat(extractedScriptContent.trim());
            }
            
            return '';
          }
          
          // æå–è…³æœ¬å…§å®¹
          sections.script = extractScript(scriptContent);
          
          // è¶…ç´šæ™ºèƒ½ç•«é¢æ„Ÿæå–å™¨ - æ‡‰å°æ‰€æœ‰å¯èƒ½çš„AIæ ¼å¼
          function extractVisual(scriptContent) {
          const visualPatterns = [
              // 1. æ¨™æº–ç•«é¢æ„Ÿæ ¼å¼
            /ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /ç•«é¢[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 2. è¡¨æƒ…ç¬¦è™Ÿ + ç•«é¢æ„Ÿæ ¼å¼
              /[ğŸ¬ğŸï¸ğŸ“¹âœ¨ğŸ”¥]\s*ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /[ğŸ¬ğŸï¸ğŸ“¹âœ¨ğŸ”¥]\s*ç•«é¢[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 3. ç·¨è™Ÿ + ç•«é¢æ„Ÿæ ¼å¼
            /\d+\.\s*ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*ç•«é¢[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              // æ–°å¢ï¼šç·¨è™Ÿ + æ‹¬è™Ÿæ ¼å¼
              /\d+\.\s*ç•«é¢æ„Ÿ\s*\([^)]*\)[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /\d+\.\s*ç•«é¢\s*\([^)]*\)[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 4. ç²—é«”ç•«é¢æ„Ÿæ ¼å¼
            /\*\*ç•«é¢æ„Ÿ\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\*\*ç•«é¢\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 5. æ··åˆæ ¼å¼
            /\d+\.\s*\*\*ç•«é¢æ„Ÿ\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /\d+\.\s*\*\*ç•«é¢\*\*[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 6. Markdown æ¨™é¡Œæ ¼å¼
            /###\s*ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:###\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
            /###\s*ç•«é¢[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:###\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /##\s*ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:##\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /##\s*ç•«é¢[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:##\s*ç™¼ä½ˆæ–‡æ¡ˆ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 7. è¡Œé¦–ç•«é¢æ„Ÿæ ¼å¼ï¼ˆ--- åˆ†éš”å¾Œï¼‰
            /^ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              /^ç•«é¢[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i,
              
              // 8. ç‰¹æ®Šç•«é¢æ„Ÿæ¨¡å¼
              /^.*é–‹å ´.*Hook.*é¡é ­.*ç‰¹å¯«.*$/i,
              /^.*æ ¸å¿ƒåƒ¹å€¼.*é¡é ­.*ä¸­æ™¯.*$/i,
              /^.*è¡Œå‹•å‘¼ç±².*é¡é ­.*æŒ‡å‘.*$/i
          ];
          
          for (const pattern of visualPatterns) {
            const match = scriptContent.match(pattern);
            if (match && match[1] && match[1].trim()) {
              // æª¢æŸ¥æ˜¯å¦ç‚ºã€Œå°šæœªç”Ÿæˆã€
              if (match[1].trim() === 'å°šæœªç”Ÿæˆ' || match[1].trim().includes('å°šæœªç”Ÿæˆ')) {
                console.log('âš ï¸ ç•«é¢æ„Ÿæ¨™è¨˜ç‚ºã€Œå°šæœªç”Ÿæˆã€');
                  return 'AI æœªç”Ÿæˆç•«é¢æ„Ÿå…§å®¹';
              } else {
                  const visual = cleanMarkdownFormat(match[1].trim());
                  console.log('âœ… æ‰¾åˆ°ç•«é¢æ„Ÿ:', visual.substring(0, 100) + '...');
                  return visual;
                }
              }
            }
            
            return '';
          }
          
          // æå–ç•«é¢æ„Ÿ
          sections.visual = extractVisual(scriptContent);
          
          // è¶…ç´šæ™ºèƒ½ç™¼ä½ˆæ–‡æ¡ˆæå–å™¨ - æ‡‰å°æ‰€æœ‰å¯èƒ½çš„AIæ ¼å¼
          function extractCopy(scriptContent) {
          const copyPatterns = [
              // 1. æ¨™æº–ç™¼ä½ˆæ–‡æ¡ˆæ ¼å¼
            /ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
            /æ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 2. è¡¨æƒ…ç¬¦è™Ÿ + ç™¼ä½ˆæ–‡æ¡ˆæ ¼å¼
              /[ğŸ“±ğŸ“„ğŸ“âœ¨ğŸ”¥]\s*ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              /[ğŸ“±ğŸ“„ğŸ“âœ¨ğŸ”¥]\s*æ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 3. ç·¨è™Ÿ + ç™¼ä½ˆæ–‡æ¡ˆæ ¼å¼
            /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
            /\d+\.\s*æ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              // æ–°å¢ï¼šç·¨è™Ÿ + æ‹¬è™Ÿæ ¼å¼
              /\d+\.\s*ç™¼ä½ˆæ–‡æ¡ˆ\s*\([^)]*\)[ï¼š:]\s*([\s\S]*?)$/i,
              /\d+\.\s*æ–‡æ¡ˆ\s*\([^)]*\)[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 4. ç²—é«”ç™¼ä½ˆæ–‡æ¡ˆæ ¼å¼
            /\*\*ç™¼ä½ˆæ–‡æ¡ˆ\*\*[ï¼š:]\s*([\s\S]*?)$/i,
            /\*\*æ–‡æ¡ˆ\*\*[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 5. æ··åˆæ ¼å¼
            /\d+\.\s*\*\*ç™¼ä½ˆæ–‡æ¡ˆ\*\*[ï¼š:]\s*([\s\S]*?)$/i,
            /\d+\.\s*\*\*æ–‡æ¡ˆ\*\*[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 6. Markdown æ¨™é¡Œæ ¼å¼
            /###\s*ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
            /###\s*æ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              /##\s*ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              /##\s*æ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 7. è¡Œé¦–ç™¼ä½ˆæ–‡æ¡ˆæ ¼å¼ï¼ˆ--- åˆ†éš”å¾Œï¼‰
            /^ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              /^æ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i,
              
              // 8. ç‰¹æ®Šç™¼ä½ˆæ–‡æ¡ˆæ¨¡å¼
              /^.*é‚„åœ¨.*ç¹ç‘£.*å·¥ä½œ.*AIæ™ºèƒ½é«”.*æ•‘æ˜Ÿ.*$/i,
              /^.*è‡ªå‹•åŒ–.*æå‡æ•ˆç‡.*å®¢è£½åŒ–.*$/i,
              /^.*æœªä¾†è¶¨å‹¢.*é»æ“Š.*ä¸»é .*é€£çµ.*$/i,
              /^.*å…è²».*é ˜å–.*AI.*å…¥é–€.*æŒ‡å—.*$/i
          ];
          
          for (const pattern of copyPatterns) {
            const match = scriptContent.match(pattern);
            if (match && match[1] && match[1].trim()) {
              // æª¢æŸ¥æ˜¯å¦ç‚ºã€Œå°šæœªç”Ÿæˆã€
              if (match[1].trim() === 'å°šæœªç”Ÿæˆ' || match[1].trim().includes('å°šæœªç”Ÿæˆ')) {
                console.log('âš ï¸ ç™¼ä½ˆæ–‡æ¡ˆæ¨™è¨˜ç‚ºã€Œå°šæœªç”Ÿæˆã€');
                  return 'AI æœªç”Ÿæˆç™¼ä½ˆæ–‡æ¡ˆå…§å®¹';
              } else {
                  const copy = cleanMarkdownFormat(match[1].trim());
                  console.log('âœ… æ‰¾åˆ°ç™¼ä½ˆæ–‡æ¡ˆ:', copy.substring(0, 100) + '...');
                  return copy;
                }
              }
            }
            
            return '';
          }
          
          // æå–ç™¼ä½ˆæ–‡æ¡ˆ
          sections.copy = extractCopy(scriptContent);
          
          // æœ€çµ‚èª¿è©¦è¼¸å‡º
          console.log('=== è¶…ç´šæ™ºèƒ½è§£æçµæœ ===');
          console.log('æå–æ–¹æ³•:', extractionMethod);
          console.log('ä¸»é¡Œæ¨™é¡Œ:', sections.title ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
          console.log('è…³æœ¬å…§å®¹:', sections.script ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
          console.log('ç•«é¢æ„Ÿ:', sections.visual ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
          console.log('ç™¼ä½ˆæ–‡æ¡ˆ:', sections.copy ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
          
          // å¦‚æœä»»ä½•æ¬„ä½ç‚ºç©ºï¼Œå˜—è©¦æœ€å¾Œçš„å¼·åˆ¶æå–
          if (!sections.title || !sections.script || !sections.visual || !sections.copy) {
            console.log('ğŸ”„ å•Ÿå‹•æœ€å¾Œçš„å¼·åˆ¶æå–æ©Ÿåˆ¶...');
            
            // å¼·åˆ¶æå–ä¸»é¡Œæ¨™é¡Œ
            if (!sections.title) {
              const lines = scriptContent.split('\n').filter(line => line.trim().length > 0);
              for (const line of lines) {
                if (line.length > 10 && line.length < 100 && !line.includes('ï¼š') && !line.includes(':')) {
                  sections.title = cleanMarkdownFormat(line.trim());
                    console.log('å¼·åˆ¶æå–ä¸»é¡Œæ¨™é¡Œ:', sections.title);
                  break;
                }
              }
            }
            
            // å¼·åˆ¶æå–è…³æœ¬å…§å®¹
            if (!sections.script) {
              const scriptMatch = scriptContent.match(/(?:Hook|Value|CTA)[\s\S]*?(?=ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$)/i);
              if (scriptMatch) {
                sections.script = cleanMarkdownFormat(scriptMatch[0].trim());
                console.log('å¼·åˆ¶æå–è…³æœ¬å…§å®¹:', sections.script.substring(0, 100) + '...');
              }
            }
            
            // å¼·åˆ¶æå–ç•«é¢æ„Ÿ
            if (!sections.visual) {
              const visualMatch = scriptContent.match(/ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=ç™¼ä½ˆæ–‡æ¡ˆ|$)/i);
              if (visualMatch && visualMatch[1]) {
                if (visualMatch[1].trim() === 'å°šæœªç”Ÿæˆ' || visualMatch[1].trim().includes('å°šæœªç”Ÿæˆ')) {
                  sections.visual = 'AI æœªç”Ÿæˆç•«é¢æ„Ÿå…§å®¹';
                } else {
                  sections.visual = cleanMarkdownFormat(visualMatch[1].trim());
                }
                  console.log('å¼·åˆ¶æå–ç•«é¢æ„Ÿ:', sections.visual.substring(0, 100) + '...');
              }
            }
            
            // å¼·åˆ¶æå–ç™¼ä½ˆæ–‡æ¡ˆ
            if (!sections.copy) {
              const copyMatch = scriptContent.match(/ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i);
              if (copyMatch && copyMatch[1]) {
                if (copyMatch[1].trim() === 'å°šæœªç”Ÿæˆ' || copyMatch[1].trim().includes('å°šæœªç”Ÿæˆ')) {
                  sections.copy = 'AI æœªç”Ÿæˆç™¼ä½ˆæ–‡æ¡ˆå…§å®¹';
                } else {
                  sections.copy = cleanMarkdownFormat(copyMatch[1].trim());
                }
                  console.log('å¼·åˆ¶æå–ç™¼ä½ˆæ–‡æ¡ˆ:', sections.copy.substring(0, 100) + '...');
              }
            }
          }
          
        } catch (error) {
          console.error('è§£æAIå…§å®¹æ™‚å‡ºéŒ¯:', error);
        }
        
        console.log('=== æœ€çµ‚è§£æçµæœ ===');
        console.log('ä¸»é¡Œæ¨™é¡Œ:', sections.title ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
        console.log('è…³æœ¬å…§å®¹:', sections.script ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
        console.log('ç•«é¢æ„Ÿ:', sections.visual ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
        console.log('ç™¼ä½ˆæ–‡æ¡ˆ:', sections.copy ? 'âœ… æœ‰å…§å®¹' : 'âŒ ç„¡å…§å®¹');
        
        // å¦‚æœæ‰€æœ‰å…§å®¹éƒ½ç‚ºç©ºï¼Œå˜—è©¦å¼·åˆ¶æå–
        if (!sections.title && !sections.script && !sections.visual && !sections.copy) {
          console.log('âš ï¸ æ‰€æœ‰å…§å®¹éƒ½ç‚ºç©ºï¼Œå˜—è©¦å¼·åˆ¶æå–...');
          
          // å¼·åˆ¶æå–ä¸»é¡Œæ¨™é¡Œ
          const titleMatch = aiText.match(/ä¸»é¡Œæ¨™é¡Œ[ï¼š:]\s*([^\n]+)/i);
          if (titleMatch && titleMatch[1]) {
            sections.title = cleanMarkdownFormat(titleMatch[1].trim());
            console.log('å¼·åˆ¶æå–ä¸»é¡Œæ¨™é¡Œ:', sections.title);
          }
          
          // å¼·åˆ¶æå–è…³æœ¬å…§å®¹
          const scriptMatch = aiText.match(/è…³æœ¬å…§å®¹[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç•«é¢æ„Ÿ|ç™¼ä½ˆæ–‡æ¡ˆ|$))/i);
          if (scriptMatch && scriptMatch[1]) {
            sections.script = cleanMarkdownFormat(scriptMatch[1].trim());
            console.log('å¼·åˆ¶æå–è…³æœ¬å…§å®¹:', sections.script.substring(0, 100) + '...');
          }
          
          // å¼·åˆ¶æå–ç•«é¢æ„Ÿ
          const visualMatch = aiText.match(/ç•«é¢æ„Ÿ[ï¼š:]\s*([\s\S]*?)(?=\n\s*(?:ç™¼ä½ˆæ–‡æ¡ˆ|$))/i);
          if (visualMatch && visualMatch[1]) {
            sections.visual = cleanMarkdownFormat(visualMatch[1].trim());
            console.log('å¼·åˆ¶æå–ç•«é¢æ„Ÿ:', sections.visual.substring(0, 100) + '...');
          }
          
          // å¼·åˆ¶æå–ç™¼ä½ˆæ–‡æ¡ˆ
          const copyMatch = aiText.match(/ç™¼ä½ˆæ–‡æ¡ˆ[ï¼š:]\s*([\s\S]*?)$/i);
          if (copyMatch && copyMatch[1]) {
            sections.copy = cleanMarkdownFormat(copyMatch[1].trim());
            console.log('å¼·åˆ¶æå–ç™¼ä½ˆæ–‡æ¡ˆ:', sections.copy.substring(0, 100) + '...');
          }
        }
        
        console.log('å®Œæ•´è§£æçµæœ:', sections);
        return sections;
      }

      // ===== æ¨¡å¼3ï¼šIPäººè¨­è¦åŠƒæ¨¡å¼å‡½æ•¸ =====
      
      // åˆ‡æ›èªªæ˜æ¬„ä½é¡¯ç¤º/éš±è—
      function toggleMode3Instructions() {
        const instructions = document.querySelector('.mode3-instructions');
        const chatMessages = document.querySelector('.mode3-chat-messages');
        
        if (instructions.classList.contains('collapsed')) {
          instructions.classList.remove('collapsed');
          chatMessages.classList.remove('expanded');
        } else {
          instructions.classList.add('collapsed');
          chatMessages.classList.add('expanded');
        }
      }

      // èˆŠçš„ sendMode3Message å‡½æ•¸å·²ç§»é™¤ï¼Œè«‹ä½¿ç”¨æ–°çš„å‡½æ•¸ï¼ˆåœ¨ line 18226ï¼‰

      // æ·»åŠ è¨Šæ¯åˆ°èŠå¤©å€åŸŸ - ä½¿ç”¨èˆ‡ mode2 ç›¸åŒçš„çµæ§‹
      function addMode3Message(sender, content) {
        const messagesContainer = document.getElementById('mode3-chat-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${sender}`;
        
        // ç‚ºåŠ©æ‰‹è¨Šæ¯æ·»åŠ  ID
        if (sender === 'assistant') {
          const messageId = 'msg-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
          messageDiv.id = messageId;
        }
        
        // å‰µå»ºé ­åƒå…ƒç´ 
        const avatarDiv = document.createElement('div');
        avatarDiv.className = 'message-avatar';
        
        if (sender === 'user') {
          // ç”¨æˆ¶é ­åƒï¼šä½¿ç”¨ Gmail é ­åƒæˆ–é»˜èªé ­åƒ
          const userAvatarImg = document.getElementById('userAvatar');
          if (userAvatarImg && userAvatarImg.src && userAvatarImg.src !== '') {
            const img = document.createElement('img');
            img.src = userAvatarImg.src;
            img.alt = 'ç”¨æˆ¶é ­åƒ';
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.borderRadius = '50%';
            img.style.objectFit = 'cover';
            avatarDiv.appendChild(img);
          } else {
            avatarDiv.textContent = 'ğŸ‘¤';
          }
        } else {
          // AI é ­åƒï¼šä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿ
          avatarDiv.textContent = 'ğŸ¤–';
        }
        
        // å‰µå»ºè¨Šæ¯å…§å®¹å…ƒç´  - ä½¿ç”¨èˆ‡ mode2 ç›¸åŒçš„é¡åå’Œè™•ç†
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        
        if (sender === 'assistant' && content) {
          // AI å›è¦†ä½¿ç”¨ markdown æ¸²æŸ“
          contentDiv.innerHTML = safeRenderMarkdown(content);
          // å°ä»£ç¢¼å¡Šé€²è¡Œèªæ³•é«˜äº®
          if (typeof hljs !== 'undefined') {
            contentDiv.querySelectorAll('pre code').forEach((block) => {
              hljs.highlightElement(block);
            });
          }
        } else if (sender === 'user') {
          contentDiv.textContent = content;
        }
        
        messageDiv.appendChild(avatarDiv);
        messageDiv.appendChild(contentDiv);
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        
        return messageDiv;
      }

      // æ·»åŠ è¼‰å…¥è¨Šæ¯ - ä½¿ç”¨èˆ‡ mode2 ç›¸åŒçš„çµæ§‹
      function addMode3LoadingMessage() {
        const messagesContainer = document.getElementById('mode3-chat-messages');
        const messageDiv = document.createElement('div');
        const messageId = 'loading-' + Date.now();
        messageDiv.id = messageId;
        messageDiv.className = 'message assistant';
        
        messageDiv.innerHTML = `
          <div class="message-avatar">ğŸ¤–</div>
          <div class="message-content">
            <div class="typing-indicator">
              <span>AIæ­£åœ¨æ€è€ƒä¸­</span>
              <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
              </div>
            </div>
          </div>
        `;
        
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        
        return messageId;
      }
      
      // ç§»é™¤è¼‰å…¥è¨Šæ¯
      function removeMode3LoadingMessage(messageId) {
        const loadingMessage = document.getElementById(messageId);
        if (loadingMessage) {
          loadingMessage.remove();
        }
      }
      
      // æ›´æ–°è¨Šæ¯å…§å®¹ - ä½¿ç”¨èˆ‡ mode2 ç›¸åŒçš„çµæ§‹
      function updateMode3Message(messageId, content) {
        const messageDiv = document.getElementById(messageId);
        if (messageDiv) {
          const contentDiv = messageDiv.querySelector('.message-content');
          if (contentDiv) {
            // ä½¿ç”¨ renderMarkdown è™•ç†å…§å®¹ï¼ˆèˆ‡ mode2 ç›¸åŒï¼‰
            contentDiv.innerHTML = safeRenderMarkdown(content);
            // å°ä»£ç¢¼å¡Šé€²è¡Œèªæ³•é«˜äº®
            if (typeof hljs !== 'undefined') {
              contentDiv.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
              });
            }
            const messagesContainer = document.getElementById('mode3-chat-messages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
          }
        }
      }

      // æ›´æ–°æœ€å¾Œä¸€æ¢è¨Šæ¯
      function updateMode3LastMessage(messageId, sender, content) {
        const messageDiv = document.getElementById(messageId);
        if (messageDiv) {
          messageDiv.className = `mode3-message mode3-${sender}-message`;
          
          // å‰µå»ºé ­åƒå…ƒç´ 
          const avatarDiv = document.createElement('div');
          avatarDiv.className = 'mode3-message-avatar';
          
          if (sender === 'user') {
            // ç”¨æˆ¶é ­åƒï¼šä½¿ç”¨ Gmail é ­åƒæˆ–é»˜èªé ­åƒ
            const userAvatarImg = document.getElementById('userAvatar');
            if (userAvatarImg && userAvatarImg.src && userAvatarImg.src !== '') {
              const img = document.createElement('img');
              img.src = userAvatarImg.src;
              img.alt = 'ç”¨æˆ¶é ­åƒ';
              img.style.width = '100%';
              img.style.height = '100%';
              img.style.borderRadius = '50%';
              img.style.objectFit = 'cover';
              avatarDiv.appendChild(img);
            } else {
              avatarDiv.textContent = 'ğŸ‘¤';
            }
          } else {
            // AI é ­åƒï¼šä½¿ç”¨è¡¨æƒ…ç¬¦è™Ÿ
            avatarDiv.textContent = 'ğŸ¤–';
          }
          
          // å‰µå»ºè¨Šæ¯å…§å®¹å…ƒç´ 
          const contentDiv = document.createElement('div');
          contentDiv.className = 'mode3-message-content';
          const safeContent = escapeHtml(content);
          contentDiv.innerHTML = `<p>${safeContent}</p>`;
          
          messageDiv.innerHTML = '';
          messageDiv.appendChild(avatarDiv);
          messageDiv.appendChild(contentDiv);
        }
      }

      // åˆ‡æ›çµæœæ¨™ç±¤
      function switchMode3Tab(tabName) {
        // ç§»é™¤æ‰€æœ‰æ¨™ç±¤çš„activeé¡åˆ¥
        document.querySelectorAll('.mode3-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        
        // éš±è—æ‰€æœ‰çµæœå€å¡Š
        document.querySelectorAll('.mode3-result-block').forEach(block => {
          block.classList.remove('active');
        });
        
        // æ¿€æ´»é¸ä¸­çš„æ¨™ç±¤
        event.target.classList.add('active');
        
        // é¡¯ç¤ºå°æ‡‰çš„çµæœå€å¡Š
        const resultBlock = document.getElementById(`mode3-${tabName}-result`);
        if (resultBlock) {
          resultBlock.classList.add('active');
        }
      }

      // ç”ŸæˆIP Profile
      window.generateMode3IPProfile = async function() {
        const resultBlock = document.getElementById('mode3-profile-result');
        const button = resultBlock.querySelector('.mode3-generate-btn');
        
        // ç¦ç”¨æŒ‰éˆ•ä¸¦é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
        button.disabled = true;
        button.innerHTML = '<span>â³</span> ç”Ÿæˆä¸­...';
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/chat/stream', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: 'è«‹æ ¹æ“šæˆ‘å€‘çš„å°è©±å…§å®¹ï¼Œç”Ÿæˆä¸€ä»½å®Œæ•´çš„IP Profileã€‚è«‹ä½¿ç”¨è‡ªç„¶èªè¨€ã€å‹å–„çš„èªæ°£ï¼Œä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼å‘ˆç¾ã€‚é‡è¦æ¨™é¡Œå’Œé—œéµè©è«‹ä½¿ç”¨**ç²—é«”**æ¨™è¨˜ï¼ˆMarkdownæ ¼å¼ï¼‰ã€‚çµ•å°ä¸è¦å‡ºç¾ä»»ä½•ç¨‹å¼ç¢¼ã€æŠ€è¡“è¡“èªæˆ–è¤‡é›œçš„çµæ§‹åŒ–æ ¼å¼ã€‚å…§å®¹åŒ…å«ï¼š1.**äººè¨­æ¨™ç±¤**ï¼šåˆ—å‡º3-5å€‹æ¨™ç±¤ï¼Œç”¨è‡ªç„¶èªè¨€æè¿° 2.**ä¸€å¥è©±å®šä½**ï¼šç”¨ä¸€å¥è©±æ¸…æ¥šèªªæ˜å€‹äººå®šä½ 3.**å“ç‰ŒåŸå‹**ï¼šç°¡æ½”æè¿°å“ç‰ŒåŸå‹å’Œç‰¹è³ª 4.**èªæ°£è¨­å®š**ï¼šç”¨å‹å–„çš„èªè¨€èªªæ˜èªæ°£ç‰¹é» 5.**æ ¸å¿ƒåƒ¹å€¼è§€**ï¼šåˆ—å‡º3-5å€‹æ ¸å¿ƒåƒ¹å€¼ï¼Œç”¨ç°¡çŸ­å¥å­èªªæ˜ 6.**ç¦èªæ¸…å–®**ï¼šåˆ—å‡ºæ‡‰è©²é¿å…ä½¿ç”¨çš„è©å½™å’Œè¡¨é”æ–¹å¼ 7.**è¦–è¦ºè¨­å®š**ï¼šæè¿°è¦–è¦ºé¢¨æ ¼ã€é…è‰²ã€å­—é«”ç­‰ï¼Œç”¨è‡ªç„¶èªè¨€ 8.**KPIæŒ‡æ¨™**ï¼šèªªæ˜é—œéµæŒ‡æ¨™ï¼Œç”¨æ˜“æ‡‚çš„æ–¹å¼å‘ˆç¾',
              user_id: ipPlanningUser?.user_id || 'anonymous',
              platform: 'çŸ­å½±éŸ³å¹³å°',
              profile: 'IPäººè¨­è¦åŠƒå°ˆå®¶',
              topic: 'IP Profileç”Ÿæˆ',
              style: 'è‡ªç„¶èªè¨€ã€ç”¨æˆ¶å‹å¥½ã€æ˜“è®€æ˜“æ‡‚ï¼Œä½¿ç”¨Markdownç²—é«”æ¨™è¨˜é‡è¦å…§å®¹ï¼Œä¸è¦ç¨‹å¼ç¢¼æˆ–æŠ€è¡“æ ¼å¼',
              duration: '30'
            })
          });
          
          if (response.ok) {
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let content = '';
            
            while (true) {
              const { done, value } = await reader.read();
              if (done) break;
              
              const chunk = decoder.decode(value);
              const lines = chunk.split('\n');
              
              for (const line of lines) {
                if (line.startsWith('data: ')) {
                  const data = line.slice(6);
                  if (data === '[DONE]') continue;
                  
                  try {
                    const parsed = JSON.parse(data);
                    if (parsed.content) {
                      content += parsed.content;
                    }
                  } catch (e) {
                    // å¿½ç•¥è§£æéŒ¯èª¤
                  }
                }
              }
            }
            
            // ä½¿ç”¨ Markdown æ¸²æŸ“å‡½æ•¸è™•ç†å…§å®¹
            const renderedContent = typeof renderMode3Markdown !== 'undefined' 
              ? renderMode3Markdown(content) 
              : content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            resultBlock.innerHTML = `<div class="mode3-result-content">${renderedContent}</div>`;
            button.innerHTML = '<span>ğŸš€</span> é‡æ–°ç”Ÿæˆ';
            button.disabled = false;
          } else {
            throw new Error('ç”Ÿæˆå¤±æ•—');
          }
        } catch (error) {
          console.error('ç”ŸæˆIP Profileå¤±æ•—:', error);
          button.innerHTML = '<span>âŒ</span> ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦';
          button.disabled = false;
        }
      }

      // ç”Ÿæˆ14å¤©è¦åŠƒ
      window.generateMode314DayPlan = async function() {
        const resultBlock = document.getElementById('mode3-plan-result');
        const button = resultBlock.querySelector('.mode3-generate-btn');
        
        button.disabled = true;
        button.innerHTML = '<span>â³</span> ç”Ÿæˆä¸­...';
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/chat/stream', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: 'è«‹æ ¹æ“šæˆ‘å€‘çš„å°è©±å…§å®¹å’ŒIP Profileï¼Œç”Ÿæˆä¸€ä»½14å¤©çŸ­å½±éŸ³è¦åŠƒè¡¨ã€‚è«‹ä½¿ç”¨è‡ªç„¶èªè¨€ã€å‹å–„çš„èªæ°£ï¼Œä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼å‘ˆç¾æ¯ä¸€å¤©çš„è¦åŠƒã€‚é‡è¦æ¨™é¡Œå’Œé—œéµè©è«‹ä½¿ç”¨**ç²—é«”**æ¨™è¨˜ï¼ˆMarkdownæ ¼å¼ï¼‰ã€‚çµ•å°ä¸è¦å‡ºç¾ä»»ä½•ç¨‹å¼ç¢¼ã€è¡¨æ ¼ç¬¦è™Ÿæˆ–è¤‡é›œçš„çµæ§‹åŒ–æ ¼å¼ã€‚æ¯ä¸€å¤©çš„è¦åŠƒè«‹åŒ…å«ï¼š1.**æ¯æ—¥ä¸»é¡Œ**ï¼šç”¨ä¸€å¥è©±èªªæ˜ç•¶å¤©çš„ä¸»é¡Œ 2.**å…§å®¹æ–¹å‘**ï¼šç”¨2-3å¥è‡ªç„¶èªè¨€æè¿°å…§å®¹é‡é» 3.**æ‹æ”å»ºè­°**ï¼šç”¨ç°¡çŸ­æ˜“æ‡‚çš„å¥å­èªªæ˜æ‹æ”è¦é» 4.**ç™¼å¸ƒæ™‚é–“**ï¼šå»ºè­°ç™¼å¸ƒæ™‚æ®µ 5.**äº’å‹•ç­–ç•¥**ï¼šç”¨ä¸€å¥è©±èªªæ˜å¦‚ä½•èˆ‡è§€çœ¾äº’å‹•ã€‚è«‹å°‡æ¯ä¸€å¤©çš„å…§å®¹ç”¨æ¸…æ™°çš„æ®µè½åˆ†éš”ï¼Œè®“ç”¨æˆ¶å®¹æ˜“é–±è®€ã€‚',
              user_id: ipPlanningUser?.user_id || 'anonymous',
              platform: 'çŸ­å½±éŸ³å¹³å°',
              profile: 'IPäººè¨­è¦åŠƒå°ˆå®¶',
              topic: '14å¤©è¦åŠƒç”Ÿæˆ',
              style: 'è‡ªç„¶èªè¨€ã€ç”¨æˆ¶å‹å¥½ã€æ˜“è®€æ˜“æ‡‚ï¼Œä½¿ç”¨Markdownç²—é«”æ¨™è¨˜é‡è¦å…§å®¹ï¼Œä¸è¦ç¨‹å¼ç¢¼æˆ–è¡¨æ ¼æ ¼å¼',
              duration: '30'
            })
          });
          
          if (response.ok) {
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let content = '';
            
            while (true) {
              const { done, value } = await reader.read();
              if (done) break;
              
              const chunk = decoder.decode(value);
              const lines = chunk.split('\n');
              
              for (const line of lines) {
                if (line.startsWith('data: ')) {
                  const data = line.slice(6);
                  if (data === '[DONE]') continue;
                  
                  try {
                    const parsed = JSON.parse(data);
                    if (parsed.content) {
                      content += parsed.content;
                    }
                  } catch (e) {
                    // å¿½ç•¥è§£æéŒ¯èª¤
                  }
                }
              }
            }
            
            // ä½¿ç”¨ Markdown æ¸²æŸ“å‡½æ•¸è™•ç†å…§å®¹
            const renderedContent = typeof renderMode3Markdown !== 'undefined' 
              ? renderMode3Markdown(content) 
              : content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            resultBlock.innerHTML = `<div class="mode3-result-content">${renderedContent}</div>`;
            button.innerHTML = '<span>ğŸš€</span> é‡æ–°ç”Ÿæˆ';
            button.disabled = false;
          } else {
            throw new Error('ç”Ÿæˆå¤±æ•—');
          }
        } catch (error) {
          console.error('ç”Ÿæˆ14å¤©è¦åŠƒå¤±æ•—:', error);
          button.innerHTML = '<span>âŒ</span> ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦';
          button.disabled = false;
        }
      }
      // ç”Ÿæˆä»Šæ—¥è…³æœ¬
      window.generateMode3TodayScripts = async function() {
        const resultBlock = document.getElementById('mode3-scripts-result');
        const button = resultBlock.querySelector('.mode3-generate-btn');
        
        button.disabled = true;
        button.innerHTML = '<span>â³</span> ç”Ÿæˆä¸­...';
        
        try {
          const response = await fetch('https://aivideobackend.zeabur.app/api/chat/stream', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${ipPlanningToken}`
            },
            body: JSON.stringify({
              message: 'è«‹æ ¹æ“šæˆ‘å€‘çš„å°è©±å…§å®¹å’ŒIP Profileï¼Œç”Ÿæˆä»Šæ—¥3æ”¯çŸ­å½±éŸ³è…³æœ¬ã€‚è«‹ä½¿ç”¨è‡ªç„¶èªè¨€ã€å‹å–„çš„èªæ°£ï¼Œä»¥æ¸…æ™°æ˜“æ‡‚çš„æ–¹å¼å‘ˆç¾ã€‚é‡è¦æ¨™é¡Œå’Œé—œéµè©è«‹ä½¿ç”¨**ç²—é«”**æ¨™è¨˜ï¼ˆMarkdownæ ¼å¼ï¼‰ã€‚çµ•å°ä¸è¦å‡ºç¾ä»»ä½•ç¨‹å¼ç¢¼ã€æŠ€è¡“è¡“èªæˆ–è¤‡é›œçš„çµæ§‹åŒ–æ ¼å¼ã€‚æ¯æ”¯è…³æœ¬è«‹åŒ…å«ï¼š1.**ä¸»é¡Œæ¨™é¡Œ**ï¼šç”¨ä¸€å¥è©±æ¸…æ¥šèªªæ˜é€™æ”¯å½±ç‰‡çš„ä¸»é¡Œ 2.**é–‹å ´é‰¤å­**ï¼šç”¨è‡ªç„¶èªè¨€å¯«å‡ºå¸å¼•äººçš„é–‹å ´ï¼Œè®“è§€çœ¾æƒ³ç¹¼çºŒçœ‹ä¸‹å» 3.**æ ¸å¿ƒå…§å®¹**ï¼šç”¨2-3å¥è‡ªç„¶èªè¨€èªªæ˜å½±ç‰‡è¦å‚³é”çš„åƒ¹å€¼ 4.**è¡Œå‹•å‘¼ç±²**ï¼šç”¨ä¸€å¥è©±å¼•å°è§€çœ¾æ¡å–è¡Œå‹• 5.**ç•«é¢æè¿°**ï¼šç”¨ç°¡çŸ­æ˜“æ‡‚çš„å¥å­æè¿°ç•«é¢æ‡‰è©²å‘ˆç¾ä»€éº¼ 6.**ç™¼ä½ˆæ–‡æ¡ˆ**ï¼šå¯«ä¸€æ®µé©åˆç¤¾ç¾¤åª’é«”çš„æ–‡æ¡ˆã€‚è«‹å°‡æ¯æ”¯è…³æœ¬ç”¨æ¸…æ™°çš„æ®µè½åˆ†éš”ï¼Œè®“ç”¨æˆ¶å®¹æ˜“é–±è®€å’Œä½¿ç”¨ã€‚',
              user_id: ipPlanningUser?.user_id || 'anonymous',
              platform: 'çŸ­å½±éŸ³å¹³å°',
              profile: 'IPäººè¨­è¦åŠƒå°ˆå®¶',
              topic: 'ä»Šæ—¥è…³æœ¬ç”Ÿæˆ',
              style: 'è‡ªç„¶èªè¨€ã€ç”¨æˆ¶å‹å¥½ã€æ˜“è®€æ˜“æ‡‚ï¼Œä½¿ç”¨Markdownç²—é«”æ¨™è¨˜é‡è¦å…§å®¹ï¼Œä¸è¦ç¨‹å¼ç¢¼æˆ–æŠ€è¡“æ ¼å¼',
              duration: '30'
            })
          });
          
          if (response.ok) {
            const reader = response.body.getReader();
            const decoder = new TextDecoder();
            let content = '';
            
            while (true) {
              const { done, value } = await reader.read();
              if (done) break;
              
              const chunk = decoder.decode(value);
              const lines = chunk.split('\n');
              
              for (const line of lines) {
                if (line.startsWith('data: ')) {
                  const data = line.slice(6);
                  if (data === '[DONE]') continue;
                  
                  try {
                    const parsed = JSON.parse(data);
                    if (parsed.content) {
                      content += parsed.content;
                    }
                  } catch (e) {
                    // å¿½ç•¥è§£æéŒ¯èª¤
                  }
                }
              }
            }
            
            // ä½¿ç”¨ Markdown æ¸²æŸ“å‡½æ•¸è™•ç†å…§å®¹
            const renderedContent = typeof renderMode3Markdown !== 'undefined' 
              ? renderMode3Markdown(content) 
              : content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            resultBlock.innerHTML = `<div class="mode3-result-content">${renderedContent}</div>`;
            button.innerHTML = '<span>ğŸš€</span> é‡æ–°ç”Ÿæˆ';
            button.disabled = false;
          } else {
            throw new Error('ç”Ÿæˆå¤±æ•—');
          }
        } catch (error) {
          console.error('ç”Ÿæˆä»Šæ—¥è…³æœ¬å¤±æ•—:', error);
          button.innerHTML = '<span>âŒ</span> ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦';
          button.disabled = false;
        }
      }

      // å„²å­˜çµæœ
      window.saveMode3Result = async function() {
        const token = localStorage.getItem('ipPlanningToken');
        const userStr = localStorage.getItem('ipPlanningUser');
        
        if (!token || !userStr) {
          showToast('è«‹å…ˆç™»å…¥', 3000);
          return;
        }
        
        try {
          const user = JSON.parse(userStr);
          const activeTab = document.querySelector('.mode3-tab.active');
          if (!activeTab) {
            showToast('è«‹å…ˆé¸æ“‡è¦å„²å­˜çš„çµæœ', 3000);
            return;
          }
          
          // åˆ¤æ–·çµæœé¡å‹
          let resultType = '';
          let title = '';
          if (activeTab.textContent.includes('Profile')) {
            resultType = 'profile';
            title = 'IP Profile';
          } else if (activeTab.textContent.includes('è¦åŠƒ')) {
            resultType = 'plan';
            title = '14å¤©çŸ­å½±éŸ³è¦åŠƒ';
          } else if (activeTab.textContent.includes('è…³æœ¬')) {
            resultType = 'scripts';
            title = 'ä»Šæ—¥3æ”¯è…³æœ¬';
          }
          
          const resultBlock = document.getElementById(`mode3-${resultType}-result`);
          const content = resultBlock.querySelector('.mode3-result-content');
          
          if (!content || !content.innerHTML.trim()) {
            showToast('æ²’æœ‰å¯å„²å­˜çš„å…§å®¹', 3000);
            return;
          }
          
          // æå–ç´”æ–‡å­—å…§å®¹ï¼ˆå»é™¤HTMLæ¨™ç±¤ç”¨æ–¼æ¨™é¡Œï¼‰
          const textContent = content.innerText || content.textContent || '';
          const shortTitle = textContent.substring(0, 50) || title;
          
          // é¡¯ç¤ºå„²å­˜ä¸­é€šçŸ¥
          showToast('æ­£åœ¨å„²å­˜...', 2000);
          
          const response = await fetch('https://aivideobackend.zeabur.app/api/ip-planning/save', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
              user_id: user.user_id,
              result_type: resultType,
              title: shortTitle,
              content: content.innerHTML,
              metadata: {
                timestamp: new Date().toISOString(),
                source: 'mode3'
              }
            })
          });
          
          if (!response.ok) {
            const errorData = await response.json().catch(() => ({ error: 'ç¶²è·¯éŒ¯èª¤' }));
            throw new Error(errorData.error || `HTTP ${response.status}`);
          }
          
          const data = await response.json();
          if (data.success) {
            showToast('âœ… çµæœå·²å„²å­˜åˆ°å€‹äººè³‡æ–™åº«', 3000);
            console.log('å„²å­˜æˆåŠŸ:', data);
          } else {
            showToast('âŒ ' + (data.error || 'å„²å­˜å¤±æ•—'), 3000);
            console.error('å„²å­˜å¤±æ•—:', data);
          }
        } catch (error) {
          console.error('å„²å­˜çµæœå¤±æ•—:', error);
          showToast('âŒ å„²å­˜å¤±æ•—ï¼š' + (error.message || 'è«‹ç¨å¾Œå†è©¦'), 3000);
        }
      }

      // é‡æ–°ç”Ÿæˆçµæœ
      function regenerateMode3Result() {
        const activeTab = document.querySelector('.mode3-tab.active');
        if (activeTab) {
          const tabName = activeTab.textContent.includes('Profile') ? 'profile' : 
                         activeTab.textContent.includes('è¦åŠƒ') ? 'plan' : 'scripts';
          
          if (tabName === 'profile') {
            generateMode3IPProfile();
          } else if (tabName === 'plan') {
            generateMode314DayPlan();
          } else if (tabName === 'scripts') {
            generateMode3TodayScripts();
          }
        }
      }

      // åŒ¯å‡ºçµæœï¼ˆæ”¯æ´ CSV å’Œ JSONï¼‰
      window.exportMode3Result = function() {
        const activeTab = document.querySelector('.mode3-tab.active');
        if (!activeTab) {
          showToast('è«‹å…ˆé¸æ“‡è¦åŒ¯å‡ºçš„çµæœ', 3000);
          return;
        }
        
        const tabName = activeTab.textContent.includes('Profile') ? 'profile' : 
                       activeTab.textContent.includes('è¦åŠƒ') ? 'plan' : 'scripts';
        
        const resultBlock = document.getElementById(`mode3-${tabName}-result`);
        const content = resultBlock.querySelector('.mode3-result-content');
        
        if (!content || !content.innerHTML.trim()) {
          showToast('æ²’æœ‰å¯åŒ¯å‡ºçš„å…§å®¹', 3000);
          return;
        }
        
        try {
          // æå–ç´”æ–‡å­—å…§å®¹ç”¨æ–¼ CSV
          const textContent = content.innerText || content.textContent || '';
          
          // ç”Ÿæˆ CSV æ ¼å¼
          const csvContent = `é¡å‹,æ¨™é¡Œ,å…§å®¹,åŒ¯å‡ºæ™‚é–“\n"${tabName}","${tabName === 'profile' ? 'IP Profile' : tabName === 'plan' ? '14å¤©è¦åŠƒ' : 'ä»Šæ—¥è…³æœ¬'}","${textContent.replace(/"/g, '""').replace(/\n/g, ' ')}","${new Date().toLocaleString('zh-TW', {
            timeZone: 'Asia/Taipei',
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          })}"`;
          
          // å‰µå»º CSV æª”æ¡ˆ
          const csvBlob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
          const csvUrl = URL.createObjectURL(csvBlob);
          const csvLink = document.createElement('a');
          csvLink.href = csvUrl;
          csvLink.download = `ip-${tabName}-${Date.now()}.csv`;
          csvLink.click();
          URL.revokeObjectURL(csvUrl);
          
          showToast('âœ… çµæœå·²åŒ¯å‡ºç‚º CSV æª”æ¡ˆ', 3000);
        } catch (error) {
          console.error('åŒ¯å‡ºå¤±æ•—:', error);
          showToast('åŒ¯å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 3000);
        }
      }

      // åˆå§‹åŒ–æ¨¡å¼3
      function initializeMode3() {
        // è¨­ç½®èªªæ˜æ¬„ä½é è¨­ç‚ºæ”¶èµ·ç‹€æ…‹
        setTimeout(() => {
          const instructions = document.querySelector('.mode3-instructions');
          const chatMessages = document.querySelector('.mode3-chat-messages');
          if (instructions && chatMessages) {
            instructions.classList.add('collapsed');
            chatMessages.classList.add('expanded');
          }
        }, 100);
        
        // è¨­ç½®è¼¸å…¥æ¡†Enteréµç™¼é€
        const input = document.getElementById('mode3-message-input');
        if (input) {
          input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              sendMode3Message();
            }
          });
        }
        
        // è¼‰å…¥æ­·å²å°è©±è¨˜éŒ„
        loadMode3History();
      }
      
      // è¼‰å…¥IPäººè¨­è¦åŠƒæ¨¡å¼çš„æ­·å²å°è©±
      async function loadMode3History() {
        // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
        if (!ipPlanningUser?.user_id || !ipPlanningToken) {
          console.log('æœªç™»å…¥ï¼Œè·³éè¼‰å…¥æ­·å²å°è©±');
          return;
        }
        
        console.log('é–‹å§‹è¼‰å…¥IPäººè¨­è¦åŠƒæ­·å²å°è©±ï¼Œç”¨æˆ¶ID:', ipPlanningUser.user_id);
        
        try {
          // è¼‰å…¥å°è©±è¨˜éŒ„
          const conversationsResponse = await fetch(`https://aivideobackend.zeabur.app/api/user/conversations/${ipPlanningUser.user_id}`);
          
          if (conversationsResponse.ok) {
            const conversationsData = await conversationsResponse.json();
            console.log('è¼‰å…¥çš„å°è©±è¨˜éŒ„:', conversationsData);
            
            // é¡¯ç¤ºæ­·å²å°è©±åˆ°èŠå¤©å€åŸŸ
            if (conversationsData.conversations && conversationsData.conversations.length > 0) {
              displayMode3History(conversationsData.conversations);
            }
          } else {
            console.error('è¼‰å…¥å°è©±è¨˜éŒ„å¤±æ•—:', conversationsResponse.status);
          }
        } catch (error) {
          console.error('è¼‰å…¥æ­·å²å°è©±éŒ¯èª¤:', error);
        }
      }
      
      // é¡¯ç¤ºæ­·å²å°è©±åˆ°IPäººè¨­è¦åŠƒèŠå¤©å€åŸŸ
      function displayMode3History(conversations) {
        const messagesContainer = document.getElementById('mode3-chat-messages');
        if (!messagesContainer) return;
        
        // æ¸…ç©ºç¾æœ‰çš„æ­¡è¿è¨Šæ¯
        messagesContainer.innerHTML = '';
        
        // é¡¯ç¤ºæ­·å²å°è©±
        conversations.forEach(conversation => {
          if (conversation.messages && conversation.messages.length > 0) {
            conversation.messages.forEach(message => {
              if (message.role === 'user' || message.role === 'assistant') {
                addMode3Message(message.role, message.content);
              }
            });
          }
        });
        
        // æ»¾å‹•åˆ°åº•éƒ¨
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }
      
      // è¼‰å…¥AIé¡§å•æ¨¡å¼çš„æ­·å²å°è©±
      async function loadMode2History() {
        // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
        if (!ipPlanningUser?.user_id || !ipPlanningToken) {
          console.log('æœªç™»å…¥ï¼Œè·³éè¼‰å…¥AIé¡§å•æ­·å²å°è©±');
          return;
        }
        
        console.log('é–‹å§‹è¼‰å…¥AIé¡§å•æ­·å²å°è©±ï¼Œç”¨æˆ¶ID:', ipPlanningUser.user_id);
        
        const messagesContainer = document.getElementById('chatMessages');
        if (!messagesContainer) return;
        
        // é‡æ–°æ•´ç†æ™‚ä¸è‡ªå‹•è¼‰å…¥æ­·å²å°è©±ï¼ˆèŠå¤©å€åŸŸå·²åœ¨ DOMContentLoaded æ™‚æ¸…ç©ºï¼‰
        // ç”¨æˆ¶å¯ä»¥é€šéã€ŒğŸ”„ è¼‰å…¥æœ¬æœƒè©±ã€æŒ‰éˆ•ä¸»å‹•è¼‰å…¥æ­·å²å°è©±
        console.log('æ³¨æ„ï¼šé‡æ–°æ•´ç†å¾ŒèŠå¤©å€åŸŸå·²æ¸…ç©ºï¼Œå¦‚éœ€æŸ¥çœ‹æ­·å²å°è©±ï¼Œè«‹é»æ“Šã€ŒğŸ”„ è¼‰å…¥æœ¬æœƒè©±ã€æŒ‰éˆ•');
      }
      
      // é¡¯ç¤ºæ­·å²å°è©±åˆ°AIé¡§å•èŠå¤©å€åŸŸ
      function displayMode2History(memories) {
        const messagesContainer = document.getElementById('chatMessages');
        if (!messagesContainer) return;
        
        // å¦‚æœå·²ç¶“æœ‰è¨Šæ¯ï¼Œä¸è¦æ¸…ç©º
        if (messagesContainer.children.length > 0) {
          console.log('èŠå¤©å€åŸŸå·²æœ‰è¨Šæ¯ï¼Œä¸é¡¯ç¤ºæ­·å²å°è©±');
          return;
        }
        
        // æŒ‰æ™‚é–“æ’åºè¨Šæ¯
        const sortedMemories = memories
          .filter(mem => mem.conversation_type === 'ai_advisor')
          .sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
        
        // é¡¯ç¤ºæ­·å²å°è©±
        sortedMemories.forEach(memory => {
          if (memory.message_role === 'user' || memory.message_role === 'assistant') {
            const messageDiv = createMessage(memory.message_role, memory.message_content);
                messagesContainer.appendChild(messageDiv);
          }
        });
        
        // æ»¾å‹•åˆ°åº•éƒ¨
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      // é—œé–‰èŠå¤©å®¹å™¨
      function closeChatContainer() {
      }
      
      // IPäººè¨­è¦åŠƒä½¿ç”¨èªªæ˜æŠ½å±œæ§åˆ¶
      function toggleMode3InstructionsDrawer() {
        const overlay = document.getElementById('mode3InstructionsOverlay');
        const drawer = document.getElementById('mode3InstructionsDrawer');
        
        if (overlay && drawer) {
          const isOpen = overlay.classList.contains('open');
          
          if (isOpen) {
            closeMode3InstructionsDrawer();
          } else {
            openMode3InstructionsDrawer();
          }
        }
      }
      
      function openMode3InstructionsDrawer() {
        const overlay = document.getElementById('mode3InstructionsOverlay');
        const drawer = document.getElementById('mode3InstructionsDrawer');
        
        if (overlay && drawer) {
          overlay.classList.add('open');
          drawer.classList.add('open');
          document.body.style.overflow = 'hidden';
        }
      }
      
      function closeMode3InstructionsDrawer() {
        const overlay = document.getElementById('mode3InstructionsOverlay');
        const drawer = document.getElementById('mode3InstructionsDrawer');
        
        if (overlay && drawer) {
          overlay.classList.remove('open');
          drawer.classList.remove('open');
          document.body.style.overflow = '';
        }
      }
      
      // IPäººè¨­è¦åŠƒç”ŸæˆçµæœæŠ½å±œæ§åˆ¶
      function toggleMode3ResultsDrawer() {
        const overlay = document.getElementById('mode3ResultsOverlay');
        const drawer = document.getElementById('mode3ResultsDrawer');
        
        if (overlay && drawer) {
          const isOpen = overlay.classList.contains('open');
          
          if (isOpen) {
            closeMode3ResultsDrawer();
          } else {
            openMode3ResultsDrawer();
          }
        }
      }
      
      function openMode3ResultsDrawer() {
        const overlay = document.getElementById('mode3ResultsOverlay');
        const drawer = document.getElementById('mode3ResultsDrawer');
        
        if (overlay && drawer) {
          overlay.classList.add('open');
          drawer.classList.add('open');
          document.body.style.overflow = 'hidden';
        }
      }
      
      function closeMode3ResultsDrawer() {
        const overlay = document.getElementById('mode3ResultsOverlay');
        const drawer = document.getElementById('mode3ResultsDrawer');
        
        if (overlay && drawer) {
          overlay.classList.remove('open');
          drawer.classList.remove('open');
          document.body.style.overflow = '';
        }
      }

      // æ‰‹æ©Ÿç‰ˆæŠ½å±œæ§åˆ¶å‡½æ•¸
      function toggleMobileDrawer() {
        const drawer = document.getElementById('mobileDrawer');
        const overlay = document.getElementById('mobileDrawerOverlay');
        
        if (drawer && overlay) {
          const isOpen = drawer.classList.contains('open');
          
          if (isOpen) {
            closeMobileDrawer();
          } else {
            openMobileDrawer();
          }
        }
      }

      function openMobileDrawer() {
        const drawer = document.getElementById('mobileDrawer');
        const overlay = document.getElementById('mobileDrawerOverlay');
        
        if (drawer && overlay) {
          drawer.classList.add('open');
          overlay.style.display = 'block';
          document.body.style.overflow = 'hidden'; // é˜²æ­¢èƒŒæ™¯æ»¾å‹•
        }
      }

      function closeMobileDrawer() {
        const drawer = document.getElementById('mobileDrawer');
        const overlay = document.getElementById('mobileDrawerOverlay');
        
        if (drawer && overlay) {
          drawer.classList.remove('open');
          overlay.style.display = 'none';
          document.body.style.overflow = ''; // æ¢å¾©èƒŒæ™¯æ»¾å‹•
        }
      }


      // åœ¨é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–æ¨¡å¼3
      window.addEventListener('load', function() {
        setTimeout(() => {
          try {
            initializeMode3();
          } catch (error) {
            console.error('åˆå§‹åŒ–éŒ¯èª¤:', error);
          }
        }, 1000);
      });
    </script>
    
    <!-- IPäººè¨­è¦åŠƒä½¿ç”¨èªªæ˜æŠ½å±œ -->
    <div class="mode3-instructions-overlay" id="mode3InstructionsOverlay" onclick="closeMode3InstructionsDrawer()"></div>
    <div class="mode3-instructions-drawer" id="mode3InstructionsDrawer">
      <div class="mode3-instructions-drawer-header">
        <h3>ğŸ“‹ IPäººè¨­è¦åŠƒä½¿ç”¨èªªæ˜</h3>
        <button class="mode3-instructions-drawer-close" onclick="closeMode3InstructionsDrawer()">âœ•</button>
      </div>
      <div class="mode3-instructions-drawer-content">
        <p><strong>ğŸ¯ IPäººè¨­è¦åŠƒæ¨¡å¼</strong></p>
        <p>é€éèˆ‡AIæ·±åº¦å°è©±ï¼Œè¨˜éŒ„æ‚¨çš„äººç”Ÿæ›²ç·šå’Œå€‹äººç‰¹è‰²ï¼Œè®“AIå”åŠ©æ‚¨å»ºç«‹å®Œæ•´çš„IPäººè¨­ã€‚</p>
        
        <p><strong>ğŸš€ æ“ä½œæ­¥é©Ÿï¼š</strong></p>
        <div class="mode3-step-guide">
          <div class="mode3-step">
            <div class="mode3-step-number">1</div>
            <div class="mode3-step-content">
              <strong>é–‹å§‹å°è©±</strong>
              <p>é»æ“Šå¿«é€ŸæŒ‰éˆ•æˆ–è¼¸å…¥æ¡†ï¼Œèˆ‡AIåˆ†äº«æ‚¨çš„èƒŒæ™¯ã€å°ˆé•·ã€åƒ¹å€¼è§€</p>
            </div>
          </div>
          <div class="mode3-step">
            <div class="mode3-step-number">2</div>
            <div class="mode3-step-content">
              <strong>æ·±åº¦äº¤æµ</strong>
              <p>å»ºè­°é€²è¡Œ5-10è¼ªå°è©±ï¼Œè®“AIå……åˆ†äº†è§£æ‚¨çš„å€‹äººç‰¹è‰²å’Œç›®æ¨™</p>
            </div>
          </div>
          <div class="mode3-step">
            <div class="mode3-step-number">3</div>
            <div class="mode3-step-content">
              <strong>ç”Ÿæˆçµæœ</strong>
              <p>éš¨æ™‚é»æ“Šå³å´ç”ŸæˆæŒ‰éˆ•ï¼Œç„¡éœ€ç­‰å¾…AIæé†’</p>
            </div>
          </div>
        </div>
        
        <p><strong>ğŸ’¬ å°è©±å»ºè­°ï¼š</strong></p>
        <ul>
          <li>åˆ†äº«æ‚¨çš„å°ˆæ¥­ç¶“é©—å’Œæˆå°±</li>
          <li>è¨è«–æ‚¨çš„åƒ¹å€¼è§€å’Œäººç”Ÿç›®æ¨™</li>
          <li>æè¿°æ‚¨çš„å€‹æ€§å’Œæºé€šé¢¨æ ¼</li>
          <li>æ¢ç´¢æ‚¨æƒ³åˆ†äº«çš„å…§å®¹æ–¹å‘</li>
        </ul>
        
        <p><strong>ğŸ“Š ç”Ÿæˆå…§å®¹ï¼š</strong></p>
        <div class="mode3-result-types">
          <div class="mode3-result-type">
            <strong>ğŸ­ IP Profile</strong>
            <p>å€‹äººå“ç‰Œæª”æ¡ˆï¼šäººè¨­æ¨™ç±¤ã€å“ç‰ŒåŸå‹ã€èªæ°£è¨­å®š</p>
          </div>
          <div class="mode3-result-type">
            <strong>ğŸ“… 14å¤©è¦åŠƒ</strong>
            <p>è©³ç´°çš„çŸ­å½±éŸ³å…§å®¹è¦åŠƒè¡¨</p>
          </div>
          <div class="mode3-result-type">
            <strong>ğŸ“ ä»Šæ—¥è…³æœ¬</strong>
            <p>3æ”¯å³æ™‚å¯ç”¨çš„çŸ­å½±éŸ³è…³æœ¬</p>
          </div>
        </div>
        
        <p><strong>ğŸ’¡ é‡è¦æé†’ï¼š</strong></p>
        <ul>
          <li>âœ… <strong>éš¨æ™‚å¯ä»¥ç”Ÿæˆ</strong>ï¼šä¸éœ€è¦ç­‰AIæé†’</li>
          <li>âœ… <strong>å»ºè­°é †åº</strong>ï¼šIP Profile â†’ 14å¤©è¦åŠƒ â†’ ä»Šæ—¥è…³æœ¬</li>
          <li>âœ… <strong>å¯ä»¥é‡è¤‡ç”Ÿæˆ</strong>ï¼šä¸æ»¿æ„å°±é»ã€ŒğŸ”„ é‡æ–°ç”Ÿæˆã€</li>
          <li>âœ… <strong>AIæœ‰è¨˜æ†¶</strong>ï¼šæœƒè¨˜ä½æ‚¨ä¹‹å‰èªªéçš„å…§å®¹</li>
        </ul>
      </div>
    </div>
    
    <!-- IPäººè¨­è¦åŠƒç”ŸæˆçµæœæŠ½å±œ -->
    <div class="mode3-results-overlay" id="mode3ResultsOverlay" onclick="closeMode3ResultsDrawer()"></div>
    <div class="mode3-results-drawer" id="mode3ResultsDrawer">
      <div class="mode3-results-drawer-header">
        <h3>ğŸ“Š ç”Ÿæˆçµæœ</h3>
        <button class="mode3-results-drawer-close" onclick="closeMode3ResultsDrawer()">âœ•</button>
      </div>
      <div class="mode3-results-drawer-content">
        <!-- çµæœæ¨™ç±¤ -->
        <div class="mode3-tabs">
          <button class="mode3-tab active" onclick="switchMode3Tab('profile')">ã€ŠIP Profileã€‹</button>
          <button class="mode3-tab" onclick="switchMode3Tab('plan')">ã€Š14å¤©çŸ­å½±éŸ³è¦åŠƒè¡¨ã€‹</button>
          <button class="mode3-tab" onclick="switchMode3Tab('scripts')">ã€Šä»Šæ—¥3æ”¯è…³æœ¬ã€‹</button>
        </div>

        <!-- çµæœå…§å®¹ -->
        <div class="mode3-results-content">
          <!-- IP Profile çµæœ -->
          <div id="mode3-profile-result" class="mode3-result-block active">
            <div class="mode3-result-placeholder">
              <div class="mode3-placeholder-icon">ğŸ­</div>
              <h4>IP Profile</h4>
              <p>èˆ‡AIå°è©±å¾Œï¼Œå°‡åœ¨æ­¤é¡¯ç¤ºæ‚¨çš„å€‹äººå“ç‰Œæª”æ¡ˆ</p>
              <button class="mode3-generate-btn" onclick="generateMode3IPProfile()">
                <span>ğŸš€</span> ç”ŸæˆIP Profile
              </button>
            </div>
          </div>

          <!-- 14å¤©è¦åŠƒçµæœ -->
          <div id="mode3-plan-result" class="mode3-result-block">
            <div class="mode3-result-placeholder">
              <div class="mode3-placeholder-icon">ğŸ“…</div>
              <h4>14å¤©çŸ­å½±éŸ³è¦åŠƒ</h4>
              <p>åŸºæ–¼æ‚¨çš„IP Profileï¼Œç”Ÿæˆè©³ç´°çš„å…§å®¹è¦åŠƒ</p>
              <button class="mode3-generate-btn" onclick="generateMode314DayPlan()">
                <span>ğŸš€</span> ç”Ÿæˆ14å¤©è¦åŠƒ
              </button>
            </div>
          </div>

          <!-- ä»Šæ—¥è…³æœ¬çµæœ -->
          <div id="mode3-scripts-result" class="mode3-result-block">
            <div class="mode3-result-placeholder">
              <div class="mode3-placeholder-icon">ğŸ“</div>
              <h4>ä»Šæ—¥3æ”¯è…³æœ¬</h4>
              <p>æ ¹æ“šæ‚¨çš„è¦åŠƒï¼Œç”Ÿæˆä»Šæ—¥å¯ç”¨çš„è…³æœ¬</p>
              <button class="mode3-generate-btn" onclick="generateMode3TodayScripts()">
                <span>ğŸš€</span> ç”Ÿæˆä»Šæ—¥è…³æœ¬
              </button>
            </div>
          </div>
        </div>
        
        <!-- æ“ä½œæŒ‰éˆ• -->
        <div class="mode3-result-actions">
          <button class="mode3-action-btn" onclick="saveMode3Result()" title="å„²å­˜çµæœ">
            <span>ğŸ’¾</span> å„²å­˜çµæœ
          </button>
          <button class="mode3-action-btn" onclick="regenerateMode3Result()" title="é‡æ–°ç”Ÿæˆ">
            <span>ğŸ”„</span> é‡æ–°ç”Ÿæˆ
          </button>
          <button class="mode3-action-btn" onclick="exportMode3Result()" title="åŒ¯å‡ºçµæœ">
            <span>ğŸ“¤</span> åŒ¯å‡ºçµæœ
          </button>
        </div>
      </div>
    </div>
    
    <!-- æ‰‹æ©Ÿç‰ˆæŠ½å±œå°èˆª -->
    <div class="mobile-drawer-overlay" id="mobileDrawerOverlay" onclick="closeMobileDrawer()"></div>
    <div class="mobile-drawer" id="mobileDrawer">
      <div class="mobile-drawer-header">
        <h3>é¸å–®</h3>
        <button class="mobile-drawer-close" onclick="closeMobileDrawer()">âœ•</button>
      </div>
      <div class="mobile-drawer-content">
        <a href="#homepage" class="mobile-drawer-item" onclick="switchPage('homepage'); closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon">ğŸ </span>
          <span class="mobile-drawer-text">é¦–é </span>
        </a>
        <a href="#mode1" class="mobile-drawer-item" onclick="switchPage('mode1'); closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon"><i class="fas fa-magic"></i></span>
          <span class="mobile-drawer-text">ä¸€éµç”Ÿæˆ</span>
        </a>
        <a href="#mode2" class="mobile-drawer-item" onclick="switchPage('mode2'); closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon"><i class="fas fa-comments"></i></span>
          <span class="mobile-drawer-text">AIé¡§å•</span>
        </a>
        <a href="#mode3" class="mobile-drawer-item" onclick="switchPage('mode3'); closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon"><i class="fas fa-user-tie"></i></span>
          <span class="mobile-drawer-text">IPäººè¨­</span>
        </a>
        <a href="#forum" class="mobile-drawer-item" onclick="switchPage('forum'); closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon"><i class="fas fa-comments"></i></span>
          <span class="mobile-drawer-text">è«–å£‡ä»‹ç´¹</span>
        </a>
        <a href="#guide" class="mobile-drawer-item" onclick="switchPage('guide'); closeMobileDrawer(); return false;">
          <span class="mobile-drawer-icon"><i class="fas fa-book-open"></i></span>
          <span class="mobile-drawer-text">å¯¦æˆ°æŒ‡å—</span>
        </a>
        <a href="#" id="mobileUserDBTab" class="mobile-drawer-item" onclick="handleUserDBClick(); closeMobileDrawer(); return false;" style="display:none;">
          <span class="mobile-drawer-icon">ğŸ‘¤</span>
          <span class="mobile-drawer-text">è³‡æ–™åº«</span>
      </a>
    </div>
    </div>
    
    <!-- IPäººè¨­è¦åŠƒä½¿ç”¨èªªæ˜æŠ½å±œ -->
    <div class="mode3-instructions-overlay" id="mode3InstructionsOverlay" onclick="closeMode3InstructionsDrawer()"></div>
    <div class="mode3-instructions-drawer" id="mode3InstructionsDrawer">
      <div class="mode3-instructions-drawer-header">
        <h3>ğŸ“‹ IPäººè¨­è¦åŠƒä½¿ç”¨èªªæ˜</h3>
        <button class="mode3-instructions-drawer-close" onclick="closeMode3InstructionsDrawer()">âœ•</button>
      </div>
      <div class="mode3-instructions-drawer-content">
        <p><strong>ğŸ¯ IPäººè¨­è¦åŠƒæ¨¡å¼</strong></p>
        <p>é€éèˆ‡AIæ·±åº¦å°è©±ï¼Œè¨˜éŒ„æ‚¨çš„äººç”Ÿæ›²ç·šå’Œå€‹äººç‰¹è‰²ï¼Œè®“AIå”åŠ©æ‚¨å»ºç«‹å®Œæ•´çš„IPäººè¨­ã€‚</p>
        
        <p><strong>ğŸš€ æ“ä½œæ­¥é©Ÿï¼š</strong></p>
        <div class="mode3-step-guide">
          <div class="mode3-step">
            <div class="mode3-step-number">1</div>
            <div class="mode3-step-content">
              <strong>é–‹å§‹å°è©±</strong>
              <p>é»æ“Šå¿«é€ŸæŒ‰éˆ•æˆ–è¼¸å…¥æ¡†ï¼Œèˆ‡AIåˆ†äº«æ‚¨çš„èƒŒæ™¯ã€å°ˆé•·ã€åƒ¹å€¼è§€</p>
            </div>
          </div>
          <div class="mode3-step">
            <div class="mode3-step-number">2</div>
            <div class="mode3-step-content">
              <strong>æ·±åº¦äº¤æµ</strong>
              <p>å»ºè­°é€²è¡Œ5-10è¼ªå°è©±ï¼Œè®“AIå……åˆ†äº†è§£æ‚¨çš„å€‹äººç‰¹è‰²å’Œç›®æ¨™</p>
            </div>
          </div>
          <div class="mode3-step">
            <div class="mode3-step-number">3</div>
            <div class="mode3-step-content">
              <strong>ç”Ÿæˆçµæœ</strong>
              <p>éš¨æ™‚é»æ“Šå³å´ç”ŸæˆæŒ‰éˆ•ï¼Œç„¡éœ€ç­‰å¾…AIæé†’</p>
            </div>
          </div>
        </div>
        
        <p><strong>ğŸ’¬ å°è©±å»ºè­°ï¼š</strong></p>
        <ul>
          <li>åˆ†äº«æ‚¨çš„å°ˆæ¥­ç¶“é©—å’Œæˆå°±</li>
          <li>è¨è«–æ‚¨çš„åƒ¹å€¼è§€å’Œäººç”Ÿç›®æ¨™</li>
          <li>æè¿°æ‚¨çš„å€‹æ€§å’Œæºé€šé¢¨æ ¼</li>
          <li>æ¢ç´¢æ‚¨æƒ³åˆ†äº«çš„å…§å®¹æ–¹å‘</li>
        </ul>
        
        <p><strong>ğŸ“Š ç”Ÿæˆå…§å®¹ï¼š</strong></p>
        <div class="mode3-result-types">
          <div class="mode3-result-type">
            <strong>ğŸ­ IP Profile</strong>
            <p>å€‹äººå“ç‰Œæª”æ¡ˆï¼šäººè¨­æ¨™ç±¤ã€å“ç‰ŒåŸå‹ã€èªæ°£è¨­å®š</p>
          </div>
          <div class="mode3-result-type">
            <strong>ğŸ“… 14å¤©è¦åŠƒ</strong>
            <p>è©³ç´°çš„çŸ­å½±éŸ³å…§å®¹è¦åŠƒè¡¨</p>
          </div>
          <div class="mode3-result-type">
            <strong>ğŸ“ ä»Šæ—¥è…³æœ¬</strong>
            <p>3æ”¯å³æ™‚å¯ç”¨çš„çŸ­å½±éŸ³è…³æœ¬</p>
          </div>
        </div>
        
        <p><strong>ğŸ’¡ é‡è¦æé†’ï¼š</strong></p>
        <ul>
          <li>âœ… <strong>éš¨æ™‚å¯ä»¥ç”Ÿæˆ</strong>ï¼šä¸éœ€è¦ç­‰AIæé†’</li>
          <li>âœ… <strong>å»ºè­°é †åº</strong>ï¼šIP Profile â†’ 14å¤©è¦åŠƒ â†’ ä»Šæ—¥è…³æœ¬</li>
          <li>âœ… <strong>å¯ä»¥é‡è¤‡ç”Ÿæˆ</strong>ï¼šä¸æ»¿æ„å°±é»ã€ŒğŸ”„ é‡æ–°ç”Ÿæˆã€</li>
          <li>âœ… <strong>AIæœ‰è¨˜æ†¶</strong>ï¼šæœƒè¨˜ä½æ‚¨ä¹‹å‰èªªéçš„å…§å®¹</li>
        </ul>
      </div>
    </div>
    
    <!-- IPäººè¨­è¦åŠƒç”ŸæˆçµæœæŠ½å±œ -->
    <div class="mode3-results-overlay" id="mode3ResultsOverlay" onclick="closeMode3ResultsDrawer()"></div>
    <div class="mode3-results-drawer" id="mode3ResultsDrawer">
      <div class="mode3-results-drawer-header">
        <h3>ğŸ“Š ç”Ÿæˆçµæœ</h3>
        <button class="mode3-results-drawer-close" onclick="closeMode3ResultsDrawer()">âœ•</button>
      </div>
      <div class="mode3-results-drawer-content">
        <!-- çµæœæ¨™ç±¤ -->
        <div class="mode3-tabs">
          <button class="mode3-tab active" onclick="switchMode3Tab('profile', event)">ã€ŠIP Profileã€‹</button>
          <button class="mode3-tab" onclick="switchMode3Tab('plan', event)">ã€Š14å¤©çŸ­å½±éŸ³è¦åŠƒè¡¨ã€‹</button>
          <button class="mode3-tab" onclick="switchMode3Tab('scripts', event)">ã€Šä»Šæ—¥3æ”¯è…³æœ¬ã€‹</button>
        </div>

        <!-- çµæœå…§å®¹ -->
        <div class="mode3-results-content">
          <!-- IP Profile çµæœ -->
          <div id="mode3-profile-result" class="mode3-result-block active">
            <div class="mode3-result-placeholder">
              <div class="mode3-placeholder-icon">ğŸ­</div>
              <h4>IP Profile</h4>
              <p>èˆ‡AIå°è©±å¾Œï¼Œå°‡åœ¨æ­¤é¡¯ç¤ºæ‚¨çš„å€‹äººå“ç‰Œæª”æ¡ˆ</p>
              <button class="mode3-generate-btn" onclick="generateMode3IPProfile()">
                <span>ğŸš€</span> ç”ŸæˆIP Profile
              </button>
            </div>
          </div>

          <!-- 14å¤©è¦åŠƒçµæœ -->
          <div id="mode3-plan-result" class="mode3-result-block">
            <div class="mode3-result-placeholder">
              <div class="mode3-placeholder-icon">ğŸ“…</div>
              <h4>14å¤©çŸ­å½±éŸ³è¦åŠƒ</h4>
              <p>åŸºæ–¼æ‚¨çš„IP Profileï¼Œç”Ÿæˆè©³ç´°çš„å…§å®¹è¦åŠƒ</p>
              <button class="mode3-generate-btn" onclick="generateMode314DayPlan()">
                <span>ğŸš€</span> ç”Ÿæˆ14å¤©è¦åŠƒ
              </button>
            </div>
          </div>

          <!-- ä»Šæ—¥è…³æœ¬çµæœ -->
          <div id="mode3-scripts-result" class="mode3-result-block">
            <div class="mode3-result-placeholder">
              <div class="mode3-placeholder-icon">ğŸ“</div>
              <h4>ä»Šæ—¥3æ”¯è…³æœ¬</h4>
              <p>æ ¹æ“šæ‚¨çš„è¦åŠƒï¼Œç”Ÿæˆä»Šæ—¥å¯ç”¨çš„è…³æœ¬</p>
              <button class="mode3-generate-btn" onclick="generateMode3TodayScripts()">
                <span>ğŸš€</span> ç”Ÿæˆä»Šæ—¥è…³æœ¬
              </button>
            </div>
          </div>
        </div>
        
        <!-- æ“ä½œæŒ‰éˆ• -->
        <div class="mode3-result-actions">
          <button class="mode3-action-btn" onclick="saveMode3Result()" title="å„²å­˜çµæœ">
            <span>ğŸ’¾</span> å„²å­˜çµæœ
          </button>
          <button class="mode3-action-btn" onclick="regenerateMode3Result()" title="é‡æ–°ç”Ÿæˆ">
            <span>ğŸ”„</span> é‡æ–°ç”Ÿæˆ
          </button>
          <button class="mode3-action-btn" onclick="exportMode3Result()" title="åŒ¯å‡ºçµæœ">
            <span>ğŸ“¤</span> åŒ¯å‡ºçµæœ
          </button>
        </div>
    </div>
    </div>

  </body>
</html>
<script>
  (function(){
    function goToPricing(plan){
      var base = 'subscription.html';
      var url = plan ? (base + '?plan=' + encodeURIComponent(plan)) : base;
      window.location.href = url;
    }
    function smoothScrollTo(id){
      try{
        var el = document.getElementById(id);
        if(el){ el.scrollIntoView({behavior:'smooth'}); }
      }catch(_){ window.location.hash = '#' + id; }
    }
    function goLogin(){
      // ä¸€å¾‹ä½¿ç”¨ä¸»è¦–çª—è·³è½‰ï¼ˆfb=å‰ç«¯åŸºåº•ç¶²å€ï¼‰
      try{
        var fb = encodeURIComponent(window.location.origin);
        window.location.href = 'https://aivideobackend.zeabur.app/api/auth/google?fb=' + fb;
      }catch(_){
        window.location.href = 'https://aivideobackend.zeabur.app/api/auth/google';
      }
    }
    document.addEventListener('click', function(e){
      var t = e.target;
      if (!t) return;
      var txt = (t.innerText||'').trim();
      if (txt.includes('ç«‹å³å•Ÿå‹•') && txt.includes('AI')){ e.preventDefault(); goToPricing(); }
      if (txt === 'ç™»å…¥è§£é–ä½ çš„å°ˆå±¬ AI æ™ºèƒ½é«”'){ e.preventDefault(); goToLogin(); }
      if (txt === 'ç«‹å³è¨‚é–±'){ e.preventDefault(); goToPricing(); }
      if (txt.includes('å·²è¨‚é–±') && txt.includes('ç™»å…¥ä½¿ç”¨')){ e.preventDefault(); goLogin(); }
    }, true);
    window.goToPricing = goToPricing;
    window.smoothScrollTo = smoothScrollTo;
    window.goLogin = goLogin;
  })();
  
  // Mode3 IPäººè¨­è¦åŠƒåŠŸèƒ½ï¼ˆå¾ index-ai-consultant.html é·ç§»ï¼‰
  (function() {
    const API_BASE_URL = 'https://aivideobackend.zeabur.app';
    let currentMode3ConversationType = 'ip_planning';
    let isMode3Sending = false; // é˜²æ­¢é‡è¤‡ç™¼é€
    
    // åˆå§‹åŒ– Mode3 èŠå¤©åŠŸèƒ½ï¼ˆé˜²æ­¢é‡è¤‡ç¶å®šï¼‰
    let mode3ChatInitialized = false;
    function initMode3Chat() {
      const messageInput = document.getElementById('mode3-messageInput');
      const sendBtn = document.getElementById('mode3-sendBtn');
      const quickButtons = document.getElementById('mode3-quickButtons');
      
      if (!messageInput || !sendBtn || !quickButtons) return;
      
      // å¦‚æœå·²ç¶“åˆå§‹åŒ–éï¼Œè·³éï¼ˆä½†å…è¨±åœ¨åˆ‡æ›é é¢æ™‚é‡æ–°åˆå§‹åŒ–ï¼‰
      // æ³¨æ„ï¼šé€™å€‹æª¢æŸ¥ç¢ºä¿ä¸æœƒé‡è¤‡ç¶å®šäº‹ä»¶ç›£è½å™¨
      if (mode3ChatInitialized) {
        // å¦‚æœå·²ç¶“åˆå§‹åŒ–éï¼Œåªé‡æ–°è¨­ç½®æŒ‰éˆ•ç‹€æ…‹ï¼Œä¸é‡è¤‡ç¶å®šäº‹ä»¶
        sendBtn.disabled = !messageInput.value.trim();
        return;
      }
      mode3ChatInitialized = true;
      
      // è¼¸å…¥æ¡†è‡ªå‹•èª¿æ•´é«˜åº¦
      messageInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = Math.min(this.scrollHeight, 100) + 'px';
        sendBtn.disabled = !this.value.trim();
      });
      
      // ç™¼é€æŒ‰éˆ•
      sendBtn.addEventListener('click', () => {
        const message = messageInput.value.trim();
        if (message) {
          sendMode3Message(message);
        }
      });
      
      // Enter ç™¼é€
      messageInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          const message = messageInput.value.trim();
          if (message) {
            sendMode3Message(message);
          }
        }
      });
      
      // å¿«é€ŸæŒ‰éˆ• - ä½¿ç”¨äº‹ä»¶å§”è¨—é¿å…é‡è¤‡ç¶å®šï¼Œç¢ºä¿åªè™•ç† mode3 çš„æŒ‰éˆ•
      quickButtons.addEventListener('click', (e) => {
        e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡åˆ°å…¶ä»–ç›£è½å™¨
        const btn = e.target.closest('.quick-btn');
        // ç¢ºä¿æŒ‰éˆ•åœ¨ mode3 å®¹å™¨å…§ï¼Œä¸¦ä¸”æ˜¯ mode3 çš„å¿«é€ŸæŒ‰éˆ•å®¹å™¨
        if (btn && btn.closest('#mode3') && quickButtons.id === 'mode3-quickButtons') {
          e.preventDefault();
          const text = btn.getAttribute('data-text');
          if (text) {
            sendMode3Message(text, 'ip_planning');
          }
        }
      });
    }
    
    // ç™¼é€ Mode3 è¨Šæ¯
    async function sendMode3Message(message, conversationType = 'ip_planning') {
      // é˜²æ­¢é‡è¤‡ç™¼é€
      if (isMode3Sending) {
        console.log('è¨Šæ¯ç™¼é€ä¸­ï¼Œè«‹ç¨å€™...');
        return;
      }
      
      currentMode3ConversationType = conversationType;
      if (!message || !message.trim()) return;
      
      isMode3Sending = true;
      
      const chatMessages = document.getElementById('mode3-chatMessages');
      const messageInput = document.getElementById('mode3-messageInput');
      const sendBtn = document.getElementById('mode3-sendBtn');
      const quickButtons = document.getElementById('mode3-quickButtons');
      
      if (!chatMessages || !messageInput || !sendBtn) return;
      
      // ç²å–ç”¨æˆ¶ token
      const token = localStorage.getItem('ipPlanningToken') || 
                   (window.Auth && window.Auth.getToken ? window.Auth.getToken() : null);
      const userStr = localStorage.getItem('ipPlanningUser');
      const user = userStr ? JSON.parse(userStr) : null;
      
      // æ·»åŠ ç”¨æˆ¶è¨Šæ¯
      const userMessage = createMode3Message('user', message);
      chatMessages.appendChild(userMessage);
      
      // éš±è—å¿«é€ŸæŒ‰éˆ•
      if (quickButtons) {
        quickButtons.style.display = 'none';
      }
      
      // æ¸…ç©ºè¼¸å…¥æ¡†ä¸¦ç¦ç”¨
      messageInput.value = '';
      messageInput.disabled = true;
      sendBtn.disabled = true;
      messageInput.style.height = 'auto';
      
      // è¨˜éŒ„é•·æœŸè¨˜æ†¶
      try {
        await recordMode3ConversationMessage(conversationType, 'user', message, token, user);
      } catch (error) {
        console.error('è¨˜éŒ„é•·æœŸè¨˜æ†¶éŒ¯èª¤:', error);
      }
      
      // æ·»åŠ è¼‰å…¥å‹•ç•«ï¼ˆç›´æ¥å‰µå»º AI è¨Šæ¯å®¹å™¨ï¼Œå…§å®¹å…ˆé¡¯ç¤ºè¼‰å…¥å‹•ç•«ï¼‰
      const aiMessage = createMode3Message('assistant', '');
      const contentDiv = aiMessage.querySelector('.message-content');
      // å…ˆé¡¯ç¤ºè¼‰å…¥å‹•ç•«
      contentDiv.innerHTML = `
        <div class="typing-indicator">
          <span>AIæ€è€ƒä¸­...</span>
          <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
        </div>
      `;
      chatMessages.appendChild(aiMessage);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/chat/stream`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            ...(token && { 'Authorization': `Bearer ${token}` })
          },
          body: JSON.stringify({
            message: message,
            history: [],
            user_id: user?.user_id || null
          })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        // ä¸éœ€è¦ç§»é™¤è¼‰å…¥å‹•ç•«ï¼Œç›´æ¥æ›´æ–°å…§å®¹å³å¯
        
        // è™•ç†ä¸²æµå›æ‡‰
        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        let fullContent = '';
        
        while (true) {
          const { done, value } = await reader.read();
          if (done) break;
          
          buffer += decoder.decode(value, { stream: true });
          const lines = buffer.split('\n');
          buffer = lines.pop();
          
          for (const line of lines) {
            if (line.startsWith('data: ')) {
              const data = line.slice(6);
              if (data === '[DONE]') {
                // è¨˜éŒ„é•·æœŸè¨˜æ†¶
                try {
                  await recordMode3ConversationMessage(currentMode3ConversationType, 'assistant', fullContent, token, user);
                } catch (error) {
                  console.error('è¨˜éŒ„é•·æœŸè¨˜æ†¶éŒ¯èª¤:', error);
                }
                break;
              }
              
              try {
                const parsed = JSON.parse(data);
                if (parsed.content) {
                  fullContent += parsed.content;
                  contentDiv.innerHTML = renderMode3Markdown(fullContent);
                  
                  // èªæ³•é«˜äº®
                  if (typeof hljs !== 'undefined') {
                    contentDiv.querySelectorAll('pre code').forEach((block) => {
                      if (!block.classList.contains('hljs')) {
                        hljs.highlightElement(block);
                      }
                    });
                  }
                  
                  chatMessages.scrollTop = chatMessages.scrollHeight;
                }
              } catch (e) {
                // å¿½ç•¥è§£æéŒ¯èª¤
              }
            }
          }
        }
      } catch (error) {
        console.error('ç™¼é€è¨Šæ¯éŒ¯èª¤:', error);
        // ç›´æ¥æ›´æ–°ç¾æœ‰çš„ AI è¨Šæ¯å…§å®¹ç‚ºéŒ¯èª¤è¨Šæ¯
        if (contentDiv) {
          const safeErrorMsg = escapeHtml(error.message || 'æœªçŸ¥éŒ¯èª¤');
          contentDiv.innerHTML = `æŠ±æ­‰ï¼Œç™¼ç”Ÿäº†éŒ¯èª¤ï¼š${safeErrorMsg}`;
        } else {
        const errorMessage = createMode3Message('assistant', `æŠ±æ­‰ï¼Œç™¼ç”Ÿäº†éŒ¯èª¤ï¼š${error.message}`);
        chatMessages.appendChild(errorMessage);
        }
      } finally {
        // æ¢å¾©è¼¸å…¥æ¡†å’ŒæŒ‰éˆ•
        messageInput.disabled = false;
        sendBtn.disabled = false;
        if (quickButtons) {
          quickButtons.style.display = 'flex';
        }
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // é‡ç½®ç™¼é€ç‹€æ…‹
        isMode3Sending = false;
      }
    }
    
    // å‰µå»º Mode3 è¨Šæ¯å…ƒç´ 
    function createMode3Message(role, content) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${role}`;
      
      const avatar = document.createElement('div');
      avatar.className = 'message-avatar';
      
      // ç²å–ç”¨æˆ¶é ­åƒï¼ˆå¾ Google ç™»å…¥ï¼‰
      if (role === 'user') {
        const userStr = localStorage.getItem('ipPlanningUser');
        const user = userStr ? JSON.parse(userStr) : null;
        if (user && user.picture) {
          // ä½¿ç”¨åœ–ç‰‡ä½œç‚ºé ­åƒ
          const img = document.createElement('img');
          img.src = user.picture;
          img.style.width = '100%';
          img.style.height = '100%';
          img.style.borderRadius = '50%';
          img.style.objectFit = 'cover';
          avatar.appendChild(img);
        } else {
          // å¦‚æœæ²’æœ‰åœ–ç‰‡ï¼Œä½¿ç”¨é¦–å­—æ¯
          const userName = user?.name || 'U';
          avatar.textContent = userName.charAt(0).toUpperCase();
        }
      } else {
        // AI é ­åƒä½¿ç”¨æ–‡å­—
        avatar.textContent = 'ğŸ¤–';
      }
      
      const contentDiv = document.createElement('div');
      contentDiv.className = 'message-content';
      if (content) {
        contentDiv.innerHTML = renderMode3Markdown(content);
      }
      
      // ç”¨æˆ¶è¨Šæ¯ä½¿ç”¨ row-reverseï¼Œæ‰€ä»¥å…ˆæ·»åŠ å…§å®¹å†æ·»åŠ é ­åƒ
      if (role === 'user') {
        messageDiv.appendChild(contentDiv);
        messageDiv.appendChild(avatar);
      } else {
        messageDiv.appendChild(avatar);
        messageDiv.appendChild(contentDiv);
      }
      
      return messageDiv;
    }
    
    // å‰µå»ºè¼‰å…¥å‹•ç•«
    function createMode3TypingIndicator() {
      const indicator = document.createElement('div');
      indicator.className = 'message assistant';
      indicator.innerHTML = `
        <div class="message-avatar">ğŸ¤–</div>
        <div class="message-content">
          <div class="typing-indicator">
            <span>AIæ€è€ƒä¸­...</span>
            <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            </div>
          </div>
        </div>
      `;
      return indicator;
    }
    
    // Markdown æ¸²æŸ“
    function renderMode3Markdown(text) {
      if (typeof marked !== 'undefined') {
        return marked.parse(text);
      }
      return text.replace(/\n/g, '<br>');
    }
    
    // è¨˜éŒ„ Mode3 é•·æœŸè¨˜æ†¶
    async function recordMode3ConversationMessage(conversationType, role, content, token, user) {
      if (!token || !content) return;
      
      try {
        const user_id = user?.user_id || 
          (token ? JSON.parse(atob(token.split('.')[1])).user_id : null);
        
        if (!user_id) {
          console.warn('ç„¡æ³•ç²å– user_idï¼Œè·³éé•·æœŸè¨˜æ†¶è¨˜éŒ„');
          return;
        }
        
        const session_id = `${conversationType}_${user_id}_${Date.now()}`;
        
        await fetch(`${API_BASE_URL}/api/memory/long-term`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({
            conversation_type: conversationType,
            session_id: session_id,
            message_role: role,
            message_content: content,
            metadata: JSON.stringify({ user_id: user_id })
          })
        });
      } catch (error) {
        console.error('è¨˜éŒ„é•·æœŸè¨˜æ†¶éŒ¯èª¤:', error);
      }
    }
    
    // IPäººè¨­è¦åŠƒä½¿ç”¨èªªæ˜æŠ½å±œæ§åˆ¶
    window.toggleMode3InstructionsDrawer = function() {
      const overlay = document.getElementById('mode3InstructionsOverlay');
      const drawer = document.getElementById('mode3InstructionsDrawer');
      
      if (overlay && drawer) {
        const isOpen = overlay.classList.contains('open');
        
        if (isOpen) {
          closeMode3InstructionsDrawer();
        } else {
          openMode3InstructionsDrawer();
        }
      }
    };
    
    window.openMode3InstructionsDrawer = function() {
      const overlay = document.getElementById('mode3InstructionsOverlay');
      const drawer = document.getElementById('mode3InstructionsDrawer');
      
      if (overlay && drawer) {
        overlay.classList.add('open');
        drawer.classList.add('open');
        document.body.style.overflow = 'hidden';
      }
    };
    
    window.closeMode3InstructionsDrawer = function() {
      const overlay = document.getElementById('mode3InstructionsOverlay');
      const drawer = document.getElementById('mode3InstructionsDrawer');
      
      if (overlay && drawer) {
        overlay.classList.remove('open');
        drawer.classList.remove('open');
        document.body.style.overflow = '';
      }
    };
    
    // IPäººè¨­è¦åŠƒç”ŸæˆçµæœæŠ½å±œæ§åˆ¶
    window.toggleMode3ResultsDrawer = function() {
      const overlay = document.getElementById('mode3ResultsOverlay');
      const drawer = document.getElementById('mode3ResultsDrawer');
      
      if (overlay && drawer) {
        const isOpen = overlay.classList.contains('open');
        
        if (isOpen) {
          closeMode3ResultsDrawer();
        } else {
          openMode3ResultsDrawer();
        }
      }
    };
    
    window.openMode3ResultsDrawer = function() {
      const overlay = document.getElementById('mode3ResultsOverlay');
      const drawer = document.getElementById('mode3ResultsDrawer');
      
      if (overlay && drawer) {
        overlay.classList.add('open');
        drawer.classList.add('open');
        document.body.style.overflow = 'hidden';
      }
    };
    
    window.closeMode3ResultsDrawer = function() {
      const overlay = document.getElementById('mode3ResultsOverlay');
      const drawer = document.getElementById('mode3ResultsDrawer');
      
      if (overlay && drawer) {
        overlay.classList.remove('open');
        drawer.classList.remove('open');
        document.body.style.overflow = '';
      }
    };
    
    // åˆ‡æ›ç”Ÿæˆçµæœæ¨™ç±¤
    window.switchMode3Tab = function(tabName, event) {
      document.querySelectorAll('.mode3-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      document.querySelectorAll('.mode3-result-block').forEach(block => {
        block.classList.remove('active');
      });
      
      if (event && event.target) {
        event.target.classList.add('active');
      } else {
        const tabs = document.querySelectorAll('.mode3-tab');
        tabs.forEach(tab => {
          if (tab.textContent.includes(tabName === 'profile' ? 'IP Profile' : tabName === 'plan' ? '14å¤©' : 'ä»Šæ—¥')) {
            tab.classList.add('active');
          }
        });
      }
      
      const resultBlock = document.getElementById(`mode3-${tabName}-result`);
      if (resultBlock) {
        resultBlock.classList.add('active');
      }
    };
    
    // ç”ŸæˆåŠŸèƒ½å·²åœ¨ä¸Šé¢å®šç¾©ï¼Œé€™è£¡ä¸éœ€è¦é‡è¤‡å®šç¾©
    // å¦‚æœä¸Šé¢çš„å‡½æ•¸æœªå®šç¾©ï¼Œå‰‡ä½¿ç”¨ä½”ä½å‡½æ•¸
    if (typeof generateMode3IPProfile === 'undefined') {
      window.generateMode3IPProfile = function() {
        console.log('ç”ŸæˆIP Profile - å‡½æ•¸æœªå®šç¾©');
      };
    }
    
    if (typeof generateMode314DayPlan === 'undefined') {
      window.generateMode314DayPlan = function() {
        console.log('ç”Ÿæˆ14å¤©è¦åŠƒ - å‡½æ•¸æœªå®šç¾©');
      };
    }
    
    if (typeof generateMode3TodayScripts === 'undefined') {
      window.generateMode3TodayScripts = function() {
        console.log('ç”Ÿæˆä»Šæ—¥è…³æœ¬ - å‡½æ•¸æœªå®šç¾©');
      };
    }
    
    // é€™äº›å‡½æ•¸å·²åœ¨ä¸Šé¢å®šç¾©ï¼Œä¸éœ€è¦é‡è¤‡å®šç¾©
    // å¦‚æœä¸Šé¢çš„å‡½æ•¸æœªå®šç¾©ï¼Œå‰‡ä½¿ç”¨ä½”ä½å‡½æ•¸
    if (typeof saveMode3Result === 'undefined') {
      window.saveMode3Result = function() {
        console.log('å„²å­˜çµæœ - å‡½æ•¸æœªå®šç¾©');
      };
    }
    
    if (typeof regenerateMode3Result === 'undefined') {
      window.regenerateMode3Result = function() {
        console.log('é‡æ–°ç”Ÿæˆ - å‡½æ•¸æœªå®šç¾©');
      };
    }
    
    if (typeof exportMode3Result === 'undefined') {
      window.exportMode3Result = function() {
        console.log('åŒ¯å‡ºçµæœ - å‡½æ•¸æœªå®šç¾©');
      };
    }
    
    // ç•¶ mode3 é é¢æ¿€æ´»æ™‚åˆå§‹åŒ–
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initMode3Chat, 100);
      });
    } else {
      setTimeout(initMode3Chat, 100);
    }
    
    // ç›£è½é é¢åˆ‡æ›
    const originalSwitchPage = window.switchPage;
    if (originalSwitchPage) {
      window.switchPage = function(pageId) {
        originalSwitchPage(pageId);
        if (pageId === 'mode3') {
          setTimeout(initMode3Chat, 100);
          document.body.classList.add('mode3-active');
          document.documentElement.classList.add('mode3-active');
        } else {
          document.body.classList.remove('mode3-active');
          document.documentElement.classList.remove('mode3-active');
        }
      };
    }
  })();
  
  // æ‰“å­—æ©Ÿå‹•ç•«å‡½æ•¸
  function initTypewriterAnimation() {
    const heroTitles = [
      { id: 'hero-title-1', text: 'è®“ AI å¹«ä½ æ‰“é€ \nä¸‹ä¸€æ”¯çˆ†æ¬¾çŸ­å½±éŸ³' },
      { id: 'hero-title-2', text: 'è®“ AI å¹«ä½ æ‰“é€ \nä¸‹ä¸€æ”¯çˆ†æ¬¾çŸ­å½±éŸ³' }
    ];
    
    heroTitles.forEach(({ id, text }) => {
      const titleElement = document.getElementById(id);
      if (!titleElement) return;
      
      const textSpan = titleElement.querySelector('.typewriter-text');
      if (!textSpan) return;
      
      // é‡ç½®æ–‡å­—
      textSpan.textContent = '';
      
      // å°‡æ›è¡Œç¬¦è½‰æ›ç‚ºè™•ç†
      const lines = text.split('\n');
      let currentLineIndex = 0;
      let currentCharIndex = 0;
      let isTyping = true;
      
      function typeChar() {
        if (!isTyping) return;
        
        if (currentLineIndex < lines.length) {
          const currentLine = lines[currentLineIndex];
          
          if (currentCharIndex < currentLine.length) {
            // æ·»åŠ ç•¶å‰å­—ç¬¦
            if (currentCharIndex === 0 && currentLineIndex > 0) {
              textSpan.innerHTML += '<br>';
            }
            textSpan.textContent += currentLine[currentCharIndex];
            currentCharIndex++;
            
            // ç¹¼çºŒæ‰“å­—
            setTimeout(typeChar, 80); // æ¯å€‹å­—ç¬¦é–“éš” 80ms
          } else {
            // ç•¶å‰è¡Œå®Œæˆï¼Œç§»åˆ°ä¸‹ä¸€è¡Œ
            currentLineIndex++;
            currentCharIndex = 0;
            
            if (currentLineIndex < lines.length) {
              // é‚„æœ‰ä¸‹ä¸€è¡Œï¼Œç¹¼çºŒ
              setTimeout(typeChar, 200); // æ›è¡Œå‰æš«åœ 200ms
            } else {
              // æ‰€æœ‰æ–‡å­—å®Œæˆ
              isTyping = false;
            }
          }
        }
      }
      
      // å»¶é²å•Ÿå‹•å‹•ç•«ï¼Œè®“é é¢å…ˆè¼‰å…¥
      setTimeout(() => {
        typeChar();
      }, 500);
    });
  }
</script>
</html>